{"version":3,"file":"index-DXoIe7Kg.js","sources":["../../src/config.ts","../../src/scenes/MainMenuScene.ts","../../src/assets/AssetManifest.ts","../../src/assets/AssetManager.ts","../../src/scenes/BootScene.ts","../../node_modules/bitecs/dist/index.mjs","../../src/world/SeededRandom.ts","../../src/world/TileRegistry.ts","../../src/world/BiomeGenerator.ts","../../src/world/IsometricHelper.ts","../../src/world/ChunkManager.ts","../../src/ecs/components.ts","../../src/ecs/world.ts","../../src/ecs/systems/MovementSystem.ts","../../src/ecs/systems/AnimationSystem.ts","../../src/ecs/systems/AISystem.ts","../../src/data/enemyAffixes.ts","../../src/ecs/systems/CombatSystem.ts","../../src/ecs/systems/ProjectileSystem.ts","../../src/ecs/systems/SpawnSystem.ts","../../src/data/enemies.ts","../../src/data/legendaryEffects.ts","../../src/systems/RarityManager.ts","../../src/ecs/systems/LootSystem.ts","../../src/entities/Player.ts","../../src/data/items.ts","../../src/systems/TimeManager.ts","../../src/systems/SaveManager.ts","../../src/systems/InventoryManager.ts","../../src/systems/EquipmentManager.ts","../../src/data/quests.ts","../../src/systems/QuestManager.ts","../../src/data/skills.ts","../../src/systems/SkillManager.ts","../../src/data/npcs.ts","../../src/systems/RelationshipManager.ts","../../src/data/recipes.ts","../../src/systems/CraftingManager.ts","../../src/systems/FarmingManager.ts","../../src/systems/FishingManager.ts","../../src/systems/CookingManager.ts","../../src/systems/WeaponMasteryManager.ts","../../src/data/chapters.ts","../../src/systems/StoryManager.ts","../../src/systems/CorruptionManager.ts","../../src/data/riftModifiers.ts","../../src/systems/RiftManager.ts","../../src/data/settlements.ts","../../src/systems/SettlementManager.ts","../../src/data/factions.ts","../../src/systems/FactionManager.ts","../../src/data/titans.ts","../../src/systems/TitanManager.ts","../../src/data/biomes.ts","../../src/systems/WeatherManager.ts","../../src/systems/AudioManager.ts","../../src/systems/LightingManager.ts","../../src/systems/ParticleManager.ts","../../src/systems/CorruptionOverlay.ts","../../src/systems/FestivalManager.ts","../../src/systems/RomanceManager.ts","../../src/systems/CareerManager.ts","../../src/systems/AchievementManager.ts","../../src/systems/MailManager.ts","../../src/systems/StorageManager.ts","../../src/systems/TemperatureManager.ts","../../src/systems/ShadowWorldManager.ts","../../src/systems/CityLevelManager.ts","../../src/systems/NewGamePlusManager.ts","../../src/systems/EndgameManager.ts","../../src/systems/TutorialManager.ts","../../src/systems/InteriorManager.ts","../../src/systems/LegendaryQuestManager.ts","../../src/systems/AbilityManager.ts","../../src/systems/CutsceneManager.ts","../../src/data/loreFragments.ts","../../src/systems/CodexManager.ts","../../src/data/scarMemories.ts","../../src/systems/ScarReadingManager.ts","../../src/systems/PactManager.ts","../../src/systems/ResolveManager.ts","../../src/systems/BountyContractManager.ts","../../src/systems/EnemyWeaknessManager.ts","../../src/systems/OmenSlotManager.ts","../../src/systems/CompanionManager.ts","../../src/systems/BoonManager.ts","../../src/systems/ResourceCycleManager.ts","../../src/systems/ShortcutManager.ts","../../src/systems/ImprintManager.ts","../../src/systems/QuirkManager.ts","../../src/systems/WeaponEchoManager.ts","../../src/entities/NPC.ts","../../src/data/cities.ts","../../src/scenes/OverworldScene.ts","../../src/data/dungeons.ts","../../src/systems/DungeonManager.ts","../../src/scenes/DungeonScene.ts","../../src/data/bosses.ts","../../src/entities/Boss.ts","../../src/scenes/BossArenaScene.ts","../../src/scenes/SettlementScene.ts","../../src/ui/UIBase.ts","../../src/ui/InventoryUI.ts","../../src/ui/CraftingUI.ts","../../src/ui/QuestJournal.ts","../../src/ui/MapUI.ts","../../src/ui/SkillsUI.ts","../../src/ui/SettingsUI.ts","../../src/ui/ShopUI.ts","../../src/ui/BestiaryUI.ts","../../src/ui/StorageUI.ts","../../src/ui/MailUI.ts","../../src/ui/CareerUI.ts","../../src/scenes/UIScene.ts","../../src/scenes/DialogueScene.ts","../../src/main.ts"],"sourcesContent":["/** Core game constants and balance tuning */\n\n// Rendering\nexport const GAME_WIDTH = 1280;\nexport const GAME_HEIGHT = 720;\nexport const TILE_WIDTH = 64;\nexport const TILE_HEIGHT = 32;\nexport const TILE_SIZE = 32;\nexport const CHUNK_SIZE = 16;\nexport const RENDER_DISTANCE = 3; // chunks around camera\n\n// Player\nexport const PLAYER_SPEED = 120;\nexport const PLAYER_SPRINT_MULT = 1.6;\nexport const PLAYER_MAX_HP = 100;\nexport const PLAYER_MAX_STAMINA = 100;\nexport const STAMINA_REGEN_RATE = 8; // per second\nexport const STAMINA_SPRINT_COST = 15; // per second\nexport const INTERACTION_RADIUS = 48;\nexport const INVENTORY_SLOTS = 36;\nexport const HOTBAR_SLOTS = 10;\nexport const ABILITY_SLOTS = 4;\n\n// Combat\nexport const INVINCIBILITY_FRAMES_MS = 300;\nexport const KNOCKBACK_FORCE = 200;\nexport const CRIT_BASE_CHANCE = 0.05;\nexport const CRIT_BASE_MULT = 1.5;\nexport const BOSS_ENRAGE_TIME_MS = 300_000; // 5 minutes\nexport const BOSS_ENRAGE_MULT = 1.5;\n\n// Combat Juice (hitstop / screen effects)\nexport const HITSTOP_DURATION_MS = 50;     // brief freeze on normal hit\nexport const CRIT_HITSTOP_DURATION_MS = 80; // longer freeze on critical hit\nexport const KILL_HITSTOP_DURATION_MS = 120; // longest freeze on killing blow\n\n// Time & Seasons\nexport const DAY_LENGTH_MS = 1_440_000; // 24 real-time minutes\nexport const DAYS_PER_SEASON = 28;\nexport const SEASONS = ['Spring', 'Summer', 'Autumn', 'Winter'] as const;\n\n// World Generation\nexport const BIOME_RINGS = {\n  haven:    { min: 0,    max: 200  },\n  rotwood:  { min: 200,  max: 500  },\n  ashlands: { min: 500,  max: 800  },\n  drowned:  { min: 800,  max: 1100 },\n  bone:     { min: 1100, max: 1400 },\n  void:     { min: 1400, max: 1700 },\n  edilas:   { min: 1700, max: Infinity },\n} as const;\n\nexport const NOISE_OCTAVES = 4;\nexport const NOISE_PERSISTENCE = 0.5;\nexport const NOISE_SCALE = 0.02;\n\n// Rarity\nexport const RARITY_TIERS = {\n  common:    { color: 0xffffff, mult: 1.0,  dropWeight: 50,   label: 'Common' },\n  uncommon:  { color: 0x00ff00, mult: 1.15, dropWeight: 25,   label: 'Uncommon' },\n  rare:      { color: 0x0088ff, mult: 1.35, dropWeight: 15,   label: 'Rare' },\n  epic:      { color: 0xaa00ff, mult: 1.6,  dropWeight: 7,    label: 'Epic' },\n  legendary: { color: 0xff8800, mult: 2.0,  dropWeight: 2.5,  label: 'Legendary' },\n  mythic:    { color: 0xff0000, mult: 2.5,  dropWeight: 0.5,  label: 'Mythic' },\n} as const;\n\n// Corruption\nexport const CORRUPTION_SPREAD_RATE = 0.001;\nexport const CORRUPTION_SLOW_THRESHOLD = 0.5;\nexport const CORRUPTION_DAMAGE_THRESHOLD = 0.8;\nexport const CORRUPTION_SPAWN_THRESHOLD = 0.95;\n\n// Settlement\nexport const MAX_SETTLEMENTS = 8;\nexport const SETTLEMENT_TIERS = ['Camp', 'Village', 'Town', 'City', 'Capital'] as const;\n\n// Rift\nexport const RIFT_HP_SCALING = 0.08;\nexport const RIFT_DMG_SCALING = 0.05;\nexport const RIFT_SPEED_SCALING_INTERVAL = 5;\nexport const RIFT_SPEED_SCALING = 0.03;\nexport const RIFT_MINIBOSS_INTERVAL = 5;\nexport const RIFT_BOSS_INTERVAL = 10;\nexport const RIFT_CHECKPOINT_INTERVAL = 10;\n\n// Save\nexport const SAVE_SLOTS = 3;\nexport const AUTOSAVE_INTERVAL_MS = 300_000; // 5 minutes\n","import Phaser from 'phaser';\nimport { GAME_WIDTH, GAME_HEIGHT, SAVE_SLOTS } from '../config';\n\n/**\n * Main menu scene — the first screen the player sees.\n * Provides New Game, Continue, and Settings options.\n */\nexport class MainMenuScene extends Phaser.Scene {\n  private buttons: Phaser.GameObjects.Text[] = [];\n\n  constructor() {\n    super({ key: 'MainMenuScene' });\n  }\n\n  create(): void {\n    const { width, height } = this.cameras.main;\n    this.cameras.main.setBackgroundColor('#0c0f1a');\n\n    // Title\n    this.add.text(width / 2, height * 0.25, 'EDILAS', {\n      fontFamily: '\"Press Start 2P\", monospace',\n      fontSize: '48px',\n      color: '#7dd3fc',\n    }).setOrigin(0.5);\n\n    // Subtitle\n    this.add.text(width / 2, height * 0.25 + 50, 'The Living Pilgrimage', {\n      fontFamily: '\"Press Start 2P\", monospace',\n      fontSize: '14px',\n      color: '#ffb347',\n    }).setOrigin(0.5);\n\n    // Menu buttons\n    const buttonY = height * 0.55;\n    const spacing = 48;\n\n    this.createButton('New Game', width / 2, buttonY, () => {\n      this.cameras.main.fadeOut(300, 0, 0, 0);\n      this.time.delayedCall(350, () => {\n        this.scene.start('BootScene', { loadSlot: undefined });\n      });\n    });\n\n    this.createButton('Continue', width / 2, buttonY + spacing, () => {\n      // Find the most recent save slot\n      let latestSlot: number | undefined;\n      let latestTime = 0;\n      for (let i = 0; i < SAVE_SLOTS; i++) {\n        const raw = localStorage.getItem(`edilas_save_${i}`);\n        if (raw) {\n          try {\n            const data = JSON.parse(raw);\n            const t = data.timestamp ?? 0;\n            if (t > latestTime) {\n              latestTime = t;\n              latestSlot = i;\n            }\n          } catch { /* skip corrupt saves */ }\n        }\n      }\n      if (latestSlot !== undefined) {\n        this.cameras.main.fadeOut(300, 0, 0, 0);\n        this.time.delayedCall(350, () => {\n          this.scene.start('BootScene', { loadSlot: latestSlot });\n        });\n      } else {\n        // No save found — flash the button\n        const btn = this.buttons[1];\n        if (btn) {\n          btn.setText('No save found!');\n          this.time.delayedCall(1500, () => btn.setText('Continue'));\n        }\n      }\n    });\n\n    this.createButton('Settings', width / 2, buttonY + spacing * 2, () => {\n      // Placeholder — settings not yet implemented\n      const btn = this.buttons[2];\n      if (btn) {\n        btn.setText('Coming soon...');\n        this.time.delayedCall(1500, () => btn.setText('Settings'));\n      }\n    });\n\n    // Version label\n    this.add.text(8, height - 20, 'v0.4.0-alpha', {\n      fontFamily: 'monospace',\n      fontSize: '10px',\n      color: '#444444',\n    });\n  }\n\n  private createButton(label: string, x: number, y: number, onClick: () => void): void {\n    const btn = this.add.text(x, y, label, {\n      fontFamily: '\"Press Start 2P\", monospace',\n      fontSize: '16px',\n      color: '#aaaaaa',\n      padding: { x: 16, y: 8 },\n    }).setOrigin(0.5).setInteractive({ useHandCursor: true });\n\n    btn.on('pointerover', () => {\n      btn.setColor('#7dd3fc');\n      btn.setScale(1.08);\n    });\n    btn.on('pointerout', () => {\n      btn.setColor('#aaaaaa');\n      btn.setScale(1);\n    });\n    btn.on('pointerdown', onClick);\n\n    this.buttons.push(btn);\n  }\n}\n","/**\n * Asset manifest — declares all asset packs by category.\n * Each pack maps texture keys to file paths under public/assets/sprites/.\n * Packs are loaded lazily by AssetManager when scenes need them.\n */\n\nexport interface AssetEntry {\n  key: string;\n  path: string;\n  /** If set, this is a spritesheet with fixed frame dimensions */\n  frameWidth?: number;\n  frameHeight?: number;\n}\n\nexport interface AssetPack {\n  name: string;\n  assets: AssetEntry[];\n}\n\n// ── Core pack: loaded at boot ──────────────────────────────────────────\n\nexport const PACK_CORE: AssetPack = {\n  name: 'core',\n  assets: [\n    // Player\n    { key: 'player', path: 'assets/sprites/characters/player_base.png' },\n\n    // Base terrain tiles (isometric)\n    { key: 'tile_grass', path: 'assets/sprites/tilesets/isometric/isometric_grass_tile_dense.png' },\n    { key: 'tile_dirt', path: 'assets/sprites/tilesets/isometric/isometric_dirt_soil_floor_base_tile.png' },\n    { key: 'tile_sand', path: 'assets/sprites/tilesets/isometric/isometric_grass_tile_autumn_yellow.png' },\n    { key: 'tile_stone', path: 'assets/sprites/tilesets/isometric/isometric_stone_block_gray_solid.png' },\n    { key: 'tile_water', path: 'assets/sprites/tilesets/isometric/isometric_deep_water_tile_full.png' },\n    { key: 'tile_snow', path: 'assets/sprites/tilesets/isometric/isometric_snow_tile_fresh_white.png' },\n    { key: 'tile_path', path: 'assets/sprites/tilesets/isometric/isometric_cobblestone_floor_regular.png' },\n    { key: 'tile_lava', path: 'assets/sprites/tilesets/isometric/isometric_stone_block_gray_cracked.png' },\n    { key: 'tile_void_tile', path: 'assets/sprites/tilesets/isometric/isometric_stone_block_gray_mossy.png' },\n    { key: 'tile_ice', path: 'assets/sprites/tilesets/isometric/isometric_ice_tile_frozen_solid.png' },\n    { key: 'tile_mud', path: 'assets/sprites/tilesets/isometric/isometric_dirt_floor_with_pebbles.png' },\n    { key: 'tile_bone', path: 'assets/sprites/tilesets/isometric/isometric_dead_grass_tile_withered.png' },\n    { key: 'tile_corruption', path: 'assets/sprites/tilesets/isometric/isometric_dead_grass_tile_brown.png' },\n    { key: 'tile_wood_floor', path: 'assets/sprites/tilesets/isometric/isometric_wooden_plank_floor_base.png' },\n\n    // Common world objects\n    { key: 'obj_tree', path: 'assets/sprites/trees/Tree01_0001.png' },\n    { key: 'obj_rock', path: 'assets/sprites/objects/isometric_rock_large_gray.png' },\n    { key: 'obj_bush', path: 'assets/sprites/objects/isometric_bush_medium_green.png' },\n    { key: 'obj_flower', path: 'assets/sprites/objects/isometric_wildflower_yellow_petals.png' },\n    { key: 'obj_tallgrass', path: 'assets/sprites/objects/isometric_tall_grass_tuft_medium.png' },\n    { key: 'obj_copper', path: 'assets/sprites/objects/isometric_rock_medium_gray.png' },\n    { key: 'obj_iron', path: 'assets/sprites/objects/isometric_rock_cluster_small.png' },\n    { key: 'obj_gold', path: 'assets/sprites/objects/isometric_rock_cluster_large.png' },\n    { key: 'obj_cactus', path: 'assets/sprites/objects/isometric_tree_stump_medium.png' },\n    { key: 'obj_deadtree', path: 'assets/sprites/objects/isometric_tree_stump_large_mossy.png' },\n    { key: 'obj_mushroom', path: 'assets/sprites/objects/isometric_mushroom_brown_single.png' },\n    { key: 'obj_crystal', path: 'assets/sprites/objects/isometric_sparkle_effect_gold.png' },\n    { key: 'obj_bonespile', path: 'assets/sprites/objects/isometric_fallen_log_horizontal.png' },\n    { key: 'obj_voidcrystal', path: 'assets/sprites/objects/isometric_sparkle_effect_white.png' },\n    { key: 'obj_watersource', path: 'assets/sprites/objects/isometric_shallow_water_tile_full.png' },\n    { key: 'obj_dungeon', path: 'assets/sprites/objects/isometric_stone_block_gray_cracked.png' },\n    { key: 'obj_riftstone', path: 'assets/sprites/objects/isometric_mushroom_white_glowing.png' },\n    { key: 'obj_city', path: 'assets/sprites/buildings/house1.png' },\n\n    // Buildings\n    { key: 'building', path: 'assets/sprites/buildings/house1.png' },\n    { key: 'building_castle', path: 'assets/sprites/buildings/castle.png' },\n    { key: 'building_barracks', path: 'assets/sprites/buildings/barracks.png' },\n    { key: 'building_stable', path: 'assets/sprites/buildings/stable.png' },\n    { key: 'building_archery', path: 'assets/sprites/buildings/archery_range.png' },\n  ],\n};\n\n// ── Enemy packs ────────────────────────────────────────────────────────\n\nexport const PACK_ENEMIES_COMMON: AssetPack = {\n  name: 'enemies_common',\n  assets: [\n    // Goblin\n    { key: 'enemy_goblin_idle', path: 'assets/sprites/enemies/Goblin/Idle.png', frameWidth: 150, frameHeight: 150 },\n    { key: 'enemy_goblin_run', path: 'assets/sprites/enemies/Goblin/Run.png', frameWidth: 150, frameHeight: 150 },\n    { key: 'enemy_goblin_attack', path: 'assets/sprites/enemies/Goblin/Attack.png', frameWidth: 150, frameHeight: 150 },\n    { key: 'enemy_goblin_hit', path: 'assets/sprites/enemies/Goblin/Take Hit.png', frameWidth: 150, frameHeight: 150 },\n    { key: 'enemy_goblin_death', path: 'assets/sprites/enemies/Goblin/Death.png', frameWidth: 150, frameHeight: 150 },\n\n    // Skeleton\n    { key: 'enemy_skeleton_idle', path: 'assets/sprites/enemies/Skeleton/Idle.png', frameWidth: 150, frameHeight: 150 },\n    { key: 'enemy_skeleton_walk', path: 'assets/sprites/enemies/Skeleton/Walk.png', frameWidth: 150, frameHeight: 150 },\n    { key: 'enemy_skeleton_attack', path: 'assets/sprites/enemies/Skeleton/Attack.png', frameWidth: 150, frameHeight: 150 },\n    { key: 'enemy_skeleton_hit', path: 'assets/sprites/enemies/Skeleton/Take Hit.png', frameWidth: 150, frameHeight: 150 },\n    { key: 'enemy_skeleton_death', path: 'assets/sprites/enemies/Skeleton/Death.png', frameWidth: 150, frameHeight: 150 },\n\n    // Mushroom\n    { key: 'enemy_mushroom_idle', path: 'assets/sprites/enemies/Mushroom/Idle.png', frameWidth: 150, frameHeight: 150 },\n    { key: 'enemy_mushroom_run', path: 'assets/sprites/enemies/Mushroom/Run.png', frameWidth: 150, frameHeight: 150 },\n    { key: 'enemy_mushroom_attack', path: 'assets/sprites/enemies/Mushroom/Attack.png', frameWidth: 150, frameHeight: 150 },\n    { key: 'enemy_mushroom_hit', path: 'assets/sprites/enemies/Mushroom/Take Hit.png', frameWidth: 150, frameHeight: 150 },\n    { key: 'enemy_mushroom_death', path: 'assets/sprites/enemies/Mushroom/Death.png', frameWidth: 150, frameHeight: 150 },\n\n    // Flying eye\n    { key: 'enemy_flyingeye_flight', path: 'assets/sprites/enemies/Flying eye/Flight.png', frameWidth: 150, frameHeight: 150 },\n    { key: 'enemy_flyingeye_attack', path: 'assets/sprites/enemies/Flying eye/Attack.png', frameWidth: 150, frameHeight: 150 },\n    { key: 'enemy_flyingeye_hit', path: 'assets/sprites/enemies/Flying eye/Take Hit.png', frameWidth: 150, frameHeight: 150 },\n    { key: 'enemy_flyingeye_death', path: 'assets/sprites/enemies/Flying eye/Death.png', frameWidth: 150, frameHeight: 150 },\n  ],\n};\n\n// ── Boss packs ─────────────────────────────────────────────────────────\n\nexport const PACK_BOSS_FIRE: AssetPack = {\n  name: 'boss_fire_demon',\n  assets: [\n    { key: 'boss_fire_idle', path: 'assets/sprites/bosses/fire_demon/Idle_Body_000.png' },\n    { key: 'boss_fire_attack', path: 'assets/sprites/bosses/fire_demon/Attack_Punch_Body_000.png' },\n    { key: 'boss_fire_run', path: 'assets/sprites/bosses/fire_demon/Run_Body_000.png' },\n    { key: 'boss_fire_death', path: 'assets/sprites/bosses/fire_demon/Death_Body_000.png' },\n    { key: 'boss_fire_hit', path: 'assets/sprites/bosses/fire_demon/Hit_Body_000.png' },\n  ],\n};\n\nexport const PACK_BOSS_ICE: AssetPack = {\n  name: 'boss_ice_demon',\n  assets: [\n    { key: 'boss_ice_idle', path: 'assets/sprites/bosses/ice_demon/Idle_Body_000.png' },\n    { key: 'boss_ice_attack', path: 'assets/sprites/bosses/ice_demon/Attack_Punch_Body_000.png' },\n    { key: 'boss_ice_run', path: 'assets/sprites/bosses/ice_demon/Run_Body_000.png' },\n    { key: 'boss_ice_death', path: 'assets/sprites/bosses/ice_demon/Death_Body_000.png' },\n    { key: 'boss_ice_hit', path: 'assets/sprites/bosses/ice_demon/Hit_Body_000.png' },\n  ],\n};\n\nexport const PACK_BOSS_BIRD: AssetPack = {\n  name: 'boss_bird',\n  assets: [\n    { key: 'boss_bird_idle', path: 'assets/sprites/bosses/bird/Idle_Body_000.png' },\n    { key: 'boss_bird_attack', path: 'assets/sprites/bosses/bird/Attack_Punch_Body_000.png' },\n    { key: 'boss_bird_run', path: 'assets/sprites/bosses/bird/Run_Body_000.png' },\n    { key: 'boss_bird_death', path: 'assets/sprites/bosses/bird/Death_Body_000.png' },\n    { key: 'boss_bird_hit', path: 'assets/sprites/bosses/bird/Hit_Body_000.png' },\n  ],\n};\n\n// ── Biome-specific decoration packs ────────────────────────────────────\n\nexport const PACK_BIOME_HAVEN: AssetPack = {\n  name: 'biome_haven',\n  assets: [\n    { key: 'tile_grass_flowers', path: 'assets/sprites/tilesets/isometric/isometric_grass_tile_mixed_flowers.png' },\n    { key: 'tile_grass_sparse', path: 'assets/sprites/tilesets/isometric/isometric_grass_tile_sparse.png' },\n    { key: 'tile_grass_clover', path: 'assets/sprites/tilesets/isometric/isometric_grass_tile_with_clover.png' },\n    { key: 'obj_flower_blue', path: 'assets/sprites/objects/isometric_wildflower_blue_petals.png' },\n    { key: 'obj_flower_red', path: 'assets/sprites/objects/isometric_wildflower_red_petals.png' },\n    { key: 'obj_flower_purple', path: 'assets/sprites/objects/isometric_wildflower_purple_petals.png' },\n    { key: 'obj_bush_large', path: 'assets/sprites/objects/isometric_bush_large_green.png' },\n    { key: 'obj_bush_small', path: 'assets/sprites/objects/isometric_bush_small_green.png' },\n  ],\n};\n\nexport const PACK_BIOME_ROTWOOD: AssetPack = {\n  name: 'biome_rotwood',\n  assets: [\n    { key: 'tile_grass_autumn', path: 'assets/sprites/tilesets/isometric/isometric_grass_tile_autumn_orange.png' },\n    { key: 'tile_grass_autumn_red', path: 'assets/sprites/tilesets/isometric/isometric_grass_tile_autumn_red.png' },\n    { key: 'obj_mushroom_red', path: 'assets/sprites/objects/isometric_mushroom_red_spotted_single.png' },\n    { key: 'obj_mushroom_cluster', path: 'assets/sprites/objects/isometric_mushroom_red_spotted_cluster.png' },\n    { key: 'obj_fallen_log', path: 'assets/sprites/objects/isometric_fallen_log_diagonal.png' },\n    { key: 'obj_tree_stump', path: 'assets/sprites/objects/isometric_tree_stump_small.png' },\n  ],\n};\n\nexport const PACK_BIOME_ASHLANDS: AssetPack = {\n  name: 'biome_ashlands',\n  assets: [\n    { key: 'tile_dead_grass', path: 'assets/sprites/tilesets/isometric/isometric_dead_grass_tile_brown.png' },\n    { key: 'tile_cobblestone_weathered', path: 'assets/sprites/tilesets/isometric/isometric_cobblestone_floor_weathered.png' },\n  ],\n};\n\nexport const PACK_BIOME_DROWNED: AssetPack = {\n  name: 'biome_drowned',\n  assets: [\n    { key: 'tile_shallow_water', path: 'assets/sprites/tilesets/isometric/isometric_shallow_water_tile_full.png' },\n    { key: 'tile_water_shore_n', path: 'assets/sprites/tilesets/isometric/isometric_deep_water_tile_shore_north.png' },\n    { key: 'tile_water_shore_s', path: 'assets/sprites/tilesets/isometric/isometric_deep_water_tile_shore_south.png' },\n    { key: 'tile_water_shore_e', path: 'assets/sprites/tilesets/isometric/isometric_deep_water_tile_shore_east.png' },\n    { key: 'tile_water_shore_w', path: 'assets/sprites/tilesets/isometric/isometric_deep_water_tile_shore_west.png' },\n  ],\n};\n\nexport const PACK_BIOME_ICE: AssetPack = {\n  name: 'biome_ice',\n  assets: [\n    { key: 'tile_ice_cracked', path: 'assets/sprites/tilesets/isometric/isometric_ice_tile_frozen_cracked.png' },\n    { key: 'tile_ice_snow', path: 'assets/sprites/tilesets/isometric/isometric_ice_tile_with_snow.png' },\n    { key: 'tile_snow_packed', path: 'assets/sprites/tilesets/isometric/isometric_snow_tile_packed.png' },\n    { key: 'tile_snow_footprints', path: 'assets/sprites/tilesets/isometric/isometric_snow_tile_with_footprints.png' },\n  ],\n};\n\n// ── Dungeon pack ───────────────────────────────────────────────────────\n\nexport const PACK_DUNGEON: AssetPack = {\n  name: 'dungeon',\n  assets: [\n    { key: 'dungeon_floor', path: 'assets/sprites/dungeon/evildungeon_0.png' },\n    { key: 'dungeon_fountain', path: 'assets/sprites/dungeon/blood-fountain.png' },\n    { key: 'dungeon_demon', path: 'assets/sprites/dungeon/demon-purple.png' },\n    { key: 'dungeon_drain', path: 'assets/sprites/dungeon/drain-blood.png' },\n    { key: 'dungeon_pentagram', path: 'assets/sprites/dungeon/pentagramm.png' },\n    { key: 'dungeon_spikes', path: 'assets/sprites/dungeon/spikes_2.png' },\n    { key: 'dungeon_scythe', path: 'assets/sprites/dungeon/swinging_scythe-correct.png' },\n  ],\n};\n\n// ── Food pack ──────────────────────────────────────────────────────────\n\nexport const PACK_FOOD: AssetPack = {\n  name: 'food',\n  assets: [\n    { key: 'food_apple', path: 'assets/sprites/food/Apple.png' },\n    { key: 'food_bread', path: 'assets/sprites/food/Bread.png' },\n    { key: 'food_cheese', path: 'assets/sprites/food/Cheese.png' },\n    { key: 'food_chicken', path: 'assets/sprites/food/ChickenLeg.png' },\n    { key: 'food_fish', path: 'assets/sprites/food/Fish.png' },\n    { key: 'food_steak', path: 'assets/sprites/food/Steak.png' },\n    { key: 'food_potato', path: 'assets/sprites/food/Potato.png' },\n    { key: 'food_mushroom', path: 'assets/sprites/food/Mushroom.png' },\n    { key: 'food_cookie', path: 'assets/sprites/food/Cookie.png' },\n    { key: 'food_pie', path: 'assets/sprites/food/PieApple.png' },\n    { key: 'food_beer', path: 'assets/sprites/food/Beer.png' },\n    { key: 'food_wine', path: 'assets/sprites/food/Wine.png' },\n  ],\n};\n\n// ── Effects pack ───────────────────────────────────────────────────────\n\nexport const PACK_EFFECTS: AssetPack = {\n  name: 'effects',\n  assets: [\n    { key: 'fx_fire_swoosh', path: 'assets/sprites/effects/fire_swoosh_attack_trail.png', frameWidth: 128, frameHeight: 128 },\n    { key: 'fx_slash_cross', path: 'assets/sprites/effects/slash_cross_hit_impact.png', frameWidth: 128, frameHeight: 128 },\n    { key: 'fx_wind_slash', path: 'assets/sprites/effects/wind_slash_quick_attack.png', frameWidth: 128, frameHeight: 128 },\n    { key: 'fx_sparkle_burst', path: 'assets/sprites/effects/sparkle_burst_collect_item.png', frameWidth: 128, frameHeight: 128 },\n    { key: 'fx_smoke_poof', path: 'assets/sprites/effects/smoke_poof_disappear_effect.png', frameWidth: 128, frameHeight: 128 },\n    { key: 'fx_portal', path: 'assets/sprites/effects/portal_ring_teleport_effect.png', frameWidth: 128, frameHeight: 128 },\n    { key: 'fx_dust_puff', path: 'assets/sprites/effects/dust_puff_small_impact.png', frameWidth: 64, frameHeight: 64 },\n  ],\n};\n\n// ── All packs registry ─────────────────────────────────────────────────\n\nexport const ALL_PACKS: Record<string, AssetPack> = {\n  core: PACK_CORE,\n  enemies_common: PACK_ENEMIES_COMMON,\n  boss_fire_demon: PACK_BOSS_FIRE,\n  boss_ice_demon: PACK_BOSS_ICE,\n  boss_bird: PACK_BOSS_BIRD,\n  biome_haven: PACK_BIOME_HAVEN,\n  biome_rotwood: PACK_BIOME_ROTWOOD,\n  biome_ashlands: PACK_BIOME_ASHLANDS,\n  biome_drowned: PACK_BIOME_DROWNED,\n  biome_ice: PACK_BIOME_ICE,\n  dungeon: PACK_DUNGEON,\n  food: PACK_FOOD,\n  effects: PACK_EFFECTS,\n};\n","/**\n * Singleton asset manager with pack-based lazy loading.\n * Loads real sprites over placeholder textures generated by BootScene.\n */\n\nimport Phaser from 'phaser';\nimport { AssetPack, AssetEntry, ALL_PACKS } from './AssetManifest';\n\nexport class AssetManager {\n  private static instance: AssetManager;\n\n  private loadedPacks = new Set<string>();\n  private loadingPacks = new Set<string>();\n\n  private constructor() {}\n\n  static getInstance(): AssetManager {\n    if (!AssetManager.instance) {\n      AssetManager.instance = new AssetManager();\n    }\n    return AssetManager.instance;\n  }\n\n  /** Check if a pack is already loaded */\n  isPackLoaded(packName: string): boolean {\n    return this.loadedPacks.has(packName);\n  }\n\n  /**\n   * Load one or more asset packs in the given scene.\n   * Skips already-loaded packs. Returns a promise that resolves when all are loaded.\n   */\n  async loadPacks(scene: Phaser.Scene, packNames: string[]): Promise<void> {\n    const toLoad = packNames.filter(\n      (name) => !this.loadedPacks.has(name) && !this.loadingPacks.has(name) && ALL_PACKS[name]\n    );\n    if (toLoad.length === 0) return;\n\n    for (const name of toLoad) {\n      this.loadingPacks.add(name);\n      const pack = ALL_PACKS[name];\n      for (const asset of pack.assets) {\n        this.queueAsset(scene, asset);\n      }\n    }\n\n    return new Promise<void>((resolve) => {\n      scene.load.once('complete', () => {\n        for (const name of toLoad) {\n          this.loadedPacks.add(name);\n          this.loadingPacks.delete(name);\n        }\n        resolve();\n      });\n      scene.load.start();\n    });\n  }\n\n  /**\n   * Load the core pack synchronously during a scene's preload().\n   * Since this is called inside preload(), Phaser's loader auto-starts.\n   */\n  loadCorePack(scene: Phaser.Scene): void {\n    if (this.loadedPacks.has('core')) return;\n    this.loadingPacks.add('core');\n\n    const pack = ALL_PACKS['core'];\n    for (const asset of pack.assets) {\n      this.queueAsset(scene, asset);\n    }\n\n    // Mark as loaded when Phaser's loader completes (it runs automatically in preload)\n    scene.load.once('complete', () => {\n      this.loadedPacks.add('core');\n      this.loadingPacks.delete('core');\n    });\n  }\n\n  private queueAsset(scene: Phaser.Scene, asset: AssetEntry): void {\n    if (asset.frameWidth && asset.frameHeight) {\n      scene.load.spritesheet(asset.key, asset.path, {\n        frameWidth: asset.frameWidth,\n        frameHeight: asset.frameHeight,\n      });\n    } else {\n      scene.load.image(asset.key, asset.path);\n    }\n  }\n\n  /** Reset state (useful for scene restarts or testing) */\n  reset(): void {\n    this.loadedPacks.clear();\n    this.loadingPacks.clear();\n  }\n}\n","import Phaser from 'phaser';\nimport { AssetManager } from '../assets/AssetManager';\n\ninterface BootSceneData {\n  loadSlot?: number;\n}\n\nexport class BootScene extends Phaser.Scene {\n  private loadSlot?: number;\n\n  constructor() {\n    super({ key: 'BootScene' });\n  }\n\n  init(data: BootSceneData): void {\n    this.loadSlot = data.loadSlot;\n  }\n\n  preload(): void {\n    // Progress bar\n    const { width, height } = this.cameras.main;\n    const barX = width / 2 - 160;\n    const barY = height / 2;\n    const barW = 320;\n    const barH = 24;\n\n    const border = this.add.rectangle(width / 2, barY, barW + 4, barH + 4, 0x333333);\n    border.setStrokeStyle(2, 0x7dd3fc);\n    const fill = this.add.rectangle(barX + 2, barY, 0, barH, 0x7dd3fc);\n    fill.setOrigin(0, 0.5);\n\n    const titleText = this.add.text(width / 2, barY - 60, 'EDILAS', {\n      fontFamily: '\"Press Start 2P\", monospace',\n      fontSize: '32px',\n      color: '#7dd3fc',\n    });\n    titleText.setOrigin(0.5);\n\n    const subtitleText = this.add.text(width / 2, barY - 30, 'The Living Pilgrimage', {\n      fontFamily: '\"Press Start 2P\", monospace',\n      fontSize: '12px',\n      color: '#ffb347',\n    });\n    subtitleText.setOrigin(0.5);\n\n    const loadingText = this.add.text(width / 2, barY + 30, 'Loading...', {\n      fontFamily: 'monospace',\n      fontSize: '14px',\n      color: '#aaaaaa',\n    });\n    loadingText.setOrigin(0.5);\n\n    this.load.on('progress', (value: number) => {\n      fill.width = barW * value;\n      loadingText.setText(`Loading... ${Math.round(value * 100)}%`);\n    });\n\n    this.load.on('complete', () => {\n      loadingText.setText('Ready!');\n    });\n\n    // 1) Generate placeholder textures for ALL keys (instant colored squares)\n    this.createPlaceholderAssets();\n\n    // 2) Queue real sprites — they'll overwrite the placeholders once loaded\n    AssetManager.getInstance().loadCorePack(this);\n  }\n\n  create(): void {\n    // Transition to game\n    this.time.delayedCall(500, () => {\n      this.scene.start('OverworldScene', { loadSlot: this.loadSlot });\n      this.scene.launch('UIScene');\n    });\n  }\n\n  private createPlaceholderAssets(): void {\n    const gfx = this.add.graphics();\n    gfx.setVisible(false);\n\n    // ── Player placeholder (16x16 cyan square) ──\n    gfx.clear();\n    gfx.fillStyle(0x7dd3fc);\n    gfx.fillRect(0, 0, 16, 16);\n    gfx.generateTexture('player', 16, 16);\n\n    // ── Tile placeholders (isometric diamonds) ──\n    const tileColors: Record<string, number> = {\n      grass: 0x4a7c3f,\n      dirt: 0x8b6914,\n      sand: 0xdbc07c,\n      stone: 0x888888,\n      water: 0x2266aa,\n      snow: 0xddddee,\n      path: 0xaa8855,\n      lava: 0xff4400,\n      void_tile: 0x220033,\n      ice: 0xaaddff,\n      mud: 0x665533,\n      bone: 0xccbb99,\n      corruption: 0x440066,\n      wood_floor: 0x996633,\n    };\n\n    for (const [name, color] of Object.entries(tileColors)) {\n      gfx.clear();\n      gfx.fillStyle(color);\n      gfx.beginPath();\n      gfx.moveTo(32, 0);\n      gfx.lineTo(64, 16);\n      gfx.lineTo(32, 32);\n      gfx.lineTo(0, 16);\n      gfx.closePath();\n      gfx.fillPath();\n      gfx.lineStyle(1, 0x000000, 0.2);\n      gfx.beginPath();\n      gfx.moveTo(32, 0);\n      gfx.lineTo(64, 16);\n      gfx.lineTo(32, 32);\n      gfx.lineTo(0, 16);\n      gfx.closePath();\n      gfx.strokePath();\n      gfx.generateTexture(`tile_${name}`, 64, 32);\n    }\n\n    // ── Object placeholders ──\n    const objPlaceholders: Record<string, { color: number; size: number }> = {\n      obj_tree:        { color: 0x228b22, size: 20 },\n      obj_rock:        { color: 0x777777, size: 14 },\n      obj_bush:        { color: 0x33aa33, size: 12 },\n      obj_flower:      { color: 0xffdd44, size: 8 },\n      obj_tallgrass:   { color: 0x66bb66, size: 10 },\n      obj_copper:      { color: 0xcc7733, size: 14 },\n      obj_iron:        { color: 0x999999, size: 14 },\n      obj_gold:        { color: 0xffcc00, size: 14 },\n      obj_cactus:      { color: 0x44aa44, size: 16 },\n      obj_deadtree:    { color: 0x886644, size: 18 },\n      obj_mushroom:    { color: 0xcc6633, size: 10 },\n      obj_crystal:     { color: 0x66ccff, size: 12 },\n      obj_bonespile:   { color: 0xddccaa, size: 12 },\n      obj_voidcrystal: { color: 0xaa44ff, size: 14 },\n      obj_watersource: { color: 0x4488cc, size: 16 },\n      obj_dungeon:     { color: 0x442266, size: 18 },\n      obj_riftstone:   { color: 0x8844ff, size: 16 },\n      obj_city:        { color: 0xbb9966, size: 20 },\n    };\n\n    for (const [key, { color, size }] of Object.entries(objPlaceholders)) {\n      gfx.clear();\n      gfx.fillStyle(color);\n      gfx.fillRect(0, 0, size, size);\n      gfx.generateTexture(key, size, size);\n    }\n\n    // ── Enemy placeholder (16x16 red square) ──\n    gfx.clear();\n    gfx.fillStyle(0xff4444);\n    gfx.fillRect(0, 0, 16, 16);\n    gfx.generateTexture('enemy', 16, 16);\n\n    // ── NPC placeholder (16x16 green square) ──\n    gfx.clear();\n    gfx.fillStyle(0x44ff44);\n    gfx.fillRect(0, 0, 16, 16);\n    gfx.generateTexture('npc', 16, 16);\n\n    // ── Item placeholder (12x12 yellow square) ──\n    gfx.clear();\n    gfx.fillStyle(0xffcc00);\n    gfx.fillRect(0, 0, 12, 12);\n    gfx.generateTexture('item_drop', 12, 12);\n\n    // ── Projectile placeholder (8x8 white circle) ──\n    gfx.clear();\n    gfx.fillStyle(0xffffff);\n    gfx.fillCircle(4, 4, 4);\n    gfx.generateTexture('projectile', 8, 8);\n\n    // ── Boss placeholder (32x32 purple square) ──\n    gfx.clear();\n    gfx.fillStyle(0xaa44ff);\n    gfx.fillRect(0, 0, 32, 32);\n    gfx.lineStyle(2, 0xff88ff, 1);\n    gfx.strokeRect(0, 0, 32, 32);\n    gfx.generateTexture('boss', 32, 32);\n\n    // ── Building placeholder (24x24 brown square) ──\n    gfx.clear();\n    gfx.fillStyle(0x886644);\n    gfx.fillRect(0, 0, 24, 24);\n    gfx.lineStyle(1, 0xccaa88, 0.6);\n    gfx.strokeRect(0, 0, 24, 24);\n    gfx.generateTexture('building', 24, 24);\n\n    // ── Chest placeholder (14x14 gold square) ──\n    gfx.clear();\n    gfx.fillStyle(0xcc8822);\n    gfx.fillRect(0, 0, 14, 14);\n    gfx.lineStyle(1, 0xffcc44, 0.8);\n    gfx.strokeRect(0, 0, 14, 14);\n    gfx.generateTexture('chest', 14, 14);\n\n    // ── Particle texture (4x4 white) ──\n    gfx.clear();\n    gfx.fillStyle(0xffffff);\n    gfx.fillRect(0, 0, 4, 4);\n    gfx.generateTexture('particle', 4, 4);\n\n    // ── Rift portal placeholder (20x20 swirly purple) ──\n    gfx.clear();\n    gfx.fillStyle(0x6622cc);\n    gfx.fillCircle(10, 10, 10);\n    gfx.lineStyle(2, 0xaa66ff, 0.8);\n    gfx.strokeCircle(10, 10, 10);\n    gfx.generateTexture('rift_portal', 20, 20);\n\n    // ── Shadow overlay placeholder ──\n    gfx.clear();\n    gfx.fillStyle(0x110022, 0.5);\n    gfx.fillRect(0, 0, 32, 32);\n    gfx.generateTexture('shadow_overlay', 32, 32);\n\n    gfx.destroy();\n  }\n}\n","// src/Constants.js\nvar TYPES_ENUM = {\n  i8: \"i8\",\n  ui8: \"ui8\",\n  ui8c: \"ui8c\",\n  i16: \"i16\",\n  ui16: \"ui16\",\n  i32: \"i32\",\n  ui32: \"ui32\",\n  f32: \"f32\",\n  f64: \"f64\",\n  eid: \"eid\"\n};\nvar TYPES_NAMES = {\n  i8: \"Int8\",\n  ui8: \"Uint8\",\n  ui8c: \"Uint8Clamped\",\n  i16: \"Int16\",\n  ui16: \"Uint16\",\n  i32: \"Int32\",\n  ui32: \"Uint32\",\n  eid: \"Uint32\",\n  f32: \"Float32\",\n  f64: \"Float64\"\n};\nvar TYPES = {\n  i8: Int8Array,\n  ui8: Uint8Array,\n  ui8c: Uint8ClampedArray,\n  i16: Int16Array,\n  ui16: Uint16Array,\n  i32: Int32Array,\n  ui32: Uint32Array,\n  f32: Float32Array,\n  f64: Float64Array,\n  eid: Uint32Array\n};\nvar UNSIGNED_MAX = {\n  uint8: 2 ** 8,\n  uint16: 2 ** 16,\n  uint32: 2 ** 32\n};\n\n// src/Storage.js\nvar roundToMultiple = (mul) => (x) => Math.ceil(x / mul) * mul;\nvar roundToMultiple4 = roundToMultiple(4);\nvar $storeRef = Symbol(\"storeRef\");\nvar $storeSize = Symbol(\"storeSize\");\nvar $storeMaps = Symbol(\"storeMaps\");\nvar $storeFlattened = Symbol(\"storeFlattened\");\nvar $storeBase = Symbol(\"storeBase\");\nvar $storeType = Symbol(\"storeType\");\nvar $storeArrayElementCounts = Symbol(\"storeArrayElementCounts\");\nvar $storeSubarrays = Symbol(\"storeSubarrays\");\nvar $subarrayCursors = Symbol(\"subarrayCursors\");\nvar $subarray = Symbol(\"subarray\");\nvar $subarrayFrom = Symbol(\"subarrayFrom\");\nvar $subarrayTo = Symbol(\"subarrayTo\");\nvar $parentArray = Symbol(\"parentArray\");\nvar $tagStore = Symbol(\"tagStore\");\nvar $queryShadow = Symbol(\"queryShadow\");\nvar $serializeShadow = Symbol(\"serializeShadow\");\nvar $indexType = Symbol(\"indexType\");\nvar $indexBytes = Symbol(\"indexBytes\");\nvar $isEidType = Symbol(\"isEidType\");\nvar stores = {};\nvar resize = (ta, size) => {\n  const newBuffer = new ArrayBuffer(size * ta.BYTES_PER_ELEMENT);\n  const newTa = new ta.constructor(newBuffer);\n  newTa.set(ta, 0);\n  return newTa;\n};\nvar createShadow = (store, key) => {\n  if (!ArrayBuffer.isView(store)) {\n    const shadowStore = store[$parentArray].slice(0);\n    store[key] = store.map((_, eid) => {\n      const { length } = store[eid];\n      const start = length * eid;\n      const end = start + length;\n      return shadowStore.subarray(start, end);\n    });\n  } else {\n    store[key] = store.slice(0);\n  }\n};\nvar resetStoreFor = (store, eid) => {\n  if (store[$storeFlattened]) {\n    store[$storeFlattened].forEach((ta) => {\n      if (ArrayBuffer.isView(ta))\n        ta[eid] = 0;\n      else\n        ta[eid].fill(0);\n    });\n  }\n};\nvar createTypeStore = (type, length) => {\n  const totalBytes = length * TYPES[type].BYTES_PER_ELEMENT;\n  const buffer = new ArrayBuffer(totalBytes);\n  const store = new TYPES[type](buffer);\n  store[$isEidType] = type === TYPES_ENUM.eid;\n  return store;\n};\nvar parentArray = (store) => store[$parentArray];\nvar createArrayStore = (metadata, type, length) => {\n  const storeSize = metadata[$storeSize];\n  const store = Array(storeSize).fill(0);\n  store[$storeType] = type;\n  store[$isEidType] = type === TYPES_ENUM.eid;\n  const cursors = metadata[$subarrayCursors];\n  const indexType = length <= UNSIGNED_MAX.uint8 ? TYPES_ENUM.ui8 : length <= UNSIGNED_MAX.uint16 ? TYPES_ENUM.ui16 : TYPES_ENUM.ui32;\n  if (!length)\n    throw new Error(\"bitECS - Must define component array length\");\n  if (!TYPES[type])\n    throw new Error(`bitECS - Invalid component array property type ${type}`);\n  if (!metadata[$storeSubarrays][type]) {\n    const arrayElementCount = metadata[$storeArrayElementCounts][type];\n    const array = new TYPES[type](roundToMultiple4(arrayElementCount * storeSize));\n    array[$indexType] = TYPES_NAMES[indexType];\n    array[$indexBytes] = TYPES[indexType].BYTES_PER_ELEMENT;\n    metadata[$storeSubarrays][type] = array;\n  }\n  const start = cursors[type];\n  const end = start + storeSize * length;\n  cursors[type] = end;\n  store[$parentArray] = metadata[$storeSubarrays][type].subarray(start, end);\n  for (let eid = 0; eid < storeSize; eid++) {\n    const start2 = length * eid;\n    const end2 = start2 + length;\n    store[eid] = store[$parentArray].subarray(start2, end2);\n    store[eid][$indexType] = TYPES_NAMES[indexType];\n    store[eid][$indexBytes] = TYPES[indexType].BYTES_PER_ELEMENT;\n    store[eid][$subarray] = true;\n  }\n  return store;\n};\nvar isArrayType = (x) => Array.isArray(x) && typeof x[0] === \"string\" && typeof x[1] === \"number\";\nvar createStore = (schema, size) => {\n  const $store = Symbol(\"store\");\n  if (!schema || !Object.keys(schema).length) {\n    stores[$store] = {\n      [$storeSize]: size,\n      [$tagStore]: true,\n      [$storeBase]: () => stores[$store]\n    };\n    return stores[$store];\n  }\n  schema = JSON.parse(JSON.stringify(schema));\n  const arrayElementCounts = {};\n  const collectArrayElementCounts = (s) => {\n    const keys = Object.keys(s);\n    for (const k of keys) {\n      if (isArrayType(s[k])) {\n        if (!arrayElementCounts[s[k][0]])\n          arrayElementCounts[s[k][0]] = 0;\n        arrayElementCounts[s[k][0]] += s[k][1];\n      } else if (s[k] instanceof Object) {\n        collectArrayElementCounts(s[k]);\n      }\n    }\n  };\n  collectArrayElementCounts(schema);\n  const metadata = {\n    [$storeSize]: size,\n    [$storeMaps]: {},\n    [$storeSubarrays]: {},\n    [$storeRef]: $store,\n    [$subarrayCursors]: Object.keys(TYPES).reduce((a, type) => ({ ...a, [type]: 0 }), {}),\n    [$storeFlattened]: [],\n    [$storeArrayElementCounts]: arrayElementCounts\n  };\n  if (schema instanceof Object && Object.keys(schema).length) {\n    const recursiveTransform = (a, k) => {\n      if (typeof a[k] === \"string\") {\n        a[k] = createTypeStore(a[k], size);\n        a[k][$storeBase] = () => stores[$store];\n        metadata[$storeFlattened].push(a[k]);\n      } else if (isArrayType(a[k])) {\n        const [type, length] = a[k];\n        a[k] = createArrayStore(metadata, type, length);\n        a[k][$storeBase] = () => stores[$store];\n        metadata[$storeFlattened].push(a[k]);\n      } else if (a[k] instanceof Object) {\n        a[k] = Object.keys(a[k]).reduce(recursiveTransform, a[k]);\n      }\n      return a;\n    };\n    stores[$store] = Object.assign(Object.keys(schema).reduce(recursiveTransform, schema), metadata);\n    stores[$store][$storeBase] = () => stores[$store];\n    return stores[$store];\n  }\n};\n\n// src/Util.js\nvar SparseSet = () => {\n  const dense = [];\n  const sparse = [];\n  dense.sort = function(comparator) {\n    const result = Array.prototype.sort.call(this, comparator);\n    for (let i = 0; i < dense.length; i++) {\n      sparse[dense[i]] = i;\n    }\n    return result;\n  };\n  const has = (val) => dense[sparse[val]] === val;\n  const add = (val) => {\n    if (has(val))\n      return;\n    sparse[val] = dense.push(val) - 1;\n  };\n  const remove = (val) => {\n    if (!has(val))\n      return;\n    const index = sparse[val];\n    const swapped = dense.pop();\n    if (swapped !== val) {\n      dense[index] = swapped;\n      sparse[swapped] = index;\n    }\n  };\n  const reset = () => {\n    dense.length = 0;\n    sparse.length = 0;\n  };\n  return {\n    add,\n    remove,\n    has,\n    sparse,\n    dense,\n    reset\n  };\n};\n\n// src/Serialize.js\nvar DESERIALIZE_MODE = {\n  REPLACE: 0,\n  APPEND: 1,\n  MAP: 2\n};\nvar resized = false;\nvar setSerializationResized = (v) => {\n  resized = v;\n};\nvar concat = (a, v) => a.concat(v);\nvar not = (fn) => (v) => !fn(v);\nvar storeFlattened = (c) => c[$storeFlattened];\nvar isFullComponent = storeFlattened;\nvar isProperty = not(isFullComponent);\nvar isModifier = (c) => typeof c === \"function\" && c[$modifier];\nvar isNotModifier = not(isModifier);\nvar isChangedModifier = (c) => isModifier(c) && c()[1] === \"changed\";\nvar isWorld = (w) => Object.getOwnPropertySymbols(w).includes($componentMap);\nvar fromModifierToComponent = (c) => c()[0];\nvar canonicalize = (target) => {\n  if (isWorld(target))\n    return [[], /* @__PURE__ */ new Map()];\n  const fullComponentProps = target.filter(isNotModifier).filter(isFullComponent).map(storeFlattened).reduce(concat, []);\n  const changedComponentProps = target.filter(isChangedModifier).map(fromModifierToComponent).filter(isFullComponent).map(storeFlattened).reduce(concat, []);\n  const props = target.filter(isNotModifier).filter(isProperty);\n  const changedProps = target.filter(isChangedModifier).map(fromModifierToComponent).filter(isProperty);\n  const componentProps = [...fullComponentProps, ...props, ...changedComponentProps, ...changedProps];\n  const allChangedProps = [...changedComponentProps, ...changedProps].reduce((map, prop) => {\n    const $ = Symbol();\n    createShadow(prop, $);\n    map.set(prop, $);\n    return map;\n  }, /* @__PURE__ */ new Map());\n  return [componentProps, allChangedProps];\n};\nvar defineSerializer = (target, maxBytes = 2e7) => {\n  const worldSerializer = isWorld(target);\n  let [componentProps, changedProps] = canonicalize(target);\n  const buffer = new ArrayBuffer(maxBytes);\n  const view = new DataView(buffer);\n  const entityComponentCache = /* @__PURE__ */ new Map();\n  return (ents) => {\n    if (resized) {\n      [componentProps, changedProps] = canonicalize(target);\n      resized = false;\n    }\n    if (worldSerializer) {\n      componentProps = [];\n      target[$componentMap].forEach((c, component) => {\n        if (component[$storeFlattened])\n          componentProps.push(...component[$storeFlattened]);\n        else\n          componentProps.push(component);\n      });\n    }\n    let world;\n    if (Object.getOwnPropertySymbols(ents).includes($componentMap)) {\n      world = ents;\n      ents = ents[$entityArray];\n    } else {\n      world = eidToWorld.get(ents[0]);\n    }\n    let where = 0;\n    if (!ents.length)\n      return buffer.slice(0, where);\n    const cache = /* @__PURE__ */ new Map();\n    for (let pid = 0; pid < componentProps.length; pid++) {\n      const prop = componentProps[pid];\n      const component = prop[$storeBase]();\n      const $diff = changedProps.get(prop);\n      const shadow = $diff ? prop[$diff] : null;\n      if (!cache.has(component))\n        cache.set(component, /* @__PURE__ */ new Map());\n      view.setUint8(where, pid);\n      where += 1;\n      const countWhere = where;\n      where += 4;\n      let writeCount = 0;\n      for (let i = 0; i < ents.length; i++) {\n        const eid = ents[i];\n        let componentCache = entityComponentCache.get(eid);\n        if (!componentCache)\n          componentCache = entityComponentCache.set(eid, /* @__PURE__ */ new Set()).get(eid);\n        componentCache.add(eid);\n        const newlyAddedComponent = shadow && cache.get(component).get(eid) || !componentCache.has(component) && hasComponent(world, component, eid);\n        cache.get(component).set(eid, newlyAddedComponent);\n        if (newlyAddedComponent) {\n          componentCache.add(component);\n        } else if (!hasComponent(world, component, eid)) {\n          componentCache.delete(component);\n          continue;\n        }\n        const rewindWhere = where;\n        view.setUint32(where, eid);\n        where += 4;\n        if (prop[$tagStore]) {\n          writeCount++;\n          continue;\n        }\n        if (ArrayBuffer.isView(prop[eid])) {\n          const type = prop[eid].constructor.name.replace(\"Array\", \"\");\n          const indexType = prop[eid][$indexType];\n          const indexBytes = prop[eid][$indexBytes];\n          const countWhere2 = where;\n          where += indexBytes;\n          let arrayWriteCount = 0;\n          for (let i2 = 0; i2 < prop[eid].length; i2++) {\n            if (shadow) {\n              const changed = shadow[eid][i2] !== prop[eid][i2];\n              shadow[eid][i2] = prop[eid][i2];\n              if (!changed && !newlyAddedComponent) {\n                continue;\n              }\n            }\n            view[`set${indexType}`](where, i2);\n            where += indexBytes;\n            const value = prop[eid][i2];\n            view[`set${type}`](where, value);\n            where += prop[eid].BYTES_PER_ELEMENT;\n            arrayWriteCount++;\n          }\n          if (arrayWriteCount > 0) {\n            view[`set${indexType}`](countWhere2, arrayWriteCount);\n            writeCount++;\n          } else {\n            where = rewindWhere;\n            continue;\n          }\n        } else {\n          if (shadow) {\n            const changed = shadow[eid] !== prop[eid];\n            shadow[eid] = prop[eid];\n            if (!changed && !newlyAddedComponent) {\n              where = rewindWhere;\n              continue;\n            }\n          }\n          const type = prop.constructor.name.replace(\"Array\", \"\");\n          view[`set${type}`](where, prop[eid]);\n          where += prop.BYTES_PER_ELEMENT;\n          writeCount++;\n        }\n      }\n      if (writeCount > 0) {\n        view.setUint32(countWhere, writeCount);\n      } else {\n        where -= 5;\n      }\n    }\n    return buffer.slice(0, where);\n  };\n};\nvar newEntities = /* @__PURE__ */ new Map();\nvar defineDeserializer = (target) => {\n  const isWorld2 = Object.getOwnPropertySymbols(target).includes($componentMap);\n  let [componentProps] = canonicalize(target);\n  const deserializedEntities = /* @__PURE__ */ new Set();\n  return (world, packet, mode = 0) => {\n    newEntities.clear();\n    if (resized) {\n      [componentProps] = canonicalize(target);\n      resized = false;\n    }\n    if (isWorld2) {\n      componentProps = [];\n      target[$componentMap].forEach((c, component) => {\n        if (component[$storeFlattened])\n          componentProps.push(...component[$storeFlattened]);\n        else\n          componentProps.push(component);\n      });\n    }\n    const localEntities = world[$localEntities];\n    const localEntityLookup = world[$localEntityLookup];\n    const view = new DataView(packet);\n    let where = 0;\n    while (where < packet.byteLength) {\n      const pid = view.getUint8(where);\n      where += 1;\n      const entityCount = view.getUint32(where);\n      where += 4;\n      const prop = componentProps[pid];\n      for (let i = 0; i < entityCount; i++) {\n        let eid = view.getUint32(where);\n        where += 4;\n        if (mode === DESERIALIZE_MODE.MAP) {\n          if (localEntities.has(eid)) {\n            eid = localEntities.get(eid);\n          } else if (newEntities.has(eid)) {\n            eid = newEntities.get(eid);\n          } else {\n            const newEid = addEntity(world);\n            localEntities.set(eid, newEid);\n            localEntityLookup.set(newEid, eid);\n            newEntities.set(eid, newEid);\n            eid = newEid;\n          }\n        }\n        if (mode === DESERIALIZE_MODE.APPEND || mode === DESERIALIZE_MODE.REPLACE && !world[$entitySparseSet].has(eid)) {\n          const newEid = newEntities.get(eid) || addEntity(world);\n          newEntities.set(eid, newEid);\n          eid = newEid;\n        }\n        const component = prop[$storeBase]();\n        if (!hasComponent(world, component, eid)) {\n          addComponent(world, component, eid);\n        }\n        deserializedEntities.add(eid);\n        if (component[$tagStore]) {\n          continue;\n        }\n        if (ArrayBuffer.isView(prop[eid])) {\n          const array = prop[eid];\n          const count = view[`get${array[$indexType]}`](where);\n          where += array[$indexBytes];\n          for (let i2 = 0; i2 < count; i2++) {\n            const index = view[`get${array[$indexType]}`](where);\n            where += array[$indexBytes];\n            const value = view[`get${array.constructor.name.replace(\"Array\", \"\")}`](where);\n            where += array.BYTES_PER_ELEMENT;\n            if (prop[$isEidType]) {\n              let localEid;\n              if (localEntities.has(value)) {\n                localEid = localEntities.get(value);\n              } else if (newEntities.has(value)) {\n                localEid = newEntities.get(value);\n              } else {\n                const newEid = addEntity(world);\n                localEntities.set(value, newEid);\n                localEntityLookup.set(newEid, value);\n                newEntities.set(value, newEid);\n                localEid = newEid;\n              }\n              prop[eid][index] = localEid;\n            } else\n              prop[eid][index] = value;\n          }\n        } else {\n          const value = view[`get${prop.constructor.name.replace(\"Array\", \"\")}`](where);\n          where += prop.BYTES_PER_ELEMENT;\n          if (prop[$isEidType]) {\n            let localEid;\n            if (localEntities.has(value)) {\n              localEid = localEntities.get(value);\n            } else if (newEntities.has(value)) {\n              localEid = newEntities.get(value);\n            } else {\n              const newEid = addEntity(world);\n              localEntities.set(value, newEid);\n              localEntityLookup.set(newEid, value);\n              newEntities.set(value, newEid);\n              localEid = newEid;\n            }\n            prop[eid] = localEid;\n          } else\n            prop[eid] = value;\n        }\n      }\n    }\n    const ents = Array.from(deserializedEntities);\n    deserializedEntities.clear();\n    return ents;\n  };\n};\n\n// src/Entity.js\nvar $entityMasks = Symbol(\"entityMasks\");\nvar $entityComponents = Symbol(\"entityComponents\");\nvar $entitySparseSet = Symbol(\"entitySparseSet\");\nvar $entityArray = Symbol(\"entityArray\");\nvar $entityIndices = Symbol(\"entityIndices\");\nvar $removedEntities = Symbol(\"removedEntities\");\nvar defaultSize = 1e5;\nvar globalEntityCursor = 0;\nvar globalSize = defaultSize;\nvar getGlobalSize = () => globalSize;\nvar removed = [];\nvar recycled = [];\nvar defaultRemovedReuseThreshold = 0.01;\nvar removedReuseThreshold = defaultRemovedReuseThreshold;\nvar resetGlobals = () => {\n  globalSize = defaultSize;\n  globalEntityCursor = 0;\n  removedReuseThreshold = defaultRemovedReuseThreshold;\n  removed.length = 0;\n  recycled.length = 0;\n};\nvar setDefaultSize = (newSize) => {\n  const oldSize = globalSize;\n  defaultSize = newSize;\n  resetGlobals();\n  globalSize = newSize;\n  resizeWorlds(newSize);\n  setSerializationResized(true);\n};\nvar setRemovedRecycleThreshold = (newThreshold) => {\n  removedReuseThreshold = newThreshold;\n};\nvar getEntityCursor = () => globalEntityCursor;\nvar eidToWorld = /* @__PURE__ */ new Map();\nvar flushRemovedEntities = (world) => {\n  if (!world[$manualEntityRecycling]) {\n    throw new Error(\"bitECS - cannot flush removed entities, enable feature with the enableManualEntityRecycling function\");\n  }\n  removed.push(...recycled);\n  recycled.length = 0;\n};\nvar addEntity = (world) => {\n  const eid = world[$manualEntityRecycling] ? removed.length ? removed.shift() : globalEntityCursor++ : removed.length > Math.round(globalSize * removedReuseThreshold) ? removed.shift() : globalEntityCursor++;\n  if (eid > world[$size])\n    throw new Error(\"bitECS - max entities reached\");\n  world[$entitySparseSet].add(eid);\n  eidToWorld.set(eid, world);\n  world[$notQueries].forEach((q) => {\n    const match = queryCheckEntity(world, q, eid);\n    if (match)\n      queryAddEntity(q, eid);\n  });\n  world[$entityComponents].set(eid, /* @__PURE__ */ new Set());\n  return eid;\n};\nvar removeEntity = (world, eid) => {\n  if (!world[$entitySparseSet].has(eid))\n    return;\n  world[$queries].forEach((q) => {\n    queryRemoveEntity(world, q, eid);\n  });\n  if (world[$manualEntityRecycling])\n    recycled.push(eid);\n  else\n    removed.push(eid);\n  world[$entitySparseSet].remove(eid);\n  world[$entityComponents].delete(eid);\n  world[$localEntities].delete(world[$localEntityLookup].get(eid));\n  world[$localEntityLookup].delete(eid);\n  for (let i = 0; i < world[$entityMasks].length; i++)\n    world[$entityMasks][i][eid] = 0;\n};\nvar getEntityComponents = (world, eid) => {\n  if (eid === void 0)\n    throw new Error(\"bitECS - entity is undefined.\");\n  if (!world[$entitySparseSet].has(eid))\n    throw new Error(\"bitECS - entity does not exist in the world.\");\n  return Array.from(world[$entityComponents].get(eid));\n};\nvar entityExists = (world, eid) => world[$entitySparseSet].has(eid);\n\n// src/Query.js\nvar $modifier = Symbol(\"$modifier\");\nfunction modifier(c, mod) {\n  const inner = () => [c, mod];\n  inner[$modifier] = true;\n  return inner;\n}\nvar Not = (c) => modifier(c, \"not\");\nvar Changed = (c) => modifier(c, \"changed\");\nfunction Any(...comps) {\n  return function QueryAny() {\n    return comps;\n  };\n}\nfunction All(...comps) {\n  return function QueryAll() {\n    return comps;\n  };\n}\nfunction None(...comps) {\n  return function QueryNone() {\n    return comps;\n  };\n}\nvar $queries = Symbol(\"queries\");\nvar $notQueries = Symbol(\"notQueries\");\nvar $queryAny = Symbol(\"queryAny\");\nvar $queryAll = Symbol(\"queryAll\");\nvar $queryNone = Symbol(\"queryNone\");\nvar $queryMap = Symbol(\"queryMap\");\nvar $dirtyQueries = Symbol(\"$dirtyQueries\");\nvar $queryComponents = Symbol(\"queryComponents\");\nvar $enterQuery = Symbol(\"enterQuery\");\nvar $exitQuery = Symbol(\"exitQuery\");\nvar empty = Object.freeze([]);\nvar enterQuery = (query) => (world) => {\n  if (!world[$queryMap].has(query))\n    registerQuery(world, query);\n  const q = world[$queryMap].get(query);\n  if (q.entered.dense.length === 0) {\n    return empty;\n  } else {\n    const results = q.entered.dense.slice();\n    q.entered.reset();\n    return results;\n  }\n};\nvar exitQuery = (query) => (world) => {\n  if (!world[$queryMap].has(query))\n    registerQuery(world, query);\n  const q = world[$queryMap].get(query);\n  if (q.exited.dense.length === 0) {\n    return empty;\n  } else {\n    const results = q.exited.dense.slice();\n    q.exited.reset();\n    return results;\n  }\n};\nvar registerQuery = (world, query) => {\n  const components2 = [];\n  const notComponents = [];\n  const changedComponents = [];\n  query[$queryComponents].forEach((c) => {\n    if (typeof c === \"function\" && c[$modifier]) {\n      const [comp, mod] = c();\n      if (!world[$componentMap].has(comp))\n        registerComponent(world, comp);\n      if (mod === \"not\") {\n        notComponents.push(comp);\n      }\n      if (mod === \"changed\") {\n        changedComponents.push(comp);\n        components2.push(comp);\n      }\n    } else {\n      if (!world[$componentMap].has(c))\n        registerComponent(world, c);\n      components2.push(c);\n    }\n  });\n  const mapComponents = (c) => world[$componentMap].get(c);\n  const allComponents = components2.concat(notComponents).map(mapComponents);\n  const sparseSet = SparseSet();\n  const archetypes = [];\n  const changed = [];\n  const toRemove = SparseSet();\n  const entered = SparseSet();\n  const exited = SparseSet();\n  const generations = allComponents.map((c) => c.generationId).reduce((a, v) => {\n    if (a.includes(v))\n      return a;\n    a.push(v);\n    return a;\n  }, []);\n  const reduceBitflags = (a, c) => {\n    if (!a[c.generationId])\n      a[c.generationId] = 0;\n    a[c.generationId] |= c.bitflag;\n    return a;\n  };\n  const masks = components2.map(mapComponents).reduce(reduceBitflags, {});\n  const notMasks = notComponents.map(mapComponents).reduce(reduceBitflags, {});\n  const hasMasks = allComponents.reduce(reduceBitflags, {});\n  const flatProps = components2.filter((c) => !c[$tagStore]).map((c) => Object.getOwnPropertySymbols(c).includes($storeFlattened) ? c[$storeFlattened] : [c]).reduce((a, v) => a.concat(v), []);\n  const shadows = [];\n  const q = Object.assign(sparseSet, {\n    archetypes,\n    changed,\n    components: components2,\n    notComponents,\n    changedComponents,\n    allComponents,\n    masks,\n    notMasks,\n    hasMasks,\n    generations,\n    flatProps,\n    toRemove,\n    entered,\n    exited,\n    shadows\n  });\n  world[$queryMap].set(query, q);\n  world[$queries].add(q);\n  allComponents.forEach((c) => {\n    c.queries.add(q);\n  });\n  if (notComponents.length)\n    world[$notQueries].add(q);\n  for (let eid = 0; eid < getEntityCursor(); eid++) {\n    if (!world[$entitySparseSet].has(eid))\n      continue;\n    const match = queryCheckEntity(world, q, eid);\n    if (match)\n      queryAddEntity(q, eid);\n  }\n};\nvar generateShadow = (q, pid) => {\n  const $ = Symbol();\n  const prop = q.flatProps[pid];\n  createShadow(prop, $);\n  q.shadows[pid] = prop[$];\n  return prop[$];\n};\nvar diff = (q, clearDiff) => {\n  if (clearDiff)\n    q.changed = [];\n  const { flatProps, shadows } = q;\n  for (let i = 0; i < q.dense.length; i++) {\n    const eid = q.dense[i];\n    let dirty = false;\n    for (let pid = 0; pid < flatProps.length; pid++) {\n      const prop = flatProps[pid];\n      const shadow = shadows[pid] || generateShadow(q, pid);\n      if (ArrayBuffer.isView(prop[eid])) {\n        for (let i2 = 0; i2 < prop[eid].length; i2++) {\n          if (prop[eid][i2] !== shadow[eid][i2]) {\n            dirty = true;\n            break;\n          }\n        }\n        shadow[eid].set(prop[eid]);\n      } else {\n        if (prop[eid] !== shadow[eid]) {\n          dirty = true;\n          shadow[eid] = prop[eid];\n        }\n      }\n    }\n    if (dirty)\n      q.changed.push(eid);\n  }\n  return q.changed;\n};\nvar flatten = (a, v) => a.concat(v);\nvar aggregateComponentsFor = (mod) => (x) => x.filter((f) => f.name === mod().constructor.name).reduce(flatten);\nvar getAnyComponents = aggregateComponentsFor(Any);\nvar getAllComponents = aggregateComponentsFor(All);\nvar getNoneComponents = aggregateComponentsFor(None);\nvar defineQuery = (...args) => {\n  let components2;\n  let any, all, none;\n  if (Array.isArray(args[0])) {\n    components2 = args[0];\n  } else {\n  }\n  if (components2 === void 0 || components2[$componentMap] !== void 0) {\n    return (world) => world ? world[$entityArray] : components2[$entityArray];\n  }\n  const query = function(world, clearDiff = true) {\n    if (!world[$queryMap].has(query))\n      registerQuery(world, query);\n    const q = world[$queryMap].get(query);\n    commitRemovals(world);\n    if (q.changedComponents.length)\n      return diff(q, clearDiff);\n    return q.dense;\n  };\n  query[$queryComponents] = components2;\n  query[$queryAny] = any;\n  query[$queryAll] = all;\n  query[$queryNone] = none;\n  return query;\n};\nvar queryCheckEntity = (world, q, eid) => {\n  const { masks, notMasks, generations } = q;\n  let or = 0;\n  for (let i = 0; i < generations.length; i++) {\n    const generationId = generations[i];\n    const qMask = masks[generationId];\n    const qNotMask = notMasks[generationId];\n    const eMask = world[$entityMasks][generationId][eid];\n    if (qNotMask && (eMask & qNotMask) !== 0) {\n      return false;\n    }\n    if (qMask && (eMask & qMask) !== qMask) {\n      return false;\n    }\n  }\n  return true;\n};\nvar queryAddEntity = (q, eid) => {\n  q.toRemove.remove(eid);\n  q.entered.add(eid);\n  q.add(eid);\n};\nvar queryCommitRemovals = (q) => {\n  for (let i = q.toRemove.dense.length - 1; i >= 0; i--) {\n    const eid = q.toRemove.dense[i];\n    q.toRemove.remove(eid);\n    q.remove(eid);\n  }\n};\nvar commitRemovals = (world) => {\n  if (!world[$dirtyQueries].size)\n    return;\n  world[$dirtyQueries].forEach(queryCommitRemovals);\n  world[$dirtyQueries].clear();\n};\nvar queryRemoveEntity = (world, q, eid) => {\n  if (!q.has(eid) || q.toRemove.has(eid))\n    return;\n  q.toRemove.add(eid);\n  world[$dirtyQueries].add(q);\n  q.exited.add(eid);\n};\nvar resetChangedQuery = (world, query) => {\n  const q = world[$queryMap].get(query);\n  q.changed = [];\n};\nvar removeQuery = (world, query) => {\n  const q = world[$queryMap].get(query);\n  world[$queries].delete(q);\n  world[$queryMap].delete(query);\n};\n\n// src/Component.js\nvar $componentMap = Symbol(\"componentMap\");\nvar components = [];\nvar defineComponent = (schema, size) => {\n  const component = createStore(schema, size || getGlobalSize());\n  if (schema && Object.keys(schema).length)\n    components.push(component);\n  return component;\n};\nvar incrementBitflag = (world) => {\n  world[$bitflag] *= 2;\n  if (world[$bitflag] >= 2 ** 31) {\n    world[$bitflag] = 1;\n    world[$entityMasks].push(new Uint32Array(world[$size]));\n  }\n};\nvar registerComponent = (world, component) => {\n  if (!component)\n    throw new Error(`bitECS - Cannot register null or undefined component`);\n  const queries = /* @__PURE__ */ new Set();\n  const notQueries = /* @__PURE__ */ new Set();\n  const changedQueries = /* @__PURE__ */ new Set();\n  world[$queries].forEach((q) => {\n    if (q.allComponents.includes(component)) {\n      queries.add(q);\n    }\n  });\n  world[$componentMap].set(component, {\n    generationId: world[$entityMasks].length - 1,\n    bitflag: world[$bitflag],\n    store: component,\n    queries,\n    notQueries,\n    changedQueries\n  });\n  incrementBitflag(world);\n};\nvar registerComponents = (world, components2) => {\n  components2.forEach((c) => registerComponent(world, c));\n};\nvar hasComponent = (world, component, eid) => {\n  const registeredComponent = world[$componentMap].get(component);\n  if (!registeredComponent)\n    return false;\n  const { generationId, bitflag } = registeredComponent;\n  const mask = world[$entityMasks][generationId][eid];\n  return (mask & bitflag) === bitflag;\n};\nvar addComponent = (world, component, eid, reset = false) => {\n  if (eid === void 0)\n    throw new Error(\"bitECS - entity is undefined.\");\n  if (!world[$entitySparseSet].has(eid))\n    throw new Error(\"bitECS - entity does not exist in the world.\");\n  if (!world[$componentMap].has(component))\n    registerComponent(world, component);\n  if (hasComponent(world, component, eid))\n    return;\n  const c = world[$componentMap].get(component);\n  const { generationId, bitflag, queries, notQueries } = c;\n  world[$entityMasks][generationId][eid] |= bitflag;\n  queries.forEach((q) => {\n    q.toRemove.remove(eid);\n    const match = queryCheckEntity(world, q, eid);\n    if (match) {\n      q.exited.remove(eid);\n      queryAddEntity(q, eid);\n    }\n    if (!match) {\n      q.entered.remove(eid);\n      queryRemoveEntity(world, q, eid);\n    }\n  });\n  world[$entityComponents].get(eid).add(component);\n  if (reset)\n    resetStoreFor(component, eid);\n};\nvar removeComponent = (world, component, eid, reset = true) => {\n  if (eid === void 0)\n    throw new Error(\"bitECS - entity is undefined.\");\n  if (!world[$entitySparseSet].has(eid))\n    throw new Error(\"bitECS - entity does not exist in the world.\");\n  if (!hasComponent(world, component, eid))\n    return;\n  const c = world[$componentMap].get(component);\n  const { generationId, bitflag, queries } = c;\n  world[$entityMasks][generationId][eid] &= ~bitflag;\n  queries.forEach((q) => {\n    q.toRemove.remove(eid);\n    const match = queryCheckEntity(world, q, eid);\n    if (match) {\n      q.exited.remove(eid);\n      queryAddEntity(q, eid);\n    }\n    if (!match) {\n      q.entered.remove(eid);\n      queryRemoveEntity(world, q, eid);\n    }\n  });\n  world[$entityComponents].get(eid).delete(component);\n  if (reset)\n    resetStoreFor(component, eid);\n};\n\n// src/World.js\nvar $size = Symbol(\"size\");\nvar $resizeThreshold = Symbol(\"resizeThreshold\");\nvar $bitflag = Symbol(\"bitflag\");\nvar $archetypes = Symbol(\"archetypes\");\nvar $localEntities = Symbol(\"localEntities\");\nvar $localEntityLookup = Symbol(\"localEntityLookup\");\nvar $manualEntityRecycling = Symbol(\"manualEntityRecycling\");\nvar worlds = [];\nvar resizeWorlds = (size) => {\n  worlds.forEach((world) => {\n    world[$size] = size;\n    for (let i = 0; i < world[$entityMasks].length; i++) {\n      const masks = world[$entityMasks][i];\n      world[$entityMasks][i] = resize(masks, size);\n    }\n    world[$resizeThreshold] = world[$size] - world[$size] / 5;\n  });\n};\nvar createWorld = (...args) => {\n  const world = typeof args[0] === \"object\" ? args[0] : {};\n  const size = typeof args[0] === \"number\" ? args[0] : typeof args[1] === \"number\" ? args[1] : getGlobalSize();\n  resetWorld(world, size);\n  worlds.push(world);\n  return world;\n};\nvar enableManualEntityRecycling = (world) => {\n  world[$manualEntityRecycling] = true;\n};\nvar resetWorld = (world, size = getGlobalSize()) => {\n  world[$size] = size;\n  if (world[$entityArray])\n    world[$entityArray].forEach((eid) => removeEntity(world, eid));\n  world[$entityMasks] = [new Uint32Array(size)];\n  world[$entityComponents] = /* @__PURE__ */ new Map();\n  world[$archetypes] = [];\n  world[$entitySparseSet] = SparseSet();\n  world[$entityArray] = world[$entitySparseSet].dense;\n  world[$bitflag] = 1;\n  world[$componentMap] = /* @__PURE__ */ new Map();\n  world[$queryMap] = /* @__PURE__ */ new Map();\n  world[$queries] = /* @__PURE__ */ new Set();\n  world[$notQueries] = /* @__PURE__ */ new Set();\n  world[$dirtyQueries] = /* @__PURE__ */ new Set();\n  world[$localEntities] = /* @__PURE__ */ new Map();\n  world[$localEntityLookup] = /* @__PURE__ */ new Map();\n  world[$manualEntityRecycling] = false;\n  return world;\n};\nvar deleteWorld = (world) => {\n  Object.getOwnPropertySymbols(world).forEach(($) => {\n    delete world[$];\n  });\n  Object.keys(world).forEach((key) => {\n    delete world[key];\n  });\n  worlds.splice(worlds.indexOf(world), 1);\n};\nvar getWorldComponents = (world) => Array.from(world[$componentMap].keys());\nvar getAllEntities = (world) => world[$entitySparseSet].dense.slice(0);\n\n// src/System.js\nvar defineSystem = (update) => (world, ...args) => {\n  update(world, ...args);\n  return world;\n};\n\n// src/index.js\nvar pipe = (...fns) => (input) => {\n  let tmp = input;\n  for (let i = 0; i < fns.length; i++) {\n    const fn = fns[i];\n    tmp = fn(tmp);\n  }\n  return tmp;\n};\nvar Types = TYPES_ENUM;\nexport {\n  Changed,\n  DESERIALIZE_MODE,\n  Not,\n  Types,\n  addComponent,\n  addEntity,\n  commitRemovals,\n  createWorld,\n  defineComponent,\n  defineDeserializer,\n  defineQuery,\n  defineSerializer,\n  defineSystem,\n  deleteWorld,\n  enableManualEntityRecycling,\n  enterQuery,\n  entityExists,\n  exitQuery,\n  flushRemovedEntities,\n  getAllEntities,\n  getEntityComponents,\n  getWorldComponents,\n  hasComponent,\n  parentArray,\n  pipe,\n  registerComponent,\n  registerComponents,\n  removeComponent,\n  removeEntity,\n  removeQuery,\n  resetChangedQuery,\n  resetGlobals,\n  resetWorld,\n  setDefaultSize,\n  setRemovedRecycleThreshold\n};\n//# sourceMappingURL=index.mjs.map\n","/**\n * Deterministic PRNG using Linear Congruential Generator.\n * Chunk-based seeding ensures identical world generation for the same seed.\n */\nexport class SeededRandom {\n  private seed: number;\n  private current: number;\n\n  constructor(seed: number = 42069) {\n    this.seed = seed;\n    this.current = seed;\n  }\n\n  /** Core LCG step — returns float in [0, 1) */\n  next(): number {\n    this.current = (this.current * 1103515245 + 12345) & 0x7fffffff;\n    return this.current / 0x7fffffff;\n  }\n\n  /** Seed for a specific chunk coordinate (deterministic) */\n  setSeed(x: number, y: number): void {\n    this.current = (this.seed ^ (x * 73856093) ^ (y * 19349663)) >>> 0;\n    // Warm up to reduce correlation\n    this.next();\n    this.next();\n  }\n\n  /** Random integer in [min, max] inclusive */\n  nextInt(min: number, max: number): number {\n    return Math.floor(this.next() * (max - min + 1)) + min;\n  }\n\n  /** Random float in [min, max) */\n  nextFloat(min: number = 0, max: number = 1): number {\n    return this.next() * (max - min) + min;\n  }\n\n  /** Pick random element from array */\n  pick<T>(array: T[]): T {\n    return array[Math.floor(this.next() * array.length)];\n  }\n\n  /** Fisher-Yates shuffle (in-place) */\n  shuffle<T>(array: T[]): T[] {\n    for (let i = array.length - 1; i > 0; i--) {\n      const j = Math.floor(this.next() * (i + 1));\n      [array[i], array[j]] = [array[j], array[i]];\n    }\n    return array;\n  }\n\n  /** Weighted random pick — weights array parallel to items */\n  weightedPick<T>(items: T[], weights: number[]): T {\n    const total = weights.reduce((a, b) => a + b, 0);\n    let roll = this.next() * total;\n    for (let i = 0; i < items.length; i++) {\n      roll -= weights[i];\n      if (roll <= 0) return items[i];\n    }\n    return items[items.length - 1];\n  }\n\n  /** Reset to initial seed */\n  reset(): void {\n    this.current = this.seed;\n  }\n\n  getSeed(): number {\n    return this.seed;\n  }\n}\n\n/**\n * Perlin 2D noise with FBM support.\n */\nexport class PerlinNoise {\n  private perm: number[];\n\n  constructor(seed: number = 42069) {\n    // Build permutation table from seed\n    const rng = new SeededRandom(seed);\n    const p = Array.from({ length: 256 }, (_, i) => i);\n    rng.shuffle(p);\n    this.perm = [...p, ...p]; // Double for wrapping\n  }\n\n  private fade(t: number): number {\n    return t * t * t * (t * (t * 6 - 15) + 10);\n  }\n\n  private lerp(a: number, b: number, t: number): number {\n    return a + t * (b - a);\n  }\n\n  private grad(hash: number, x: number, y: number): number {\n    const h = hash & 3;\n    const u = h < 2 ? x : y;\n    const v = h < 2 ? y : x;\n    return (h & 1 ? -u : u) + (h & 2 ? -v : v);\n  }\n\n  /** 2D Perlin noise — returns value in approximately [-1, 1] */\n  noise2D(x: number, y: number): number {\n    const X = Math.floor(x) & 255;\n    const Y = Math.floor(y) & 255;\n    const xf = x - Math.floor(x);\n    const yf = y - Math.floor(y);\n\n    const u = this.fade(xf);\n    const v = this.fade(yf);\n\n    const aa = this.perm[this.perm[X] + Y];\n    const ab = this.perm[this.perm[X] + Y + 1];\n    const ba = this.perm[this.perm[X + 1] + Y];\n    const bb = this.perm[this.perm[X + 1] + Y + 1];\n\n    return this.lerp(\n      this.lerp(this.grad(aa, xf, yf), this.grad(ba, xf - 1, yf), u),\n      this.lerp(this.grad(ab, xf, yf - 1), this.grad(bb, xf - 1, yf - 1), u),\n      v,\n    );\n  }\n\n  /** Fractional Brownian Motion — layered noise for natural terrain */\n  fbm(\n    x: number,\n    y: number,\n    octaves: number = 4,\n    lacunarity: number = 2.0,\n    persistence: number = 0.5,\n  ): number {\n    let total = 0;\n    let frequency = 1;\n    let amplitude = 1;\n    let maxValue = 0;\n\n    for (let i = 0; i < octaves; i++) {\n      total += this.noise2D(x * frequency, y * frequency) * amplitude;\n      maxValue += amplitude;\n      amplitude *= persistence;\n      frequency *= lacunarity;\n    }\n\n    return total / maxValue;\n  }\n}\n","/** Tile types used in world generation */\nexport enum TileType {\n  Grass = 0,\n  Dirt = 1,\n  Sand = 2,\n  Stone = 3,\n  Water = 4,\n  Snow = 5,\n  Path = 6,\n  Tilled = 7,\n  Watered = 8,\n  Lava = 9,\n  VoidTile = 10,\n  WoodFloor = 11,\n  Ice = 12,\n  Mud = 13,\n  Bone = 14,\n  Corruption = 15,\n}\n\n/** Object types that can spawn on tiles */\nexport enum ObjectType {\n  None = 0,\n  Tree = 1,\n  Rock = 2,\n  Bush = 3,\n  Flower = 4,\n  TallGrass = 5,\n  CopperNode = 6,\n  IronNode = 7,\n  GoldNode = 8,\n  Cactus = 9,\n  DeadTree = 10,\n  Mushroom = 11,\n  Crystal = 12,\n  BonesPile = 13,\n  VoidCrystal = 14,\n  Chest = 15,\n  WaterSource = 16,\n  DungeonEntrance = 17,\n  RiftStone = 18,\n  CityMarker = 19,\n}\n\n/** Properties of each tile type */\nexport interface TileProperties {\n  solid: boolean;\n  walkSpeed: number; // Multiplier (1.0 = normal, 0.5 = slow, 0 = impassable)\n  texture: string;   // Texture key in Phaser\n  variants: number;  // Number of visual variants\n}\n\n/** Properties of each object type */\nexport interface ObjectProperties {\n  solid: boolean;\n  destructible: boolean;\n  interactable: boolean;\n  texture: string;\n  hp: number;\n  scale: number;\n}\n\nexport const TILE_PROPERTIES: Record<TileType, TileProperties> = {\n  [TileType.Grass]:      { solid: false, walkSpeed: 1.0, texture: 'tile_grass', variants: 4 },\n  [TileType.Dirt]:       { solid: false, walkSpeed: 1.0, texture: 'tile_dirt', variants: 3 },\n  [TileType.Sand]:       { solid: false, walkSpeed: 0.8, texture: 'tile_sand', variants: 3 },\n  [TileType.Stone]:      { solid: false, walkSpeed: 1.0, texture: 'tile_stone', variants: 3 },\n  [TileType.Water]:      { solid: true,  walkSpeed: 0,   texture: 'tile_water', variants: 2 },\n  [TileType.Snow]:       { solid: false, walkSpeed: 0.7, texture: 'tile_snow', variants: 3 },\n  [TileType.Path]:       { solid: false, walkSpeed: 1.2, texture: 'tile_path', variants: 2 },\n  [TileType.Tilled]:     { solid: false, walkSpeed: 0.9, texture: 'tile_dirt', variants: 1 },\n  [TileType.Watered]:    { solid: false, walkSpeed: 0.9, texture: 'tile_dirt', variants: 1 },\n  [TileType.Lava]:       { solid: true,  walkSpeed: 0,   texture: 'tile_lava', variants: 2 },\n  [TileType.VoidTile]:   { solid: false, walkSpeed: 0.6, texture: 'tile_void_tile', variants: 2 },\n  [TileType.WoodFloor]:  { solid: false, walkSpeed: 1.0, texture: 'tile_wood_floor', variants: 1 },\n  [TileType.Ice]:        { solid: false, walkSpeed: 1.3, texture: 'tile_ice', variants: 2 },\n  [TileType.Mud]:        { solid: false, walkSpeed: 0.5, texture: 'tile_mud', variants: 2 },\n  [TileType.Bone]:       { solid: false, walkSpeed: 0.9, texture: 'tile_bone', variants: 2 },\n  [TileType.Corruption]: { solid: false, walkSpeed: 0.7, texture: 'tile_corruption', variants: 2 },\n};\n\nexport const OBJECT_PROPERTIES: Record<ObjectType, ObjectProperties> = {\n  [ObjectType.None]:            { solid: false, destructible: false, interactable: false, texture: '', hp: 0, scale: 1 },\n  [ObjectType.Tree]:            { solid: true,  destructible: true,  interactable: true,  texture: 'obj_tree', hp: 20, scale: 0.12 },\n  [ObjectType.Rock]:            { solid: true,  destructible: true,  interactable: true,  texture: 'obj_rock', hp: 30, scale: 0.5 },\n  [ObjectType.Bush]:            { solid: false, destructible: true,  interactable: true,  texture: 'obj_bush', hp: 5, scale: 0.5 },\n  [ObjectType.Flower]:          { solid: false, destructible: true,  interactable: true,  texture: 'obj_flower', hp: 1, scale: 0.7 },\n  [ObjectType.TallGrass]:       { solid: false, destructible: true,  interactable: false, texture: 'obj_tallgrass', hp: 1, scale: 0.6 },\n  [ObjectType.CopperNode]:      { solid: true,  destructible: true,  interactable: true,  texture: 'obj_copper', hp: 40, scale: 0.5 },\n  [ObjectType.IronNode]:        { solid: true,  destructible: true,  interactable: true,  texture: 'obj_iron', hp: 60, scale: 0.5 },\n  [ObjectType.GoldNode]:        { solid: true,  destructible: true,  interactable: true,  texture: 'obj_gold', hp: 80, scale: 0.5 },\n  [ObjectType.Cactus]:          { solid: true,  destructible: true,  interactable: false, texture: 'obj_cactus', hp: 15, scale: 0.5 },\n  [ObjectType.DeadTree]:        { solid: true,  destructible: true,  interactable: true,  texture: 'obj_deadtree', hp: 10, scale: 0.12 },\n  [ObjectType.Mushroom]:        { solid: false, destructible: true,  interactable: true,  texture: 'obj_mushroom', hp: 1, scale: 0.7 },\n  [ObjectType.Crystal]:         { solid: true,  destructible: true,  interactable: true,  texture: 'obj_crystal', hp: 50, scale: 0.6 },\n  [ObjectType.BonesPile]:       { solid: false, destructible: true,  interactable: true,  texture: 'obj_bonespile', hp: 5, scale: 0.5 },\n  [ObjectType.VoidCrystal]:     { solid: true,  destructible: true,  interactable: true,  texture: 'obj_voidcrystal', hp: 100, scale: 0.6 },\n  [ObjectType.Chest]:           { solid: true,  destructible: false, interactable: true,  texture: 'chest', hp: 0, scale: 0.8 },\n  [ObjectType.WaterSource]:     { solid: true,  destructible: false, interactable: true,  texture: 'obj_watersource', hp: 0, scale: 0.5 },\n  [ObjectType.DungeonEntrance]: { solid: true,  destructible: false, interactable: true,  texture: 'obj_dungeon', hp: 0, scale: 0.5 },\n  [ObjectType.RiftStone]:       { solid: true,  destructible: false, interactable: true,  texture: 'obj_riftstone', hp: 0, scale: 0.6 },\n  [ObjectType.CityMarker]:      { solid: false, destructible: false, interactable: true,  texture: 'obj_city', hp: 0, scale: 0.15 },\n};\n\n/** Drops when a destructible object is destroyed (tool usage) */\nexport const OBJECT_DROPS: Partial<Record<ObjectType, { itemId: string; qty: [number, number] }[]>> = {\n  [ObjectType.Tree]: [{ itemId: 'wood', qty: [2, 5] }],\n  [ObjectType.Rock]: [{ itemId: 'stone', qty: [1, 3] }],\n  [ObjectType.CopperNode]: [{ itemId: 'copper_ore', qty: [1, 3] }],\n  [ObjectType.IronNode]: [{ itemId: 'iron_ore', qty: [1, 2] }],\n  [ObjectType.GoldNode]: [{ itemId: 'gold_ore', qty: [1, 2] }],\n  [ObjectType.Bush]: [{ itemId: 'fiber', qty: [1, 3] }],\n  [ObjectType.Crystal]: [{ itemId: 'crystal_shard', qty: [1, 2] }],\n  [ObjectType.DeadTree]: [{ itemId: 'wood', qty: [1, 3] }],\n  [ObjectType.Cactus]: [{ itemId: 'cactus_fruit', qty: [1, 2] }],\n  [ObjectType.Mushroom]: [{ itemId: 'mushroom', qty: [1, 1] }],\n  [ObjectType.BonesPile]: [{ itemId: 'bone_fragment', qty: [1, 3] }],\n  [ObjectType.VoidCrystal]: [{ itemId: 'void_shard', qty: [1, 2] }],\n};\n","import { PerlinNoise, SeededRandom } from './SeededRandom';\nimport { TileType, ObjectType } from './TileRegistry';\nimport { NOISE_SCALE, NOISE_OCTAVES, NOISE_PERSISTENCE, BIOME_RINGS } from '../config';\n\n/** Biome identifiers — ordered by distance from origin */\nexport enum BiomeId {\n  Haven = 0,\n  Rotwood = 1,\n  Ashlands = 2,\n  Drowned = 3,\n  BoneWastes = 4,\n  TheVoid = 5,\n  Edilas = 6,\n}\n\nexport interface BiomeDef {\n  id: BiomeId;\n  name: string;\n  primaryTile: TileType;\n  secondaryTile: TileType;\n  accentTile: TileType;\n  difficultyMult: number;\n  corruptionRate: number;\n}\n\nexport const BIOME_DEFS: Record<BiomeId, BiomeDef> = {\n  [BiomeId.Haven]: {\n    id: BiomeId.Haven,\n    name: 'Haven',\n    primaryTile: TileType.Grass,\n    secondaryTile: TileType.Dirt,\n    accentTile: TileType.Path,\n    difficultyMult: 1.0,\n    corruptionRate: 0.0001,\n  },\n  [BiomeId.Rotwood]: {\n    id: BiomeId.Rotwood,\n    name: 'Rotwood',\n    primaryTile: TileType.Grass,\n    secondaryTile: TileType.Mud,\n    accentTile: TileType.Dirt,\n    difficultyMult: 1.3,\n    corruptionRate: 0.0005,\n  },\n  [BiomeId.Ashlands]: {\n    id: BiomeId.Ashlands,\n    name: 'Ashlands',\n    primaryTile: TileType.Stone,\n    secondaryTile: TileType.Dirt,\n    accentTile: TileType.Lava,\n    difficultyMult: 1.7,\n    corruptionRate: 0.0008,\n  },\n  [BiomeId.Drowned]: {\n    id: BiomeId.Drowned,\n    name: 'Drowned Depths',\n    primaryTile: TileType.Stone,\n    secondaryTile: TileType.Mud,\n    accentTile: TileType.Water,\n    difficultyMult: 2.0,\n    corruptionRate: 0.001,\n  },\n  [BiomeId.BoneWastes]: {\n    id: BiomeId.BoneWastes,\n    name: 'Bone Wastes',\n    primaryTile: TileType.Sand,\n    secondaryTile: TileType.Bone,\n    accentTile: TileType.Stone,\n    difficultyMult: 2.5,\n    corruptionRate: 0.0015,\n  },\n  [BiomeId.TheVoid]: {\n    id: BiomeId.TheVoid,\n    name: 'The Void',\n    primaryTile: TileType.VoidTile,\n    secondaryTile: TileType.Stone,\n    accentTile: TileType.Corruption,\n    difficultyMult: 3.0,\n    corruptionRate: 0.003,\n  },\n  [BiomeId.Edilas]: {\n    id: BiomeId.Edilas,\n    name: 'EDILAS',\n    primaryTile: TileType.Corruption,\n    secondaryTile: TileType.VoidTile,\n    accentTile: TileType.Stone,\n    difficultyMult: 3.5,\n    corruptionRate: 0.005,\n  },\n};\n\n/** Biome-specific object spawn weights: [objectType, weight] */\nconst BIOME_OBJECTS: Record<BiomeId, [ObjectType, number][]> = {\n  [BiomeId.Haven]: [\n    [ObjectType.Tree, 0.15], [ObjectType.Bush, 0.06], [ObjectType.Flower, 0.08],\n    [ObjectType.TallGrass, 0.10], [ObjectType.Rock, 0.02], [ObjectType.CopperNode, 0.005],\n  ],\n  [BiomeId.Rotwood]: [\n    [ObjectType.Tree, 0.25], [ObjectType.Bush, 0.08], [ObjectType.Mushroom, 0.06],\n    [ObjectType.TallGrass, 0.05], [ObjectType.Rock, 0.02], [ObjectType.IronNode, 0.005],\n  ],\n  [BiomeId.Ashlands]: [\n    [ObjectType.Rock, 0.10], [ObjectType.DeadTree, 0.04], [ObjectType.CopperNode, 0.01],\n    [ObjectType.IronNode, 0.008], [ObjectType.Crystal, 0.003],\n  ],\n  [BiomeId.Drowned]: [\n    [ObjectType.Rock, 0.06], [ObjectType.Bush, 0.03], [ObjectType.Mushroom, 0.04],\n    [ObjectType.Crystal, 0.005], [ObjectType.IronNode, 0.006],\n  ],\n  [BiomeId.BoneWastes]: [\n    [ObjectType.BonesPile, 0.08], [ObjectType.Rock, 0.05], [ObjectType.DeadTree, 0.02],\n    [ObjectType.Cactus, 0.04], [ObjectType.GoldNode, 0.003],\n  ],\n  [BiomeId.TheVoid]: [\n    [ObjectType.VoidCrystal, 0.04], [ObjectType.Rock, 0.03], [ObjectType.Crystal, 0.02],\n  ],\n  [BiomeId.Edilas]: [\n    [ObjectType.VoidCrystal, 0.06], [ObjectType.Crystal, 0.04], [ObjectType.BonesPile, 0.03],\n  ],\n};\n\nexport class BiomeGenerator {\n  private noise: PerlinNoise;\n  private detailNoise: PerlinNoise;\n\n  constructor(seed: number) {\n    this.noise = new PerlinNoise(seed);\n    this.detailNoise = new PerlinNoise(seed + 12345);\n  }\n\n  /** Get biome at a world tile coordinate based on distance from origin + noise */\n  getBiome(tileX: number, tileY: number): BiomeId {\n    const dist = Math.sqrt(tileX * tileX + tileY * tileY);\n\n    // Add noise variation to ring boundaries (±30 tiles of wobble)\n    const noiseVal = this.noise.fbm(tileX * 0.005, tileY * 0.005, 3) * 30;\n    const effectiveDist = dist + noiseVal;\n\n    const rings = BIOME_RINGS;\n    if (effectiveDist < rings.haven.max) return BiomeId.Haven;\n    if (effectiveDist < rings.rotwood.max) return BiomeId.Rotwood;\n    if (effectiveDist < rings.ashlands.max) return BiomeId.Ashlands;\n    if (effectiveDist < rings.drowned.max) return BiomeId.Drowned;\n    if (effectiveDist < rings.bone.max) return BiomeId.BoneWastes;\n    if (effectiveDist < rings.void.max) return BiomeId.TheVoid;\n    return BiomeId.Edilas;\n  }\n\n  /** Generate tile type for a world position */\n  getTile(tileX: number, tileY: number): TileType {\n    const biome = this.getBiome(tileX, tileY);\n    const def = BIOME_DEFS[biome];\n\n    // Use noise to blend between primary and secondary tiles\n    const n = this.noise.fbm(\n      tileX * NOISE_SCALE,\n      tileY * NOISE_SCALE,\n      NOISE_OCTAVES,\n      2.0,\n      NOISE_PERSISTENCE,\n    );\n\n    // Water/lava features via detail noise\n    const detail = this.detailNoise.noise2D(tileX * 0.03, tileY * 0.03);\n    if (biome === BiomeId.Drowned && detail < -0.4) return TileType.Water;\n    if (biome === BiomeId.Ashlands && detail < -0.5) return TileType.Lava;\n\n    if (n > 0.3) return def.accentTile;\n    if (n > -0.1) return def.primaryTile;\n    return def.secondaryTile;\n  }\n\n  /** Generate object for a world position (or None) */\n  getObject(tileX: number, tileY: number, rng: SeededRandom): ObjectType {\n    const biome = this.getBiome(tileX, tileY);\n    const spawns = BIOME_OBJECTS[biome];\n    const roll = rng.next();\n\n    let cumulative = 0;\n    for (const [objType, weight] of spawns) {\n      cumulative += weight;\n      if (roll < cumulative) return objType;\n    }\n\n    return ObjectType.None;\n  }\n}\n","import { TILE_WIDTH, TILE_HEIGHT, TILE_SIZE } from '../config';\n\n/**\n * Isometric coordinate math — converts between world (tile) space and screen (pixel) space.\n * Uses 2:1 diamond projection (64px wide × 32px tall tiles).\n */\nexport class IsometricHelper {\n  /**\n   * Convert world tile coordinates to screen pixel position.\n   * @param tileX - World tile X coordinate\n   * @param tileY - World tile Y coordinate\n   * @param height - Optional elevation level (each level = 16px up)\n   */\n  static worldToScreen(tileX: number, tileY: number, height: number = 0): { x: number; y: number } {\n    return {\n      x: (tileX - tileY) * (TILE_WIDTH / 2),\n      y: (tileX + tileY) * (TILE_HEIGHT / 2) - height * 16,\n    };\n  }\n\n  /**\n   * Convert screen pixel position to world tile coordinates.\n   * @param screenX - Screen X (already adjusted for camera scroll)\n   * @param screenY - Screen Y (already adjusted for camera scroll)\n   */\n  static screenToWorld(screenX: number, screenY: number): { tileX: number; tileY: number } {\n    const halfW = TILE_WIDTH / 2;\n    const halfH = TILE_HEIGHT / 2;\n    const tileX = (screenX / halfW + screenY / halfH) / 2;\n    const tileY = (screenY / halfH - screenX / halfW) / 2;\n    return {\n      tileX: Math.floor(tileX),\n      tileY: Math.floor(tileY),\n    };\n  }\n\n  /**\n   * Get the tile coordinate at a pixel world position (for entities on the map).\n   */\n  static pixelToTile(pixelX: number, pixelY: number): { tileX: number; tileY: number } {\n    return {\n      tileX: Math.floor(pixelX / TILE_SIZE),\n      tileY: Math.floor(pixelY / TILE_SIZE),\n    };\n  }\n\n  /**\n   * Get pixel world position from tile coordinate.\n   */\n  static tileToPixel(tileX: number, tileY: number): { x: number; y: number } {\n    return {\n      x: tileX * TILE_SIZE,\n      y: tileY * TILE_SIZE,\n    };\n  }\n\n  /**\n   * Deterministic tile variation hash — same tile always gets same visual variant.\n   */\n  static tileHash(x: number, y: number, variants: number): number {\n    const hash = ((x * 73856093) ^ (y * 19349663)) >>> 0;\n    return hash % variants;\n  }\n\n  /**\n   * Get rendering depth for proper isometric sorting.\n   * Tiles further down+right render on top.\n   */\n  static getDepth(tileX: number, tileY: number, layer: number = 0): number {\n    return (tileX + tileY) * 10 + layer;\n  }\n\n  /**\n   * Get chunk coordinate from tile coordinate.\n   */\n  static tileToChunk(tileX: number, tileY: number, chunkSize: number): { cx: number; cy: number } {\n    return {\n      cx: Math.floor(tileX / chunkSize),\n      cy: Math.floor(tileY / chunkSize),\n    };\n  }\n}\n","import Phaser from 'phaser';\nimport { CHUNK_SIZE, RENDER_DISTANCE, TILE_WIDTH, TILE_HEIGHT } from '../config';\nimport { SeededRandom } from './SeededRandom';\nimport { BiomeGenerator, BiomeId } from './BiomeGenerator';\nimport { TileType, ObjectType, TILE_PROPERTIES, OBJECT_PROPERTIES } from './TileRegistry';\nimport { IsometricHelper } from './IsometricHelper';\n\n/** Raw chunk data (tile + object arrays) */\nexport interface ChunkData {\n  cx: number;\n  cy: number;\n  tiles: TileType[][];\n  objects: ObjectType[][];\n  corruption: number[][];\n  biome: BiomeId;\n  dirty: boolean;\n}\n\n/** Key string for chunk map */\nfunction chunkKey(cx: number, cy: number): string {\n  return `${cx},${cy}`;\n}\n\n/**\n * Manages infinite world chunk streaming.\n * Generates, caches, and renders 16×16 tile chunks around the camera.\n */\nexport class ChunkManager {\n  private scene: Phaser.Scene;\n  private rng: SeededRandom;\n  private biomeGen: BiomeGenerator;\n\n  /** Generated chunk data */\n  private chunks: Map<string, ChunkData> = new Map();\n\n  /** Phaser containers holding rendered sprites per chunk */\n  private chunkContainers: Map<string, Phaser.GameObjects.Container> = new Map();\n\n  /** Currently loaded chunk coordinates */\n  private loadedChunks: Set<string> = new Set();\n\n  /** Last camera chunk position (to detect movement) */\n  private lastCamCX = -9999;\n  private lastCamCY = -9999;\n\n  constructor(scene: Phaser.Scene, seed: number = 42069) {\n    this.scene = scene;\n    this.rng = new SeededRandom(seed);\n    this.biomeGen = new BiomeGenerator(seed);\n  }\n\n  /** Generate chunk data (tiles + objects) deterministically */\n  generateChunk(cx: number, cy: number): ChunkData {\n    const key = chunkKey(cx, cy);\n    if (this.chunks.has(key)) return this.chunks.get(key)!;\n\n    const tiles: TileType[][] = [];\n    const objects: ObjectType[][] = [];\n    const corruption: number[][] = [];\n\n    // Determine dominant biome for chunk\n    const centerTileX = cx * CHUNK_SIZE + CHUNK_SIZE / 2;\n    const centerTileY = cy * CHUNK_SIZE + CHUNK_SIZE / 2;\n    const biome = this.biomeGen.getBiome(centerTileX, centerTileY);\n\n    for (let ly = 0; ly < CHUNK_SIZE; ly++) {\n      tiles[ly] = [];\n      objects[ly] = [];\n      corruption[ly] = [];\n      for (let lx = 0; lx < CHUNK_SIZE; lx++) {\n        const worldTileX = cx * CHUNK_SIZE + lx;\n        const worldTileY = cy * CHUNK_SIZE + ly;\n\n        tiles[ly][lx] = this.biomeGen.getTile(worldTileX, worldTileY);\n\n        // Seed RNG per-tile for deterministic object spawning\n        this.rng.setSeed(worldTileX, worldTileY);\n\n        // Don't spawn objects on water/lava\n        const tileProps = TILE_PROPERTIES[tiles[ly][lx]];\n        if (tileProps.solid) {\n          objects[ly][lx] = ObjectType.None;\n        } else {\n          objects[ly][lx] = this.biomeGen.getObject(worldTileX, worldTileY, this.rng);\n        }\n\n        corruption[ly][lx] = 0;\n      }\n    }\n\n    const data: ChunkData = { cx, cy, tiles, objects, corruption, biome, dirty: false };\n    this.chunks.set(key, data);\n    return data;\n  }\n\n  /** Render a chunk as a Phaser container of sprites */\n  private renderChunk(data: ChunkData): Phaser.GameObjects.Container {\n    const container = this.scene.add.container(0, 0);\n\n    for (let ly = 0; ly < CHUNK_SIZE; ly++) {\n      for (let lx = 0; lx < CHUNK_SIZE; lx++) {\n        const worldTileX = data.cx * CHUNK_SIZE + lx;\n        const worldTileY = data.cy * CHUNK_SIZE + ly;\n        const screen = IsometricHelper.worldToScreen(worldTileX, worldTileY);\n\n        // Tile sprite\n        const tileType = data.tiles[ly][lx];\n        const tileProps = TILE_PROPERTIES[tileType];\n        const tile = this.scene.add.image(screen.x, screen.y, tileProps.texture);\n        tile.setDepth(IsometricHelper.getDepth(worldTileX, worldTileY, 0));\n        container.add(tile);\n\n        // Object sprite (if any)\n        const objType = data.objects[ly][lx];\n        if (objType !== ObjectType.None) {\n          const objProps = OBJECT_PROPERTIES[objType];\n          if (objProps.texture) {\n            const obj = this.scene.add.image(screen.x, screen.y, objProps.texture);\n            obj.setOrigin(0.5, 1);\n            obj.setScale(objProps.scale);\n            obj.setDepth(IsometricHelper.getDepth(worldTileX, worldTileY, 1));\n            container.add(obj);\n          }\n        }\n      }\n    }\n\n    return container;\n  }\n\n  /** Load chunk (generate + render) */\n  private loadChunk(cx: number, cy: number): void {\n    const key = chunkKey(cx, cy);\n    if (this.loadedChunks.has(key)) return;\n\n    const data = this.generateChunk(cx, cy);\n    const container = this.renderChunk(data);\n    this.chunkContainers.set(key, container);\n    this.loadedChunks.add(key);\n  }\n\n  /** Unload chunk (destroy rendered sprites, keep data cached) */\n  private unloadChunk(cx: number, cy: number): void {\n    const key = chunkKey(cx, cy);\n    const container = this.chunkContainers.get(key);\n    if (container) {\n      container.destroy(true);\n      this.chunkContainers.delete(key);\n    }\n    this.loadedChunks.delete(key);\n  }\n\n  /**\n   * Update loaded chunks around camera position.\n   * Call this in scene.update() with camera world coordinates.\n   */\n  update(cameraWorldX: number, cameraWorldY: number): void {\n    // Convert camera screen position to approximate tile, then chunk\n    const approxTileX = cameraWorldX / (TILE_WIDTH / 2);\n    const approxTileY = cameraWorldY / (TILE_HEIGHT / 2);\n    const camCX = Math.floor(approxTileX / CHUNK_SIZE);\n    const camCY = Math.floor(approxTileY / CHUNK_SIZE);\n\n    // Only update if camera moved to a new chunk\n    if (camCX === this.lastCamCX && camCY === this.lastCamCY) return;\n    this.lastCamCX = camCX;\n    this.lastCamCY = camCY;\n\n    // Determine which chunks should be loaded\n    const desiredChunks = new Set<string>();\n    const rd = RENDER_DISTANCE;\n    for (let dy = -rd; dy <= rd; dy++) {\n      for (let dx = -rd; dx <= rd; dx++) {\n        desiredChunks.add(chunkKey(camCX + dx, camCY + dy));\n      }\n    }\n\n    // Unload chunks that are too far\n    for (const key of this.loadedChunks) {\n      if (!desiredChunks.has(key)) {\n        const [cxStr, cyStr] = key.split(',');\n        this.unloadChunk(parseInt(cxStr), parseInt(cyStr));\n      }\n    }\n\n    // Load new chunks\n    for (const key of desiredChunks) {\n      if (!this.loadedChunks.has(key)) {\n        const [cxStr, cyStr] = key.split(',');\n        this.loadChunk(parseInt(cxStr), parseInt(cyStr));\n      }\n    }\n  }\n\n  /** Get chunk data (generates if needed) */\n  getChunkData(cx: number, cy: number): ChunkData {\n    return this.generateChunk(cx, cy);\n  }\n\n  /** Get tile at world tile coordinates */\n  getTileAt(tileX: number, tileY: number): TileType {\n    const { cx, cy } = IsometricHelper.tileToChunk(tileX, tileY, CHUNK_SIZE);\n    const data = this.generateChunk(cx, cy);\n    const lx = ((tileX % CHUNK_SIZE) + CHUNK_SIZE) % CHUNK_SIZE;\n    const ly = ((tileY % CHUNK_SIZE) + CHUNK_SIZE) % CHUNK_SIZE;\n    return data.tiles[ly][lx];\n  }\n\n  /** Get biome at world tile coordinates */\n  getBiomeAt(tileX: number, tileY: number): BiomeId {\n    return this.biomeGen.getBiome(tileX, tileY);\n  }\n\n  /** Get corruption level at world tile coordinates */\n  getCorruptionAt(tileX: number, tileY: number): number {\n    const { cx, cy } = IsometricHelper.tileToChunk(tileX, tileY, CHUNK_SIZE);\n    const key = chunkKey(cx, cy);\n    const data = this.chunks.get(key);\n    if (!data) return 0;\n    const lx = ((tileX % CHUNK_SIZE) + CHUNK_SIZE) % CHUNK_SIZE;\n    const ly = ((tileY % CHUNK_SIZE) + CHUNK_SIZE) % CHUNK_SIZE;\n    return data.corruption[ly][lx];\n  }\n\n  /** Get object at world tile coordinates */\n  getObjectAt(tileX: number, tileY: number): ObjectType {\n    const { cx, cy } = IsometricHelper.tileToChunk(tileX, tileY, CHUNK_SIZE);\n    const data = this.generateChunk(cx, cy);\n    const lx = ((tileX % CHUNK_SIZE) + CHUNK_SIZE) % CHUNK_SIZE;\n    const ly = ((tileY % CHUNK_SIZE) + CHUNK_SIZE) % CHUNK_SIZE;\n    return data.objects[ly][lx];\n  }\n\n  /** Set object at world tile coordinates */\n  setObjectAt(tileX: number, tileY: number, obj: ObjectType): void {\n    const { cx, cy } = IsometricHelper.tileToChunk(tileX, tileY, CHUNK_SIZE);\n    const key = chunkKey(cx, cy);\n    const data = this.chunks.get(key);\n    if (!data) return;\n    const lx = ((tileX % CHUNK_SIZE) + CHUNK_SIZE) % CHUNK_SIZE;\n    const ly = ((tileY % CHUNK_SIZE) + CHUNK_SIZE) % CHUNK_SIZE;\n    data.objects[ly][lx] = obj;\n    data.dirty = true;\n  }\n\n  /** Set tile at world tile coordinates */\n  setTileAt(tileX: number, tileY: number, tile: TileType): void {\n    const { cx, cy } = IsometricHelper.tileToChunk(tileX, tileY, CHUNK_SIZE);\n    const key = chunkKey(cx, cy);\n    const data = this.chunks.get(key);\n    if (!data) return;\n    const lx = ((tileX % CHUNK_SIZE) + CHUNK_SIZE) % CHUNK_SIZE;\n    const ly = ((tileY % CHUNK_SIZE) + CHUNK_SIZE) % CHUNK_SIZE;\n    data.tiles[ly][lx] = tile;\n    data.dirty = true;\n  }\n\n  /** Destroy and re-render a chunk (call after mutating tile/object data) */\n  rerenderChunk(cx: number, cy: number): void {\n    const key = chunkKey(cx, cy);\n    const container = this.chunkContainers.get(key);\n    if (container) {\n      container.destroy(true);\n      this.chunkContainers.delete(key);\n    }\n    const data = this.chunks.get(key);\n    if (data && this.loadedChunks.has(key)) {\n      const newContainer = this.renderChunk(data);\n      this.chunkContainers.set(key, newContainer);\n    }\n  }\n\n  /** Rerender the chunk that contains a given world tile */\n  rerenderChunkAt(tileX: number, tileY: number): void {\n    const { cx, cy } = IsometricHelper.tileToChunk(tileX, tileY, CHUNK_SIZE);\n    this.rerenderChunk(cx, cy);\n  }\n\n  /** Set corruption level at world tile coordinates */\n  setCorruptionAt(tileX: number, tileY: number, value: number): void {\n    const { cx, cy } = IsometricHelper.tileToChunk(tileX, tileY, CHUNK_SIZE);\n    const key = chunkKey(cx, cy);\n    const data = this.chunks.get(key);\n    if (!data) return;\n    const lx = ((tileX % CHUNK_SIZE) + CHUNK_SIZE) % CHUNK_SIZE;\n    const ly = ((tileY % CHUNK_SIZE) + CHUNK_SIZE) % CHUNK_SIZE;\n    data.corruption[ly][lx] = Math.max(0, Math.min(1, value));\n    data.dirty = true;\n  }\n\n  /** Get keys for all currently loaded chunks */\n  getActiveChunkKeys(): string[] {\n    return Array.from(this.loadedChunks);\n  }\n\n  /** Destroy all chunks and free memory */\n  destroy(): void {\n    for (const container of this.chunkContainers.values()) {\n      container.destroy(true);\n    }\n    this.chunkContainers.clear();\n    this.chunks.clear();\n    this.loadedChunks.clear();\n  }\n}\n","import { defineComponent, Types } from 'bitecs';\n\n// ── Core Transform ──\nexport const Position = defineComponent({\n  x: Types.f32,\n  y: Types.f32,\n});\n\nexport const Velocity = defineComponent({\n  vx: Types.f32,\n  vy: Types.f32,\n});\n\n// ── Rendering ──\nexport const Sprite = defineComponent({\n  textureId: Types.ui16,   // Index into texture registry\n  frame: Types.ui16,\n  flipX: Types.ui8,        // 0 or 1\n  scaleX: Types.f32,\n  scaleY: Types.f32,\n  visible: Types.ui8,\n});\n\n// ── Combat Stats ──\nexport const Health = defineComponent({\n  current: Types.f32,\n  max: Types.f32,\n});\n\nexport const Stamina = defineComponent({\n  current: Types.f32,\n  max: Types.f32,\n  regenRate: Types.f32,\n});\n\n/**\n * Status effect index for weapon synergy system.\n * 0=none, 1=poison, 2=burn, 3=freeze, 4=bleed, 5=stun\n */\nexport const enum SynergyStatus { None=0, Poison=1, Burn=2, Freeze=3, Bleed=4, Stun=5 }\n\nexport const Combat = defineComponent({\n  damage: Types.f32,\n  defense: Types.f32,\n  critChance: Types.f32,\n  critMult: Types.f32,\n  attackSpeed: Types.f32,\n  attackCooldown: Types.f32,  // Timer (counts down to 0)\n  weaponType: Types.ui8,      // WeaponType enum\n  level: Types.ui16,\n  xp: Types.ui32,\n  synergyStatus: Types.ui8,   // SynergyStatus enum — bonus damage vs this status\n  synergyMult: Types.f32,     // Damage multiplier when target has synergy status (e.g. 1.75 = +75%)\n});\n\n// ── Entity Tags ──\nexport const PlayerTag = defineComponent();\nexport const EnemyTag = defineComponent();\nexport const NPCTag = defineComponent();\nexport const ProjectileTag = defineComponent();\nexport const BossTag = defineComponent();\nexport const LootDropTag = defineComponent();\n\n// ── AI ──\nexport const AI = defineComponent({\n  state: Types.ui8,          // AIState enum\n  behavior: Types.ui8,       // AIBehavior enum\n  aggroRadius: Types.f32,\n  targetEid: Types.eid,\n  homeX: Types.f32,\n  homeY: Types.f32,\n  patrolRadius: Types.f32,\n  lastAttackTime: Types.f32,\n  telegraphTimer: Types.f32,    // Countdown before attack fires (>0 = winding up)\n  telegraphDuration: Types.f32, // Total telegraph length (for visual progress bar)\n});\n\n// ── Collision ──\nexport const Collider = defineComponent({\n  radius: Types.f32,\n  solid: Types.ui8,\n});\n\n// ── Equipment (indices into item DB, 0 = empty) ──\nexport const Equipment = defineComponent({\n  weapon: Types.ui16,\n  shield: Types.ui16,\n  head: Types.ui16,\n  chest: Types.ui16,\n  legs: Types.ui16,\n  feet: Types.ui16,\n  hands: Types.ui16,\n  ring1: Types.ui16,\n  ring2: Types.ui16,\n  necklace: Types.ui16,\n});\n\n// ── Inventory (36 slots — stores item ID, 0 = empty) ──\nexport const Inventory = defineComponent({\n  slots: [Types.ui16, 36],\n  counts: [Types.ui8, 36],\n});\n\n// ── Corruption exposure ──\nexport const Corruption = defineComponent({\n  exposure: Types.f32,   // Current accumulated exposure\n  resistance: Types.f32, // Reduces accumulation rate\n});\n\n// ── Faction ──\nexport const Faction = defineComponent({\n  id: Types.ui8,  // FactionId enum\n});\n\n// ── Loot Drop ──\nexport const LootDrop = defineComponent({\n  itemId: Types.ui16,\n  quantity: Types.ui8,\n  rarity: Types.ui8,\n  despawnTimer: Types.f32,\n});\n\n// ── Projectile data ──\nexport const Projectile = defineComponent({\n  ownerEid: Types.eid,\n  damage: Types.f32,\n  speed: Types.f32,\n  lifetime: Types.f32,\n  piercing: Types.ui8,\n});\n\n// ── Animation ──\nexport const Animation = defineComponent({\n  currentAnim: Types.ui16,  // Animation ID\n  frameTimer: Types.f32,\n  frameIndex: Types.ui8,\n  loop: Types.ui8,\n});\n\n/** Weapon type enum */\nexport enum WeaponType {\n  Unarmed = 0,\n  Sword = 1,\n  Axe = 2,\n  Spear = 3,\n  Bow = 4,\n  Staff = 5,\n  Dagger = 6,\n  Hammer = 7,\n}\n\n// ── Status Effects ──\nexport const StatusEffects = defineComponent({\n  poison: Types.f32,      // remaining duration (0 = not active)\n  burn: Types.f32,\n  freeze: Types.f32,\n  bleed: Types.f32,\n  stun: Types.f32,\n  poisonDmg: Types.f32,   // damage per second\n  burnDmg: Types.f32,\n  bleedDmg: Types.f32,\n});\n\n// ── Elite Affixes (Dead Cells-inspired) ──\nexport const EliteAffix = defineComponent({\n  affix1: Types.ui8,        // AffixId enum value (0 = none)\n  affix2: Types.ui8,        // Second affix (0 = none)\n  shieldHits: Types.ui8,    // Remaining shield hits (for Shielded affix)\n  speedMult: Types.f32,     // Cached speed multiplier from affixes\n  lootBonus: Types.ui8,     // Total loot rarity bonus from affixes\n});\n\n/** AI behavior enum — determines how state transitions and actions work */\nexport enum AIBehavior {\n  Wander = 0,       // random movement, attack when close (default)\n  Chase = 1,        // direct pursuit\n  Swoop = 2,        // circle -> dive -> retreat (flying)\n  Ranged = 3,       // maintain distance, fire projectiles\n  Ambush = 4,       // hidden until player close, bonus damage\n  Support = 5,      // heal most-damaged ally\n  Phase = 6,        // teleport, move through walls\n  Pack = 7,         // call reinforcements, flanking\n  Stationary = 8,   // immobile, area denial\n}\n\n/** AI state enum */\nexport enum AIState {\n  Idle = 0,\n  Patrol = 1,\n  Chase = 2,\n  Attack = 3,\n  Flee = 4,\n  Special = 5,\n  Dead = 6,\n}\n","import { createWorld, addEntity, addComponent } from 'bitecs';\nimport {\n  Position, Velocity, Sprite, Health, Stamina, Combat,\n  PlayerTag, EnemyTag, NPCTag, ProjectileTag,\n  AI, Collider, Equipment, Inventory, Corruption,\n  Animation, WeaponType, AIState, StatusEffects, AIBehavior,\n  EliteAffix,\n} from './components';\nimport { PLAYER_MAX_HP, PLAYER_MAX_STAMINA, STAMINA_REGEN_RATE, CRIT_BASE_CHANCE, CRIT_BASE_MULT } from '../config';\n\n/** The single ECS world instance */\nexport const ecsWorld = createWorld();\n\n/** Texture name → ID registry (for Sprite component) */\nconst textureRegistry: string[] = [];\nconst textureMap = new Map<string, number>();\n\nexport function registerTexture(name: string): number {\n  if (textureMap.has(name)) return textureMap.get(name)!;\n  const id = textureRegistry.length;\n  textureRegistry.push(name);\n  textureMap.set(name, id);\n  return id;\n}\n\nexport function getTextureName(id: number): string {\n  return textureRegistry[id] ?? 'player';\n}\n\n/** Create the player entity */\nexport function createPlayer(x: number, y: number): number {\n  const eid = addEntity(ecsWorld);\n  addComponent(ecsWorld, Position, eid);\n  addComponent(ecsWorld, Velocity, eid);\n  addComponent(ecsWorld, Sprite, eid);\n  addComponent(ecsWorld, Health, eid);\n  addComponent(ecsWorld, Stamina, eid);\n  addComponent(ecsWorld, Combat, eid);\n  addComponent(ecsWorld, PlayerTag, eid);\n  addComponent(ecsWorld, Collider, eid);\n  addComponent(ecsWorld, Equipment, eid);\n  addComponent(ecsWorld, Inventory, eid);\n  addComponent(ecsWorld, Corruption, eid);\n  addComponent(ecsWorld, Animation, eid);\n  addComponent(ecsWorld, StatusEffects, eid);\n\n  Position.x[eid] = x;\n  Position.y[eid] = y;\n  Sprite.textureId[eid] = registerTexture('player');\n  Sprite.visible[eid] = 1;\n  Sprite.scaleX[eid] = 1;\n  Sprite.scaleY[eid] = 1;\n  Health.current[eid] = PLAYER_MAX_HP;\n  Health.max[eid] = PLAYER_MAX_HP;\n  Stamina.current[eid] = PLAYER_MAX_STAMINA;\n  Stamina.max[eid] = PLAYER_MAX_STAMINA;\n  Stamina.regenRate[eid] = STAMINA_REGEN_RATE;\n  Combat.damage[eid] = 10;\n  Combat.defense[eid] = 5;\n  Combat.critChance[eid] = CRIT_BASE_CHANCE;\n  Combat.critMult[eid] = CRIT_BASE_MULT;\n  Combat.attackSpeed[eid] = 1.0;\n  Combat.level[eid] = 1;\n  Collider.radius[eid] = 8;\n  Collider.solid[eid] = 1;\n\n  return eid;\n}\n\n/** Create an enemy entity */\nexport function createEnemy(\n  x: number, y: number,\n  hp: number, damage: number, defense: number,\n  aggroRadius: number = 120,\n  texture: string = 'enemy',\n  behavior: AIBehavior = AIBehavior.Wander,\n  affixes: [number, number] = [0, 0],\n): number {\n  const eid = addEntity(ecsWorld);\n  addComponent(ecsWorld, Position, eid);\n  addComponent(ecsWorld, Velocity, eid);\n  addComponent(ecsWorld, Sprite, eid);\n  addComponent(ecsWorld, Health, eid);\n  addComponent(ecsWorld, Combat, eid);\n  addComponent(ecsWorld, EnemyTag, eid);\n  addComponent(ecsWorld, AI, eid);\n  addComponent(ecsWorld, Collider, eid);\n  addComponent(ecsWorld, Animation, eid);\n  addComponent(ecsWorld, StatusEffects, eid);\n  addComponent(ecsWorld, EliteAffix, eid);\n\n  Position.x[eid] = x;\n  Position.y[eid] = y;\n  Sprite.textureId[eid] = registerTexture(texture);\n  Sprite.visible[eid] = 1;\n  Sprite.scaleX[eid] = 1;\n  Sprite.scaleY[eid] = 1;\n  Health.current[eid] = hp;\n  Health.max[eid] = hp;\n  Combat.damage[eid] = damage;\n  Combat.defense[eid] = defense;\n  Combat.critChance[eid] = 0.03;\n  Combat.critMult[eid] = 1.3;\n  Combat.attackSpeed[eid] = 1.0;\n  AI.state[eid] = AIState.Idle;\n  AI.behavior[eid] = behavior;\n  AI.aggroRadius[eid] = aggroRadius;\n  AI.homeX[eid] = x;\n  AI.homeY[eid] = y;\n  AI.patrolRadius[eid] = 80;\n  Collider.radius[eid] = 8;\n  Collider.solid[eid] = 1;\n\n  // Elite affix system\n  EliteAffix.affix1[eid] = affixes[0];\n  EliteAffix.affix2[eid] = affixes[1];\n  EliteAffix.shieldHits[eid] = 0;\n  EliteAffix.speedMult[eid] = 1.0;\n  EliteAffix.lootBonus[eid] = 0;\n\n  return eid;\n}\n\n/** Create an NPC entity */\nexport function createNPC(\n  x: number, y: number,\n  texture: string = 'npc',\n): number {\n  const eid = addEntity(ecsWorld);\n  addComponent(ecsWorld, Position, eid);\n  addComponent(ecsWorld, Velocity, eid);\n  addComponent(ecsWorld, Sprite, eid);\n  addComponent(ecsWorld, Health, eid);\n  addComponent(ecsWorld, NPCTag, eid);\n  addComponent(ecsWorld, AI, eid);\n  addComponent(ecsWorld, Collider, eid);\n  addComponent(ecsWorld, Animation, eid);\n\n  Position.x[eid] = x;\n  Position.y[eid] = y;\n  Sprite.textureId[eid] = registerTexture(texture);\n  Sprite.visible[eid] = 1;\n  Sprite.scaleX[eid] = 1;\n  Sprite.scaleY[eid] = 1;\n  Health.current[eid] = 100;\n  Health.max[eid] = 100;\n  AI.state[eid] = AIState.Idle;\n  AI.aggroRadius[eid] = 0; // NPCs don't aggro\n  AI.homeX[eid] = x;\n  AI.homeY[eid] = y;\n  AI.patrolRadius[eid] = 40;\n  Collider.radius[eid] = 8;\n  Collider.solid[eid] = 1;\n\n  return eid;\n}\n\n/** Create a projectile entity */\nexport function createProjectile(\n  x: number, y: number,\n  vx: number, vy: number,\n  damage: number, ownerEid: number,\n  texture: string = 'projectile',\n): number {\n  const eid = addEntity(ecsWorld);\n  addComponent(ecsWorld, Position, eid);\n  addComponent(ecsWorld, Velocity, eid);\n  addComponent(ecsWorld, Sprite, eid);\n  addComponent(ecsWorld, ProjectileTag, eid);\n  addComponent(ecsWorld, Collider, eid);\n\n  Position.x[eid] = x;\n  Position.y[eid] = y;\n  Velocity.vx[eid] = vx;\n  Velocity.vy[eid] = vy;\n  Sprite.textureId[eid] = registerTexture(texture);\n  Sprite.visible[eid] = 1;\n  Sprite.scaleX[eid] = 1;\n  Sprite.scaleY[eid] = 1;\n  Collider.radius[eid] = 4;\n  Collider.solid[eid] = 0;\n\n  // Store damage data — using Combat component for simplicity\n  addComponent(ecsWorld, Combat, eid);\n  Combat.damage[eid] = damage;\n\n  return eid;\n}\n","import { defineQuery } from 'bitecs';\nimport { Position, Velocity } from '../components';\n\nconst movementQuery = defineQuery([Position, Velocity]);\n\n/**\n * Applies velocity to position for all entities with both components.\n * Delta is in seconds.\n */\nexport function movementSystem(world: object, delta: number): void {\n  const entities = movementQuery(world);\n  for (const eid of entities) {\n    Position.x[eid] += Velocity.vx[eid] * delta;\n    Position.y[eid] += Velocity.vy[eid] * delta;\n  }\n}\n","import { defineQuery } from 'bitecs';\nimport { Animation, Sprite, Velocity } from '../components';\n\nconst animQuery = defineQuery([Animation, Sprite]);\n\n/**\n * Updates animation frame timers and sprite frames.\n * Delta is in seconds.\n */\nexport function animationSystem(world: object, delta: number): void {\n  const entities = animQuery(world);\n  const FRAME_DURATION = 0.15; // seconds per frame\n\n  for (const eid of entities) {\n    Animation.frameTimer[eid] += delta;\n\n    if (Animation.frameTimer[eid] >= FRAME_DURATION) {\n      Animation.frameTimer[eid] -= FRAME_DURATION;\n      Animation.frameIndex[eid] = (Animation.frameIndex[eid] + 1) % 4;\n      Sprite.frame[eid] = Animation.frameIndex[eid];\n    }\n\n    // Flip sprite based on horizontal velocity\n    if (Velocity.vx[eid] < 0) {\n      Sprite.flipX[eid] = 1;\n    } else if (Velocity.vx[eid] > 0) {\n      Sprite.flipX[eid] = 0;\n    }\n  }\n}\n","import { defineQuery, hasComponent } from 'bitecs';\nimport {\n  Position, Velocity, Health, Combat, AI,\n  EnemyTag, PlayerTag, AIState, AIBehavior,\n  StatusEffects, Sprite, Collider, EliteAffix,\n} from '../components';\nimport { createEnemy, createProjectile } from '../world';\n\nconst aiQuery = defineQuery([Position, Velocity, AI, EnemyTag]);\nconst playerQuery = defineQuery([Position, PlayerTag]);\nconst enemyQuery = defineQuery([Position, Health, EnemyTag]);\n\n// ── Per-entity behavior timers (not in ECS to keep components lean) ──\n\ninterface BehaviorState {\n  swoopPhase: number;          // 0 = circling, 1 = diving, 2 = retreating\n  swoopAngle: number;          // Current angle around target\n  rangedCooldown: number;      // Time until next ranged shot\n  ambushRevealed: boolean;     // Whether ambush enemy has been revealed\n  phaseCooldown: number;       // Time until next teleport\n  packSpawned: boolean;        // Whether pack allies have been spawned\n  supportHealCooldown: number; // Time between heal ticks\n}\n\n/** Start a telegraph wind-up when an enemy enters attack range. */\nfunction beginTelegraph(eid: number): void {\n  const duration = 0.3 + Math.random() * 0.5; // 0.3s–0.8s (Dark Souls-style wind-up)\n  AI.telegraphTimer[eid] = duration;\n  AI.telegraphDuration[eid] = duration;\n}\n\n/**\n * Tick the telegraph timer. Returns true if still telegraphing (attack not yet ready).\n * When telegraph finishes, resets timer to 0 so the attack fires normally.\n */\nfunction tickTelegraph(eid: number, delta: number): boolean {\n  if (AI.telegraphTimer[eid] <= 0) return false;\n  AI.telegraphTimer[eid] -= delta;\n  if (AI.telegraphTimer[eid] <= 0) {\n    AI.telegraphTimer[eid] = 0;\n    // Telegraph complete — attack fires this frame\n    return false;\n  }\n  return true; // Still winding up\n}\n\nconst behaviorStates = new Map<number, BehaviorState>();\n\nfunction getState(eid: number): BehaviorState {\n  let s = behaviorStates.get(eid);\n  if (!s) {\n    s = {\n      swoopPhase: 0,\n      swoopAngle: Math.random() * Math.PI * 2,\n      rangedCooldown: 0,\n      ambushRevealed: false,\n      phaseCooldown: 3,\n      packSpawned: false,\n      supportHealCooldown: 0,\n    };\n    behaviorStates.set(eid, s);\n  }\n  return s;\n}\n\n/**\n * Enemy AI state machine with 9 behavior types that modify how states work.\n * @param aggroMult Multiplier for aggro radius (e.g. weather visibility: 0.5 = half detection range)\n */\nexport function aiSystem(world: object, delta: number, aggroMult: number = 1): void {\n  const enemies = aiQuery(world);\n  const players = playerQuery(world);\n  if (players.length === 0) return;\n\n  const playerEid = players[0];\n  const px = Position.x[playerEid];\n  const py = Position.y[playerEid];\n\n  for (const eid of enemies) {\n    if (Health.current[eid] <= 0) {\n      AI.state[eid] = AIState.Dead;\n      Velocity.vx[eid] = 0;\n      Velocity.vy[eid] = 0;\n      continue;\n    }\n\n    // Skip AI update if stunned\n    if (hasComponent(world, StatusEffects, eid) && StatusEffects.stun[eid] > 0) {\n      Velocity.vx[eid] = 0;\n      Velocity.vy[eid] = 0;\n      continue;\n    }\n\n    const ex = Position.x[eid];\n    const ey = Position.y[eid];\n    const dx = px - ex;\n    const dy = py - ey;\n    const distToPlayer = Math.sqrt(dx * dx + dy * dy);\n\n    const aggroRadius = AI.aggroRadius[eid] * aggroMult;\n    const homeX = AI.homeX[eid];\n    const homeY = AI.homeY[eid];\n    const patrolRadius = AI.patrolRadius[eid];\n    const distToHome = Math.sqrt((ex - homeX) ** 2 + (ey - homeY) ** 2);\n    const behavior = AI.behavior[eid] as AIBehavior;\n\n    const eliteSpeedMult = hasComponent(world, EliteAffix, eid) ? EliteAffix.speedMult[eid] : 1;\n    const speed = 60 * eliteSpeedMult; // Base enemy speed × elite affix modifier\n\n    // Dispatch based on behavior type\n    switch (behavior) {\n      case AIBehavior.Chase:\n        updateChase(eid, dx, dy, distToPlayer, aggroRadius, distToHome, patrolRadius, speed, delta);\n        break;\n      case AIBehavior.Swoop:\n        updateSwoop(eid, world, px, py, ex, ey, distToPlayer, aggroRadius, distToHome, patrolRadius, speed, delta);\n        break;\n      case AIBehavior.Ranged:\n        updateRanged(eid, world, px, py, ex, ey, dx, dy, distToPlayer, aggroRadius, distToHome, patrolRadius, speed, delta);\n        break;\n      case AIBehavior.Ambush:\n        updateAmbush(eid, world, dx, dy, distToPlayer, aggroRadius, distToHome, patrolRadius, speed, delta);\n        break;\n      case AIBehavior.Support:\n        updateSupport(eid, world, dx, dy, distToPlayer, aggroRadius, distToHome, patrolRadius, speed, delta, playerEid);\n        break;\n      case AIBehavior.Phase:\n        updatePhase(eid, world, px, py, dx, dy, distToPlayer, aggroRadius, distToHome, patrolRadius, speed, delta);\n        break;\n      case AIBehavior.Pack:\n        updatePack(eid, world, px, py, dx, dy, distToPlayer, aggroRadius, distToHome, patrolRadius, speed, delta, playerEid);\n        break;\n      case AIBehavior.Stationary:\n        updateStationary(eid, distToPlayer, delta);\n        break;\n      case AIBehavior.Wander:\n      default:\n        updateWander(eid, world, dx, dy, distToPlayer, aggroRadius, homeX, homeY, distToHome, patrolRadius, speed, delta, playerEid);\n        break;\n    }\n  }\n}\n\n// ── Wander (default) ──\n// Random patrol, chase on aggro — same as the original behavior.\n\nfunction updateWander(\n  eid: number, world: object,\n  dx: number, dy: number, distToPlayer: number,\n  aggroRadius: number, homeX: number, homeY: number,\n  distToHome: number, patrolRadius: number, speed: number,\n  delta: number, playerEid: number,\n): void {\n  const ex = Position.x[eid];\n  const ey = Position.y[eid];\n\n  switch (AI.state[eid]) {\n    case AIState.Idle: {\n      Velocity.vx[eid] = 0;\n      Velocity.vy[eid] = 0;\n      if (distToPlayer < aggroRadius) {\n        AI.state[eid] = AIState.Chase;\n        AI.targetEid[eid] = playerEid;\n        break;\n      }\n      if (Math.random() < 0.005) {\n        AI.state[eid] = AIState.Patrol;\n      }\n      break;\n    }\n    case AIState.Patrol: {\n      const angle = Math.random() * Math.PI * 2;\n      const targetX = homeX + Math.cos(angle) * patrolRadius * 0.5;\n      const targetY = homeY + Math.sin(angle) * patrolRadius * 0.5;\n      const pdx = targetX - ex;\n      const pdy = targetY - ey;\n      const pDist = Math.sqrt(pdx * pdx + pdy * pdy);\n      if (pDist > 4) {\n        Velocity.vx[eid] = (pdx / pDist) * speed * 0.5;\n        Velocity.vy[eid] = (pdy / pDist) * speed * 0.5;\n      } else {\n        AI.state[eid] = AIState.Idle;\n      }\n      if (distToPlayer < aggroRadius) {\n        AI.state[eid] = AIState.Chase;\n        AI.targetEid[eid] = playerEid;\n      }\n      if (distToHome > patrolRadius) {\n        AI.state[eid] = AIState.Idle;\n      }\n      break;\n    }\n    case AIState.Chase: {\n      if (distToPlayer > 2) {\n        Velocity.vx[eid] = (dx / distToPlayer) * speed;\n        Velocity.vy[eid] = (dy / distToPlayer) * speed;\n      }\n      if (distToPlayer < 20) {\n        AI.state[eid] = AIState.Attack;\n        beginTelegraph(eid);\n      }\n      if (distToPlayer > aggroRadius * 1.5 || distToHome > patrolRadius * 3) {\n        AI.state[eid] = AIState.Idle;\n        Velocity.vx[eid] = 0;\n        Velocity.vy[eid] = 0;\n      }\n      break;\n    }\n    case AIState.Attack: {\n      Velocity.vx[eid] = 0;\n      Velocity.vy[eid] = 0;\n      // Telegraph wind-up: enemy is locked but hasn't attacked yet\n      if (!tickTelegraph(eid, delta)) {\n        AI.lastAttackTime[eid] += delta;\n      }\n      if (distToPlayer > 24) {\n        AI.state[eid] = AIState.Chase;\n        AI.telegraphTimer[eid] = 0;\n      }\n      if (Health.current[eid] < Health.max[eid] * 0.15) {\n        if (hasComponent(world, Combat, eid) && Combat.level[eid] < 10) {\n          AI.state[eid] = AIState.Flee;\n          AI.telegraphTimer[eid] = 0;\n        }\n      }\n      break;\n    }\n    case AIState.Flee: {\n      if (distToPlayer > 0) {\n        Velocity.vx[eid] = -(dx / distToPlayer) * speed * 1.2;\n        Velocity.vy[eid] = -(dy / distToPlayer) * speed * 1.2;\n      }\n      if (distToPlayer > aggroRadius * 2) {\n        AI.state[eid] = AIState.Idle;\n      }\n      break;\n    }\n    case AIState.Dead: {\n      Velocity.vx[eid] = 0;\n      Velocity.vy[eid] = 0;\n      break;\n    }\n  }\n}\n\n// ── Chase ──\n// Faster pursuit speed (1.5x), never retreats.\n\nfunction updateChase(\n  eid: number,\n  dx: number, dy: number, distToPlayer: number,\n  aggroRadius: number, distToHome: number, patrolRadius: number,\n  speed: number, delta: number,\n): void {\n  const chaseSpeed = speed * 1.5;\n\n  switch (AI.state[eid]) {\n    case AIState.Idle:\n    case AIState.Patrol: {\n      Velocity.vx[eid] = 0;\n      Velocity.vy[eid] = 0;\n      if (distToPlayer < aggroRadius) {\n        AI.state[eid] = AIState.Chase;\n      }\n      break;\n    }\n    case AIState.Chase: {\n      if (distToPlayer > 2) {\n        Velocity.vx[eid] = (dx / distToPlayer) * chaseSpeed;\n        Velocity.vy[eid] = (dy / distToPlayer) * chaseSpeed;\n      }\n      if (distToPlayer < 20) {\n        AI.state[eid] = AIState.Attack;\n        beginTelegraph(eid);\n      }\n      // Chase behavior never retreats — only leash if extremely far from home\n      if (distToHome > patrolRadius * 5) {\n        AI.state[eid] = AIState.Idle;\n        Velocity.vx[eid] = 0;\n        Velocity.vy[eid] = 0;\n      }\n      break;\n    }\n    case AIState.Attack: {\n      Velocity.vx[eid] = 0;\n      Velocity.vy[eid] = 0;\n      if (!tickTelegraph(eid, delta)) {\n        AI.lastAttackTime[eid] += delta;\n      }\n      if (distToPlayer > 24) {\n        AI.state[eid] = AIState.Chase;\n        AI.telegraphTimer[eid] = 0;\n      }\n      // Chase behavior does NOT flee\n      break;\n    }\n    case AIState.Dead: {\n      Velocity.vx[eid] = 0;\n      Velocity.vy[eid] = 0;\n      break;\n    }\n  }\n}\n\n// ── Swoop ──\n// Circle at 2x aggro radius, dive in (3x speed) for 1 hit, retreat.\n\nfunction updateSwoop(\n  eid: number, world: object,\n  px: number, py: number,\n  ex: number, ey: number,\n  distToPlayer: number,\n  aggroRadius: number, distToHome: number, patrolRadius: number,\n  speed: number, delta: number,\n): void {\n  const bs = getState(eid);\n  const circleRadius = aggroRadius * 0.7;\n\n  switch (AI.state[eid]) {\n    case AIState.Idle:\n    case AIState.Patrol: {\n      if (distToPlayer < aggroRadius * 2) {\n        AI.state[eid] = AIState.Chase;\n        bs.swoopPhase = 0; // Start circling\n      } else {\n        Velocity.vx[eid] = 0;\n        Velocity.vy[eid] = 0;\n      }\n      break;\n    }\n    case AIState.Chase: {\n      if (bs.swoopPhase === 0) {\n        // Circling phase — orbit around player\n        bs.swoopAngle += delta * 1.5;\n        const targetX = px + Math.cos(bs.swoopAngle) * circleRadius;\n        const targetY = py + Math.sin(bs.swoopAngle) * circleRadius;\n        const tdx = targetX - ex;\n        const tdy = targetY - ey;\n        const tDist = Math.sqrt(tdx * tdx + tdy * tdy);\n        if (tDist > 2) {\n          Velocity.vx[eid] = (tdx / tDist) * speed;\n          Velocity.vy[eid] = (tdy / tDist) * speed;\n        }\n\n        // After circling for a bit, dive\n        AI.lastAttackTime[eid] += delta;\n        if (AI.lastAttackTime[eid] > 2.0) {\n          bs.swoopPhase = 1; // Dive\n          AI.lastAttackTime[eid] = 0;\n        }\n      } else if (bs.swoopPhase === 1) {\n        // Diving phase — move toward player at 3x speed\n        const diveSpeed = speed * 3;\n        const ddx = px - ex;\n        const ddy = py - ey;\n        const dDist = Math.sqrt(ddx * ddx + ddy * ddy);\n        if (dDist > 2) {\n          Velocity.vx[eid] = (ddx / dDist) * diveSpeed;\n          Velocity.vy[eid] = (ddy / dDist) * diveSpeed;\n        }\n        if (distToPlayer < 20) {\n          AI.state[eid] = AIState.Attack;\n          beginTelegraph(eid);\n          bs.swoopPhase = 2; // Will retreat after attack\n        }\n      }\n      break;\n    }\n    case AIState.Attack: {\n      // One attack, then retreat\n      Velocity.vx[eid] = 0;\n      Velocity.vy[eid] = 0;\n      if (!tickTelegraph(eid, delta)) {\n        AI.lastAttackTime[eid] += delta;\n      }\n      if (AI.lastAttackTime[eid] > 0.3) {\n        AI.state[eid] = AIState.Flee;\n        AI.lastAttackTime[eid] = 0;\n        AI.telegraphTimer[eid] = 0;\n        bs.swoopPhase = 2;\n      }\n      break;\n    }\n    case AIState.Flee: {\n      // Retreat away from player\n      const dx = px - ex;\n      const dy = py - ey;\n      if (distToPlayer > 0) {\n        Velocity.vx[eid] = -(dx / distToPlayer) * speed * 1.5;\n        Velocity.vy[eid] = -(dy / distToPlayer) * speed * 1.5;\n      }\n      if (distToPlayer > circleRadius * 0.9) {\n        AI.state[eid] = AIState.Chase;\n        bs.swoopPhase = 0;\n      }\n      if (distToHome > patrolRadius * 3) {\n        AI.state[eid] = AIState.Idle;\n      }\n      break;\n    }\n    case AIState.Dead: {\n      Velocity.vx[eid] = 0;\n      Velocity.vy[eid] = 0;\n      break;\n    }\n  }\n}\n\n// ── Ranged ──\n// Maintain distance (80-120px from player), fire projectile every 2s.\n\nfunction updateRanged(\n  eid: number, world: object,\n  px: number, py: number,\n  ex: number, ey: number,\n  dx: number, dy: number, distToPlayer: number,\n  aggroRadius: number, distToHome: number, patrolRadius: number,\n  speed: number, delta: number,\n): void {\n  const bs = getState(eid);\n  const idealMin = 80;\n  const idealMax = 120;\n  const idealMid = (idealMin + idealMax) / 2;\n\n  switch (AI.state[eid]) {\n    case AIState.Idle:\n    case AIState.Patrol: {\n      Velocity.vx[eid] = 0;\n      Velocity.vy[eid] = 0;\n      if (distToPlayer < aggroRadius) {\n        AI.state[eid] = AIState.Chase;\n      }\n      break;\n    }\n    case AIState.Chase: {\n      // If too close, move AWAY; if too far, move closer\n      if (distToPlayer < idealMin && distToPlayer > 0) {\n        // Too close — retreat\n        Velocity.vx[eid] = -(dx / distToPlayer) * speed;\n        Velocity.vy[eid] = -(dy / distToPlayer) * speed;\n      } else if (distToPlayer > idealMax) {\n        // Too far — approach\n        Velocity.vx[eid] = (dx / distToPlayer) * speed;\n        Velocity.vy[eid] = (dy / distToPlayer) * speed;\n      } else {\n        // In sweet spot — stop and attack\n        Velocity.vx[eid] = 0;\n        Velocity.vy[eid] = 0;\n        AI.state[eid] = AIState.Attack;\n        beginTelegraph(eid);\n      }\n\n      if (distToPlayer > aggroRadius * 1.5 || distToHome > patrolRadius * 3) {\n        AI.state[eid] = AIState.Idle;\n        Velocity.vx[eid] = 0;\n        Velocity.vy[eid] = 0;\n      }\n      break;\n    }\n    case AIState.Attack: {\n      // Maintain distance while shooting\n      if (distToPlayer < idealMin && distToPlayer > 0) {\n        Velocity.vx[eid] = -(dx / distToPlayer) * speed * 0.6;\n        Velocity.vy[eid] = -(dy / distToPlayer) * speed * 0.6;\n      } else if (distToPlayer > idealMax) {\n        AI.state[eid] = AIState.Chase;\n        AI.telegraphTimer[eid] = 0;\n        break;\n      } else {\n        Velocity.vx[eid] = 0;\n        Velocity.vy[eid] = 0;\n      }\n\n      // Telegraph wind-up before shooting\n      if (tickTelegraph(eid, delta)) break;\n\n      // Fire projectile every 2s\n      bs.rangedCooldown -= delta;\n      if (bs.rangedCooldown <= 0 && distToPlayer > 0) {\n        bs.rangedCooldown = 2.0;\n        const projSpeed = 200;\n        const pvx = (dx / distToPlayer) * projSpeed;\n        const pvy = (dy / distToPlayer) * projSpeed;\n        const dmg = hasComponent(world, Combat, eid) ? Combat.damage[eid] : 10;\n        createProjectile(ex, ey, pvx, pvy, dmg, eid, 'projectile_enemy');\n      }\n\n      if (distToPlayer > aggroRadius * 1.5) {\n        AI.state[eid] = AIState.Idle;\n      }\n      break;\n    }\n    case AIState.Flee: {\n      if (distToPlayer > 0) {\n        Velocity.vx[eid] = -(dx / distToPlayer) * speed * 1.2;\n        Velocity.vy[eid] = -(dy / distToPlayer) * speed * 1.2;\n      }\n      if (distToPlayer > aggroRadius * 2) {\n        AI.state[eid] = AIState.Idle;\n      }\n      break;\n    }\n    case AIState.Dead: {\n      Velocity.vx[eid] = 0;\n      Velocity.vy[eid] = 0;\n      break;\n    }\n  }\n}\n\n// ── Ambush ──\n// Hidden (alpha 0.2) until player within 0.5x aggro range, then charge with 2x damage first hit.\n\nfunction updateAmbush(\n  eid: number, world: object,\n  dx: number, dy: number, distToPlayer: number,\n  aggroRadius: number, distToHome: number, patrolRadius: number,\n  speed: number, delta: number,\n): void {\n  const bs = getState(eid);\n  const revealRadius = aggroRadius * 0.5;\n\n  if (!bs.ambushRevealed) {\n    // Hidden state — nearly invisible\n    if (hasComponent(world, Sprite, eid)) {\n      // Note: Sprite component doesn't have alpha, but visible=1 still shows.\n      // We'll use scaleX as a proxy flag; scene renderer should check this.\n      // For now we reduce scale to hint at \"hiding\"\n    }\n    Velocity.vx[eid] = 0;\n    Velocity.vy[eid] = 0;\n\n    if (distToPlayer < revealRadius) {\n      // REVEAL! Charge with bonus damage\n      bs.ambushRevealed = true;\n      // Apply 2x damage for first hit\n      if (hasComponent(world, Combat, eid)) {\n        Combat.damage[eid] *= 2;\n      }\n      AI.state[eid] = AIState.Chase;\n    }\n    return;\n  }\n\n  // After reveal, behave like a chase enemy\n  switch (AI.state[eid]) {\n    case AIState.Chase: {\n      const chargeSpeed = speed * 1.5;\n      if (distToPlayer > 2) {\n        Velocity.vx[eid] = (dx / distToPlayer) * chargeSpeed;\n        Velocity.vy[eid] = (dy / distToPlayer) * chargeSpeed;\n      }\n      if (distToPlayer < 20) {\n        AI.state[eid] = AIState.Attack;\n        beginTelegraph(eid);\n      }\n      if (distToPlayer > aggroRadius * 2 || distToHome > patrolRadius * 3) {\n        AI.state[eid] = AIState.Idle;\n        Velocity.vx[eid] = 0;\n        Velocity.vy[eid] = 0;\n      }\n      break;\n    }\n    case AIState.Attack: {\n      Velocity.vx[eid] = 0;\n      Velocity.vy[eid] = 0;\n      if (!tickTelegraph(eid, delta)) {\n        AI.lastAttackTime[eid] += delta;\n      }\n\n      // Revert damage after first hit\n      if (AI.lastAttackTime[eid] > 0.5 && Combat.damage[eid] > 0) {\n        // Damage was already doubled; it's now at normal after first use by CombatSystem\n      }\n\n      if (distToPlayer > 24) {\n        AI.state[eid] = AIState.Chase;\n        AI.telegraphTimer[eid] = 0;\n      }\n      if (Health.current[eid] < Health.max[eid] * 0.2) {\n        AI.state[eid] = AIState.Flee;\n        AI.telegraphTimer[eid] = 0;\n      }\n      break;\n    }\n    case AIState.Flee: {\n      if (distToPlayer > 0) {\n        Velocity.vx[eid] = -(dx / distToPlayer) * speed * 1.2;\n        Velocity.vy[eid] = -(dy / distToPlayer) * speed * 1.2;\n      }\n      if (distToPlayer > aggroRadius * 2) {\n        AI.state[eid] = AIState.Idle;\n      }\n      break;\n    }\n    default: {\n      // Idle or patrol — go back to chase if player still nearby\n      if (distToPlayer < aggroRadius) {\n        AI.state[eid] = AIState.Chase;\n      } else {\n        Velocity.vx[eid] = 0;\n        Velocity.vy[eid] = 0;\n      }\n      break;\n    }\n  }\n}\n\n// ── Support ──\n// Find ally with lowest HP within 120px, move toward them, heal 5% max HP/s when adjacent.\n\nfunction updateSupport(\n  eid: number, world: object,\n  dx: number, dy: number, distToPlayer: number,\n  aggroRadius: number, distToHome: number, patrolRadius: number,\n  speed: number, delta: number, playerEid: number,\n): void {\n  const bs = getState(eid);\n  const ex = Position.x[eid];\n  const ey = Position.y[eid];\n\n  const allEnemies = enemyQuery(world);\n\n  // Find most damaged ally within 120px\n  let lowestHpEid = -1;\n  let lowestHpRatio = 1.0;\n\n  for (const ally of allEnemies) {\n    if (ally === eid) continue;\n    if (Health.current[ally] <= 0) continue;\n    const adx = Position.x[ally] - ex;\n    const ady = Position.y[ally] - ey;\n    const aDist = Math.sqrt(adx * adx + ady * ady);\n    if (aDist > 120) continue;\n\n    const hpRatio = Health.current[ally] / Health.max[ally];\n    if (hpRatio < lowestHpRatio) {\n      lowestHpRatio = hpRatio;\n      lowestHpEid = ally;\n    }\n  }\n\n  if (lowestHpEid >= 0 && lowestHpRatio < 0.95) {\n    // Move toward injured ally\n    const tdx = Position.x[lowestHpEid] - ex;\n    const tdy = Position.y[lowestHpEid] - ey;\n    const tDist = Math.sqrt(tdx * tdx + tdy * tdy);\n\n    if (tDist > 16) {\n      Velocity.vx[eid] = (tdx / tDist) * speed;\n      Velocity.vy[eid] = (tdy / tDist) * speed;\n    } else {\n      // Adjacent — heal 5% max HP per second\n      Velocity.vx[eid] = 0;\n      Velocity.vy[eid] = 0;\n      const healAmount = Health.max[lowestHpEid] * 0.05 * delta;\n      Health.current[lowestHpEid] = Math.min(\n        Health.max[lowestHpEid],\n        Health.current[lowestHpEid] + healAmount,\n      );\n    }\n    AI.state[eid] = AIState.Special;\n  } else {\n    // No ally needs healing — default wander behavior\n    AI.state[eid] = AIState.Idle;\n    switch (AI.state[eid]) {\n      case AIState.Idle: {\n        Velocity.vx[eid] = 0;\n        Velocity.vy[eid] = 0;\n        if (distToPlayer < aggroRadius) {\n          AI.state[eid] = AIState.Chase;\n        }\n        break;\n      }\n    }\n\n    // Still run away from player if too close\n    if (distToPlayer < 40) {\n      if (distToPlayer > 0) {\n        Velocity.vx[eid] = -(dx / distToPlayer) * speed;\n        Velocity.vy[eid] = -(dy / distToPlayer) * speed;\n      }\n    }\n  }\n}\n\n// ── Phase ──\n// Teleport to random position near player every 3s, can move through walls (ignore collision).\n\nfunction updatePhase(\n  eid: number, world: object,\n  px: number, py: number,\n  dx: number, dy: number, distToPlayer: number,\n  aggroRadius: number, distToHome: number, patrolRadius: number,\n  speed: number, delta: number,\n): void {\n  const bs = getState(eid);\n\n  switch (AI.state[eid]) {\n    case AIState.Idle:\n    case AIState.Patrol: {\n      Velocity.vx[eid] = 0;\n      Velocity.vy[eid] = 0;\n      if (distToPlayer < aggroRadius) {\n        AI.state[eid] = AIState.Chase;\n      }\n      break;\n    }\n    case AIState.Chase:\n    case AIState.Attack: {\n      // Move toward player (can phase through walls — collision layer ignores this)\n      if (hasComponent(world, Collider, eid)) {\n        Collider.solid[eid] = 0; // Phase through walls\n      }\n\n      // Teleport every 3 seconds\n      bs.phaseCooldown -= delta;\n      if (bs.phaseCooldown <= 0) {\n        bs.phaseCooldown = 3.0;\n        // Teleport to random position within 60px of player\n        const angle = Math.random() * Math.PI * 2;\n        const dist = 30 + Math.random() * 30;\n        Position.x[eid] = px + Math.cos(angle) * dist;\n        Position.y[eid] = py + Math.sin(angle) * dist;\n      }\n\n      // Between teleports, approach\n      if (distToPlayer > 20) {\n        Velocity.vx[eid] = (dx / distToPlayer) * speed;\n        Velocity.vy[eid] = (dy / distToPlayer) * speed;\n      } else {\n        if (AI.state[eid] !== AIState.Attack) {\n          AI.state[eid] = AIState.Attack;\n          beginTelegraph(eid);\n        }\n        Velocity.vx[eid] = 0;\n        Velocity.vy[eid] = 0;\n        if (!tickTelegraph(eid, delta)) {\n          AI.lastAttackTime[eid] += delta;\n        }\n      }\n\n      if (distToPlayer > aggroRadius * 2) {\n        AI.state[eid] = AIState.Idle;\n        if (hasComponent(world, Collider, eid)) {\n          Collider.solid[eid] = 1; // Restore collision\n        }\n      }\n      break;\n    }\n    case AIState.Dead: {\n      Velocity.vx[eid] = 0;\n      Velocity.vy[eid] = 0;\n      break;\n    }\n  }\n}\n\n// ── Pack ──\n// When entering combat, spawn 1-2 allies. Use flanking (approach from behind player).\n\nfunction updatePack(\n  eid: number, world: object,\n  px: number, py: number,\n  dx: number, dy: number, distToPlayer: number,\n  aggroRadius: number, distToHome: number, patrolRadius: number,\n  speed: number, delta: number, playerEid: number,\n): void {\n  const bs = getState(eid);\n  const ex = Position.x[eid];\n  const ey = Position.y[eid];\n\n  switch (AI.state[eid]) {\n    case AIState.Idle:\n    case AIState.Patrol: {\n      Velocity.vx[eid] = 0;\n      Velocity.vy[eid] = 0;\n      if (distToPlayer < aggroRadius) {\n        AI.state[eid] = AIState.Chase;\n\n        // Spawn 1-2 pack allies when entering combat\n        if (!bs.packSpawned) {\n          bs.packSpawned = true;\n          const allyCount = 1 + Math.floor(Math.random() * 2); // 1-2\n          for (let i = 0; i < allyCount; i++) {\n            const angle = Math.random() * Math.PI * 2;\n            const spawnDist = 30 + Math.random() * 40;\n            const spawnX = ex + Math.cos(angle) * spawnDist;\n            const spawnY = ey + Math.sin(angle) * spawnDist;\n            // Spawn weaker version of self\n            const hp = Math.round(Health.max[eid] * 0.6);\n            const dmg = Math.round(Combat.damage[eid] * 0.6);\n            const def = Math.round(Combat.defense[eid] * 0.5);\n            createEnemy(spawnX, spawnY, hp, dmg, def, aggroRadius, 'enemy', AIBehavior.Chase);\n          }\n        }\n      }\n      break;\n    }\n    case AIState.Chase: {\n      // Flanking: try to approach from behind the player\n      // \"Behind\" = opposite direction the player is facing (approx: away from enemy)\n      // We offset the target position to the far side of the player\n      const flankX = px + (dx / (distToPlayer || 1)) * 30;\n      const flankY = py + (dy / (distToPlayer || 1)) * 30;\n      const fdx = flankX - ex;\n      const fdy = flankY - ey;\n      const fDist = Math.sqrt(fdx * fdx + fdy * fdy);\n\n      if (fDist > 2) {\n        Velocity.vx[eid] = (fdx / fDist) * speed;\n        Velocity.vy[eid] = (fdy / fDist) * speed;\n      }\n\n      if (distToPlayer < 20) {\n        AI.state[eid] = AIState.Attack;\n        beginTelegraph(eid);\n      }\n      if (distToPlayer > aggroRadius * 2 || distToHome > patrolRadius * 3) {\n        AI.state[eid] = AIState.Idle;\n        Velocity.vx[eid] = 0;\n        Velocity.vy[eid] = 0;\n      }\n      break;\n    }\n    case AIState.Attack: {\n      Velocity.vx[eid] = 0;\n      Velocity.vy[eid] = 0;\n      if (!tickTelegraph(eid, delta)) {\n        AI.lastAttackTime[eid] += delta;\n      }\n      if (distToPlayer > 24) {\n        AI.state[eid] = AIState.Chase;\n        AI.telegraphTimer[eid] = 0;\n      }\n      break;\n    }\n    case AIState.Flee: {\n      if (distToPlayer > 0) {\n        Velocity.vx[eid] = -(dx / distToPlayer) * speed * 1.2;\n        Velocity.vy[eid] = -(dy / distToPlayer) * speed * 1.2;\n      }\n      if (distToPlayer > aggroRadius * 2) {\n        AI.state[eid] = AIState.Idle;\n      }\n      break;\n    }\n    case AIState.Dead: {\n      Velocity.vx[eid] = 0;\n      Velocity.vy[eid] = 0;\n      break;\n    }\n  }\n}\n\n// ── Stationary ──\n// Never moves, attacks anything within attack range, high defense.\n\nfunction updateStationary(\n  eid: number, distToPlayer: number, delta: number,\n): void {\n  // Never move\n  Velocity.vx[eid] = 0;\n  Velocity.vy[eid] = 0;\n\n  const attackRange = 24;\n  if (distToPlayer < attackRange) {\n    if (AI.state[eid] !== AIState.Attack) {\n      AI.state[eid] = AIState.Attack;\n      beginTelegraph(eid);\n    }\n    if (!tickTelegraph(eid, delta)) {\n      AI.lastAttackTime[eid] += delta;\n    }\n  } else {\n    AI.state[eid] = AIState.Idle;\n    AI.telegraphTimer[eid] = 0;\n  }\n}\n","/**\n * Elite enemy affix system (Dead Cells / Darkest Dungeon-inspired).\n * Enemies can spawn with 1-2 affixes that modify stats and add special effects.\n */\n\nexport interface AffixDef {\n  id: number;         // Compact enum-style ID for ECS storage\n  name: string;\n  description: string;\n  /** Stat multipliers applied at spawn */\n  hpMult: number;\n  dmgMult: number;\n  speedMult: number;\n  defenseMult: number;\n  /** Special combat effect */\n  specialEffect: 'none' | 'teleport' | 'shield' | 'corruption_aura' | 'explode_on_death' | 'life_steal' | 'thorns';\n  /** Tint applied to sprite */\n  tint: number;\n  /** Bonus to loot rarity rolls (+1 or +2) */\n  lootRarityBonus: number;\n}\n\nexport const enum AffixId {\n  None = 0,\n  Frenzied = 1,\n  Shielded = 2,\n  Venomous = 3,\n  Blazing = 4,\n  Teleporting = 5,\n  Vampiric = 6,\n  Thorned = 7,\n  Corrupting = 8,\n  Volatile = 9,\n  Armored = 10,\n  Swift = 11,\n  Berserker = 12,\n}\n\nexport const AFFIXES: Record<number, AffixDef> = {\n  [AffixId.Frenzied]: {\n    id: AffixId.Frenzied, name: 'Frenzied', description: 'Attacks 40% faster',\n    hpMult: 1.0, dmgMult: 1.0, speedMult: 1.0, defenseMult: 1.0,\n    specialEffect: 'none', tint: 0xff4444, lootRarityBonus: 1,\n  },\n  [AffixId.Shielded]: {\n    id: AffixId.Shielded, name: 'Shielded', description: 'Absorbs first 3 hits',\n    hpMult: 1.2, dmgMult: 1.0, speedMult: 1.0, defenseMult: 1.5,\n    specialEffect: 'shield', tint: 0x4488ff, lootRarityBonus: 1,\n  },\n  [AffixId.Venomous]: {\n    id: AffixId.Venomous, name: 'Venomous', description: 'Attacks inflict poison',\n    hpMult: 1.1, dmgMult: 0.9, speedMult: 1.0, defenseMult: 1.0,\n    specialEffect: 'none', tint: 0x44ff44, lootRarityBonus: 1,\n  },\n  [AffixId.Blazing]: {\n    id: AffixId.Blazing, name: 'Blazing', description: 'Attacks inflict burn',\n    hpMult: 1.1, dmgMult: 0.9, speedMult: 1.0, defenseMult: 1.0,\n    specialEffect: 'none', tint: 0xff8800, lootRarityBonus: 1,\n  },\n  [AffixId.Teleporting]: {\n    id: AffixId.Teleporting, name: 'Teleporting', description: 'Blinks behind target',\n    hpMult: 0.9, dmgMult: 1.2, speedMult: 1.0, defenseMult: 0.8,\n    specialEffect: 'teleport', tint: 0xcc44ff, lootRarityBonus: 2,\n  },\n  [AffixId.Vampiric]: {\n    id: AffixId.Vampiric, name: 'Vampiric', description: 'Heals on hit',\n    hpMult: 1.0, dmgMult: 1.0, speedMult: 1.0, defenseMult: 1.0,\n    specialEffect: 'life_steal', tint: 0xff0066, lootRarityBonus: 1,\n  },\n  [AffixId.Thorned]: {\n    id: AffixId.Thorned, name: 'Thorned', description: 'Reflects 20% damage',\n    hpMult: 1.3, dmgMult: 0.8, speedMult: 1.0, defenseMult: 1.0,\n    specialEffect: 'thorns', tint: 0x888844, lootRarityBonus: 1,\n  },\n  [AffixId.Corrupting]: {\n    id: AffixId.Corrupting, name: 'Corrupting', description: 'Aura increases corruption',\n    hpMult: 1.2, dmgMult: 1.0, speedMult: 1.0, defenseMult: 1.0,\n    specialEffect: 'corruption_aura', tint: 0x9900cc, lootRarityBonus: 2,\n  },\n  [AffixId.Volatile]: {\n    id: AffixId.Volatile, name: 'Volatile', description: 'Explodes on death',\n    hpMult: 0.8, dmgMult: 1.0, speedMult: 1.1, defenseMult: 0.8,\n    specialEffect: 'explode_on_death', tint: 0xffcc00, lootRarityBonus: 1,\n  },\n  [AffixId.Armored]: {\n    id: AffixId.Armored, name: 'Armored', description: '+50% HP, +50% defense',\n    hpMult: 1.5, dmgMult: 1.0, speedMult: 0.9, defenseMult: 1.5,\n    specialEffect: 'none', tint: 0x888888, lootRarityBonus: 1,\n  },\n  [AffixId.Swift]: {\n    id: AffixId.Swift, name: 'Swift', description: '+40% movement speed',\n    hpMult: 0.9, dmgMult: 1.0, speedMult: 1.4, defenseMult: 0.9,\n    specialEffect: 'none', tint: 0x00ccff, lootRarityBonus: 1,\n  },\n  [AffixId.Berserker]: {\n    id: AffixId.Berserker, name: 'Berserker', description: '+50% damage, -20% defense',\n    hpMult: 1.0, dmgMult: 1.5, speedMult: 1.1, defenseMult: 0.8,\n    specialEffect: 'none', tint: 0xff2200, lootRarityBonus: 2,\n  },\n};\n\n/** All valid affix IDs (for random rolling) */\nexport const AFFIX_IDS = Object.keys(AFFIXES).map(Number);\n\n/** Roll 0-2 affixes for an enemy. eliteChance = probability of being elite. */\nexport function rollAffixes(rng: { next(): number }, eliteChance: number = 0.15): [number, number] {\n  if (rng.next() > eliteChance) return [AffixId.None, AffixId.None];\n  const first = AFFIX_IDS[Math.floor(rng.next() * AFFIX_IDS.length)];\n  // 30% chance for a second affix\n  if (rng.next() < 0.3) {\n    let second = AFFIX_IDS[Math.floor(rng.next() * AFFIX_IDS.length)];\n    if (second === first) second = AffixId.None; // No duplicates\n    return [first, second];\n  }\n  return [first, AffixId.None];\n}\n","import { defineQuery, hasComponent } from 'bitecs';\nimport {\n  Position, Health, Combat, Collider,\n  PlayerTag, EnemyTag, Velocity, StatusEffects,\n  SynergyStatus, EliteAffix, AI, AIState,\n} from '../components';\nimport { AffixId, AFFIXES } from '../../data/enemyAffixes';\nimport { INVINCIBILITY_FRAMES_MS, KNOCKBACK_FORCE } from '../../config';\n\nconst combatantQuery = defineQuery([Position, Health, Combat, Collider]);\nconst statusQuery = defineQuery([Position, Health, StatusEffects]);\n\n/** Tracks invincibility frames per entity */\nconst iFrames = new Map<number, number>();\n\n/** Grant invincibility frames to an entity from outside the combat system */\nexport function grantIFrames(eid: number, durationMs: number): void {\n  iFrames.set(eid, Math.max(iFrames.get(eid) ?? 0, durationMs));\n}\n\n/** Tracks pending damage events for external consumption */\nexport interface DamageEvent {\n  targetEid: number;\n  attackerEid: number;\n  damage: number;\n  isCrit: boolean;\n  x: number;\n  y: number;\n  comboCount: number;\n  isBackstab: boolean;\n}\n\n// ── Positional Combat (Valheim/Dark Souls-inspired) ──\n\n/** External damage multiplier callback — set by scene for weakness system */\nlet externalDamageMult: ((attackerEid: number, targetEid: number) => number) | null = null;\n\n/** Register an external damage multiplier function (e.g., enemy weakness system) */\nexport function setExternalDamageMult(fn: (attackerEid: number, targetEid: number) => number): void {\n  externalDamageMult = fn;\n}\n\n/**\n * Get the facing angle of an entity based on velocity.\n * Returns angle in radians. Falls back to 0 (facing right).\n */\nfunction getFacingAngle(eid: number): number {\n  const vx = Velocity.vx[eid];\n  const vy = Velocity.vy[eid];\n  if (Math.abs(vx) < 0.01 && Math.abs(vy) < 0.01) {\n    // No velocity — fall back to last stored facing (or 0)\n    return lastFacing.get(eid) ?? 0;\n  }\n  const angle = Math.atan2(vy, vx);\n  lastFacing.set(eid, angle);\n  return angle;\n}\n\n/** Store last known facing angle per entity (for when velocity is 0) */\nconst lastFacing = new Map<number, number>();\n\n/**\n * Check if attacker is behind the target (within 60° arc behind target's facing).\n * Returns true for backstab position.\n */\nfunction isBackstabPosition(attackerEid: number, targetEid: number): boolean {\n  const targetFacing = getFacingAngle(targetEid);\n  const dx = Position.x[attackerEid] - Position.x[targetEid];\n  const dy = Position.y[attackerEid] - Position.y[targetEid];\n  const angleToAttacker = Math.atan2(dy, dx);\n\n  // Angle behind target = targetFacing + PI\n  const behindAngle = targetFacing + Math.PI;\n  let diff = angleToAttacker - behindAngle;\n  // Normalize to [-PI, PI]\n  while (diff > Math.PI) diff -= Math.PI * 2;\n  while (diff < -Math.PI) diff += Math.PI * 2;\n\n  // Backstab if attacker is within 60° of directly behind\n  return Math.abs(diff) < Math.PI / 3;\n}\n\nconst pendingDamage: DamageEvent[] = [];\n\n/**\n * When true, the player's next attack cycle will fire.\n * Set by the scene when the player presses attack; consumed by combatSystem().\n */\nlet playerAttackRequested = false;\n\n/** Request a player attack (called by scene on input) */\nexport function requestPlayerAttack(): void {\n  playerAttackRequested = true;\n}\n\n/** Get and clear pending damage events (consumed by scene renderer) */\nexport function flushDamageEvents(): DamageEvent[] {\n  const events = [...pendingDamage];\n  pendingDamage.length = 0;\n  return events;\n}\n\n// ── Parry / Riposte System (Dark Souls-inspired) ──\n\nexport interface ParryEvent {\n  playerEid: number;\n  enemyEid: number;\n  x: number;\n  y: number;\n  isRiposte: boolean; // true if player has Sword Riposte mastery (level 5+)\n}\n\nconst pendingParries: ParryEvent[] = [];\n\n/** Get and clear pending parry events (consumed by scene for VFX/SFX) */\nexport function flushParryEvents(): ParryEvent[] {\n  const events = [...pendingParries];\n  pendingParries.length = 0;\n  return events;\n}\n\n/**\n * Riposte state: when true, the player's next attack is a guaranteed crit with 2x bonus.\n * Set by a successful parry when the player has the Sword Riposte mastery.\n */\nlet riposteActive = false;\n\n/** Check if the player has a riposte queued (for HUD display) */\nexport function isRiposteActive(): boolean {\n  return riposteActive;\n}\n\n/** Sword mastery level — set by the scene so CombatSystem knows parry tier */\nlet swordMasteryLevel = 0;\n\n/** Set the player's sword mastery level (called by scene on equip/level changes) */\nexport function setSwordMasteryLevel(level: number): void {\n  swordMasteryLevel = level;\n}\n\n// ── Combo Tracker ──\n\nexport interface ComboState {\n  count: number;\n  timer: number;\n  lastTargetEid: number;\n}\n\n/** Global combo tracker — tracks consecutive hits by each attacker */\nexport const ComboTracker: Map<number, ComboState> = new Map();\n\nconst COMBO_TIMEOUT = 2.0; // seconds before combo resets\n\nfunction tickCombos(delta: number): void {\n  for (const [eid, state] of ComboTracker) {\n    state.timer -= delta;\n    if (state.timer <= 0) {\n      ComboTracker.delete(eid);\n    }\n  }\n}\n\nfunction registerHit(attackerEid: number, targetEid: number): number {\n  let state = ComboTracker.get(attackerEid);\n  if (!state) {\n    state = { count: 0, timer: COMBO_TIMEOUT, lastTargetEid: targetEid };\n    ComboTracker.set(attackerEid, state);\n  }\n  state.count++;\n  state.timer = COMBO_TIMEOUT;\n  state.lastTargetEid = targetEid;\n  return state.count;\n}\n\n// ── Status Effect Processing ──\n\nfunction processStatusEffects(world: object, delta: number): void {\n  const entities = statusQuery(world);\n\n  for (const eid of entities) {\n    if (Health.current[eid] <= 0) continue;\n\n    // -- Poison --\n    if (StatusEffects.poison[eid] > 0) {\n      StatusEffects.poison[eid] -= delta;\n      if (StatusEffects.poisonDmg[eid] > 0) {\n        Health.current[eid] -= StatusEffects.poisonDmg[eid] * delta;\n      }\n      if (StatusEffects.poison[eid] <= 0) {\n        StatusEffects.poison[eid] = 0;\n        StatusEffects.poisonDmg[eid] = 0;\n      }\n    }\n\n    // -- Burn --\n    if (StatusEffects.burn[eid] > 0) {\n      StatusEffects.burn[eid] -= delta;\n      if (StatusEffects.burnDmg[eid] > 0) {\n        Health.current[eid] -= StatusEffects.burnDmg[eid] * delta;\n      }\n\n      // 10% chance per second to spread to nearby enemies within 40px\n      if (Math.random() < 0.1 * delta) {\n        for (const other of entities) {\n          if (other === eid) continue;\n          if (StatusEffects.burn[other] > 0) continue;\n          const dx = Position.x[other] - Position.x[eid];\n          const dy = Position.y[other] - Position.y[eid];\n          const dist = Math.sqrt(dx * dx + dy * dy);\n          if (dist <= 40) {\n            // Spread burn with half duration and same damage\n            StatusEffects.burn[other] = StatusEffects.burn[eid] * 0.5;\n            StatusEffects.burnDmg[other] = StatusEffects.burnDmg[eid];\n            break; // Only spread to one target per tick\n          }\n        }\n      }\n\n      if (StatusEffects.burn[eid] <= 0) {\n        StatusEffects.burn[eid] = 0;\n        StatusEffects.burnDmg[eid] = 0;\n      }\n    }\n\n    // -- Freeze --\n    if (StatusEffects.freeze[eid] > 0) {\n      StatusEffects.freeze[eid] -= delta;\n\n      // Reduce movement speed by 50% (halve velocity each frame)\n      if (hasComponent(world, Velocity, eid)) {\n        Velocity.vx[eid] *= 0.5;\n        Velocity.vy[eid] *= 0.5;\n      }\n\n      // \"Shatter\" effect at end: 0.3s stun\n      if (StatusEffects.freeze[eid] <= 0) {\n        StatusEffects.freeze[eid] = 0;\n        // Apply shatter stun\n        if (StatusEffects.stun[eid] <= 0) {\n          StatusEffects.stun[eid] = 0.3;\n        }\n      }\n    }\n\n    // -- Bleed --\n    if (StatusEffects.bleed[eid] > 0) {\n      StatusEffects.bleed[eid] -= delta;\n\n      // Deal bleedDmg when entity moves (velocity > 0)\n      if (hasComponent(world, Velocity, eid)) {\n        const speed = Math.abs(Velocity.vx[eid]) + Math.abs(Velocity.vy[eid]);\n        if (speed > 0.1) {\n          Health.current[eid] -= StatusEffects.bleedDmg[eid] * delta;\n        }\n      }\n\n      if (StatusEffects.bleed[eid] <= 0) {\n        StatusEffects.bleed[eid] = 0;\n        StatusEffects.bleedDmg[eid] = 0;\n      }\n    }\n\n    // -- Stun --\n    if (StatusEffects.stun[eid] > 0) {\n      StatusEffects.stun[eid] -= delta;\n\n      // Set velocity to 0 (AI skip is handled in AISystem)\n      if (hasComponent(world, Velocity, eid)) {\n        Velocity.vx[eid] = 0;\n        Velocity.vy[eid] = 0;\n      }\n\n      if (StatusEffects.stun[eid] <= 0) {\n        StatusEffects.stun[eid] = 0;\n      }\n    }\n  }\n}\n\n// ── Apply Status Helper (exported for use by abilities, projectiles, etc.) ──\n\nexport function applyStatusEffect(\n  eid: number,\n  effect: 'poison' | 'burn' | 'freeze' | 'bleed' | 'stun',\n  duration: number,\n  damagePerSecond: number = 0,\n): void {\n  switch (effect) {\n    case 'poison':\n      StatusEffects.poison[eid] = Math.max(StatusEffects.poison[eid], duration);\n      if (damagePerSecond > 0) StatusEffects.poisonDmg[eid] = Math.max(StatusEffects.poisonDmg[eid], damagePerSecond);\n      break;\n    case 'burn':\n      StatusEffects.burn[eid] = Math.max(StatusEffects.burn[eid], duration);\n      if (damagePerSecond > 0) StatusEffects.burnDmg[eid] = Math.max(StatusEffects.burnDmg[eid], damagePerSecond);\n      break;\n    case 'freeze':\n      StatusEffects.freeze[eid] = Math.max(StatusEffects.freeze[eid], duration);\n      break;\n    case 'bleed':\n      StatusEffects.bleed[eid] = Math.max(StatusEffects.bleed[eid], duration);\n      if (damagePerSecond > 0) StatusEffects.bleedDmg[eid] = Math.max(StatusEffects.bleedDmg[eid], damagePerSecond);\n      break;\n    case 'stun':\n      StatusEffects.stun[eid] = Math.max(StatusEffects.stun[eid], duration);\n      break;\n  }\n}\n\n/**\n * Circle-overlap hit detection between attackers and targets.\n * Players attack enemies; enemies attack players.\n * Also processes status effects each frame and tracks combos.\n */\nexport function combatSystem(world: object, delta: number): void {\n  const entities = combatantQuery(world);\n\n  // Tick combo timers\n  tickCombos(delta);\n\n  // Process status effects\n  processStatusEffects(world, delta);\n\n  // Tick down invincibility frames\n  for (const [eid, remaining] of iFrames) {\n    const newVal = remaining - delta * 1000;\n    if (newVal <= 0) {\n      iFrames.delete(eid);\n    } else {\n      iFrames.set(eid, newVal);\n    }\n  }\n\n  // Check all combatant pairs\n  for (let i = 0; i < entities.length; i++) {\n    const a = entities[i];\n    if (Health.current[a] <= 0) continue;\n\n    // Stunned entities cannot attack\n    if (hasComponent(world, StatusEffects, a) && StatusEffects.stun[a] > 0) continue;\n\n    // Enemies in telegraph wind-up cannot deal damage yet (they're winding up)\n    if (hasComponent(world, EnemyTag, a) && hasComponent(world, AI, a) && AI.telegraphTimer[a] > 0) continue;\n\n    if (Combat.attackCooldown[a] > 0) {\n      Combat.attackCooldown[a] -= delta;\n      continue;\n    }\n\n    const isPlayerA = hasComponent(world, PlayerTag, a);\n    const isEnemyA = hasComponent(world, EnemyTag, a);\n\n    // Player only attacks when manually requested (no auto-attack)\n    if (isPlayerA && !playerAttackRequested) continue;\n\n    for (let j = 0; j < entities.length; j++) {\n      if (i === j) continue;\n      const b = entities[j];\n      if (Health.current[b] <= 0) continue;\n      if (iFrames.has(b)) continue;\n\n      const isPlayerB = hasComponent(world, PlayerTag, b);\n      const isEnemyB = hasComponent(world, EnemyTag, b);\n\n      // Only enemies attack player, player attacks enemies\n      if (!(isPlayerA && isEnemyB) && !(isEnemyA && isPlayerB)) continue;\n\n      // Distance check\n      const dx = Position.x[b] - Position.x[a];\n      const dy = Position.y[b] - Position.y[a];\n      const dist = Math.sqrt(dx * dx + dy * dy);\n      const range = Collider.radius[a] + Collider.radius[b] + 16; // Attack reach\n\n      if (dist > range) continue;\n\n      // ── Parry check: player attacking a telegraphing enemy ──\n      if (isPlayerA && isEnemyB && hasComponent(world, AI, b) && AI.telegraphTimer[b] > 0) {\n        // PARRY! Interrupt the enemy's attack\n        AI.telegraphTimer[b] = 0;\n        AI.state[b] = AIState.Idle;\n\n        // Base parry: 0.8s stun on the enemy\n        let stunDuration = 0.8;\n        const isRiposte = swordMasteryLevel >= 5;\n        if (isRiposte) {\n          // Riposte mastery: longer stun + guaranteed crit on next attack\n          stunDuration = 1.5;\n          riposteActive = true;\n        }\n        if (swordMasteryLevel >= 15) {\n          // Parry Master: even longer stun\n          stunDuration = 2.0;\n        }\n\n        if (hasComponent(world, StatusEffects, b)) {\n          StatusEffects.stun[b] = Math.max(StatusEffects.stun[b], stunDuration);\n        }\n\n        pendingParries.push({\n          playerEid: a,\n          enemyEid: b,\n          x: Position.x[b],\n          y: Position.y[b],\n          isRiposte,\n        });\n\n        // Reset cooldown so player can immediately follow up\n        Combat.attackCooldown[a] = 0.15;\n        playerAttackRequested = false;\n        break;\n      }\n\n      // ── Riposte: guaranteed crit with 2x bonus on next hit after parry ──\n      let riposteBonusMult = 1.0;\n      if (isPlayerA && riposteActive) {\n        riposteActive = false;\n        riposteBonusMult = 2.0;\n      }\n\n      // Positional combat: backstab check\n      const backstab = isPlayerA && isBackstabPosition(a, b);\n      const backstabMult = backstab ? 1.5 : 1.0; // +50% damage from behind\n\n      // External damage multiplier (enemy weakness system)\n      const extMult = externalDamageMult ? externalDamageMult(a, b) : 1.0;\n\n      // Damage calculation\n      const forceCrit = isPlayerA && riposteBonusMult > 1.0;\n      const isCrit = forceCrit || Math.random() < Combat.critChance[a];\n      const critMult = isCrit ? Combat.critMult[a] * riposteBonusMult : 1.0;\n      let rawDmg = Combat.damage[a] * critMult * backstabMult * extMult;\n\n      // Weapon synergy: bonus damage vs targets with matching status effect\n      const syn = Combat.synergyStatus[a];\n      if (syn !== SynergyStatus.None && hasComponent(world, StatusEffects, b)) {\n        const hasStatus =\n          (syn === SynergyStatus.Poison && StatusEffects.poison[b] > 0) ||\n          (syn === SynergyStatus.Burn && StatusEffects.burn[b] > 0) ||\n          (syn === SynergyStatus.Freeze && StatusEffects.freeze[b] > 0) ||\n          (syn === SynergyStatus.Bleed && StatusEffects.bleed[b] > 0) ||\n          (syn === SynergyStatus.Stun && StatusEffects.stun[b] > 0);\n        if (hasStatus) rawDmg *= Combat.synergyMult[a];\n      }\n\n      let finalDmg = Math.max(1, rawDmg - Combat.defense[b]);\n\n      // Elite affix: Shield absorbs hits\n      if (hasComponent(world, EliteAffix, b) && EliteAffix.shieldHits[b] > 0) {\n        EliteAffix.shieldHits[b]--;\n        finalDmg = Math.max(1, Math.round(finalDmg * 0.2)); // 80% reduction while shielded\n      }\n\n      Health.current[b] -= finalDmg;\n      Combat.attackCooldown[a] = 1.0 / Combat.attackSpeed[a];\n      iFrames.set(b, INVINCIBILITY_FRAMES_MS);\n\n      // Elite affix effects from the ATTACKER\n      if (hasComponent(world, EliteAffix, a)) {\n        const a1 = EliteAffix.affix1[a];\n        const a2 = EliteAffix.affix2[a];\n        // Vampiric: heal attacker for 25% of damage dealt\n        if (a1 === AffixId.Vampiric || a2 === AffixId.Vampiric) {\n          Health.current[a] = Math.min(Health.max[a], Health.current[a] + finalDmg * 0.25);\n        }\n        // Venomous: inflict poison on hit\n        if (a1 === AffixId.Venomous || a2 === AffixId.Venomous) {\n          if (hasComponent(world, StatusEffects, b)) {\n            StatusEffects.poison[b] = Math.max(StatusEffects.poison[b], 4);\n            StatusEffects.poisonDmg[b] = Math.max(StatusEffects.poisonDmg[b], Combat.damage[a] * 0.15);\n          }\n        }\n        // Blazing: inflict burn on hit\n        if (a1 === AffixId.Blazing || a2 === AffixId.Blazing) {\n          if (hasComponent(world, StatusEffects, b)) {\n            StatusEffects.burn[b] = Math.max(StatusEffects.burn[b], 3);\n            StatusEffects.burnDmg[b] = Math.max(StatusEffects.burnDmg[b], Combat.damage[a] * 0.2);\n          }\n        }\n      }\n\n      // Elite affix effects on the DEFENDER (thorns)\n      if (hasComponent(world, EliteAffix, b)) {\n        const b1 = EliteAffix.affix1[b];\n        const b2 = EliteAffix.affix2[b];\n        if (b1 === AffixId.Thorned || b2 === AffixId.Thorned) {\n          Health.current[a] -= Math.round(finalDmg * 0.2);\n        }\n      }\n\n      // Track combo\n      const comboCount = registerHit(a, b);\n\n      // Knockback — scaled by damage dealt (crits/combos push harder)\n      if (dist > 0) {\n        const kbScale = 1 + Math.min(finalDmg / 20, 1.5); // up to 2.5x for heavy hits\n        const comboKbBonus = 1 + Math.min(comboCount * 0.1, 0.5); // up to 1.5x at 5+ combo\n        const totalKb = KNOCKBACK_FORCE * kbScale * comboKbBonus;\n        const kbX = (dx / dist) * totalKb;\n        const kbY = (dy / dist) * totalKb;\n        Velocity.vx[b] += kbX;\n        Velocity.vy[b] += kbY;\n      }\n\n      pendingDamage.push({\n        targetEid: b,\n        attackerEid: a,\n        damage: finalDmg,\n        isCrit,\n        x: Position.x[b],\n        y: Position.y[b],\n        comboCount,\n        isBackstab: backstab,\n      });\n\n      // Player attack consumed — stop checking more targets this frame\n      if (isPlayerA) {\n        playerAttackRequested = false;\n        break;\n      }\n    }\n  }\n\n  // Clear the flag even if no target was in range\n  playerAttackRequested = false;\n}\n","import { defineQuery, removeEntity, hasComponent } from 'bitecs';\nimport {\n  Position, Velocity, Combat, Collider, Health,\n  ProjectileTag, EnemyTag, PlayerTag,\n} from '../components';\n\nconst projectileQuery = defineQuery([Position, Velocity, ProjectileTag]);\nconst targetQuery = defineQuery([Position, Health, Collider]);\n\n/** Max lifetime for projectiles in seconds */\nconst MAX_LIFETIME = 3.0;\n\n/** Per-projectile lifetime trackers */\nconst lifetimes = new Map<number, number>();\n\n/**\n * Moves projectiles and checks for collisions with targets.\n */\nexport function projectileSystem(world: object, delta: number): void {\n  const projectiles = projectileQuery(world);\n  const targets = targetQuery(world);\n\n  for (const pid of projectiles) {\n    // Track lifetime\n    const elapsed = (lifetimes.get(pid) ?? 0) + delta;\n    lifetimes.set(pid, elapsed);\n\n    if (elapsed > MAX_LIFETIME) {\n      lifetimes.delete(pid);\n      removeEntity(world, pid);\n      continue;\n    }\n\n    const px = Position.x[pid];\n    const py = Position.y[pid];\n    const pDmg = Combat.damage[pid];\n\n    // Check collision with targets\n    for (const tid of targets) {\n      if (tid === pid) continue;\n      if (Health.current[tid] <= 0) continue;\n\n      // Don't hit same faction as owner\n      // Simple rule: projectiles from player hit enemies, from enemies hit player\n      const projIsPlayerOwned = !hasComponent(world, EnemyTag, pid);\n      const targetIsEnemy = hasComponent(world, EnemyTag, tid);\n      const targetIsPlayer = hasComponent(world, PlayerTag, tid);\n\n      if (projIsPlayerOwned && !targetIsEnemy) continue;\n      if (!projIsPlayerOwned && !targetIsPlayer) continue;\n\n      const dx = Position.x[tid] - px;\n      const dy = Position.y[tid] - py;\n      const dist = Math.sqrt(dx * dx + dy * dy);\n      const hitRange = Collider.radius[tid] + 6;\n\n      if (dist < hitRange) {\n        Health.current[tid] -= pDmg;\n        lifetimes.delete(pid);\n        removeEntity(world, pid);\n        break;\n      }\n    }\n  }\n}\n","import { defineQuery } from 'bitecs';\nimport { Position, EnemyTag, Health, EliteAffix, Combat } from '../components';\nimport { createEnemy } from '../world';\nimport { SeededRandom } from '../../world/SeededRandom';\nimport { BiomeId, BIOME_DEFS } from '../../world/BiomeGenerator';\nimport { CHUNK_SIZE, SEASONS } from '../../config';\nimport { rollAffixes, AFFIXES, AffixId } from '../../data/enemyAffixes';\n\ntype Season = typeof SEASONS[number];\n\nconst enemyQuery = defineQuery([Position, EnemyTag]);\n\n/** Enemy density per chunk by biome */\nconst BIOME_DENSITY: Record<BiomeId, number> = {\n  [BiomeId.Haven]: 1,\n  [BiomeId.Rotwood]: 3,\n  [BiomeId.Ashlands]: 4,\n  [BiomeId.Drowned]: 3,\n  [BiomeId.BoneWastes]: 5,\n  [BiomeId.TheVoid]: 4,\n  [BiomeId.Edilas]: 6,\n};\n\n/** Base stats by biome */\nconst BIOME_ENEMY_STATS: Record<BiomeId, { hp: number; dmg: number; def: number }> = {\n  [BiomeId.Haven]: { hp: 30, dmg: 5, def: 2 },\n  [BiomeId.Rotwood]: { hp: 60, dmg: 10, def: 5 },\n  [BiomeId.Ashlands]: { hp: 100, dmg: 18, def: 10 },\n  [BiomeId.Drowned]: { hp: 140, dmg: 25, def: 14 },\n  [BiomeId.BoneWastes]: { hp: 200, dmg: 35, def: 20 },\n  [BiomeId.TheVoid]: { hp: 280, dmg: 48, def: 28 },\n  [BiomeId.Edilas]: { hp: 400, dmg: 65, def: 38 },\n};\n\n/**\n * Seasonal modifiers — inspired by Don't Starve seasonal danger\n * Winter: fewer enemies but they're tougher (+30% hp/dmg). Survival pressure.\n * Summer: more enemies, slightly stronger (+10%). High activity.\n * Autumn: normal.\n * Spring: slightly more enemies, normal stats.\n */\nconst SEASON_MODS: Record<Season, { densityMult: number; hpMult: number; dmgMult: number }> = {\n  Spring:  { densityMult: 1.15, hpMult: 1.0,  dmgMult: 1.0  },\n  Summer:  { densityMult: 1.3,  hpMult: 1.1,  dmgMult: 1.1  },\n  Autumn:  { densityMult: 1.0,  hpMult: 1.0,  dmgMult: 1.0  },\n  Winter:  { densityMult: 0.7,  hpMult: 1.3,  dmgMult: 1.3  },\n};\n\n/** Tracks which chunks have had enemies spawned */\nconst spawnedChunks = new Set<string>();\n\n/** Clear spawned chunks (call on season change to allow re-spawn with new modifiers) */\nexport function resetSpawnedChunks(): void {\n  spawnedChunks.clear();\n}\n\n/**\n * Spawns enemies in chunks near the player.\n * Each chunk spawns enemies once (deterministic by position).\n * Season affects enemy density and stats.\n */\nexport function spawnSystem(\n  world: object,\n  playerX: number, playerY: number,\n  getBiome: (tx: number, ty: number) => BiomeId,\n  season: Season = 'Autumn',\n): void {\n  const rng = new SeededRandom(42069);\n  const ptx = Math.floor(playerX / 32);\n  const pty = Math.floor(playerY / 32);\n  const pcx = Math.floor(ptx / CHUNK_SIZE);\n  const pcy = Math.floor(pty / CHUNK_SIZE);\n\n  const seasonMod = SEASON_MODS[season];\n\n  // Check nearby chunks\n  for (let dy = -2; dy <= 2; dy++) {\n    for (let dx = -2; dx <= 2; dx++) {\n      const cx = pcx + dx;\n      const cy = pcy + dy;\n      const key = `${cx},${cy}`;\n\n      if (spawnedChunks.has(key)) continue;\n      spawnedChunks.add(key);\n\n      const centerTX = cx * CHUNK_SIZE + CHUNK_SIZE / 2;\n      const centerTY = cy * CHUNK_SIZE + CHUNK_SIZE / 2;\n      const biome = getBiome(centerTX, centerTY);\n      const baseDensity = BIOME_DENSITY[biome];\n      const stats = BIOME_ENEMY_STATS[biome];\n      const biomeDef = BIOME_DEFS[biome];\n\n      rng.setSeed(cx, cy);\n      const density = Math.round(baseDensity * seasonMod.densityMult);\n      const count = rng.nextInt(0, density);\n\n      for (let i = 0; i < count; i++) {\n        const tx = cx * CHUNK_SIZE + rng.nextInt(1, CHUNK_SIZE - 2);\n        const ty = cy * CHUNK_SIZE + rng.nextInt(1, CHUNK_SIZE - 2);\n        const spawnX = tx * 32;\n        const spawnY = ty * 32;\n\n        // Scale stats with biome difficulty + seasonal modifier\n        const mult = biomeDef.difficultyMult;\n        // Roll elite affixes (~15% chance, scales with biome danger)\n        const eliteChance = 0.10 + biome * 0.02; // 10% Haven → 22% Edilas\n        const affixes = rollAffixes(rng, eliteChance);\n\n        let hpMult = 1.0;\n        let dmgMult = 1.0;\n        let defMult = 1.0;\n        let spdMult = 1.0;\n        let lootBonus = 0;\n        for (const aid of affixes) {\n          const affix = AFFIXES[aid];\n          if (!affix) continue;\n          hpMult *= affix.hpMult;\n          dmgMult *= affix.dmgMult;\n          defMult *= affix.defenseMult;\n          spdMult *= affix.speedMult;\n          lootBonus += affix.lootRarityBonus;\n        }\n\n        const eid = createEnemy(\n          spawnX, spawnY,\n          Math.round(stats.hp * mult * seasonMod.hpMult * hpMult),\n          Math.round(stats.dmg * mult * seasonMod.dmgMult * dmgMult),\n          Math.round(stats.def * mult * defMult),\n          120 + biome * 10,\n          'enemy',\n          undefined,\n          affixes,\n        );\n\n        // Apply affix-specific setup\n        EliteAffix.speedMult[eid] = spdMult;\n        EliteAffix.lootBonus[eid] = lootBonus;\n        if (affixes[0] === AffixId.Shielded || affixes[1] === AffixId.Shielded) {\n          EliteAffix.shieldHits[eid] = 3;\n        }\n        if (affixes[0] === AffixId.Frenzied || affixes[1] === AffixId.Frenzied) {\n          Combat.attackSpeed[eid] *= 1.4;\n        }\n      }\n    }\n  }\n\n  // Despawn enemies far from player (>3 chunks away)\n  const entities = enemyQuery(world);\n  const despawnDist = CHUNK_SIZE * 32 * 4;\n  for (const eid of entities) {\n    if (Health.current[eid] <= 0) continue; // Don't despawn corpses yet\n    const dx = Position.x[eid] - playerX;\n    const dy = Position.y[eid] - playerY;\n    if (dx * dx + dy * dy > despawnDist * despawnDist) {\n      Health.current[eid] = 0; // Mark for cleanup\n    }\n  }\n}\n","import { EnemyTypeDef } from '../types/combat';\nimport { WeaponType } from '../ecs/components';\nimport { AIBehavior } from '../ecs/components';\n\nexport const ENEMIES: EnemyTypeDef[] = [\n  // ═══════════════════════════════════════════════════════════════\n  // === HAVEN (Level 1-5) ===\n  // ═══════════════════════════════════════════════════════════════\n  { id: 'forest_slime', name: 'Forest Slime', biome: 'haven', hp: 25, damage: 4, defense: 1, speed: 40, aggroRadius: 80, attackSpeed: 0.8, weaponType: WeaponType.Unarmed, xpReward: 10, texture: 'enemy_slime', lootTable: [{ itemId: 'slime_gel', chance: 0.6, minQty: 1, maxQty: 2 }], aiType: 'melee', behavior: AIBehavior.Wander },\n  { id: 'shambling_corpse', name: 'Shambling Corpse', biome: 'haven', hp: 35, damage: 6, defense: 2, speed: 30, aggroRadius: 70, attackSpeed: 0.7, weaponType: WeaponType.Unarmed, xpReward: 12, texture: 'enemy_zombie', lootTable: [{ itemId: 'rotten_flesh', chance: 0.7, minQty: 1, maxQty: 2 }, { itemId: 'bone_fragment', chance: 0.3, minQty: 1, maxQty: 1 }], aiType: 'melee', behavior: AIBehavior.Chase },\n  { id: 'crawler', name: 'Crawler', biome: 'haven', hp: 18, damage: 5, defense: 1, speed: 75, aggroRadius: 60, attackSpeed: 1.2, weaponType: WeaponType.Unarmed, xpReward: 8, texture: 'enemy_crawler', lootTable: [{ itemId: 'chitin', chance: 0.5, minQty: 1, maxQty: 2 }], aiType: 'swarm', behavior: AIBehavior.Chase },\n  { id: 'plague_rat', name: 'Plague Rat', biome: 'haven', hp: 15, damage: 3, defense: 1, speed: 80, aggroRadius: 50, attackSpeed: 1.3, weaponType: WeaponType.Unarmed, xpReward: 6, texture: 'enemy_rat', lootTable: [{ itemId: 'rat_tail', chance: 0.5, minQty: 1, maxQty: 1 }, { itemId: 'plague_sample', chance: 0.1, minQty: 1, maxQty: 1 }], aiType: 'swarm', behavior: AIBehavior.Pack },\n  { id: 'lost_soul', name: 'Lost Soul', biome: 'haven', hp: 20, damage: 7, defense: 0, speed: 55, aggroRadius: 90, attackSpeed: 1.0, weaponType: WeaponType.Unarmed, xpReward: 14, texture: 'enemy_ghost', lootTable: [{ itemId: 'ectoplasm', chance: 0.4, minQty: 1, maxQty: 1 }], aiType: 'melee', behavior: AIBehavior.Phase },\n  { id: 'wild_boar', name: 'Wild Boar', biome: 'haven', hp: 40, damage: 8, defense: 3, speed: 70, aggroRadius: 100, attackSpeed: 1.0, weaponType: WeaponType.Unarmed, xpReward: 20, texture: 'enemy', lootTable: [{ itemId: 'raw_meat', chance: 0.8, minQty: 1, maxQty: 2 }, { itemId: 'leather', chance: 0.4, minQty: 1, maxQty: 1 }], aiType: 'melee', behavior: AIBehavior.Chase },\n  { id: 'angry_bee', name: 'Angry Bee', biome: 'haven', hp: 12, damage: 3, defense: 0, speed: 90, aggroRadius: 60, attackSpeed: 1.5, weaponType: WeaponType.Unarmed, xpReward: 8, texture: 'enemy', lootTable: [{ itemId: 'honey', chance: 0.3, minQty: 1, maxQty: 1 }], aiType: 'swarm', behavior: AIBehavior.Swoop },\n  { id: 'field_rat', name: 'Field Rat', biome: 'haven', hp: 15, damage: 3, defense: 1, speed: 80, aggroRadius: 50, attackSpeed: 1.2, weaponType: WeaponType.Unarmed, xpReward: 5, texture: 'enemy', lootTable: [{ itemId: 'rat_tail', chance: 0.5, minQty: 1, maxQty: 1 }], aiType: 'melee', behavior: AIBehavior.Wander },\n  { id: 'garden_spider', name: 'Garden Spider', biome: 'haven', hp: 20, damage: 5, defense: 1, speed: 65, aggroRadius: 70, attackSpeed: 1.0, weaponType: WeaponType.Unarmed, xpReward: 12, texture: 'enemy', lootTable: [{ itemId: 'spider_silk', chance: 0.5, minQty: 1, maxQty: 2 }], aiType: 'melee', behavior: AIBehavior.Ambush },\n  { id: 'scarecrow_mimic', name: 'Scarecrow Mimic', biome: 'haven', hp: 50, damage: 10, defense: 5, speed: 30, aggroRadius: 40, attackSpeed: 0.7, weaponType: WeaponType.Unarmed, xpReward: 25, texture: 'enemy', lootTable: [{ itemId: 'cloth', chance: 0.7, minQty: 1, maxQty: 3 }, { itemId: 'straw', chance: 0.8, minQty: 2, maxQty: 4 }], aiType: 'tank', behavior: AIBehavior.Ambush },\n  { id: 'wild_wolf', name: 'Wild Wolf', biome: 'haven', hp: 35, damage: 9, defense: 2, speed: 85, aggroRadius: 120, attackSpeed: 1.1, weaponType: WeaponType.Unarmed, xpReward: 18, texture: 'enemy', lootTable: [{ itemId: 'wolf_pelt', chance: 0.6, minQty: 1, maxQty: 1 }, { itemId: 'fang', chance: 0.3, minQty: 1, maxQty: 2 }], aiType: 'melee', behavior: AIBehavior.Pack },\n\n  // ═══════════════════════════════════════════════════════════════\n  // === ROTWOOD (Level 5-12) ===\n  // ═══════════════════════════════════════════════════════════════\n  { id: 'corpse_spider', name: 'Corpse Spider', biome: 'rotwood', hp: 45, damage: 11, defense: 4, speed: 70, aggroRadius: 100, attackSpeed: 1.2, weaponType: WeaponType.Unarmed, xpReward: 28, texture: 'enemy_spider', lootTable: [{ itemId: 'toxic_silk', chance: 0.5, minQty: 1, maxQty: 2 }, { itemId: 'venom_sac', chance: 0.2, minQty: 1, maxQty: 1 }], aiType: 'melee', behavior: AIBehavior.Ambush },\n  { id: 'rotting_treant', name: 'Rotting Treant', biome: 'rotwood', hp: 120, damage: 18, defense: 12, speed: 25, aggroRadius: 80, attackSpeed: 0.6, weaponType: WeaponType.Unarmed, xpReward: 50, texture: 'enemy_treant', lootTable: [{ itemId: 'dark_wood', chance: 0.8, minQty: 2, maxQty: 4 }, { itemId: 'treant_heart', chance: 0.15, minQty: 1, maxQty: 1 }], aiType: 'tank', behavior: AIBehavior.Stationary },\n  { id: 'will_o_wisp', name: \"Will-o'-Wisp\", biome: 'rotwood', hp: 22, damage: 9, defense: 0, speed: 95, aggroRadius: 110, attackSpeed: 1.4, weaponType: WeaponType.Unarmed, xpReward: 24, texture: 'enemy_wisp', lootTable: [{ itemId: 'wisp_light', chance: 0.4, minQty: 1, maxQty: 1 }], aiType: 'melee', behavior: AIBehavior.Phase },\n  { id: 'spore_cloud', name: 'Spore Cloud', biome: 'rotwood', hp: 40, damage: 6, defense: 2, speed: 35, aggroRadius: 60, attackSpeed: 0.8, weaponType: WeaponType.Unarmed, xpReward: 26, texture: 'enemy_spore', lootTable: [{ itemId: 'fungal_cap', chance: 0.7, minQty: 1, maxQty: 3 }, { itemId: 'spore_sac', chance: 0.3, minQty: 1, maxQty: 1 }], aiType: 'ranged', behavior: AIBehavior.Stationary },\n  { id: 'rot_spider', name: 'Rot Spider', biome: 'rotwood', hp: 50, damage: 12, defense: 4, speed: 65, aggroRadius: 110, attackSpeed: 1.2, weaponType: WeaponType.Unarmed, xpReward: 30, texture: 'enemy', lootTable: [{ itemId: 'toxic_silk', chance: 0.5, minQty: 1, maxQty: 2 }], aiType: 'melee', behavior: AIBehavior.Ambush },\n  { id: 'fungal_crawler', name: 'Fungal Crawler', biome: 'rotwood', hp: 45, damage: 10, defense: 6, speed: 50, aggroRadius: 90, attackSpeed: 0.9, weaponType: WeaponType.Unarmed, xpReward: 28, texture: 'enemy', lootTable: [{ itemId: 'fungal_cap', chance: 0.6, minQty: 1, maxQty: 3 }], aiType: 'tank', behavior: AIBehavior.Wander },\n  { id: 'poison_moth', name: 'Poison Moth', biome: 'rotwood', hp: 30, damage: 8, defense: 2, speed: 85, aggroRadius: 100, attackSpeed: 1.3, weaponType: WeaponType.Unarmed, xpReward: 22, texture: 'enemy', lootTable: [{ itemId: 'moth_dust', chance: 0.4, minQty: 1, maxQty: 2 }], aiType: 'ranged', behavior: AIBehavior.Swoop },\n  { id: 'spore_bat', name: 'Spore Bat', biome: 'rotwood', hp: 25, damage: 7, defense: 2, speed: 95, aggroRadius: 100, attackSpeed: 1.4, weaponType: WeaponType.Unarmed, xpReward: 20, texture: 'enemy', lootTable: [{ itemId: 'bat_wing', chance: 0.5, minQty: 1, maxQty: 2 }], aiType: 'swarm', behavior: AIBehavior.Swoop },\n  { id: 'vine_strangler', name: 'Vine Strangler', biome: 'rotwood', hp: 60, damage: 14, defense: 5, speed: 0, aggroRadius: 40, attackSpeed: 0.8, weaponType: WeaponType.Unarmed, xpReward: 35, texture: 'enemy', lootTable: [{ itemId: 'vine_rope', chance: 0.7, minQty: 1, maxQty: 3 }], aiType: 'melee', behavior: AIBehavior.Stationary },\n  { id: 'mushroom_golem', name: 'Mushroom Golem', biome: 'rotwood', hp: 90, damage: 15, defense: 10, speed: 35, aggroRadius: 70, attackSpeed: 0.7, weaponType: WeaponType.Unarmed, xpReward: 45, texture: 'enemy', lootTable: [{ itemId: 'golem_spore', chance: 0.6, minQty: 1, maxQty: 2 }], aiType: 'tank', behavior: AIBehavior.Wander },\n  { id: 'corrupted_treant', name: 'Corrupted Treant', biome: 'rotwood', hp: 120, damage: 18, defense: 12, speed: 25, aggroRadius: 80, attackSpeed: 0.6, weaponType: WeaponType.Unarmed, xpReward: 50, texture: 'enemy', lootTable: [{ itemId: 'dark_wood', chance: 0.8, minQty: 2, maxQty: 4 }, { itemId: 'treant_heart', chance: 0.15, minQty: 1, maxQty: 1 }], aiType: 'tank', behavior: AIBehavior.Stationary },\n\n  // ═══════════════════════════════════════════════════════════════\n  // === ASHLANDS (Level 12-20) ===\n  // ═══════════════════════════════════════════════════════════════\n  { id: 'fire_imp', name: 'Fire Imp', biome: 'ashlands', hp: 70, damage: 20, defense: 8, speed: 80, aggroRadius: 130, attackSpeed: 1.5, weaponType: WeaponType.Staff, xpReward: 50, texture: 'enemy_imp', lootTable: [{ itemId: 'fire_essence', chance: 0.5, minQty: 1, maxQty: 2 }], aiType: 'ranged', behavior: AIBehavior.Ranged },\n  { id: 'magma_golem', name: 'Magma Golem', biome: 'ashlands', hp: 200, damage: 30, defense: 20, speed: 20, aggroRadius: 100, attackSpeed: 0.5, weaponType: WeaponType.Hammer, xpReward: 80, texture: 'enemy_golem', lootTable: [{ itemId: 'magma_core', chance: 0.3, minQty: 1, maxQty: 1 }, { itemId: 'volcanic_rock', chance: 0.7, minQty: 2, maxQty: 4 }], aiType: 'tank', behavior: AIBehavior.Chase },\n  { id: 'flame_sprite', name: 'Flame Sprite', biome: 'ashlands', hp: 45, damage: 22, defense: 3, speed: 90, aggroRadius: 120, attackSpeed: 1.6, weaponType: WeaponType.Staff, xpReward: 48, texture: 'enemy_sprite', lootTable: [{ itemId: 'ember_shard', chance: 0.5, minQty: 1, maxQty: 3 }, { itemId: 'fire_mote', chance: 0.2, minQty: 1, maxQty: 1 }], aiType: 'ranged', behavior: AIBehavior.Ranged },\n  { id: 'ember_bat', name: 'Ember Bat', biome: 'ashlands', hp: 35, damage: 16, defense: 4, speed: 100, aggroRadius: 110, attackSpeed: 1.5, weaponType: WeaponType.Unarmed, xpReward: 40, texture: 'enemy_bat', lootTable: [{ itemId: 'bat_wing', chance: 0.5, minQty: 1, maxQty: 2 }, { itemId: 'ember_shard', chance: 0.3, minQty: 1, maxQty: 1 }], aiType: 'swarm', behavior: AIBehavior.Swoop },\n  { id: 'lava_golem', name: 'Lava Golem', biome: 'ashlands', hp: 200, damage: 30, defense: 20, speed: 20, aggroRadius: 100, attackSpeed: 0.5, weaponType: WeaponType.Hammer, xpReward: 80, texture: 'enemy', lootTable: [{ itemId: 'magma_core', chance: 0.3, minQty: 1, maxQty: 1 }, { itemId: 'volcanic_rock', chance: 0.7, minQty: 2, maxQty: 4 }], aiType: 'tank', behavior: AIBehavior.Wander },\n  { id: 'ash_wraith', name: 'Ash Wraith', biome: 'ashlands', hp: 60, damage: 22, defense: 5, speed: 90, aggroRadius: 120, attackSpeed: 1.3, weaponType: WeaponType.Unarmed, xpReward: 55, texture: 'enemy', lootTable: [{ itemId: 'wraith_dust', chance: 0.5, minQty: 1, maxQty: 2 }], aiType: 'assassin', behavior: AIBehavior.Phase },\n  { id: 'magma_beetle', name: 'Magma Beetle', biome: 'ashlands', hp: 80, damage: 18, defense: 15, speed: 45, aggroRadius: 90, attackSpeed: 1.0, weaponType: WeaponType.Unarmed, xpReward: 45, texture: 'enemy', lootTable: [{ itemId: 'beetle_shell', chance: 0.6, minQty: 1, maxQty: 2 }], aiType: 'tank', behavior: AIBehavior.Wander },\n  { id: 'flame_serpent', name: 'Flame Serpent', biome: 'ashlands', hp: 90, damage: 25, defense: 10, speed: 75, aggroRadius: 110, attackSpeed: 1.2, weaponType: WeaponType.Unarmed, xpReward: 60, texture: 'enemy', lootTable: [{ itemId: 'serpent_fang', chance: 0.4, minQty: 1, maxQty: 2 }, { itemId: 'fire_scale', chance: 0.3, minQty: 1, maxQty: 1 }], aiType: 'melee', behavior: AIBehavior.Chase },\n  { id: 'ember_elemental', name: 'Ember Elemental', biome: 'ashlands', hp: 55, damage: 28, defense: 3, speed: 70, aggroRadius: 140, attackSpeed: 1.6, weaponType: WeaponType.Staff, xpReward: 65, texture: 'enemy', lootTable: [{ itemId: 'ember_shard', chance: 0.5, minQty: 1, maxQty: 3 }], aiType: 'ranged', behavior: AIBehavior.Ranged },\n  { id: 'obsidian_knight', name: 'Obsidian Knight', biome: 'ashlands', hp: 150, damage: 28, defense: 18, speed: 50, aggroRadius: 100, attackSpeed: 0.8, weaponType: WeaponType.Sword, xpReward: 70, texture: 'enemy', lootTable: [{ itemId: 'obsidian_shard', chance: 0.5, minQty: 1, maxQty: 2 }], aiType: 'melee', behavior: AIBehavior.Chase },\n\n  // ═══════════════════════════════════════════════════════════════\n  // === DROWNED DEPTHS (Level 20-28) ===\n  // ═══════════════════════════════════════════════════════════════\n  { id: 'marsh_lurker', name: 'Marsh Lurker', biome: 'drowned', hp: 100, damage: 26, defense: 10, speed: 55, aggroRadius: 90, attackSpeed: 1.0, weaponType: WeaponType.Unarmed, xpReward: 65, texture: 'enemy_lurker', lootTable: [{ itemId: 'swamp_hide', chance: 0.6, minQty: 1, maxQty: 2 }, { itemId: 'marsh_moss', chance: 0.4, minQty: 1, maxQty: 3 }], aiType: 'melee', behavior: AIBehavior.Ambush },\n  { id: 'poison_toad', name: 'Poison Toad', biome: 'drowned', hp: 75, damage: 18, defense: 8, speed: 45, aggroRadius: 70, attackSpeed: 0.9, weaponType: WeaponType.Unarmed, xpReward: 55, texture: 'enemy_toad', lootTable: [{ itemId: 'toad_venom', chance: 0.5, minQty: 1, maxQty: 2 }, { itemId: 'toad_skin', chance: 0.3, minQty: 1, maxQty: 1 }], aiType: 'ranged', behavior: AIBehavior.Ranged },\n  { id: 'swamp_zombie', name: 'Swamp Zombie', biome: 'drowned', hp: 130, damage: 25, defense: 14, speed: 35, aggroRadius: 80, attackSpeed: 0.7, weaponType: WeaponType.Unarmed, xpReward: 60, texture: 'enemy_zombie', lootTable: [{ itemId: 'waterlogged_bone', chance: 0.7, minQty: 1, maxQty: 3 }, { itemId: 'rotten_flesh', chance: 0.5, minQty: 1, maxQty: 2 }], aiType: 'tank', behavior: AIBehavior.Chase },\n  { id: 'drowned_wraith', name: 'Drowned Wraith', biome: 'drowned', hp: 85, damage: 30, defense: 6, speed: 70, aggroRadius: 120, attackSpeed: 1.2, weaponType: WeaponType.Unarmed, xpReward: 72, texture: 'enemy_wraith', lootTable: [{ itemId: 'wraith_dust', chance: 0.4, minQty: 1, maxQty: 2 }, { itemId: 'drowned_relic', chance: 0.1, minQty: 1, maxQty: 1 }], aiType: 'assassin', behavior: AIBehavior.Phase },\n  { id: 'drowned_ghoul', name: 'Drowned Ghoul', biome: 'drowned', hp: 120, damage: 28, defense: 12, speed: 50, aggroRadius: 100, attackSpeed: 0.9, weaponType: WeaponType.Unarmed, xpReward: 70, texture: 'enemy', lootTable: [{ itemId: 'waterlogged_bone', chance: 0.6, minQty: 1, maxQty: 3 }], aiType: 'melee', behavior: AIBehavior.Chase },\n  { id: 'acid_jellyfish', name: 'Acid Jellyfish', biome: 'drowned', hp: 60, damage: 20, defense: 3, speed: 40, aggroRadius: 80, attackSpeed: 1.2, weaponType: WeaponType.Unarmed, xpReward: 55, texture: 'enemy', lootTable: [{ itemId: 'acid_gland', chance: 0.4, minQty: 1, maxQty: 1 }], aiType: 'ranged', behavior: AIBehavior.Ranged },\n  { id: 'coral_golem', name: 'Coral Golem', biome: 'drowned', hp: 180, damage: 32, defense: 22, speed: 25, aggroRadius: 80, attackSpeed: 0.6, weaponType: WeaponType.Hammer, xpReward: 85, texture: 'enemy', lootTable: [{ itemId: 'coral_chunk', chance: 0.7, minQty: 2, maxQty: 4 }], aiType: 'tank', behavior: AIBehavior.Stationary },\n  { id: 'deep_lurker', name: 'Deep Lurker', biome: 'drowned', hp: 100, damage: 35, defense: 8, speed: 80, aggroRadius: 150, attackSpeed: 1.5, weaponType: WeaponType.Dagger, xpReward: 75, texture: 'enemy', lootTable: [{ itemId: 'lurker_tooth', chance: 0.5, minQty: 1, maxQty: 2 }], aiType: 'assassin', behavior: AIBehavior.Ambush },\n  { id: 'tide_witch', name: 'Tide Witch', biome: 'drowned', hp: 80, damage: 30, defense: 10, speed: 55, aggroRadius: 130, attackSpeed: 1.0, weaponType: WeaponType.Staff, xpReward: 80, texture: 'enemy', lootTable: [{ itemId: 'tide_crystal', chance: 0.3, minQty: 1, maxQty: 1 }], aiType: 'healer', behavior: AIBehavior.Support },\n  { id: 'barnacle_brute', name: 'Barnacle Brute', biome: 'drowned', hp: 160, damage: 30, defense: 20, speed: 30, aggroRadius: 90, attackSpeed: 0.7, weaponType: WeaponType.Hammer, xpReward: 75, texture: 'enemy', lootTable: [{ itemId: 'barnacle_plate', chance: 0.6, minQty: 1, maxQty: 3 }], aiType: 'tank', behavior: AIBehavior.Wander },\n  { id: 'siren', name: 'Siren', biome: 'drowned', hp: 70, damage: 22, defense: 6, speed: 65, aggroRadius: 160, attackSpeed: 1.1, weaponType: WeaponType.Staff, xpReward: 65, texture: 'enemy', lootTable: [{ itemId: 'siren_tear', chance: 0.2, minQty: 1, maxQty: 1 }], aiType: 'ranged', behavior: AIBehavior.Ranged },\n\n  // ═══════════════════════════════════════════════════════════════\n  // === BONE WASTES (Level 28-36) ===\n  // ═══════════════════════════════════════════════════════════════\n  { id: 'skeleton', name: 'Skeleton', biome: 'bone_wastes', hp: 140, damage: 32, defense: 16, speed: 60, aggroRadius: 110, attackSpeed: 1.0, weaponType: WeaponType.Sword, xpReward: 85, texture: 'enemy_skeleton', lootTable: [{ itemId: 'bone_fragment', chance: 0.8, minQty: 1, maxQty: 3 }, { itemId: 'rusty_sword', chance: 0.1, minQty: 1, maxQty: 1 }], aiType: 'melee', behavior: AIBehavior.Wander },\n  { id: 'skeleton_archer', name: 'Skeleton Archer', biome: 'bone_wastes', hp: 110, damage: 38, defense: 10, speed: 50, aggroRadius: 160, attackSpeed: 1.0, weaponType: WeaponType.Bow, xpReward: 90, texture: 'enemy_skeleton_archer', lootTable: [{ itemId: 'ancient_arrow', chance: 0.5, minQty: 2, maxQty: 5 }, { itemId: 'bone_bow', chance: 0.08, minQty: 1, maxQty: 1 }], aiType: 'ranged', behavior: AIBehavior.Ranged },\n  { id: 'bone_knight', name: 'Bone Knight', biome: 'bone_wastes', hp: 220, damage: 40, defense: 28, speed: 45, aggroRadius: 100, attackSpeed: 0.8, weaponType: WeaponType.Sword, xpReward: 110, texture: 'enemy_knight', lootTable: [{ itemId: 'bone_plate', chance: 0.5, minQty: 1, maxQty: 2 }, { itemId: 'knight_shield', chance: 0.05, minQty: 1, maxQty: 1 }], aiType: 'tank', behavior: AIBehavior.Chase },\n  { id: 'necromancer', name: 'Necromancer', biome: 'bone_wastes', hp: 100, damage: 45, defense: 8, speed: 40, aggroRadius: 150, attackSpeed: 0.9, weaponType: WeaponType.Staff, xpReward: 120, texture: 'enemy_necromancer', lootTable: [{ itemId: 'dark_tome', chance: 0.2, minQty: 1, maxQty: 1 }, { itemId: 'necrotic_essence', chance: 0.5, minQty: 1, maxQty: 2 }], aiType: 'ranged', behavior: AIBehavior.Support },\n  { id: 'zombie', name: 'Zombie', biome: 'bone_wastes', hp: 160, damage: 30, defense: 15, speed: 30, aggroRadius: 80, attackSpeed: 0.7, weaponType: WeaponType.Unarmed, xpReward: 80, texture: 'enemy_zombie', lootTable: [{ itemId: 'rotten_flesh', chance: 0.8, minQty: 1, maxQty: 3 }, { itemId: 'bone_fragment', chance: 0.5, minQty: 1, maxQty: 2 }], aiType: 'tank', behavior: AIBehavior.Chase },\n  { id: 'wraith', name: 'Wraith', biome: 'bone_wastes', hp: 130, damage: 42, defense: 12, speed: 75, aggroRadius: 140, attackSpeed: 1.2, weaponType: WeaponType.Unarmed, xpReward: 100, texture: 'enemy_wraith', lootTable: [{ itemId: 'wraith_dust', chance: 0.5, minQty: 1, maxQty: 2 }, { itemId: 'soul_shard', chance: 0.15, minQty: 1, maxQty: 1 }], aiType: 'assassin', behavior: AIBehavior.Phase },\n  { id: 'bone_warrior', name: 'Bone Warrior', biome: 'bone_wastes', hp: 180, damage: 38, defense: 22, speed: 60, aggroRadius: 120, attackSpeed: 1.0, weaponType: WeaponType.Sword, xpReward: 100, texture: 'enemy', lootTable: [{ itemId: 'bone_fragment', chance: 0.7, minQty: 1, maxQty: 3 }], aiType: 'melee', behavior: AIBehavior.Chase },\n  { id: 'sand_scorpion', name: 'Sand Scorpion', biome: 'bone_wastes', hp: 140, damage: 35, defense: 18, speed: 70, aggroRadius: 100, attackSpeed: 1.2, weaponType: WeaponType.Unarmed, xpReward: 90, texture: 'enemy', lootTable: [{ itemId: 'scorpion_venom', chance: 0.4, minQty: 1, maxQty: 2 }], aiType: 'melee', behavior: AIBehavior.Ambush },\n  { id: 'mirage_phantom', name: 'Mirage Phantom', biome: 'bone_wastes', hp: 100, damage: 40, defense: 10, speed: 90, aggroRadius: 140, attackSpeed: 1.4, weaponType: WeaponType.Unarmed, xpReward: 95, texture: 'enemy', lootTable: [{ itemId: 'mirage_dust', chance: 0.3, minQty: 1, maxQty: 1 }], aiType: 'assassin', behavior: AIBehavior.Phase },\n  { id: 'dust_devil', name: 'Dust Devil', biome: 'bone_wastes', hp: 80, damage: 30, defense: 5, speed: 100, aggroRadius: 120, attackSpeed: 1.6, weaponType: WeaponType.Unarmed, xpReward: 85, texture: 'enemy', lootTable: [{ itemId: 'wind_essence', chance: 0.4, minQty: 1, maxQty: 2 }], aiType: 'swarm', behavior: AIBehavior.Swoop },\n  { id: 'skeletal_archer', name: 'Skeletal Archer', biome: 'bone_wastes', hp: 110, damage: 42, defense: 12, speed: 50, aggroRadius: 160, attackSpeed: 1.0, weaponType: WeaponType.Bow, xpReward: 100, texture: 'enemy', lootTable: [{ itemId: 'ancient_arrow', chance: 0.5, minQty: 2, maxQty: 5 }], aiType: 'ranged', behavior: AIBehavior.Ranged },\n  { id: 'mummy_guardian', name: 'Mummy Guardian', biome: 'bone_wastes', hp: 220, damage: 36, defense: 25, speed: 35, aggroRadius: 80, attackSpeed: 0.7, weaponType: WeaponType.Unarmed, xpReward: 110, texture: 'enemy', lootTable: [{ itemId: 'ancient_bandage', chance: 0.6, minQty: 1, maxQty: 2 }, { itemId: 'desert_relic', chance: 0.1, minQty: 1, maxQty: 1 }], aiType: 'tank', behavior: AIBehavior.Wander },\n  { id: 'sand_worm', name: 'Sand Worm', biome: 'bone_wastes', hp: 160, damage: 45, defense: 15, speed: 75, aggroRadius: 100, attackSpeed: 0.9, weaponType: WeaponType.Unarmed, xpReward: 105, texture: 'enemy', lootTable: [{ itemId: 'worm_segment', chance: 0.5, minQty: 1, maxQty: 3 }], aiType: 'melee', behavior: AIBehavior.Ambush },\n\n  // ═══════════════════════════════════════════════════════════════\n  // === THE VOID (Level 36-44) ===\n  // ═══════════════════════════════════════════════════════════════\n  { id: 'void_crawler', name: 'Void Crawler', biome: 'the_void', hp: 240, damage: 48, defense: 24, speed: 65, aggroRadius: 130, attackSpeed: 1.1, weaponType: WeaponType.Unarmed, xpReward: 140, texture: 'enemy_void', lootTable: [{ itemId: 'void_chitin', chance: 0.5, minQty: 1, maxQty: 2 }, { itemId: 'void_essence', chance: 0.2, minQty: 1, maxQty: 1 }], aiType: 'melee', behavior: AIBehavior.Pack },\n  { id: 'shadow_stalker', name: 'Shadow Stalker', biome: 'the_void', hp: 190, damage: 55, defense: 18, speed: 95, aggroRadius: 170, attackSpeed: 1.4, weaponType: WeaponType.Dagger, xpReward: 155, texture: 'enemy_shadow', lootTable: [{ itemId: 'shadow_essence', chance: 0.4, minQty: 1, maxQty: 2 }, { itemId: 'shadow_blade', chance: 0.05, minQty: 1, maxQty: 1 }], aiType: 'assassin', behavior: AIBehavior.Ambush },\n  { id: 'nightmare', name: 'Nightmare', biome: 'the_void', hp: 280, damage: 52, defense: 22, speed: 80, aggroRadius: 150, attackSpeed: 1.2, weaponType: WeaponType.Unarmed, xpReward: 165, texture: 'enemy_nightmare', lootTable: [{ itemId: 'nightmare_dust', chance: 0.5, minQty: 1, maxQty: 2 }, { itemId: 'dream_shard', chance: 0.15, minQty: 1, maxQty: 1 }], aiType: 'melee', behavior: AIBehavior.Phase },\n  { id: 'phantom', name: 'Phantom', biome: 'the_void', hp: 160, damage: 50, defense: 15, speed: 85, aggroRadius: 160, attackSpeed: 1.3, weaponType: WeaponType.Staff, xpReward: 150, texture: 'enemy_phantom', lootTable: [{ itemId: 'phantom_essence', chance: 0.4, minQty: 1, maxQty: 2 }, { itemId: 'spectral_cloth', chance: 0.2, minQty: 1, maxQty: 1 }], aiType: 'ranged', behavior: AIBehavior.Phase },\n  { id: 'void_shade', name: 'Void Shade', biome: 'the_void', hp: 250, damage: 50, defense: 25, speed: 90, aggroRadius: 150, attackSpeed: 1.3, weaponType: WeaponType.Dagger, xpReward: 150, texture: 'enemy', lootTable: [{ itemId: 'void_essence', chance: 0.4, minQty: 1, maxQty: 2 }], aiType: 'assassin', behavior: AIBehavior.Ambush },\n  { id: 'reality_tear', name: 'Reality Tear', biome: 'the_void', hp: 150, damage: 55, defense: 15, speed: 0, aggroRadius: 100, attackSpeed: 1.5, weaponType: WeaponType.Staff, xpReward: 130, texture: 'enemy', lootTable: [{ itemId: 'reality_shard', chance: 0.3, minQty: 1, maxQty: 1 }], aiType: 'ranged', behavior: AIBehavior.Stationary },\n  { id: 'phase_stalker', name: 'Phase Stalker', biome: 'the_void', hp: 200, damage: 60, defense: 20, speed: 100, aggroRadius: 180, attackSpeed: 1.4, weaponType: WeaponType.Dagger, xpReward: 160, texture: 'enemy', lootTable: [{ itemId: 'phase_crystal', chance: 0.25, minQty: 1, maxQty: 1 }], aiType: 'assassin', behavior: AIBehavior.Phase },\n  { id: 'echo_wraith', name: 'Echo Wraith', biome: 'the_void', hp: 180, damage: 45, defense: 18, speed: 75, aggroRadius: 130, attackSpeed: 1.1, weaponType: WeaponType.Staff, xpReward: 140, texture: 'enemy', lootTable: [{ itemId: 'echo_crystal', chance: 0.3, minQty: 1, maxQty: 2 }], aiType: 'ranged', behavior: AIBehavior.Ranged },\n  { id: 'dimension_crawler', name: 'Dimension Crawler', biome: 'the_void', hp: 300, damage: 48, defense: 30, speed: 45, aggroRadius: 100, attackSpeed: 0.8, weaponType: WeaponType.Unarmed, xpReward: 170, texture: 'enemy', lootTable: [{ itemId: 'dimension_fragment', chance: 0.3, minQty: 1, maxQty: 2 }], aiType: 'tank', behavior: AIBehavior.Wander },\n  { id: 'void_sorcerer', name: 'Void Sorcerer', biome: 'the_void', hp: 160, damage: 58, defense: 12, speed: 60, aggroRadius: 160, attackSpeed: 1.0, weaponType: WeaponType.Staff, xpReward: 155, texture: 'enemy', lootTable: [{ itemId: 'void_crystal', chance: 0.2, minQty: 1, maxQty: 1 }], aiType: 'healer', behavior: AIBehavior.Support },\n  { id: 'nightmare_hound', name: 'Nightmare Hound', biome: 'the_void', hp: 220, damage: 52, defense: 22, speed: 95, aggroRadius: 140, attackSpeed: 1.3, weaponType: WeaponType.Unarmed, xpReward: 145, texture: 'enemy', lootTable: [{ itemId: 'nightmare_dust', chance: 0.4, minQty: 1, maxQty: 2 }], aiType: 'melee', behavior: AIBehavior.Pack },\n\n  // ═══════════════════════════════════════════════════════════════\n  // === EDILAS (Level 44-50) ===\n  // ═══════════════════════════════════════════════════════════════\n  { id: 'living_terrain', name: 'Living Terrain', biome: 'edilas', hp: 400, damage: 60, defense: 35, speed: 20, aggroRadius: 60, attackSpeed: 0.6, weaponType: WeaponType.Unarmed, xpReward: 200, texture: 'enemy', lootTable: [{ itemId: 'living_stone', chance: 0.5, minQty: 1, maxQty: 2 }], aiType: 'tank', behavior: AIBehavior.Stationary },\n  { id: 'corruption_avatar', name: 'Corruption Avatar', biome: 'edilas', hp: 350, damage: 70, defense: 25, speed: 70, aggroRadius: 150, attackSpeed: 1.2, weaponType: WeaponType.Staff, xpReward: 250, texture: 'enemy', lootTable: [{ itemId: 'corruption_crystal', chance: 0.4, minQty: 1, maxQty: 2 }], aiType: 'ranged', behavior: AIBehavior.Ranged },\n  { id: 'world_serpent_spawn', name: 'World Serpent Spawn', biome: 'edilas', hp: 280, damage: 65, defense: 28, speed: 80, aggroRadius: 120, attackSpeed: 1.1, weaponType: WeaponType.Unarmed, xpReward: 220, texture: 'enemy', lootTable: [{ itemId: 'serpent_scale', chance: 0.3, minQty: 1, maxQty: 2 }], aiType: 'melee', behavior: AIBehavior.Chase },\n  { id: 'edilas_guardian', name: 'EDILAS Guardian', biome: 'edilas', hp: 500, damage: 55, defense: 40, speed: 40, aggroRadius: 100, attackSpeed: 0.8, weaponType: WeaponType.Hammer, xpReward: 280, texture: 'enemy', lootTable: [{ itemId: 'guardian_core', chance: 0.2, minQty: 1, maxQty: 1 }], aiType: 'tank', behavior: AIBehavior.Wander },\n  { id: 'reality_anchor', name: 'Reality Anchor', biome: 'edilas', hp: 200, damage: 75, defense: 15, speed: 0, aggroRadius: 80, attackSpeed: 1.5, weaponType: WeaponType.Staff, xpReward: 190, texture: 'enemy', lootTable: [{ itemId: 'primordial_essence', chance: 0.15, minQty: 1, maxQty: 1 }], aiType: 'ranged', behavior: AIBehavior.Stationary },\n\n  // ═══════════════════════════════════════════════════════════════\n  // === ELITES ===\n  // ═══════════════════════════════════════════════════════════════\n  { id: 'alpha_wolf', name: 'Alpha Wolf', biome: 'haven', hp: 80, damage: 14, defense: 5, speed: 90, aggroRadius: 150, attackSpeed: 1.3, weaponType: WeaponType.Unarmed, xpReward: 45, texture: 'enemy_wolf_alpha', lootTable: [{ itemId: 'alpha_pelt', chance: 0.7, minQty: 1, maxQty: 1 }, { itemId: 'fang', chance: 0.6, minQty: 2, maxQty: 3 }, { itemId: 'wolf_trophy', chance: 0.15, minQty: 1, maxQty: 1 }], aiType: 'melee', behavior: AIBehavior.Pack },\n  { id: 'goblin_chief', name: 'Goblin Chief', biome: 'rotwood', hp: 150, damage: 22, defense: 12, speed: 65, aggroRadius: 130, attackSpeed: 1.1, weaponType: WeaponType.Axe, xpReward: 80, texture: 'enemy_goblin_chief', lootTable: [{ itemId: 'goblin_crown', chance: 0.3, minQty: 1, maxQty: 1 }, { itemId: 'gold_coins', chance: 0.8, minQty: 5, maxQty: 15 }], aiType: 'melee', behavior: AIBehavior.Pack },\n  { id: 'skeleton_lord', name: 'Skeleton Lord', biome: 'bone_wastes', hp: 300, damage: 48, defense: 30, speed: 55, aggroRadius: 140, attackSpeed: 0.9, weaponType: WeaponType.Sword, xpReward: 160, texture: 'enemy_skeleton_lord', lootTable: [{ itemId: 'dark_bone', chance: 0.6, minQty: 2, maxQty: 4 }, { itemId: 'lords_blade', chance: 0.1, minQty: 1, maxQty: 1 }, { itemId: 'soul_shard', chance: 0.4, minQty: 1, maxQty: 2 }], aiType: 'tank', behavior: AIBehavior.Pack },\n\n  // ═══════════════════════════════════════════════════════════════\n  // === NIGHT-ONLY ENEMIES ===\n  // ═══════════════════════════════════════════════════════════════\n  { id: 'banshee', name: 'Banshee', biome: 'haven', hp: 55, damage: 15, defense: 2, speed: 80, aggroRadius: 140, attackSpeed: 1.4, weaponType: WeaponType.Unarmed, xpReward: 35, texture: 'enemy_banshee', lootTable: [{ itemId: 'ectoplasm', chance: 0.5, minQty: 1, maxQty: 2 }, { itemId: 'banshee_wail', chance: 0.15, minQty: 1, maxQty: 1 }], aiType: 'ranged', behavior: AIBehavior.Phase, nightOnly: true },\n  { id: 'flesh_golem', name: 'Flesh Golem', biome: 'rotwood', hp: 200, damage: 28, defense: 18, speed: 30, aggroRadius: 90, attackSpeed: 0.6, weaponType: WeaponType.Unarmed, xpReward: 65, texture: 'enemy_flesh_golem', lootTable: [{ itemId: 'stitched_flesh', chance: 0.6, minQty: 1, maxQty: 3 }, { itemId: 'golem_heart', chance: 0.1, minQty: 1, maxQty: 1 }], aiType: 'tank', behavior: AIBehavior.Chase, nightOnly: true },\n  { id: 'dark_mage', name: 'Dark Mage', biome: 'bone_wastes', hp: 120, damage: 50, defense: 8, speed: 55, aggroRadius: 160, attackSpeed: 1.0, weaponType: WeaponType.Staff, xpReward: 130, texture: 'enemy_dark_mage', lootTable: [{ itemId: 'dark_tome', chance: 0.3, minQty: 1, maxQty: 1 }, { itemId: 'shadow_essence', chance: 0.5, minQty: 1, maxQty: 2 }, { itemId: 'mage_robe', chance: 0.08, minQty: 1, maxQty: 1 }], aiType: 'ranged', behavior: AIBehavior.Ranged, nightOnly: true },\n];\n\n/** Quick lookup map for enemy definitions by ID */\nexport const ENEMY_DB = new Map<string, EnemyTypeDef>(ENEMIES.map(e => [e.id, e]));\n","export interface LegendaryEffectDef {\n  id: string;\n  name: string;\n  description: string;\n  triggerType: 'on_hit' | 'on_kill' | 'on_crit' | 'on_damaged' | 'on_death' | 'passive';\n  chance: number;        // Trigger probability (1.0 = always)\n  magnitude: number;     // Effect strength\n  duration?: number;     // Effect duration in seconds (if applicable)\n  maxStacks?: number;    // Max stacks (if applicable)\n  cooldown: number;      // Internal cooldown in seconds\n  visualEffect: string;  // Particle/visual effect key\n}\n\nexport const LEGENDARY_EFFECTS: LegendaryEffectDef[] = [\n  {\n    id: 'blood_leech', name: 'Blood Leech',\n    description: '3% of damage dealt is healed as HP.',\n    triggerType: 'on_hit', chance: 1.0, magnitude: 0.03,\n    cooldown: 0, visualEffect: 'heal_red',\n  },\n  {\n    id: 'shadow_phase', name: 'Shadow Phase',\n    description: '10% chance to dodge attacks with brief invincibility.',\n    triggerType: 'on_damaged', chance: 0.10, magnitude: 0.5,\n    duration: 0.3, cooldown: 2, visualEffect: 'shadow_dodge',\n  },\n  {\n    id: 'corruption_absorb', name: 'Corruption Absorb',\n    description: 'Convert corruption damage to healing instead.',\n    triggerType: 'passive', chance: 1.0, magnitude: 1.0,\n    cooldown: 0, visualEffect: 'corruption_heal',\n  },\n  {\n    id: 'titan_slayer', name: 'Titan Slayer',\n    description: '+25% damage to bosses and titans.',\n    triggerType: 'passive', chance: 1.0, magnitude: 0.25,\n    cooldown: 0, visualEffect: 'power_glow',\n  },\n  {\n    id: 'shadow_wisp', name: 'Shadow Wisp',\n    description: 'Summon a damaging wisp on kill that attacks nearby enemies.',\n    triggerType: 'on_kill', chance: 1.0, magnitude: 50,\n    duration: 5, cooldown: 3, visualEffect: 'wisp_summon',\n  },\n  {\n    id: 'chain_lightning', name: 'Chain Lightning',\n    description: '15% chance for attacks to chain to 2 nearby enemies.',\n    triggerType: 'on_hit', chance: 0.15, magnitude: 0.5,\n    cooldown: 1, visualEffect: 'lightning_chain',\n  },\n  {\n    id: 'soul_harvest', name: 'Soul Harvest',\n    description: 'Gain 5% max HP for 30s on kill (stacks 5x).',\n    triggerType: 'on_kill', chance: 1.0, magnitude: 0.05,\n    duration: 30, maxStacks: 5, cooldown: 0, visualEffect: 'soul_absorb',\n  },\n  {\n    id: 'frost_nova', name: 'Frost Nova',\n    description: '8% chance to freeze enemies in AoE on hit.',\n    triggerType: 'on_hit', chance: 0.08, magnitude: 48,\n    duration: 2, cooldown: 5, visualEffect: 'frost_explosion',\n  },\n  {\n    id: 'reality_tear', name: 'Reality Tear',\n    description: 'Attacks ignore 30% of enemy defense.',\n    triggerType: 'passive', chance: 1.0, magnitude: 0.3,\n    cooldown: 0, visualEffect: 'void_slash',\n  },\n  {\n    id: 'void_anchor', name: 'Void Anchor',\n    description: 'Slow enemies within radius by 25%.',\n    triggerType: 'passive', chance: 1.0, magnitude: 0.25,\n    cooldown: 0, visualEffect: 'void_aura',\n  },\n  {\n    id: 'temporal_echo', name: 'Temporal Echo',\n    description: '5% chance to instantly repeat the last attack.',\n    triggerType: 'on_hit', chance: 0.05, magnitude: 1.0,\n    cooldown: 3, visualEffect: 'time_echo',\n  },\n  {\n    id: 'phoenix_rebirth', name: 'Phoenix Rebirth',\n    description: 'Once per 10 min, revive with 30% HP on death.',\n    triggerType: 'on_death', chance: 1.0, magnitude: 0.3,\n    cooldown: 600, visualEffect: 'phoenix_fire',\n  },\n];\n\nexport const LEGENDARY_EFFECT_DB = new Map<string, LegendaryEffectDef>(\n  LEGENDARY_EFFECTS.map(e => [e.id, e]),\n);\n","import { RARITY_TIERS } from '../config';\nimport { LEGENDARY_EFFECTS, LegendaryEffectDef } from '../data/legendaryEffects';\n\nexport type RarityTier = 'common' | 'uncommon' | 'rare' | 'epic' | 'legendary' | 'mythic';\n\nconst TIER_ORDER: RarityTier[] = ['common', 'uncommon', 'rare', 'epic', 'legendary', 'mythic'];\n\ninterface RarityResult {\n  tier: RarityTier;\n  tierIndex: number;\n  statMultiplier: number;\n  color: number;\n  label: string;\n  legendaryEffect: LegendaryEffectDef | null;\n}\n\n/**\n * 6-tier rarity system with stat multipliers, drop weight rolling,\n * legendary effects, set bonuses, and reforging.\n */\nexport class RarityManager {\n\n  /** Roll a rarity tier based on luck and modifiers */\n  rollRarity(luck: number = 0, biomeMultiplier: number = 1.0, bossBonus: number = 0): RarityResult {\n    // Build weighted table with luck/bonus adjustments\n    const weights: number[] = [];\n    let totalWeight = 0;\n\n    for (const tier of TIER_ORDER) {\n      const tierDef = RARITY_TIERS[tier];\n      let weight = tierDef.dropWeight;\n\n      // Higher tiers get boosted by luck, lower tiers get reduced\n      const tierIdx = TIER_ORDER.indexOf(tier);\n      if (tierIdx >= 3) {\n        // Epic+ gets luck bonus\n        weight *= (1 + luck * 0.1 + bossBonus);\n      } else if (tierIdx <= 1) {\n        // Common/uncommon reduced by luck\n        weight *= Math.max(0.1, 1 - luck * 0.05);\n      }\n\n      weight *= biomeMultiplier;\n      weights.push(weight);\n      totalWeight += weight;\n    }\n\n    // Roll\n    let roll = Math.random() * totalWeight;\n    let selectedIndex = 0;\n    for (let i = 0; i < weights.length; i++) {\n      roll -= weights[i];\n      if (roll <= 0) {\n        selectedIndex = i;\n        break;\n      }\n    }\n\n    const tier = TIER_ORDER[selectedIndex];\n    const tierDef = RARITY_TIERS[tier];\n\n    // Roll legendary effect for legendary+ items\n    let legendaryEffect: LegendaryEffectDef | null = null;\n    if (selectedIndex >= 4) {\n      legendaryEffect = this.rollLegendaryEffect();\n    }\n\n    return {\n      tier,\n      tierIndex: selectedIndex,\n      statMultiplier: tierDef.mult,\n      color: tierDef.color,\n      label: tierDef.label,\n      legendaryEffect,\n    };\n  }\n\n  /** Roll a random legendary effect */\n  rollLegendaryEffect(): LegendaryEffectDef {\n    const idx = Math.floor(Math.random() * LEGENDARY_EFFECTS.length);\n    return LEGENDARY_EFFECTS[idx];\n  }\n\n  /** Apply rarity stat multiplier with random variance */\n  applyStatMultiplier(baseStat: number, rarity: RarityResult): number {\n    const variance = 1 + (Math.random() * 0.1); // 0-10% bonus\n    return Math.round(baseStat * rarity.statMultiplier * variance);\n  }\n\n  /** Get rarity info by tier name */\n  getRarityInfo(tier: RarityTier): { color: number; mult: number; label: string } {\n    const tierDef = RARITY_TIERS[tier];\n    return { color: tierDef.color, mult: tierDef.mult, label: tierDef.label };\n  }\n\n  /** Get rarity from tier index */\n  getTierFromIndex(index: number): RarityTier {\n    return TIER_ORDER[Math.min(index, TIER_ORDER.length - 1)];\n  }\n\n  /** Get tier index from name */\n  getTierIndex(tier: RarityTier): number {\n    return TIER_ORDER.indexOf(tier);\n  }\n\n  /** Calculate set bonus for wearing N items of same rarity tier */\n  getSetBonus(tier: RarityTier, count: number): { critChance: number; damage: number; defense: number } {\n    if (count < 3) return { critChance: 0, damage: 0, defense: 0 };\n\n    const tierIdx = TIER_ORDER.indexOf(tier);\n    const baseMult = tierIdx * 0.02; // Higher tiers give more bonus\n\n    return {\n      critChance: baseMult * count,           // e.g., epic 3-set: 0.06 * 3 = 0.18\n      damage: Math.round(baseMult * count * 5), // flat damage bonus\n      defense: Math.round(baseMult * count * 3), // flat defense bonus\n    };\n  }\n\n  /** Attempt to reforge: combine 3 same-tier items to upgrade */\n  canReforge(tier: RarityTier): boolean {\n    const idx = TIER_ORDER.indexOf(tier);\n    return idx < TIER_ORDER.length - 1; // Can't reforge mythic\n  }\n\n  /** Get the result tier of reforging */\n  getReforgeTier(currentTier: RarityTier): RarityTier | null {\n    const idx = TIER_ORDER.indexOf(currentTier);\n    if (idx >= TIER_ORDER.length - 1) return null;\n    return TIER_ORDER[idx + 1];\n  }\n\n  /** Calculate reforge success chance based on materials */\n  getReforgeChance(currentTier: RarityTier, materialQuality: number = 1): number {\n    const idx = TIER_ORDER.indexOf(currentTier);\n    const baseChance = [0.8, 0.6, 0.4, 0.25, 0.15, 0]; // by current tier\n    return Math.min(1, baseChance[idx] * materialQuality);\n  }\n\n  /** Attempt reforge (returns true if successful) */\n  attemptReforge(currentTier: RarityTier, materialQuality: number = 1): boolean {\n    const chance = this.getReforgeChance(currentTier, materialQuality);\n    return Math.random() < chance;\n  }\n\n  /** Get sell value multiplier for rarity */\n  getSellMultiplier(tier: RarityTier): number {\n    const multipliers: Record<RarityTier, number> = {\n      common: 1.0,\n      uncommon: 1.5,\n      rare: 2.5,\n      epic: 5.0,\n      legendary: 10.0,\n      mythic: 25.0,\n    };\n    return multipliers[tier];\n  }\n}\n","import { defineQuery, removeEntity, hasComponent } from 'bitecs';\nimport { Position, Health, EnemyTag, Combat, Sprite, EliteAffix } from '../components';\nimport { getTextureName } from '../world';\nimport { SeededRandom } from '../../world/SeededRandom';\nimport { ENEMIES } from '../../data/enemies';\nimport { RarityManager } from '../../systems/RarityManager';\n\nconst deadEnemyQuery = defineQuery([Position, Health, EnemyTag, Combat]);\n\nexport interface LootEvent {\n  x: number;\n  y: number;\n  itemId: string;\n  quantity: number;\n  rarity: number; // 0-5 matching rarity tiers\n  xpReward: number;\n  goldReward: number;\n  enemyType: string; // texture name of the killed enemy\n}\n\nconst pendingLoot: LootEvent[] = [];\n\n/** Get and clear pending loot events */\nexport function flushLootEvents(): LootEvent[] {\n  const events = [...pendingLoot];\n  pendingLoot.length = 0;\n  return events;\n}\n\n/** Basic loot table: item pool with drop chances */\ninterface LootTableEntry {\n  itemId: string;\n  weight: number;\n  minQty: number;\n  maxQty: number;\n}\n\nconst DEFAULT_LOOT_TABLE: LootTableEntry[] = [\n  { itemId: 'gold_coin', weight: 40, minQty: 1, maxQty: 5 },\n  { itemId: 'health_potion', weight: 15, minQty: 1, maxQty: 1 },\n  { itemId: 'raw_material', weight: 20, minQty: 1, maxQty: 3 },\n  { itemId: 'weapon_scrap', weight: 10, minQty: 1, maxQty: 1 },\n  { itemId: 'armor_shard', weight: 10, minQty: 1, maxQty: 1 },\n  { itemId: 'rare_gem', weight: 3, minQty: 1, maxQty: 1 },\n  { itemId: 'skill_tome', weight: 2, minQty: 1, maxQty: 1 },\n];\n\nconst rng = new SeededRandom(12345);\nconst rarityManager = new RarityManager();\n\n/** Build a texture→EnemyTypeDef lookup for fast enemy identification */\nconst ENEMY_BY_TEXTURE = new Map<string, typeof ENEMIES[number]>();\nfor (const e of ENEMIES) {\n  ENEMY_BY_TEXTURE.set(e.texture, e);\n}\n\n/**\n * Processes dead enemies and generates loot drops.\n * Uses enemy-specific loot tables when available, falls back to default.\n * Rolls rarity per drop using RarityManager (luck scaled by enemy level).\n * @param luckBonus Extra luck from festivals/buffs (multiplied into rarity roll luck)\n */\nexport function lootSystem(world: object, luckBonus: number = 0): void {\n  const entities = deadEnemyQuery(world);\n\n  for (const eid of entities) {\n    if (Health.current[eid] > 0) continue;\n\n    // Derive XP/gold from enemy stats\n    const maxHP = Health.max[eid];\n    const dmg = Combat.damage[eid];\n    const xpReward = Math.round(maxHP * 0.3 + dmg * 0.5);\n    const goldReward = Math.round(xpReward * 0.5);\n\n    // Elite affix loot bonus (adds directly to rarity luck rolls)\n    const eliteLootBonus = hasComponent(world, EliteAffix, eid) ? EliteAffix.lootBonus[eid] : 0;\n\n    // Capture enemy type before entity is removed\n    const enemyType = getTextureName(Sprite.textureId[eid]);\n    const enemyDef = ENEMY_BY_TEXTURE.get(enemyType);\n\n    // Roll enemy-specific drops first\n    let droppedSpecific = false;\n    if (enemyDef && enemyDef.lootTable.length > 0) {\n      for (const entry of enemyDef.lootTable) {\n        if (rng.next() < entry.chance) {\n          // Scale luck by enemy XP — tougher enemies give better rarity\n          const luck = Math.min((enemyDef.xpReward ?? xpReward) / 30, 5) + luckBonus + eliteLootBonus;\n          const rarity = rarityManager.rollRarity(luck);\n\n          pendingLoot.push({\n            x: Position.x[eid],\n            y: Position.y[eid],\n            itemId: entry.itemId,\n            quantity: rng.nextInt(entry.minQty, entry.maxQty),\n            rarity: rarity.tierIndex,\n            xpReward: !droppedSpecific ? xpReward : 0,\n            goldReward: !droppedSpecific ? goldReward : 0,\n            enemyType,\n          });\n          droppedSpecific = true;\n        }\n      }\n    }\n\n    // If no specific drops rolled, use default loot table\n    if (!droppedSpecific) {\n      const numDrops = rng.nextInt(1, 3);\n      const totalWeight = DEFAULT_LOOT_TABLE.reduce((sum, e) => sum + e.weight, 0);\n\n      for (let i = 0; i < numDrops; i++) {\n        let roll = rng.next() * totalWeight;\n        for (const entry of DEFAULT_LOOT_TABLE) {\n          roll -= entry.weight;\n          if (roll <= 0) {\n            const luck = Math.min(xpReward / 30, 5) + luckBonus + eliteLootBonus;\n            const rarity = rarityManager.rollRarity(luck);\n\n            pendingLoot.push({\n              x: Position.x[eid],\n              y: Position.y[eid],\n              itemId: entry.itemId,\n              quantity: rng.nextInt(entry.minQty, entry.maxQty),\n              rarity: rarity.tierIndex,\n              xpReward: i === 0 ? xpReward : 0,\n              goldReward: i === 0 ? goldReward : 0,\n              enemyType,\n            });\n            break;\n          }\n        }\n      }\n    }\n\n    // Remove dead entity from ECS\n    removeEntity(world, eid);\n  }\n}\n","import Phaser from 'phaser';\nimport { Position, Velocity, Stamina, Health, Combat } from '../ecs/components';\nimport { PLAYER_SPEED, PLAYER_SPRINT_MULT, STAMINA_SPRINT_COST, INVINCIBILITY_FRAMES_MS } from '../config';\nimport { IsometricHelper } from '../world/IsometricHelper';\n\n/** Result from useTool() — tells scene what tool was used and where */\nexport interface ToolUseResult {\n  tileX: number;\n  tileY: number;\n}\n\n/** Result from attack() — tells scene an attack was initiated */\nexport interface AttackResult {\n  facingX: number;\n  facingY: number;\n}\n\n/**\n * Player controller — handles input and maps it to ECS velocity.\n * Instantiated once per OverworldScene.\n */\nexport class PlayerController {\n  private eid: number;\n  private scene: Phaser.Scene;\n  private sprite: Phaser.GameObjects.Image;\n  private cursors: Phaser.Types.Input.Keyboard.CursorKeys;\n  private wasd: Record<string, Phaser.Input.Keyboard.Key>;\n  private keyJ: Phaser.Input.Keyboard.Key;\n  private keySpace: Phaser.Input.Keyboard.Key;\n\n  // Facing direction (last nonzero movement)\n  private facingX = 0;\n  private facingY = 1; // Default facing down\n\n  // Dodge state\n  private dodging = false;\n  private dodgeTimer = 0;\n  private dodgeCooldown = 0;\n  private dodgeDirX = 0;\n  private dodgeDirY = 0;\n\n  // Invincibility (for dodge and respawn)\n  private invincibleTimer = 0;\n\n  // External speed multiplier (from buffs)\n  public speedBonus = 0;\n\n  // Temperature effects (set externally by OverworldScene)\n  public staminaRegenMult = 1;\n  public staminaDrainMult = 1;\n\n  constructor(scene: Phaser.Scene, eid: number) {\n    this.eid = eid;\n    this.scene = scene;\n\n    // Create the player sprite\n    this.sprite = scene.add.image(Position.x[eid], Position.y[eid], 'player');\n    this.sprite.setScale(0.5);\n    this.sprite.setOrigin(0.5, 0.75);\n    this.sprite.setDepth(5000);\n\n    // Input\n    this.cursors = scene.input.keyboard!.createCursorKeys();\n    this.wasd = {\n      W: scene.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.W),\n      A: scene.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.A),\n      S: scene.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.S),\n      D: scene.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.D),\n      E: scene.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.E),\n      SHIFT: scene.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.SHIFT),\n    };\n    this.keyJ = scene.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.J);\n    this.keySpace = scene.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);\n  }\n\n  /** Process input and update ECS velocity. Delta in seconds. */\n  update(delta: number): void {\n    const eid = this.eid;\n\n    // Tick invincibility\n    if (this.invincibleTimer > 0) {\n      this.invincibleTimer -= delta;\n      // Flash sprite during invincibility\n      this.sprite.setAlpha(Math.sin(this.invincibleTimer * 20) > 0 ? 1 : 0.4);\n      if (this.invincibleTimer <= 0) {\n        this.invincibleTimer = 0;\n        this.sprite.setAlpha(1);\n      }\n    }\n\n    // Tick dodge cooldown\n    if (this.dodgeCooldown > 0) this.dodgeCooldown -= delta;\n\n    // Dodge active — override movement\n    if (this.dodging) {\n      this.dodgeTimer -= delta;\n      const dodgeSpeed = PLAYER_SPEED * 3;\n      Velocity.vx[eid] = this.dodgeDirX * dodgeSpeed;\n      Velocity.vy[eid] = this.dodgeDirY * dodgeSpeed;\n      if (this.dodgeTimer <= 0) {\n        this.dodging = false;\n      }\n      this.sprite.setPosition(Position.x[eid], Position.y[eid]);\n      return;\n    }\n\n    let dx = 0;\n    let dy = 0;\n\n    if (this.cursors.left.isDown || this.wasd.A.isDown) dx -= 1;\n    if (this.cursors.right.isDown || this.wasd.D.isDown) dx += 1;\n    if (this.cursors.up.isDown || this.wasd.W.isDown) dy -= 1;\n    if (this.cursors.down.isDown || this.wasd.S.isDown) dy += 1;\n\n    // Track facing direction from last nonzero movement\n    if (dx !== 0 || dy !== 0) {\n      this.facingX = dx;\n      this.facingY = dy;\n    }\n\n    // Normalize diagonal movement\n    if (dx !== 0 && dy !== 0) {\n      const norm = 1 / Math.SQRT2;\n      dx *= norm;\n      dy *= norm;\n    }\n\n    // Sprint\n    let speed = PLAYER_SPEED + this.speedBonus;\n    const isSprinting = this.wasd.SHIFT.isDown && (dx !== 0 || dy !== 0);\n    if (isSprinting && Stamina.current[eid] > 0) {\n      speed *= PLAYER_SPRINT_MULT;\n      Stamina.current[eid] = Math.max(0, Stamina.current[eid] - STAMINA_SPRINT_COST * delta * this.staminaDrainMult);\n    }\n\n    // Stamina regen when not sprinting\n    if (!isSprinting) {\n      Stamina.current[eid] = Math.min(\n        Stamina.max[eid],\n        Stamina.current[eid] + Stamina.regenRate[eid] * delta * this.staminaRegenMult,\n      );\n    }\n\n    Velocity.vx[eid] = dx * speed;\n    Velocity.vy[eid] = dy * speed;\n\n    // Sync sprite position to ECS\n    this.sprite.setPosition(Position.x[eid], Position.y[eid]);\n    this.sprite.setFlipX(dx < 0);\n  }\n\n  /**\n   * Attempt to attack. Returns facing direction if attack is ready, null otherwise.\n   * Called by scene on J key or left-click.\n   */\n  attack(): AttackResult | null {\n    const eid = this.eid;\n    if (Combat.attackCooldown[eid] > 0) return null;\n\n    // Set cooldown — CombatSystem will process the actual hit\n    Combat.attackCooldown[eid] = 0; // Reset to 0 so CombatSystem picks it up this frame\n    return { facingX: this.facingX, facingY: this.facingY };\n  }\n\n  /**\n   * Use tool on facing tile. Returns tile coordinates.\n   */\n  useTool(): ToolUseResult {\n    const pos = this.getPosition();\n    const tile = IsometricHelper.pixelToTile(\n      pos.x + this.facingX * 48,\n      pos.y + this.facingY * 48,\n    );\n    return { tileX: tile.tileX, tileY: tile.tileY };\n  }\n\n  /**\n   * Attempt a dodge roll. Returns true if dodge started.\n   * Costs 20 stamina, 200ms duration, 600ms cooldown.\n   */\n  dodge(): boolean {\n    const eid = this.eid;\n    if (this.dodging) return false;\n    if (this.dodgeCooldown > 0) return false;\n    if (Stamina.current[eid] < 20) return false;\n\n    // Must have a movement direction to dodge\n    let dirX = this.facingX;\n    let dirY = this.facingY;\n\n    // Prefer current movement direction if pressing keys\n    const movX = (this.cursors.left.isDown || this.wasd.A.isDown ? -1 : 0)\n               + (this.cursors.right.isDown || this.wasd.D.isDown ? 1 : 0);\n    const movY = (this.cursors.up.isDown || this.wasd.W.isDown ? -1 : 0)\n               + (this.cursors.down.isDown || this.wasd.S.isDown ? 1 : 0);\n    if (movX !== 0 || movY !== 0) {\n      dirX = movX;\n      dirY = movY;\n    }\n\n    // Normalize\n    const len = Math.sqrt(dirX * dirX + dirY * dirY);\n    if (len === 0) return false;\n    this.dodgeDirX = dirX / len;\n    this.dodgeDirY = dirY / len;\n\n    Stamina.current[eid] -= 20;\n    this.dodging = true;\n    this.dodgeTimer = 0.2; // 200ms\n    this.dodgeCooldown = 0.6; // 600ms\n    this.setInvincible(0.2); // i-frames during dodge\n\n    return true;\n  }\n\n  /** Set temporary invincibility (e.g., after dodge or respawn) */\n  setInvincible(duration: number): void {\n    this.invincibleTimer = Math.max(this.invincibleTimer, duration);\n  }\n\n  /** Check if currently invincible */\n  isInvincible(): boolean {\n    return this.invincibleTimer > 0;\n  }\n\n  /** Check if J key or left-click was just pressed (for attack) */\n  isAttackJustPressed(): boolean {\n    return Phaser.Input.Keyboard.JustDown(this.keyJ)\n      || this.scene.input.activePointer.leftButtonDown();\n  }\n\n  /** Check if spacebar was just pressed while moving (for tool use) */\n  isToolUseJustPressed(): boolean {\n    return Phaser.Input.Keyboard.JustDown(this.keySpace);\n  }\n\n  /** Check if SHIFT was just pressed with movement (for dodge) */\n  isDodgeJustPressed(): boolean {\n    // Dodge on SHIFT+direction while not already sprinting\n    const hasMovement = this.cursors.left.isDown || this.wasd.A.isDown\n      || this.cursors.right.isDown || this.wasd.D.isDown\n      || this.cursors.up.isDown || this.wasd.W.isDown\n      || this.cursors.down.isDown || this.wasd.S.isDown;\n    return Phaser.Input.Keyboard.JustDown(this.wasd.SHIFT) && hasMovement;\n  }\n\n  getFacing(): { x: number; y: number } {\n    return { x: this.facingX, y: this.facingY };\n  }\n\n  isDodging(): boolean {\n    return this.dodging;\n  }\n\n  getSprite(): Phaser.GameObjects.Image {\n    return this.sprite;\n  }\n\n  getEid(): number {\n    return this.eid;\n  }\n\n  getPosition(): { x: number; y: number } {\n    return { x: Position.x[this.eid], y: Position.y[this.eid] };\n  }\n\n  getHealth(): { current: number; max: number } {\n    return { current: Health.current[this.eid], max: Health.max[this.eid] };\n  }\n\n  getStamina(): { current: number; max: number } {\n    return { current: Stamina.current[this.eid], max: Stamina.max[this.eid] };\n  }\n\n  destroy(): void {\n    this.sprite.destroy();\n  }\n}\n","import { WeaponType } from '../ecs/components';\nimport {\n  ItemDef, WeaponDef, ArmorDef, ToolDef, SeedDef, CropDef,\n  FoodDef, ResourceDef, MaterialDef, FishDef, PotionDef, AnyItemDef\n} from '../types/items';\n\n// ============ TOOLS ============\nexport const TOOLS: ToolDef[] = [\n  {\n    id: 'hoe', name: 'Hoe', description: 'Tills soil for planting',\n    category: 'tool', sprite: 'sprites/Items/Tools/item_tool_00015.png',\n    maxStack: 1, sellPrice: 0, buyPrice: 0, rarity: 0,\n    toolType: 'hoe', tier: 1, efficiency: 1,\n  },\n  {\n    id: 'watering_can', name: 'Watering Can', description: 'Waters crops to help them grow',\n    category: 'tool', sprite: 'sprites/Items/Tools/item_tool_00025.png',\n    maxStack: 1, sellPrice: 0, buyPrice: 0, rarity: 0,\n    toolType: 'watering_can', tier: 1, efficiency: 1,\n  },\n  {\n    id: 'scythe', name: 'Scythe', description: 'Harvests grown crops',\n    category: 'tool', sprite: 'sprites/Items/Tools/item_tool_00020.png',\n    maxStack: 1, sellPrice: 0, buyPrice: 0, rarity: 0,\n    toolType: 'hoe', tier: 1, efficiency: 1,\n  },\n  {\n    id: 'axe', name: 'Axe', description: 'Chops down trees',\n    category: 'tool', sprite: 'sprites/Items/Tools/item_tool_00005.png',\n    maxStack: 1, sellPrice: 0, buyPrice: 0, rarity: 0,\n    toolType: 'axe', tier: 1, efficiency: 1,\n  },\n  {\n    id: 'pickaxe', name: 'Pickaxe', description: 'Breaks rocks and mines ore',\n    category: 'tool', sprite: 'sprites/Items/Tools/item_tool_00010.png',\n    maxStack: 1, sellPrice: 0, buyPrice: 0, rarity: 0,\n    toolType: 'pickaxe', tier: 1, efficiency: 1,\n  },\n  {\n    id: 'fishing_rod', name: 'Fishing Rod', description: 'Used for fishing',\n    category: 'tool', sprite: 'sprites/Items/Tools/item_tool_00030.png',\n    maxStack: 1, sellPrice: 25, buyPrice: 63, rarity: 0,\n    toolType: 'fishing_rod', tier: 1, efficiency: 1,\n  },\n  {\n    id: 'gold_hoe', name: 'Gold Hoe', description: 'A hoe made of pure gold. Tills a 3x3 area.',\n    category: 'tool', sprite: 'sprites/items/tool/gold_hoe.png',\n    maxStack: 1, sellPrice: 5000, buyPrice: 12500, rarity: 1,\n    toolType: 'hoe', tier: 3, efficiency: 2,\n  },\n  {\n    id: 'iridium_rod', name: 'Iridium Rod', description: 'The ultimate fishing rod. Can use bait and tackle.',\n    category: 'tool', sprite: 'sprites/items/tool/iridium_rod.png',\n    maxStack: 1, sellPrice: 7500, buyPrice: 18750, rarity: 1,\n    toolType: 'fishing_rod', tier: 4, efficiency: 3,\n  },\n  {\n    id: 'lantern', name: 'Lantern', description: 'A dim lantern that pushes back the darkness. In these lands, even light feels like a prayer.',\n    category: 'tool', sprite: 'sprites/items/tool/lantern.png',\n    maxStack: 1, sellPrice: 150, buyPrice: 375, rarity: 0,\n    toolType: 'hoe', tier: 1, efficiency: 1,\n  },\n  {\n    id: 'glow_lantern', name: 'Glow Lantern', description: 'Infused with captured spirits, it radiates an eerie luminescence that wards off creeping shadows.',\n    category: 'tool', sprite: 'sprites/items/tool/glow_lantern.png',\n    maxStack: 1, sellPrice: 500, buyPrice: 1250, rarity: 0,\n    toolType: 'hoe', tier: 1, efficiency: 1,\n  },\n  {\n    id: 'spike_trap', name: 'Spike Trap', description: 'Cruel iron spikes concealed beneath loose earth. The unwary step once and never again.',\n    category: 'tool', sprite: 'sprites/items/tool/spike_trap.png',\n    maxStack: 20, sellPrice: 200, buyPrice: 500, rarity: 0,\n    toolType: 'hoe', tier: 1, efficiency: 1,\n  },\n  {\n    id: 'snare_trap', name: 'Snare Trap', description: 'A cunning wire loop that entangles prey in a tightening embrace. Patience rewarded with suffering.',\n    category: 'tool', sprite: 'sprites/items/tool/snare_trap.png',\n    maxStack: 20, sellPrice: 120, buyPrice: 300, rarity: 0,\n    toolType: 'hoe', tier: 1, efficiency: 1,\n  },\n  {\n    id: 'mega_bomb', name: 'Mega Bomb', description: 'A volatile sphere of compressed fury. Its detonation leaves nothing but ruin and silence.',\n    category: 'tool', sprite: 'sprites/items/tool/mega_bomb.png',\n    maxStack: 10, sellPrice: 300, buyPrice: 750, rarity: 0,\n    toolType: 'hoe', tier: 1, efficiency: 1,\n  },\n  {\n    id: 'bobber', name: 'Bobber', description: 'A small float that signals when something below has taken interest. Watch it closely.',\n    category: 'tool', sprite: 'sprites/items/tool/bobber.png',\n    maxStack: 20, sellPrice: 25, buyPrice: 63, rarity: 0,\n    toolType: 'hoe', tier: 1, efficiency: 1,\n  },\n  {\n    id: 'golden_watering_can', name: 'Golden Watering Can', description: 'A watering can of pure enchanted gold. Water flows endlessly from its spout without effort.',\n    category: 'tool', sprite: 'sprites/items/tool/golden_watering_can.png',\n    maxStack: 1, sellPrice: 5000, buyPrice: 12500, rarity: 1,\n    toolType: 'watering_can', tier: 3, efficiency: 2,\n  },\n  {\n    id: 'dressed_spinner', name: 'Dressed Spinner', description: 'A finely crafted fishing lure adorned with dark feathers. Fish strike it with reckless abandon.',\n    category: 'tool', sprite: 'sprites/items/tool/dressed_spinner.png',\n    maxStack: 1, sellPrice: 200, buyPrice: 500, rarity: 0,\n    toolType: 'hoe', tier: 1, efficiency: 1,\n  },\n  {\n    id: 'forge_hammer', name: 'Forge Hammer', description: 'A master smith\\'s hammer scarred by a thousand forgings. It shapes metal and destiny alike.',\n    category: 'tool', sprite: 'sprites/items/tool/forge_hammer.png',\n    maxStack: 1, sellPrice: 800, buyPrice: 2000, rarity: 0,\n    toolType: 'hoe', tier: 1, efficiency: 1,\n  },\n];\n\n// ============ SEEDS ============\nexport const SEEDS: SeedDef[] = [\n  {\n    id: 'parsnip_seeds', name: 'Parsnip Seeds', description: 'Plant in spring. Takes 4 days to grow.',\n    category: 'seed', sprite: 'sprites/Items/Consumables/item_consumable_00001.png',\n    maxStack: 99, sellPrice: 20, buyPrice: 50, rarity: 0,\n    cropId: 'parsnip', growthDays: 4, seasons: ['spring'],\n  },\n  {\n    id: 'potato_seeds', name: 'Potato Seeds', description: 'Plant in spring. Takes 6 days to grow.',\n    category: 'seed', sprite: 'sprites/Items/Consumables/item_consumable_00002.png',\n    maxStack: 99, sellPrice: 50, buyPrice: 125, rarity: 0,\n    cropId: 'potato', growthDays: 6, seasons: ['spring'],\n  },\n  {\n    id: 'cauliflower_seeds', name: 'Cauliflower Seeds', description: 'Plant in spring. Takes 12 days to grow.',\n    category: 'seed', sprite: 'sprites/Items/Consumables/item_consumable_00003.png',\n    maxStack: 99, sellPrice: 80, buyPrice: 200, rarity: 0,\n    cropId: 'cauliflower', growthDays: 12, seasons: ['spring'],\n  },\n  {\n    id: 'tomato_seeds', name: 'Tomato Seeds', description: 'Plant in summer. Takes 11 days, then produces every 4 days.',\n    category: 'seed', sprite: 'sprites/items/seed/tomato_seeds.png',\n    maxStack: 99, sellPrice: 50, buyPrice: 125, rarity: 0,\n    cropId: 'tomato', growthDays: 11, seasons: ['summer'],\n  },\n  {\n    id: 'melon_seeds', name: 'Melon Seeds', description: 'Plant in summer. Takes 12 days to grow.',\n    category: 'seed', sprite: 'sprites/items/seed/melon_seeds.png',\n    maxStack: 99, sellPrice: 80, buyPrice: 200, rarity: 0,\n    cropId: 'melon', growthDays: 12, seasons: ['summer'],\n  },\n  {\n    id: 'corn_seeds', name: 'Corn Seeds', description: 'Plant in summer or fall. Takes 14 days, then produces every 4 days.',\n    category: 'seed', sprite: 'sprites/items/seed/corn_seeds.png',\n    maxStack: 99, sellPrice: 50, buyPrice: 125, rarity: 0,\n    cropId: 'corn', growthDays: 14, seasons: ['summer', 'fall'],\n  },\n  {\n    id: 'pumpkin_seeds', name: 'Pumpkin Seeds', description: 'Plant in fall. Takes 13 days to grow.',\n    category: 'seed', sprite: 'sprites/items/seed/pumpkin_seeds.png',\n    maxStack: 99, sellPrice: 100, buyPrice: 250, rarity: 0,\n    cropId: 'pumpkin', growthDays: 13, seasons: ['fall'],\n  },\n  {\n    id: 'carrot_seeds', name: 'Carrot Seeds', description: 'Plant in spring or fall. Takes 3 days to grow.',\n    category: 'seed', sprite: 'sprites/items/seed/carrot_seeds.png',\n    maxStack: 99, sellPrice: 30, buyPrice: 75, rarity: 0,\n    cropId: 'carrot', growthDays: 3, seasons: ['spring', 'fall'],\n  },\n  {\n    id: 'wheat_seeds', name: 'Wheat Seeds', description: 'Plant in summer or fall. Takes 4 days to grow.',\n    category: 'seed', sprite: 'sprites/items/seed/wheat_seeds.png',\n    maxStack: 99, sellPrice: 35, buyPrice: 88, rarity: 0,\n    cropId: 'wheat', growthDays: 4, seasons: ['summer', 'fall'],\n  },\n  {\n    id: 'hot_pepper_seeds', name: 'Hot Pepper Seeds', description: 'Plant in summer. Takes 5 days, regrows every 3 days.',\n    category: 'seed', sprite: 'sprites/items/seed/hot_pepper_seeds.png',\n    maxStack: 99, sellPrice: 40, buyPrice: 100, rarity: 0,\n    cropId: 'hot_pepper', growthDays: 5, seasons: ['summer'],\n  },\n  {\n    id: 'hops_starter', name: 'Hops Starter', description: 'Plant in summer. Takes 11 days, regrows every 2 days.',\n    category: 'seed', sprite: 'sprites/items/seed/hops_starter.png',\n    maxStack: 99, sellPrice: 60, buyPrice: 150, rarity: 0,\n    cropId: 'hops', growthDays: 11, seasons: ['summer'],\n  },\n  {\n    id: 'grape_starter', name: 'Grape Starter', description: 'Plant in fall. Takes 10 days, regrows every 3 days.',\n    category: 'seed', sprite: 'sprites/items/seed/grape_starter.png',\n    maxStack: 99, sellPrice: 60, buyPrice: 150, rarity: 0,\n    cropId: 'grape', growthDays: 10, seasons: ['fall'],\n  },\n  {\n    id: 'blue_jazz_seeds', name: 'Blue Jazz Seeds', description: 'Plant in spring. A beautiful blue flower.',\n    category: 'seed', sprite: 'sprites/items/seed/blue_jazz_seeds.png',\n    maxStack: 99, sellPrice: 30, buyPrice: 75, rarity: 0,\n    cropId: 'blue_jazz', growthDays: 7, seasons: ['spring'],\n  },\n  {\n    id: 'ancient_seed_packet', name: 'Ancient Seed Packet', description: 'Seeds preserved in amber for millennia. Whatever grows from them has not walked this earth in ages.',\n    category: 'seed', sprite: 'sprites/items/seed/ancient_seed_packet.png',\n    maxStack: 99, sellPrice: 1000, buyPrice: 2500, rarity: 2,\n    cropId: 'ancient_fruit', growthDays: 28, seasons: ['spring', 'summer', 'fall', 'winter'],\n  },\n  {\n    id: 'spring_seeds', name: 'Spring Seeds', description: 'A pouch of mixed spring seeds blessed by the grove. New life stirs within the husks.',\n    category: 'seed', sprite: 'sprites/items/seed/spring_seeds.png',\n    maxStack: 99, sellPrice: 100, buyPrice: 250, rarity: 0,\n    cropId: 'parsnip', growthDays: 4, seasons: ['spring'],\n  },\n  {\n    id: 'summer_seeds', name: 'Summer Seeds', description: 'Seeds that thrive in scorching heat. They drink the sun like parched travelers drink water.',\n    category: 'seed', sprite: 'sprites/items/seed/summer_seeds.png',\n    maxStack: 99, sellPrice: 100, buyPrice: 250, rarity: 0,\n    cropId: 'tomato', growthDays: 6, seasons: ['summer'],\n  },\n  {\n    id: 'fall_seeds', name: 'Fall Seeds', description: 'Harvest seeds that grow as the world dies around them. They flourish amid decay.',\n    category: 'seed', sprite: 'sprites/items/seed/fall_seeds.png',\n    maxStack: 99, sellPrice: 100, buyPrice: 250, rarity: 0,\n    cropId: 'pumpkin', growthDays: 8, seasons: ['fall'],\n  },\n  {\n    id: 'winter_seeds', name: 'Winter Seeds', description: 'Frost-hardened seeds that defy the killing cold. Only the desperate dare plant these.',\n    category: 'seed', sprite: 'sprites/items/seed/winter_seeds.png',\n    maxStack: 99, sellPrice: 100, buyPrice: 250, rarity: 0,\n    cropId: 'winter_root', growthDays: 7, seasons: ['winter'],\n  },\n  {\n    id: 'rare_seed', name: 'Rare Seed', description: 'A peculiar seed that pulses with dormant energy. What grows from it is anyone\\'s dark guess.',\n    category: 'seed', sprite: 'sprites/items/seed/rare_seed.png',\n    maxStack: 99, sellPrice: 500, buyPrice: 1250, rarity: 2,\n    cropId: 'sweet_gem_berry', growthDays: 24, seasons: ['fall'],\n  },\n  {\n    id: 'ancient_seed', name: 'Ancient Seed', description: 'A seed preserved for eons in petrified amber. The crop it yields is forgotten by the living.',\n    category: 'seed', sprite: 'sprites/items/seed/ancient_seed.png',\n    maxStack: 99, sellPrice: 1000, buyPrice: 2500, rarity: 2,\n    cropId: 'ancient_fruit', growthDays: 28, seasons: ['spring', 'summer', 'fall'],\n  },\n  {\n    id: 'coffee_bean', name: 'Coffee Bean', description: 'A precious bean from distant, fallen lands. Its brew banishes exhaustion and sharpens the mind.',\n    category: 'seed', sprite: 'sprites/items/seed/coffee_bean.png',\n    maxStack: 99, sellPrice: 200, buyPrice: 500, rarity: 0,\n    cropId: 'coffee', growthDays: 10, seasons: ['spring', 'summer'],\n  },\n  {\n    id: 'mixed_seeds', name: 'Mixed Seeds', description: 'A handful of assorted seeds of unknown origin. Plant them and pray something edible grows.',\n    category: 'seed', sprite: 'sprites/items/seed/mixed_seeds.png',\n    maxStack: 99, sellPrice: 10, buyPrice: 25, rarity: 0,\n    cropId: 'parsnip', growthDays: 5, seasons: ['spring', 'summer', 'fall', 'winter'],\n  },\n];\n\n// ============ CROPS ============\nexport const CROPS: CropDef[] = [\n  {\n    id: 'parsnip', name: 'Parsnip', description: 'A spring root vegetable.',\n    category: 'crop', sprite: 'sprites/items/crop/parsnip.png',\n    maxStack: 99, sellPrice: 35, buyPrice: 88, rarity: 0,\n    seedId: 'parsnip_seeds', quality: 0,\n  },\n  {\n    id: 'potato', name: 'Potato', description: 'A starchy tuber.',\n    category: 'crop', sprite: 'sprites/Food/food_item_0045.png',\n    maxStack: 99, sellPrice: 80, buyPrice: 200, rarity: 0,\n    seedId: 'potato_seeds', quality: 0,\n  },\n  {\n    id: 'cauliflower', name: 'Cauliflower', description: 'A valuable spring vegetable.',\n    category: 'crop', sprite: 'sprites/items/crop/cauliflower.png',\n    maxStack: 99, sellPrice: 175, buyPrice: 438, rarity: 0,\n    seedId: 'cauliflower_seeds', quality: 0,\n  },\n  {\n    id: 'tomato', name: 'Tomato', description: 'A juicy red fruit.',\n    category: 'crop', sprite: 'sprites/Food/food_item_0055.png',\n    maxStack: 99, sellPrice: 75, buyPrice: 188, rarity: 0,\n    seedId: 'tomato_seeds', quality: 0,\n  },\n  {\n    id: 'melon', name: 'Melon', description: 'A sweet summer fruit.',\n    category: 'crop', sprite: 'sprites/items/crop/melon.png',\n    maxStack: 99, sellPrice: 250, buyPrice: 625, rarity: 0,\n    seedId: 'melon_seeds', quality: 0,\n  },\n  {\n    id: 'corn', name: 'Corn', description: 'Grows in summer and fall.',\n    category: 'crop', sprite: 'sprites/items/crop/corn.png',\n    maxStack: 99, sellPrice: 75, buyPrice: 188, rarity: 0,\n    seedId: 'corn_seeds', quality: 0,\n  },\n  {\n    id: 'pumpkin', name: 'Pumpkin', description: 'A valuable fall crop.',\n    category: 'crop', sprite: 'sprites/Food/food_item_0050.png',\n    maxStack: 99, sellPrice: 320, buyPrice: 800, rarity: 0,\n    seedId: 'pumpkin_seeds', quality: 0,\n  },\n  {\n    id: 'carrot', name: 'Carrot', description: 'A quick-growing root vegetable.',\n    category: 'crop', sprite: 'sprites/Food/food_item_0035.png',\n    maxStack: 99, sellPrice: 45, buyPrice: 113, rarity: 0,\n    seedId: 'carrot_seeds', quality: 0,\n  },\n  {\n    id: 'wheat', name: 'Wheat', description: 'Golden wheat. Can be milled into flour.',\n    category: 'crop', sprite: 'sprites/items/crop/wheat.png',\n    maxStack: 99, sellPrice: 50, buyPrice: 125, rarity: 0,\n    seedId: 'wheat_seeds', quality: 0,\n  },\n  {\n    id: 'hot_pepper', name: 'Hot Pepper', description: 'A spicy pepper. Handle with care!',\n    category: 'crop', sprite: 'sprites/items/crop/hot_pepper.png',\n    maxStack: 99, sellPrice: 40, buyPrice: 100, rarity: 0,\n    seedId: 'hot_pepper_seeds', quality: 0,\n  },\n  {\n    id: 'hops', name: 'Hops', description: 'Bitter flowers used for brewing ale.',\n    category: 'crop', sprite: 'sprites/items/crop/hops.png',\n    maxStack: 99, sellPrice: 55, buyPrice: 138, rarity: 0,\n    seedId: 'hops_seeds', quality: 0,\n  },\n  {\n    id: 'grape', name: 'Grape', description: 'Sweet grapes for eating or winemaking.',\n    category: 'crop', sprite: 'sprites/items/crop/grape.png',\n    maxStack: 99, sellPrice: 80, buyPrice: 200, rarity: 0,\n    seedId: 'grape_seeds', quality: 0,\n  },\n  {\n    id: 'blue_jazz', name: 'Blue Jazz', description: 'A beautiful blue flower. Said to bring luck.',\n    category: 'crop', sprite: 'sprites/items/crop/blue_jazz.png',\n    maxStack: 99, sellPrice: 50, buyPrice: 125, rarity: 0,\n    seedId: 'blue_jazz_seeds', quality: 0,\n  },\n  {\n    id: 'ancient_fruit', name: 'Ancient Fruit', description: 'A fruit from a bygone era, pulsing with forgotten magic. Its juice is said to extend life itself.',\n    category: 'crop', sprite: 'sprites/items/crop/ancient_fruit.png',\n    maxStack: 99, sellPrice: 1500, buyPrice: 3750, rarity: 2,\n    seedId: 'ancient_fruit_seeds', quality: 0,\n  },\n  {\n    id: 'green_bean', name: 'Green Bean', description: 'A slender pod harvested from creeping vines. Sustenance wrested from blighted soil.',\n    category: 'crop', sprite: 'sprites/items/crop/green_bean.png',\n    maxStack: 99, sellPrice: 40, buyPrice: 100, rarity: 0,\n    seedId: 'green_bean_seeds', quality: 0,\n  },\n  {\n    id: 'blueberry', name: 'Blueberry', description: 'Tiny berries the color of bruised twilight. They burst with a bittersweet tang on the tongue.',\n    category: 'crop', sprite: 'sprites/items/crop/blueberry.png',\n    maxStack: 99, sellPrice: 50, buyPrice: 125, rarity: 0,\n    seedId: 'blueberry_seeds', quality: 0,\n  },\n  {\n    id: 'eggplant', name: 'Eggplant', description: 'A glossy purple fruit that thrives in ashen fields. Its flesh absorbs the flavors of the earth.',\n    category: 'crop', sprite: 'sprites/items/crop/eggplant.png',\n    maxStack: 99, sellPrice: 60, buyPrice: 150, rarity: 0,\n    seedId: 'eggplant_seeds', quality: 0,\n  },\n  {\n    id: 'yam', name: 'Yam', description: 'A starchy tuber pulled from the darkened earth. Keeps well through the harshest winters.',\n    category: 'crop', sprite: 'sprites/items/crop/yam.png',\n    maxStack: 99, sellPrice: 80, buyPrice: 200, rarity: 0,\n    seedId: 'yam_seeds', quality: 0,\n  },\n  {\n    id: 'sweet_gem_berry', name: 'Sweet Gem Berry', description: 'A crystalline berry that glows with inner light. Its sweetness is almost supernaturally intense.',\n    category: 'crop', sprite: 'sprites/items/crop/sweet_gem_berry.png',\n    maxStack: 99, sellPrice: 3000, buyPrice: 7500, rarity: 0,\n    seedId: 'sweet_gem_berry_seeds', quality: 0,\n  },\n];\n\n// ============ RESOURCES ============\nexport const RESOURCES: ResourceDef[] = [\n  {\n    id: 'wood', name: 'Wood', description: 'Basic building material from trees.',\n    category: 'resource', sprite: 'sprites/items/resource/wood.png',\n    maxStack: 999, sellPrice: 5, buyPrice: 13, rarity: 0,\n    gatherTool: 'axe', \n  },\n  {\n    id: 'stone', name: 'Stone', description: 'Common stone from rocks.',\n    category: 'resource', sprite: 'sprites/items/resource/stone.png',\n    maxStack: 999, sellPrice: 5, buyPrice: 13, rarity: 0,\n    \n  },\n  {\n    id: 'fiber', name: 'Fiber', description: 'Plant fiber for crafting.',\n    category: 'resource', sprite: 'sprites/items/resource/fiber.png',\n    maxStack: 999, sellPrice: 3, buyPrice: 8, rarity: 0,\n    \n  },\n  {\n    id: 'sap', name: 'Sap', description: 'Sticky tree sap. Used in crafting.',\n    category: 'resource', sprite: 'sprites/items/resource/sap.png',\n    maxStack: 999, sellPrice: 2, buyPrice: 5, rarity: 0,\n    \n  },\n  {\n    id: 'coal', name: 'Coal', description: 'Fuel for furnaces.',\n    category: 'resource', sprite: 'sprites/Items/Gems_Materials/item_gem_00001.png',\n    maxStack: 999, sellPrice: 15, buyPrice: 38, rarity: 0,\n    \n  },\n  {\n    id: 'copper_ore', name: 'Copper Ore', description: 'Can be smelted into copper bars.',\n    category: 'resource', sprite: 'sprites/items/resource/copper_ore.png',\n    maxStack: 999, sellPrice: 5, buyPrice: 13, rarity: 0,\n    gatherTool: 'pickaxe', \n  },\n  {\n    id: 'iron_ore', name: 'Iron Ore', description: 'Can be smelted into iron bars.',\n    category: 'resource', sprite: 'sprites/items/resource/iron_ore.png',\n    maxStack: 999, sellPrice: 10, buyPrice: 25, rarity: 1,\n    gatherTool: 'pickaxe', \n  },\n  {\n    id: 'gold_ore', name: 'Gold Ore', description: 'Can be smelted into gold bars.',\n    category: 'resource', sprite: 'sprites/items/resource/gold_ore.png',\n    maxStack: 999, sellPrice: 25, buyPrice: 63, rarity: 1,\n    gatherTool: 'pickaxe', \n  },\n  {\n    id: 'fertilizer', name: 'Basic Fertilizer', description: 'Restores soil health by 30%. Apply to tilled soil to improve crop quality.',\n    category: 'resource', sprite: 'sprites/items/resource/fertilizer.png',\n    maxStack: 99, sellPrice: 50, buyPrice: 125, rarity: 0,\n    \n  },\n  {\n    id: 'quality_fertilizer', name: 'Quality Fertilizer', description: 'Restores soil health by 50%. Premium blend for maximum crop quality.',\n    category: 'resource', sprite: 'sprites/items/resource/quality_fertilizer.png',\n    maxStack: 99, sellPrice: 150, buyPrice: 375, rarity: 1,\n    \n  },\n  {\n    id: 'copper_bar', name: 'Copper Bar', description: 'A refined copper bar. Used in crafting.',\n    category: 'resource', sprite: 'sprites/items/resource/copper_bar.png',\n    maxStack: 999, sellPrice: 60, buyPrice: 150, rarity: 0,\n    \n  },\n  {\n    id: 'iron_bar', name: 'Iron Bar', description: 'A refined iron bar. Used in crafting.',\n    category: 'resource', sprite: 'sprites/items/resource/iron_bar.png',\n    maxStack: 999, sellPrice: 120, buyPrice: 300, rarity: 1,\n    \n  },\n  {\n    id: 'gold_bar', name: 'Gold Bar', description: 'A refined gold bar. Used in crafting.',\n    category: 'resource', sprite: 'sprites/items/resource/gold_bar.png',\n    maxStack: 999, sellPrice: 250, buyPrice: 625, rarity: 1,\n    \n  },\n  {\n    id: 'wheat_flour', name: 'Wheat Flour', description: 'Ground wheat for baking.',\n    category: 'resource', sprite: 'sprites/Food/food_item_0100.png',\n    maxStack: 99, sellPrice: 20, buyPrice: 50, rarity: 0,\n    \n  },\n  {\n    id: 'sugar', name: 'Sugar', description: 'Sweetener for recipes.',\n    category: 'resource', sprite: 'sprites/Food/food_item_0101.png',\n    maxStack: 99, sellPrice: 25, buyPrice: 63, rarity: 0,\n    \n  },\n  {\n    id: 'red_mushroom', name: 'Red Mushroom', description: 'A red mushroom used in alchemy.',\n    category: 'resource', sprite: 'sprites/items/resource/red_mushroom.png',\n    maxStack: 99, sellPrice: 40, buyPrice: 100, rarity: 0,\n    \n  },\n  {\n    id: 'green_mushroom', name: 'Green Mushroom', description: 'A green mushroom used in alchemy.',\n    category: 'resource', sprite: 'sprites/items/resource/green_mushroom.png',\n    maxStack: 99, sellPrice: 40, buyPrice: 100, rarity: 0,\n    \n  },\n  {\n    id: 'hay', name: 'Hay', description: 'Feed for farm animals.',\n    category: 'resource', sprite: 'sprites/items/resource/hay.png',\n    maxStack: 999, sellPrice: 25, buyPrice: 63, rarity: 0,\n    \n  },\n  {\n    id: 'wool', name: 'Wool', description: 'Soft wool from sheep or rabbits.',\n    category: 'resource', sprite: 'sprites/items/resource/wool.png',\n    maxStack: 99, sellPrice: 200, buyPrice: 500, rarity: 0,\n    \n  },\n  {\n    id: 'butter', name: 'Fresh Butter', description: 'Creamy butter made from fresh milk.',\n    category: 'resource', sprite: 'sprites/Food/food_item_0007.png',\n    maxStack: 99, sellPrice: 60, buyPrice: 150, rarity: 0,\n    \n  },\n  {\n    id: 'cream', name: 'Heavy Cream', description: 'Rich cream for cooking and baking.',\n    category: 'resource', sprite: 'sprites/items/resource/cream.png',\n    maxStack: 99, sellPrice: 45, buyPrice: 113, rarity: 0,\n    \n  },\n  {\n    id: 'rope', name: 'Rope', description: 'Sturdy braided fiber. Used to descend into the deepest pits where sunlight has never reached.',\n    category: 'resource', sprite: 'sprites/items/resource/rope.png',\n    maxStack: 99, sellPrice: 30, buyPrice: 75, rarity: 0,\n    \n  },\n  {\n    id: 'rotted_wood', name: 'Rotted Wood', description: 'Crumbling timber softened by decay and corruption. Only useful as fuel or filler.',\n    category: 'resource', sprite: 'sprites/items/resource/rotted_wood.png',\n    maxStack: 99, sellPrice: 10, buyPrice: 25, rarity: 0,\n    gatherTool: 'axe', \n  },\n  {\n    id: 'flower', name: 'Flower', description: 'A delicate bloom clinging to life in blighted soil. Beauty persists even in damnation.',\n    category: 'resource', sprite: 'sprites/items/resource/flower.png',\n    maxStack: 99, sellPrice: 25, buyPrice: 63, rarity: 0,\n    \n  },\n  {\n    id: 'rare_herb', name: 'Rare Herb', description: 'A luminous plant found only in places where the veil between worlds grows thin.',\n    category: 'resource', sprite: 'sprites/items/resource/rare_herb.png',\n    maxStack: 99, sellPrice: 100, buyPrice: 250, rarity: 2,\n    \n  },\n  {\n    id: 'wild_horseradish', name: 'Wild Horseradish', description: 'A pungent root torn from the cursed earth. Its bitter heat wards off the chill of death.',\n    category: 'resource', sprite: 'sprites/items/resource/wild_horseradish.png',\n    maxStack: 99, sellPrice: 50, buyPrice: 125, rarity: 0,\n    \n  },\n  {\n    id: 'daffodil', name: 'Daffodil', description: 'A pale bloom that grows where the veil between worlds is thin. Beautiful but unsettling.',\n    category: 'resource', sprite: 'sprites/items/resource/daffodil.png',\n    maxStack: 99, sellPrice: 30, buyPrice: 75, rarity: 0,\n    \n  },\n  {\n    id: 'leek', name: 'Leek', description: 'A hardy stalk found near abandoned graves. Its sharp flavor cuts through the fog of despair.',\n    category: 'resource', sprite: 'sprites/items/resource/leek.png',\n    maxStack: 99, sellPrice: 60, buyPrice: 150, rarity: 0,\n    \n  },\n  {\n    id: 'dandelion', name: 'Dandelion', description: 'A tenacious weed that thrives even in blighted soil. Some brew it into bitter tonics.',\n    category: 'resource', sprite: 'sprites/items/resource/dandelion.png',\n    maxStack: 99, sellPrice: 25, buyPrice: 63, rarity: 0,\n    \n  },\n  {\n    id: 'spice_berry', name: 'Spice Berry', description: 'A fiery red berry that burns the tongue. Prized by alchemists for its volatile essence.',\n    category: 'resource', sprite: 'sprites/items/resource/spice_berry.png',\n    maxStack: 99, sellPrice: 80, buyPrice: 200, rarity: 0,\n    \n  },\n  {\n    id: 'sweet_pea', name: 'Sweet Pea', description: 'A fragrant flower that masks the stench of decay. Survivors weave them into garlands of hope.',\n    category: 'resource', sprite: 'sprites/items/resource/sweet_pea.png',\n    maxStack: 99, sellPrice: 45, buyPrice: 113, rarity: 0,\n    \n  },\n  {\n    id: 'common_mushroom', name: 'Common Mushroom', description: 'A dull brown fungus found in damp hollows. Safe to eat, though it tastes of sorrow.',\n    category: 'resource', sprite: 'sprites/items/resource/common_mushroom.png',\n    maxStack: 99, sellPrice: 40, buyPrice: 100, rarity: 0,\n    \n  },\n  {\n    id: 'winter_root', name: 'Winter Root', description: 'A gnarled root frozen in permafrost. Radiates a faint, unnatural warmth when held.',\n    category: 'resource', sprite: 'sprites/items/resource/winter_root.png',\n    maxStack: 99, sellPrice: 70, buyPrice: 175, rarity: 0,\n    \n  },\n  {\n    id: 'crocus', name: 'Crocus', description: 'A delicate purple flower that blooms defiantly through frost and ash. A stubborn sign of life.',\n    category: 'resource', sprite: 'sprites/items/resource/crocus.png',\n    maxStack: 99, sellPrice: 30, buyPrice: 75, rarity: 0,\n    \n  },\n  {\n    id: 'purple_mushroom', name: 'Purple Mushroom', description: 'A rare violet fungus that pulses with eldritch light. Highly valued by occultists and herbalists.',\n    category: 'resource', sprite: 'sprites/items/resource/purple_mushroom.png',\n    maxStack: 99, sellPrice: 250, buyPrice: 625, rarity: 0,\n    \n  },\n  {\n    id: 'morel', name: 'Morel', description: 'A honeycomb-capped mushroom found near rotting stumps. Coveted by dark chefs for its earthy flavor.',\n    category: 'resource', sprite: 'sprites/items/resource/morel.png',\n    maxStack: 99, sellPrice: 150, buyPrice: 375, rarity: 0,\n    gatherTool: 'pickaxe', \n  },\n  {\n    id: 'hardwood', name: 'Hardwood', description: 'Dense timber from ancient, gnarled trees. Strong enough to reinforce any barricade against the horde.',\n    category: 'resource', sprite: 'sprites/items/resource/hardwood.png',\n    maxStack: 99, sellPrice: 30, buyPrice: 75, rarity: 0,\n    gatherTool: 'axe', \n  },\n  {\n    id: 'maple_syrup', name: 'Maple Syrup', description: 'Thick amber sap tapped from withered maples. Sweet as sin in a world drained of all sweetness.',\n    category: 'resource', sprite: 'sprites/items/resource/maple_syrup.png',\n    maxStack: 99, sellPrice: 120, buyPrice: 300, rarity: 0,\n    \n  },\n  {\n    id: 'oak_resin', name: 'Oak Resin', description: 'Sticky resin bled from ancient oaks. Used to seal wounds and craft dark preservatives.',\n    category: 'resource', sprite: 'sprites/items/resource/oak_resin.png',\n    maxStack: 99, sellPrice: 100, buyPrice: 250, rarity: 0,\n    \n  },\n  {\n    id: 'pine_tar', name: 'Pine Tar', description: 'Dark, viscous tar distilled from cursed pines. Burns with an acrid, cleansing smoke.',\n    category: 'resource', sprite: 'sprites/items/resource/pine_tar.png',\n    maxStack: 99, sellPrice: 80, buyPrice: 200, rarity: 0,\n    \n  },\n  {\n    id: 'large_milk', name: 'Large Milk', description: 'A generous pail of rich milk from a well-tended beast. Rare comfort in dark times.',\n    category: 'resource', sprite: 'sprites/items/resource/large_milk.png',\n    maxStack: 99, sellPrice: 150, buyPrice: 375, rarity: 0,\n    \n  },\n  {\n    id: 'large_egg', name: 'Large Egg', description: 'An oversized egg with a thick, mottled shell. Something seems to stir within.',\n    category: 'resource', sprite: 'sprites/items/resource/large_egg.png',\n    maxStack: 99, sellPrice: 100, buyPrice: 250, rarity: 0,\n    \n  },\n  {\n    id: 'large_goat_milk', name: 'Large Goat Milk', description: 'Pungent milk from a goat that grazes on cursed pastures. Surprisingly nourishing.',\n    category: 'resource', sprite: 'sprites/items/resource/large_goat_milk.png',\n    maxStack: 99, sellPrice: 200, buyPrice: 500, rarity: 0,\n    \n  },\n  {\n    id: 'quartz', name: 'Quartz', description: 'A cloudy crystal pried from cave walls. Hums faintly when the darkness draws near.',\n    category: 'resource', sprite: 'sprites/items/resource/quartz.png',\n    maxStack: 99, sellPrice: 25, buyPrice: 63, rarity: 0,\n    \n  },\n  {\n    id: 'earth_crystal', name: 'Earth Crystal', description: 'A jagged amber crystal born from tectonic fury. Warm to the touch, even in bitter cold.',\n    category: 'resource', sprite: 'sprites/items/resource/earth_crystal.png',\n    maxStack: 99, sellPrice: 50, buyPrice: 125, rarity: 2,\n    \n  },\n  {\n    id: 'fire_quartz', name: 'Fire Quartz', description: 'A blazing red crystal that smolders with trapped heat. Burns the unwary who grip it too long.',\n    category: 'resource', sprite: 'sprites/items/resource/fire_quartz.png',\n    maxStack: 99, sellPrice: 80, buyPrice: 200, rarity: 0,\n    \n  },\n  {\n    id: 'speed_gro', name: 'Speed-Gro', description: 'Alchemical fertilizer that accelerates growth. The plants it feeds grow unnaturally fast.',\n    category: 'resource', sprite: 'sprites/items/resource/speed_gro.png',\n    maxStack: 99, sellPrice: 60, buyPrice: 150, rarity: 0,\n    \n  },\n  {\n    id: 'void_egg', name: 'Void Egg', description: 'A pitch-black egg that absorbs all light around it. Something writhes within its obsidian shell.',\n    category: 'resource', sprite: 'sprites/items/resource/void_egg.png',\n    maxStack: 99, sellPrice: 200, buyPrice: 500, rarity: 2,\n    \n  },\n  {\n    id: 'pearl', name: 'Pearl', description: 'A lustrous sphere formed around a grain of suffering. The ocean\\'s most beautiful wound.',\n    category: 'resource', sprite: 'sprites/items/resource/pearl.png',\n    maxStack: 99, sellPrice: 1500, buyPrice: 3750, rarity: 0,\n    \n  },\n  {\n    id: 'master_ore', name: 'Master Ore', description: 'An ore of legendary purity from the deepest abyssal mines. Forges sing when it melts.',\n    category: 'resource', sprite: 'sprites/items/resource/master_ore.png',\n    maxStack: 99, sellPrice: 500, buyPrice: 1250, rarity: 0,\n    gatherTool: 'pickaxe', \n  },\n  {\n    id: 'ancient_herb', name: 'Ancient Herb', description: 'A withered herb from a long-dead garden. Its medicinal properties defy the passage of ages.',\n    category: 'resource', sprite: 'sprites/items/resource/ancient_herb.png',\n    maxStack: 99, sellPrice: 250, buyPrice: 625, rarity: 2,\n    \n  },\n  {\n    id: 'diamond', name: 'Diamond', description: 'A flawless gemstone forged in the earth\\'s crushing depths. Harder than any blade, colder than any heart.',\n    category: 'resource', sprite: 'sprites/items/resource/diamond.png',\n    maxStack: 99, sellPrice: 750, buyPrice: 1875, rarity: 0,\n    \n  },\n  {\n    id: 'ruby', name: 'Ruby', description: 'A blood-red gemstone that glows like a dying ember. Sought by warlords and sorcerers alike.',\n    category: 'resource', sprite: 'sprites/items/resource/ruby.png',\n    maxStack: 99, sellPrice: 500, buyPrice: 1250, rarity: 0,\n    \n  },\n];\n\n// ============ MATERIALS ============\nexport const MATERIALS: MaterialDef[] = [\n  {\n    id: 'slime_gel', name: 'Slime Gel', description: 'Sticky gel from slimes. Used in crafting.',\n    category: 'material', sprite: 'sprites/items/material/slime_gel.png',\n    maxStack: 99, sellPrice: 15, buyPrice: 38, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'ice_crystal', name: 'Ice Crystal', description: 'A cold crystal from frozen creatures.',\n    category: 'material', sprite: 'sprites/items/material/ice_crystal.png',\n    maxStack: 99, sellPrice: 50, buyPrice: 125, rarity: 2,\n    tier: 1,\n  },\n  {\n    id: 'bat_wing', name: 'Bat Wing', description: 'A leathery wing from a cave bat.',\n    category: 'material', sprite: 'sprites/items/material/bat_wing.png',\n    maxStack: 99, sellPrice: 20, buyPrice: 50, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'bone', name: 'Bone', description: 'A bone from defeated skeletons.',\n    category: 'material', sprite: 'sprites/items/material/bone.png',\n    maxStack: 99, sellPrice: 25, buyPrice: 63, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'ectoplasm', name: 'Ectoplasm', description: 'Ghostly residue with magical properties.',\n    category: 'material', sprite: 'sprites/items/material/ectoplasm.png',\n    maxStack: 99, sellPrice: 75, buyPrice: 188, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'spirit_shard', name: 'Spirit Shard', description: 'A rare crystallized spirit fragment.',\n    category: 'material', sprite: 'sprites/items/material/spirit_shard.png',\n    maxStack: 99, sellPrice: 200, buyPrice: 500, rarity: 0,\n    tier: 2,\n  },\n  {\n    id: 'fur', name: 'Beast Fur', description: 'Thick fur from wild beasts.',\n    category: 'material', sprite: 'sprites/items/material/fur.png',\n    maxStack: 99, sellPrice: 35, buyPrice: 88, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'leather', name: 'Leather', description: 'Tanned animal hide. Used for crafting.',\n    category: 'material', sprite: 'sprites/items/material/leather.png',\n    maxStack: 99, sellPrice: 40, buyPrice: 100, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'tusk', name: 'Wild Tusk', description: 'A sturdy tusk from a wild boar.',\n    category: 'material', sprite: 'sprites/items/material/tusk.png',\n    maxStack: 99, sellPrice: 60, buyPrice: 150, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'feather', name: 'Feather', description: 'A soft feather from wild birds.',\n    category: 'material', sprite: 'sprites/items/material/feather.png',\n    maxStack: 99, sellPrice: 15, buyPrice: 38, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'fang', name: 'Sharp Fang', description: 'A razor-sharp fang from a predator.',\n    category: 'material', sprite: 'sprites/items/material/fang.png',\n    maxStack: 99, sellPrice: 45, buyPrice: 113, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'spore', name: 'Toxic Spore', description: 'Poisonous spores from mutant fungi.',\n    category: 'material', sprite: 'sprites/items/material/spore.png',\n    maxStack: 99, sellPrice: 30, buyPrice: 75, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'magic_herb', name: 'Magic Herb', description: 'A rare herb with mystical properties.',\n    category: 'material', sprite: 'sprites/items/material/magic_herb.png',\n    maxStack: 99, sellPrice: 100, buyPrice: 250, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'arrow', name: 'Arrow', description: 'Ammunition for bows.',\n    category: 'material', sprite: 'sprites/items/material/arrow.png',\n    maxStack: 999, sellPrice: 5, buyPrice: 13, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'slime_crown', name: 'Slime Crown', description: 'A gelatinous crown from the Slime King. Radiates a strange energy.',\n    category: 'material', sprite: 'sprites/items/material/slime_crown.png',\n    maxStack: 1, sellPrice: 2500, buyPrice: 6250, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'royal_jelly', name: 'Royal Jelly', description: 'Precious substance from the Slime King. Used in powerful elixirs.',\n    category: 'material', sprite: 'sprites/items/material/royal_jelly.png',\n    maxStack: 99, sellPrice: 500, buyPrice: 1250, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'prismatic_shard', name: 'Prismatic Shard', description: 'An extremely rare crystallized rainbow. Highly valuable.',\n    category: 'material', sprite: 'sprites/items/material/prismatic_shard.png',\n    maxStack: 99, sellPrice: 5000, buyPrice: 12500, rarity: 4,\n    tier: 5,\n  },\n  {\n    id: 'void_heart', name: 'Void Heart', description: 'The dark heart of the Shadow Lord. Pulses with shadowy energy.',\n    category: 'material', sprite: 'sprites/items/material/void_heart.png',\n    maxStack: 1, sellPrice: 3500, buyPrice: 8750, rarity: 2,\n    tier: 5,\n  },\n  {\n    id: 'galaxy_soul', name: 'Galaxy Soul', description: 'A fragment of the cosmos itself. Required for legendary crafting.',\n    category: 'material', sprite: 'sprites/items/material/galaxy_soul.png',\n    maxStack: 99, sellPrice: 10000, buyPrice: 25000, rarity: 5,\n    tier: 5,\n  },\n  {\n    id: 'frost_scale', name: 'Frost Scale', description: 'A scale from the Frost Wyrm. Eternally cold to the touch.',\n    category: 'material', sprite: 'sprites/items/material/frost_scale.png',\n    maxStack: 99, sellPrice: 750, buyPrice: 1875, rarity: 2,\n    tier: 3,\n  },\n  {\n    id: 'frozen_heart', name: 'Frozen Heart', description: 'The icy core of the Frost Wyrm. Never melts.',\n    category: 'material', sprite: 'sprites/items/material/frozen_heart.png',\n    maxStack: 1, sellPrice: 5000, buyPrice: 12500, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'wyrm_fang', name: 'Wyrm Fang', description: 'A massive fang from the Frost Wyrm. Sharp as ice.',\n    category: 'material', sprite: 'sprites/items/material/wyrm_fang.png',\n    maxStack: 99, sellPrice: 1200, buyPrice: 3000, rarity: 2,\n    tier: 3,\n  },\n  {\n    id: 'ancient_core', name: 'Ancient Core', description: 'The power source of the Ancient Golem. Hums with ancient magic.',\n    category: 'material', sprite: 'sprites/items/material/ancient_core.png',\n    maxStack: 1, sellPrice: 6000, buyPrice: 15000, rarity: 3,\n    tier: 3,\n  },\n  {\n    id: 'golem_heart', name: 'Golem Heart', description: 'A stone heart that once beat with elemental power.',\n    category: 'material', sprite: 'sprites/items/material/golem_heart.png',\n    maxStack: 1, sellPrice: 4000, buyPrice: 10000, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'void_crown', name: 'Void Crown', description: 'The Void Empress\\'s crown. Contains unfathomable power.',\n    category: 'material', sprite: 'sprites/items/material/void_crown.png',\n    maxStack: 1, sellPrice: 25000, buyPrice: 62500, rarity: 3,\n    tier: 5,\n  },\n  {\n    id: 'wooden_arrow', name: 'Wooden Arrow', description: 'Basic arrow. Gets the job done.',\n    category: 'material', sprite: 'sprites/items/material/wooden_arrow.png',\n    maxStack: 999, sellPrice: 2, buyPrice: 5, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'iron_arrow', name: 'Iron Arrow', description: 'Stronger arrow with an iron tip.',\n    category: 'material', sprite: 'sprites/items/material/iron_arrow.png',\n    maxStack: 999, sellPrice: 5, buyPrice: 13, rarity: 1,\n    tier: 1,\n  },\n  {\n    id: 'steel_arrow', name: 'Steel Arrow', description: 'High quality arrows with steel tips.',\n    category: 'material', sprite: 'sprites/items/material/steel_arrow.png',\n    maxStack: 999, sellPrice: 10, buyPrice: 25, rarity: 1,\n    tier: 2,\n  },\n  {\n    id: 'explosive_arrow', name: 'Explosive Arrow', description: 'Explodes on impact dealing area damage.',\n    category: 'material', sprite: 'sprites/items/material/explosive_arrow.png',\n    maxStack: 50, sellPrice: 50, buyPrice: 125, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'poison_arrow', name: 'Poison Arrow', description: 'Coated in venom. Poisons enemies.',\n    category: 'material', sprite: 'sprites/items/material/poison_arrow.png',\n    maxStack: 99, sellPrice: 25, buyPrice: 63, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'master_scepter', name: 'Master Scepter', description: 'A symbol of mastery over all skills. Grants bonus XP.',\n    category: 'material', sprite: 'sprites/items/material/master_scepter.png',\n    maxStack: 1, sellPrice: 100000, buyPrice: 250000, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'vine', name: 'Vine', description: 'A flexible vine from the Corrupted Grove.',\n    category: 'material', sprite: 'sprites/items/material/vine.png',\n    maxStack: 999, sellPrice: 5, buyPrice: 13, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'ancient_bark', name: 'Ancient Bark', description: 'Petrified bark from the oldest trees.',\n    category: 'material', sprite: 'sprites/items/material/ancient_bark.png',\n    maxStack: 99, sellPrice: 75, buyPrice: 188, rarity: 2,\n    tier: 3,\n  },\n  {\n    id: 'living_sap', name: 'Living Sap', description: 'Magical sap that glows with life energy.',\n    category: 'material', sprite: 'sprites/items/material/living_sap.png',\n    maxStack: 99, sellPrice: 120, buyPrice: 300, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'forest_heart', name: 'Forest Heart', description: 'The crystallized essence of the forest itself.',\n    category: 'material', sprite: 'sprites/items/material/forest_heart.png',\n    maxStack: 10, sellPrice: 500, buyPrice: 1250, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'treant_heart', name: 'Treant Heart', description: 'The magical core of an Ancient Treant.',\n    category: 'material', sprite: 'sprites/items/material/treant_heart.png',\n    maxStack: 10, sellPrice: 1000, buyPrice: 2500, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'natures_blessing', name: 'Nature\\'s Blessing', description: 'A rare gift from the forest spirits.',\n    category: 'material', sprite: 'sprites/items/material/natures_blessing.png',\n    maxStack: 5, sellPrice: 2500, buyPrice: 6250, rarity: 0,\n    tier: 2,\n  },\n  {\n    id: 'spider_silk', name: 'Spider Silk', description: 'Incredibly strong silk from giant spiders.',\n    category: 'material', sprite: 'sprites/items/material/spider_silk.png',\n    maxStack: 99, sellPrice: 45, buyPrice: 113, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'venom_gland', name: 'Venom Gland', description: 'Contains potent spider venom.',\n    category: 'material', sprite: 'sprites/items/material/venom_gland.png',\n    maxStack: 50, sellPrice: 100, buyPrice: 250, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'queen_fang', name: 'Queen Fang', description: 'A massive fang from the Spider Queen.',\n    category: 'material', sprite: 'sprites/items/material/queen_fang.png',\n    maxStack: 10, sellPrice: 750, buyPrice: 1875, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'swamp_moss', name: 'Swamp Moss', description: 'Slimy moss from the marsh.',\n    category: 'material', sprite: 'sprites/items/material/swamp_moss.png',\n    maxStack: 999, sellPrice: 4, buyPrice: 10, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'toxin_gland', name: 'Toxin Gland', description: 'A gland filled with marsh toxins.',\n    category: 'material', sprite: 'sprites/items/material/toxin_gland.png',\n    maxStack: 99, sellPrice: 35, buyPrice: 88, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'murky_water', name: 'Murky Water', description: 'Brackish water from the marsh depths.',\n    category: 'material', sprite: 'sprites/items/material/murky_water.png',\n    maxStack: 99, sellPrice: 10, buyPrice: 25, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'venom_sac', name: 'Venom Sac', description: 'A sac of concentrated marsh venom.',\n    category: 'material', sprite: 'sprites/items/material/venom_sac.png',\n    maxStack: 50, sellPrice: 85, buyPrice: 213, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'bog_essence', name: 'Bog Essence', description: 'The distilled essence of the blighted marsh.',\n    category: 'material', sprite: 'sprites/items/material/bog_essence.png',\n    maxStack: 50, sellPrice: 150, buyPrice: 375, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'marsh_eye', name: 'Marsh Eye', description: 'An eye from the Swamp Horror. It still watches.',\n    category: 'material', sprite: 'sprites/items/material/marsh_eye.png',\n    maxStack: 10, sellPrice: 600, buyPrice: 1500, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'horror_tentacle', name: 'Horror Tentacle', description: 'A severed tentacle from the Swamp Horror.',\n    category: 'material', sprite: 'sprites/items/material/horror_tentacle.png',\n    maxStack: 20, sellPrice: 350, buyPrice: 875, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'blighted_heart', name: 'Blighted Heart', description: 'The corrupted heart of the marsh.',\n    category: 'material', sprite: 'sprites/items/material/blighted_heart.png',\n    maxStack: 5, sellPrice: 1200, buyPrice: 3000, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'lurker_scale', name: 'Lurker Scale', description: 'Tough scales from a Marsh Lurker.',\n    category: 'material', sprite: 'sprites/items/material/lurker_scale.png',\n    maxStack: 99, sellPrice: 60, buyPrice: 150, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'swamp_fang', name: 'Swamp Fang', description: 'A razor-sharp fang from the marsh.',\n    category: 'material', sprite: 'sprites/items/material/swamp_fang.png',\n    maxStack: 50, sellPrice: 120, buyPrice: 300, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'fire_ore', name: 'Fire Ore', description: 'Ore infused with volcanic heat.',\n    category: 'material', sprite: 'sprites/items/material/fire_ore.png',\n    maxStack: 999, sellPrice: 25, buyPrice: 63, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'obsidian', name: 'Obsidian', description: 'Volcanic glass, extremely sharp.',\n    category: 'material', sprite: 'sprites/items/material/obsidian.png',\n    maxStack: 999, sellPrice: 40, buyPrice: 100, rarity: 2,\n    tier: 1,\n  },\n  {\n    id: 'ash', name: 'Volcanic Ash', description: 'Fine ash from volcanic eruptions.',\n    category: 'material', sprite: 'sprites/items/material/ash.png',\n    maxStack: 999, sellPrice: 5, buyPrice: 13, rarity: 2,\n    tier: 1,\n  },\n  {\n    id: 'magma_core', name: 'Magma Core', description: 'A core of solidified magma. Still warm.',\n    category: 'material', sprite: 'sprites/items/material/magma_core.png',\n    maxStack: 50, sellPrice: 200, buyPrice: 500, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'fire_crystal', name: 'Fire Crystal', description: 'A crystal formed from pure fire essence.',\n    category: 'material', sprite: 'sprites/items/material/fire_crystal.png',\n    maxStack: 50, sellPrice: 300, buyPrice: 750, rarity: 2,\n    tier: 2,\n  },\n  {\n    id: 'flame_core', name: 'Flame Core', description: 'The burning heart of the volcano.',\n    category: 'material', sprite: 'sprites/items/material/flame_core.png',\n    maxStack: 10, sellPrice: 800, buyPrice: 2000, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'molten_heart', name: 'Molten Heart', description: 'The heart of the Molten Guardian. Never cools.',\n    category: 'material', sprite: 'sprites/items/material/molten_heart.png',\n    maxStack: 5, sellPrice: 1500, buyPrice: 3750, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'infernal_essence', name: 'Infernal Essence', description: 'Pure volcanic energy in crystallized form.',\n    category: 'material', sprite: 'sprites/items/material/infernal_essence.png',\n    maxStack: 10, sellPrice: 2000, buyPrice: 5000, rarity: 2,\n    tier: 3,\n  },\n  {\n    id: 'imp_crown', name: 'Imp Crown', description: 'The crown of the Fire Imp King.',\n    category: 'material', sprite: 'sprites/items/material/imp_crown.png',\n    maxStack: 5, sellPrice: 500, buyPrice: 1250, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'frozen_tear', name: 'Frozen Tear', description: 'A tear frozen for eternity.',\n    category: 'material', sprite: 'sprites/items/material/frozen_tear.png',\n    maxStack: 99, sellPrice: 50, buyPrice: 125, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'snow_essence', name: 'Snow Essence', description: 'The pure essence of winter.',\n    category: 'material', sprite: 'sprites/items/material/snow_essence.png',\n    maxStack: 99, sellPrice: 35, buyPrice: 88, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'permafrost', name: 'Permafrost', description: 'Ice that never melts, even in fire.',\n    category: 'material', sprite: 'sprites/items/material/permafrost.png',\n    maxStack: 50, sellPrice: 150, buyPrice: 375, rarity: 2,\n    tier: 3,\n  },\n  {\n    id: 'glacial_shard', name: 'Glacial Shard', description: 'A shard from an ancient glacier.',\n    category: 'material', sprite: 'sprites/items/material/glacial_shard.png',\n    maxStack: 50, sellPrice: 200, buyPrice: 500, rarity: 2,\n    tier: 1,\n  },\n  {\n    id: 'frost_shard', name: 'Frost Shard', description: 'A shard of crystallized frost magic.',\n    category: 'material', sprite: 'sprites/items/material/frost_shard.png',\n    maxStack: 20, sellPrice: 400, buyPrice: 1000, rarity: 2,\n    tier: 3,\n  },\n  {\n    id: 'wyrm_scale', name: 'Wyrm Scale', description: 'A scale from the mighty Frost Wyrm.',\n    category: 'material', sprite: 'sprites/items/material/wyrm_scale.png',\n    maxStack: 20, sellPrice: 600, buyPrice: 1500, rarity: 2,\n    tier: 3,\n  },\n  {\n    id: 'heart_of_winter', name: 'Heart of Winter', description: 'The frozen heart of the ice realm.',\n    category: 'material', sprite: 'sprites/items/material/heart_of_winter.png',\n    maxStack: 5, sellPrice: 2000, buyPrice: 5000, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'grave_dust', name: 'Grave Dust', description: 'Dust from ancient graves.',\n    category: 'material', sprite: 'sprites/items/material/grave_dust.png',\n    maxStack: 999, sellPrice: 12, buyPrice: 30, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'soul_fragment', name: 'Soul Fragment', description: 'A piece of a departed soul.',\n    category: 'material', sprite: 'sprites/items/material/soul_fragment.png',\n    maxStack: 50, sellPrice: 150, buyPrice: 375, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'spirit_essence', name: 'Spirit Essence', description: 'The distilled essence of spirits.',\n    category: 'material', sprite: 'sprites/items/material/spirit_essence.png',\n    maxStack: 50, sellPrice: 200, buyPrice: 500, rarity: 0,\n    tier: 2,\n  },\n  {\n    id: 'cursed_relic', name: 'Cursed Relic', description: 'An ancient relic bearing a dark curse.',\n    category: 'material', sprite: 'sprites/items/material/cursed_relic.png',\n    maxStack: 20, sellPrice: 300, buyPrice: 750, rarity: 0,\n    tier: 2,\n  },\n  {\n    id: 'lich_phylactery', name: 'Lich Phylactery', description: 'The vessel of the Lich King\\'s soul.',\n    category: 'material', sprite: 'sprites/items/material/lich_phylactery.png',\n    maxStack: 5, sellPrice: 3000, buyPrice: 7500, rarity: 0,\n    tier: 3,\n  },\n  {\n    id: 'death_crown', name: 'Death Crown', description: 'The crown of the Lich King.',\n    category: 'material', sprite: 'sprites/items/material/death_crown.png',\n    maxStack: 1, sellPrice: 5000, buyPrice: 12500, rarity: 0,\n    tier: 3,\n  },\n  {\n    id: 'cursed_bone', name: 'Cursed Bone', description: 'A bone infused with dark magic.',\n    category: 'material', sprite: 'sprites/items/material/cursed_bone.png',\n    maxStack: 50, sellPrice: 80, buyPrice: 200, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'bone_crown', name: 'Bone Crown', description: 'Crown of the Bone Lord.',\n    category: 'material', sprite: 'sprites/items/material/bone_crown.png',\n    maxStack: 5, sellPrice: 400, buyPrice: 1000, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'spectral_binding', name: 'Spectral Binding', description: 'Chains that bind spirits to this world.',\n    category: 'material', sprite: 'sprites/items/material/spectral_binding.png',\n    maxStack: 20, sellPrice: 350, buyPrice: 875, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'guardian_sigil', name: 'Guardian Sigil', description: 'A sigil dropped by biome guardians. Proves your worth.',\n    category: 'material', sprite: 'sprites/items/material/guardian_sigil.png',\n    maxStack: 10, sellPrice: 1000, buyPrice: 2500, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'void_essence', name: 'Void Essence', description: 'Pure darkness given form. The stuff of nightmares.',\n    category: 'material', sprite: 'sprites/items/material/void_essence.png',\n    maxStack: 50, sellPrice: 500, buyPrice: 1250, rarity: 2,\n    tier: 5,\n  },\n  {\n    id: 'starlight_fragment', name: 'Starlight Fragment', description: 'A piece of captured starlight. Glows softly in darkness.',\n    category: 'material', sprite: 'sprites/items/material/starlight_fragment.png',\n    maxStack: 99, sellPrice: 250, buyPrice: 625, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'ancient_coin', name: 'Ancient Coin', description: 'Currency from a forgotten civilization.',\n    category: 'material', sprite: 'sprites/items/material/ancient_coin.png',\n    maxStack: 999, sellPrice: 100, buyPrice: 250, rarity: 2,\n    tier: 3,\n  },\n  {\n    id: 'steel_bar', name: 'Steel Bar', description: 'Carbon-hardened iron refined through hellish heat. The backbone of weapons that endure.',\n    category: 'material', sprite: 'sprites/items/material/steel_bar.png',\n    maxStack: 99, sellPrice: 250, buyPrice: 625, rarity: 1,\n    tier: 2,\n  },\n  {\n    id: 'ornate_bar', name: 'Ornate Bar', description: 'An alloy of gold and arcane metals, etched with sigils that pulse faintly in the dark.',\n    category: 'material', sprite: 'sprites/items/material/ornate_bar.png',\n    maxStack: 99, sellPrice: 500, buyPrice: 1250, rarity: 0,\n    tier: 2,\n  },\n  {\n    id: 'void_ingot', name: 'Void Ingot', description: 'A bar of solidified nothingness. It absorbs light and warmth from everything it touches.',\n    category: 'material', sprite: 'sprites/items/material/void_ingot.png',\n    maxStack: 99, sellPrice: 1500, buyPrice: 3750, rarity: 2,\n    tier: 5,\n  },\n  {\n    id: 'frost_alloy', name: 'Frost Alloy', description: 'A blue-white metal that never warms. Forged from glacial ore in the breath of a dying winter.',\n    category: 'material', sprite: 'sprites/items/material/frost_alloy.png',\n    maxStack: 99, sellPrice: 1200, buyPrice: 3000, rarity: 2,\n    tier: 3,\n  },\n  {\n    id: 'refined_quartz', name: 'Refined Quartz', description: 'Purified crystal humming with latent energy. The foundation of enchantments and ruin alike.',\n    category: 'material', sprite: 'sprites/items/material/refined_quartz.png',\n    maxStack: 99, sellPrice: 100, buyPrice: 250, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'golem_core_shard', name: 'Golem Core Shard', description: 'A fragment of the animating heart of a golem. It still trembles with the echo of false life.',\n    category: 'material', sprite: 'sprites/items/material/golem_core_shard.png',\n    maxStack: 99, sellPrice: 2000, buyPrice: 5000, rarity: 0,\n    tier: 4,\n  },\n  {\n    id: 'rotten_flesh', name: 'Rotten Flesh', description: 'Putrid strips of decaying meat. The stench clings to everything it touches.',\n    category: 'material', sprite: 'sprites/items/material/rotten_flesh.png',\n    maxStack: 99, sellPrice: 15, buyPrice: 38, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'sinew', name: 'Sinew', description: 'Tough fibers torn from the tendons of fallen beasts. Useful for binding and bowstrings.',\n    category: 'material', sprite: 'sprites/items/material/sinew.png',\n    maxStack: 99, sellPrice: 25, buyPrice: 63, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'claw', name: 'Claw', description: 'A curved talon still stained with old blood. Sharp enough to score iron.',\n    category: 'material', sprite: 'sprites/items/material/claw.png',\n    maxStack: 99, sellPrice: 30, buyPrice: 75, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'diseased_flesh', name: 'Diseased Flesh', description: 'Blackened tissue riddled with pestilence. Alchemists prize its toxic properties.',\n    category: 'material', sprite: 'sprites/items/material/diseased_flesh.png',\n    maxStack: 99, sellPrice: 10, buyPrice: 25, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'rat_tail', name: 'Rat Tail', description: 'A wiry tail severed from the vermin that infest the ruins. Proof of a minor extermination.',\n    category: 'material', sprite: 'sprites/items/material/rat_tail.png',\n    maxStack: 99, sellPrice: 20, buyPrice: 50, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'antler', name: 'Antler', description: 'A branching horn from a corrupted stag. The bone is unnaturally warm to the touch.',\n    category: 'material', sprite: 'sprites/items/material/antler.png',\n    maxStack: 99, sellPrice: 45, buyPrice: 113, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'bile', name: 'Bile', description: 'Acrid digestive fluid harvested from aberrant stomachs. It dissolves most containers over time.',\n    category: 'material', sprite: 'sprites/items/material/bile.png',\n    maxStack: 99, sellPrice: 35, buyPrice: 88, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'corrupted_flesh', name: 'Corrupted Flesh', description: 'Tissue warped by dark magic into something no longer recognizable as mortal remains.',\n    category: 'material', sprite: 'sprites/items/material/corrupted_flesh.png',\n    maxStack: 99, sellPrice: 30, buyPrice: 75, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'lens', name: 'Lens', description: 'A crystalline eye pried from a construct of the deep. It still seems to watch you.',\n    category: 'material', sprite: 'sprites/items/material/lens.png',\n    maxStack: 99, sellPrice: 50, buyPrice: 125, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'cursed_bark', name: 'Cursed Bark', description: 'Stripped from trees that grow where the damned were buried. It weeps black sap in moonlight.',\n    category: 'material', sprite: 'sprites/items/material/cursed_bark.png',\n    maxStack: 99, sellPrice: 40, buyPrice: 100, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'dark_sap', name: 'Dark Sap', description: 'Viscous black resin that oozes from blighted wood. Burns with a sickly violet flame.',\n    category: 'material', sprite: 'sprites/items/material/dark_sap.png',\n    maxStack: 99, sellPrice: 35, buyPrice: 88, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'banshee_tear', name: 'Banshee Tear', description: 'A single frozen tear shed by a wailing spirit. It hums with sorrow that never ends.',\n    category: 'material', sprite: 'sprites/items/material/banshee_tear.png',\n    maxStack: 99, sellPrice: 80, buyPrice: 200, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'stitched_flesh', name: 'Stitched Flesh', description: 'Patches of skin crudely sewn together from multiple bodies. A necromancer\\'s patchwork.',\n    category: 'material', sprite: 'sprites/items/material/stitched_flesh.png',\n    maxStack: 99, sellPrice: 55, buyPrice: 138, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'corrupted_heart', name: 'Corrupted Heart', description: 'A blackened organ that still beats with a slow, dreadful rhythm. Dark power courses through it.',\n    category: 'material', sprite: 'sprites/items/material/corrupted_heart.png',\n    maxStack: 99, sellPrice: 120, buyPrice: 300, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'demon_heart', name: 'Demon Heart', description: 'Ripped from a creature of the abyss. It burns to hold and whispers terrible promises.',\n    category: 'material', sprite: 'sprites/items/material/demon_heart.png',\n    maxStack: 99, sellPrice: 500, buyPrice: 1250, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'phoenix_feather', name: 'Phoenix Feather', description: 'A plume of undying flame. It crumbles to ash and reforms endlessly in your hands.',\n    category: 'material', sprite: 'sprites/items/material/phoenix_feather.png',\n    maxStack: 99, sellPrice: 800, buyPrice: 2000, rarity: 3,\n    tier: 4,\n  },\n  {\n    id: 'wind_essence', name: 'Wind Essence', description: 'Captured gale force bound in a fragile shell. Release it and the storm answers.',\n    category: 'material', sprite: 'sprites/items/material/wind_essence.png',\n    maxStack: 99, sellPrice: 300, buyPrice: 750, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'talon', name: 'Talon', description: 'A razor-sharp talon from a predator of the skies. It could rend steel with ease.',\n    category: 'material', sprite: 'sprites/items/material/talon.png',\n    maxStack: 99, sellPrice: 60, buyPrice: 150, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'dragon_scale', name: 'Dragon Scale', description: 'An iridescent scale shed by a dragon. Harder than steel and warm to the touch.',\n    category: 'material', sprite: 'sprites/items/material/dragon_scale.png',\n    maxStack: 99, sellPrice: 800, buyPrice: 2000, rarity: 3,\n    tier: 4,\n  },\n  {\n    id: 'dragon_heart', name: 'Dragon Heart', description: 'The still-smoldering heart of a slain dragon. Its fire will never fully die.',\n    category: 'material', sprite: 'sprites/items/material/dragon_heart.png',\n    maxStack: 99, sellPrice: 2000, buyPrice: 5000, rarity: 3,\n    tier: 4,\n  },\n  {\n    id: 'cloth', name: 'Cloth', description: 'Woven fabric spun from beast fibers. Essential for bandages and reinforced garments.',\n    category: 'material', sprite: 'sprites/items/material/cloth.png',\n    maxStack: 99, sellPrice: 300, buyPrice: 750, rarity: 0,\n    tier: 1,\n  },\n  {\n    id: 'solar_essence', name: 'Solar Essence', description: 'A fragment of captured sunlight. Searing to the undead and invaluable for enchantments.',\n    category: 'material', sprite: 'sprites/items/material/solar_essence.png',\n    maxStack: 99, sellPrice: 100, buyPrice: 250, rarity: 0,\n    tier: 1,\n  },\n];\n\n// ============ FOODS ============\nexport const FOODS: FoodDef[] = [\n  {\n    id: 'fried_egg', name: 'Fried Egg', description: 'A simple fried egg. Quick breakfast.',\n    category: 'food', sprite: 'sprites/items/food/fried_egg.png',\n    maxStack: 99, sellPrice: 35, buyPrice: 88, rarity: 0,\n    healAmount: 25, staminaRestore: 15,\n  },\n  {\n    id: 'vegetable_soup', name: 'Vegetable Soup', description: 'A hearty soup. Grants regen for 30s.',\n    category: 'food', sprite: 'sprites/items/food/vegetable_soup.png',\n    maxStack: 99, sellPrice: 80, buyPrice: 200, rarity: 0,\n    healAmount: 50, staminaRestore: 30,\n    buffType: 'regen', buffDuration: 30, buffMagnitude: 3,\n    foodCategory: 'balanced', dietDuration: 300, dietHpBonus: 25, dietStaminaBonus: 20,\n  },\n  {\n    id: 'fish_dinner', name: 'Fish Dinner', description: 'A satisfying dinner. +5 defense for 45s.',\n    category: 'food', sprite: 'sprites/items/food/fish_dinner.png',\n    maxStack: 99, sellPrice: 100, buyPrice: 250, rarity: 0,\n    healAmount: 60, staminaRestore: 40,\n    buffType: 'defense', buffDuration: 45, buffMagnitude: 5,\n    foodCategory: 'hearty', dietDuration: 300, dietHpBonus: 30, dietStaminaBonus: 10,\n  },\n  {\n    id: 'farmers_lunch', name: 'Farmer\\'s Lunch', description: 'Boosts movement speed by 20 for 60s.',\n    category: 'food', sprite: 'sprites/items/food/farmers_lunch.png',\n    maxStack: 99, sellPrice: 150, buyPrice: 375, rarity: 0,\n    healAmount: 80, staminaRestore: 60,\n    buffType: 'speed', buffDuration: 60, buffMagnitude: 20,\n    foodCategory: 'balanced', dietDuration: 300, dietHpBonus: 30, dietStaminaBonus: 25,\n  },\n  {\n    id: 'miners_treat', name: 'Miner\\'s Treat', description: 'Boosts attack by 8 for 45s.',\n    category: 'food', sprite: 'sprites/items/food/miners_treat.png',\n    maxStack: 99, sellPrice: 120, buyPrice: 300, rarity: 0,\n    healAmount: 70, staminaRestore: 50,\n    buffType: 'strength', buffDuration: 45, buffMagnitude: 8,\n    foodCategory: 'energizing', dietDuration: 270, dietHpBonus: 15, dietStaminaBonus: 30,\n  },\n  {\n    id: 'lucky_lunch', name: 'Lucky Lunch', description: 'Regen 5 HP/s for 30s after eating.',\n    category: 'food', sprite: 'sprites/items/food/lucky_lunch.png',\n    maxStack: 99, sellPrice: 200, buyPrice: 500, rarity: 0,\n    healAmount: 50, staminaRestore: 30,\n    buffType: 'regen', buffDuration: 30, buffMagnitude: 5,\n  },\n  {\n    id: 'pumpkin_pie', name: 'Pumpkin Pie', description: 'Seasonal treat. +10 defense for 60s.',\n    category: 'food', sprite: 'sprites/items/food/pumpkin_pie.png',\n    maxStack: 99, sellPrice: 250, buyPrice: 625, rarity: 0,\n    healAmount: 100, staminaRestore: 50,\n    buffType: 'defense', buffDuration: 60, buffMagnitude: 10,\n    foodCategory: 'balanced', dietDuration: 300, dietHpBonus: 35, dietStaminaBonus: 20,\n  },\n  {\n    id: 'eel', name: 'Eel', description: 'A slippery eel. Prized in cooking.',\n    category: 'food', sprite: 'sprites/items/food/eel.png',\n    maxStack: 99, sellPrice: 85, buyPrice: 213, rarity: 0,\n    healAmount: 20, staminaRestore: 10,\n  },\n  {\n    id: 'sea_cucumber', name: 'Sea Cucumber', description: 'A strange ocean creature. Lucky ingredient.',\n    category: 'food', sprite: 'sprites/items/food/sea_cucumber.png',\n    maxStack: 99, sellPrice: 75, buyPrice: 188, rarity: 0,\n    healAmount: 15, staminaRestore: 8,\n  },\n  {\n    id: 'tortilla', name: 'Tortilla', description: 'A flatbread made from corn.',\n    category: 'food', sprite: 'sprites/items/food/tortilla.png',\n    maxStack: 99, sellPrice: 30, buyPrice: 75, rarity: 0,\n    healAmount: 15, staminaRestore: 5,\n  },\n  {\n    id: 'honey', name: 'Honey', description: 'Sweet honey. Regen 2 HP/s for 20s.',\n    category: 'food', sprite: 'sprites/items/food/honey.png',\n    maxStack: 99, sellPrice: 100, buyPrice: 250, rarity: 0,\n    healAmount: 20, staminaRestore: 25,\n    buffType: 'regen', buffDuration: 20, buffMagnitude: 2,\n  },\n  {\n    id: 'bread', name: 'Bread', description: 'Simple but filling. Restores some health.',\n    category: 'food', sprite: 'sprites/Food/food_item_0010.png',\n    maxStack: 99, sellPrice: 60, buyPrice: 150, rarity: 0,\n    healAmount: 30, staminaRestore: 20,\n  },\n  {\n    id: 'apple', name: 'Apple', description: 'A crisp fruit. Slightly refreshing.',\n    category: 'food', sprite: 'sprites/Food/food_item_0020.png',\n    maxStack: 99, sellPrice: 25, buyPrice: 63, rarity: 0,\n    healAmount: 15, staminaRestore: 10,\n  },\n  {\n    id: 'fish', name: 'Fish', description: 'Fresh caught fish. Provides some nourishment.',\n    category: 'food', sprite: 'sprites/Food/food_item_0030.png',\n    maxStack: 99, sellPrice: 40, buyPrice: 100, rarity: 0,\n    healAmount: 20, staminaRestore: 12,\n  },\n  {\n    id: 'sardine', name: 'Sardine', description: 'A small ocean fish.',\n    category: 'food', sprite: 'sprites/items/food/sardine.png',\n    maxStack: 99, sellPrice: 15, buyPrice: 38, rarity: 0,\n    healAmount: 10, staminaRestore: 5,\n  },\n  {\n    id: 'carp', name: 'Carp', description: 'A common freshwater fish.',\n    category: 'food', sprite: 'sprites/items/food/carp.png',\n    maxStack: 99, sellPrice: 20, buyPrice: 50, rarity: 0,\n    healAmount: 12, staminaRestore: 6,\n  },\n  {\n    id: 'sunfish', name: 'Sunfish', description: 'A colorful pond fish.',\n    category: 'food', sprite: 'sprites/items/food/sunfish.png',\n    maxStack: 99, sellPrice: 25, buyPrice: 63, rarity: 0,\n    healAmount: 14, staminaRestore: 7,\n  },\n  {\n    id: 'catfish', name: 'Catfish', description: 'A whiskered bottom-feeder.',\n    category: 'food', sprite: 'sprites/items/food/catfish.png',\n    maxStack: 99, sellPrice: 75, buyPrice: 188, rarity: 0,\n    healAmount: 25, staminaRestore: 15,\n  },\n  {\n    id: 'bass', name: 'Largemouth Bass', description: 'A prized sport fish.',\n    category: 'food', sprite: 'sprites/items/food/bass.png',\n    maxStack: 99, sellPrice: 100, buyPrice: 250, rarity: 0,\n    healAmount: 30, staminaRestore: 20,\n  },\n  {\n    id: 'salmon', name: 'Salmon', description: 'A delicious pink-fleshed fish.',\n    category: 'food', sprite: 'sprites/Food/food_item_0031.png',\n    maxStack: 99, sellPrice: 120, buyPrice: 300, rarity: 0,\n    healAmount: 35, staminaRestore: 25,\n  },\n  {\n    id: 'sturgeon', name: 'Sturgeon', description: 'An ancient, valuable fish.',\n    category: 'food', sprite: 'sprites/items/food/sturgeon.png',\n    maxStack: 99, sellPrice: 250, buyPrice: 625, rarity: 1,\n    healAmount: 40, staminaRestore: 30,\n  },\n  {\n    id: 'octopus', name: 'Octopus', description: 'A clever eight-armed sea creature.',\n    category: 'food', sprite: 'sprites/items/food/octopus.png',\n    maxStack: 99, sellPrice: 300, buyPrice: 750, rarity: 1,\n    healAmount: 35, staminaRestore: 25,\n  },\n  {\n    id: 'crab_legs', name: 'Crab Legs', description: 'A legendary delicacy from the deep. Grants powerful regeneration and stat boosts.',\n    category: 'food', sprite: 'sprites/items/food/crab_legs.png',\n    maxStack: 16, sellPrice: 500, buyPrice: 1250, rarity: 0,\n    healAmount: 80, staminaRestore: 100,\n    foodCategory: 'special', dietDuration: 360, dietHpBonus: 40, dietStaminaBonus: 50,\n  },\n  {\n    id: 'raw_meat', name: 'Raw Meat', description: 'Fresh meat from wild animals. Cook it for better nutrition.',\n    category: 'food', sprite: 'sprites/Food/food_item_0040.png',\n    maxStack: 99, sellPrice: 25, buyPrice: 63, rarity: 0,\n    healAmount: 10, staminaRestore: 5,\n  },\n  {\n    id: 'cooked_meat', name: 'Cooked Meat', description: 'Well-cooked meat. Filling and nutritious.',\n    category: 'food', sprite: 'sprites/items/food/cooked_meat.png',\n    maxStack: 99, sellPrice: 75, buyPrice: 188, rarity: 0,\n    healAmount: 40, staminaRestore: 25,\n    foodCategory: 'hearty', dietDuration: 240, dietHpBonus: 25, dietStaminaBonus: 5,\n  },\n  {\n    id: 'acorn', name: 'Acorn', description: 'A small nut gathered by forest creatures.',\n    category: 'food', sprite: 'sprites/items/food/acorn.png',\n    maxStack: 99, sellPrice: 10, buyPrice: 25, rarity: 0,\n    healAmount: 5, staminaRestore: 3,\n  },\n  {\n    id: 'venison', name: 'Venison', description: 'Premium meat from deer. Highly valued.',\n    category: 'food', sprite: 'sprites/items/food/venison.png',\n    maxStack: 99, sellPrice: 80, buyPrice: 200, rarity: 0,\n    healAmount: 30, staminaRestore: 20,\n  },\n  {\n    id: 'rabbit_meat', name: 'Rabbit Meat', description: 'Tender meat from wild rabbits.',\n    category: 'food', sprite: 'sprites/items/food/rabbit_meat.png',\n    maxStack: 99, sellPrice: 35, buyPrice: 88, rarity: 0,\n    healAmount: 15, staminaRestore: 10,\n  },\n  {\n    id: 'boar_meat', name: 'Boar Meat', description: 'Hearty meat from wild boar. Great for stews.',\n    category: 'food', sprite: 'sprites/items/food/boar_meat.png',\n    maxStack: 99, sellPrice: 55, buyPrice: 138, rarity: 0,\n    healAmount: 25, staminaRestore: 15,\n  },\n  {\n    id: 'mushroom', name: 'Mushroom', description: 'A common edible mushroom.',\n    category: 'food', sprite: 'sprites/items/food/mushroom.png',\n    maxStack: 99, sellPrice: 20, buyPrice: 50, rarity: 0,\n    healAmount: 10, staminaRestore: 5,\n  },\n  {\n    id: 'stardrop', name: 'Stardrop', description: 'A mysterious fruit that permanently increases your maximum energy.',\n    category: 'food', sprite: 'sprites/items/food/stardrop.png',\n    maxStack: 1, sellPrice: 0, buyPrice: 0, rarity: 0,\n    healAmount: 0, staminaRestore: 0,\n  },\n  {\n    id: 'egg', name: 'Egg', description: 'A fresh chicken egg.',\n    category: 'food', sprite: 'sprites/Food/food_item_0005.png',\n    maxStack: 99, sellPrice: 50, buyPrice: 125, rarity: 0,\n    healAmount: 15, staminaRestore: 15,\n  },\n  {\n    id: 'duck_egg', name: 'Duck Egg', description: 'A large duck egg.',\n    category: 'food', sprite: 'sprites/items/food/duck_egg.png',\n    maxStack: 99, sellPrice: 75, buyPrice: 188, rarity: 0,\n    healAmount: 20, staminaRestore: 20,\n  },\n  {\n    id: 'milk', name: 'Milk', description: 'Fresh cow milk.',\n    category: 'food', sprite: 'sprites/Food/food_item_0006.png',\n    maxStack: 99, sellPrice: 125, buyPrice: 313, rarity: 0,\n    healAmount: 25, staminaRestore: 25,\n  },\n  {\n    id: 'goat_milk', name: 'Goat Milk', description: 'Fresh goat milk.',\n    category: 'food', sprite: 'sprites/items/food/goat_milk.png',\n    maxStack: 99, sellPrice: 150, buyPrice: 375, rarity: 0,\n    healAmount: 30, staminaRestore: 30,\n  },\n  {\n    id: 'truffle', name: 'Truffle', description: 'A rare delicacy found by pigs.',\n    category: 'food', sprite: 'sprites/items/food/truffle.png',\n    maxStack: 99, sellPrice: 500, buyPrice: 1250, rarity: 0,\n    healAmount: 50, staminaRestore: 50,\n  },\n  {\n    id: 'veggie_soup', name: 'Veggie Soup', description: 'Warm and healthy.',\n    category: 'food', sprite: 'sprites/items/food/veggie_soup.png',\n    maxStack: 99, sellPrice: 120, buyPrice: 300, rarity: 0,\n    healAmount: 40, staminaRestore: 30,\n  },\n  {\n    id: 'fish_stew', name: 'Fish Stew', description: 'Rich and savory stew.',\n    category: 'food', sprite: 'sprites/items/food/fish_stew.png',\n    maxStack: 99, sellPrice: 150, buyPrice: 375, rarity: 0,\n    healAmount: 50, staminaRestore: 40,\n    foodCategory: 'balanced', dietDuration: 300, dietHpBonus: 25, dietStaminaBonus: 20,\n  },\n  {\n    id: 'farmers_feast', name: 'Farmers Feast', description: 'The ultimate meal for a hard day.',\n    category: 'food', sprite: 'sprites/items/food/farmers_feast.png',\n    maxStack: 99, sellPrice: 400, buyPrice: 1000, rarity: 0,\n    healAmount: 100, staminaRestore: 100,\n    foodCategory: 'hearty', dietDuration: 360, dietHpBonus: 60, dietStaminaBonus: 30,\n  },\n  {\n    id: 'grilled_corn', name: 'Grilled Corn', description: 'Charred corn on the cob. Simple and tasty.',\n    category: 'food', sprite: 'sprites/items/food/grilled_corn.png',\n    maxStack: 99, sellPrice: 40, buyPrice: 100, rarity: 0,\n    healAmount: 20, staminaRestore: 10,\n  },\n  {\n    id: 'tomato_sauce', name: 'Tomato Sauce', description: 'Rich tomato sauce. Great base for recipes.',\n    category: 'food', sprite: 'sprites/items/food/tomato_sauce.png',\n    maxStack: 99, sellPrice: 55, buyPrice: 138, rarity: 0,\n    healAmount: 30, staminaRestore: 15,\n  },\n  {\n    id: 'fruit_salad', name: 'Fruit Salad', description: 'Fresh mixed fruits. Light and refreshing.',\n    category: 'food', sprite: 'sprites/items/food/fruit_salad.png',\n    maxStack: 99, sellPrice: 90, buyPrice: 225, rarity: 0,\n    healAmount: 35, staminaRestore: 50,\n    foodCategory: 'energizing', dietDuration: 240, dietHpBonus: 10, dietStaminaBonus: 35,\n  },\n  {\n    id: 'spicy_eel', name: 'Spicy Eel', description: 'Eel with a kick. Boosts speed and luck.',\n    category: 'food', sprite: 'sprites/items/food/spicy_eel.png',\n    maxStack: 99, sellPrice: 175, buyPrice: 438, rarity: 0,\n    healAmount: 45, staminaRestore: 30,\n  },\n  {\n    id: 'roasted_venison', name: 'Roasted Venison', description: 'Perfectly roasted deer meat. A tavern favorite.',\n    category: 'food', sprite: 'sprites/items/food/roasted_venison.png',\n    maxStack: 99, sellPrice: 200, buyPrice: 500, rarity: 0,\n    healAmount: 70, staminaRestore: 45,\n    foodCategory: 'hearty', dietDuration: 300, dietHpBonus: 35, dietStaminaBonus: 10,\n  },\n  {\n    id: 'meat_stew', name: 'Hearty Meat Stew', description: 'A rich stew with chunks of tender meat and vegetables.',\n    category: 'food', sprite: 'sprites/items/food/meat_stew.png',\n    maxStack: 99, sellPrice: 180, buyPrice: 450, rarity: 0,\n    healAmount: 80, staminaRestore: 50,\n    foodCategory: 'hearty', dietDuration: 300, dietHpBonus: 40, dietStaminaBonus: 10,\n  },\n  {\n    id: 'rabbit_pie', name: 'Rabbit Pie', description: 'A savory pie with rabbit meat filling. Comforting.',\n    category: 'food', sprite: 'sprites/items/food/rabbit_pie.png',\n    maxStack: 99, sellPrice: 220, buyPrice: 550, rarity: 0,\n    healAmount: 75, staminaRestore: 55,\n    foodCategory: 'balanced', dietDuration: 300, dietHpBonus: 30, dietStaminaBonus: 25,\n  },\n  {\n    id: 'grilled_boar', name: 'Grilled Wild Boar', description: 'Smoky grilled boar meat. Filling and delicious.',\n    category: 'food', sprite: 'sprites/items/food/grilled_boar.png',\n    maxStack: 99, sellPrice: 175, buyPrice: 438, rarity: 0,\n    healAmount: 65, staminaRestore: 40,\n    foodCategory: 'hearty', dietDuration: 240, dietHpBonus: 30, dietStaminaBonus: 10,\n  },\n  {\n    id: 'honey_glazed_ham', name: 'Honey Glazed Ham', description: 'Sweet and savory ham with a honey glaze.',\n    category: 'food', sprite: 'sprites/items/food/honey_glazed_ham.png',\n    maxStack: 99, sellPrice: 250, buyPrice: 625, rarity: 0,\n    healAmount: 85, staminaRestore: 60,\n    foodCategory: 'hearty', dietDuration: 300, dietHpBonus: 40, dietStaminaBonus: 15,\n  },\n  {\n    id: 'hunters_platter', name: 'Hunter\\'s Platter', description: 'An assortment of grilled wild meats. Premium tavern fare.',\n    category: 'food', sprite: 'sprites/items/food/hunters_platter.png',\n    maxStack: 99, sellPrice: 350, buyPrice: 875, rarity: 0,\n    healAmount: 100, staminaRestore: 80,\n    foodCategory: 'hearty', dietDuration: 360, dietHpBonus: 50, dietStaminaBonus: 20,\n  },\n  {\n    id: 'mushroom_risotto', name: 'Mushroom Risotto', description: 'Creamy risotto with wild forest mushrooms.',\n    category: 'food', sprite: 'sprites/items/food/mushroom_risotto.png',\n    maxStack: 99, sellPrice: 160, buyPrice: 400, rarity: 0,\n    healAmount: 55, staminaRestore: 35,\n    foodCategory: 'balanced', dietDuration: 270, dietHpBonus: 25, dietStaminaBonus: 20,\n  },\n  {\n    id: 'baked_potato', name: 'Loaded Baked Potato', description: 'A fluffy baked potato with all the toppings.',\n    category: 'food', sprite: 'sprites/items/food/baked_potato.png',\n    maxStack: 99, sellPrice: 90, buyPrice: 225, rarity: 0,\n    healAmount: 45, staminaRestore: 25,\n  },\n  {\n    id: 'corn_chowder', name: 'Corn Chowder', description: 'Creamy corn soup. Warming and delicious.',\n    category: 'food', sprite: 'sprites/items/food/corn_chowder.png',\n    maxStack: 99, sellPrice: 110, buyPrice: 275, rarity: 0,\n    healAmount: 50, staminaRestore: 30,\n  },\n  {\n    id: 'tomato_soup', name: 'Tomato Soup', description: 'Classic tomato soup with herbs.',\n    category: 'food', sprite: 'sprites/items/food/tomato_soup.png',\n    maxStack: 99, sellPrice: 85, buyPrice: 213, rarity: 0,\n    healAmount: 35, staminaRestore: 20,\n  },\n  {\n    id: 'grilled_fish', name: 'Grilled Fish', description: 'Simply grilled fish with lemon.',\n    category: 'food', sprite: 'sprites/items/food/grilled_fish.png',\n    maxStack: 99, sellPrice: 95, buyPrice: 238, rarity: 0,\n    healAmount: 45, staminaRestore: 30,\n  },\n  {\n    id: 'stuffed_peppers', name: 'Stuffed Peppers', description: 'Peppers stuffed with rice and meat.',\n    category: 'food', sprite: 'sprites/items/food/stuffed_peppers.png',\n    maxStack: 99, sellPrice: 140, buyPrice: 350, rarity: 0,\n    healAmount: 55, staminaRestore: 35,\n  },\n  {\n    id: 'ale', name: 'Ale', description: 'A refreshing mug of ale. Boosts courage.',\n    category: 'food', sprite: 'sprites/items/food/ale.png',\n    maxStack: 99, sellPrice: 50, buyPrice: 125, rarity: 0,\n    healAmount: 5, staminaRestore: 20,\n  },\n  {\n    id: 'mead', name: 'Honey Mead', description: 'Sweet honey wine. Traditional and warming.',\n    category: 'food', sprite: 'sprites/items/food/mead.png',\n    maxStack: 99, sellPrice: 100, buyPrice: 250, rarity: 0,\n    healAmount: 10, staminaRestore: 30,\n  },\n  {\n    id: 'wine', name: 'Red Wine', description: 'Fine wine aged in oak barrels.',\n    category: 'food', sprite: 'sprites/Food/food_item_0090.png',\n    maxStack: 99, sellPrice: 150, buyPrice: 375, rarity: 0,\n    healAmount: 5, staminaRestore: 25,\n  },\n  {\n    id: 'cider', name: 'Apple Cider', description: 'Fresh pressed apple cider.',\n    category: 'food', sprite: 'sprites/items/food/cider.png',\n    maxStack: 99, sellPrice: 75, buyPrice: 188, rarity: 0,\n    healAmount: 15, staminaRestore: 25,\n  },\n  {\n    id: 'hot_cocoa', name: 'Hot Cocoa', description: 'Rich hot chocolate. Perfect for cold nights.',\n    category: 'food', sprite: 'sprites/items/food/hot_cocoa.png',\n    maxStack: 99, sellPrice: 80, buyPrice: 200, rarity: 0,\n    healAmount: 20, staminaRestore: 35,\n  },\n  {\n    id: 'herbal_tea', name: 'Herbal Tea', description: 'Soothing tea made from wild herbs.',\n    category: 'food', sprite: 'sprites/items/food/herbal_tea.png',\n    maxStack: 99, sellPrice: 60, buyPrice: 150, rarity: 0,\n    healAmount: 5, staminaRestore: 40,\n    foodCategory: 'energizing', dietDuration: 240, dietHpBonus: 5, dietStaminaBonus: 30,\n  },\n  {\n    id: 'aged_ale', name: 'Aged Ale', description: 'Ale aged for 3 days. Smooth and complex.',\n    category: 'food', sprite: 'sprites/items/food/aged_ale.png',\n    maxStack: 99, sellPrice: 125, buyPrice: 313, rarity: 0,\n    healAmount: 10, staminaRestore: 40,\n  },\n  {\n    id: 'fine_wine', name: 'Fine Wine', description: 'Premium aged wine with deep flavors.',\n    category: 'food', sprite: 'sprites/items/food/fine_wine.png',\n    maxStack: 99, sellPrice: 450, buyPrice: 1125, rarity: 0,\n    healAmount: 10, staminaRestore: 50,\n  },\n  {\n    id: 'vintage_mead', name: 'Vintage Mead', description: 'Rare mead aged to perfection. A true delicacy.',\n    category: 'food', sprite: 'sprites/items/food/vintage_mead.png',\n    maxStack: 99, sellPrice: 400, buyPrice: 1000, rarity: 0,\n    healAmount: 15, staminaRestore: 60,\n  },\n  {\n    id: 'special_cider', name: 'Spiced Cider', description: 'Cider infused with warming spices.',\n    category: 'food', sprite: 'sprites/items/food/special_cider.png',\n    maxStack: 99, sellPrice: 150, buyPrice: 375, rarity: 0,\n    healAmount: 25, staminaRestore: 45,\n  },\n  {\n    id: 'fruit_tart', name: 'Fruit Tart', description: 'A delicate pastry with fresh fruits.',\n    category: 'food', sprite: 'sprites/items/food/fruit_tart.png',\n    maxStack: 99, sellPrice: 130, buyPrice: 325, rarity: 0,\n    healAmount: 40, staminaRestore: 30,\n  },\n  {\n    id: 'berry_pie', name: 'Berry Pie', description: 'Sweet pie filled with mixed berries.',\n    category: 'food', sprite: 'sprites/items/food/berry_pie.png',\n    maxStack: 99, sellPrice: 145, buyPrice: 363, rarity: 0,\n    healAmount: 50, staminaRestore: 35,\n  },\n  {\n    id: 'honey_cake', name: 'Honey Cake', description: 'Moist cake sweetened with pure honey.',\n    category: 'food', sprite: 'sprites/items/food/honey_cake.png',\n    maxStack: 99, sellPrice: 175, buyPrice: 438, rarity: 0,\n    healAmount: 45, staminaRestore: 40,\n  },\n  {\n    id: 'cheese_wheel', name: 'Aged Cheese', description: 'Properly aged cheese. Rich flavor.',\n    category: 'food', sprite: 'sprites/items/food/cheese_wheel.png',\n    maxStack: 99, sellPrice: 200, buyPrice: 500, rarity: 0,\n    healAmount: 35, staminaRestore: 20,\n  },\n  {\n    id: 'adventurers_meal', name: 'Adventurer\\'s Meal', description: 'A hearty meal that prepares you for anything.',\n    category: 'food', sprite: 'sprites/items/food/adventurers_meal.png',\n    maxStack: 99, sellPrice: 300, buyPrice: 750, rarity: 0,\n    healAmount: 90, staminaRestore: 70,\n    foodCategory: 'balanced', dietDuration: 360, dietHpBonus: 45, dietStaminaBonus: 20,\n  },\n  {\n    id: 'miners_special', name: 'Miner\\'s Special', description: 'Energy-rich meal for long mining sessions.',\n    category: 'food', sprite: 'sprites/items/food/miners_special.png',\n    maxStack: 99, sellPrice: 200, buyPrice: 500, rarity: 0,\n    healAmount: 75, staminaRestore: 100,\n    foodCategory: 'energizing', dietDuration: 300, dietHpBonus: 15, dietStaminaBonus: 50,\n  },\n  {\n    id: 'fishermans_breakfast', name: 'Fisherman\\'s Breakfast', description: 'Start your fishing day right.',\n    category: 'food', sprite: 'sprites/items/food/fishermans_breakfast.png',\n    maxStack: 99, sellPrice: 150, buyPrice: 375, rarity: 0,\n    healAmount: 60, staminaRestore: 50,\n    foodCategory: 'energizing', dietDuration: 300, dietHpBonus: 15, dietStaminaBonus: 30,\n  },\n  {\n    id: 'cooked_fish', name: 'Cooked Fish', description: 'Charred over an open flame until the flesh falls from the bone. Simple sustenance in dark times.',\n    category: 'food', sprite: 'sprites/items/food/cooked_fish.png',\n    maxStack: 99, sellPrice: 100, buyPrice: 250, rarity: 0,\n    healAmount: 40, staminaRestore: 25,\n    foodCategory: 'balanced', dietDuration: 240, dietHpBonus: 20, dietStaminaBonus: 15,\n  },\n  {\n    id: 'healing_salve', name: 'Healing Salve', description: 'A thick paste of herbs and rendered fat. It stings like fire but knits flesh together.',\n    category: 'food', sprite: 'sprites/items/food/healing_salve.png',\n    maxStack: 20, sellPrice: 80, buyPrice: 200, rarity: 0,\n    healAmount: 50, staminaRestore: 0,\n  },\n  {\n    id: 'ancient_wine_gold', name: 'Ancient Wine (Gold)', description: 'A bottle of wine aged for centuries in a sealed crypt. Its taste carries memories of a forgotten age.',\n    category: 'food', sprite: 'sprites/items/food/ancient_wine_gold.png',\n    maxStack: 99, sellPrice: 2000, buyPrice: 5000, rarity: 2,\n    healAmount: 30, staminaRestore: 80,\n    foodCategory: 'special', dietDuration: 300, dietHpBonus: 20, dietStaminaBonus: 40,\n  },\n  {\n    id: 'wild_plum', name: 'Wild Plum', description: 'A dark-skinned fruit with tart flesh. One of few sweet things left in this forsaken land.',\n    category: 'food', sprite: 'sprites/items/food/wild_plum.png',\n    maxStack: 99, sellPrice: 40, buyPrice: 100, rarity: 0,\n    healAmount: 20, staminaRestore: 10,\n  },\n  {\n    id: 'hazelnut', name: 'Hazelnut', description: 'A hard-shelled nut gathered from skeletal autumn trees. Cracks like tiny bones between your teeth.',\n    category: 'food', sprite: 'sprites/items/food/hazelnut.png',\n    maxStack: 99, sellPrice: 45, buyPrice: 113, rarity: 0,\n    healAmount: 15, staminaRestore: 10,\n  },\n  {\n    id: 'blackberry', name: 'Blackberry', description: 'Dark as dried blood, these thorny berries grow along forgotten paths through cursed brambles.',\n    category: 'food', sprite: 'sprites/items/food/blackberry.png',\n    maxStack: 99, sellPrice: 25, buyPrice: 63, rarity: 0,\n    healAmount: 15, staminaRestore: 10,\n  },\n  {\n    id: 'crystal_fruit', name: 'Crystal Fruit', description: 'A translucent fruit that grows on crystallized branches. It hums with trapped arcane energy.',\n    category: 'food', sprite: 'sprites/items/food/crystal_fruit.png',\n    maxStack: 99, sellPrice: 150, buyPrice: 375, rarity: 2,\n    healAmount: 25, staminaRestore: 20,\n  },\n  {\n    id: 'snow_yam', name: 'Snow Yam', description: 'A pale tuber buried beneath cursed snowdrifts. Its flesh stays cold even when cooked.',\n    category: 'food', sprite: 'sprites/items/food/snow_yam.png',\n    maxStack: 99, sellPrice: 100, buyPrice: 250, rarity: 0,\n    healAmount: 25, staminaRestore: 0,\n  },\n  {\n    id: 'cactus_fruit', name: 'Cactus Fruit', description: 'A spiny desert fruit filled with bitter juice. Quenches thirst in the wasteland sun.',\n    category: 'food', sprite: 'sprites/items/food/cactus_fruit.png',\n    maxStack: 99, sellPrice: 120, buyPrice: 300, rarity: 0,\n    healAmount: 35, staminaRestore: 15,\n  },\n  {\n    id: 'cave_carrot', name: 'Cave Carrot', description: 'An orange root pulled from lightless caverns. Glows faintly in the dark with bioluminescence.',\n    category: 'food', sprite: 'sprites/items/food/cave_carrot.png',\n    maxStack: 99, sellPrice: 60, buyPrice: 150, rarity: 0,\n    healAmount: 25, staminaRestore: 0,\n  },\n  {\n    id: 'cheese', name: 'Cheese', description: 'A wheel of cow\\'s milk cheese, aged to perfection. Sustains even in the darkest times.',\n    category: 'food', sprite: 'sprites/items/food/cheese.png',\n    maxStack: 99, sellPrice: 200, buyPrice: 500, rarity: 0,\n    healAmount: 35, staminaRestore: 25,\n  },\n  {\n    id: 'goat_cheese', name: 'Goat Cheese', description: 'Aged cheese with a sharp, tangy bite. A delicacy traded among desperate survivors.',\n    category: 'food', sprite: 'sprites/items/food/goat_cheese.png',\n    maxStack: 99, sellPrice: 250, buyPrice: 625, rarity: 0,\n    healAmount: 30, staminaRestore: 20,\n  },\n  {\n    id: 'truffle_oil', name: 'Truffle Oil', description: 'A luxurious oil pressed from rare underground truffles. Its aroma pierces even the foulest miasma.',\n    category: 'food', sprite: 'sprites/items/food/truffle_oil.png',\n    maxStack: 99, sellPrice: 500, buyPrice: 1250, rarity: 0,\n    healAmount: 15, staminaRestore: 30,\n  },\n  {\n    id: 'jelly', name: 'Jelly', description: 'Preserved fruit spread that wobbles like something alive. Tastes of forgotten orchards.',\n    category: 'food', sprite: 'sprites/items/food/jelly.png',\n    maxStack: 99, sellPrice: 80, buyPrice: 200, rarity: 0,\n    healAmount: 25, staminaRestore: 15,\n  },\n  {\n    id: 'apricot', name: 'Apricot', description: 'A golden fruit with velvety skin. Its sweetness is a fleeting mercy in the wasteland.',\n    category: 'food', sprite: 'sprites/items/food/apricot.png',\n    maxStack: 99, sellPrice: 50, buyPrice: 125, rarity: 0,\n    healAmount: 15, staminaRestore: 10,\n  },\n  {\n    id: 'orange', name: 'Orange', description: 'A vibrant citrus fruit that defies the gloom. Its juice stings cracked lips but restores vigor.',\n    category: 'food', sprite: 'sprites/items/food/orange.png',\n    maxStack: 99, sellPrice: 60, buyPrice: 150, rarity: 0,\n    healAmount: 20, staminaRestore: 15,\n  },\n  {\n    id: 'peach', name: 'Peach', description: 'A blushing fruit with tender flesh. A rare indulgence salvaged from abandoned orchards.',\n    category: 'food', sprite: 'sprites/items/food/peach.png',\n    maxStack: 99, sellPrice: 60, buyPrice: 150, rarity: 0,\n    healAmount: 20, staminaRestore: 15,\n  },\n  {\n    id: 'pomegranate', name: 'Pomegranate', description: 'A blood-red fruit filled with jewel-like seeds. Said to bind the souls of those who eat them.',\n    category: 'food', sprite: 'sprites/items/food/pomegranate.png',\n    maxStack: 99, sellPrice: 80, buyPrice: 200, rarity: 0,\n    healAmount: 25, staminaRestore: 20,\n  },\n  {\n    id: 'cherry', name: 'Cherry', description: 'A small, crimson fruit as red as fresh blood. Tart and dangerously addictive.',\n    category: 'food', sprite: 'sprites/items/food/cherry.png',\n    maxStack: 99, sellPrice: 50, buyPrice: 125, rarity: 0,\n    healAmount: 15, staminaRestore: 10,\n  },\n  {\n    id: 'autumn_bounty', name: 'Autumn Bounty', description: 'A feast cobbled from the last harvest. Rich flavors mask the dread of the coming winter.',\n    category: 'food', sprite: 'sprites/items/food/autumn_bounty.png',\n    maxStack: 99, sellPrice: 300, buyPrice: 750, rarity: 0,\n    healAmount: 50, staminaRestore: 40,\n  },\n  {\n    id: 'warp_totem_beach', name: 'Warp Totem: Beach', description: 'A carved totem that tears open a rift to the shore. The salt air tastes of freedom.',\n    category: 'food', sprite: 'sprites/items/food/warp_totem_beach.png',\n    maxStack: 20, sellPrice: 150, buyPrice: 375, rarity: 0,\n    healAmount: 0, staminaRestore: 30,\n  },\n  {\n    id: 'dish_o_the_sea', name: 'Dish o\\' The Sea', description: 'A hearty seafood stew made from the ocean\\'s bounty. Warms the soul against the abyss.',\n    category: 'food', sprite: 'sprites/items/food/dish_o_the_sea.png',\n    maxStack: 99, sellPrice: 200, buyPrice: 500, rarity: 0,\n    healAmount: 45, staminaRestore: 35,\n  },\n  {\n    id: 'chocolate_cake', name: 'Chocolate Cake', description: 'A decadent cake baked from hoarded cocoa. A taste of the old world\\'s indulgence.',\n    category: 'food', sprite: 'sprites/items/food/chocolate_cake.png',\n    maxStack: 99, sellPrice: 250, buyPrice: 625, rarity: 0,\n    healAmount: 40, staminaRestore: 50,\n  },\n  {\n    id: 'coffee', name: 'Coffee', description: 'A strong, dark brew that clears the fog of exhaustion. Essential for long nights in hostile territory.',\n    category: 'food', sprite: 'sprites/items/food/coffee.png',\n    maxStack: 99, sellPrice: 150, buyPrice: 375, rarity: 0,\n    healAmount: 5, staminaRestore: 50,\n  },\n  {\n    id: 'stardrop_tea', name: 'Stardrop Tea', description: 'A shimmering brew distilled from fallen starlight. One sip and your soul expands beyond mortal limits.',\n    category: 'food', sprite: 'sprites/items/food/stardrop_tea.png',\n    maxStack: 99, sellPrice: 5000, buyPrice: 12500, rarity: 0,\n    healAmount: 30, staminaRestore: 100,\n  },\n  {\n    id: 'magic_rock_candy', name: 'Magic Rock Candy', description: 'Crystallized sugar infused with raw arcane force. Your veins glow as the magic courses through.',\n    category: 'food', sprite: 'sprites/items/food/magic_rock_candy.png',\n    maxStack: 99, sellPrice: 3000, buyPrice: 7500, rarity: 0,\n    healAmount: 20, staminaRestore: 80,\n  },\n  {\n    id: 'golden_pumpkin', name: 'Golden Pumpkin', description: 'A pumpkin plated in pure gold. Whether cursed treasure or sacred relic, none can say.',\n    category: 'food', sprite: 'sprites/items/food/golden_pumpkin.png',\n    maxStack: 99, sellPrice: 2000, buyPrice: 5000, rarity: 1,\n    healAmount: 50, staminaRestore: 60,\n  },\n  {\n    id: 'haven_blessing', name: 'Haven Blessing', description: 'A consecrated elixir from the last standing temple. Mends flesh and spirit alike.',\n    category: 'food', sprite: 'sprites/items/food/haven_blessing.png',\n    maxStack: 99, sellPrice: 300, buyPrice: 750, rarity: 0,\n    healAmount: 50, staminaRestore: 50,\n    foodCategory: 'special', dietDuration: 300, dietHpBonus: 30, dietStaminaBonus: 30,\n  },\n  {\n    id: 'druids_blessing', name: 'Druid\\'s Blessing', description: 'A poultice brewed by the last druids. Nature\\'s final gift to a dying, forsaken world.',\n    category: 'food', sprite: 'sprites/items/food/druids_blessing.png',\n    maxStack: 99, sellPrice: 350, buyPrice: 875, rarity: 0,\n    healAmount: 40, staminaRestore: 60,\n  },\n  {\n    id: 'holy_water', name: 'Holy Water', description: 'Blessed water that sears the unholy. A single vial can turn the tide against the darkness.',\n    category: 'food', sprite: 'sprites/items/food/holy_water.png',\n    maxStack: 99, sellPrice: 200, buyPrice: 500, rarity: 0,\n    healAmount: 60, staminaRestore: 0,\n  },\n  {\n    id: 'cherry_blossom', name: 'Cherry Blossom', description: 'A fragile pink petal from a tree that blooms once a year. Its beauty is painfully brief.',\n    category: 'food', sprite: 'sprites/items/food/cherry_blossom.png',\n    maxStack: 99, sellPrice: 60, buyPrice: 150, rarity: 0,\n    healAmount: 10, staminaRestore: 15,\n  },\n  {\n    id: 'coconut', name: 'Coconut', description: 'A hard-shelled tropical fruit washed ashore from warmer, unblighted shores far away.',\n    category: 'food', sprite: 'sprites/items/food/coconut.png',\n    maxStack: 99, sellPrice: 80, buyPrice: 200, rarity: 0,\n    healAmount: 20, staminaRestore: 15,\n  },\n  {\n    id: 'maple_syrup_gold', name: 'Golden Maple Syrup', description: 'A rare amber syrup aged in enchanted barrels. Each drop is liquid gold and liquid hope.',\n    category: 'food', sprite: 'sprites/items/food/maple_syrup_gold.png',\n    maxStack: 99, sellPrice: 500, buyPrice: 1250, rarity: 1,\n    healAmount: 20, staminaRestore: 30,\n  },\n  {\n    id: 'birthday_cake', name: 'Birthday Cake', description: 'A lovingly baked cake. Celebrating survival is the greatest act of defiance against the dark.',\n    category: 'food', sprite: 'sprites/items/food/birthday_cake.png',\n    maxStack: 99, sellPrice: 200, buyPrice: 500, rarity: 0,\n    healAmount: 50, staminaRestore: 50,\n  },\n  {\n    id: 'cookie', name: 'Cookie', description: 'A small, crumbly biscuit baked from precious flour. Simple comfort in an uncomforting world.',\n    category: 'food', sprite: 'sprites/items/food/cookie.png',\n    maxStack: 99, sellPrice: 30, buyPrice: 75, rarity: 0,\n    healAmount: 15, staminaRestore: 20,\n  },\n];\n\n// ============ WEAPONS ============\nexport const WEAPONS: WeaponDef[] = [\n  {\n    id: 'sword', name: 'Rusty Sword', description: 'A basic sword for combat',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00001.png',\n    maxStack: 1, sellPrice: 50, buyPrice: 125, rarity: 0,\n    weaponType: WeaponType.Sword, damage: 10, attackSpeed: 1,\n    critChance: 0.05, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'dagger', name: 'Dagger', description: 'A small but quick blade. Fast attacks compensate for lower damage.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00010.png',\n    maxStack: 1, sellPrice: 35, buyPrice: 88, rarity: 0,\n    weaponType: WeaponType.Sword, damage: 8, attackSpeed: 1.5,\n    critChance: 0.05, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'shadow_blade', name: 'Shadow Blade', description: 'A blade forged from pure darkness. Strikes deal bonus shadow damage.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00050.png',\n    maxStack: 1, sellPrice: 8000, buyPrice: 20000, rarity: 0,\n    weaponType: WeaponType.Sword, damage: 45, attackSpeed: 1.3,\n    critChance: 0.05, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'empress_staff', name: 'Empress Staff', description: 'The staff of the Void Empress. Reality bends around its strikes.',\n    category: 'weapon', sprite: 'sprites/items/weapon/empress_staff.png',\n    maxStack: 1, sellPrice: 50000, buyPrice: 125000, rarity: 0,\n    weaponType: WeaponType.Staff, damage: 75, attackSpeed: 1,\n    critChance: 0.05, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'galaxy_sword', name: 'Galaxy Sword', description: 'A legendary blade forged from stardust and prismatic shards.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00100.png',\n    maxStack: 1, sellPrice: 35000, buyPrice: 87500, rarity: 5,\n    weaponType: WeaponType.Sword, damage: 60, attackSpeed: 1.2,\n    critChance: 0.05, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'battle_axe', name: 'Battle Axe', description: 'A heavy axe designed for combat. Slow but devastating.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00020.png',\n    maxStack: 1, sellPrice: 75, buyPrice: 188, rarity: 0,\n    weaponType: WeaponType.Axe, damage: 15, attackSpeed: 0.7,\n    critChance: 0.05, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'iron_spear', name: 'Iron Spear', description: 'A long spear with excellent reach. Keep enemies at bay.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00030.png',\n    maxStack: 1, sellPrice: 60, buyPrice: 150, rarity: 1,\n    weaponType: WeaponType.Spear, damage: 12, attackSpeed: 0.9,\n    critChance: 0.05, critMult: 1.5, range: 1.5,\n  },\n  {\n    id: 'hunting_bow', name: 'Hunting Bow', description: 'A sturdy bow for ranged combat. Requires arrows.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00040.png',\n    maxStack: 1, sellPrice: 100, buyPrice: 250, rarity: 0,\n    weaponType: WeaponType.Bow, damage: 8, attackSpeed: 0.8,\n    critChance: 0.05, critMult: 1.5, range: 3,\n  },\n  {\n    id: 'oak_staff', name: 'Oak Staff', description: 'A magical staff carved from ancient oak. Channels arcane power.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00060.png',\n    maxStack: 1, sellPrice: 80, buyPrice: 200, rarity: 0,\n    weaponType: WeaponType.Staff, damage: 10, attackSpeed: 1.1,\n    critChance: 0.05, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'iron_sword', name: 'Iron Sword', description: 'A well-forged iron blade. Reliable and sharp.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00002.png',\n    maxStack: 1, sellPrice: 150, buyPrice: 375, rarity: 1,\n    weaponType: WeaponType.Sword, damage: 15, attackSpeed: 1,\n    critChance: 0.05, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'steel_sword', name: 'Steel Sword', description: 'A finely crafted steel blade. Superior durability.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00003.png',\n    maxStack: 1, sellPrice: 400, buyPrice: 1000, rarity: 1,\n    weaponType: WeaponType.Sword, damage: 22, attackSpeed: 1,\n    critChance: 0.05, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'obsidian_blade', name: 'Obsidian Blade', description: 'A blade of volcanic glass. Razor sharp but brittle.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00004.png',\n    maxStack: 1, sellPrice: 800, buyPrice: 2000, rarity: 2,\n    weaponType: WeaponType.Sword, damage: 30, attackSpeed: 1.1,\n    critChance: 0.15, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'frost_edge', name: 'Frost Edge', description: 'A blade forged from eternal ice. +75% damage to frozen targets.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00005.png',\n    maxStack: 1, sellPrice: 1500, buyPrice: 3750, rarity: 2,\n    weaponType: WeaponType.Sword, damage: 35, attackSpeed: 0.95,\n    critChance: 0.05, critMult: 1.5, range: 1,\n    bonusVsStatus: 'freeze', synergyMult: 1.75,\n  },\n  {\n    id: 'infernal_blade', name: 'Infernal Blade', description: 'A blade wreathed in flames. +60% damage to burning targets.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00006.png',\n    maxStack: 1, sellPrice: 2000, buyPrice: 5000, rarity: 2,\n    weaponType: WeaponType.Sword, damage: 38, attackSpeed: 1,\n    critChance: 0.05, critMult: 1.5, range: 1,\n    bonusVsStatus: 'burn', synergyMult: 1.6,\n  },\n  {\n    id: 'soul_reaper', name: 'Soul Reaper', description: 'A cursed blade that feeds on souls. Heals on kill.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00007.png',\n    maxStack: 1, sellPrice: 5000, buyPrice: 12500, rarity: 3,\n    weaponType: WeaponType.Sword, damage: 45, attackSpeed: 1,\n    critChance: 0.05, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'iron_battle_axe', name: 'Iron Battle Axe', description: 'A heavy iron axe. Slow but powerful.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00021.png',\n    maxStack: 1, sellPrice: 200, buyPrice: 500, rarity: 1,\n    weaponType: WeaponType.Axe, damage: 20, attackSpeed: 0.7,\n    critChance: 0.05, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'steel_greataxe', name: 'Steel Greataxe', description: 'A massive two-handed axe. Devastating cleaves.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00022.png',\n    maxStack: 1, sellPrice: 500, buyPrice: 1250, rarity: 1,\n    weaponType: WeaponType.Axe, damage: 28, attackSpeed: 0.65,\n    critChance: 0.05, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'berserker_axe', name: 'Berserker Axe', description: 'An axe that grows stronger as you take damage.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00023.png',\n    maxStack: 1, sellPrice: 1200, buyPrice: 3000, rarity: 2,\n    weaponType: WeaponType.Axe, damage: 35, attackSpeed: 0.7,\n    critChance: 0.05, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'volcanic_cleaver', name: 'Volcanic Cleaver', description: 'An axe forged in magma. Ignites enemies on critical hits.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00024.png',\n    maxStack: 1, sellPrice: 2500, buyPrice: 6250, rarity: 2,\n    weaponType: WeaponType.Axe, damage: 42, attackSpeed: 0.65,\n    critChance: 0.2, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'executioners_axe', name: 'Executioner\\'s Axe', description: 'Deals massive damage. +100% damage to bleeding targets.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00025.png',\n    maxStack: 1, sellPrice: 6000, buyPrice: 15000, rarity: 3,\n    weaponType: WeaponType.Axe, damage: 50, attackSpeed: 0.6,\n    critChance: 0.05, critMult: 1.5, range: 1,\n    bonusVsStatus: 'bleed', synergyMult: 2.0,\n  },\n  {\n    id: 'wooden_spear', name: 'Wooden Spear', description: 'A simple wooden spear. Good reach for beginners.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00031.png',\n    maxStack: 1, sellPrice: 40, buyPrice: 100, rarity: 0,\n    weaponType: WeaponType.Spear, damage: 8, attackSpeed: 0.9,\n    critChance: 0.05, critMult: 1.5, range: 1.5,\n  },\n  {\n    id: 'steel_lance', name: 'Steel Lance', description: 'A long steel lance. Excellent reach.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00032.png',\n    maxStack: 1, sellPrice: 350, buyPrice: 875, rarity: 1,\n    weaponType: WeaponType.Spear, damage: 18, attackSpeed: 0.85,\n    critChance: 0.05, critMult: 1.5, range: 1.8,\n  },\n  {\n    id: 'serpent_spear', name: 'Serpent Spear', description: 'A poisoned spear. +80% damage to poisoned targets.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00033.png',\n    maxStack: 1, sellPrice: 900, buyPrice: 2250, rarity: 2,\n    weaponType: WeaponType.Spear, damage: 22, attackSpeed: 0.9,\n    critChance: 0.05, critMult: 1.5, range: 1.6,\n    bonusVsStatus: 'poison', synergyMult: 1.8,\n  },\n  {\n    id: 'glacial_pike', name: 'Glacial Pike', description: 'An ice-tipped pike. +70% damage to frozen targets.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00034.png',\n    maxStack: 1, sellPrice: 1800, buyPrice: 4500, rarity: 2,\n    weaponType: WeaponType.Spear, damage: 28, attackSpeed: 0.85,\n    critChance: 0.05, critMult: 1.5, range: 2,\n    bonusVsStatus: 'freeze', synergyMult: 1.7,\n  },\n  {\n    id: 'dragonslayer_lance', name: 'Dragonslayer Lance', description: 'A legendary lance made for slaying dragons.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00035.png',\n    maxStack: 1, sellPrice: 7000, buyPrice: 17500, rarity: 4,\n    weaponType: WeaponType.Spear, damage: 40, attackSpeed: 0.8,\n    critChance: 0.05, critMult: 1.5, range: 2.2,\n  },\n  {\n    id: 'short_bow', name: 'Short Bow', description: 'A small bow. Quick to draw but low range.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00041.png',\n    maxStack: 1, sellPrice: 60, buyPrice: 150, rarity: 0,\n    weaponType: WeaponType.Bow, damage: 6, attackSpeed: 1,\n    critChance: 0.05, critMult: 1.5, range: 2.5,\n  },\n  {\n    id: 'longbow', name: 'Longbow', description: 'A powerful longbow with excellent range.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00042.png',\n    maxStack: 1, sellPrice: 300, buyPrice: 750, rarity: 0,\n    weaponType: WeaponType.Bow, damage: 12, attackSpeed: 0.75,\n    critChance: 0.05, critMult: 1.5, range: 4,\n  },\n  {\n    id: 'composite_bow', name: 'Composite Bow', description: 'A bow made of layered materials. Powerful and accurate.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00043.png',\n    maxStack: 1, sellPrice: 750, buyPrice: 1875, rarity: 1,\n    weaponType: WeaponType.Bow, damage: 16, attackSpeed: 0.8,\n    critChance: 0.1, critMult: 1.5, range: 3.5,\n  },\n  {\n    id: 'elven_bow', name: 'Elven Bow', description: 'A graceful bow of elven make. Swift and deadly.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00044.png',\n    maxStack: 1, sellPrice: 2000, buyPrice: 5000, rarity: 2,\n    weaponType: WeaponType.Bow, damage: 20, attackSpeed: 0.9,\n    critChance: 0.15, critMult: 1.5, range: 4.5,\n  },\n  {\n    id: 'phoenix_bow', name: 'Phoenix Bow', description: 'A bow blessed by fire. +65% damage to burning targets.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00045.png',\n    maxStack: 1, sellPrice: 5500, buyPrice: 13750, rarity: 3,\n    weaponType: WeaponType.Bow, damage: 25, attackSpeed: 0.85,\n    critChance: 0.05, critMult: 1.5, range: 4,\n    bonusVsStatus: 'burn', synergyMult: 1.65,\n  },\n  {\n    id: 'apprentice_staff', name: 'Apprentice Staff', description: 'A simple staff for those learning magic.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00061.png',\n    maxStack: 1, sellPrice: 50, buyPrice: 125, rarity: 0,\n    weaponType: WeaponType.Staff, damage: 7, attackSpeed: 1.2,\n    critChance: 0.05, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'crystal_staff', name: 'Crystal Staff', description: 'A staff topped with a focusing crystal.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00062.png',\n    maxStack: 1, sellPrice: 400, buyPrice: 1000, rarity: 2,\n    weaponType: WeaponType.Staff, damage: 15, attackSpeed: 1.1,\n    critChance: 0.05, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'staff_of_frost', name: 'Staff of Frost', description: 'Channels ice magic. +70% damage to frozen targets.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00063.png',\n    maxStack: 1, sellPrice: 1200, buyPrice: 3000, rarity: 2,\n    weaponType: WeaponType.Staff, damage: 20, attackSpeed: 1,\n    critChance: 0.05, critMult: 1.5, range: 1,\n    bonusVsStatus: 'freeze', synergyMult: 1.7,\n  },\n  {\n    id: 'staff_of_flames', name: 'Staff of Flames', description: 'Burns with eternal fire. Ignites foes.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00064.png',\n    maxStack: 1, sellPrice: 1500, buyPrice: 3750, rarity: 0,\n    weaponType: WeaponType.Staff, damage: 25, attackSpeed: 1,\n    critChance: 0.05, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'necromancers_rod', name: 'Necromancer\\'s Rod', description: 'Drains life from enemies to heal the wielder.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00065.png',\n    maxStack: 1, sellPrice: 3500, buyPrice: 8750, rarity: 3,\n    weaponType: WeaponType.Staff, damage: 30, attackSpeed: 0.95,\n    critChance: 0.05, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'archmage_staff', name: 'Archmage Staff', description: 'The pinnacle of magical weaponry.',\n    category: 'weapon', sprite: 'sprites/Items/Weapons/item_weapon_00066.png',\n    maxStack: 1, sellPrice: 8000, buyPrice: 20000, rarity: 3,\n    weaponType: WeaponType.Staff, damage: 40, attackSpeed: 1.1,\n    critChance: 0.2, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'gold_sword', name: 'Gold Sword', description: 'A gilded blade that gleams with cursed opulence. Its edge hungers for blood more than glory.',\n    category: 'weapon', sprite: 'sprites/items/weapon/gold_sword.png',\n    maxStack: 1, sellPrice: 800, buyPrice: 2000, rarity: 1,\n    weaponType: WeaponType.Sword, damage: 28, attackSpeed: 1,\n    critChance: 0.05, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'bone_club', name: 'Bone Club', description: 'A brutal cudgel. +50% damage to stunned targets.',\n    category: 'weapon', sprite: 'sprites/items/weapon/bone_club.png',\n    maxStack: 1, sellPrice: 350, buyPrice: 875, rarity: 0,\n    weaponType: WeaponType.Hammer, damage: 18, attackSpeed: 0.8,\n    critChance: 0.05, critMult: 1.5, range: 1,\n    bonusVsStatus: 'stun', synergyMult: 1.5,\n  },\n  {\n    id: 'void_dagger', name: 'Void Dagger', description: 'A sliver of nothingness given form. It cuts not flesh but the threads of existence itself.',\n    category: 'weapon', sprite: 'sprites/items/weapon/void_dagger.png',\n    maxStack: 1, sellPrice: 2500, buyPrice: 6250, rarity: 2,\n    weaponType: WeaponType.Dagger, damage: 45, attackSpeed: 1.8,\n    critChance: 0.05, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'frost_spear', name: 'Frost Spear', description: 'Forged in the heart of an eternal blizzard. Frost creeps along its shaft, freezing the air around it.',\n    category: 'weapon', sprite: 'sprites/items/weapon/frost_spear.png',\n    maxStack: 1, sellPrice: 1800, buyPrice: 4500, rarity: 2,\n    weaponType: WeaponType.Spear, damage: 35, attackSpeed: 0.9,\n    critChance: 0.05, critMult: 1.5, range: 1.5,\n  },\n  {\n    id: 'iron_arrows', name: 'Iron Arrows', description: 'Arrows tipped with cold iron. They punch through hide and bone with merciless precision.',\n    category: 'weapon', sprite: 'sprites/items/weapon/iron_arrows.png',\n    maxStack: 99, sellPrice: 15, buyPrice: 38, rarity: 1,\n    weaponType: WeaponType.Bow, damage: 8, attackSpeed: 1,\n    critChance: 0.05, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'fire_arrows', name: 'Fire Arrows', description: 'Arrows wreathed in alchemical flame. They leave trails of cinder and screaming in their wake.',\n    category: 'weapon', sprite: 'sprites/items/weapon/fire_arrows.png',\n    maxStack: 99, sellPrice: 30, buyPrice: 75, rarity: 0,\n    weaponType: WeaponType.Bow, damage: 12, attackSpeed: 1,\n    critChance: 0.05, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'magic_staff', name: 'Magic Staff', description: 'A gnarled staff crackling with arcane force. Each strike channels raw magical devastation.',\n    category: 'weapon', sprite: 'sprites/items/weapon/magic_staff.png',\n    maxStack: 1, sellPrice: 1500, buyPrice: 3750, rarity: 0,\n    weaponType: WeaponType.Staff, damage: 30, attackSpeed: 1,\n    critChance: 0.05, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'legendary_sword', name: 'Legendary Sword', description: 'A blade spoken of only in whispers. It was forged in dragonfire and quenched in the tears of a god.',\n    category: 'weapon', sprite: 'sprites/items/weapon/legendary_sword.png',\n    maxStack: 1, sellPrice: 5000, buyPrice: 12500, rarity: 4,\n    weaponType: WeaponType.Sword, damage: 55, attackSpeed: 1.2,\n    critChance: 0.05, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'neptune_trident', name: 'Neptune\\'s Trident', description: 'The three-pronged spear of an ocean deity. Tidal fury surges through its coral-encrusted shaft.',\n    category: 'weapon', sprite: 'sprites/items/weapon/neptune_trident.png',\n    maxStack: 1, sellPrice: 8000, buyPrice: 20000, rarity: 3,\n    weaponType: WeaponType.Spear, damage: 50, attackSpeed: 1,\n    critChance: 0.05, critMult: 1.5, range: 1.5,\n  },\n  {\n    id: 'infinity_blade', name: 'Infinity Blade', description: 'A weapon that exists outside time. Its edge is the boundary between what is and what will never be.',\n    category: 'weapon', sprite: 'sprites/items/weapon/infinity_blade.png',\n    maxStack: 1, sellPrice: 15000, buyPrice: 37500, rarity: 5,\n    weaponType: WeaponType.Sword, damage: 75, attackSpeed: 1.3,\n    critChance: 0.05, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'dragonbane_sword', name: 'Dragonbane Sword', description: 'A blade tempered in dragon blood and blessed by dragonslayers of old. Wyrms recoil at its presence.',\n    category: 'weapon', sprite: 'sprites/items/weapon/dragonbane_sword.png',\n    maxStack: 1, sellPrice: 6000, buyPrice: 15000, rarity: 4,\n    weaponType: WeaponType.Sword, damage: 60, attackSpeed: 1.1,\n    critChance: 0.05, critMult: 1.5, range: 1,\n  },\n  {\n    id: 'veteran_blade', name: 'Veteran Blade', description: 'A battle-worn sword carried through a hundred sieges. Its edge remembers every kill.',\n    category: 'weapon', sprite: 'sprites/items/weapon/veteran_blade.png',\n    maxStack: 1, sellPrice: 1200, buyPrice: 3000, rarity: 0,\n    weaponType: WeaponType.Sword, damage: 35, attackSpeed: 1,\n    critChance: 0.05, critMult: 1.5, range: 1,\n  },\n];\n\n// ============ ARMOR ============\nexport const ARMOR: ArmorDef[] = [\n  {\n    id: 'leather_armor', name: 'Leather Armor', description: 'Basic protection made of tanned leather.',\n    category: 'armor', sprite: 'sprites/items/armor/leather_armor.png',\n    maxStack: 1, sellPrice: 100, buyPrice: 250, rarity: 0,\n    slot: 'chest', defense: 5, hp: 0, stamina: 0,\n  },\n  {\n    id: 'chainmail', name: 'Chainmail Armor', description: 'Interlocking metal rings provide good protection.',\n    category: 'armor', sprite: 'sprites/items/armor/chainmail.png',\n    maxStack: 1, sellPrice: 500, buyPrice: 1250, rarity: 0,\n    slot: 'chest', defense: 12, hp: 0, stamina: 0,\n  },\n  {\n    id: 'plate_armor', name: 'Plate Armor', description: 'Heavy steel plates. Maximum protection.',\n    category: 'armor', sprite: 'sprites/items/armor/plate_armor.png',\n    maxStack: 1, sellPrice: 1500, buyPrice: 3750, rarity: 0,\n    slot: 'chest', defense: 25, hp: 0, stamina: 0,\n  },\n  {\n    id: 'shadow_cloak', name: 'Shadow Cloak', description: 'A cloak woven from shadows. Light protection but enhances stealth.',\n    category: 'armor', sprite: 'sprites/items/armor/shadow_cloak.png',\n    maxStack: 1, sellPrice: 2000, buyPrice: 5000, rarity: 0,\n    slot: 'chest', defense: 8, hp: 0, stamina: 0,\n  },\n  {\n    id: 'dragon_scale_armor', name: 'Dragon Scale Armor', description: 'Armor made from dragon scales. Fire resistant.',\n    category: 'armor', sprite: 'sprites/items/armor/dragon_scale_armor.png',\n    maxStack: 1, sellPrice: 10000, buyPrice: 25000, rarity: 3,\n    slot: 'chest', defense: 35, hp: 0, stamina: 0,\n  },\n  {\n    id: 'leather_cap', name: 'Leather Cap', description: 'A simple leather cap.',\n    category: 'armor', sprite: 'sprites/items/armor/leather_cap.png',\n    maxStack: 1, sellPrice: 50, buyPrice: 125, rarity: 0,\n    slot: 'head', defense: 2, hp: 0, stamina: 0,\n  },\n  {\n    id: 'iron_helm', name: 'Iron Helm', description: 'A sturdy iron helmet.',\n    category: 'armor', sprite: 'sprites/items/armor/iron_helm.png',\n    maxStack: 1, sellPrice: 300, buyPrice: 750, rarity: 1,\n    slot: 'head', defense: 6, hp: 0, stamina: 0,\n  },\n  {\n    id: 'crown_of_thorns', name: 'Crown of Thorns', description: 'A painful crown that reflects damage to attackers.',\n    category: 'armor', sprite: 'sprites/items/armor/crown_of_thorns.png',\n    maxStack: 1, sellPrice: 3000, buyPrice: 7500, rarity: 0,\n    slot: 'head', defense: 4, hp: 0, stamina: 0,\n  },\n  {\n    id: 'iron_ring', name: 'Iron Ring', description: 'A simple iron ring. +2 defense. (1 notch)',\n    category: 'armor', sprite: 'sprites/items/accessory/iron_ring.png',\n    maxStack: 1, sellPrice: 100, buyPrice: 250, rarity: 0,\n    slot: 'ring', defense: 2, hp: 0, stamina: 0, notchCost: 1,\n  },\n  {\n    id: 'ruby_ring', name: 'Ruby Ring', description: 'A ring set with a ruby. +5 damage but −2 defense. (1 notch)',\n    category: 'armor', sprite: 'sprites/items/accessory/ruby_ring.png',\n    maxStack: 1, sellPrice: 500, buyPrice: 1250, rarity: 0,\n    slot: 'ring', defense: 0, hp: 0, stamina: 0, damage: 5, notchCost: 1,\n    tradeoff: '-2 defense', tradeoffStat: 'defense', tradeoffAmount: 2,\n  },\n  {\n    id: 'sapphire_ring', name: 'Sapphire Ring', description: 'A ring set with sapphire. +20 stamina. (1 notch)',\n    category: 'armor', sprite: 'sprites/items/accessory/sapphire_ring.png',\n    maxStack: 1, sellPrice: 500, buyPrice: 1250, rarity: 0,\n    slot: 'ring', defense: 0, hp: 0, stamina: 20, notchCost: 1,\n  },\n  {\n    id: 'ring_of_vitality', name: 'Ring of Vitality', description: '+25 HP but −10 stamina. (2 notches)',\n    category: 'armor', sprite: 'sprites/items/accessory/ring_of_vitality.png',\n    maxStack: 1, sellPrice: 1000, buyPrice: 2500, rarity: 0,\n    slot: 'ring', defense: 0, hp: 25, stamina: 0, notchCost: 2,\n    tradeoff: '-10 stamina', tradeoffStat: 'stamina', tradeoffAmount: 10,\n  },\n  {\n    id: 'ring_of_hunger', name: 'Ring of Hunger', description: '+3 damage, +0.05 attack speed. Costs life force. (2 notches)',\n    category: 'armor', sprite: 'sprites/items/accessory/ring_of_hunger.png',\n    maxStack: 1, sellPrice: 800, buyPrice: 2000, rarity: 0,\n    slot: 'ring', defense: 0, hp: 0, stamina: 0, damage: 3, attackSpeed: 0.05, notchCost: 2,\n    tradeoff: '-15 hp', tradeoffStat: 'hp', tradeoffAmount: 15,\n  },\n  {\n    id: 'lucky_pendant', name: 'Lucky Pendant', description: '+8% crit chance. (2 notches)',\n    category: 'armor', sprite: 'sprites/items/accessory/lucky_pendant.png',\n    maxStack: 1, sellPrice: 750, buyPrice: 1875, rarity: 0,\n    slot: 'necklace', defense: 0, hp: 0, stamina: 0, critChance: 0.08, notchCost: 2,\n  },\n  {\n    id: 'amulet_of_protection', name: 'Amulet of Protection', description: '+8 defense, +15 HP. (2 notches)',\n    category: 'armor', sprite: 'sprites/items/accessory/amulet_of_protection.png',\n    maxStack: 1, sellPrice: 1500, buyPrice: 3750, rarity: 0,\n    slot: 'necklace', defense: 8, hp: 15, stamina: 0, notchCost: 2,\n  },\n  {\n    id: 'vampiric_pendant', name: 'Vampiric Pendant', description: '+8 damage, +0.3 crit mult but −5 defense. (3 notches)',\n    category: 'armor', sprite: 'sprites/items/accessory/vampiric_pendant.png',\n    maxStack: 1, sellPrice: 3000, buyPrice: 7500, rarity: 0,\n    slot: 'necklace', defense: 0, hp: 0, stamina: 0, damage: 8, critMult: 0.3, notchCost: 3,\n    tradeoff: '-5 defense', tradeoffStat: 'defense', tradeoffAmount: 5,\n  },\n  {\n    id: 'iron_armor', name: 'Iron Armor', description: 'Hammered iron plates scored with warding runes. The metal groans under the weight of old curses.',\n    category: 'armor', sprite: 'sprites/items/armor/iron_armor.png',\n    maxStack: 1, sellPrice: 600, buyPrice: 1500, rarity: 1,\n    slot: 'chest', defense: 12, hp: 0, stamina: 0,\n  },\n  {\n    id: 'bone_shield', name: 'Bone Shield', description: 'A shield woven from the ribcage of a nameless beast. It rattles with each blow it absorbs.',\n    category: 'armor', sprite: 'sprites/items/armor/bone_shield.png',\n    maxStack: 1, sellPrice: 450, buyPrice: 1125, rarity: 0,\n    slot: 'shield', defense: 8, hp: 0, stamina: 0,\n  },\n  {\n    id: 'wyrm_plate', name: 'Wyrm Plate', description: 'Scales of a slain wyrm hammered into unyielding plate. It smells of brimstone and ancient wrath.',\n    category: 'armor', sprite: 'sprites/items/armor/wyrm_plate.png',\n    maxStack: 1, sellPrice: 5000, buyPrice: 12500, rarity: 2,\n    slot: 'chest', defense: 25, hp: 0, stamina: 0,\n  },\n  {\n    id: 'nightvision_goggles', name: 'Nightvision Goggles', description: 'Enchanted lenses that pierce the veil of darkness. The shadows have nowhere left to hide.',\n    category: 'armor', sprite: 'sprites/items/equipment/nightvision_goggles.png',\n    maxStack: 1, sellPrice: 1000, buyPrice: 2500, rarity: 0,\n    slot: 'head', defense: 0, hp: 0, stamina: 0,\n  },\n  {\n    id: 'void_amulet', name: 'Void Amulet', description: '+12 damage, +0.1 crit chance but −8 defense, −20 HP. The void hungers. (3 notches)',\n    category: 'armor', sprite: 'sprites/items/accessory/void_amulet.png',\n    maxStack: 1, sellPrice: 3000, buyPrice: 7500, rarity: 2,\n    slot: 'necklace', defense: 0, hp: 0, stamina: 0, damage: 12, critChance: 0.1, notchCost: 3,\n    tradeoff: '-8 defense, -20 hp', tradeoffStat: 'defense', tradeoffAmount: 8,\n  },\n  {\n    id: 'void_talisman', name: 'Void Talisman', description: '+6 defense, +30 stamina. Shadows ward you. (2 notches)',\n    category: 'armor', sprite: 'sprites/items/accessory/void_talisman.png',\n    maxStack: 1, sellPrice: 2500, buyPrice: 6250, rarity: 2,\n    slot: 'necklace', defense: 6, hp: 0, stamina: 30, notchCost: 2,\n  },\n  {\n    id: 'dragon_armor', name: 'Dragon Armor', description: 'Forged from the scales of an elder dragon. It radiates heat and ancient malice.',\n    category: 'armor', sprite: 'sprites/items/armor/dragon_armor.png',\n    maxStack: 1, sellPrice: 10000, buyPrice: 25000, rarity: 3,\n    slot: 'chest', defense: 40, hp: 0, stamina: 0,\n  },\n  {\n    id: 'prismatic_ring', name: 'Prismatic Ring', description: '+10 damage, +0.15 crit, +0.5 crit mult. The ultimate ring. (3 notches)',\n    category: 'armor', sprite: 'sprites/items/accessory/prismatic_ring.png',\n    maxStack: 1, sellPrice: 5000, buyPrice: 12500, rarity: 4,\n    slot: 'ring', defense: 3, hp: 15, stamina: 10, damage: 10, critChance: 0.15, critMult: 0.5, notchCost: 3,\n  },\n  {\n    id: 'celestial_orb', name: 'Celestial Orb', description: '+15 damage, +50 HP, +0.2 crit, +0.1 atk spd. A dying star\\'s blessing. (3 notches)',\n    category: 'armor', sprite: 'sprites/items/accessory/celestial_orb.png',\n    maxStack: 1, sellPrice: 8000, buyPrice: 20000, rarity: 5,\n    slot: 'necklace', defense: 5, hp: 50, stamina: 25, damage: 15, critChance: 0.2, attackSpeed: 0.1, notchCost: 3,\n  },\n  {\n    id: 'straw_hat', name: 'Straw Hat', description: 'A simple hat woven from dried grass. It offers little protection but shields you from the blinding sun.',\n    category: 'armor', sprite: 'sprites/items/equipment/straw_hat.png',\n    maxStack: 1, sellPrice: 200, buyPrice: 500, rarity: 0,\n    slot: 'head', defense: 0, hp: 0, stamina: 0,\n  },\n  {\n    id: 'sailor_cap', name: 'Sailor Cap', description: 'A weathered cap from a mariner who sailed waters best left uncharted. Salt-stained and faded.',\n    category: 'armor', sprite: 'sprites/items/equipment/sailor_cap.png',\n    maxStack: 1, sellPrice: 200, buyPrice: 500, rarity: 0,\n    slot: 'head', defense: 0, hp: 0, stamina: 0,\n  },\n  {\n    id: 'small_magnet_ring', name: 'Small Magnet Ring', description: '+0.1 attack speed, +10 stamina. Items gravitate toward you. (1 notch)',\n    category: 'armor', sprite: 'sprites/items/accessory/small_magnet_ring.png',\n    maxStack: 1, sellPrice: 400, buyPrice: 1000, rarity: 0,\n    slot: 'ring', defense: 0, hp: 0, stamina: 10, attackSpeed: 0.1, notchCost: 1,\n  },\n  {\n    id: 'pearl_necklace', name: 'Pearl Necklace', description: '+4 defense, +20 HP, +15 stamina. Sea spirits protect you. (2 notches)',\n    category: 'armor', sprite: 'sprites/items/accessory/pearl_necklace.png',\n    maxStack: 1, sellPrice: 2000, buyPrice: 5000, rarity: 0,\n    slot: 'necklace', defense: 4, hp: 20, stamina: 15, notchCost: 2,\n  },\n];\n\n// ============ FISH ============\nexport const FISH: FishDef[] = [\n  {\n    id: 'pufferfish', name: 'Pufferfish', description: 'Handle with care - can be toxic!',\n    category: 'fish', sprite: 'sprites/items/food/pufferfish.png',\n    maxStack: 99, sellPrice: 200, buyPrice: 500, rarity: 0,\n    difficulty: 40, minSize: 10, maxSize: 25,\n    seasons: ['spring', 'summer', 'fall', 'winter'], timeOfDay: ['morning', 'afternoon', 'evening'], locations: ['river', 'ocean'],\n  },\n  {\n    id: 'legend', name: 'The Legend', description: 'A mythical fish of immense power.',\n    category: 'fish', sprite: 'sprites/items/food/legend.png',\n    maxStack: 99, sellPrice: 5000, buyPrice: 12500, rarity: 4,\n    difficulty: 100, minSize: 250, maxSize: 625,\n    seasons: ['spring', 'summer', 'fall', 'winter'], timeOfDay: ['morning', 'afternoon', 'evening'], locations: ['river', 'ocean'],\n  },\n  {\n    id: 'crimsonfish', name: 'Crimsonfish', description: 'A fiery red legendary fish.',\n    category: 'fish', sprite: 'sprites/items/food/crimsonfish.png',\n    maxStack: 99, sellPrice: 4500, buyPrice: 11250, rarity: 2,\n    difficulty: 100, minSize: 225, maxSize: 563,\n    seasons: ['spring', 'summer', 'fall', 'winter'], timeOfDay: ['morning', 'afternoon', 'evening'], locations: ['river', 'ocean'],\n  },\n  {\n    id: 'glacierfish', name: 'Glacierfish', description: 'An icy blue legendary fish.',\n    category: 'fish', sprite: 'sprites/items/food/glacierfish.png',\n    maxStack: 99, sellPrice: 4000, buyPrice: 10000, rarity: 2,\n    difficulty: 100, minSize: 200, maxSize: 500,\n    seasons: ['spring', 'summer', 'fall', 'winter'], timeOfDay: ['morning', 'afternoon', 'evening'], locations: ['river', 'ocean'],\n  },\n  {\n    id: 'angler', name: 'Angler', description: 'A legendary fish of impossible size. Its bioluminescent lure glows with an otherworldly light.',\n    category: 'fish', sprite: 'sprites/items/food/angler.png',\n    maxStack: 1, sellPrice: 1500, buyPrice: 3750, rarity: 0,\n    difficulty: 80, minSize: 75, maxSize: 188,\n    seasons: ['spring', 'summer', 'fall', 'winter'], timeOfDay: ['morning', 'afternoon', 'evening'], locations: ['river', 'ocean'],\n  },\n  {\n    id: 'mutant_carp', name: 'Mutant Carp', description: 'A grotesque fish warped by toxic waters. Extra eyes stare blankly from its malformed body.',\n    category: 'fish', sprite: 'sprites/items/food/mutant_carp.png',\n    maxStack: 1, sellPrice: 1000, buyPrice: 2500, rarity: 0,\n    difficulty: 60, minSize: 50, maxSize: 125,\n    seasons: ['spring', 'summer', 'fall', 'winter'], timeOfDay: ['morning', 'afternoon', 'evening'], locations: ['river', 'ocean'],\n  },\n  {\n    id: 'largemouth_bass', name: 'Largemouth Bass', description: 'A thick-bodied fish pulled from murky, stagnant waters. Best not eaten raw.',\n    category: 'fish', sprite: 'sprites/items/food/largemouth_bass.png',\n    maxStack: 99, sellPrice: 60, buyPrice: 150, rarity: 0,\n    difficulty: 25, minSize: 5, maxSize: 13,\n    seasons: ['spring', 'summer', 'fall', 'winter'], timeOfDay: ['morning', 'afternoon', 'evening'], locations: ['river', 'ocean'],\n  },\n  {\n    id: 'shad', name: 'Shad', description: 'A silvery river fish that swims against cursed currents. Bony but abundant.',\n    category: 'fish', sprite: 'sprites/items/food/shad.png',\n    maxStack: 99, sellPrice: 45, buyPrice: 113, rarity: 0,\n    difficulty: 15, minSize: 5, maxSize: 13,\n    seasons: ['spring', 'summer', 'fall', 'winter'], timeOfDay: ['morning', 'afternoon', 'evening'], locations: ['river', 'ocean'],\n  },\n  {\n    id: 'tiger_trout', name: 'Tiger Trout', description: 'A rare hybrid with striking stripes. Born of unnatural waters, it fights like a demon on the line.',\n    category: 'fish', sprite: 'sprites/items/food/tiger_trout.png',\n    maxStack: 99, sellPrice: 100, buyPrice: 250, rarity: 0,\n    difficulty: 25, minSize: 5, maxSize: 13,\n    seasons: ['spring', 'summer', 'fall', 'winter'], timeOfDay: ['morning', 'afternoon', 'evening'], locations: ['river', 'ocean'],\n  },\n  {\n    id: 'bullhead', name: 'Bullhead', description: 'A bottom-dwelling fish with a flat head and venomous spines. Handle with extreme care.',\n    category: 'fish', sprite: 'sprites/items/food/bullhead.png',\n    maxStack: 99, sellPrice: 50, buyPrice: 125, rarity: 0,\n    difficulty: 15, minSize: 5, maxSize: 13,\n    seasons: ['spring', 'summer', 'fall', 'winter'], timeOfDay: ['morning', 'afternoon', 'evening'], locations: ['river', 'ocean'],\n  },\n  {\n    id: 'tuna', name: 'Tuna', description: 'A powerful ocean fish that roams the deep. Its dense flesh is rich with dark iron.',\n    category: 'fish', sprite: 'sprites/items/food/tuna.png',\n    maxStack: 99, sellPrice: 120, buyPrice: 300, rarity: 0,\n    difficulty: 40, minSize: 6, maxSize: 15,\n    seasons: ['spring', 'summer', 'fall', 'winter'], timeOfDay: ['morning', 'afternoon', 'evening'], locations: ['river', 'ocean'],\n  },\n  {\n    id: 'red_snapper', name: 'Red Snapper', description: 'A crimson fish with sharp teeth. Caught in blood-warm shallows near volcanic vents.',\n    category: 'fish', sprite: 'sprites/items/food/red_snapper.png',\n    maxStack: 99, sellPrice: 80, buyPrice: 200, rarity: 0,\n    difficulty: 25, minSize: 5, maxSize: 13,\n    seasons: ['spring', 'summer', 'fall', 'winter'], timeOfDay: ['morning', 'afternoon', 'evening'], locations: ['river', 'ocean'],\n  },\n  {\n    id: 'tilapia', name: 'Tilapia', description: 'A hardy fish that survives in the most polluted waters. Tastes like mud and regret.',\n    category: 'fish', sprite: 'sprites/items/food/tilapia.png',\n    maxStack: 99, sellPrice: 60, buyPrice: 150, rarity: 0,\n    difficulty: 25, minSize: 5, maxSize: 13,\n    seasons: ['spring', 'summer', 'fall', 'winter'], timeOfDay: ['morning', 'afternoon', 'evening'], locations: ['river', 'ocean'],\n  },\n  {\n    id: 'ghostfish', name: 'Ghostfish', description: 'A translucent fish that glows with spectral light. Found in underground lakes of the dead.',\n    category: 'fish', sprite: 'sprites/items/food/ghostfish.png',\n    maxStack: 99, sellPrice: 75, buyPrice: 188, rarity: 0,\n    difficulty: 25, minSize: 5, maxSize: 13,\n    seasons: ['spring', 'summer', 'fall', 'winter'], timeOfDay: ['morning', 'afternoon', 'evening'], locations: ['river', 'ocean'],\n  },\n  {\n    id: 'sandfish', name: 'Sandfish', description: 'A burrowing desert fish that swims through sand like water. Its scales are like coarse glass.',\n    category: 'fish', sprite: 'sprites/items/food/sandfish.png',\n    maxStack: 99, sellPrice: 90, buyPrice: 225, rarity: 0,\n    difficulty: 25, minSize: 5, maxSize: 13,\n    seasons: ['spring', 'summer', 'fall', 'winter'], timeOfDay: ['morning', 'afternoon', 'evening'], locations: ['river', 'ocean'],\n  },\n  {\n    id: 'woodskip', name: 'Woodskip', description: 'A secretive forest fish found only in enchanted pools. Its flesh tastes of pine and sorrow.',\n    category: 'fish', sprite: 'sprites/items/food/woodskip.png',\n    maxStack: 99, sellPrice: 65, buyPrice: 163, rarity: 0,\n    difficulty: 25, minSize: 5, maxSize: 13,\n    seasons: ['spring', 'summer', 'fall', 'winter'], timeOfDay: ['morning', 'afternoon', 'evening'], locations: ['river', 'ocean'],\n  },\n  {\n    id: 'exotic_fish', name: 'Exotic Fish', description: 'A bizarre fish from waters beyond the known world. Its scales shimmer with impossible colors.',\n    category: 'fish', sprite: 'sprites/items/food/exotic_fish.png',\n    maxStack: 99, sellPrice: 400, buyPrice: 1000, rarity: 0,\n    difficulty: 60, minSize: 20, maxSize: 50,\n    seasons: ['spring', 'summer', 'fall', 'winter'], timeOfDay: ['morning', 'afternoon', 'evening'], locations: ['river', 'ocean'],\n  },\n];\n\n// ============ POTIONS ============\nexport const POTIONS: PotionDef[] = [\n  {\n    id: 'health_potion', name: 'Health Potion', description: 'Restores 50 health instantly.',\n    category: 'potion', sprite: 'sprites/items/food/health_potion.png',\n    maxStack: 99, sellPrice: 100, buyPrice: 250, rarity: 0,\n    effectType: 'heal', effectDuration: 0, effectMagnitude: 50,\n  },\n  {\n    id: 'stamina_potion', name: 'Stamina Potion', description: 'Restores 75 stamina instantly.',\n    category: 'potion', sprite: 'sprites/items/food/stamina_potion.png',\n    maxStack: 99, sellPrice: 100, buyPrice: 250, rarity: 0,\n    effectType: 'stamina', effectDuration: 0, effectMagnitude: 75,\n  },\n  {\n    id: 'greater_health_potion', name: 'Greater Health Potion', description: 'A deep crimson draught brewed from bloodroot and grave moss. Mends even grievous wounds.',\n    category: 'potion', sprite: 'sprites/items/food/greater_health_potion.png',\n    maxStack: 20, sellPrice: 300, buyPrice: 750, rarity: 0,\n    effectType: 'heal', effectDuration: 0, effectMagnitude: 100,\n  },\n  {\n    id: 'greater_stamina_potion', name: 'Greater Stamina Potion', description: 'A vivid green elixir that floods the body with desperate vitality. The crash comes later.',\n    category: 'potion', sprite: 'sprites/items/food/greater_stamina_potion.png',\n    maxStack: 20, sellPrice: 300, buyPrice: 750, rarity: 0,\n    effectType: 'stamina', effectDuration: 0, effectMagnitude: 120,\n  },\n  {\n    id: 'frost_resistance_potion', name: 'Frost Resistance Potion', description: 'A shimmering blue tonic that coats the veins in warmth. The cold becomes a distant memory.',\n    category: 'potion', sprite: 'sprites/items/food/frost_resistance_potion.png',\n    maxStack: 20, sellPrice: 250, buyPrice: 625, rarity: 2,\n    effectType: 'frost_resistance', effectDuration: 300, effectMagnitude: 1,\n  },\n  {\n    id: 'venom_antidote', name: 'Venom Antidote', description: 'A bitter concoction that burns the poison from your blood. The cure is almost worse than the bite.',\n    category: 'potion', sprite: 'sprites/items/food/venom_antidote.png',\n    maxStack: 20, sellPrice: 200, buyPrice: 500, rarity: 0,\n    effectType: 'cure_poison', effectDuration: 0, effectMagnitude: 1,\n  },\n  {\n    id: 'berserker_elixir', name: 'Berserker Elixir', description: 'Distilled rage in a bottle. Your muscles scream and your vision narrows to nothing but the kill.',\n    category: 'potion', sprite: 'sprites/items/food/berserker_elixir.png',\n    maxStack: 20, sellPrice: 400, buyPrice: 1000, rarity: 2,\n    effectType: 'damage_boost', effectDuration: 180, effectMagnitude: 1.5,\n  },\n  {\n    id: 'ironhide_tonic', name: 'Ironhide Tonic', description: 'A metallic brew that hardens the skin to the consistency of boiled leather. Every movement aches.',\n    category: 'potion', sprite: 'sprites/items/food/ironhide_tonic.png',\n    maxStack: 20, sellPrice: 350, buyPrice: 875, rarity: 1,\n    effectType: 'defense_boost', effectDuration: 180, effectMagnitude: 1.5,\n  },\n  {\n    id: 'nightsight_potion', name: 'Nightsight Potion', description: 'Brewed from the eyes of cave-dwelling creatures. The darkness opens up like a wound.',\n    category: 'potion', sprite: 'sprites/items/food/nightsight_potion.png',\n    maxStack: 20, sellPrice: 200, buyPrice: 500, rarity: 0,\n    effectType: 'night_vision', effectDuration: 300, effectMagnitude: 1,\n  },\n  {\n    id: 'swiftness_potion', name: 'Swiftness Potion', description: 'A pale silver liquid that quickens the blood. The world slows while you become a blur.',\n    category: 'potion', sprite: 'sprites/items/food/swiftness_potion.png',\n    maxStack: 20, sellPrice: 250, buyPrice: 625, rarity: 0,\n    effectType: 'speed_boost', effectDuration: 180, effectMagnitude: 1.5,\n  },\n  {\n    id: 'spirit_ward', name: 'Spirit Ward', description: 'Holy water blessed by a forgotten saint. It sears the ethereal and mends the living.',\n    category: 'potion', sprite: 'sprites/items/food/spirit_ward.png',\n    maxStack: 20, sellPrice: 500, buyPrice: 1250, rarity: 0,\n    effectType: 'spirit_ward', effectDuration: 300, effectMagnitude: 1,\n  },\n  {\n    id: 'prismatic_elixir', name: 'Prismatic Elixir', description: 'A swirling rainbow draught that tastes of starlight and madness. Every cell in your body ignites.',\n    category: 'potion', sprite: 'sprites/items/food/prismatic_elixir.png',\n    maxStack: 20, sellPrice: 2000, buyPrice: 5000, rarity: 4,\n    effectType: 'all_stats', effectDuration: 300, effectMagnitude: 1.5,\n  },\n  {\n    id: 'galaxy_tincture', name: 'Galaxy Tincture', description: 'Liquid cosmos distilled from the void between stars. To drink it is to be unmade and reborn.',\n    category: 'potion', sprite: 'sprites/items/food/galaxy_tincture.png',\n    maxStack: 20, sellPrice: 5000, buyPrice: 12500, rarity: 5,\n    effectType: 'all_stats', effectDuration: 600, effectMagnitude: 2,\n  },\n];\n\n// ============ QUEST ITEMS ============\nexport const QUEST_ITEMS: ItemDef[] = [\n  {\n    id: 'seal_of_earth', name: 'Seal of Earth', description: 'An ancient seal inscribed with earth runes. One of three seals your grandmother placed to contain the corruption. It pulses with dormant power.',\n    category: 'quest', sprite: 'sprites/items/misc/seal_of_earth.png',\n    maxStack: 1, sellPrice: 0, buyPrice: 0, rarity: 0,\n  },\n  {\n    id: 'seal_of_water', name: 'Seal of Water', description: 'An ancient seal inscribed with water runes. One of three seals your grandmother placed to contain the corruption. It shimmers with ancient magic.',\n    category: 'quest', sprite: 'sprites/items/misc/seal_of_water.png',\n    maxStack: 1, sellPrice: 0, buyPrice: 0, rarity: 0,\n  },\n  {\n    id: 'seal_of_spirit', name: 'Seal of Spirit', description: 'An ancient seal inscribed with spirit runes. The final seal your grandmother placed. It glows with ethereal light, yearning to fulfill its purpose.',\n    category: 'quest', sprite: 'sprites/items/misc/seal_of_spirit.png',\n    maxStack: 1, sellPrice: 0, buyPrice: 0, rarity: 0,\n  },\n  {\n    id: 'edilas_key', name: 'EDILAS Key', description: 'A golden key forged from the five biome artifacts. Opens the path to EDILAS.',\n    category: 'quest', sprite: 'sprites/items/material/edilas_key.png',\n    maxStack: 1, sellPrice: 0, buyPrice: 0, rarity: 4,\n  },\n  {\n    id: 'journal_fragment', name: 'Journal Fragment', description: 'A torn page from a traveler\\'s journal. The ink is smeared with blood and rainwater.',\n    category: 'quest', sprite: 'sprites/items/misc/journal_fragment.png',\n    maxStack: 1, sellPrice: 0, buyPrice: 0, rarity: 0,\n  },\n  {\n    id: 'journal_entry', name: 'Journal Entry', description: 'A complete journal page detailing horrors witnessed in the depths. The handwriting grows frantic.',\n    category: 'quest', sprite: 'sprites/items/misc/journal_entry.png',\n    maxStack: 1, sellPrice: 0, buyPrice: 0, rarity: 0,\n  },\n  {\n    id: 'ancient_tablet', name: 'Ancient Tablet', description: 'A stone slab inscribed with a language predating all known civilizations. It hums when touched.',\n    category: 'quest', sprite: 'sprites/items/misc/ancient_tablet.png',\n    maxStack: 1, sellPrice: 0, buyPrice: 0, rarity: 2,\n  },\n  {\n    id: 'dragon_mount', name: 'Dragon Mount', description: 'A bond token signifying the allegiance of a dragon. The skies belong to you now.',\n    category: 'quest', sprite: 'sprites/items/misc/dragon_mount.png',\n    maxStack: 1, sellPrice: 0, buyPrice: 0, rarity: 3,\n  },\n  {\n    id: 'wedding_ring_recipe', name: 'Wedding Ring Recipe', description: 'Schematics for forging a wedding band. Even in ruin, love persists as defiance against the dark.',\n    category: 'quest', sprite: 'sprites/items/misc/wedding_ring_recipe.png',\n    maxStack: 1, sellPrice: 0, buyPrice: 0, rarity: 0,\n  },\n  {\n    id: 'bounty_map', name: 'Bounty Map', description: 'A tattered map marked with blood-red X\\'s. Each marks a target worth killing for coin.',\n    category: 'quest', sprite: 'sprites/items/misc/bounty_map.png',\n    maxStack: 1, sellPrice: 0, buyPrice: 0, rarity: 0,\n  },\n  {\n    id: 'relic_fragment', name: 'Relic Fragment', description: 'A broken shard of an ancient relic. Alone it is worthless, but together they hold great power.',\n    category: 'quest', sprite: 'sprites/items/misc/relic_fragment.png',\n    maxStack: 99, sellPrice: 0, buyPrice: 0, rarity: 0,\n  },\n];\n\n// ============ MISC ITEMS ============\nexport const MISC_ITEMS: ItemDef[] = [\n  {\n    id: 'torch', name: 'Torch', description: 'A light source that illuminates dark areas.',\n    category: 'misc', sprite: 'sprites/items/misc/torch.png',\n    maxStack: 99, sellPrice: 5, buyPrice: 13, rarity: 0,\n  },\n  {\n    id: 'chest', name: 'Chest', description: 'Storage for your items. Holds 36 slots.',\n    category: 'misc', sprite: 'sprites/items/misc/chest.png',\n    maxStack: 1, sellPrice: 100, buyPrice: 250, rarity: 0,\n  },\n  {\n    id: 'scarecrow', name: 'Scarecrow', description: 'Protects crops from crows in an 8-tile radius.',\n    category: 'misc', sprite: 'sprites/items/misc/scarecrow.png',\n    maxStack: 1, sellPrice: 75, buyPrice: 188, rarity: 0,\n  },\n  {\n    id: 'sprinkler', name: 'Basic Sprinkler', description: 'Waters 4 adjacent tiles every morning.',\n    category: 'misc', sprite: 'sprites/items/misc/sprinkler.png',\n    maxStack: 1, sellPrice: 150, buyPrice: 375, rarity: 0,\n  },\n  {\n    id: 'quality_sprinkler', name: 'Quality Sprinkler', description: 'Waters 8 tiles in a 3x3 area every morning.',\n    category: 'misc', sprite: 'sprites/items/misc/quality_sprinkler.png',\n    maxStack: 1, sellPrice: 450, buyPrice: 1125, rarity: 1,\n  },\n  {\n    id: 'iridium_sprinkler', name: 'Iridium Sprinkler', description: 'Waters 24 tiles in a 5x5 area every morning.',\n    category: 'misc', sprite: 'sprites/items/misc/iridium_sprinkler.png',\n    maxStack: 1, sellPrice: 1000, buyPrice: 2500, rarity: 1,\n  },\n  {\n    id: 'bomb', name: 'Bomb', description: 'Explodes and breaks rocks in an area.',\n    category: 'misc', sprite: 'sprites/items/misc/bomb.png',\n    maxStack: 99, sellPrice: 50, buyPrice: 125, rarity: 0,\n  },\n  {\n    id: 'gold_coin', name: 'Gold Coin', description: 'Currency',\n    category: 'misc', sprite: 'sprites/items/misc/gold_coin.png',\n    maxStack: 9999, sellPrice: 1, buyPrice: 3, rarity: 1,\n  },\n  {\n    id: 'golden_statue', name: 'Golden Statue', description: 'A solid gold statue commemorating your wealth.',\n    category: 'misc', sprite: 'sprites/items/misc/golden_statue.png',\n    maxStack: 1, sellPrice: 1000000, buyPrice: 2500000, rarity: 1,\n  },\n  {\n    id: 'tusk_trophy', name: 'Tusk Trophy', description: 'A massive tusk ripped from the maw of a slain beast. Proof of a hunt survived.',\n    category: 'misc', sprite: 'sprites/items/misc/tusk_trophy.png',\n    maxStack: 1, sellPrice: 750, buyPrice: 1875, rarity: 0,\n  },\n  {\n    id: 'bait', name: 'Bait', description: 'Squirming morsels that lure creatures from the murky depths. What rises may not be a fish.',\n    category: 'misc', sprite: 'sprites/items/tool/bait.png',\n    maxStack: 99, sellPrice: 5, buyPrice: 13, rarity: 0,\n  },\n  {\n    id: 'battle_standard', name: 'Battle Standard', description: 'A tattered war banner stained with the blood of a hundred battles. It rallies the spirit.',\n    category: 'misc', sprite: 'sprites/items/misc/battle_standard.png',\n    maxStack: 1, sellPrice: 500, buyPrice: 1250, rarity: 0,\n  },\n  {\n    id: 'master_bait', name: 'Master Bait', description: 'Alchemically perfected bait that no creature of the deep can resist. Guaranteed to attract legends.',\n    category: 'misc', sprite: 'sprites/items/tool/master_bait.png',\n    maxStack: 99, sellPrice: 100, buyPrice: 250, rarity: 0,\n  },\n  {\n    id: 'charcoal_kiln', name: 'Charcoal Kiln', description: 'A smoldering kiln that converts wood into charcoal. Black smoke rises like lost prayers.',\n    category: 'misc', sprite: 'sprites/items/misc/charcoal_kiln.png',\n    maxStack: 1, sellPrice: 500, buyPrice: 1250, rarity: 0,\n  },\n  {\n    id: 'bee_house', name: 'Bee House', description: 'A wooden hive for dark bees. Their honey is tinged with brimstone but commands a high price.',\n    category: 'misc', sprite: 'sprites/items/misc/bee_house.png',\n    maxStack: 1, sellPrice: 400, buyPrice: 1000, rarity: 0,\n  },\n  {\n    id: 'preserves_jar', name: 'Preserves Jar', description: 'A sealed jar for preserving fruits and vegetables. Keeps food edible through the longest sieges.',\n    category: 'misc', sprite: 'sprites/items/misc/preserves_jar.png',\n    maxStack: 1, sellPrice: 500, buyPrice: 1250, rarity: 0,\n  },\n  {\n    id: 'cheese_press', name: 'Cheese Press', description: 'A heavy press that transforms milk into cheese. The curds form slowly, like clotting blood.',\n    category: 'misc', sprite: 'sprites/items/misc/cheese_press.png',\n    maxStack: 1, sellPrice: 600, buyPrice: 1500, rarity: 0,\n  },\n  {\n    id: 'keg', name: 'Keg', description: 'A barrel for fermenting beverages. In dark times, strong drink is the last comfort of the living.',\n    category: 'misc', sprite: 'sprites/items/misc/keg.png',\n    maxStack: 1, sellPrice: 800, buyPrice: 2000, rarity: 0,\n  },\n  {\n    id: 'furnace', name: 'Furnace', description: 'A stone smelter that devours ore and spits out ingots. Its flames never truly die out.',\n    category: 'misc', sprite: 'sprites/items/misc/furnace.png',\n    maxStack: 1, sellPrice: 300, buyPrice: 750, rarity: 0,\n  },\n  {\n    id: 'omni_geode', name: 'Omni Geode', description: 'A mysterious geode that could contain any mineral. Crack it open and tempt fate.',\n    category: 'misc', sprite: 'sprites/items/misc/omni_geode.png',\n    maxStack: 99, sellPrice: 100, buyPrice: 250, rarity: 0,\n  },\n  {\n    id: 'lightning_rod', name: 'Lightning Rod', description: 'A tall iron rod that draws lightning from cursed storms. Harnesses raw, volatile power.',\n    category: 'misc', sprite: 'sprites/items/misc/lightning_rod.png',\n    maxStack: 1, sellPrice: 400, buyPrice: 1000, rarity: 0,\n  },\n  {\n    id: 'crystalarium', name: 'Crystalarium', description: 'An arcane device that replicates gems from nothing. Its workings defy mortal understanding.',\n    category: 'misc', sprite: 'sprites/items/misc/crystalarium.png',\n    maxStack: 1, sellPrice: 2000, buyPrice: 5000, rarity: 2,\n  },\n  {\n    id: 'auto_petter', name: 'Auto-Petter', description: 'A mechanical device that soothes livestock with rhythmic strokes. Eerie but effective.',\n    category: 'misc', sprite: 'sprites/items/misc/auto_petter.png',\n    maxStack: 1, sellPrice: 3000, buyPrice: 7500, rarity: 0,\n  },\n  {\n    id: 'rarecrow_1', name: 'Rarecrow', description: 'A sinister scarecrow fashioned from bones and rags. Crows dare not approach its grim domain.',\n    category: 'misc', sprite: 'sprites/items/misc/rarecrow_1.png',\n    maxStack: 1, sellPrice: 500, buyPrice: 1250, rarity: 2,\n  },\n  {\n    id: 'treasure_chest', name: 'Treasure Chest', description: 'An ornate chest salvaged from a sunken vessel. Its contents whisper promises of forgotten wealth.',\n    category: 'misc', sprite: 'sprites/items/misc/treasure_chest.png',\n    maxStack: 1, sellPrice: 2000, buyPrice: 5000, rarity: 0,\n  },\n  {\n    id: 'ancient_artifact', name: 'Ancient Artifact', description: 'A mysterious relic from a civilization lost to the first cataclysm. It hums with dormant power.',\n    category: 'misc', sprite: 'sprites/items/misc/ancient_artifact.png',\n    maxStack: 1, sellPrice: 1000, buyPrice: 2500, rarity: 2,\n  },\n  {\n    id: 'campfire', name: 'Campfire', description: 'A portable camp. Place it to create a rest point and respawn checkpoint. Resting restores HP but respawns enemies.',\n    category: 'misc', sprite: 'sprites/items/misc/campfire.png',\n    maxStack: 5, sellPrice: 50, buyPrice: 125, rarity: 0,\n  },\n  {\n    id: 'spirit_ember', name: 'Spirit Ember', description: 'A rare ember from a defeated boss. Use at a campfire (SHIFT+E) to kindle it, granting resting buffs. Kindle 3 unlocks fast travel.',\n    category: 'misc', sprite: 'sprites/items/misc/spirit_ember.png',\n    maxStack: 10, sellPrice: 500, buyPrice: 1250, rarity: 3,\n  },\n];\n\n// ============ MASTER DATABASE ============\nexport const ALL_ITEMS: AnyItemDef[] = [\n  ...TOOLS, ...SEEDS, ...CROPS, ...RESOURCES, ...MATERIALS,\n  ...FOODS, ...WEAPONS, ...ARMOR, ...FISH, ...POTIONS,\n  ...QUEST_ITEMS, ...MISC_ITEMS\n];\n\nexport const ITEM_DB = new Map<string, AnyItemDef>(\n  ALL_ITEMS.map(item => [item.id, item])\n);\n","import { DAY_LENGTH_MS, DAYS_PER_SEASON, SEASONS } from '../config';\n\nexport type Season = typeof SEASONS[number];\n\nexport interface GameDate {\n  day: number;      // 1-28\n  season: Season;\n  year: number;\n  hour: number;     // 0-23\n  minute: number;   // 0-59\n}\n\n/**\n * Day/night cycle and calendar system.\n * 24 real-time minutes = 1 in-game day.\n */\nexport class TimeManager {\n  private elapsedMs: number = 0;\n  private totalDays: number = 0;\n  private paused: boolean = false;\n  private timeScale: number = 1.0;\n\n  // Callbacks\n  private onDayChange: (() => void)[] = [];\n  private onSeasonChange: ((season: Season) => void)[] = [];\n  private onHourChange: ((hour: number) => void)[] = [];\n\n  private lastHour: number = -1;\n  private lastDay: number = -1;\n  private lastSeason: Season = 'Spring';\n\n  constructor(startDay: number = 1) {\n    this.totalDays = startDay - 1;\n    this.elapsedMs = 0;\n  }\n\n  /** Advance time. Delta in milliseconds. */\n  update(deltaMs: number): void {\n    if (this.paused) return;\n    this.elapsedMs += deltaMs * this.timeScale;\n\n    // Check for day rollover\n    while (this.elapsedMs >= DAY_LENGTH_MS) {\n      this.elapsedMs -= DAY_LENGTH_MS;\n      this.totalDays++;\n    }\n\n    const date = this.getDate();\n\n    // Fire callbacks\n    if (date.hour !== this.lastHour) {\n      this.lastHour = date.hour;\n      for (const cb of this.onHourChange) cb(date.hour);\n    }\n    if (date.day !== this.lastDay) {\n      this.lastDay = date.day;\n      for (const cb of this.onDayChange) cb();\n    }\n    if (date.season !== this.lastSeason) {\n      this.lastSeason = date.season;\n      for (const cb of this.onSeasonChange) cb(date.season);\n    }\n  }\n\n  /** Get current game date */\n  getDate(): GameDate {\n    const seasonLength = DAYS_PER_SEASON;\n    const yearLength = seasonLength * SEASONS.length;\n\n    const year = Math.floor(this.totalDays / yearLength) + 1;\n    const dayOfYear = this.totalDays % yearLength;\n    const seasonIndex = Math.floor(dayOfYear / seasonLength);\n    const dayOfSeason = (dayOfYear % seasonLength) + 1;\n\n    // Time within current day\n    const dayProgress = this.elapsedMs / DAY_LENGTH_MS;\n    const totalMinutes = dayProgress * 24 * 60;\n    const hour = Math.floor(totalMinutes / 60);\n    const minute = Math.floor(totalMinutes % 60);\n\n    return {\n      day: dayOfSeason,\n      season: SEASONS[seasonIndex],\n      year,\n      hour,\n      minute,\n    };\n  }\n\n  /** Get day progress as 0-1 (0 = midnight, 0.5 = noon) */\n  getDayProgress(): number {\n    return this.elapsedMs / DAY_LENGTH_MS;\n  }\n\n  /** Get light level based on time (0 = dark, 1 = bright) */\n  getLightLevel(): number {\n    const progress = this.getDayProgress();\n    // Sunrise at 6am (0.25), sunset at 8pm (0.833)\n    if (progress < 0.2) return 0.15;           // Night\n    if (progress < 0.3) return 0.15 + (progress - 0.2) * 8.5; // Dawn\n    if (progress < 0.75) return 1.0;           // Day\n    if (progress < 0.85) return 1.0 - (progress - 0.75) * 8.5; // Dusk\n    return 0.15;                                // Night\n  }\n\n  /** Get formatted time string */\n  getTimeString(): string {\n    const date = this.getDate();\n    const h = String(date.hour).padStart(2, '0');\n    const m = String(date.minute).padStart(2, '0');\n    return `${h}:${m}`;\n  }\n\n  /** Get formatted date string */\n  getDateString(): string {\n    const date = this.getDate();\n    return `${date.season} ${date.day}, Year ${date.year}`;\n  }\n\n  setPaused(paused: boolean): void { this.paused = paused; }\n  setTimeScale(scale: number): void { this.timeScale = Math.max(0, scale); }\n\n  onDay(cb: () => void): void { this.onDayChange.push(cb); }\n  onSeason(cb: (season: Season) => void): void { this.onSeasonChange.push(cb); }\n  onHour(cb: (hour: number) => void): void { this.onHourChange.push(cb); }\n\n  /** Serialize for save */\n  serialize(): { elapsedMs: number; totalDays: number } {\n    return { elapsedMs: this.elapsedMs, totalDays: this.totalDays };\n  }\n\n  /** Deserialize from save */\n  deserialize(data: { elapsedMs: number; totalDays: number }): void {\n    this.elapsedMs = data.elapsedMs;\n    this.totalDays = data.totalDays;\n  }\n}\n","import { SAVE_SLOTS, AUTOSAVE_INTERVAL_MS } from '../config';\n\nexport interface SaveData {\n  version: number;\n  timestamp: number;\n  slot: number;\n  player: {\n    x: number;\n    y: number;\n    hp: number;\n    maxHp: number;\n    stamina: number;\n    maxStamina: number;\n    level: number;\n    xp: number;\n  };\n  /** Scene to restore on load (e.g. 'OverworldScene', 'DungeonScene') */\n  currentScene: string;\n  /** Extra scene data (e.g. dungeonId, floorLevel) */\n  sceneData: Record<string, unknown>;\n  inventory: unknown;\n  equipment: unknown;\n  time: unknown;\n  quests: unknown;\n  skills: unknown;\n  chapters: unknown;\n  corruption: unknown;\n  settlements: unknown;\n  custom: Record<string, unknown>;\n}\n\nconst SAVE_KEY_PREFIX = 'edilas_save_';\nconst CURRENT_VERSION = 1;\n\n/**\n * Save/load game state to localStorage with 3 slots + file export/import.\n */\nexport class SaveManager {\n  private autoSaveTimer: number = 0;\n  private registeredSavers: Map<string, () => unknown> = new Map();\n  private registeredLoaders: Map<string, (data: unknown) => void> = new Map();\n\n  /** Register a system to participate in save/load */\n  register(\n    key: string,\n    saver: () => unknown,\n    loader: (data: unknown) => void,\n  ): void {\n    this.registeredSavers.set(key, saver);\n    this.registeredLoaders.set(key, loader);\n  }\n\n  /** Save to a slot (1-based) */\n  save(\n    slot: number,\n    playerData: SaveData['player'],\n    currentScene: string = 'OverworldScene',\n    sceneData: Record<string, unknown> = {},\n  ): boolean {\n    if (slot < 1 || slot > SAVE_SLOTS) return false;\n\n    const saveData: SaveData = {\n      version: CURRENT_VERSION,\n      timestamp: Date.now(),\n      slot,\n      player: playerData,\n      currentScene,\n      sceneData,\n      inventory: null,\n      equipment: null,\n      time: null,\n      quests: null,\n      skills: null,\n      chapters: null,\n      corruption: null,\n      settlements: null,\n      custom: {},\n    };\n\n    // Collect data from registered systems\n    for (const [key, saver] of this.registeredSavers) {\n      if (key in saveData) {\n        (saveData as unknown as Record<string, unknown>)[key] = saver();\n      } else {\n        saveData.custom[key] = saver();\n      }\n    }\n\n    try {\n      const json = JSON.stringify(saveData);\n      localStorage.setItem(SAVE_KEY_PREFIX + slot, json);\n      return true;\n    } catch {\n      console.error(`Failed to save to slot ${slot}`);\n      return false;\n    }\n  }\n\n  /** Load from a slot (1-based). Returns null if slot is empty. */\n  load(slot: number): SaveData | null {\n    if (slot < 1 || slot > SAVE_SLOTS) return null;\n\n    try {\n      const json = localStorage.getItem(SAVE_KEY_PREFIX + slot);\n      if (!json) return null;\n\n      const saveData = JSON.parse(json) as SaveData;\n\n      // Distribute data to registered loaders\n      for (const [key, loader] of this.registeredLoaders) {\n        const data = key in saveData\n          ? (saveData as unknown as Record<string, unknown>)[key]\n          : saveData.custom[key];\n        if (data != null) loader(data);\n      }\n\n      return saveData;\n    } catch {\n      console.error(`Failed to load slot ${slot}`);\n      return null;\n    }\n  }\n\n  /** Delete a save slot */\n  deleteSave(slot: number): void {\n    localStorage.removeItem(SAVE_KEY_PREFIX + slot);\n  }\n\n  /** Check which slots have saves */\n  getSaveSlotInfo(): { slot: number; timestamp: number; playerLevel: number }[] {\n    const slots: { slot: number; timestamp: number; playerLevel: number }[] = [];\n    for (let i = 1; i <= SAVE_SLOTS; i++) {\n      try {\n        const json = localStorage.getItem(SAVE_KEY_PREFIX + i);\n        if (json) {\n          const data = JSON.parse(json) as SaveData;\n          slots.push({\n            slot: i,\n            timestamp: data.timestamp,\n            playerLevel: data.player.level,\n          });\n        }\n      } catch { /* skip corrupted saves */ }\n    }\n    return slots;\n  }\n\n  /** Export save as downloadable JSON file */\n  exportSave(slot: number): void {\n    const json = localStorage.getItem(SAVE_KEY_PREFIX + slot);\n    if (!json) return;\n\n    const blob = new Blob([json], { type: 'application/json' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `edilas_save_slot${slot}.json`;\n    a.click();\n    URL.revokeObjectURL(url);\n  }\n\n  /** Import save from file */\n  async importSave(file: File, slot: number): Promise<boolean> {\n    try {\n      const text = await file.text();\n      const data = JSON.parse(text) as SaveData;\n      if (data.version == null || data.player == null) return false;\n      data.slot = slot;\n      localStorage.setItem(SAVE_KEY_PREFIX + slot, JSON.stringify(data));\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  /** Check auto-save timer. Call with delta in ms. */\n  updateAutoSave(deltaMs: number, playerData: SaveData['player']): void {\n    this.autoSaveTimer += deltaMs;\n    if (this.autoSaveTimer >= AUTOSAVE_INTERVAL_MS) {\n      this.autoSaveTimer = 0;\n      this.save(1, playerData); // Auto-save always goes to slot 1\n    }\n  }\n}\n","import { INVENTORY_SLOTS } from '../config';\nimport { ITEM_DB } from '../data/items';\nimport type { AnyItemDef } from '../types/items';\n\nexport interface InventorySlot {\n  itemId: string;\n  quantity: number;\n}\n\n/**\n * Manages a 36-slot inventory with stacking, swapping, splitting, and auto-sort.\n */\nexport class InventoryManager {\n  private slots: InventorySlot[];\n  private maxStacks: Map<string, number> = new Map(); // itemId → maxStack\n  private gold: number = 0;\n\n  constructor() {\n    this.slots = Array.from({ length: INVENTORY_SLOTS }, () => ({\n      itemId: '',\n      quantity: 0,\n    }));\n  }\n\n  /** Get current gold */\n  getGold(): number { return this.gold; }\n\n  /** Add gold */\n  addGold(amount: number): void { this.gold += Math.max(0, Math.floor(amount)); }\n\n  /** Remove gold. Returns true if successful. */\n  removeGold(amount: number): boolean {\n    const a = Math.max(0, Math.floor(amount));\n    if (this.gold < a) return false;\n    this.gold -= a;\n    return true;\n  }\n\n  /** Get slots (alias for getAllSlots for compatibility) */\n  getSlots(): readonly InventorySlot[] { return this.slots; }\n\n  /** Add item to first available stack or empty slot. Returns leftover quantity. */\n  addItem(itemId: string, quantity: number = 1, maxStack: number = 99): number {\n    this.maxStacks.set(itemId, maxStack);\n    let remaining = quantity;\n\n    // First pass: fill existing stacks\n    for (const slot of this.slots) {\n      if (remaining <= 0) break;\n      if (slot.itemId === itemId && slot.quantity < maxStack) {\n        const canAdd = Math.min(remaining, maxStack - slot.quantity);\n        slot.quantity += canAdd;\n        remaining -= canAdd;\n      }\n    }\n\n    // Second pass: fill empty slots\n    for (const slot of this.slots) {\n      if (remaining <= 0) break;\n      if (slot.itemId === '') {\n        const canAdd = Math.min(remaining, maxStack);\n        slot.itemId = itemId;\n        slot.quantity = canAdd;\n        remaining -= canAdd;\n      }\n    }\n\n    return remaining;\n  }\n\n  /** Remove quantity of an item. Returns actual amount removed. */\n  removeItem(itemId: string, quantity: number = 1): number {\n    let toRemove = quantity;\n    for (const slot of this.slots) {\n      if (toRemove <= 0) break;\n      if (slot.itemId === itemId) {\n        const removing = Math.min(toRemove, slot.quantity);\n        slot.quantity -= removing;\n        toRemove -= removing;\n        if (slot.quantity <= 0) {\n          slot.itemId = '';\n          slot.quantity = 0;\n        }\n      }\n    }\n    return quantity - toRemove;\n  }\n\n  /** Remove one random non-tool item from inventory (for contract failure penalty) */\n  removeRandomItem(): string | null {\n    const candidates = this.slots.filter(s => s.itemId !== '' && !s.itemId.includes('axe') && !s.itemId.includes('pickaxe') && !s.itemId.includes('hoe') && !s.itemId.includes('watering_can') && !s.itemId.includes('fishing_rod'));\n    if (candidates.length === 0) return null;\n    const slot = candidates[Math.floor(Math.random() * candidates.length)];\n    const lost = slot.itemId;\n    slot.quantity--;\n    if (slot.quantity <= 0) {\n      slot.itemId = '';\n      slot.quantity = 0;\n    }\n    return lost;\n  }\n\n  /** Check if player has at least `quantity` of an item */\n  hasItem(itemId: string, quantity: number = 1): boolean {\n    let total = 0;\n    for (const slot of this.slots) {\n      if (slot.itemId === itemId) total += slot.quantity;\n    }\n    return total >= quantity;\n  }\n\n  /** Count total of an item across all slots */\n  countItem(itemId: string): number {\n    let total = 0;\n    for (const slot of this.slots) {\n      if (slot.itemId === itemId) total += slot.quantity;\n    }\n    return total;\n  }\n\n  /** Swap two slots */\n  swapSlots(a: number, b: number): void {\n    if (a < 0 || a >= INVENTORY_SLOTS || b < 0 || b >= INVENTORY_SLOTS) return;\n    [this.slots[a], this.slots[b]] = [this.slots[b], this.slots[a]];\n  }\n\n  /** Split a stack: move half to target slot (must be empty or same item) */\n  splitStack(fromIndex: number, toIndex: number): void {\n    const from = this.slots[fromIndex];\n    const to = this.slots[toIndex];\n    if (!from || !to || from.quantity <= 1) return;\n\n    const half = Math.floor(from.quantity / 2);\n    if (to.itemId === '' || to.itemId === from.itemId) {\n      const maxStack = this.maxStacks.get(from.itemId) ?? 99;\n      const canAdd = to.itemId === '' ? half : Math.min(half, maxStack - to.quantity);\n      to.itemId = from.itemId;\n      to.quantity += canAdd;\n      from.quantity -= canAdd;\n      if (from.quantity <= 0) {\n        from.itemId = '';\n        from.quantity = 0;\n      }\n    }\n  }\n\n  /** Sort inventory: group same items together, push empties to end */\n  autoSort(): void {\n    const items = this.slots.filter(s => s.itemId !== '');\n    items.sort((a, b) => a.itemId.localeCompare(b.itemId));\n\n    // Merge stacks\n    const merged: InventorySlot[] = [];\n    for (const item of items) {\n      const maxStack = this.maxStacks.get(item.itemId) ?? 99;\n      const last = merged[merged.length - 1];\n      if (last && last.itemId === item.itemId && last.quantity < maxStack) {\n        const canAdd = Math.min(item.quantity, maxStack - last.quantity);\n        last.quantity += canAdd;\n        item.quantity -= canAdd;\n      }\n      if (item.quantity > 0) {\n        merged.push({ ...item });\n      }\n    }\n\n    // Fill slots\n    for (let i = 0; i < INVENTORY_SLOTS; i++) {\n      if (i < merged.length) {\n        this.slots[i] = merged[i];\n      } else {\n        this.slots[i] = { itemId: '', quantity: 0 };\n      }\n    }\n  }\n\n  /**\n   * Use (consume) an item from a slot. Decrements stack by 1.\n   * Returns the item definition if consumed, or null if slot is empty/invalid.\n   */\n  useItem(slotIndex: number): AnyItemDef | null {\n    const slot = this.slots[slotIndex];\n    if (!slot || slot.itemId === '' || slot.quantity <= 0) return null;\n\n    const def = ITEM_DB.get(slot.itemId);\n    if (!def) return null;\n\n    // Only consumable categories can be \"used\"\n    if (def.category !== 'food' && def.category !== 'potion') return null;\n\n    slot.quantity -= 1;\n    if (slot.quantity <= 0) {\n      slot.itemId = '';\n      slot.quantity = 0;\n    }\n\n    return def;\n  }\n\n  getSlot(index: number): InventorySlot | null {\n    return this.slots[index] ?? null;\n  }\n\n  getAllSlots(): readonly InventorySlot[] {\n    return this.slots;\n  }\n\n  /** Check if inventory is full (no empty slots) */\n  isFull(): boolean {\n    return this.slots.every(s => s.itemId !== '');\n  }\n\n  /** Serialize for save */\n  serialize(): { slots: InventorySlot[]; gold: number } {\n    return { slots: this.slots.map(s => ({ ...s })), gold: this.gold };\n  }\n\n  /** Deserialize from save */\n  deserialize(data: InventorySlot[] | { slots: InventorySlot[]; gold: number }): void {\n    // Support both old (array) and new (object) formats\n    if (Array.isArray(data)) {\n      for (let i = 0; i < INVENTORY_SLOTS && i < data.length; i++) {\n        this.slots[i] = { ...data[i] };\n      }\n    } else {\n      if (data.slots) {\n        for (let i = 0; i < INVENTORY_SLOTS && i < data.slots.length; i++) {\n          this.slots[i] = { ...data.slots[i] };\n        }\n      }\n      this.gold = data.gold ?? 0;\n    }\n  }\n}\n","export type EquipSlot = 'weapon' | 'shield' | 'head' | 'chest' | 'legs' | 'feet' | 'hands' | 'ring1' | 'ring2' | 'necklace';\n\nexport interface EquipmentStats {\n  damage: number;\n  defense: number;\n  hp: number;\n  stamina: number;\n  critChance: number;\n  critMult: number;\n  attackSpeed: number;\n}\n\nexport interface EquippedItem {\n  itemId: string;\n  slot: EquipSlot;\n  stats: EquipmentStats;\n  rarity: number;\n  setId?: string;\n}\n\nconst EMPTY_STATS: EquipmentStats = {\n  damage: 0, defense: 0, hp: 0, stamina: 0,\n  critChance: 0, critMult: 0, attackSpeed: 0,\n};\n\n/** Accessory slots that consume notches */\nconst ACCESSORY_SLOTS: EquipSlot[] = ['ring1', 'ring2', 'necklace'];\n\n/**\n * Manages equipped gear, stat recalculation, set bonuses, and accessory notch budget.\n *\n * Accessory notch system (Hollow Knight charm-style):\n * - Player has a limited number of notches (default 5, expandable)\n * - Each accessory (ring/necklace) costs 1–3 notches to equip\n * - Cannot equip accessories that exceed total notch budget\n * - Some accessories have tradeoffs (e.g., +damage but −defense)\n */\nexport class EquipmentManager {\n  private equipped: Map<EquipSlot, EquippedItem | null> = new Map();\n  private cachedStats: EquipmentStats = { ...EMPTY_STATS };\n  private cachedSetBonuses: Map<string, number> = new Map(); // setId → count\n  private equipChangeCbs: ((stats: EquipmentStats) => void)[] = [];\n\n  /** Maximum notch slots available (expandable via upgrades/bosses) */\n  private maxNotches = 5;\n  /** Notch costs per accessory slot (stored alongside equipped items) */\n  private slotNotchCosts: Map<EquipSlot, number> = new Map();\n  /** Tradeoff penalties per slot */\n  private slotTradeoffs: Map<EquipSlot, { stat: string; amount: number }> = new Map();\n\n  constructor() {\n    const slots: EquipSlot[] = ['weapon', 'shield', 'head', 'chest', 'legs', 'feet', 'hands', 'ring1', 'ring2', 'necklace'];\n    for (const slot of slots) {\n      this.equipped.set(slot, null);\n    }\n  }\n\n  /** Get maximum notch capacity */\n  getMaxNotches(): number { return this.maxNotches; }\n\n  /** Expand notch capacity (from boss drops, quests, upgrades) */\n  addNotches(count: number): void { this.maxNotches += count; }\n\n  /** Set max notches directly (for deserialization) */\n  setMaxNotches(n: number): void { this.maxNotches = n; }\n\n  /** Get currently used notch count */\n  getUsedNotches(): number {\n    let total = 0;\n    for (const cost of this.slotNotchCosts.values()) {\n      total += cost;\n    }\n    return total;\n  }\n\n  /** Get available notch count */\n  getAvailableNotches(): number {\n    return this.maxNotches - this.getUsedNotches();\n  }\n\n  /** Check if an accessory can be equipped (notch budget check) */\n  canEquipAccessory(notchCost: number, targetSlot: EquipSlot): boolean {\n    if (!ACCESSORY_SLOTS.includes(targetSlot)) return true; // non-accessory always ok\n    // Account for the current item being replaced\n    const currentCost = this.slotNotchCosts.get(targetSlot) ?? 0;\n    return (this.getUsedNotches() - currentCost + notchCost) <= this.maxNotches;\n  }\n\n  /** Equip an item. Returns the previously equipped item (or null). Returns null without equipping if notch budget exceeded. */\n  equip(item: EquippedItem, notchCost: number = 0, tradeoff?: { stat: string; amount: number }): EquippedItem | null {\n    // Notch budget check for accessories\n    if (ACCESSORY_SLOTS.includes(item.slot) && !this.canEquipAccessory(notchCost, item.slot)) {\n      return null; // Cannot equip — not enough notches\n    }\n\n    const prev = this.equipped.get(item.slot) ?? null;\n    this.equipped.set(item.slot, item);\n\n    // Track notch cost and tradeoff\n    if (notchCost > 0) {\n      this.slotNotchCosts.set(item.slot, notchCost);\n    } else {\n      this.slotNotchCosts.delete(item.slot);\n    }\n    if (tradeoff) {\n      this.slotTradeoffs.set(item.slot, tradeoff);\n    } else {\n      this.slotTradeoffs.delete(item.slot);\n    }\n\n    this.recalculate();\n    return prev;\n  }\n\n  /** Unequip a slot. Returns the removed item (or null). */\n  unequip(slot: EquipSlot): EquippedItem | null {\n    const item = this.equipped.get(slot) ?? null;\n    this.equipped.set(slot, null);\n    this.slotNotchCosts.delete(slot);\n    this.slotTradeoffs.delete(slot);\n    this.recalculate();\n    return item;\n  }\n\n  /** Get the item in a slot */\n  getEquipped(slot: EquipSlot): EquippedItem | null {\n    return this.equipped.get(slot) ?? null;\n  }\n\n  /** Get total stats from all equipment */\n  getTotalStats(): EquipmentStats {\n    return { ...this.cachedStats };\n  }\n\n  /** Get set bonus counts */\n  getSetBonuses(): Map<string, number> {\n    return new Map(this.cachedSetBonuses);\n  }\n\n  /** Recalculate cached totals */\n  private recalculate(): void {\n    const totals: EquipmentStats = { ...EMPTY_STATS };\n    this.cachedSetBonuses.clear();\n\n    for (const item of this.equipped.values()) {\n      if (!item) continue;\n      totals.damage += item.stats.damage;\n      totals.defense += item.stats.defense;\n      totals.hp += item.stats.hp;\n      totals.stamina += item.stats.stamina;\n      totals.critChance += item.stats.critChance;\n      totals.critMult += item.stats.critMult;\n      totals.attackSpeed += item.stats.attackSpeed;\n\n      if (item.setId) {\n        this.cachedSetBonuses.set(\n          item.setId,\n          (this.cachedSetBonuses.get(item.setId) ?? 0) + 1,\n        );\n      }\n    }\n\n    // Apply tradeoff penalties from accessories\n    for (const tradeoff of this.slotTradeoffs.values()) {\n      const key = tradeoff.stat as keyof EquipmentStats;\n      if (key in totals) {\n        (totals as unknown as Record<string, number>)[key] -= tradeoff.amount;\n      }\n    }\n\n    this.cachedStats = totals;\n    for (const cb of this.equipChangeCbs) {\n      cb(totals);\n    }\n  }\n\n  /** Register a callback that fires whenever equipment changes */\n  onEquipChange(cb: (stats: EquipmentStats) => void): void {\n    this.equipChangeCbs.push(cb);\n  }\n\n  /** Serialize for save */\n  serialize(): {\n    equipped: Record<EquipSlot, EquippedItem | null>;\n    maxNotches: number;\n    notchCosts: Record<string, number>;\n    tradeoffs: Record<string, { stat: string; amount: number }>;\n  } {\n    const result: Record<string, EquippedItem | null> = {};\n    for (const [slot, item] of this.equipped) {\n      result[slot] = item ? { ...item, stats: { ...item.stats } } : null;\n    }\n    const notchCosts: Record<string, number> = {};\n    for (const [slot, cost] of this.slotNotchCosts) notchCosts[slot] = cost;\n    const tradeoffs: Record<string, { stat: string; amount: number }> = {};\n    for (const [slot, t] of this.slotTradeoffs) tradeoffs[slot] = { ...t };\n    return {\n      equipped: result as Record<EquipSlot, EquippedItem | null>,\n      maxNotches: this.maxNotches,\n      notchCosts,\n      tradeoffs,\n    };\n  }\n\n  /** Deserialize from save */\n  deserialize(data: Record<EquipSlot, EquippedItem | null> | {\n    equipped: Record<EquipSlot, EquippedItem | null>;\n    maxNotches?: number;\n    notchCosts?: Record<string, number>;\n    tradeoffs?: Record<string, { stat: string; amount: number }>;\n  }): void {\n    // Handle both old format (plain Record) and new format (with notch data)\n    const equippedData = 'equipped' in data ? data.equipped : data as Record<EquipSlot, EquippedItem | null>;\n    for (const [slot, item] of Object.entries(equippedData)) {\n      this.equipped.set(slot as EquipSlot, item);\n    }\n    if ('maxNotches' in data && data.maxNotches) {\n      this.maxNotches = data.maxNotches;\n    }\n    if ('notchCosts' in data && data.notchCosts) {\n      for (const [slot, cost] of Object.entries(data.notchCosts)) {\n        this.slotNotchCosts.set(slot as EquipSlot, cost);\n      }\n    }\n    if ('tradeoffs' in data && data.tradeoffs) {\n      for (const [slot, t] of Object.entries(data.tradeoffs)) {\n        this.slotTradeoffs.set(slot as EquipSlot, t);\n      }\n    }\n    this.recalculate();\n  }\n}\n","import { QuestDef } from '../types/quest';\n\nexport const QUESTS: QuestDef[] = [\n  // =============================================\n  // MAIN STORY QUESTS (Chapter 1: The Beginning)\n  // =============================================\n  {\n    id: 'welcome_quest',\n    name: 'Welcome to Town',\n    description: 'Meet the mayor and learn about the town.',\n    type: 'main',\n    giver: 'mayor',\n    prerequisites: [],\n    objectives: [\n      { type: 'talk', target: 'mayor', count: 1, description: 'Talk to Mayor Thomas' },\n      { type: 'talk', target: 'shopkeeper', count: 1, description: 'Visit the General Store' },\n      { type: 'talk', target: 'innkeeper', count: 1, description: 'Check in at the Tavern' }\n    ],\n    rewards: { xp: 50, gold: 100, items: [{ itemId: 'parsnip_seeds', quantity: 20 }] },\n    dialogue: {\n      offer: 'Welcome, newcomer! I am Mayor Thomas. Let me introduce you to the townsfolk.',\n      inProgress: 'Have you met everyone yet? Visit the General Store and the Tavern.',\n      complete: 'Wonderful! You are already fitting in. Here, take these seeds to get started.'\n    },\n    level: 1,\n    chapter: 1,\n    repeatable: false\n  },\n  {\n    id: 'first_harvest',\n    name: 'First Harvest',\n    description: 'Plant and harvest your first crop.',\n    type: 'main',\n    giver: 'mayor',\n    prerequisites: ['welcome_quest'],\n    objectives: [\n      { type: 'farm', target: 'till_soil', count: 5, description: 'Till 5 plots of soil' },\n      { type: 'farm', target: 'plant_seeds', count: 5, description: 'Plant 5 seeds' },\n      { type: 'collect', target: 'any_crop', count: 5, description: 'Harvest 5 crops' }\n    ],\n    rewards: { xp: 100, gold: 200, items: [{ itemId: 'cauliflower_seeds', quantity: 10 }] },\n    dialogue: {\n      offer: 'Every guardian must know how to work the land. Try planting some crops!',\n      inProgress: 'Till the soil, plant seeds, and wait for them to grow.',\n      complete: 'A fine harvest! You have a natural talent for farming.'\n    },\n    level: 1,\n    chapter: 1,\n    repeatable: false\n  },\n  {\n    id: 'guardian_path_1',\n    name: \"The Guardian's Path: Chapter 1\",\n    description: 'Restore the farmhouse and begin your journey as the new guardian.',\n    type: 'main',\n    giver: 'mayor',\n    prerequisites: [],\n    objectives: [\n      { type: 'talk', target: 'mayor', count: 1, description: 'Meet Mayor Harold' },\n      { type: 'farm', target: 'plant_seeds', count: 5, description: 'Plant 5 Spring seeds' },\n      { type: 'talk', target: 'shopkeeper', count: 1, description: 'Visit Martha at the store' }\n    ],\n    rewards: { xp: 100, gold: 500, items: [{ itemId: 'cauliflower_seeds', quantity: 10 }] },\n    dialogue: {\n      offer: 'Your grandmother left this farm to you. It needs work, but the land is good.',\n      inProgress: 'Plant some seeds and visit Martha for supplies.',\n      complete: 'The farm is coming back to life. Your grandmother would be proud.'\n    },\n    level: 1,\n    chapter: 1,\n    repeatable: false\n  },\n  {\n    id: 'guardian_path_2',\n    name: \"The Guardian's Path: Chapter 2\",\n    description: \"Find Grandmother's hidden journal and explore the mines.\",\n    type: 'main',\n    giver: 'mayor',\n    prerequisites: ['guardian_path_1'],\n    objectives: [\n      { type: 'reach', target: 'mine_floor_20', count: 1, description: 'Reach Mine Floor 20' },\n      { type: 'collect', target: 'journal_fragment', count: 1, description: \"Find Grandmother's Journal Fragment\" }\n    ],\n    rewards: { xp: 250, gold: 1000, items: [{ itemId: 'gold_ore', quantity: 5 }] },\n    dialogue: {\n      offer: 'Your grandmother hid something deep in the mines. You must find it.',\n      inProgress: 'Keep exploring the mines. The journal is somewhere past floor 20.',\n      complete: 'This journal... it speaks of ancient secrets. We must learn more.'\n    },\n    level: 5,\n    chapter: 1,\n    repeatable: false\n  },\n  {\n    id: 'dungeon_intro',\n    name: 'Danger Below',\n    description: 'The old mines have been overrun with monsters. Clear the first floor.',\n    type: 'main',\n    giver: 'adventurer',\n    prerequisites: ['first_harvest'],\n    objectives: [\n      { type: 'kill', target: 'slime', count: 10, description: 'Defeat 10 Slimes' },\n      { type: 'reach', target: 'dungeon_floor_5', count: 1, description: 'Reach Floor 5 of the Mines' }\n    ],\n    rewards: { xp: 200, gold: 500, items: [{ itemId: 'sword', quantity: 1 }] },\n    dialogue: {\n      offer: 'The mines are infested. We need someone brave enough to clear them out.',\n      inProgress: 'Keep pushing deeper. The slimes get tougher below.',\n      complete: 'Impressive work! You handle a blade well. Take this sword.'\n    },\n    level: 3,\n    chapter: 1,\n    repeatable: false\n  },\n\n  // =============================================\n  // MAIN STORY QUESTS (Chapter 2: Grandmother's Secret)\n  // =============================================\n  {\n    id: 'grandmothers_secret',\n    name: \"Grandmother's Secret\",\n    description: \"Search for clues about your grandmother's past.\",\n    type: 'main',\n    giver: 'mayor',\n    prerequisites: ['welcome_quest'],\n    objectives: [\n      { type: 'collect', target: 'journal_entry', count: 3, description: 'Find 3 Journal Entries' },\n      { type: 'talk', target: 'wizard', count: 1, description: 'Speak with the Wizard' }\n    ],\n    rewards: { xp: 200, gold: 500, items: [] },\n    dialogue: {\n      offer: 'Your grandmother was no ordinary farmer. Look for her journal entries.',\n      inProgress: 'Search the farmhouse and talk to old friends of hers.',\n      complete: 'The wizard may know more about what she was hiding.'\n    },\n    level: 3,\n    chapter: 2,\n    repeatable: false\n  },\n  {\n    id: 'curse_investigation',\n    name: 'The Curse of Willowbrook',\n    description: 'The wizard speaks of an ancient curse. Investigate the mines.',\n    type: 'main',\n    giver: 'wizard',\n    prerequisites: ['grandmothers_secret'],\n    objectives: [\n      { type: 'reach', target: 'mine_floor_25', count: 1, description: 'Reach Mine Floor 25' },\n      { type: 'talk', target: 'ancient_spirit', count: 1, description: 'Find the Ancient Spirit' }\n    ],\n    rewards: { xp: 400, gold: 1000, items: [] },\n    dialogue: {\n      offer: 'An ancient curse binds this valley. The answers lie deep in the mines.',\n      inProgress: 'Descend to floor 25. The spirit awaits those who are worthy.',\n      complete: 'The spirit has spoken. The community center is the key to breaking the curse.'\n    },\n    level: 8,\n    chapter: 2,\n    repeatable: false\n  },\n  {\n    id: 'community_restoration',\n    name: 'Restoring the Heart',\n    description: 'The spirit says the community center is key. Help restore it.',\n    type: 'main',\n    giver: 'mayor',\n    prerequisites: ['curse_investigation'],\n    objectives: [\n      { type: 'collect', target: 'community_bundle', count: 1, description: 'Complete a Community Center Bundle' },\n      { type: 'talk', target: 'mayor', count: 1, description: 'Report to the Mayor' }\n    ],\n    rewards: { xp: 500, gold: 2000, items: [] },\n    dialogue: {\n      offer: 'The community center has fallen into disrepair. Help us restore it.',\n      inProgress: 'Gather the items needed for the bundles.',\n      complete: 'The center glows with renewed energy. The curse weakens!'\n    },\n    level: 10,\n    chapter: 2,\n    repeatable: false\n  },\n\n  // =============================================\n  // MAIN STORY QUESTS (Chapter 3: The Darkness)\n  // =============================================\n  {\n    id: 'darkness_awakens',\n    name: 'The Darkness Awakens',\n    description: 'Strange creatures have been spotted outside Haven. Investigate the threat.',\n    type: 'main',\n    giver: 'adventurer',\n    prerequisites: [],\n    objectives: [\n      { type: 'explore', target: 'wilderness_500m', count: 1, description: 'Venture 500m from Haven' },\n      { type: 'kill', target: 'any', count: 5, description: 'Defeat 5 creatures in the wild' },\n      { type: 'survive', target: 'night_outside', count: 1, description: 'Survive one night outside Haven' }\n    ],\n    rewards: { xp: 150, gold: 300, items: [{ itemId: 'torch', quantity: 10 }] },\n    dialogue: {\n      offer: 'Something stirs beyond the walls. We need someone to investigate.',\n      inProgress: 'Venture out, fight what you find, and survive the night.',\n      complete: 'You survived. But what you saw out there... it is only the beginning.'\n    },\n    level: 5,\n    chapter: 3,\n    repeatable: false\n  },\n  {\n    id: 'whispers_in_dark',\n    name: 'Whispers in the Dark',\n    description: 'The wizard senses an ancient evil stirring. The old stories speak of EDILAS...',\n    type: 'main',\n    giver: 'wizard',\n    prerequisites: ['darkness_awakens'],\n    objectives: [\n      { type: 'talk', target: 'wizard', count: 1, description: 'Consult the Wizard about EDILAS' },\n      { type: 'collect', target: 'ancient_tablet', count: 1, description: 'Find an Ancient Tablet' },\n      { type: 'reach', target: 'deep_mines_floor_30', count: 1, description: 'Explore the Deep Mines (Floor 30)' }\n    ],\n    rewards: { xp: 300, gold: 750, items: [{ itemId: 'lantern', quantity: 1 }] },\n    dialogue: {\n      offer: 'I sense a great disturbance. The name EDILAS appears in the ancient texts...',\n      inProgress: 'Find the tablet. It holds the key to understanding what is coming.',\n      complete: 'EDILAS... it is not just a legend. The darkness is real, and it is waking.'\n    },\n    level: 10,\n    chapter: 3,\n    repeatable: false\n  },\n\n  // =============================================\n  // MAIN STORY QUESTS (Chapter 4: Biome Dungeons)\n  // =============================================\n  {\n    id: 'corrupted_grove_quest',\n    name: 'The Corrupted Grove',\n    description: 'A forest has been twisted by dark magic. Clear the corruption at its heart.',\n    type: 'main',\n    giver: 'wizard',\n    prerequisites: ['whispers_in_dark'],\n    objectives: [\n      { type: 'explore', target: 'corrupted_grove', count: 1, description: 'Enter the Corrupted Grove' },\n      { type: 'reach', target: 'grove_floor_20', count: 1, description: 'Reach Grove Floor 20' },\n      { type: 'kill', target: 'ancient_treant', count: 1, description: 'Defeat the Ancient Treant' }\n    ],\n    rewards: { xp: 500, gold: 2000, items: [{ itemId: 'forest_heart', quantity: 1 }] },\n    dialogue: {\n      offer: 'The Corrupted Grove festers with dark energy. You must cleanse it.',\n      inProgress: 'Push deeper into the grove. The Treant guards the heart.',\n      complete: 'The Forest Heart pulses with cleansed energy. One artifact secured.'\n    },\n    level: 15,\n    chapter: 4,\n    repeatable: false\n  },\n  {\n    id: 'blighted_marsh_quest',\n    name: 'Depths of the Marsh',\n    description: 'A swamp creature blocks the path. Its poison must be purged.',\n    type: 'main',\n    giver: 'wizard',\n    prerequisites: ['corrupted_grove_quest'],\n    objectives: [\n      { type: 'explore', target: 'blighted_marsh', count: 1, description: 'Enter the Blighted Marsh' },\n      { type: 'reach', target: 'marsh_floor_25', count: 1, description: 'Reach Marsh Floor 25' },\n      { type: 'kill', target: 'swamp_horror', count: 1, description: 'Defeat the Swamp Horror' }\n    ],\n    rewards: { xp: 600, gold: 2500, items: [{ itemId: 'marsh_eye', quantity: 1 }] },\n    dialogue: {\n      offer: 'The Blighted Marsh poisons everything it touches. End the Horror within.',\n      inProgress: 'Wade through the mire. The Swamp Horror lurks at the depths.',\n      complete: 'The Marsh Eye is yours. Two artifacts collected.'\n    },\n    level: 20,\n    chapter: 4,\n    repeatable: false\n  },\n  {\n    id: 'scorched_wastes_quest',\n    name: 'Trial by Fire',\n    description: 'The volcanic caverns hold ancient power. Face the guardian within.',\n    type: 'main',\n    giver: 'wizard',\n    prerequisites: ['blighted_marsh_quest'],\n    objectives: [\n      { type: 'explore', target: 'scorched_wastes', count: 1, description: 'Enter the Scorched Wastes' },\n      { type: 'reach', target: 'wastes_floor_30', count: 1, description: 'Reach Wastes Floor 30' },\n      { type: 'kill', target: 'molten_guardian', count: 1, description: 'Defeat the Molten Guardian' }\n    ],\n    rewards: { xp: 750, gold: 3000, items: [{ itemId: 'flame_core', quantity: 1 }] },\n    dialogue: {\n      offer: 'Fire and brimstone guard the third artifact. Are you ready?',\n      inProgress: 'The heat intensifies as you descend. The Molten Guardian awaits.',\n      complete: 'The Flame Core burns with purified fire. Three artifacts secured.'\n    },\n    level: 25,\n    chapter: 4,\n    repeatable: false\n  },\n  {\n    id: 'frozen_depths_quest',\n    name: 'Heart of Winter',\n    description: 'An ancient dragon slumbers in eternal ice. Wake it and prove your worth.',\n    type: 'main',\n    giver: 'wizard',\n    prerequisites: ['scorched_wastes_quest'],\n    objectives: [\n      { type: 'explore', target: 'frozen_depths', count: 1, description: 'Enter the Frozen Depths' },\n      { type: 'reach', target: 'depths_floor_40', count: 1, description: 'Reach Depths Floor 40' },\n      { type: 'kill', target: 'frost_wyrm', count: 1, description: 'Defeat the Frost Wyrm' }\n    ],\n    rewards: { xp: 1000, gold: 4000, items: [{ itemId: 'frost_shard', quantity: 1 }] },\n    dialogue: {\n      offer: 'The Frost Wyrm sleeps in ice older than the valley. Disturb it at your peril.',\n      inProgress: 'The cold bites deeper with every step. The Wyrm stirs.',\n      complete: 'The Frost Shard gleams with frozen power. Four artifacts in hand.'\n    },\n    level: 30,\n    chapter: 4,\n    repeatable: false\n  },\n  {\n    id: 'haunted_ruins_quest',\n    name: \"The Lich's Domain\",\n    description: 'The final trial awaits. Face the master of death itself.',\n    type: 'main',\n    giver: 'wizard',\n    prerequisites: ['frozen_depths_quest'],\n    objectives: [\n      { type: 'explore', target: 'haunted_ruins', count: 1, description: 'Enter the Haunted Ruins' },\n      { type: 'reach', target: 'ruins_floor_50', count: 1, description: 'Reach Ruins Floor 50' },\n      { type: 'kill', target: 'lich_king', count: 1, description: 'Defeat the Lich King' }\n    ],\n    rewards: { xp: 1500, gold: 5000, items: [{ itemId: 'soul_fragment', quantity: 1 }] },\n    dialogue: {\n      offer: 'The Lich King rules the dead. Only by conquering death can you claim the final artifact.',\n      inProgress: 'The ruins whisper with lost souls. Press onward.',\n      complete: 'The Soul Fragment is yours. All five artifacts are assembled!'\n    },\n    level: 35,\n    chapter: 4,\n    repeatable: false\n  },\n\n  // =============================================\n  // MAIN STORY QUESTS (Chapter 5: The Path to EDILAS)\n  // =============================================\n  {\n    id: 'path_to_edilas',\n    name: 'The Path to Paradise',\n    description: 'With all five artifacts collected, the path to EDILAS reveals itself.',\n    type: 'main',\n    giver: 'wizard',\n    prerequisites: ['haunted_ruins_quest'],\n    objectives: [\n      { type: 'collect', target: 'forest_heart', count: 1, description: 'Possess the Forest Heart' },\n      { type: 'collect', target: 'marsh_eye', count: 1, description: 'Possess the Marsh Eye' },\n      { type: 'collect', target: 'flame_core', count: 1, description: 'Possess the Flame Core' },\n      { type: 'collect', target: 'frost_shard', count: 1, description: 'Possess the Frost Shard' },\n      { type: 'collect', target: 'soul_fragment', count: 1, description: 'Possess the Soul Fragment' },\n      { type: 'explore', target: 'sanctuary', count: 1, description: 'Find the hidden Sanctuary' }\n    ],\n    rewards: { xp: 5000, gold: 10000, items: [{ itemId: 'edilas_key', quantity: 1 }] },\n    dialogue: {\n      offer: 'The five artifacts resonate together. They point to a hidden sanctuary.',\n      inProgress: 'Gather all artifacts and seek the Sanctuary beyond the known world.',\n      complete: 'The EDILAS Key materializes before you. The path is open.'\n    },\n    level: 40,\n    chapter: 5,\n    repeatable: false\n  },\n  {\n    id: 'edilas_ascension',\n    name: 'EDILAS: Ascension',\n    description: 'The final journey. Reach EDILAS and claim your destiny.',\n    type: 'main',\n    giver: 'wizard',\n    prerequisites: ['path_to_edilas'],\n    objectives: [\n      { type: 'collect', target: 'edilas_key', count: 1, description: 'Use the EDILAS Key at the Sanctuary' },\n      { type: 'reach', target: 'edilas', count: 1, description: 'Enter EDILAS' }\n    ],\n    rewards: { xp: 0, gold: 0, items: [], unlocks: ['game_completion'] },\n    dialogue: {\n      offer: 'This is it. The gate to EDILAS awaits. Are you ready for your destiny?',\n      inProgress: 'Use the key at the Sanctuary. EDILAS calls to you.',\n      complete: 'You have arrived. EDILAS is real, and it is more beautiful than any legend told.'\n    },\n    level: 50,\n    chapter: 5,\n    repeatable: false\n  },\n\n  // =============================================\n  // SIDE QUESTS: NPC Relationships\n  // =============================================\n  {\n    id: 'lily_flowers',\n    name: 'Flowers for Lily',\n    description: 'Lily mentioned she loves flowers. Bring her some!',\n    type: 'side',\n    giver: 'farmer_girl',\n    prerequisites: [],\n    objectives: [\n      { type: 'deliver', target: 'flower', count: 5, description: 'Give Lily 5 Flowers' }\n    ],\n    rewards: { xp: 75, gold: 150, items: [] },\n    dialogue: {\n      offer: 'Oh, I just adore flowers! Could you bring me some from the meadow?',\n      inProgress: 'Any luck finding flowers? The meadow should be full of them.',\n      complete: 'These are gorgeous! Thank you so much!'\n    },\n    level: 1,\n    repeatable: false\n  },\n  {\n    id: 'blacksmith_ore',\n    name: 'Rare Ore Request',\n    description: 'Garrett needs gold ore for a special project.',\n    type: 'side',\n    giver: 'blacksmith',\n    prerequisites: [],\n    objectives: [\n      { type: 'deliver', target: 'gold_ore', count: 20, description: 'Bring 20 Gold Ore to Garrett' }\n    ],\n    rewards: { xp: 100, gold: 500, items: [{ itemId: 'iron_bar', quantity: 10 }] },\n    dialogue: {\n      offer: \"I'm working on something special, but I need gold ore. Can you get me 20?\",\n      inProgress: 'Still need that gold ore. The deeper mines have plenty.',\n      complete: \"Perfect quality! Here, take these iron bars as thanks.\"\n    },\n    level: 5,\n    repeatable: false\n  },\n  {\n    id: 'doctor_herbs',\n    name: 'Medical Supplies',\n    description: 'Dr. Elena needs herbs for her remedies.',\n    type: 'side',\n    giver: 'doctor',\n    prerequisites: [],\n    objectives: [\n      { type: 'deliver', target: 'magic_herb', count: 5, description: 'Bring 5 Magic Herbs to Elena' },\n      { type: 'deliver', target: 'red_mushroom', count: 10, description: 'Bring 10 Red Mushrooms' }\n    ],\n    rewards: { xp: 150, gold: 400, items: [{ itemId: 'health_potion', quantity: 5 }] },\n    dialogue: {\n      offer: 'My supplies are running low. I need magic herbs and red mushrooms for medicine.',\n      inProgress: 'I still need those herbs and mushrooms. Check the forest and caves.',\n      complete: 'These are perfect! Take some health potions for your trouble.'\n    },\n    level: 3,\n    repeatable: false\n  },\n  {\n    id: 'innkeeper_feast',\n    name: 'The Grand Feast',\n    description: 'The innkeeper is planning a feast and needs fresh ingredients.',\n    type: 'side',\n    giver: 'innkeeper',\n    prerequisites: [],\n    objectives: [\n      { type: 'deliver', target: 'potato', count: 10, description: 'Deliver 10 Potatoes' },\n      { type: 'deliver', target: 'corn', count: 10, description: 'Deliver 10 Corn' },\n      { type: 'deliver', target: 'fish', count: 5, description: 'Deliver 5 Fresh Fish' }\n    ],\n    rewards: { xp: 120, gold: 350, items: [{ itemId: 'cooked_feast', quantity: 3 }] },\n    dialogue: {\n      offer: \"We're hosting a feast! I need potatoes, corn, and fresh fish. Can you help?\",\n      inProgress: \"Still gathering ingredients? The feast won't cook itself!\",\n      complete: 'Everything looks wonderful! Here, have some of the feast yourself.'\n    },\n    level: 4,\n    repeatable: false\n  },\n  {\n    id: 'wizard_apprentice',\n    name: 'The Wizard\\'s Test',\n    description: 'The wizard wants to test your aptitude for magic.',\n    type: 'side',\n    giver: 'wizard',\n    prerequisites: ['grandmothers_secret'],\n    objectives: [\n      { type: 'collect', target: 'crystal_shard', count: 10, description: 'Collect 10 Crystal Shards' },\n      { type: 'craft', target: 'arcane_focus', count: 1, description: 'Craft an Arcane Focus' },\n      { type: 'talk', target: 'wizard', count: 1, description: 'Return to the Wizard' }\n    ],\n    rewards: { xp: 300, gold: 800, items: [{ itemId: 'spellbook', quantity: 1 }] },\n    dialogue: {\n      offer: 'I see potential in you. Gather crystal shards and craft an arcane focus to prove it.',\n      inProgress: 'Crystal shards can be found in the mines. The crafting recipe is in your journal.',\n      complete: 'Impressive! You have the gift. Take this spellbook and study well.'\n    },\n    level: 8,\n    repeatable: false\n  },\n\n  // =============================================\n  // SIDE QUESTS: Exploration & City Discovery\n  // =============================================\n  {\n    id: 'find_ironhold',\n    name: 'The Mining Fortress',\n    description: 'Rumors speak of a fortress carved into the mountains. Find Ironhold.',\n    type: 'side',\n    giver: 'blacksmith',\n    prerequisites: [],\n    objectives: [\n      { type: 'explore', target: 'wilderness_2000m', count: 1, description: 'Travel far from Haven' },\n      { type: 'explore', target: 'ironhold', count: 1, description: 'Discover Ironhold' }\n    ],\n    rewards: { xp: 400, gold: 1000, items: [] },\n    dialogue: {\n      offer: \"There's an old mining fortress in the mountains. If you find it, the ores there are legendary.\",\n      inProgress: 'Keep heading toward the mountains. Ironhold is out there somewhere.',\n      complete: 'You found Ironhold! The dwarven forge still burns. This changes everything.'\n    },\n    level: 10,\n    repeatable: false\n  },\n  {\n    id: 'find_verdant_rest',\n    name: 'Sanctuary in the Forest',\n    description: 'Herbalists speak of a hidden grove where healing plants grow.',\n    type: 'side',\n    giver: 'doctor',\n    prerequisites: [],\n    objectives: [\n      { type: 'collect', target: 'rare_herb', count: 10, description: 'Gather 10 Rare Herbs' },\n      { type: 'explore', target: 'verdant_rest', count: 1, description: 'Discover Verdant Rest' }\n    ],\n    rewards: { xp: 400, gold: 1000, items: [{ itemId: 'healing_salve', quantity: 5 }] },\n    dialogue: {\n      offer: 'Ancient texts describe a grove of miraculous healing plants. Find it for me.',\n      inProgress: 'Follow the rare herbs. They grow more densely near Verdant Rest.',\n      complete: 'Verdant Rest! The healing energies here are extraordinary.'\n    },\n    level: 10,\n    repeatable: false\n  },\n  {\n    id: 'find_grimwatch',\n    name: \"The Warrior's Outpost\",\n    description: 'Veterans speak of a military outpost on the frontier. Seek Grimwatch.',\n    type: 'side',\n    giver: 'adventurer',\n    prerequisites: ['darkness_awakens'],\n    objectives: [\n      { type: 'kill', target: 'any', count: 50, description: 'Prove your combat skills (50 kills)' },\n      { type: 'explore', target: 'grimwatch', count: 1, description: 'Discover Grimwatch' }\n    ],\n    rewards: { xp: 500, gold: 1500, items: [{ itemId: 'battle_standard', quantity: 1 }] },\n    dialogue: {\n      offer: 'Grimwatch is where the real warriors train. Prove yourself first, then find it.',\n      inProgress: 'You need more combat experience before Grimwatch will accept you.',\n      complete: 'Welcome to Grimwatch, warrior. You have earned your place here.'\n    },\n    level: 15,\n    repeatable: false\n  },\n\n  // =============================================\n  // SIDE QUESTS: Monster Hunting\n  // =============================================\n  {\n    id: 'slime_king_hunt',\n    name: 'The Slime King',\n    description: 'A massive slime has been spotted in the mines. End its reign!',\n    type: 'side',\n    giver: 'adventurer',\n    prerequisites: ['dungeon_intro'],\n    objectives: [\n      { type: 'reach', target: 'mine_floor_20', count: 1, description: 'Reach Mine Floor 20' },\n      { type: 'kill', target: 'slime_king', count: 1, description: 'Defeat the Slime King' }\n    ],\n    rewards: { xp: 500, gold: 2000, items: [{ itemId: 'slime_crown', quantity: 1 }] },\n    dialogue: {\n      offer: 'A Slime King lurks on floor 20. Big reward for anyone who takes it down.',\n      inProgress: 'The Slime King is deep in the mines. Be prepared.',\n      complete: 'The Slime King is no more! This crown is your trophy.'\n    },\n    level: 10,\n    repeatable: false\n  },\n  {\n    id: 'shadow_lord_hunt',\n    name: 'Shadow in the Deep',\n    description: 'A dark presence lurks in the depths. Only the brave dare face it.',\n    type: 'side',\n    giver: 'wizard',\n    prerequisites: ['slime_king_hunt'],\n    objectives: [\n      { type: 'reach', target: 'mine_floor_50', count: 1, description: 'Reach Mine Floor 50' },\n      { type: 'kill', target: 'shadow_lord', count: 1, description: 'Defeat the Shadow Lord' }\n    ],\n    rewards: { xp: 1000, gold: 5000, items: [{ itemId: 'shadow_blade', quantity: 1 }] },\n    dialogue: {\n      offer: 'A Shadow Lord commands the deep mines. It must be destroyed.',\n      inProgress: 'The shadows grow thicker as you descend. The lord waits at floor 50.',\n      complete: 'The Shadow Lord is banished! This blade was forged from its essence.'\n    },\n    level: 20,\n    repeatable: false\n  },\n  {\n    id: 'frost_wyrm_hunt',\n    name: 'The Frozen Terror',\n    description: 'An ancient dragon sleeps in the icy depths. Wake it at your peril.',\n    type: 'side',\n    giver: 'wizard',\n    prerequisites: ['shadow_lord_hunt'],\n    objectives: [\n      { type: 'reach', target: 'mine_floor_80', count: 1, description: 'Reach Mine Floor 80' },\n      { type: 'kill', target: 'frost_wyrm', count: 1, description: 'Defeat the Frost Wyrm' }\n    ],\n    rewards: { xp: 1500, gold: 7500, items: [{ itemId: 'frozen_heart', quantity: 1 }] },\n    dialogue: {\n      offer: 'An ancient wyrm sleeps in the deepest ice. Only a true warrior can face it.',\n      inProgress: 'Floor 80 is treacherous. Bring fire resistance gear.',\n      complete: 'Incredible! The Frozen Heart still beats with the wyrm\\'s power.'\n    },\n    level: 30,\n    repeatable: false\n  },\n  {\n    id: 'wolf_pack',\n    name: 'Wolf Pack',\n    description: 'A pack of wolves has been spotted near the mines.',\n    type: 'side',\n    giver: 'adventurer',\n    prerequisites: [],\n    objectives: [\n      { type: 'kill', target: 'wolf', count: 10, description: 'Defeat 10 Wolves' },\n      { type: 'collect', target: 'fang', count: 5, description: 'Collect 5 Fangs' }\n    ],\n    rewards: { xp: 200, gold: 400, items: [{ itemId: 'fur', quantity: 5 }] },\n    dialogue: {\n      offer: 'Wolves are threatening travelers on the mountain path. Deal with them.',\n      inProgress: 'The wolves roam near the mine entrance. Be careful in packs.',\n      complete: 'The paths are safe again. Keep the fur as a reward.'\n    },\n    level: 5,\n    repeatable: false\n  },\n  {\n    id: 'ghost_hunter',\n    name: 'Ghost Hunter',\n    description: 'Restless spirits haunt the deeper mines.',\n    type: 'side',\n    giver: 'wizard',\n    prerequisites: [],\n    objectives: [\n      { type: 'kill', target: 'ghost', count: 15, description: 'Banish 15 Ghosts' },\n      { type: 'collect', target: 'ectoplasm', count: 5, description: 'Collect 5 Ectoplasm' }\n    ],\n    rewards: { xp: 300, gold: 600, items: [{ itemId: 'spirit_shard', quantity: 2 }] },\n    dialogue: {\n      offer: 'Spirits wander the mines, unable to rest. Banish them and bring me ectoplasm.',\n      inProgress: 'Ghosts dwell below floor 15. Use enchanted weapons if you can.',\n      complete: 'The spirits are at peace. These shards hold residual energy.'\n    },\n    level: 8,\n    repeatable: false\n  },\n\n  // =============================================\n  // SIDE QUESTS: Skills & Activities\n  // =============================================\n  {\n    id: 'wizard_artifact',\n    name: 'Ancient Knowledge',\n    description: 'The wizard seeks an ancient artifact from the depths.',\n    type: 'side',\n    giver: 'wizard',\n    prerequisites: [],\n    objectives: [\n      { type: 'collect', target: 'ancient_artifact', count: 1, description: 'Find the Ancient Artifact' }\n    ],\n    rewards: { xp: 500, gold: 1000, items: [{ itemId: 'magic_staff', quantity: 1 }] },\n    dialogue: {\n      offer: 'An artifact of immense power lies hidden. I need it for my research.',\n      inProgress: 'The artifact is somewhere in the mines. Look for glowing runes.',\n      complete: 'At last! This staff channels the artifact\\'s power. Take it, you have earned it.'\n    },\n    level: 8,\n    repeatable: false\n  },\n  {\n    id: 'fishing_lesson',\n    name: 'Gone Fishing',\n    description: 'Learn to fish and catch your first fish.',\n    type: 'side',\n    giver: 'innkeeper',\n    prerequisites: [],\n    objectives: [\n      { type: 'collect', target: 'fishing_rod', count: 1, description: 'Get a Fishing Rod' },\n      { type: 'fish', target: 'any_fish', count: 3, description: 'Catch 3 fish' }\n    ],\n    rewards: { xp: 50, gold: 100, items: [] },\n    dialogue: {\n      offer: \"There's good fishing by the river. Get yourself a rod and try your luck!\",\n      inProgress: 'Cast your line in the river. Patience is key.',\n      complete: 'Not bad for a beginner! Fishing is a great way to relax and earn coin.'\n    },\n    level: 1,\n    repeatable: false\n  },\n  {\n    id: 'master_the_blade',\n    name: 'Master the Blade',\n    description: 'Reach mastery with a sword and learn the ancient techniques.',\n    type: 'side',\n    giver: 'adventurer',\n    prerequisites: [],\n    objectives: [\n      { type: 'kill', target: 'any', count: 200, description: 'Defeat 200 enemies with a sword' }\n    ],\n    rewards: { xp: 500, gold: 2000, items: [{ itemId: 'legendary_sword', quantity: 1 }] },\n    dialogue: {\n      offer: 'A true swordsman has defeated hundreds. Prove your blade mastery.',\n      inProgress: 'Keep fighting. A master needs experience above all.',\n      complete: 'You have mastered the blade. This legendary sword is yours by right.'\n    },\n    level: 15,\n    repeatable: false\n  },\n  {\n    id: 'night_hunter',\n    name: 'Night Hunter',\n    description: 'The darkness holds stronger prey. Hunt the nightmare creatures.',\n    type: 'side',\n    giver: 'adventurer',\n    prerequisites: [],\n    objectives: [\n      { type: 'kill', target: 'nightmare_enemy', count: 20, description: 'Defeat 20 nightmare enemies (night-buffed)' },\n      { type: 'survive', target: 'nights_outside', count: 5, description: 'Survive 5 nights outside Haven' }\n    ],\n    rewards: { xp: 400, gold: 1500, items: [{ itemId: 'nightvision_goggles', quantity: 1 }] },\n    dialogue: {\n      offer: 'Nighttime creatures are far more dangerous. Think you can handle them?',\n      inProgress: 'The night holds terrors. Keep fighting after dark.',\n      complete: 'A true night hunter! These goggles will help you see in the dark.'\n    },\n    level: 12,\n    repeatable: false\n  },\n  {\n    id: 'master_angler',\n    name: 'Master Angler',\n    description: 'Catch one of every common fish species.',\n    type: 'side',\n    giver: 'innkeeper',\n    prerequisites: ['fishing_lesson'],\n    objectives: [\n      { type: 'fish', target: 'bass', count: 1, description: 'Catch a Bass' },\n      { type: 'fish', target: 'trout', count: 1, description: 'Catch a Trout' },\n      { type: 'fish', target: 'salmon', count: 1, description: 'Catch a Salmon' },\n      { type: 'fish', target: 'catfish', count: 1, description: 'Catch a Catfish' },\n      { type: 'fish', target: 'pike', count: 1, description: 'Catch a Pike' }\n    ],\n    rewards: { xp: 300, gold: 800, items: [{ itemId: 'iridium_rod', quantity: 1 }] },\n    dialogue: {\n      offer: \"Think you can catch every fish in these waters? I'll reward a true angler.\",\n      inProgress: 'Different fish appear in different seasons and locations.',\n      complete: \"You've caught them all! You're a master angler. Take this iridium rod.\"\n    },\n    level: 5,\n    repeatable: false\n  },\n  {\n    id: 'farm_expansion',\n    name: 'Growing Ambitions',\n    description: 'Expand your farm and grow a variety of crops.',\n    type: 'side',\n    giver: 'mayor',\n    prerequisites: ['first_harvest'],\n    objectives: [\n      { type: 'farm', target: 'till_soil', count: 30, description: 'Till 30 plots of soil' },\n      { type: 'farm', target: 'plant_seeds', count: 30, description: 'Plant 30 different seeds' },\n      { type: 'collect', target: 'any_crop', count: 50, description: 'Harvest 50 total crops' }\n    ],\n    rewards: { xp: 250, gold: 600, items: [{ itemId: 'sprinkler', quantity: 3 }] },\n    dialogue: {\n      offer: 'Your farm could be so much more! Expand your fields and grow more crops.',\n      inProgress: 'Keep planting and harvesting. The farm is growing!',\n      complete: 'Look at this farm! These sprinklers will help you manage it all.'\n    },\n    level: 5,\n    repeatable: false\n  },\n  {\n    id: 'apprentice_chef',\n    name: 'Apprentice Chef',\n    description: 'Learn to cook and prepare basic recipes.',\n    type: 'side',\n    giver: 'innkeeper',\n    prerequisites: [],\n    objectives: [\n      { type: 'cook', target: 'fried_egg', count: 3, description: 'Cook 3 Fried Eggs' },\n      { type: 'cook', target: 'vegetable_soup', count: 2, description: 'Cook 2 Vegetable Soups' },\n      { type: 'cook', target: 'bread', count: 3, description: 'Bake 3 Loaves of Bread' }\n    ],\n    rewards: { xp: 150, gold: 300, items: [{ itemId: 'recipe_book', quantity: 1 }] },\n    dialogue: {\n      offer: 'Every adventurer should know how to cook! Let me teach you the basics.',\n      inProgress: 'Use the kitchen in the tavern to practice your cooking.',\n      complete: 'Delicious! This recipe book has more advanced dishes for you.'\n    },\n    level: 2,\n    repeatable: false\n  },\n  {\n    id: 'mining_fundamentals',\n    name: 'Strike the Earth',\n    description: 'Learn the basics of mining and ore processing.',\n    type: 'side',\n    giver: 'blacksmith',\n    prerequisites: [],\n    objectives: [\n      { type: 'mine', target: 'copper_ore', count: 20, description: 'Mine 20 Copper Ore' },\n      { type: 'mine', target: 'iron_ore', count: 10, description: 'Mine 10 Iron Ore' },\n      { type: 'craft', target: 'copper_bar', count: 5, description: 'Smelt 5 Copper Bars' }\n    ],\n    rewards: { xp: 150, gold: 300, items: [{ itemId: 'steel_pickaxe', quantity: 1 }] },\n    dialogue: {\n      offer: 'The mines are full of ore, but you need to know what to look for.',\n      inProgress: 'Copper is common on early floors. Iron appears deeper.',\n      complete: 'Good work! This steel pickaxe will serve you well in the deeper mines.'\n    },\n    level: 3,\n    repeatable: false\n  },\n\n  // =============================================\n  // SIDE QUESTS: Repeatable\n  // =============================================\n  {\n    id: 'town_cleanup',\n    name: 'Town Cleanup',\n    description: 'Help keep the town clean by gathering debris.',\n    type: 'side',\n    giver: 'mayor',\n    prerequisites: [],\n    objectives: [\n      { type: 'collect', target: 'fiber', count: 20, description: 'Collect 20 Fiber' },\n      { type: 'collect', target: 'wood', count: 10, description: 'Collect 10 Wood' }\n    ],\n    rewards: { xp: 30, gold: 150, items: [] },\n    dialogue: {\n      offer: 'The town square is covered in debris. Help us clean it up!',\n      inProgress: 'Gather the fiber and wood scattered around town.',\n      complete: 'The town looks much better! Thank you for your help.'\n    },\n    level: 1,\n    repeatable: true\n  },\n  {\n    id: 'slime_extermination',\n    name: 'Slime Problem',\n    description: 'The slimes are multiplying too fast. Thin their numbers.',\n    type: 'side',\n    giver: 'adventurer',\n    prerequisites: [],\n    objectives: [\n      { type: 'kill', target: 'slime', count: 25, description: 'Defeat 25 Slimes' },\n      { type: 'collect', target: 'slime_gel', count: 10, description: 'Collect 10 Slime Gel' }\n    ],\n    rewards: { xp: 150, gold: 300, items: [] },\n    dialogue: {\n      offer: 'Slimes are everywhere again. Time to thin the herd.',\n      inProgress: 'Keep slaying slimes. They drop gel when defeated.',\n      complete: 'That should keep the population down... for now.'\n    },\n    level: 3,\n    repeatable: true\n  },\n\n  // =============================================\n  // DAILY QUESTS\n  // =============================================\n  {\n    id: 'daily_farming',\n    name: 'Farming Contract',\n    description: 'Deliver fresh produce to the tavern.',\n    type: 'daily',\n    giver: 'innkeeper',\n    prerequisites: [],\n    objectives: [\n      { type: 'deliver', target: 'any_crop', count: 10, description: 'Deliver 10 fresh crops' }\n    ],\n    rewards: { xp: 50, gold: 200, items: [] },\n    dialogue: {\n      offer: \"The tavern needs fresh produce today. Bring what you've got!\",\n      inProgress: 'I still need those crops. Any variety will do.',\n      complete: 'Fresh from the farm! The patrons will love this.'\n    },\n    level: 1,\n    repeatable: true\n  },\n  {\n    id: 'daily_mining',\n    name: 'Mining Contract',\n    description: 'Deliver ore to the blacksmith.',\n    type: 'daily',\n    giver: 'blacksmith',\n    prerequisites: [],\n    objectives: [\n      { type: 'deliver', target: 'any_ore', count: 15, description: 'Deliver 15 ore of any type' }\n    ],\n    rewards: { xp: 45, gold: 225, items: [] },\n    dialogue: {\n      offer: \"Running low on materials. Bring me whatever ore you can find.\",\n      inProgress: 'I need more ore. The mines are full of it.',\n      complete: \"Good quality ore! I'll put it to good use.\"\n    },\n    level: 3,\n    repeatable: true\n  },\n  {\n    id: 'daily_slaying',\n    name: 'Monster Bounty',\n    description: 'Thin out the monster population.',\n    type: 'daily',\n    giver: 'adventurer',\n    prerequisites: [],\n    objectives: [\n      { type: 'kill', target: 'any', count: 15, description: 'Slay 15 monsters' }\n    ],\n    rewards: { xp: 80, gold: 150, items: [] },\n    dialogue: {\n      offer: 'Monsters are getting bold again. Go show them who is boss.',\n      inProgress: 'More monsters to slay. Check the mines and wilderness.',\n      complete: 'Nice work! That should keep them at bay for today.'\n    },\n    level: 3,\n    repeatable: true\n  },\n  {\n    id: 'daily_foraging',\n    name: 'Foraging Run',\n    description: 'Gather wild items from the forest.',\n    type: 'daily',\n    giver: 'doctor',\n    prerequisites: [],\n    objectives: [\n      { type: 'collect', target: 'wild_herb', count: 8, description: 'Gather 8 wild herbs' },\n      { type: 'collect', target: 'wild_berry', count: 5, description: 'Gather 5 wild berries' }\n    ],\n    rewards: { xp: 40, gold: 120, items: [] },\n    dialogue: {\n      offer: 'I need fresh herbs and berries for today\\'s medicines.',\n      inProgress: 'Check the forest paths for herbs and berry bushes.',\n      complete: 'Fresh and potent! These will make excellent remedies.'\n    },\n    level: 1,\n    repeatable: true\n  },\n  {\n    id: 'daily_fishing',\n    name: 'Fresh Catch',\n    description: 'The tavern needs fresh fish for tonight\\'s menu.',\n    type: 'daily',\n    giver: 'innkeeper',\n    prerequisites: ['fishing_lesson'],\n    objectives: [\n      { type: 'fish', target: 'any_fish', count: 5, description: 'Catch 5 fish' }\n    ],\n    rewards: { xp: 40, gold: 150, items: [] },\n    dialogue: {\n      offer: \"Tonight's special is fish stew! Bring me 5 fresh catches.\",\n      inProgress: \"I'm counting on those fish! Try the river or the lake.\",\n      complete: 'Beautiful catches! The stew will be fantastic tonight.'\n    },\n    level: 2,\n    repeatable: true\n  },\n\n  // =============================================\n  // WEEKLY QUESTS\n  // =============================================\n  {\n    id: 'weekly_deep_dive',\n    name: 'Deep Dive',\n    description: 'Explore the deepest reaches of the mines this week.',\n    type: 'weekly',\n    giver: 'adventurer',\n    prerequisites: ['dungeon_intro'],\n    objectives: [\n      { type: 'kill', target: 'any', count: 100, description: 'Defeat 100 monsters in the mines' },\n      { type: 'mine', target: 'any_ore', count: 50, description: 'Mine 50 ore' },\n      { type: 'reach', target: 'mine_floor_new', count: 1, description: 'Reach a new personal best floor' }\n    ],\n    rewards: { xp: 500, gold: 1500, items: [{ itemId: 'rare_gem', quantity: 2 }] },\n    dialogue: {\n      offer: 'This week\\'s challenge: push deeper than ever into the mines.',\n      inProgress: 'Keep mining and fighting. The depths await.',\n      complete: 'A record-breaking week! These rare gems are your bonus.'\n    },\n    level: 5,\n    repeatable: true\n  },\n  {\n    id: 'weekly_harvest_festival',\n    name: 'Harvest Festival Prep',\n    description: 'Grow and deliver a large quantity of crops for the weekly market.',\n    type: 'weekly',\n    giver: 'mayor',\n    prerequisites: ['first_harvest'],\n    objectives: [\n      { type: 'collect', target: 'any_crop', count: 100, description: 'Harvest 100 crops' },\n      { type: 'deliver', target: 'any_crop', count: 50, description: 'Deliver 50 crops to the market' }\n    ],\n    rewards: { xp: 400, gold: 2000, items: [{ itemId: 'quality_fertilizer', quantity: 10 }] },\n    dialogue: {\n      offer: 'The weekly market needs a big harvest! Can you contribute?',\n      inProgress: 'Keep farming! The market needs a hundred crops harvested.',\n      complete: 'What a harvest! The market was a huge success.'\n    },\n    level: 3,\n    repeatable: true\n  },\n  {\n    id: 'weekly_trade_route',\n    name: 'Trade Route',\n    description: 'Establish trade by delivering goods between settlements.',\n    type: 'weekly',\n    giver: 'shopkeeper',\n    prerequisites: ['find_ironhold'],\n    objectives: [\n      { type: 'deliver', target: 'trade_goods', count: 20, description: 'Deliver 20 trade goods to Ironhold' },\n      { type: 'collect', target: 'ironhold_goods', count: 20, description: 'Bring back 20 Ironhold goods' }\n    ],\n    rewards: { xp: 350, gold: 1800, items: [{ itemId: 'merchant_badge', quantity: 1 }] },\n    dialogue: {\n      offer: 'Trade between Haven and Ironhold would benefit everyone. Will you be our courier?',\n      inProgress: 'Deliver goods to Ironhold and bring back their wares.',\n      complete: 'The trade route is established! Commerce flows between our towns.'\n    },\n    level: 10,\n    repeatable: true\n  },\n\n  // =============================================\n  // BOUNTY QUESTS\n  // =============================================\n  {\n    id: 'bounty_skeleton_horde',\n    name: 'Skeleton Horde',\n    description: 'A horde of skeletons threatens the lower mines. Eliminate them.',\n    type: 'bounty',\n    giver: 'adventurer',\n    prerequisites: ['dungeon_intro'],\n    objectives: [\n      { type: 'kill', target: 'skeleton', count: 30, description: 'Destroy 30 Skeletons' },\n      { type: 'collect', target: 'bone_fragment', count: 15, description: 'Collect 15 Bone Fragments' }\n    ],\n    rewards: { xp: 250, gold: 500, items: [] },\n    dialogue: {\n      offer: 'BOUNTY: Skeleton horde in the mines. 500 gold reward.',\n      inProgress: 'Skeletons rattle in the dark. Keep breaking them apart.',\n      complete: 'Bounty fulfilled. The bones are quiet again.'\n    },\n    level: 7,\n    repeatable: true\n  },\n  {\n    id: 'bounty_bat_infestation',\n    name: 'Bat Infestation',\n    description: 'Giant bats have overrun the upper mine levels.',\n    type: 'bounty',\n    giver: 'adventurer',\n    prerequisites: [],\n    objectives: [\n      { type: 'kill', target: 'bat', count: 20, description: 'Exterminate 20 Bats' },\n      { type: 'collect', target: 'bat_wing', count: 10, description: 'Collect 10 Bat Wings' }\n    ],\n    rewards: { xp: 100, gold: 250, items: [] },\n    dialogue: {\n      offer: 'BOUNTY: Bat infestation in the mines. 250 gold reward.',\n      inProgress: 'The bats swarm in the upper levels. Bring a good weapon.',\n      complete: 'Bounty fulfilled. The skies underground are clear.'\n    },\n    level: 3,\n    repeatable: true\n  },\n  {\n    id: 'bounty_goblin_raiders',\n    name: 'Goblin Raiders',\n    description: 'Goblins have been raiding supply caravans. Stop them.',\n    type: 'bounty',\n    giver: 'adventurer',\n    prerequisites: ['dungeon_intro'],\n    objectives: [\n      { type: 'kill', target: 'goblin', count: 20, description: 'Defeat 20 Goblins' },\n      { type: 'collect', target: 'stolen_goods', count: 5, description: 'Recover 5 Stolen Goods' }\n    ],\n    rewards: { xp: 200, gold: 450, items: [{ itemId: 'goblin_trophy', quantity: 1 }] },\n    dialogue: {\n      offer: 'BOUNTY: Goblin raiders on the trade routes. 450 gold reward.',\n      inProgress: 'The goblins camp near the mountain pass. They hoard stolen goods.',\n      complete: 'Bounty fulfilled. The trade routes are safe once more.'\n    },\n    level: 8,\n    repeatable: true\n  },\n  {\n    id: 'bounty_spider_nest',\n    name: 'Spider Nest',\n    description: 'A giant spider has built a nest in the caves. Destroy it.',\n    type: 'bounty',\n    giver: 'adventurer',\n    prerequisites: [],\n    objectives: [\n      { type: 'kill', target: 'spider', count: 15, description: 'Kill 15 Spiders' },\n      { type: 'kill', target: 'spider_queen', count: 1, description: 'Destroy the Spider Queen' }\n    ],\n    rewards: { xp: 300, gold: 600, items: [{ itemId: 'spider_silk', quantity: 10 }] },\n    dialogue: {\n      offer: 'BOUNTY: Spider nest in the eastern caves. 600 gold reward.',\n      inProgress: 'Follow the webs deeper. The queen lurks at the center.',\n      complete: 'Bounty fulfilled. The nest is destroyed. Keep the silk.'\n    },\n    level: 10,\n    repeatable: true\n  },\n  {\n    id: 'bounty_undead_uprising',\n    name: 'Undead Uprising',\n    description: 'The dead are rising in the cemetery. Put them back to rest.',\n    type: 'bounty',\n    giver: 'wizard',\n    prerequisites: ['ghost_hunter'],\n    objectives: [\n      { type: 'kill', target: 'zombie', count: 25, description: 'Destroy 25 Zombies' },\n      { type: 'kill', target: 'skeleton_warrior', count: 10, description: 'Defeat 10 Skeleton Warriors' },\n      { type: 'collect', target: 'cursed_bone', count: 5, description: 'Collect 5 Cursed Bones' }\n    ],\n    rewards: { xp: 400, gold: 800, items: [{ itemId: 'holy_water', quantity: 5 }] },\n    dialogue: {\n      offer: 'BOUNTY: Undead uprising at the old cemetery. 800 gold reward.',\n      inProgress: 'The undead grow restless at night. Strike during the day if you can.',\n      complete: 'Bounty fulfilled. The dead rest once more. Take this holy water.'\n    },\n    level: 12,\n    repeatable: true\n  },\n\n  // =============================================\n  // LEGENDARY QUESTS\n  // =============================================\n  {\n    id: 'legend_of_the_void',\n    name: 'Legend of the Void',\n    description: 'Uncover the secrets of the void dimension and defeat the Shadow Lord.',\n    type: 'legendary',\n    giver: 'wizard',\n    prerequisites: [],\n    objectives: [\n      { type: 'collect', target: 'void_essence', count: 50, description: 'Collect 50 Void Essence from shadow creatures' },\n      { type: 'explore', target: 'void_portal', count: 1, description: 'Locate the hidden void portal in the deepest mines' },\n      { type: 'kill', target: 'shadow_lord_void', count: 1, description: 'Challenge and defeat the Shadow Lord in his domain' }\n    ],\n    rewards: {\n      xp: 5000,\n      gold: 13000,\n      items: [\n        { itemId: 'void_amulet', quantity: 1 },\n        { itemId: 'galaxy_sword', quantity: 1 },\n        { itemId: 'void_crown', quantity: 1 },\n        { itemId: 'void_talisman', quantity: 1 }\n      ],\n      unlocks: ['void_dimension_access']\n    },\n    dialogue: {\n      offer: 'The void calls to those who dare listen. Gather void essence and find the portal.',\n      inProgress: 'The Shadow Lord awaits in the void. Prepare yourself thoroughly.',\n      complete: 'You have conquered the void itself. The title of Voidwalker is yours.'\n    },\n    level: 40,\n    repeatable: false\n  },\n  {\n    id: 'the_ancient_fruit',\n    name: 'The Ancient Fruit',\n    description: 'Discover the legendary ancient fruit and unlock its secrets.',\n    type: 'legendary',\n    giver: 'wizard',\n    prerequisites: [],\n    objectives: [\n      { type: 'collect', target: 'ancient_seed', count: 1, description: 'Discover an Ancient Seed artifact' },\n      { type: 'farm', target: 'ancient_fruit', count: 1, description: 'Successfully grow and harvest an ancient fruit' },\n      { type: 'craft', target: 'ancient_wine_gold', count: 1, description: 'Brew ancient fruit wine and age it to gold quality' }\n    ],\n    rewards: {\n      xp: 3000,\n      gold: 6500,\n      items: [\n        { itemId: 'ancient_seed_packet', quantity: 5 },\n        { itemId: 'golden_watering_can', quantity: 1 }\n      ],\n      unlocks: ['ancient_greenhouse']\n    },\n    dialogue: {\n      offer: 'Legends tell of an ancient fruit with miraculous properties. Find its seed.',\n      inProgress: 'Grow the ancient fruit and brew wine from it. Patience is required.',\n      complete: 'Master Vintner! You have unlocked the secrets of the ancient fruit.'\n    },\n    level: 25,\n    repeatable: false\n  },\n  {\n    id: 'king_of_the_sea',\n    name: 'King of the Sea',\n    description: 'Become the greatest fisher and catch all legendary fish.',\n    type: 'legendary',\n    giver: 'innkeeper',\n    prerequisites: ['fishing_lesson'],\n    objectives: [\n      { type: 'fish', target: 'legend', count: 1, description: 'Catch the legendary fish known as \"Legend\"' },\n      { type: 'fish', target: 'glacierfish', count: 1, description: 'Brave the frozen waters and catch the Glacierfish' },\n      { type: 'fish', target: 'crimsonfish', count: 1, description: 'Catch the elusive Crimsonfish from the summer seas' },\n      { type: 'fish', target: 'angler', count: 1, description: 'Find and catch the Angler in its hidden location' },\n      { type: 'fish', target: 'mutant_carp', count: 1, description: 'Catch the mysterious Mutant Carp from the sewers' }\n    ],\n    rewards: {\n      xp: 5000,\n      gold: 12500,\n      items: [\n        { itemId: 'neptune_trident', quantity: 1 },\n        { itemId: 'master_bait', quantity: 100 }\n      ],\n      unlocks: ['ocean_temple']\n    },\n    dialogue: {\n      offer: 'Five legendary fish swim in these waters. Catch them all and earn the title.',\n      inProgress: 'Each legendary fish has its own territory and season. Study the waters.',\n      complete: 'All five legendary fish! You are the undisputed King of the Sea!'\n    },\n    level: 30,\n    repeatable: false\n  },\n  {\n    id: 'dragon_slayer',\n    name: 'Dragon Slayer',\n    description: 'Prepare yourself and slay the ancient dragon.',\n    type: 'legendary',\n    giver: 'adventurer',\n    prerequisites: ['frost_wyrm_hunt'],\n    objectives: [\n      { type: 'craft', target: 'dragonbane_sword', count: 1, description: 'Forge the legendary dragon-slaying sword Dragonbane' },\n      { type: 'collect', target: 'dragon_scale', count: 20, description: 'Collect 20 dragon scales to craft protective armor' },\n      { type: 'kill', target: 'ancient_dragon', count: 1, description: \"Enter the dragon's lair and defeat the ancient beast\" }\n    ],\n    rewards: {\n      xp: 10000,\n      gold: 58000,\n      items: [\n        { itemId: 'dragon_armor', quantity: 1 },\n        { itemId: 'dragon_heart', quantity: 1 },\n        { itemId: 'dragon_mount', quantity: 1 },\n        { itemId: 'prismatic_shard', quantity: 5 }\n      ],\n      unlocks: ['dragon_lair_home']\n    },\n    dialogue: {\n      offer: 'The ancient dragon stirs. Forge Dragonbane, gather scales, and face the beast.',\n      inProgress: 'You are not yet ready. Forge the sword. Craft the armor. Then fight.',\n      complete: 'Dragon Slayer! The beast is fallen and its lair is yours.'\n    },\n    level: 45,\n    repeatable: false\n  },\n  {\n    id: 'legend_community_restoration',\n    name: 'Community Restoration',\n    description: 'Restore the community center and bring prosperity to the valley.',\n    type: 'legendary',\n    giver: 'mayor',\n    prerequisites: ['community_restoration'],\n    objectives: [\n      { type: 'collect', target: 'crafts_room_bundle', count: 1, description: 'Complete the Crafts Room bundles' },\n      { type: 'collect', target: 'pantry_bundle', count: 1, description: 'Complete the Pantry bundles' },\n      { type: 'collect', target: 'fish_tank_bundle', count: 1, description: 'Complete the Fish Tank bundles' },\n      { type: 'collect', target: 'boiler_room_bundle', count: 1, description: 'Complete the Boiler Room bundles' },\n      { type: 'collect', target: 'bulletin_board_bundle', count: 1, description: 'Complete the Bulletin Board bundles' },\n      { type: 'collect', target: 'vault_bundle', count: 1, description: 'Complete the Vault donation' }\n    ],\n    rewards: {\n      xp: 5000,\n      gold: 7000,\n      items: [{ itemId: 'stardrop', quantity: 1 }],\n      unlocks: ['movie_theater', 'bus_repair']\n    },\n    dialogue: {\n      offer: 'The community center has six rooms to restore. Each requires special bundles.',\n      inProgress: 'Keep gathering items for the bundles. Every room matters.',\n      complete: 'Valley Hero! The community center shines with renewed purpose!'\n    },\n    level: 20,\n    repeatable: false\n  },\n\n  // =============================================\n  // ADDITIONAL SIDE QUESTS\n  // =============================================\n  {\n    id: 'the_lost_shipment',\n    name: 'The Lost Shipment',\n    description: 'A supply shipment went missing on the road to Haven. Find it.',\n    type: 'side',\n    giver: 'shopkeeper',\n    prerequisites: [],\n    objectives: [\n      { type: 'explore', target: 'east_road', count: 1, description: 'Search the East Road' },\n      { type: 'collect', target: 'lost_crate', count: 3, description: 'Recover 3 Lost Supply Crates' },\n      { type: 'deliver', target: 'lost_crate', count: 3, description: 'Return crates to the General Store' }\n    ],\n    rewards: { xp: 100, gold: 300, items: [{ itemId: 'supply_voucher', quantity: 1 }] },\n    dialogue: {\n      offer: 'My last shipment never arrived! Something must have happened on the East Road.',\n      inProgress: 'The crates should be somewhere along the East Road. Watch for bandits.',\n      complete: 'My supplies! You saved my business. Take this voucher for a discount.'\n    },\n    level: 3,\n    repeatable: false\n  },\n  {\n    id: 'ancient_library',\n    name: 'The Ancient Library',\n    description: 'The wizard has discovered clues to a hidden library of forbidden knowledge.',\n    type: 'side',\n    giver: 'wizard',\n    prerequisites: ['wizard_artifact'],\n    objectives: [\n      { type: 'collect', target: 'library_key_fragment', count: 3, description: 'Find 3 Library Key Fragments' },\n      { type: 'explore', target: 'ancient_library', count: 1, description: 'Discover the Ancient Library' },\n      { type: 'collect', target: 'forbidden_tome', count: 1, description: 'Retrieve the Forbidden Tome' }\n    ],\n    rewards: { xp: 500, gold: 1200, items: [{ itemId: 'enchantment_scroll', quantity: 3 }] },\n    dialogue: {\n      offer: 'I have found references to a hidden library. Help me find the key fragments.',\n      inProgress: 'The key fragments are scattered across the dungeons. Keep searching.',\n      complete: 'The Forbidden Tome! This knowledge was thought lost forever.'\n    },\n    level: 15,\n    repeatable: false\n  },\n  {\n    id: 'haunted_mine_mystery',\n    name: 'The Haunted Mine',\n    description: 'Strange sounds echo from an abandoned mine shaft. Investigate.',\n    type: 'side',\n    giver: 'blacksmith',\n    prerequisites: ['dungeon_intro'],\n    objectives: [\n      { type: 'explore', target: 'abandoned_shaft', count: 1, description: 'Enter the Abandoned Mine Shaft' },\n      { type: 'collect', target: 'miners_journal', count: 1, description: \"Find the old miner's journal\" },\n      { type: 'kill', target: 'mine_wraith', count: 1, description: 'Defeat the Mine Wraith' }\n    ],\n    rewards: { xp: 350, gold: 700, items: [{ itemId: 'spectral_pickaxe', quantity: 1 }] },\n    dialogue: {\n      offer: 'An old mine shaft has been making strange noises. My grandfather worked there.',\n      inProgress: 'The shaft is dangerous. Look for the journal to understand what happened.',\n      complete: 'The wraith was the old foreman... rest easy now. This pickaxe was his.'\n    },\n    level: 10,\n    repeatable: false\n  },\n  {\n    id: 'mayors_request',\n    name: \"The Mayor's Special Request\",\n    description: 'The mayor needs rare items for an important diplomatic meeting.',\n    type: 'side',\n    giver: 'mayor',\n    prerequisites: ['welcome_quest'],\n    objectives: [\n      { type: 'collect', target: 'gold_bar', count: 5, description: 'Obtain 5 Gold Bars' },\n      { type: 'collect', target: 'diamond', count: 1, description: 'Find a Diamond' },\n      { type: 'cook', target: 'gourmet_meal', count: 1, description: 'Prepare a Gourmet Meal' }\n    ],\n    rewards: { xp: 300, gold: 1500, items: [{ itemId: 'mayors_medallion', quantity: 1 }] },\n    dialogue: {\n      offer: 'I have an important diplomatic meeting. I need gold, a diamond, and fine food.',\n      inProgress: 'Those items are not easy to obtain, but I have faith in you.',\n      complete: 'Magnificent! The meeting will be a success. Accept this medallion.'\n    },\n    level: 12,\n    repeatable: false\n  }\n];\n\nexport const QUEST_DB = new Map<string, QuestDef>(QUESTS.map(q => [q.id, q]));\n","import { QuestDef, QuestStatus, QuestObjective, ObjectiveType, QuestReward } from '../types/quest';\nimport { QUESTS, QUEST_DB } from '../data/quests';\n\n// ---------------------------------------------------------------------------\n// Save Data Shape\n// ---------------------------------------------------------------------------\n\ninterface QuestSaveData {\n  states: Record<string, QuestStatus>;\n  progress: Record<string, number[]>;\n  dailyResetTimer: number;\n  weeklyResetTimer: number;\n}\n\n// ---------------------------------------------------------------------------\n// Quest Manager\n// ---------------------------------------------------------------------------\n\n/**\n * Manages quest lifecycle: available -> active -> complete/failed -> turned_in.\n *\n * Other systems call `updateObjective()` when relevant actions occur (kills,\n * item pickups, exploration triggers, etc.). The manager checks all active\n * quests for matching objectives and auto-completes quests when every\n * objective is satisfied.\n */\nexport class QuestManager {\n  private questStates: Map<string, QuestStatus> = new Map();\n  private objectiveProgress: Map<string, number[]> = new Map(); // questId -> progress per objective\n  private dailyResetTimer: number = 0;\n  private weeklyResetTimer: number = 0;\n\n  // Callbacks\n  private questCompleteCallbacks: Array<(questId: string, rewards: QuestReward) => void> = [];\n  private objectiveUpdateCallbacks: Array<(questId: string, objectiveIndex: number, current: number, required: number) => void> = [];\n\n  // ---------------------------------------------------------------------------\n  // Accepting & Completing\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Check whether a quest can be accepted right now.\n   * Requirements: all prerequisites completed (or turned in), quest not\n   * already active/complete/turned_in.\n   */\n  canAccept(questId: string): boolean {\n    const def = QUEST_DB.get(questId);\n    if (!def) return false;\n\n    const currentStatus = this.questStates.get(questId);\n    // Already in progress or finished\n    if (currentStatus === 'active' || currentStatus === 'complete' || currentStatus === 'turned_in') {\n      return false;\n    }\n\n    // If it was failed previously and is not repeatable, block it\n    if (currentStatus === 'failed' && !def.repeatable) {\n      return false;\n    }\n\n    // Check prerequisites\n    for (const prereq of def.prerequisites) {\n      const prereqStatus = this.questStates.get(prereq);\n      if (prereqStatus !== 'complete' && prereqStatus !== 'turned_in') {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  /** Accept a quest if possible. Returns true on success. */\n  acceptQuest(questId: string): boolean {\n    if (!this.canAccept(questId)) return false;\n\n    const def = QUEST_DB.get(questId)!;\n    this.questStates.set(questId, 'active');\n    this.objectiveProgress.set(\n      questId,\n      def.objectives.map(() => 0),\n    );\n    return true;\n  }\n\n  /**\n   * Called by external systems whenever the player does something that might\n   * advance quest objectives (kill, collect, deliver, explore, craft, etc.).\n   *\n   * All active quests with matching objectives are updated. If every\n   * objective of a quest is met, the quest auto-completes.\n   */\n  updateObjective(type: ObjectiveType, target: string, amount: number = 1): void {\n    for (const [questId, status] of this.questStates) {\n      if (status !== 'active') continue;\n\n      const def = QUEST_DB.get(questId);\n      if (!def) continue;\n\n      const progress = this.objectiveProgress.get(questId);\n      if (!progress) continue;\n\n      let changed = false;\n\n      for (let i = 0; i < def.objectives.length; i++) {\n        const obj = def.objectives[i];\n        if (obj.type === type && obj.target === target) {\n          const prev = progress[i];\n          progress[i] = Math.min(progress[i] + amount, obj.count);\n          if (progress[i] !== prev) {\n            changed = true;\n            for (const cb of this.objectiveUpdateCallbacks) {\n              cb(questId, i, progress[i], obj.count);\n            }\n          }\n        }\n      }\n\n      // Check if all objectives are now met\n      if (changed && this.allObjectivesMet(def, progress)) {\n        this.completeQuest(questId);\n      }\n    }\n  }\n\n  /**\n   * Mark a quest as complete and fire callbacks. Returns the quest rewards,\n   * or null if the quest was not active.\n   */\n  completeQuest(questId: string): QuestReward | null {\n    const status = this.questStates.get(questId);\n    if (status !== 'active') return null;\n\n    const def = QUEST_DB.get(questId);\n    if (!def) return null;\n\n    this.questStates.set(questId, 'complete');\n\n    for (const cb of this.questCompleteCallbacks) {\n      cb(questId, def.rewards);\n    }\n\n    return def.rewards;\n  }\n\n  /** Mark a quest as failed. */\n  failQuest(questId: string): void {\n    if (this.questStates.get(questId) !== 'active') return;\n    this.questStates.set(questId, 'failed');\n    this.objectiveProgress.delete(questId);\n  }\n\n  /**\n   * Mark a completed quest as turned in. This is the final state for\n   * non-repeatable quests, and signals that rewards have been collected.\n   */\n  turnInQuest(questId: string): boolean {\n    if (this.questStates.get(questId) !== 'complete') return false;\n    this.questStates.set(questId, 'turned_in');\n    this.objectiveProgress.delete(questId);\n    return true;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Queries\n  // ---------------------------------------------------------------------------\n\n  /** Get all currently active quests with their progress. */\n  getActiveQuests(): { quest: QuestDef; progress: number[]; status: QuestStatus }[] {\n    const result: { quest: QuestDef; progress: number[]; status: QuestStatus }[] = [];\n    for (const [questId, status] of this.questStates) {\n      if (status !== 'active') continue;\n      const def = QUEST_DB.get(questId);\n      const progress = this.objectiveProgress.get(questId);\n      if (def && progress) {\n        result.push({ quest: def, progress: [...progress], status });\n      }\n    }\n    return result;\n  }\n\n  /**\n   * Return quests whose prerequisites are met but that are not currently\n   * active, complete, or turned in. An optional set of externally-completed\n   * IDs can supplement the internal state (for UI purposes).\n   */\n  getAvailableQuests(completedIds?: Set<string>): QuestDef[] {\n    const available: QuestDef[] = [];\n\n    for (const def of QUESTS) {\n      const status = this.questStates.get(def.id);\n\n      // Skip quests already in a non-available state\n      if (status === 'active' || status === 'complete' || status === 'turned_in') continue;\n      if (status === 'failed' && !def.repeatable) continue;\n\n      // Check prerequisites against internal state or external set\n      let prereqsMet = true;\n      for (const prereq of def.prerequisites) {\n        const prereqStatus = this.questStates.get(prereq);\n        const externallyComplete = completedIds?.has(prereq) ?? false;\n        if (\n          prereqStatus !== 'complete' &&\n          prereqStatus !== 'turned_in' &&\n          !externallyComplete\n        ) {\n          prereqsMet = false;\n          break;\n        }\n      }\n\n      if (prereqsMet) available.push(def);\n    }\n\n    return available;\n  }\n\n  /** Get the current status for a quest (defaults to 'available'). */\n  getQuestStatus(questId: string): QuestStatus {\n    return this.questStates.get(questId) ?? 'available';\n  }\n\n  /** Get objective progress array for a quest, or null if not tracked. */\n  getObjectiveProgress(questId: string): number[] | null {\n    const progress = this.objectiveProgress.get(questId);\n    return progress ? [...progress] : null;\n  }\n\n  /** Whether a quest has been completed (or turned in). */\n  isComplete(questId: string): boolean {\n    const status = this.questStates.get(questId);\n    return status === 'complete' || status === 'turned_in';\n  }\n\n  // ---------------------------------------------------------------------------\n  // Daily & Weekly Resets\n  // ---------------------------------------------------------------------------\n\n  /** Reset all daily quest states back to available. */\n  resetDailies(): void {\n    for (const def of QUESTS) {\n      if (def.type !== 'daily') continue;\n      const status = this.questStates.get(def.id);\n      if (status === 'complete' || status === 'turned_in' || status === 'failed') {\n        this.questStates.set(def.id, 'available');\n        this.objectiveProgress.delete(def.id);\n      }\n    }\n  }\n\n  /** Reset all weekly quest states back to available. */\n  resetWeeklies(): void {\n    for (const def of QUESTS) {\n      if (def.type !== 'weekly') continue;\n      const status = this.questStates.get(def.id);\n      if (status === 'complete' || status === 'turned_in' || status === 'failed') {\n        this.questStates.set(def.id, 'available');\n        this.objectiveProgress.delete(def.id);\n      }\n    }\n  }\n\n  /** Get remaining time until daily reset (in seconds). */\n  getDailyResetTimer(): number {\n    return this.dailyResetTimer;\n  }\n\n  /** Get remaining time until weekly reset (in seconds). */\n  getWeeklyResetTimer(): number {\n    return this.weeklyResetTimer;\n  }\n\n  /** Get a quest definition by ID. */\n  getQuestDef(questId: string): QuestDef | null {\n    return QUEST_DB.get(questId) ?? null;\n  }\n\n  /** Set the daily reset timer value (in seconds). */\n  setDailyResetTimer(seconds: number): void {\n    this.dailyResetTimer = seconds;\n  }\n\n  /** Set the weekly reset timer value (in seconds). */\n  setWeeklyResetTimer(seconds: number): void {\n    this.weeklyResetTimer = seconds;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Callbacks\n  // ---------------------------------------------------------------------------\n\n  /** Register a callback fired when any quest is completed. */\n  onQuestComplete(cb: (questId: string, rewards: QuestReward) => void): void {\n    this.questCompleteCallbacks.push(cb);\n  }\n\n  /** Register a callback fired when any objective is updated. */\n  onObjectiveUpdate(cb: (questId: string, objectiveIndex: number, current: number, required: number) => void): void {\n    this.objectiveUpdateCallbacks.push(cb);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Persistence\n  // ---------------------------------------------------------------------------\n\n  /** Serialize for save. */\n  serialize(): QuestSaveData {\n    const states: Record<string, QuestStatus> = {};\n    for (const [id, status] of this.questStates) {\n      states[id] = status;\n    }\n\n    const progress: Record<string, number[]> = {};\n    for (const [id, prog] of this.objectiveProgress) {\n      progress[id] = [...prog];\n    }\n\n    return {\n      states,\n      progress,\n      dailyResetTimer: this.dailyResetTimer,\n      weeklyResetTimer: this.weeklyResetTimer,\n    };\n  }\n\n  /** Deserialize from save. */\n  deserialize(data: QuestSaveData): void {\n    this.questStates.clear();\n    this.objectiveProgress.clear();\n\n    if (data.states) {\n      for (const [id, status] of Object.entries(data.states)) {\n        this.questStates.set(id, status as QuestStatus);\n      }\n    }\n\n    if (data.progress) {\n      for (const [id, prog] of Object.entries(data.progress)) {\n        this.objectiveProgress.set(id, [...prog]);\n      }\n    }\n\n    this.dailyResetTimer = data.dailyResetTimer ?? 0;\n    this.weeklyResetTimer = data.weeklyResetTimer ?? 0;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Internal\n  // ---------------------------------------------------------------------------\n\n  private allObjectivesMet(def: QuestDef, progress: number[]): boolean {\n    for (let i = 0; i < def.objectives.length; i++) {\n      if (progress[i] < def.objectives[i].count) return false;\n    }\n    return true;\n  }\n}\n","export interface PerkDef {\n  id: string;\n  name: string;\n  description: string;\n  level: number;\n}\n\nexport interface SkillDef {\n  id: string;\n  name: string;\n  description: string;\n  maxLevel: number;\n  xpPerLevel: number[];\n  perks: PerkDef[];\n}\n\nexport const SKILLS: SkillDef[] = [\n  {\n    id: 'farming', name: 'Farming',\n    description: 'Plant and harvest crops more efficiently.',\n    maxLevel: 10,\n    xpPerLevel: [50, 125, 250, 500, 1000, 1750, 2750, 4000, 6000, 10000],\n    perks: [\n      { id: 'green_thumb', name: 'Green Thumb', description: '+10% crop quality chance', level: 2 },\n      { id: 'efficient_watering', name: 'Efficient Watering', description: 'Watering uses 25% less stamina', level: 4 },\n      { id: 'speed_grow', name: 'Speed Grow', description: '10% faster crop growth', level: 6 },\n      { id: 'double_harvest', name: 'Double Harvest', description: '15% chance for double harvest', level: 8 },\n      { id: 'master_farmer', name: 'Master Farmer', description: 'All farming bonuses doubled', level: 10 },\n    ],\n  },\n  {\n    id: 'mining', name: 'Mining',\n    description: 'Mine ore and break rocks faster.',\n    maxLevel: 10,\n    xpPerLevel: [50, 125, 250, 500, 1000, 1750, 2750, 4000, 6000, 10000],\n    perks: [\n      { id: 'prospector', name: 'Prospector', description: '+20% ore find chance', level: 2 },\n      { id: 'efficient_mining', name: 'Efficient Mining', description: 'Mining uses 25% less stamina', level: 4 },\n      { id: 'gem_finder', name: 'Gem Finder', description: '+30% gem find chance', level: 6 },\n      { id: 'excavator', name: 'Excavator', description: 'Break rocks in fewer hits', level: 8 },\n      { id: 'master_miner', name: 'Master Miner', description: 'Chance to find rare ores', level: 10 },\n    ],\n  },\n  {\n    id: 'combat', name: 'Combat',\n    description: 'Deal more damage and take less.',\n    maxLevel: 10,\n    xpPerLevel: [100, 250, 500, 1000, 2000, 3500, 5500, 8000, 12000, 20000],\n    perks: [\n      { id: 'fighter', name: 'Fighter', description: '+10% attack damage', level: 2 },\n      { id: 'defender', name: 'Defender', description: '-15% damage taken', level: 4 },\n      { id: 'critical', name: 'Critical Strike', description: '+10% crit chance for 2x damage', level: 6 },\n      { id: 'vampire', name: 'Vampiric', description: '5% life steal on attacks', level: 8 },\n      { id: 'warrior', name: 'Warrior', description: 'All combat bonuses doubled', level: 10 },\n    ],\n  },\n  {\n    id: 'foraging', name: 'Foraging',\n    description: 'Find more items while foraging.',\n    maxLevel: 10,\n    xpPerLevel: [50, 125, 250, 500, 1000, 1750, 2750, 4000, 6000, 10000],\n    perks: [\n      { id: 'gatherer', name: 'Gatherer', description: '+25% forage amount', level: 2 },\n      { id: 'botanist', name: 'Botanist', description: 'All foraged items are best quality', level: 4 },\n      { id: 'tracker', name: 'Tracker', description: 'Foragables are highlighted', level: 6 },\n      { id: 'lumberjack', name: 'Lumberjack', description: '+50% wood from trees', level: 8 },\n      { id: 'nature_friend', name: 'Nature Friend', description: 'Animals are friendly', level: 10 },\n    ],\n  },\n  {\n    id: 'fishing', name: 'Fishing',\n    description: 'Catch fish more easily and find treasures.',\n    maxLevel: 10,\n    xpPerLevel: [50, 125, 250, 500, 1000, 1750, 2750, 4000, 6000, 10000],\n    perks: [\n      { id: 'fisher', name: 'Fisher', description: 'Fish bite faster', level: 2 },\n      { id: 'treasure_hunter', name: 'Treasure Hunter', description: '+20% treasure chance', level: 4 },\n      { id: 'angler', name: 'Angler', description: 'Fish sell for 25% more', level: 6 },\n      { id: 'master_bait', name: 'Master Bait', description: 'Double bait effectiveness', level: 8 },\n      { id: 'legendary_fisher', name: 'Legendary Fisher', description: 'Can catch legendary fish', level: 10 },\n    ],\n  },\n  {\n    id: 'cooking', name: 'Cooking',\n    description: 'Cook better dishes with more effects.',\n    maxLevel: 10,\n    xpPerLevel: [50, 125, 250, 500, 1000, 1750, 2750, 4000, 6000, 10000],\n    perks: [\n      { id: 'chef', name: 'Chef', description: '+20% food healing', level: 2 },\n      { id: 'seasoned', name: 'Seasoned', description: 'Food buffs last 30% longer', level: 4 },\n      { id: 'gourmet', name: 'Gourmet', description: 'Cooked food sells for 50% more', level: 6 },\n      { id: 'efficiency', name: 'Efficiency', description: '20% chance to not consume ingredients', level: 8 },\n      { id: 'master_chef', name: 'Master Chef', description: 'Unlock legendary recipes', level: 10 },\n    ],\n  },\n  {\n    id: 'crafting', name: 'Crafting',\n    description: 'Create better items and equipment.',\n    maxLevel: 10,\n    xpPerLevel: [50, 125, 250, 500, 1000, 1750, 2750, 4000, 6000, 10000],\n    perks: [\n      { id: 'apprentice', name: 'Apprentice', description: '+10% crafting speed', level: 2 },\n      { id: 'resourceful', name: 'Resourceful', description: '15% chance to save materials', level: 4 },\n      { id: 'quality_craft', name: 'Quality Craft', description: '+20% chance for higher quality output', level: 6 },\n      { id: 'innovator', name: 'Innovator', description: 'Discover hidden recipes when experimenting', level: 8 },\n      { id: 'master_crafter', name: 'Master Crafter', description: 'Can craft mythic-tier equipment', level: 10 },\n    ],\n  },\n  {\n    id: 'social', name: 'Social',\n    description: 'Build relationships and negotiate better.',\n    maxLevel: 10,\n    xpPerLevel: [50, 125, 250, 500, 1000, 1750, 2750, 4000, 6000, 10000],\n    perks: [\n      { id: 'friendly', name: 'Friendly', description: '+20% friendship gain from gifts', level: 2 },\n      { id: 'haggler', name: 'Haggler', description: '10% discount at all shops', level: 4 },\n      { id: 'diplomat', name: 'Diplomat', description: 'Access to faction-exclusive quests', level: 6 },\n      { id: 'leader', name: 'Leader', description: 'Settlement NPCs +25% productivity', level: 8 },\n      { id: 'beloved', name: 'Beloved', description: 'All NPCs start at 2 hearts', level: 10 },\n    ],\n  },\n  {\n    id: 'exploration', name: 'Exploration',\n    description: 'Discover the world and survive its dangers.',\n    maxLevel: 10,\n    xpPerLevel: [75, 175, 350, 700, 1400, 2450, 3850, 5600, 8400, 14000],\n    perks: [\n      { id: 'pathfinder', name: 'Pathfinder', description: '+10% movement speed on paths', level: 2 },\n      { id: 'cartographer', name: 'Cartographer', description: 'Reveal minimap in larger radius', level: 4 },\n      { id: 'survivalist', name: 'Survivalist', description: '50% less damage from biome hazards', level: 6 },\n      { id: 'treasure_sense', name: 'Treasure Sense', description: 'Nearby chests glow through walls', level: 8 },\n      { id: 'world_walker', name: 'World Walker', description: 'Immune to corruption slow effect', level: 10 },\n    ],\n  },\n];\n\nexport const SKILL_DB = new Map<string, SkillDef>(SKILLS.map(s => [s.id, s]));\n","import { SKILLS, SkillDef, PerkDef, SKILL_DB } from '../data/skills';\n\nexport interface SkillSnapshot {\n  id: string;\n  name: string;\n  level: number;\n  xp: number;\n  nextLevelXp: number;\n}\n\nexport interface SkillXPInfo {\n  current: number;   // XP earned within the current level bracket\n  required: number;  // XP needed to reach the next level (from current bracket start)\n  total: number;     // Total accumulated XP\n}\n\ninterface SkillSaveData {\n  xp: Record<string, number>;\n  levels: Record<string, number>;\n}\n\n/**\n * Manages all 9 player skills: XP accumulation, level-ups, and perk unlocks.\n * XP accumulates (never resets). Level is determined by how many xpPerLevel\n * thresholds have been passed.\n */\nexport class SkillManager {\n  private skillXP: Map<string, number> = new Map();\n  private skillLevels: Map<string, number> = new Map();\n  private levelUpCallbacks: Array<(skillId: string, level: number) => void> = [];\n\n  constructor() {\n    for (const skill of SKILLS) {\n      this.skillXP.set(skill.id, 0);\n      this.skillLevels.set(skill.id, 0);\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // XP & Level-Up\n  // ---------------------------------------------------------------------------\n\n  /** Add XP to a skill. Triggers onLevelUp callbacks for each level gained. */\n  addXP(skillId: string, amount: number): void {\n    const skill = SKILL_DB.get(skillId);\n    if (!skill || amount <= 0) return;\n\n    const prevLevel = this.skillLevels.get(skillId) ?? 0;\n    const newXP = (this.skillXP.get(skillId) ?? 0) + amount;\n    this.skillXP.set(skillId, newXP);\n\n    const newLevel = this.computeLevel(skill, newXP);\n    this.skillLevels.set(skillId, newLevel);\n\n    // Fire callbacks for each level gained\n    for (let lvl = prevLevel + 1; lvl <= newLevel; lvl++) {\n      for (const cb of this.levelUpCallbacks) {\n        cb(skillId, lvl);\n      }\n    }\n  }\n\n  /** Get the current level of a skill. */\n  getLevel(skillId: string): number {\n    return this.skillLevels.get(skillId) ?? 0;\n  }\n\n  /** Get detailed XP info for a skill. */\n  getXP(skillId: string): SkillXPInfo {\n    const skill = SKILL_DB.get(skillId);\n    const totalXP = this.skillXP.get(skillId) ?? 0;\n    const level = this.skillLevels.get(skillId) ?? 0;\n\n    if (!skill) return { current: 0, required: 0, total: 0 };\n\n    // XP spent to reach the current level\n    let xpSpent = 0;\n    for (let i = 0; i < level; i++) {\n      xpSpent += skill.xpPerLevel[i] ?? 0;\n    }\n\n    const current = totalXP - xpSpent;\n    const required = level < skill.maxLevel\n      ? skill.xpPerLevel[level] ?? 0\n      : 0;\n\n    return { current, required, total: totalXP };\n  }\n\n  // ---------------------------------------------------------------------------\n  // Perks\n  // ---------------------------------------------------------------------------\n\n  /** Returns all perks whose required level is at or below the skill's current level. */\n  getUnlockedPerks(skillId: string): PerkDef[] {\n    const skill = SKILL_DB.get(skillId);\n    if (!skill) return [];\n    const level = this.getLevel(skillId);\n    return skill.perks.filter(p => p.level <= level);\n  }\n\n  /** Check if a specific perk is unlocked (searches across all skills). */\n  hasPerk(perkId: string): boolean {\n    for (const skill of SKILLS) {\n      const level = this.getLevel(skill.id);\n      for (const perk of skill.perks) {\n        if (perk.id === perkId && perk.level <= level) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Query\n  // ---------------------------------------------------------------------------\n\n  /** Returns a summary snapshot of all skills. */\n  getAllSkills(): SkillSnapshot[] {\n    return SKILLS.map(skill => {\n      const level = this.getLevel(skill.id);\n      const totalXP = this.skillXP.get(skill.id) ?? 0;\n      const nextLevelXp = level < skill.maxLevel\n        ? skill.xpPerLevel[level] ?? 0\n        : 0;\n\n      return {\n        id: skill.id,\n        name: skill.name,\n        level,\n        xp: totalXP,\n        nextLevelXp,\n      };\n    });\n  }\n\n  // ---------------------------------------------------------------------------\n  // Callbacks\n  // ---------------------------------------------------------------------------\n\n  /** Register a callback fired whenever any skill levels up. */\n  onLevelUp(cb: (skillId: string, level: number) => void): void {\n    this.levelUpCallbacks.push(cb);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Persistence\n  // ---------------------------------------------------------------------------\n\n  /** Serialize for save. */\n  serialize(): SkillSaveData {\n    const xp: Record<string, number> = {};\n    const levels: Record<string, number> = {};\n    for (const [id, val] of this.skillXP) {\n      xp[id] = val;\n    }\n    for (const [id, val] of this.skillLevels) {\n      levels[id] = val;\n    }\n    return { xp, levels };\n  }\n\n  /** Deserialize from save. */\n  deserialize(data: SkillSaveData): void {\n    if (data.xp) {\n      for (const [id, val] of Object.entries(data.xp)) {\n        this.skillXP.set(id, val);\n      }\n    }\n    if (data.levels) {\n      for (const [id, val] of Object.entries(data.levels)) {\n        this.skillLevels.set(id, val);\n      }\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Internal\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Determine level from total accumulated XP.\n   * XP never resets — level is how many xpPerLevel thresholds have been fully passed.\n   */\n  private computeLevel(skill: SkillDef, totalXP: number): number {\n    let remaining = totalXP;\n    for (let lvl = 0; lvl < skill.maxLevel; lvl++) {\n      const needed = skill.xpPerLevel[lvl] ?? 0;\n      if (remaining < needed) return lvl;\n      remaining -= needed;\n    }\n    return skill.maxLevel;\n  }\n}\n","/**\n * EDILAS-Phaser - NPC Data Definitions\n * All 15 NPCs with full schedules, gift preferences, and dialogue trees.\n * Ported from the original EDILAS Canvas engine + 6 new townsfolk.\n */\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport interface NPCScheduleEntry {\n  hour: number;\n  location: string;\n  x: number;\n  y: number;\n  activity: string;\n}\n\nexport interface NPCGiftPreference {\n  loved: string[];\n  liked: string[];\n  disliked: string[];\n  hated: string[];\n}\n\nexport interface NPCDialogue {\n  greeting: string;\n  friendship: Record<number, string[]>; // heart level -> dialogue options\n  birthday: string;\n  festival: Record<string, string>;\n}\n\nexport interface NPCDef {\n  id: string;\n  name: string;\n  title: string;\n  description: string;\n  texture: string;\n  birthday: { season: string; day: number };\n  schedule: Record<string, NPCScheduleEntry[]>; // season -> daily schedule\n  gifts: NPCGiftPreference;\n  dialogue: NPCDialogue;\n  shop?: { items: string[]; priceMultiplier: number };\n  questIds: string[];\n  homeCity: string;\n}\n\n// ---------------------------------------------------------------------------\n// NPC Definitions\n// ---------------------------------------------------------------------------\n\nexport const NPCS: NPCDef[] = [\n  // =========================================================================\n  // 1. Mayor Thomas\n  // =========================================================================\n  {\n    id: 'mayor',\n    name: 'Mayor Thomas',\n    title: 'Mayor of Willowbrook',\n    description:\n      'The friendly and formal leader of Willowbrook. He cares deeply about the town and its people, always looking for ways to improve community life.',\n    texture: 'npc_mayor',\n    birthday: { season: 'spring', day: 11 },\n    schedule: {\n      spring: [\n        { hour: 6, location: 'mayor_house', x: -80, y: -120, activity: 'home' },\n        { hour: 8, location: 'town_hall', x: 80, y: -80, activity: 'work' },\n        { hour: 12, location: 'tavern', x: 0, y: 80, activity: 'lunch' },\n        { hour: 13, location: 'town_hall', x: 80, y: -80, activity: 'work' },\n        { hour: 18, location: 'town_square', x: 0, y: 0, activity: 'socialize' },\n        { hour: 22, location: 'mayor_house', x: -80, y: -120, activity: 'sleep' },\n      ],\n      summer: [\n        { hour: 6, location: 'mayor_house', x: -80, y: -120, activity: 'home' },\n        { hour: 8, location: 'town_hall', x: 80, y: -80, activity: 'work' },\n        { hour: 12, location: 'tavern', x: 0, y: 80, activity: 'lunch' },\n        { hour: 13, location: 'town_hall', x: 80, y: -80, activity: 'work' },\n        { hour: 17, location: 'beach', x: 0, y: 200, activity: 'walk' },\n        { hour: 19, location: 'town_square', x: 0, y: 0, activity: 'socialize' },\n        { hour: 22, location: 'mayor_house', x: -80, y: -120, activity: 'sleep' },\n      ],\n      fall: [\n        { hour: 6, location: 'mayor_house', x: -80, y: -120, activity: 'home' },\n        { hour: 8, location: 'town_hall', x: 80, y: -80, activity: 'work' },\n        { hour: 12, location: 'tavern', x: 0, y: 80, activity: 'lunch' },\n        { hour: 13, location: 'town_hall', x: 80, y: -80, activity: 'work' },\n        { hour: 18, location: 'town_square', x: 0, y: 0, activity: 'socialize' },\n        { hour: 22, location: 'mayor_house', x: -80, y: -120, activity: 'sleep' },\n      ],\n      winter: [\n        { hour: 7, location: 'mayor_house', x: -80, y: -120, activity: 'home' },\n        { hour: 9, location: 'town_hall', x: 80, y: -80, activity: 'work' },\n        { hour: 12, location: 'tavern', x: 0, y: 80, activity: 'lunch' },\n        { hour: 13, location: 'town_hall', x: 80, y: -80, activity: 'work' },\n        { hour: 17, location: 'town_hall', x: 80, y: -80, activity: 'reading' },\n        { hour: 20, location: 'mayor_house', x: -80, y: -120, activity: 'home' },\n        { hour: 22, location: 'mayor_house', x: -80, y: -120, activity: 'sleep' },\n      ],\n      rainy: [\n        { hour: 6, location: 'mayor_house', x: -80, y: -120, activity: 'home' },\n        { hour: 8, location: 'town_hall', x: 80, y: -80, activity: 'work' },\n        { hour: 22, location: 'mayor_house', x: -80, y: -120, activity: 'sleep' },\n      ],\n    },\n    gifts: {\n      loved: ['truffle', 'ancient_fruit', 'prismatic_shard'],\n      liked: ['coffee', 'formal_wear', 'gold_ore', 'wine'],\n      disliked: ['trash', 'slime', 'weeds'],\n      hated: ['void_egg', 'rotten_food'],\n    },\n    dialogue: {\n      greeting: \"Welcome to our humble town! Ah, our newest farmer! How are the crops?\",\n      friendship: {\n        0: [\n          \"Welcome to our humble town!\",\n          \"Good day! The town prospers with your help.\",\n        ],\n        2: [\n          \"Ah, our newest farmer! How are the crops?\",\n          \"Your grandmother was a remarkable woman. She saved this town more times than most know.\",\n          \"There's something... off about Willowbrook lately. Can't quite put my finger on it.\",\n        ],\n        4: [\n          \"You've become such an important part of our community!\",\n          \"The old community center holds memories of better times. If only we could restore it...\",\n        ],\n        6: [\n          \"I'm so glad you chose to settle here.\",\n          \"Word is you've been delving deep into the mines. Found anything unusual?\",\n          \"The town feels... lighter somehow. Like a weight is slowly lifting.\",\n        ],\n        8: [\n          \"You've done something incredible. I can feel hope returning to Willowbrook.\",\n          \"The three seals... just like in the old legends. Your grandmother would be so proud.\",\n        ],\n        10: [\n          \"The curse is lifted! You've saved us all! Willowbrook will never forget what you've done.\",\n          \"I... I can see the colors more vividly now. The darkness that hung over us is gone.\",\n        ],\n      },\n      birthday:\n        \"It's my birthday! How kind of you to remember. A toast to another year serving Willowbrook!\",\n      festival: {\n        egg_hunt: \"The egg hunt is a Willowbrook tradition! May the best egg hunter win!\",\n        luau: \"This summer heat is intense! Stay hydrated, farmer.\",\n        harvest: \"Harvest time! I love seeing the town so productive.\",\n        winter_star:\n          \"The Feast of the Winter Star will be magical this year! Bundle up!\",\n      },\n    },\n    questIds: ['welcome_quest', 'town_cleanup'],\n    homeCity: 'willowbrook',\n  },\n\n  // =========================================================================\n  // 2. Martha (Shopkeeper)\n  // =========================================================================\n  {\n    id: 'shopkeeper',\n    name: 'Martha',\n    title: 'General Store Owner',\n    description:\n      'Cheerful and business-minded, Martha runs the general store with a warm smile. She stocks everything a farmer could need.',\n    texture: 'npc_shopkeeper',\n    birthday: { season: 'summer', day: 18 },\n    schedule: {\n      spring: [\n        { hour: 6, location: 'shop_house', x: -160, y: 40, activity: 'home' },\n        { hour: 8, location: 'general_store', x: -120, y: 40, activity: 'work' },\n        { hour: 20, location: 'tavern', x: 0, y: 80, activity: 'socialize' },\n        { hour: 22, location: 'shop_house', x: -160, y: 40, activity: 'sleep' },\n      ],\n      summer: [\n        { hour: 6, location: 'shop_house', x: -160, y: 40, activity: 'home' },\n        { hour: 8, location: 'general_store', x: -120, y: 40, activity: 'work' },\n        { hour: 19, location: 'town_square', x: 0, y: 0, activity: 'walk' },\n        { hour: 21, location: 'shop_house', x: -160, y: 40, activity: 'home' },\n        { hour: 22, location: 'shop_house', x: -160, y: 40, activity: 'sleep' },\n      ],\n      fall: [\n        { hour: 6, location: 'shop_house', x: -160, y: 40, activity: 'home' },\n        { hour: 8, location: 'general_store', x: -120, y: 40, activity: 'work' },\n        { hour: 20, location: 'tavern', x: 0, y: 80, activity: 'socialize' },\n        { hour: 22, location: 'shop_house', x: -160, y: 40, activity: 'sleep' },\n      ],\n      winter: [\n        { hour: 7, location: 'shop_house', x: -160, y: 40, activity: 'home' },\n        { hour: 9, location: 'general_store', x: -120, y: 40, activity: 'work' },\n        { hour: 18, location: 'shop_house', x: -160, y: 40, activity: 'home' },\n        { hour: 22, location: 'shop_house', x: -160, y: 40, activity: 'sleep' },\n      ],\n      rainy: [\n        { hour: 6, location: 'shop_house', x: -160, y: 40, activity: 'home' },\n        { hour: 8, location: 'general_store', x: -120, y: 40, activity: 'work' },\n        { hour: 20, location: 'shop_house', x: -160, y: 40, activity: 'home' },\n        { hour: 22, location: 'shop_house', x: -160, y: 40, activity: 'sleep' },\n      ],\n    },\n    gifts: {\n      loved: ['diamond', 'pink_cake', 'fairy_rose'],\n      liked: ['flowers', 'gems', 'cooked_food', 'honey'],\n      disliked: ['weeds', 'raw_fish', 'clay'],\n      hated: ['slime', 'bug_meat'],\n    },\n    dialogue: {\n      greeting: \"Welcome to my shop! Take a look around!\",\n      friendship: {\n        0: [\n          \"Welcome to my shop! Take a look around!\",\n          \"Hello there! Need any supplies?\",\n        ],\n        2: [\n          \"Good to see you! What can I get for you today?\",\n          \"Your grandmother used to come here every week. Always knew exactly what she needed.\",\n          \"Business has been slow lately. Something's been keeping folks at home.\",\n        ],\n        4: [\n          \"You remind me of your grandmother - that same determined look in your eyes.\",\n          \"The old-timers whisper about a curse. I don't know what to believe anymore.\",\n          \"Had a few customers mention seeing strange lights in the mines. You know anything about that?\",\n        ],\n        6: [\n          \"My grandmother's grandmother used to tell stories about magical seals. Never thought they were real!\",\n          \"More customers lately! People seem happier, more willing to come out.\",\n        ],\n        8: [\n          \"Sales are up! Everyone's celebrating! Thank you for everything you've done!\",\n          \"The whole town owes you a debt we can never repay.\",\n        ],\n        10: [\n          \"You're like family to me now. Anything you need, just ask.\",\n        ],\n      },\n      birthday:\n        \"Oh! You remembered my birthday? That's so sweet! Come in, everything's half off today!\",\n      festival: {\n        egg_hunt: \"Spring seeds are selling fast! Better stock up!\",\n        luau: \"Summer goods are in! Cold drinks selling well.\",\n        harvest: \"Got some harvest supplies you might need!\",\n        winter_star: \"Hot cocoa mix is my winter bestseller!\",\n      },\n    },\n    shop: {\n      items: [\n        'parsnip_seeds', 'potato_seeds', 'cauliflower_seeds', 'bean_seeds',\n        'melon_seeds', 'tomato_seeds', 'blueberry_seeds', 'corn_seeds',\n        'pumpkin_seeds', 'yam_seeds', 'cranberry_seeds', 'eggplant_seeds',\n        'wheat_seeds', 'rice_seeds', 'sugar_cane_seeds',\n        'fertilizer', 'speed_gro', 'quality_fertilizer',\n        'hay', 'animal_treats', 'backpack_upgrade',\n      ],\n      priceMultiplier: 1.0,\n    },\n    questIds: [],\n    homeCity: 'willowbrook',\n  },\n\n  // =========================================================================\n  // 3. Garrett (Blacksmith)\n  // =========================================================================\n  {\n    id: 'blacksmith',\n    name: 'Garrett',\n    title: 'Master Blacksmith',\n    description:\n      'Gruff but kind, Garrett has been forging tools and weapons in Willowbrook for decades. His craftsmanship is unmatched.',\n    texture: 'npc_blacksmith',\n    birthday: { season: 'winter', day: 5 },\n    schedule: {\n      spring: [\n        { hour: 6, location: 'blacksmith_house', x: 160, y: 80, activity: 'home' },\n        { hour: 7, location: 'blacksmith', x: 120, y: 40, activity: 'work' },\n        { hour: 18, location: 'tavern', x: 0, y: 80, activity: 'socialize' },\n        { hour: 21, location: 'blacksmith_house', x: 160, y: 80, activity: 'sleep' },\n      ],\n      summer: [\n        { hour: 6, location: 'blacksmith_house', x: 160, y: 80, activity: 'home' },\n        { hour: 7, location: 'blacksmith', x: 120, y: 40, activity: 'work' },\n        { hour: 18, location: 'tavern', x: 0, y: 80, activity: 'socialize' },\n        { hour: 21, location: 'blacksmith_house', x: 160, y: 80, activity: 'sleep' },\n      ],\n      fall: [\n        { hour: 6, location: 'blacksmith_house', x: 160, y: 80, activity: 'home' },\n        { hour: 7, location: 'blacksmith', x: 120, y: 40, activity: 'work' },\n        { hour: 18, location: 'tavern', x: 0, y: 80, activity: 'socialize' },\n        { hour: 21, location: 'blacksmith_house', x: 160, y: 80, activity: 'sleep' },\n      ],\n      winter: [\n        { hour: 7, location: 'blacksmith_house', x: 160, y: 80, activity: 'home' },\n        { hour: 8, location: 'blacksmith', x: 120, y: 40, activity: 'work' },\n        { hour: 17, location: 'tavern', x: 0, y: 80, activity: 'socialize' },\n        { hour: 20, location: 'blacksmith_house', x: 160, y: 80, activity: 'sleep' },\n      ],\n      rainy: [\n        { hour: 6, location: 'blacksmith_house', x: 160, y: 80, activity: 'home' },\n        { hour: 7, location: 'blacksmith', x: 120, y: 40, activity: 'work' },\n        { hour: 20, location: 'blacksmith_house', x: 160, y: 80, activity: 'sleep' },\n      ],\n    },\n    gifts: {\n      loved: ['iridium_bar', 'gold_bar', 'prismatic_shard'],\n      liked: ['ores', 'gems', 'beer', 'copper_bar', 'iron_bar'],\n      disliked: ['flowers', 'sweets', 'fish'],\n      hated: ['joja_cola', 'hay'],\n    },\n    dialogue: {\n      greeting:\n        \"*grunts* Oh, it's you. Need something forged?\",\n      friendship: {\n        0: [\n          \"*grunts* Oh, it's you. Need something forged?\",\n          \"The forge is hot today. Good for metalwork.\",\n        ],\n        2: [\n          \"Brought me any ores? I can make something useful.\",\n          \"Your grandmother commissioned special tools from me once. Said they were for 'protection.'\",\n          \"Something's wrong with the metal lately. It fights me. Cursed, maybe.\",\n        ],\n        4: [\n          \"Heard you've been mining deep. If you find unusual ores, bring 'em to me.\",\n          \"The forge is burning brighter today. First time in years. Odd.\",\n          \"Bah. The forge hasn't burned as bright since... well, for a long time.\",\n        ],\n        6: [\n          \"Three seals of ancient power... I forged replicas of those once, for your grandmother.\",\n          \"My hammer sings true again! Whatever you did, it's working.\",\n        ],\n        8: [\n          \"The curse is broken! Now THIS is how a forge should burn!\",\n          \"I can create masterworks again! Come back anytime - you've earned the best I can make.\",\n        ],\n        10: [\n          \"You're the finest person I know. And I don't say that to anyone.\",\n        ],\n      },\n      birthday:\n        \"Bah, another year older. ...Fine, you can have a discount today. Don't tell anyone.\",\n      festival: {\n        egg_hunt: \"Good time to upgrade tools for planting.\",\n        luau: \"The forge is extra hot today... just like outside.\",\n        harvest: \"Harvest tools need sharpening? I'm your man.\",\n        winter_star: \"Cold metal is harder to work. Prices go up.\",\n      },\n    },\n    shop: {\n      items: [\n        'copper_bar', 'iron_bar', 'gold_bar',\n        'pickaxe_upgrade', 'axe_upgrade', 'hoe_upgrade', 'watering_can_upgrade',\n        'sword_basic', 'sword_steel', 'sword_gold',\n      ],\n      priceMultiplier: 1.0,\n    },\n    questIds: [],\n    homeCity: 'willowbrook',\n  },\n\n  // =========================================================================\n  // 4. Lily (Farmer Girl) - Romanceable\n  // =========================================================================\n  {\n    id: 'farmer_girl',\n    name: 'Lily',\n    title: 'Flower Farmer',\n    description:\n      'Shy and nature-loving, Lily tends her family flower farm at the edge of town. She has a deep connection with plants and animals alike.',\n    texture: 'npc_farmer_girl',\n    birthday: { season: 'spring', day: 24 },\n    schedule: {\n      spring: [\n        { hour: 6, location: 'lily_farm', x: -200, y: -80, activity: 'home' },\n        { hour: 8, location: 'lily_fields', x: -240, y: -40, activity: 'farming' },\n        { hour: 12, location: 'lily_farm', x: -200, y: -80, activity: 'lunch' },\n        { hour: 13, location: 'lily_fields', x: -240, y: -40, activity: 'farming' },\n        { hour: 17, location: 'forest_path', x: -280, y: 0, activity: 'walk' },\n        { hour: 19, location: 'lily_farm', x: -200, y: -80, activity: 'home' },\n        { hour: 22, location: 'lily_farm', x: -200, y: -80, activity: 'sleep' },\n      ],\n      summer: [\n        { hour: 6, location: 'lily_farm', x: -200, y: -80, activity: 'home' },\n        { hour: 7, location: 'lily_fields', x: -240, y: -40, activity: 'farming' },\n        { hour: 12, location: 'lily_farm', x: -200, y: -80, activity: 'lunch' },\n        { hour: 13, location: 'lily_fields', x: -240, y: -40, activity: 'farming' },\n        { hour: 16, location: 'beach', x: 0, y: 200, activity: 'swimming' },\n        { hour: 19, location: 'lily_farm', x: -200, y: -80, activity: 'home' },\n        { hour: 22, location: 'lily_farm', x: -200, y: -80, activity: 'sleep' },\n      ],\n      fall: [\n        { hour: 6, location: 'lily_farm', x: -200, y: -80, activity: 'home' },\n        { hour: 8, location: 'lily_fields', x: -240, y: -40, activity: 'farming' },\n        { hour: 12, location: 'lily_farm', x: -200, y: -80, activity: 'lunch' },\n        { hour: 13, location: 'lily_fields', x: -240, y: -40, activity: 'farming' },\n        { hour: 17, location: 'forest_path', x: -280, y: 0, activity: 'walk' },\n        { hour: 19, location: 'lily_farm', x: -200, y: -80, activity: 'home' },\n        { hour: 22, location: 'lily_farm', x: -200, y: -80, activity: 'sleep' },\n      ],\n      winter: [\n        { hour: 8, location: 'lily_farm', x: -200, y: -80, activity: 'home' },\n        { hour: 10, location: 'general_store', x: -120, y: 40, activity: 'shopping' },\n        { hour: 12, location: 'lily_farm', x: -200, y: -80, activity: 'home' },\n        { hour: 14, location: 'tavern', x: 0, y: 80, activity: 'socialize' },\n        { hour: 17, location: 'lily_farm', x: -200, y: -80, activity: 'home' },\n        { hour: 22, location: 'lily_farm', x: -200, y: -80, activity: 'sleep' },\n      ],\n      rainy: [\n        { hour: 6, location: 'lily_farm', x: -200, y: -80, activity: 'home' },\n        { hour: 22, location: 'lily_farm', x: -200, y: -80, activity: 'sleep' },\n      ],\n    },\n    gifts: {\n      loved: ['sunflower', 'fairy_rose', 'sweet_pea', 'poppy'],\n      liked: ['flowers', 'vegetables', 'honey', 'salad'],\n      disliked: ['weapons', 'monster_parts', 'slime'],\n      hated: ['void_egg', 'bug_meat', 'coal'],\n    },\n    dialogue: {\n      greeting: \"Oh! H-hello there...\",\n      friendship: {\n        0: [\n          \"Oh! H-hello there...\",\n          \"The flowers are beautiful today, don't you think?\",\n        ],\n        2: [\n          \"I love the smell of fresh soil...\",\n          \"The flowers... they've been wilting faster than they should. Like they're scared.\",\n          \"I sometimes see shadows in the corner of my eye. It's probably nothing...\",\n        ],\n        4: [\n          \"I feel like I can really talk to you...\",\n          \"Your grandmother's garden was always so beautiful. She had a gift.\",\n          \"The flowers are perking up! They can sense something changing, I think.\",\n        ],\n        6: [\n          \"You make me feel less shy somehow.\",\n          \"I had a dream about you... you were holding something glowing. Three somethings.\",\n          \"Everything is blooming! Even out of season! It's like magic!\",\n        ],\n        8: [\n          \"W-when you're around, my heart beats faster...\",\n          \"I feel... lighter. Like a cloud has lifted from my heart.\",\n        ],\n        10: [\n          \"I... I think about you a lot.\",\n          \"The world is so beautiful now! Thank you for bringing the light back!\",\n          \"I want to plant a garden in your grandmother's memory. Would you help me?\",\n        ],\n      },\n      birthday:\n        \"It's my birthday! The spring flowers always bloom brightest on this day... or maybe that's just how I feel!\",\n      festival: {\n        egg_hunt: \"The spring flowers are blooming! They're so pretty...\",\n        luau: \"The sunflowers are taller than me now!\",\n        harvest: \"I made a flower crown from autumn leaves!\",\n        winter_star: \"Hot cocoa by the fireplace is the best...\",\n      },\n    },\n    questIds: ['lily_flower_field', 'lily_confession'],\n    homeCity: 'willowbrook',\n  },\n\n  // =========================================================================\n  // 5. Harold (Innkeeper)\n  // =========================================================================\n  {\n    id: 'innkeeper',\n    name: 'Harold',\n    title: 'Owner of the Rusty Tankard',\n    description:\n      'Jolly and welcoming, Harold runs the town tavern. He cooks, serves drinks, rents rooms, and always has a story to share.',\n    texture: 'npc_innkeeper',\n    birthday: { season: 'fall', day: 8 },\n    schedule: {\n      spring: [\n        { hour: 6, location: 'inn_kitchen', x: -40, y: 120, activity: 'cooking' },\n        { hour: 10, location: 'tavern', x: 0, y: 80, activity: 'work' },\n        { hour: 0, location: 'tavern', x: 0, y: 80, activity: 'cleaning' },\n        { hour: 2, location: 'inn_room', x: 40, y: 120, activity: 'sleep' },\n      ],\n      summer: [\n        { hour: 6, location: 'inn_kitchen', x: -40, y: 120, activity: 'cooking' },\n        { hour: 10, location: 'tavern', x: 0, y: 80, activity: 'work' },\n        { hour: 0, location: 'tavern', x: 0, y: 80, activity: 'cleaning' },\n        { hour: 2, location: 'inn_room', x: 40, y: 120, activity: 'sleep' },\n      ],\n      fall: [\n        { hour: 6, location: 'inn_kitchen', x: -40, y: 120, activity: 'cooking' },\n        { hour: 10, location: 'tavern', x: 0, y: 80, activity: 'work' },\n        { hour: 0, location: 'tavern', x: 0, y: 80, activity: 'cleaning' },\n        { hour: 2, location: 'inn_room', x: 40, y: 120, activity: 'sleep' },\n      ],\n      winter: [\n        { hour: 7, location: 'inn_kitchen', x: -40, y: 120, activity: 'cooking' },\n        { hour: 10, location: 'tavern', x: 0, y: 80, activity: 'work' },\n        { hour: 0, location: 'tavern', x: 0, y: 80, activity: 'cleaning' },\n        { hour: 2, location: 'inn_room', x: 40, y: 120, activity: 'sleep' },\n      ],\n      rainy: [\n        { hour: 6, location: 'inn_kitchen', x: -40, y: 120, activity: 'cooking' },\n        { hour: 10, location: 'tavern', x: 0, y: 80, activity: 'work' },\n        { hour: 0, location: 'tavern', x: 0, y: 80, activity: 'cleaning' },\n        { hour: 2, location: 'inn_room', x: 40, y: 120, activity: 'sleep' },\n      ],\n    },\n    gifts: {\n      loved: ['truffle_oil', 'aged_wine', 'roasted_venison'],\n      liked: ['beer', 'wine', 'cooked_food'],\n      disliked: ['raw_meat', 'slime'],\n      hated: ['rotten_food', 'void_egg'],\n    },\n    dialogue: {\n      greeting:\n        \"Welcome to the Rusty Tankard! Pull up a chair!\",\n      friendship: {\n        0: [\n          \"Welcome to the Rusty Tankard! Pull up a chair!\",\n          \"What'll it be? Food, drink, or a room for the night?\",\n        ],\n        2: [\n          \"Ahaha! Good to see a friendly face!\",\n          \"Folk don't travel much these days. Bad omens on the roads, they say.\",\n          \"Your grandmother used to sit right there, telling stories. Miss her terribly.\",\n        ],\n        4: [\n          \"The ale's been tasting off. Or maybe it's just the gloom affecting my taste buds.\",\n          \"More travelers passing through! First time in months!\",\n          \"You've got a look about you - like someone on a quest. What're you chasing?\",\n        ],\n        6: [\n          \"The inn is filling up again! People want to visit Willowbrook!\",\n          \"Whatever you're doing, keep doing it. The town needs more of that hope.\",\n        ],\n        8: [\n          \"Drinks are on the house! We're celebrating for a week straight!\",\n          \"You're a hero! Your tale will be told in this tavern for generations!\",\n        ],\n        10: [\n          \"You're family here. The Rusty Tankard is your home away from home, always.\",\n        ],\n      },\n      birthday:\n        \"My birthday? Well then, let me cook up something special! Everyone eats free tonight!\",\n      festival: {\n        egg_hunt: \"Spring travelers are starting to arrive!\",\n        luau: \"Summer tourists keep me busy! Come have a cold one!\",\n        harvest: \"Harvest feast menu is ready! You'll love it!\",\n        winter_star: \"Nothing beats my winter stew on a cold day!\",\n      },\n    },\n    shop: {\n      items: [\n        'beer', 'wine', 'cider', 'coffee', 'hot_cocoa',\n        'bread', 'meat_stew', 'fish_stew', 'salad',\n        'room_rental',\n      ],\n      priceMultiplier: 1.0,\n    },\n    questIds: [],\n    homeCity: 'willowbrook',\n  },\n\n  // =========================================================================\n  // 6. Eldric (Wizard)\n  // =========================================================================\n  {\n    id: 'wizard',\n    name: 'Eldric',\n    title: 'Arcane Scholar',\n    description:\n      'Mysterious and eccentric, Eldric dwells in his tower studying ancient magic. He knows more about the curse on Willowbrook than anyone alive.',\n    texture: 'npc_wizard',\n    birthday: { season: 'winter', day: 17 },\n    schedule: {\n      spring: [\n        { hour: 0, location: 'wizard_tower', x: 200, y: -160, activity: 'research' },\n        { hour: 6, location: 'wizard_tower', x: 200, y: -160, activity: 'sleep' },\n        { hour: 12, location: 'wizard_tower', x: 200, y: -160, activity: 'experiments' },\n        { hour: 18, location: 'forest_shrine', x: 280, y: -200, activity: 'ritual' },\n      ],\n      summer: [\n        { hour: 0, location: 'wizard_tower', x: 200, y: -160, activity: 'research' },\n        { hour: 6, location: 'wizard_tower', x: 200, y: -160, activity: 'sleep' },\n        { hour: 12, location: 'wizard_tower', x: 200, y: -160, activity: 'experiments' },\n        { hour: 18, location: 'forest_shrine', x: 280, y: -200, activity: 'ritual' },\n      ],\n      fall: [\n        { hour: 0, location: 'wizard_tower', x: 200, y: -160, activity: 'research' },\n        { hour: 6, location: 'wizard_tower', x: 200, y: -160, activity: 'sleep' },\n        { hour: 12, location: 'wizard_tower', x: 200, y: -160, activity: 'experiments' },\n        { hour: 16, location: 'forest_shrine', x: 280, y: -200, activity: 'ritual' },\n      ],\n      winter: [\n        { hour: 0, location: 'wizard_tower', x: 200, y: -160, activity: 'research' },\n        { hour: 8, location: 'wizard_tower', x: 200, y: -160, activity: 'sleep' },\n        { hour: 14, location: 'wizard_tower', x: 200, y: -160, activity: 'experiments' },\n        { hour: 20, location: 'wizard_tower', x: 200, y: -160, activity: 'meditation' },\n      ],\n      rainy: [\n        { hour: 0, location: 'wizard_tower', x: 200, y: -160, activity: 'research' },\n        { hour: 6, location: 'wizard_tower', x: 200, y: -160, activity: 'sleep' },\n        { hour: 12, location: 'wizard_tower', x: 200, y: -160, activity: 'scrying' },\n        { hour: 18, location: 'wizard_tower', x: 200, y: -160, activity: 'experiments' },\n      ],\n    },\n    gifts: {\n      loved: ['void_essence', 'ancient_fruit', 'prismatic_shard'],\n      liked: ['purple_mushroom', 'solar_essence', 'fire_quartz'],\n      disliked: ['common_items', 'hay', 'clay'],\n      hated: ['joja_cola', 'trash'],\n    },\n    dialogue: {\n      greeting:\n        \"The stars speak of interesting times...\",\n      friendship: {\n        0: [\n          \"The stars speak of interesting times...\",\n          \"Ah, the one touched by destiny. I've been expecting you.\",\n        ],\n        2: [\n          \"Reality is but a thin veil, young one.\",\n          \"The magical ley lines beneath Willowbrook are corrupted. It grows worse each day.\",\n          \"Your grandmother understood things most mortals cannot comprehend. As do you, I suspect.\",\n        ],\n        4: [\n          \"Three seals were placed long ago to contain the darkness. They're weakening.\",\n          \"The seal's power resonates within you. Your grandmother chose her heir wisely.\",\n          \"Each seal you recover, the curse weakens. Continue your quest.\",\n        ],\n        6: [\n          \"All three seals! The ritual can now be completed. Come to the community center when ready.\",\n          \"The power within you is immense. Handle it with care, and with love.\",\n        ],\n        8: [\n          \"It is done. The balance is restored. Your grandmother can finally rest.\",\n          \"You have exceeded all expectations. The spirits of Willowbrook thank you.\",\n        ],\n        10: [\n          \"You are perhaps the most remarkable being I have encountered in centuries of study.\",\n        ],\n      },\n      birthday:\n        \"My birthday? Time is an illusion, but... I appreciate the sentiment. The stars aligned for this day.\",\n      festival: {\n        egg_hunt: \"The vernal equinox amplifies magical energies...\",\n        luau: \"The summer solstice approaches. Power builds.\",\n        harvest: \"The autumnal equinox brings balance to magic.\",\n        winter_star: \"The winter solstice. A time for reflection and prophecy.\",\n      },\n    },\n    questIds: ['wizard_artifact', 'prismatic_quest'],\n    homeCity: 'willowbrook',\n  },\n\n  // =========================================================================\n  // 7. Marcus (Adventurer) - Romanceable\n  // =========================================================================\n  {\n    id: 'adventurer',\n    name: 'Marcus',\n    title: 'Adventurer',\n    description:\n      'Brave and boastful, Marcus is always seeking the next dungeon to conquer. Beneath the bravado, he has a heart of gold and a story behind every scar.',\n    texture: 'npc_adventurer',\n    birthday: { season: 'summer', day: 2 },\n    schedule: {\n      spring: [\n        { hour: 6, location: 'adventurer_guild', x: 160, y: -40, activity: 'training' },\n        { hour: 10, location: 'dungeon_entrance', x: 240, y: 80, activity: 'exploring' },\n        { hour: 18, location: 'tavern', x: 0, y: 80, activity: 'drinking' },\n        { hour: 23, location: 'adventurer_guild', x: 160, y: -40, activity: 'sleep' },\n      ],\n      summer: [\n        { hour: 6, location: 'adventurer_guild', x: 160, y: -40, activity: 'training' },\n        { hour: 9, location: 'dungeon_entrance', x: 240, y: 80, activity: 'exploring' },\n        { hour: 17, location: 'beach', x: 0, y: 200, activity: 'relaxing' },\n        { hour: 19, location: 'tavern', x: 0, y: 80, activity: 'drinking' },\n        { hour: 23, location: 'adventurer_guild', x: 160, y: -40, activity: 'sleep' },\n      ],\n      fall: [\n        { hour: 6, location: 'adventurer_guild', x: 160, y: -40, activity: 'training' },\n        { hour: 10, location: 'dungeon_entrance', x: 240, y: 80, activity: 'exploring' },\n        { hour: 18, location: 'tavern', x: 0, y: 80, activity: 'drinking' },\n        { hour: 23, location: 'adventurer_guild', x: 160, y: -40, activity: 'sleep' },\n      ],\n      winter: [\n        { hour: 7, location: 'adventurer_guild', x: 160, y: -40, activity: 'training' },\n        { hour: 10, location: 'dungeon_entrance', x: 240, y: 80, activity: 'exploring' },\n        { hour: 16, location: 'tavern', x: 0, y: 80, activity: 'drinking' },\n        { hour: 22, location: 'adventurer_guild', x: 160, y: -40, activity: 'sleep' },\n      ],\n      rainy: [\n        { hour: 6, location: 'adventurer_guild', x: 160, y: -40, activity: 'training' },\n        { hour: 10, location: 'dungeon_entrance', x: 240, y: 80, activity: 'exploring' },\n        { hour: 18, location: 'tavern', x: 0, y: 80, activity: 'drinking' },\n        { hour: 23, location: 'adventurer_guild', x: 160, y: -40, activity: 'sleep' },\n      ],\n    },\n    gifts: {\n      loved: ['dragon_tooth', 'lava_katana', 'prismatic_shard'],\n      liked: ['weapons', 'monster_parts', 'beer'],\n      disliked: ['flowers', 'cute_things', 'sweets'],\n      hated: ['fairy_rose', 'poppy'],\n    },\n    dialogue: {\n      greeting:\n        \"Ho there, fellow warrior! Ready for adventure?\",\n      friendship: {\n        0: [\n          \"Ho there, fellow warrior! Ready for adventure?\",\n          \"The dungeons won't clear themselves!\",\n        ],\n        2: [\n          \"I've slain twenty slimes today. A new record!\",\n          \"The monsters in the mines are getting stronger. Something's riling them up.\",\n          \"Ever feel like you're being watched? Started happening more lately.\",\n        ],\n        4: [\n          \"Your grandmother was tough! She could swing a sword with the best of us.\",\n          \"The monsters are calming down! Fewer of them too. What'd you do?\",\n          \"Found any treasure down there? I've been finding weird glowing rocks.\",\n        ],\n        6: [\n          \"The dungeons are safer now! Whatever you did, it helped!\",\n          \"You're the real adventurer here. I'm just playing at it compared to you.\",\n          \"Want to delve into the dungeons together sometime?\",\n        ],\n        8: [\n          \"Best day of my life! The curse is gone! Let's go dungeon diving to celebrate!\",\n          \"You're a legend now! Mind if I tell people we're friends?\",\n        ],\n        10: [\n          \"I... I've never met anyone like you. You make me want to be braver. For real, not just for show.\",\n        ],\n      },\n      birthday:\n        \"My birthday? Time for the tavern to break out the good stuff! Come celebrate with me!\",\n      festival: {\n        egg_hunt: \"Egg hunts? Not exactly dungeon crawling, but I'll play along!\",\n        luau: \"Summer's perfect for beach training! ...And maybe some relaxation.\",\n        harvest: \"Fall means the deep dungeons open up. Best season for treasure!\",\n        winter_star: \"Winter quests are the toughest. I love it!\",\n      },\n    },\n    questIds: ['marcus_dungeon', 'marcus_scar_story'],\n    homeCity: 'willowbrook',\n  },\n\n  // =========================================================================\n  // 8. Dr. Elena - Romanceable\n  // =========================================================================\n  {\n    id: 'doctor',\n    name: 'Dr. Elena',\n    title: 'Town Physician',\n    description:\n      'Caring and professional, Dr. Elena treats the ailments of Willowbrook. She struggles to explain the mysterious illness affecting the town, and suspects something beyond medicine is at work.',\n    texture: 'npc_doctor',\n    birthday: { season: 'fall', day: 21 },\n    schedule: {\n      spring: [\n        { hour: 6, location: 'clinic_house', x: -120, y: -80, activity: 'home' },\n        { hour: 8, location: 'clinic', x: -80, y: -40, activity: 'work' },\n        { hour: 18, location: 'beach', x: 0, y: 200, activity: 'walk' },\n        { hour: 20, location: 'clinic_house', x: -120, y: -80, activity: 'reading' },\n        { hour: 22, location: 'clinic_house', x: -120, y: -80, activity: 'sleep' },\n      ],\n      summer: [\n        { hour: 6, location: 'clinic_house', x: -120, y: -80, activity: 'home' },\n        { hour: 8, location: 'clinic', x: -80, y: -40, activity: 'work' },\n        { hour: 17, location: 'beach', x: 0, y: 200, activity: 'walk' },\n        { hour: 20, location: 'clinic_house', x: -120, y: -80, activity: 'reading' },\n        { hour: 22, location: 'clinic_house', x: -120, y: -80, activity: 'sleep' },\n      ],\n      fall: [\n        { hour: 6, location: 'clinic_house', x: -120, y: -80, activity: 'home' },\n        { hour: 8, location: 'clinic', x: -80, y: -40, activity: 'work' },\n        { hour: 18, location: 'forest_path', x: -280, y: 0, activity: 'walk' },\n        { hour: 20, location: 'clinic_house', x: -120, y: -80, activity: 'reading' },\n        { hour: 22, location: 'clinic_house', x: -120, y: -80, activity: 'sleep' },\n      ],\n      winter: [\n        { hour: 7, location: 'clinic_house', x: -120, y: -80, activity: 'home' },\n        { hour: 8, location: 'clinic', x: -80, y: -40, activity: 'work' },\n        { hour: 18, location: 'clinic_house', x: -120, y: -80, activity: 'reading' },\n        { hour: 22, location: 'clinic_house', x: -120, y: -80, activity: 'sleep' },\n      ],\n      rainy: [\n        { hour: 6, location: 'clinic_house', x: -120, y: -80, activity: 'home' },\n        { hour: 8, location: 'clinic', x: -80, y: -40, activity: 'work' },\n        { hour: 18, location: 'clinic_house', x: -120, y: -80, activity: 'reading' },\n        { hour: 22, location: 'clinic_house', x: -120, y: -80, activity: 'sleep' },\n      ],\n    },\n    gifts: {\n      loved: ['life_elixir', 'rainbow_shell', 'fairy_rose'],\n      liked: ['medicine', 'flowers', 'coffee'],\n      disliked: ['alcohol', 'junk_food', 'beer'],\n      hated: ['void_egg', 'rotten_food'],\n    },\n    dialogue: {\n      greeting:\n        \"How are you feeling today? Any aches or pains?\",\n      friendship: {\n        0: [\n          \"How are you feeling today? Any aches or pains?\",\n          \"Remember to take care of yourself out there.\",\n        ],\n        2: [\n          \"An apple a day... well, you know the rest.\",\n          \"I've been seeing more patients lately. Fatigue, malaise... nothing I can explain medically.\",\n          \"Your grandmother was in perfect health until the end. It was like she just... let go.\",\n        ],\n        4: [\n          \"Something is affecting the town's wellbeing. It's not physical - it's something else.\",\n          \"Fewer patients this week! Whatever you're doing, it's helping.\",\n          \"The town's collective health is improving. Most intriguing.\",\n        ],\n        6: [\n          \"Remarkable! Everyone is reporting feeling better. The change is measurable.\",\n          \"You've cured something I couldn't even diagnose. Extraordinary.\",\n        ],\n        8: [\n          \"The curse was real, and you cured it. I owe you an apology for my skepticism.\",\n          \"As a woman of science, I struggle to explain what happened. But I believe.\",\n        ],\n        10: [\n          \"You've opened my eyes to a world beyond what I thought possible. Thank you... for everything.\",\n        ],\n      },\n      birthday:\n        \"My birthday already? I suppose even doctors need a day off. Thank you for remembering.\",\n      festival: {\n        egg_hunt: \"Don't forget to stretch before the egg hunt! Pulled muscles are no joke.\",\n        luau: \"Stay hydrated in this heat! I mean it!\",\n        harvest: \"The harvest is wonderful for nutrition. Eat those fresh vegetables!\",\n        winter_star: \"Cold and flu season. Please wash your hands, everyone.\",\n      },\n    },\n    questIds: [],\n    homeCity: 'willowbrook',\n  },\n\n  // =========================================================================\n  // 9. Penny (Pet Seller)\n  // =========================================================================\n  {\n    id: 'pet_seller',\n    name: 'Penny',\n    title: 'Pet Shop Owner',\n    description:\n      'Warm and animal-loving, Penny runs the pet shop. Every creature in her care is treated like family, and she can match any farmer with the perfect companion.',\n    texture: 'npc_pet_seller',\n    birthday: { season: 'spring', day: 7 },\n    schedule: {\n      spring: [\n        { hour: 6, location: 'pet_shop_house', x: -200, y: -80, activity: 'home' },\n        { hour: 9, location: 'pet_shop', x: -160, y: -40, activity: 'work' },\n        { hour: 18, location: 'forest_path', x: -280, y: 0, activity: 'walk_pets' },\n        { hour: 20, location: 'tavern', x: 0, y: 80, activity: 'socialize' },\n        { hour: 22, location: 'pet_shop_house', x: -200, y: -80, activity: 'sleep' },\n      ],\n      summer: [\n        { hour: 6, location: 'pet_shop_house', x: -200, y: -80, activity: 'home' },\n        { hour: 9, location: 'pet_shop', x: -160, y: -40, activity: 'work' },\n        { hour: 17, location: 'beach', x: 0, y: 200, activity: 'walk_pets' },\n        { hour: 20, location: 'pet_shop_house', x: -200, y: -80, activity: 'home' },\n        { hour: 22, location: 'pet_shop_house', x: -200, y: -80, activity: 'sleep' },\n      ],\n      fall: [\n        { hour: 6, location: 'pet_shop_house', x: -200, y: -80, activity: 'home' },\n        { hour: 9, location: 'pet_shop', x: -160, y: -40, activity: 'work' },\n        { hour: 18, location: 'forest_path', x: -280, y: 0, activity: 'walk_pets' },\n        { hour: 20, location: 'tavern', x: 0, y: 80, activity: 'socialize' },\n        { hour: 22, location: 'pet_shop_house', x: -200, y: -80, activity: 'sleep' },\n      ],\n      winter: [\n        { hour: 7, location: 'pet_shop_house', x: -200, y: -80, activity: 'home' },\n        { hour: 9, location: 'pet_shop', x: -160, y: -40, activity: 'work' },\n        { hour: 17, location: 'pet_shop_house', x: -200, y: -80, activity: 'home' },\n        { hour: 22, location: 'pet_shop_house', x: -200, y: -80, activity: 'sleep' },\n      ],\n      rainy: [\n        { hour: 6, location: 'pet_shop_house', x: -200, y: -80, activity: 'home' },\n        { hour: 9, location: 'pet_shop', x: -160, y: -40, activity: 'work' },\n        { hour: 18, location: 'pet_shop_house', x: -200, y: -80, activity: 'home' },\n        { hour: 22, location: 'pet_shop_house', x: -200, y: -80, activity: 'sleep' },\n      ],\n    },\n    gifts: {\n      loved: ['rabbit_foot', 'duck_feather', 'golden_pumpkin'],\n      liked: ['hay', 'flowers', 'milk', 'animal_treats'],\n      disliked: ['monster_parts', 'weapons', 'bomb'],\n      hated: ['void_egg', 'slime'],\n    },\n    dialogue: {\n      greeting: \"Welcome to Penny's Pet Paradise!\",\n      friendship: {\n        0: [\n          \"Welcome to Penny's Pet Paradise!\",\n          \"All my little friends are looking for homes!\",\n        ],\n        2: [\n          \"Looking for a companion? I have just the pet for you!\",\n          \"The animals have been restless lately. They sense something is wrong.\",\n        ],\n        4: [\n          \"My critters are calmer now. Whatever changed, they can feel it too.\",\n          \"You have a gentle aura. The animals trust you.\",\n        ],\n        6: [\n          \"The barn cats are purring again! First time in months!\",\n          \"Thank you for making the world a better place for my little friends.\",\n        ],\n        8: [\n          \"The animals are celebrating too! I can hear them singing!\",\n        ],\n        10: [\n          \"You're the kindest soul in Willowbrook. The animals and I are lucky to know you.\",\n        ],\n      },\n      birthday:\n        \"It's my birthday! The puppies made me a card. Well, they chewed on a card. Close enough!\",\n      festival: {\n        egg_hunt: \"The chicks are extra fluffy this spring! Come see!\",\n        luau: \"The pets love summer! Especially the ducks.\",\n        harvest: \"Harvest means plenty of treats for everyone - pets included!\",\n        winter_star: \"I'm knitting tiny sweaters for all the puppies!\",\n      },\n    },\n    shop: {\n      items: [\n        'cat', 'dog', 'chicken', 'cow', 'goat', 'duck', 'rabbit', 'sheep',\n        'hay', 'animal_treats', 'pet_bed', 'pet_toy',\n      ],\n      priceMultiplier: 1.0,\n    },\n    questIds: [],\n    homeCity: 'willowbrook',\n  },\n\n  // =========================================================================\n  // 10. Old Silas (Fisherman)\n  // =========================================================================\n  {\n    id: 'fisherman',\n    name: 'Old Silas',\n    title: 'Master Angler',\n    description:\n      'A weathered old fisherman who has spent his entire life on the waters near Willowbrook. He knows every fish, every current, and every secret the river holds.',\n    texture: 'npc_fisherman',\n    birthday: { season: 'summer', day: 14 },\n    schedule: {\n      spring: [\n        { hour: 4, location: 'fisherman_hut', x: 40, y: 180, activity: 'home' },\n        { hour: 5, location: 'beach', x: 0, y: 200, activity: 'fishing' },\n        { hour: 12, location: 'fisherman_hut', x: 40, y: 180, activity: 'lunch' },\n        { hour: 13, location: 'river_bend', x: -60, y: 160, activity: 'fishing' },\n        { hour: 18, location: 'tavern', x: 0, y: 80, activity: 'drinking' },\n        { hour: 21, location: 'fisherman_hut', x: 40, y: 180, activity: 'sleep' },\n      ],\n      summer: [\n        { hour: 4, location: 'fisherman_hut', x: 40, y: 180, activity: 'home' },\n        { hour: 5, location: 'beach', x: 0, y: 200, activity: 'fishing' },\n        { hour: 11, location: 'fisherman_hut', x: 40, y: 180, activity: 'lunch' },\n        { hour: 13, location: 'beach', x: 0, y: 200, activity: 'fishing' },\n        { hour: 19, location: 'tavern', x: 0, y: 80, activity: 'drinking' },\n        { hour: 22, location: 'fisherman_hut', x: 40, y: 180, activity: 'sleep' },\n      ],\n      fall: [\n        { hour: 5, location: 'fisherman_hut', x: 40, y: 180, activity: 'home' },\n        { hour: 6, location: 'river_bend', x: -60, y: 160, activity: 'fishing' },\n        { hour: 12, location: 'fisherman_hut', x: 40, y: 180, activity: 'lunch' },\n        { hour: 13, location: 'beach', x: 0, y: 200, activity: 'fishing' },\n        { hour: 17, location: 'tavern', x: 0, y: 80, activity: 'drinking' },\n        { hour: 21, location: 'fisherman_hut', x: 40, y: 180, activity: 'sleep' },\n      ],\n      winter: [\n        { hour: 7, location: 'fisherman_hut', x: 40, y: 180, activity: 'home' },\n        { hour: 9, location: 'river_bend', x: -60, y: 160, activity: 'ice_fishing' },\n        { hour: 14, location: 'tavern', x: 0, y: 80, activity: 'drinking' },\n        { hour: 18, location: 'fisherman_hut', x: 40, y: 180, activity: 'mending_nets' },\n        { hour: 21, location: 'fisherman_hut', x: 40, y: 180, activity: 'sleep' },\n      ],\n      rainy: [\n        { hour: 4, location: 'fisherman_hut', x: 40, y: 180, activity: 'home' },\n        { hour: 5, location: 'beach', x: 0, y: 200, activity: 'fishing' },\n        { hour: 18, location: 'tavern', x: 0, y: 80, activity: 'drinking' },\n        { hour: 21, location: 'fisherman_hut', x: 40, y: 180, activity: 'sleep' },\n      ],\n    },\n    gifts: {\n      loved: ['legend_fish', 'iridium_fishing_rod', 'ocean_stone'],\n      liked: ['fish', 'bait', 'crab_pot', 'cider', 'beer'],\n      disliked: ['gems', 'flowers', 'sweets'],\n      hated: ['joja_cola', 'trash'],\n    },\n    dialogue: {\n      greeting: \"The fish are bitin' today. You here to learn, or just watchin'?\",\n      friendship: {\n        0: [\n          \"The fish are bitin' today. You here to learn, or just watchin'?\",\n          \"Cast your line with patience. The river rewards those who wait.\",\n        ],\n        2: [\n          \"Your grandma used to fish here, y'know. Had a gift for it.\",\n          \"The fish have been scarce. Water feels... wrong. Tainted, maybe.\",\n          \"Been fishin' these waters sixty years. Never seen 'em this troubled.\",\n        ],\n        4: [\n          \"Fish are comin' back! Water's clearer than it's been in years.\",\n          \"You got your grandma's touch with nature. She'd be right proud.\",\n        ],\n        6: [\n          \"The legendary fish are stirrin'! Haven't seen that in decades!\",\n          \"Whatever you done, the river thanks you. And so do I.\",\n        ],\n        8: [\n          \"The waters sing again! The curse is truly broken!\",\n          \"I caught three legend fish this week. That hasn't happened since I was a boy.\",\n        ],\n        10: [\n          \"You're the finest soul this river has ever known. Fish with me anytime, partner.\",\n        ],\n      },\n      birthday:\n        \"Another year, another thousand fish. Pour me an ale and let's swap stories.\",\n      festival: {\n        egg_hunt: \"Spring run is startin'! Best fishin' of the year!\",\n        luau: \"Summer's when the big ones come close to shore.\",\n        harvest: \"Fall salmon run. Nothin' like it.\",\n        winter_star: \"Ice fishin' builds character. Bundle up and drop a line.\",\n      },\n    },\n    shop: {\n      items: [\n        'fishing_rod_basic', 'fishing_rod_fiberglass', 'fishing_rod_iridium',\n        'bait', 'wild_bait', 'magnet_bait',\n        'crab_pot', 'tackle_spinner', 'tackle_trap',\n      ],\n      priceMultiplier: 1.0,\n    },\n    questIds: ['legendary_catch', 'river_mystery'],\n    homeCity: 'willowbrook',\n  },\n\n  // =========================================================================\n  // 11. Rosalind (Librarian)\n  // =========================================================================\n  {\n    id: 'librarian',\n    name: 'Rosalind',\n    title: 'Town Librarian',\n    description:\n      'Quiet and scholarly, Rosalind manages the Willowbrook library and museum. She is an expert on local history and the ancient legends surrounding the town.',\n    texture: 'npc_librarian',\n    birthday: { season: 'fall', day: 3 },\n    schedule: {\n      spring: [\n        { hour: 7, location: 'library_house', x: -100, y: -160, activity: 'home' },\n        { hour: 9, location: 'library', x: -60, y: -120, activity: 'work' },\n        { hour: 12, location: 'town_square', x: 0, y: 0, activity: 'reading_outside' },\n        { hour: 13, location: 'library', x: -60, y: -120, activity: 'work' },\n        { hour: 18, location: 'forest_path', x: -280, y: 0, activity: 'walk' },\n        { hour: 20, location: 'library_house', x: -100, y: -160, activity: 'reading' },\n        { hour: 23, location: 'library_house', x: -100, y: -160, activity: 'sleep' },\n      ],\n      summer: [\n        { hour: 7, location: 'library_house', x: -100, y: -160, activity: 'home' },\n        { hour: 9, location: 'library', x: -60, y: -120, activity: 'work' },\n        { hour: 12, location: 'beach', x: 0, y: 200, activity: 'reading_outside' },\n        { hour: 14, location: 'library', x: -60, y: -120, activity: 'work' },\n        { hour: 18, location: 'library_house', x: -100, y: -160, activity: 'reading' },\n        { hour: 23, location: 'library_house', x: -100, y: -160, activity: 'sleep' },\n      ],\n      fall: [\n        { hour: 7, location: 'library_house', x: -100, y: -160, activity: 'home' },\n        { hour: 9, location: 'library', x: -60, y: -120, activity: 'work' },\n        { hour: 18, location: 'tavern', x: 0, y: 80, activity: 'socialize' },\n        { hour: 20, location: 'library_house', x: -100, y: -160, activity: 'reading' },\n        { hour: 23, location: 'library_house', x: -100, y: -160, activity: 'sleep' },\n      ],\n      winter: [\n        { hour: 8, location: 'library_house', x: -100, y: -160, activity: 'home' },\n        { hour: 10, location: 'library', x: -60, y: -120, activity: 'work' },\n        { hour: 17, location: 'library_house', x: -100, y: -160, activity: 'reading' },\n        { hour: 23, location: 'library_house', x: -100, y: -160, activity: 'sleep' },\n      ],\n      rainy: [\n        { hour: 7, location: 'library_house', x: -100, y: -160, activity: 'home' },\n        { hour: 9, location: 'library', x: -60, y: -120, activity: 'work' },\n        { hour: 20, location: 'library_house', x: -100, y: -160, activity: 'reading' },\n        { hour: 23, location: 'library_house', x: -100, y: -160, activity: 'sleep' },\n      ],\n    },\n    gifts: {\n      loved: ['ancient_scroll', 'rare_book', 'prismatic_shard'],\n      liked: ['coffee', 'pumpkin_soup', 'honey', 'ancient_fruit'],\n      disliked: ['weapons', 'monster_parts', 'beer'],\n      hated: ['slime', 'trash', 'bug_meat'],\n    },\n    dialogue: {\n      greeting: \"Shh... oh, it's you. Welcome to the library.\",\n      friendship: {\n        0: [\n          \"Shh... oh, it's you. Welcome to the library.\",\n          \"Please be careful with the books. Some are irreplaceable.\",\n        ],\n        2: [\n          \"Have you read 'The Founding of Willowbrook'? Fascinating history.\",\n          \"The oldest texts mention three ancient seals. I've been researching them.\",\n          \"Your grandmother donated several rare volumes to our collection.\",\n        ],\n        4: [\n          \"I found references to the curse in a 300-year-old journal. It's real.\",\n          \"The seals are mentioned in the Codex Luminara. An ancient protective magic.\",\n          \"You're making the legends come true. It's extraordinary to witness.\",\n        ],\n        6: [\n          \"I've documented everything. Future generations must know this story.\",\n          \"The ancient texts predicted someone like you. The 'Heir of Light.'\",\n        ],\n        8: [\n          \"The curse is broken! I can write the final chapter of the chronicle!\",\n          \"History will remember you. I'll make sure of it.\",\n        ],\n        10: [\n          \"You've given me the greatest story I'll ever have the privilege to tell.\",\n        ],\n      },\n      birthday:\n        \"My birthday? I was hoping for a quiet day with a good book. But your company is even better.\",\n      festival: {\n        egg_hunt: \"Spring is when the earliest settlers first arrived in Willowbrook, you know.\",\n        luau: \"I'm reading about ancient summer solstice rituals. Fascinating stuff.\",\n        harvest: \"The harvest festival dates back to Willowbrook's founding. Three hundred years of tradition!\",\n        winter_star: \"The Winter Star legend predates Willowbrook itself. Such rich lore.\",\n      },\n    },\n    questIds: ['lost_library_books', 'ancient_codex'],\n    homeCity: 'willowbrook',\n  },\n\n  // =========================================================================\n  // 12. Hank (Carpenter)\n  // =========================================================================\n  {\n    id: 'carpenter',\n    name: 'Hank',\n    title: 'Master Carpenter',\n    description:\n      'Sturdy and reliable, Hank builds and repairs everything in Willowbrook. From barns to bridges, if it is made of wood, Hank built it.',\n    texture: 'npc_carpenter',\n    birthday: { season: 'spring', day: 18 },\n    schedule: {\n      spring: [\n        { hour: 6, location: 'carpenter_house', x: 100, y: -120, activity: 'home' },\n        { hour: 7, location: 'carpenter_shop', x: 140, y: -100, activity: 'work' },\n        { hour: 12, location: 'town_square', x: 0, y: 0, activity: 'lunch' },\n        { hour: 13, location: 'carpenter_shop', x: 140, y: -100, activity: 'work' },\n        { hour: 18, location: 'tavern', x: 0, y: 80, activity: 'socialize' },\n        { hour: 21, location: 'carpenter_house', x: 100, y: -120, activity: 'sleep' },\n      ],\n      summer: [\n        { hour: 6, location: 'carpenter_house', x: 100, y: -120, activity: 'home' },\n        { hour: 7, location: 'carpenter_shop', x: 140, y: -100, activity: 'work' },\n        { hour: 12, location: 'town_square', x: 0, y: 0, activity: 'lunch' },\n        { hour: 13, location: 'forest_path', x: -280, y: 0, activity: 'lumber' },\n        { hour: 16, location: 'carpenter_shop', x: 140, y: -100, activity: 'work' },\n        { hour: 19, location: 'tavern', x: 0, y: 80, activity: 'socialize' },\n        { hour: 22, location: 'carpenter_house', x: 100, y: -120, activity: 'sleep' },\n      ],\n      fall: [\n        { hour: 6, location: 'carpenter_house', x: 100, y: -120, activity: 'home' },\n        { hour: 7, location: 'carpenter_shop', x: 140, y: -100, activity: 'work' },\n        { hour: 12, location: 'town_square', x: 0, y: 0, activity: 'lunch' },\n        { hour: 13, location: 'carpenter_shop', x: 140, y: -100, activity: 'work' },\n        { hour: 18, location: 'tavern', x: 0, y: 80, activity: 'socialize' },\n        { hour: 21, location: 'carpenter_house', x: 100, y: -120, activity: 'sleep' },\n      ],\n      winter: [\n        { hour: 7, location: 'carpenter_house', x: 100, y: -120, activity: 'home' },\n        { hour: 8, location: 'carpenter_shop', x: 140, y: -100, activity: 'work' },\n        { hour: 12, location: 'tavern', x: 0, y: 80, activity: 'lunch' },\n        { hour: 13, location: 'carpenter_shop', x: 140, y: -100, activity: 'work' },\n        { hour: 17, location: 'tavern', x: 0, y: 80, activity: 'socialize' },\n        { hour: 20, location: 'carpenter_house', x: 100, y: -120, activity: 'sleep' },\n      ],\n      rainy: [\n        { hour: 6, location: 'carpenter_house', x: 100, y: -120, activity: 'home' },\n        { hour: 8, location: 'carpenter_shop', x: 140, y: -100, activity: 'work' },\n        { hour: 18, location: 'carpenter_house', x: 100, y: -120, activity: 'home' },\n        { hour: 21, location: 'carpenter_house', x: 100, y: -120, activity: 'sleep' },\n      ],\n    },\n    gifts: {\n      loved: ['hardwood', 'oak_resin', 'maple_syrup'],\n      liked: ['wood', 'stone', 'beer', 'cooked_food'],\n      disliked: ['flowers', 'gems', 'sweets'],\n      hated: ['trash', 'slime'],\n    },\n    dialogue: {\n      greeting:\n        \"Need somethin' built? I'm your man. Measure twice, cut once!\",\n      friendship: {\n        0: [\n          \"Need somethin' built? I'm your man. Measure twice, cut once!\",\n          \"Good timber makes good buildings. And good buildings make a good town.\",\n        ],\n        2: [\n          \"Built your grandmother's barn, I did. Finest work I ever done.\",\n          \"The wood's been warping strangely. Like it's... resisting the saw.\",\n          \"Used to be I could build a shed in a day. Lately everything takes longer.\",\n        ],\n        4: [\n          \"The wood is cooperating again! Cuts clean, joints true.\",\n          \"Your grandmother asked me to reinforce the community center once. Said it needed to last 'forever.'\",\n        ],\n        6: [\n          \"I can feel the difference in every plank. The curse was in the very trees.\",\n          \"Building's a joy again. Thank you for that.\",\n        ],\n        8: [\n          \"The town looks better than it has in decades! And it's all thanks to you!\",\n          \"Let me build you something special. On the house. You've earned it.\",\n        ],\n        10: [\n          \"You're the backbone of this town, just like your grandmother was. I'm honored to know you.\",\n        ],\n      },\n      birthday:\n        \"My birthday! The missus baked a cake. Want a slice? Careful, it's as sturdy as my furniture.\",\n      festival: {\n        egg_hunt: \"Spring's the best time for building. Fresh lumber, dry days.\",\n        luau: \"Summer heat warps wood if you're not careful. Stay in the shade!\",\n        harvest: \"Fall's when I stock up on hardwood for winter projects.\",\n        winter_star: \"Indoor projects all winter. Come see my latest creations!\",\n      },\n    },\n    shop: {\n      items: [\n        'barn_blueprint', 'coop_blueprint', 'silo_blueprint',\n        'shed_blueprint', 'stable_blueprint', 'well_blueprint',\n        'fence_wood', 'fence_stone', 'fence_iron',\n        'wood', 'hardwood', 'stone',\n      ],\n      priceMultiplier: 1.0,\n    },\n    questIds: ['barn_raising', 'bridge_repair'],\n    homeCity: 'willowbrook',\n  },\n\n  // =========================================================================\n  // 13. Dustin (Miner)\n  // =========================================================================\n  {\n    id: 'miner',\n    name: 'Dustin',\n    title: 'Mine Foreman',\n    description:\n      'Tough and practical, Dustin leads the mining operations near Willowbrook. He has delved deeper than anyone and knows the mountain\\'s secrets.',\n    texture: 'npc_miner',\n    birthday: { season: 'winter', day: 22 },\n    schedule: {\n      spring: [\n        { hour: 5, location: 'miner_cabin', x: 200, y: 60, activity: 'home' },\n        { hour: 6, location: 'dungeon_entrance', x: 240, y: 80, activity: 'mining' },\n        { hour: 14, location: 'tavern', x: 0, y: 80, activity: 'lunch' },\n        { hour: 15, location: 'dungeon_entrance', x: 240, y: 80, activity: 'mining' },\n        { hour: 19, location: 'tavern', x: 0, y: 80, activity: 'drinking' },\n        { hour: 22, location: 'miner_cabin', x: 200, y: 60, activity: 'sleep' },\n      ],\n      summer: [\n        { hour: 5, location: 'miner_cabin', x: 200, y: 60, activity: 'home' },\n        { hour: 6, location: 'dungeon_entrance', x: 240, y: 80, activity: 'mining' },\n        { hour: 14, location: 'tavern', x: 0, y: 80, activity: 'lunch' },\n        { hour: 15, location: 'dungeon_entrance', x: 240, y: 80, activity: 'mining' },\n        { hour: 19, location: 'tavern', x: 0, y: 80, activity: 'drinking' },\n        { hour: 22, location: 'miner_cabin', x: 200, y: 60, activity: 'sleep' },\n      ],\n      fall: [\n        { hour: 5, location: 'miner_cabin', x: 200, y: 60, activity: 'home' },\n        { hour: 6, location: 'dungeon_entrance', x: 240, y: 80, activity: 'mining' },\n        { hour: 14, location: 'tavern', x: 0, y: 80, activity: 'lunch' },\n        { hour: 15, location: 'dungeon_entrance', x: 240, y: 80, activity: 'mining' },\n        { hour: 18, location: 'blacksmith', x: 120, y: 40, activity: 'trading' },\n        { hour: 19, location: 'tavern', x: 0, y: 80, activity: 'drinking' },\n        { hour: 22, location: 'miner_cabin', x: 200, y: 60, activity: 'sleep' },\n      ],\n      winter: [\n        { hour: 6, location: 'miner_cabin', x: 200, y: 60, activity: 'home' },\n        { hour: 7, location: 'dungeon_entrance', x: 240, y: 80, activity: 'mining' },\n        { hour: 13, location: 'tavern', x: 0, y: 80, activity: 'lunch' },\n        { hour: 14, location: 'dungeon_entrance', x: 240, y: 80, activity: 'mining' },\n        { hour: 17, location: 'tavern', x: 0, y: 80, activity: 'drinking' },\n        { hour: 21, location: 'miner_cabin', x: 200, y: 60, activity: 'sleep' },\n      ],\n      rainy: [\n        { hour: 5, location: 'miner_cabin', x: 200, y: 60, activity: 'home' },\n        { hour: 6, location: 'dungeon_entrance', x: 240, y: 80, activity: 'mining' },\n        { hour: 19, location: 'tavern', x: 0, y: 80, activity: 'drinking' },\n        { hour: 22, location: 'miner_cabin', x: 200, y: 60, activity: 'sleep' },\n      ],\n    },\n    gifts: {\n      loved: ['diamond', 'prismatic_shard', 'gold_ore'],\n      liked: ['ores', 'gems', 'beer', 'meat_stew', 'baked_potato'],\n      disliked: ['flowers', 'fish', 'sweets'],\n      hated: ['fairy_rose', 'poppy'],\n    },\n    dialogue: {\n      greeting: \"Watch your step around the mines. It ain't a playground down there.\",\n      friendship: {\n        0: [\n          \"Watch your step around the mines. It ain't a playground down there.\",\n          \"Ore don't mine itself. You here to work or chat?\",\n        ],\n        2: [\n          \"Deeper levels got somethin' strange. Glowing rocks, whispering walls.\",\n          \"The mountain groans at night. Like it's in pain.\",\n          \"Your grandma went into the mines once. Came back with the strangest look on her face.\",\n        ],\n        4: [\n          \"Found a vein of ore that practically jumps out of the rock now. Never seen the like.\",\n          \"The whispers stopped. Mountain's at peace for the first time in years.\",\n        ],\n        6: [\n          \"New caverns are opening up! The mountain's revealing its treasures!\",\n          \"Whatever you did down there... the mountain remembers. And it's grateful.\",\n        ],\n        8: [\n          \"Best mining season in my whole career! The curse was choking the veins!\",\n          \"You freed the mountain itself. I'll never forget that.\",\n        ],\n        10: [\n          \"You're welcome in the deepest shafts anytime. You've earned the mountain's trust.\",\n        ],\n      },\n      birthday:\n        \"My birthday? Found a diamond yesterday. That's gift enough. ...But I won't say no to a drink.\",\n      festival: {\n        egg_hunt: \"Spring thaw opens up new tunnels. Good season for exploring.\",\n        luau: \"The heat makes deep mining almost pleasant. Cool down there.\",\n        harvest: \"Fall's when the rare ores surface. Keep your eyes peeled.\",\n        winter_star: \"Frozen ground makes for tricky mining. But the gems shine brighter.\",\n      },\n    },\n    questIds: ['deep_mine_expedition', 'rare_gem_hunt'],\n    homeCity: 'willowbrook',\n  },\n\n  // =========================================================================\n  // 14. Melody (Musician) - Romanceable\n  // =========================================================================\n  {\n    id: 'musician',\n    name: 'Melody',\n    title: 'Traveling Bard',\n    description:\n      'A free-spirited musician who settled in Willowbrook after falling in love with the town. She plays at the tavern and writes songs about the people she meets.',\n    texture: 'npc_musician',\n    birthday: { season: 'summer', day: 25 },\n    schedule: {\n      spring: [\n        { hour: 9, location: 'musician_cottage', x: -40, y: -160, activity: 'home' },\n        { hour: 11, location: 'town_square', x: 0, y: 0, activity: 'busking' },\n        { hour: 14, location: 'forest_path', x: -280, y: 0, activity: 'composing' },\n        { hour: 17, location: 'tavern', x: 0, y: 80, activity: 'performing' },\n        { hour: 23, location: 'musician_cottage', x: -40, y: -160, activity: 'sleep' },\n      ],\n      summer: [\n        { hour: 9, location: 'musician_cottage', x: -40, y: -160, activity: 'home' },\n        { hour: 11, location: 'beach', x: 0, y: 200, activity: 'busking' },\n        { hour: 14, location: 'town_square', x: 0, y: 0, activity: 'composing' },\n        { hour: 17, location: 'tavern', x: 0, y: 80, activity: 'performing' },\n        { hour: 23, location: 'musician_cottage', x: -40, y: -160, activity: 'sleep' },\n      ],\n      fall: [\n        { hour: 9, location: 'musician_cottage', x: -40, y: -160, activity: 'home' },\n        { hour: 11, location: 'town_square', x: 0, y: 0, activity: 'busking' },\n        { hour: 14, location: 'forest_path', x: -280, y: 0, activity: 'composing' },\n        { hour: 17, location: 'tavern', x: 0, y: 80, activity: 'performing' },\n        { hour: 23, location: 'musician_cottage', x: -40, y: -160, activity: 'sleep' },\n      ],\n      winter: [\n        { hour: 10, location: 'musician_cottage', x: -40, y: -160, activity: 'home' },\n        { hour: 12, location: 'tavern', x: 0, y: 80, activity: 'performing' },\n        { hour: 15, location: 'library', x: -60, y: -120, activity: 'reading' },\n        { hour: 17, location: 'tavern', x: 0, y: 80, activity: 'performing' },\n        { hour: 23, location: 'musician_cottage', x: -40, y: -160, activity: 'sleep' },\n      ],\n      rainy: [\n        { hour: 9, location: 'musician_cottage', x: -40, y: -160, activity: 'composing' },\n        { hour: 14, location: 'tavern', x: 0, y: 80, activity: 'performing' },\n        { hour: 23, location: 'musician_cottage', x: -40, y: -160, activity: 'sleep' },\n      ],\n    },\n    gifts: {\n      loved: ['flute_block', 'drum_block', 'prismatic_shard'],\n      liked: ['flowers', 'coffee', 'wine', 'honey'],\n      disliked: ['ores', 'monster_parts', 'coal'],\n      hated: ['slime', 'trash', 'void_egg'],\n    },\n    dialogue: {\n      greeting: \"La la la~ Oh! Hello there! Didn't see you sneaking up!\",\n      friendship: {\n        0: [\n          \"La la la~ Oh! Hello there! Didn't see you sneaking up!\",\n          \"I'm writing a song about Willowbrook. Still working on the chorus.\",\n        ],\n        2: [\n          \"Every person in this town has a melody. I'm trying to learn them all.\",\n          \"My songs used to ring clear, but lately the notes feel... muffled. Like something's dampening the music.\",\n          \"Your grandmother loved my lullabies. She said they kept the shadows at bay.\",\n        ],\n        4: [\n          \"Listen! Can you hear it? The music is coming back to Willowbrook!\",\n          \"I'm writing a ballad about a farmer who saves a cursed town. Totally fictional, of course.\",\n          \"The birds are singing harmonies again! They stopped months ago.\",\n        ],\n        6: [\n          \"The Ballad of the Sealed Light! It's my masterpiece, and it's about YOU!\",\n          \"Music has power, you know. Real power. You've proven that.\",\n        ],\n        8: [\n          \"The whole world is singing! Can you feel it? The curse is GONE!\",\n          \"I wrote you a song. It's... personal. I hope you like it.\",\n        ],\n        10: [\n          \"You're my muse. Every note I play, I play for you.\",\n        ],\n      },\n      birthday:\n        \"My birthday! Time for a concert! I'm dedicating tonight's performance to... well, you'll see!\",\n      festival: {\n        egg_hunt: \"Spring inspires the happiest melodies!\",\n        luau: \"Summer nights are made for music under the stars.\",\n        harvest: \"Fall harmonies are my favorite. Rich and warm, like the season.\",\n        winter_star: \"Winter carols by the fire. There's nothing better.\",\n      },\n    },\n    questIds: ['lost_sheet_music', 'melody_concert'],\n    homeCity: 'willowbrook',\n  },\n\n  // =========================================================================\n  // 15. Clara (Rancher)\n  // =========================================================================\n  {\n    id: 'rancher',\n    name: 'Clara',\n    title: 'Ranch Owner',\n    description:\n      'No-nonsense and hardworking, Clara runs the largest ranch near Willowbrook. She raises cattle, horses, and produces the finest dairy products in the region.',\n    texture: 'npc_rancher',\n    birthday: { season: 'fall', day: 14 },\n    schedule: {\n      spring: [\n        { hour: 5, location: 'ranch_house', x: -240, y: 80, activity: 'home' },\n        { hour: 6, location: 'ranch_pasture', x: -280, y: 120, activity: 'tending_animals' },\n        { hour: 10, location: 'ranch_barn', x: -260, y: 100, activity: 'milking' },\n        { hour: 12, location: 'ranch_house', x: -240, y: 80, activity: 'lunch' },\n        { hour: 13, location: 'ranch_pasture', x: -280, y: 120, activity: 'tending_animals' },\n        { hour: 17, location: 'general_store', x: -120, y: 40, activity: 'selling' },\n        { hour: 19, location: 'ranch_house', x: -240, y: 80, activity: 'home' },\n        { hour: 21, location: 'ranch_house', x: -240, y: 80, activity: 'sleep' },\n      ],\n      summer: [\n        { hour: 5, location: 'ranch_house', x: -240, y: 80, activity: 'home' },\n        { hour: 6, location: 'ranch_pasture', x: -280, y: 120, activity: 'tending_animals' },\n        { hour: 10, location: 'ranch_barn', x: -260, y: 100, activity: 'milking' },\n        { hour: 12, location: 'ranch_house', x: -240, y: 80, activity: 'lunch' },\n        { hour: 13, location: 'ranch_pasture', x: -280, y: 120, activity: 'tending_animals' },\n        { hour: 16, location: 'beach', x: 0, y: 200, activity: 'cooling_off' },\n        { hour: 18, location: 'tavern', x: 0, y: 80, activity: 'socialize' },\n        { hour: 21, location: 'ranch_house', x: -240, y: 80, activity: 'sleep' },\n      ],\n      fall: [\n        { hour: 5, location: 'ranch_house', x: -240, y: 80, activity: 'home' },\n        { hour: 6, location: 'ranch_pasture', x: -280, y: 120, activity: 'tending_animals' },\n        { hour: 10, location: 'ranch_barn', x: -260, y: 100, activity: 'milking' },\n        { hour: 12, location: 'ranch_house', x: -240, y: 80, activity: 'lunch' },\n        { hour: 13, location: 'ranch_pasture', x: -280, y: 120, activity: 'tending_animals' },\n        { hour: 17, location: 'general_store', x: -120, y: 40, activity: 'selling' },\n        { hour: 19, location: 'tavern', x: 0, y: 80, activity: 'socialize' },\n        { hour: 21, location: 'ranch_house', x: -240, y: 80, activity: 'sleep' },\n      ],\n      winter: [\n        { hour: 6, location: 'ranch_house', x: -240, y: 80, activity: 'home' },\n        { hour: 7, location: 'ranch_barn', x: -260, y: 100, activity: 'tending_animals' },\n        { hour: 12, location: 'ranch_house', x: -240, y: 80, activity: 'lunch' },\n        { hour: 13, location: 'ranch_barn', x: -260, y: 100, activity: 'tending_animals' },\n        { hour: 16, location: 'general_store', x: -120, y: 40, activity: 'selling' },\n        { hour: 18, location: 'ranch_house', x: -240, y: 80, activity: 'home' },\n        { hour: 21, location: 'ranch_house', x: -240, y: 80, activity: 'sleep' },\n      ],\n      rainy: [\n        { hour: 5, location: 'ranch_house', x: -240, y: 80, activity: 'home' },\n        { hour: 6, location: 'ranch_barn', x: -260, y: 100, activity: 'tending_animals' },\n        { hour: 12, location: 'ranch_house', x: -240, y: 80, activity: 'lunch' },\n        { hour: 13, location: 'ranch_barn', x: -260, y: 100, activity: 'tending_animals' },\n        { hour: 18, location: 'ranch_house', x: -240, y: 80, activity: 'home' },\n        { hour: 21, location: 'ranch_house', x: -240, y: 80, activity: 'sleep' },\n      ],\n    },\n    gifts: {\n      loved: ['large_milk', 'truffle', 'golden_pumpkin'],\n      liked: ['milk', 'cheese', 'wool', 'hay', 'animal_treats'],\n      disliked: ['fish', 'gems', 'void_essence'],\n      hated: ['void_egg', 'slime', 'bug_meat'],\n    },\n    dialogue: {\n      greeting:\n        \"Mornin'. Cows don't milk themselves, so make it quick.\",\n      friendship: {\n        0: [\n          \"Mornin'. Cows don't milk themselves, so make it quick.\",\n          \"A ranch runs on hard work and early mornings. You look like you understand that.\",\n        ],\n        2: [\n          \"Your grandmother kept the finest chickens in the county. Bet you didn't know that.\",\n          \"Animals have been spooked lately. Won't go near the east pasture.\",\n          \"Milk production's down. The cattle sense something wrong with the land.\",\n        ],\n        4: [\n          \"The animals are calming down. Whatever was scaring them seems to be fading.\",\n          \"My best cow just had twins! First time in years. Good omen.\",\n        ],\n        6: [\n          \"Milk's richer, eggs are bigger, wool's softer. The land is healing!\",\n          \"You've got a rancher's heart. The animals trust you.\",\n        ],\n        8: [\n          \"Best yields in a generation! The curse was starving the whole land!\",\n          \"The horses are galloping free again. They know the danger has passed.\",\n        ],\n        10: [\n          \"You saved my ranch, my animals, and my livelihood. You're always welcome here.\",\n        ],\n      },\n      birthday:\n        \"My birthday? The cows don't care about birthdays. ...But a nice cheese wheel would be appreciated.\",\n      festival: {\n        egg_hunt: \"Spring calving season. Busiest time of year!\",\n        luau: \"Gotta keep the animals hydrated in this heat.\",\n        harvest: \"Fall means stocking up feed for winter. No time to waste.\",\n        winter_star: \"Winter's hard on the animals. Extra hay, extra care.\",\n      },\n    },\n    shop: {\n      items: [\n        'milk', 'large_milk', 'cheese', 'goat_cheese',\n        'wool', 'egg', 'duck_egg',\n        'hay', 'animal_treats',\n      ],\n      priceMultiplier: 1.0,\n    },\n    questIds: ['lost_calf', 'ranch_expansion'],\n    homeCity: 'willowbrook',\n  },\n];\n\n// ---------------------------------------------------------------------------\n// Lookup Map\n// ---------------------------------------------------------------------------\n\nexport const NPC_DB = new Map<string, NPCDef>(NPCS.map((n) => [n.id, n]));\n","import { NPCS, NPCDef, NPC_DB } from '../data/npcs';\n\nexport type GiftReaction = 'loved' | 'liked' | 'neutral' | 'disliked' | 'hated';\n\nexport interface GiftResult {\n  points: number;\n  reaction: GiftReaction;\n}\n\n/** Points awarded (or deducted) per gift reaction tier. */\nconst GIFT_POINTS: Record<GiftReaction, number> = {\n  loved: 80,\n  liked: 45,\n  neutral: 20,\n  disliked: -20,\n  hated: -40,\n};\n\nconst BIRTHDAY_MULTIPLIER = 8;\nconst POINTS_PER_HEART = 250;\nconst MAX_HEARTS = 10;\nconst MAX_FRIENDSHIP = MAX_HEARTS * POINTS_PER_HEART; // 2500\n\ninterface RelationshipSaveData {\n  friendship: Record<string, number>;\n  giftedToday: string[];\n  birthdayActive: Record<string, boolean>;\n}\n\n/**\n * Manages NPC friendship levels, gift giving, and dialogue unlocks.\n * Each heart = 250 friendship points. Max 10 hearts (2500 points).\n */\nexport class RelationshipManager {\n  private friendship: Map<string, number> = new Map();\n  private giftedToday: Set<string> = new Set();\n  private birthdayMultiplierActive: Map<string, boolean> = new Map();\n  private heartUpCallbacks: Array<(npcId: string, hearts: number) => void> = [];\n\n  constructor() {\n    for (const npc of NPCS) {\n      this.friendship.set(npc.id, 0);\n      this.birthdayMultiplierActive.set(npc.id, false);\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Gift Giving\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Give a gift to an NPC. Checks gift preferences, adds friendship points,\n   * and returns the reaction. Only one gift per NPC per day.\n   * Returns null if the NPC has already been gifted today.\n   */\n  giveGift(npcId: string, itemId: string): GiftResult | null {\n    const npc = NPC_DB.get(npcId);\n    if (!npc) return null;\n\n    if (this.giftedToday.has(npcId)) return null;\n\n    const reaction = this.getReaction(npc, itemId);\n    let points = GIFT_POINTS[reaction];\n\n    // Apply birthday multiplier\n    if (this.birthdayMultiplierActive.get(npcId)) {\n      points *= BIRTHDAY_MULTIPLIER;\n    }\n\n    this.addFriendship(npcId, points);\n    this.giftedToday.add(npcId);\n\n    return { points, reaction };\n  }\n\n  // ---------------------------------------------------------------------------\n  // Friendship\n  // ---------------------------------------------------------------------------\n\n  /** Get the number of hearts (0-10) for an NPC. */\n  getHearts(npcId: string): number {\n    const pts = this.friendship.get(npcId) ?? 0;\n    return Math.min(MAX_HEARTS, Math.floor(pts / POINTS_PER_HEART));\n  }\n\n  /** Get the raw friendship points for an NPC. */\n  getFriendshipPoints(npcId: string): number {\n    return this.friendship.get(npcId) ?? 0;\n  }\n\n  /** Directly add (or subtract) friendship points. Clamps to [0, 2500]. */\n  addFriendship(npcId: string, amount: number): void {\n    if (!NPC_DB.has(npcId)) return;\n\n    const prevHearts = this.getHearts(npcId);\n    const current = this.friendship.get(npcId) ?? 0;\n    const clamped = Math.max(0, Math.min(MAX_FRIENDSHIP, current + amount));\n    this.friendship.set(npcId, clamped);\n\n    const newHearts = this.getHearts(npcId);\n\n    // Fire callbacks for each heart gained\n    for (let h = prevHearts + 1; h <= newHearts; h++) {\n      for (const cb of this.heartUpCallbacks) {\n        cb(npcId, h);\n      }\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Dialogue\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Returns dialogue strings available at the NPC's current heart level.\n   * Collects all dialogue entries whose heart threshold is at or below\n   * the current heart count.\n   */\n  getUnlockedDialogue(npcId: string): string[] {\n    const npc = NPC_DB.get(npcId);\n    if (!npc) return [];\n\n    const hearts = this.getHearts(npcId);\n    const dialogue: string[] = [];\n\n    const thresholds = Object.keys(npc.dialogue.friendship)\n      .map(Number)\n      .sort((a, b) => a - b);\n\n    for (const threshold of thresholds) {\n      if (threshold <= hearts) {\n        const lines = npc.dialogue.friendship[threshold];\n        if (lines) dialogue.push(...lines);\n      }\n    }\n\n    return dialogue;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Daily Gifts\n  // ---------------------------------------------------------------------------\n\n  /** Check whether this NPC has already received a gift today. */\n  hasGiftedToday(npcId: string): boolean {\n    return this.giftedToday.has(npcId);\n  }\n\n  /** Reset the daily gift tracking. Call this on each new in-game day. */\n  resetDailyGifts(): void {\n    this.giftedToday.clear();\n  }\n\n  // ---------------------------------------------------------------------------\n  // Birthday\n  // ---------------------------------------------------------------------------\n\n  /** Set whether the birthday multiplier is active for an NPC. */\n  setBirthdayActive(npcId: string, active: boolean): void {\n    this.birthdayMultiplierActive.set(npcId, active);\n  }\n\n  /** Check if an NPC currently has the birthday multiplier active. */\n  isBirthdayActive(npcId: string): boolean {\n    return this.birthdayMultiplierActive.get(npcId) ?? false;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Callbacks\n  // ---------------------------------------------------------------------------\n\n  /** Register a callback fired whenever an NPC gains a new heart. */\n  onHeartUp(cb: (npcId: string, hearts: number) => void): void {\n    this.heartUpCallbacks.push(cb);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Persistence\n  // ---------------------------------------------------------------------------\n\n  /** Serialize for save. */\n  serialize(): RelationshipSaveData {\n    const friendship: Record<string, number> = {};\n    for (const [id, val] of this.friendship) {\n      friendship[id] = val;\n    }\n    const birthdayActive: Record<string, boolean> = {};\n    for (const [id, val] of this.birthdayMultiplierActive) {\n      birthdayActive[id] = val;\n    }\n    return {\n      friendship,\n      giftedToday: Array.from(this.giftedToday),\n      birthdayActive,\n    };\n  }\n\n  /** Deserialize from save. */\n  deserialize(data: RelationshipSaveData): void {\n    if (data.friendship) {\n      for (const [id, val] of Object.entries(data.friendship)) {\n        this.friendship.set(id, val);\n      }\n    }\n    if (data.giftedToday) {\n      this.giftedToday = new Set(data.giftedToday);\n    }\n    if (data.birthdayActive) {\n      for (const [id, val] of Object.entries(data.birthdayActive)) {\n        this.birthdayMultiplierActive.set(id, val);\n      }\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Internal\n  // ---------------------------------------------------------------------------\n\n  /** Determine the gift reaction tier for an NPC given an item ID. */\n  private getReaction(npc: NPCDef, itemId: string): GiftReaction {\n    if (npc.gifts.loved.includes(itemId)) return 'loved';\n    if (npc.gifts.liked.includes(itemId)) return 'liked';\n    if (npc.gifts.hated.includes(itemId)) return 'hated';\n    if (npc.gifts.disliked.includes(itemId)) return 'disliked';\n    return 'neutral';\n  }\n}\n","/**\n * EDILAS (Phaser) - Recipe Definitions\n * Ported from legacy crafting.ts + cooking.ts\n *\n * Categories: crafting, cooking, alchemy, smithing, sewing\n * Stations: workbench, furnace, anvil, sewing_machine, alchemy_table, kitchen, campfire, none\n */\n\n// ---------------------------------------------------------------------------\n// Interfaces\n// ---------------------------------------------------------------------------\n\nexport interface RecipeIngredient {\n  itemId: string;\n  quantity: number;\n}\n\nexport interface RecipeDef {\n  id: string;\n  name: string;\n  category: 'crafting' | 'cooking' | 'alchemy' | 'smithing' | 'sewing';\n  station: string;\n  ingredients: RecipeIngredient[];\n  output: { itemId: string; quantity: number };\n  craftTime: number;       // seconds\n  skillRequired?: string;  // skill id\n  levelRequired?: number;  // skill level needed\n  xpReward?: number;       // skill xp gained\n  discoverable: boolean;   // must be discovered/learned first?\n}\n\n// ---------------------------------------------------------------------------\n// CRAFTING RECIPES  (general crafting, weapons, armor, utility, smelting, alchemy)\n// ---------------------------------------------------------------------------\n\nexport const CRAFTING_RECIPES: RecipeDef[] = [\n  // ===========================================\n  // Basic Crafting - Tools & Farm Equipment\n  // ===========================================\n  {\n    id: 'torch',\n    name: 'Torch',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'wood', quantity: 1 },\n      { itemId: 'coal', quantity: 1 },\n    ],\n    output: { itemId: 'torch', quantity: 4 },\n    craftTime: 3,\n    xpReward: 5,\n    discoverable: false,\n  },\n  {\n    id: 'campfire',\n    name: 'Campfire',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'wood', quantity: 10 },\n      { itemId: 'stone', quantity: 5 },\n    ],\n    output: { itemId: 'campfire', quantity: 1 },\n    craftTime: 4,\n    xpReward: 8,\n    discoverable: false,\n  },\n  {\n    id: 'chest',\n    name: 'Chest',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'wood', quantity: 50 },\n    ],\n    output: { itemId: 'chest', quantity: 1 },\n    craftTime: 5,\n    xpReward: 10,\n    discoverable: false,\n  },\n  {\n    id: 'scarecrow',\n    name: 'Scarecrow',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'wood', quantity: 50 },\n      { itemId: 'fiber', quantity: 20 },\n      { itemId: 'coal', quantity: 1 },\n    ],\n    output: { itemId: 'scarecrow', quantity: 1 },\n    craftTime: 5,\n    xpReward: 15,\n    discoverable: false,\n  },\n  {\n    id: 'sprinkler',\n    name: 'Basic Sprinkler',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'copper_bar', quantity: 1 },\n      { itemId: 'iron_bar', quantity: 1 },\n    ],\n    output: { itemId: 'sprinkler', quantity: 1 },\n    craftTime: 5,\n    skillRequired: 'farming',\n    levelRequired: 2,\n    xpReward: 25,\n    discoverable: true,\n  },\n  {\n    id: 'quality_sprinkler',\n    name: 'Quality Sprinkler',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'iron_bar', quantity: 2 },\n      { itemId: 'gold_bar', quantity: 1 },\n    ],\n    output: { itemId: 'quality_sprinkler', quantity: 1 },\n    craftTime: 5,\n    skillRequired: 'farming',\n    levelRequired: 6,\n    xpReward: 50,\n    discoverable: true,\n  },\n  {\n    id: 'iridium_sprinkler',\n    name: 'Iridium Sprinkler',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'gold_bar', quantity: 3 },\n      { itemId: 'prismatic_shard', quantity: 1 },\n    ],\n    output: { itemId: 'iridium_sprinkler', quantity: 1 },\n    craftTime: 10,\n    skillRequired: 'farming',\n    levelRequired: 9,\n    xpReward: 100,\n    discoverable: true,\n  },\n\n  // ===========================================\n  // Fertilizers\n  // ===========================================\n  {\n    id: 'fertilizer',\n    name: 'Basic Fertilizer',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'fiber', quantity: 5 },\n      { itemId: 'sap', quantity: 2 },\n    ],\n    output: { itemId: 'fertilizer', quantity: 2 },\n    craftTime: 3,\n    skillRequired: 'farming',\n    levelRequired: 1,\n    xpReward: 5,\n    discoverable: false,\n  },\n  {\n    id: 'quality_fertilizer',\n    name: 'Quality Fertilizer',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'fertilizer', quantity: 2 },\n      { itemId: 'fish', quantity: 1 },\n    ],\n    output: { itemId: 'quality_fertilizer', quantity: 2 },\n    craftTime: 5,\n    skillRequired: 'farming',\n    levelRequired: 4,\n    xpReward: 15,\n    discoverable: true,\n  },\n\n  // ===========================================\n  // Smelting - Bars & Alloys (station: furnace)\n  // ===========================================\n  {\n    id: 'copper_bar',\n    name: 'Copper Bar',\n    category: 'smithing',\n    station: 'furnace',\n    ingredients: [\n      { itemId: 'copper_ore', quantity: 5 },\n      { itemId: 'coal', quantity: 1 },\n    ],\n    output: { itemId: 'copper_bar', quantity: 1 },\n    craftTime: 30,\n    xpReward: 10,\n    discoverable: false,\n  },\n  {\n    id: 'iron_bar',\n    name: 'Iron Bar',\n    category: 'smithing',\n    station: 'furnace',\n    ingredients: [\n      { itemId: 'iron_ore', quantity: 5 },\n      { itemId: 'coal', quantity: 1 },\n    ],\n    output: { itemId: 'iron_bar', quantity: 1 },\n    craftTime: 45,\n    xpReward: 15,\n    discoverable: false,\n  },\n  {\n    id: 'gold_bar',\n    name: 'Gold Bar',\n    category: 'smithing',\n    station: 'furnace',\n    ingredients: [\n      { itemId: 'gold_ore', quantity: 5 },\n      { itemId: 'coal', quantity: 1 },\n    ],\n    output: { itemId: 'gold_bar', quantity: 1 },\n    craftTime: 60,\n    xpReward: 20,\n    discoverable: false,\n  },\n  {\n    id: 'steel_bar',\n    name: 'Steel Bar',\n    category: 'smithing',\n    station: 'furnace',\n    ingredients: [\n      { itemId: 'iron_bar', quantity: 2 },\n      { itemId: 'coal', quantity: 3 },\n    ],\n    output: { itemId: 'steel_bar', quantity: 1 },\n    craftTime: 60,\n    skillRequired: 'mining',\n    levelRequired: 4,\n    xpReward: 30,\n    discoverable: true,\n  },\n  {\n    id: 'ornate_bar',\n    name: 'Ornate Alloy Bar',\n    category: 'smithing',\n    station: 'furnace',\n    ingredients: [\n      { itemId: 'gold_bar', quantity: 2 },\n      { itemId: 'copper_bar', quantity: 1 },\n      { itemId: 'coal', quantity: 2 },\n    ],\n    output: { itemId: 'ornate_bar', quantity: 1 },\n    craftTime: 75,\n    skillRequired: 'mining',\n    levelRequired: 5,\n    xpReward: 35,\n    discoverable: true,\n  },\n  {\n    id: 'void_ingot',\n    name: 'Void Ingot',\n    category: 'smithing',\n    station: 'furnace',\n    ingredients: [\n      { itemId: 'void_heart', quantity: 1 },\n      { itemId: 'iron_bar', quantity: 3 },\n      { itemId: 'coal', quantity: 5 },\n    ],\n    output: { itemId: 'void_ingot', quantity: 1 },\n    craftTime: 90,\n    skillRequired: 'mining',\n    levelRequired: 7,\n    xpReward: 60,\n    discoverable: true,\n  },\n  {\n    id: 'frost_alloy',\n    name: 'Frostforged Alloy',\n    category: 'smithing',\n    station: 'furnace',\n    ingredients: [\n      { itemId: 'frozen_heart', quantity: 1 },\n      { itemId: 'ice_crystal', quantity: 5 },\n      { itemId: 'iron_bar', quantity: 2 },\n      { itemId: 'coal', quantity: 3 },\n    ],\n    output: { itemId: 'frost_alloy', quantity: 1 },\n    craftTime: 90,\n    skillRequired: 'mining',\n    levelRequired: 6,\n    xpReward: 55,\n    discoverable: true,\n  },\n  {\n    id: 'refined_quartz',\n    name: 'Refined Quartz',\n    category: 'smithing',\n    station: 'furnace',\n    ingredients: [\n      { itemId: 'stone', quantity: 10 },\n      { itemId: 'coal', quantity: 2 },\n    ],\n    output: { itemId: 'refined_quartz', quantity: 1 },\n    craftTime: 45,\n    skillRequired: 'mining',\n    levelRequired: 2,\n    xpReward: 15,\n    discoverable: true,\n  },\n  {\n    id: 'golem_core_shard',\n    name: 'Golem Core Fragment',\n    category: 'smithing',\n    station: 'furnace',\n    ingredients: [\n      { itemId: 'golem_heart', quantity: 1 },\n      { itemId: 'gold_bar', quantity: 2 },\n      { itemId: 'coal', quantity: 4 },\n    ],\n    output: { itemId: 'golem_core_shard', quantity: 3 },\n    craftTime: 120,\n    skillRequired: 'mining',\n    levelRequired: 8,\n    xpReward: 75,\n    discoverable: true,\n  },\n\n  // ===========================================\n  // Weapons & Ammunition\n  // ===========================================\n  {\n    id: 'iron_sword',\n    name: 'Iron Blade',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'iron_bar', quantity: 5 },\n      { itemId: 'wood', quantity: 10 },\n      { itemId: 'leather', quantity: 2 },\n    ],\n    output: { itemId: 'iron_sword', quantity: 1 },\n    craftTime: 10,\n    skillRequired: 'combat',\n    levelRequired: 2,\n    xpReward: 30,\n    discoverable: true,\n  },\n  {\n    id: 'gold_sword',\n    name: 'Gilded Longsword',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'gold_bar', quantity: 5 },\n      { itemId: 'iron_bar', quantity: 2 },\n      { itemId: 'leather', quantity: 3 },\n    ],\n    output: { itemId: 'gold_sword', quantity: 1 },\n    craftTime: 10,\n    skillRequired: 'combat',\n    levelRequired: 5,\n    xpReward: 60,\n    discoverable: true,\n  },\n  {\n    id: 'bone_club',\n    name: 'Bone Club',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'bone', quantity: 10 },\n      { itemId: 'slime_gel', quantity: 3 },\n      { itemId: 'fiber', quantity: 5 },\n    ],\n    output: { itemId: 'bone_club', quantity: 1 },\n    craftTime: 5,\n    skillRequired: 'combat',\n    levelRequired: 1,\n    xpReward: 20,\n    discoverable: true,\n  },\n  {\n    id: 'void_dagger',\n    name: 'Void Dagger',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'void_heart', quantity: 1 },\n      { itemId: 'iron_bar', quantity: 3 },\n      { itemId: 'bone', quantity: 5 },\n      { itemId: 'ectoplasm', quantity: 3 },\n    ],\n    output: { itemId: 'void_dagger', quantity: 1 },\n    craftTime: 10,\n    skillRequired: 'combat',\n    levelRequired: 8,\n    xpReward: 100,\n    discoverable: true,\n  },\n  {\n    id: 'frost_spear',\n    name: 'Frost Spear',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'frost_scale', quantity: 2 },\n      { itemId: 'ice_crystal', quantity: 5 },\n      { itemId: 'iron_bar', quantity: 3 },\n      { itemId: 'wood', quantity: 15 },\n    ],\n    output: { itemId: 'frost_spear', quantity: 1 },\n    craftTime: 10,\n    skillRequired: 'combat',\n    levelRequired: 6,\n    xpReward: 80,\n    discoverable: true,\n  },\n  {\n    id: 'iron_arrows',\n    name: 'Iron Arrows',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'iron_bar', quantity: 1 },\n      { itemId: 'wood', quantity: 5 },\n      { itemId: 'feather', quantity: 3 },\n    ],\n    output: { itemId: 'iron_arrows', quantity: 15 },\n    craftTime: 5,\n    skillRequired: 'combat',\n    levelRequired: 1,\n    xpReward: 10,\n    discoverable: false,\n  },\n  {\n    id: 'fire_arrows',\n    name: 'Fire Arrows',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'arrow', quantity: 10 },\n      { itemId: 'coal', quantity: 3 },\n      { itemId: 'sap', quantity: 2 },\n    ],\n    output: { itemId: 'fire_arrows', quantity: 10 },\n    craftTime: 5,\n    skillRequired: 'combat',\n    levelRequired: 3,\n    xpReward: 20,\n    discoverable: true,\n  },\n\n  // ===========================================\n  // Armor & Protection\n  // ===========================================\n  {\n    id: 'leather_armor',\n    name: 'Leather Armor',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'leather', quantity: 8 },\n      { itemId: 'fiber', quantity: 10 },\n      { itemId: 'copper_bar', quantity: 2 },\n    ],\n    output: { itemId: 'leather_armor', quantity: 1 },\n    craftTime: 10,\n    skillRequired: 'combat',\n    levelRequired: 1,\n    xpReward: 25,\n    discoverable: false,\n  },\n  {\n    id: 'iron_armor',\n    name: 'Iron Chainmail',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'iron_bar', quantity: 10 },\n      { itemId: 'leather', quantity: 5 },\n      { itemId: 'copper_bar', quantity: 3 },\n    ],\n    output: { itemId: 'iron_armor', quantity: 1 },\n    craftTime: 10,\n    skillRequired: 'combat',\n    levelRequired: 4,\n    xpReward: 50,\n    discoverable: true,\n  },\n  {\n    id: 'bone_shield',\n    name: 'Bone Shield',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'bone', quantity: 15 },\n      { itemId: 'leather', quantity: 4 },\n      { itemId: 'iron_bar', quantity: 2 },\n    ],\n    output: { itemId: 'bone_shield', quantity: 1 },\n    craftTime: 10,\n    skillRequired: 'combat',\n    levelRequired: 3,\n    xpReward: 35,\n    discoverable: true,\n  },\n  {\n    id: 'wyrm_plate',\n    name: 'Wyrmscale Plate',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'frost_scale', quantity: 5 },\n      { itemId: 'wyrm_fang', quantity: 2 },\n      { itemId: 'gold_bar', quantity: 5 },\n      { itemId: 'leather', quantity: 6 },\n    ],\n    output: { itemId: 'wyrm_plate', quantity: 1 },\n    craftTime: 10,\n    skillRequired: 'combat',\n    levelRequired: 9,\n    xpReward: 120,\n    discoverable: true,\n  },\n\n  // ===========================================\n  // Utility & Traps\n  // ===========================================\n  {\n    id: 'lantern',\n    name: 'Iron Lantern',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'iron_bar', quantity: 2 },\n      { itemId: 'coal', quantity: 3 },\n      { itemId: 'fiber', quantity: 2 },\n    ],\n    output: { itemId: 'lantern', quantity: 1 },\n    craftTime: 5,\n    xpReward: 15,\n    discoverable: false,\n  },\n  {\n    id: 'glow_lantern',\n    name: 'Spectral Lantern',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'ectoplasm', quantity: 5 },\n      { itemId: 'gold_bar', quantity: 1 },\n      { itemId: 'spirit_shard', quantity: 2 },\n    ],\n    output: { itemId: 'glow_lantern', quantity: 1 },\n    craftTime: 10,\n    skillRequired: 'foraging',\n    levelRequired: 5,\n    xpReward: 40,\n    discoverable: true,\n  },\n  {\n    id: 'spike_trap',\n    name: 'Spike Trap',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'iron_bar', quantity: 3 },\n      { itemId: 'wood', quantity: 10 },\n      { itemId: 'stone', quantity: 5 },\n    ],\n    output: { itemId: 'spike_trap', quantity: 2 },\n    craftTime: 5,\n    skillRequired: 'combat',\n    levelRequired: 2,\n    xpReward: 20,\n    discoverable: true,\n  },\n  {\n    id: 'snare_trap',\n    name: 'Snare Trap',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'fiber', quantity: 15 },\n      { itemId: 'wood', quantity: 5 },\n      { itemId: 'copper_bar', quantity: 1 },\n    ],\n    output: { itemId: 'snare_trap', quantity: 3 },\n    craftTime: 3,\n    xpReward: 10,\n    discoverable: false,\n  },\n  {\n    id: 'bomb',\n    name: 'Bomb',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'coal', quantity: 4 },\n      { itemId: 'copper_ore', quantity: 4 },\n    ],\n    output: { itemId: 'bomb', quantity: 1 },\n    craftTime: 5,\n    xpReward: 15,\n    discoverable: false,\n  },\n  {\n    id: 'mega_bomb',\n    name: 'Volatile Charge',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'iron_ore', quantity: 8 },\n      { itemId: 'coal', quantity: 6 },\n      { itemId: 'slime_gel', quantity: 3 },\n    ],\n    output: { itemId: 'mega_bomb', quantity: 1 },\n    craftTime: 5,\n    skillRequired: 'mining',\n    levelRequired: 4,\n    xpReward: 30,\n    discoverable: true,\n  },\n  {\n    id: 'rope',\n    name: 'Braided Rope',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'fiber', quantity: 10 },\n      { itemId: 'wool', quantity: 1 },\n    ],\n    output: { itemId: 'rope', quantity: 3 },\n    craftTime: 3,\n    xpReward: 8,\n    discoverable: false,\n  },\n  {\n    id: 'tusk_trophy',\n    name: 'Tusk Trophy',\n    category: 'crafting',\n    station: 'none',\n    ingredients: [\n      { itemId: 'tusk', quantity: 3 },\n      { itemId: 'wood', quantity: 20 },\n      { itemId: 'gold_bar', quantity: 1 },\n    ],\n    output: { itemId: 'tusk_trophy', quantity: 1 },\n    craftTime: 5,\n    xpReward: 25,\n    discoverable: true,\n  },\n\n  // ===========================================\n  // Alchemy - Potions, Elixirs, Resistance\n  // ===========================================\n  {\n    id: 'health_potion',\n    name: 'Health Potion',\n    category: 'alchemy',\n    station: 'alchemy_table',\n    ingredients: [\n      { itemId: 'red_mushroom', quantity: 3 },\n      { itemId: 'honey', quantity: 1 },\n    ],\n    output: { itemId: 'health_potion', quantity: 1 },\n    craftTime: 5,\n    xpReward: 20,\n    discoverable: false,\n  },\n  {\n    id: 'stamina_potion',\n    name: 'Stamina Potion',\n    category: 'alchemy',\n    station: 'alchemy_table',\n    ingredients: [\n      { itemId: 'green_mushroom', quantity: 3 },\n      { itemId: 'honey', quantity: 1 },\n    ],\n    output: { itemId: 'stamina_potion', quantity: 1 },\n    craftTime: 5,\n    xpReward: 20,\n    discoverable: false,\n  },\n  {\n    id: 'greater_health_potion',\n    name: 'Greater Health Potion',\n    category: 'alchemy',\n    station: 'alchemy_table',\n    ingredients: [\n      { itemId: 'red_mushroom', quantity: 5 },\n      { itemId: 'honey', quantity: 2 },\n      { itemId: 'magic_herb', quantity: 1 },\n    ],\n    output: { itemId: 'greater_health_potion', quantity: 1 },\n    craftTime: 10,\n    skillRequired: 'foraging',\n    levelRequired: 4,\n    xpReward: 40,\n    discoverable: true,\n  },\n  {\n    id: 'greater_stamina_potion',\n    name: 'Greater Stamina Potion',\n    category: 'alchemy',\n    station: 'alchemy_table',\n    ingredients: [\n      { itemId: 'green_mushroom', quantity: 5 },\n      { itemId: 'honey', quantity: 2 },\n      { itemId: 'magic_herb', quantity: 1 },\n    ],\n    output: { itemId: 'greater_stamina_potion', quantity: 1 },\n    craftTime: 10,\n    skillRequired: 'foraging',\n    levelRequired: 4,\n    xpReward: 40,\n    discoverable: true,\n  },\n  {\n    id: 'frost_resistance_potion',\n    name: 'Frost Resistance Draught',\n    category: 'alchemy',\n    station: 'alchemy_table',\n    ingredients: [\n      { itemId: 'ice_crystal', quantity: 3 },\n      { itemId: 'hot_pepper', quantity: 2 },\n      { itemId: 'honey', quantity: 1 },\n    ],\n    output: { itemId: 'frost_resistance_potion', quantity: 1 },\n    craftTime: 10,\n    skillRequired: 'foraging',\n    levelRequired: 3,\n    xpReward: 35,\n    discoverable: true,\n  },\n  {\n    id: 'venom_antidote',\n    name: 'Venom Antidote',\n    category: 'alchemy',\n    station: 'alchemy_table',\n    ingredients: [\n      { itemId: 'green_mushroom', quantity: 2 },\n      { itemId: 'fang', quantity: 2 },\n      { itemId: 'honey', quantity: 1 },\n    ],\n    output: { itemId: 'venom_antidote', quantity: 1 },\n    craftTime: 10,\n    skillRequired: 'foraging',\n    levelRequired: 3,\n    xpReward: 30,\n    discoverable: true,\n  },\n  {\n    id: 'berserker_elixir',\n    name: 'Berserker Elixir',\n    category: 'alchemy',\n    station: 'alchemy_table',\n    ingredients: [\n      { itemId: 'red_mushroom', quantity: 3 },\n      { itemId: 'bat_wing', quantity: 3 },\n      { itemId: 'hot_pepper', quantity: 2 },\n    ],\n    output: { itemId: 'berserker_elixir', quantity: 1 },\n    craftTime: 10,\n    skillRequired: 'foraging',\n    levelRequired: 5,\n    xpReward: 45,\n    discoverable: true,\n  },\n  {\n    id: 'ironhide_tonic',\n    name: 'Ironhide Tonic',\n    category: 'alchemy',\n    station: 'alchemy_table',\n    ingredients: [\n      { itemId: 'iron_bar', quantity: 1 },\n      { itemId: 'mushroom', quantity: 3 },\n      { itemId: 'slime_gel', quantity: 2 },\n      { itemId: 'honey', quantity: 1 },\n    ],\n    output: { itemId: 'ironhide_tonic', quantity: 1 },\n    craftTime: 10,\n    skillRequired: 'foraging',\n    levelRequired: 4,\n    xpReward: 40,\n    discoverable: true,\n  },\n  {\n    id: 'nightsight_potion',\n    name: 'Nightsight Potion',\n    category: 'alchemy',\n    station: 'alchemy_table',\n    ingredients: [\n      { itemId: 'bat_wing', quantity: 4 },\n      { itemId: 'ectoplasm', quantity: 2 },\n      { itemId: 'magic_herb', quantity: 1 },\n    ],\n    output: { itemId: 'nightsight_potion', quantity: 1 },\n    craftTime: 10,\n    skillRequired: 'foraging',\n    levelRequired: 3,\n    xpReward: 35,\n    discoverable: true,\n  },\n  {\n    id: 'swiftness_potion',\n    name: 'Swiftness Potion',\n    category: 'alchemy',\n    station: 'alchemy_table',\n    ingredients: [\n      { itemId: 'spore', quantity: 3 },\n      { itemId: 'green_mushroom', quantity: 2 },\n      { itemId: 'sugar', quantity: 2 },\n    ],\n    output: { itemId: 'swiftness_potion', quantity: 1 },\n    craftTime: 10,\n    skillRequired: 'foraging',\n    levelRequired: 2,\n    xpReward: 30,\n    discoverable: true,\n  },\n  {\n    id: 'spirit_ward',\n    name: 'Spirit Ward',\n    category: 'alchemy',\n    station: 'alchemy_table',\n    ingredients: [\n      { itemId: 'spirit_shard', quantity: 3 },\n      { itemId: 'ectoplasm', quantity: 3 },\n      { itemId: 'magic_herb', quantity: 2 },\n    ],\n    output: { itemId: 'spirit_ward', quantity: 1 },\n    craftTime: 10,\n    skillRequired: 'foraging',\n    levelRequired: 6,\n    xpReward: 50,\n    discoverable: true,\n  },\n  {\n    id: 'prismatic_elixir',\n    name: 'Prismatic Elixir',\n    category: 'alchemy',\n    station: 'alchemy_table',\n    ingredients: [\n      { itemId: 'prismatic_shard', quantity: 1 },\n      { itemId: 'royal_jelly', quantity: 1 },\n      { itemId: 'magic_herb', quantity: 3 },\n      { itemId: 'honey', quantity: 2 },\n    ],\n    output: { itemId: 'prismatic_elixir', quantity: 1 },\n    craftTime: 10,\n    skillRequired: 'foraging',\n    levelRequired: 9,\n    xpReward: 100,\n    discoverable: true,\n  },\n  {\n    id: 'galaxy_tincture',\n    name: 'Galaxy Tincture',\n    category: 'alchemy',\n    station: 'alchemy_table',\n    ingredients: [\n      { itemId: 'galaxy_soul', quantity: 1 },\n      { itemId: 'void_heart', quantity: 1 },\n      { itemId: 'magic_herb', quantity: 5 },\n    ],\n    output: { itemId: 'galaxy_tincture', quantity: 1 },\n    craftTime: 10,\n    skillRequired: 'foraging',\n    levelRequired: 10,\n    xpReward: 150,\n    discoverable: true,\n  },\n];\n\n// ---------------------------------------------------------------------------\n// COOKING RECIPES  (merged from Crafting.recipes cooking entries + Cooking.recipes)\n// ---------------------------------------------------------------------------\n\nexport const COOKING_RECIPES: RecipeDef[] = [\n  // ===========================================\n  // Simple Egg & Vegetable Dishes\n  // ===========================================\n  {\n    id: 'fried_egg',\n    name: 'Fried Egg',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'egg', quantity: 1 },\n    ],\n    output: { itemId: 'fried_egg', quantity: 1 },\n    craftTime: 3,\n    xpReward: 5,\n    discoverable: false,\n  },\n  {\n    id: 'vegetable_soup',\n    name: 'Vegetable Soup',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'potato', quantity: 1 },\n      { itemId: 'carrot', quantity: 1 },\n      { itemId: 'parsnip', quantity: 1 },\n    ],\n    output: { itemId: 'vegetable_soup', quantity: 1 },\n    craftTime: 5,\n    xpReward: 15,\n    discoverable: false,\n  },\n  {\n    id: 'grilled_corn',\n    name: 'Grilled Corn',\n    category: 'cooking',\n    station: 'campfire',\n    ingredients: [\n      { itemId: 'corn', quantity: 1 },\n    ],\n    output: { itemId: 'grilled_corn', quantity: 1 },\n    craftTime: 3,\n    xpReward: 5,\n    discoverable: false,\n  },\n  {\n    id: 'tomato_sauce',\n    name: 'Tomato Sauce',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'tomato', quantity: 3 },\n    ],\n    output: { itemId: 'tomato_sauce', quantity: 1 },\n    craftTime: 4,\n    xpReward: 10,\n    discoverable: false,\n  },\n  {\n    id: 'baked_potato',\n    name: 'Loaded Baked Potato',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'potato', quantity: 1 },\n      { itemId: 'milk', quantity: 1 },\n    ],\n    output: { itemId: 'baked_potato', quantity: 1 },\n    craftTime: 4,\n    xpReward: 5,\n    discoverable: false,\n  },\n  {\n    id: 'roasted_cauliflower',\n    name: 'Roasted Cauliflower',\n    category: 'cooking',\n    station: 'campfire',\n    ingredients: [\n      { itemId: 'cauliflower', quantity: 2 },\n      { itemId: 'honey', quantity: 1 },\n    ],\n    output: { itemId: 'roasted_cauliflower', quantity: 1 },\n    craftTime: 4,\n    xpReward: 5,\n    discoverable: false,\n  },\n\n  // ===========================================\n  // Fish Dishes\n  // ===========================================\n  {\n    id: 'fish_dinner',\n    name: 'Fish Dinner',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'fish', quantity: 1 },\n      { itemId: 'potato', quantity: 1 },\n    ],\n    output: { itemId: 'fish_dinner', quantity: 1 },\n    craftTime: 5,\n    xpReward: 20,\n    discoverable: false,\n  },\n  {\n    id: 'fish_stew',\n    name: 'Fish Stew',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'fish', quantity: 2 },\n      { itemId: 'potato', quantity: 1 },\n    ],\n    output: { itemId: 'fish_stew', quantity: 1 },\n    craftTime: 6,\n    xpReward: 15,\n    discoverable: false,\n  },\n  {\n    id: 'grilled_fish',\n    name: 'Grilled Fish',\n    category: 'cooking',\n    station: 'campfire',\n    ingredients: [\n      { itemId: 'fish', quantity: 1 },\n    ],\n    output: { itemId: 'grilled_fish', quantity: 1 },\n    craftTime: 3,\n    xpReward: 5,\n    discoverable: false,\n  },\n  {\n    id: 'grilled_salmon',\n    name: 'Grilled Salmon',\n    category: 'cooking',\n    station: 'campfire',\n    ingredients: [\n      { itemId: 'salmon', quantity: 1 },\n      { itemId: 'hot_pepper', quantity: 1 },\n    ],\n    output: { itemId: 'grilled_salmon', quantity: 1 },\n    craftTime: 5,\n    xpReward: 10,\n    discoverable: false,\n  },\n  {\n    id: 'spicy_eel',\n    name: 'Spicy Eel',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'eel', quantity: 1 },\n      { itemId: 'hot_pepper', quantity: 1 },\n    ],\n    output: { itemId: 'spicy_eel', quantity: 1 },\n    craftTime: 6,\n    xpReward: 20,\n    discoverable: true,\n  },\n  {\n    id: 'charred_octopus',\n    name: 'Charred Octopus',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'octopus', quantity: 1 },\n      { itemId: 'hot_pepper', quantity: 1 },\n      { itemId: 'tomato', quantity: 1 },\n    ],\n    output: { itemId: 'charred_octopus', quantity: 1 },\n    craftTime: 7,\n    xpReward: 20,\n    discoverable: true,\n  },\n  {\n    id: 'fishermans_breakfast',\n    name: \"Fisherman's Breakfast\",\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'fish', quantity: 1 },\n      { itemId: 'egg', quantity: 2 },\n      { itemId: 'potato', quantity: 1 },\n    ],\n    output: { itemId: 'fishermans_breakfast', quantity: 1 },\n    craftTime: 5,\n    xpReward: 10,\n    discoverable: false,\n  },\n  {\n    id: 'seafood_chowder',\n    name: 'Seafood Chowder',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'salmon', quantity: 1 },\n      { itemId: 'potato', quantity: 1 },\n      { itemId: 'milk', quantity: 1 },\n    ],\n    output: { itemId: 'seafood_chowder', quantity: 1 },\n    craftTime: 8,\n    xpReward: 15,\n    discoverable: true,\n  },\n  {\n    id: 'bass_fillet',\n    name: 'Seared Bass Fillet',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'bass', quantity: 1 },\n      { itemId: 'tomato', quantity: 1 },\n    ],\n    output: { itemId: 'bass_fillet', quantity: 1 },\n    craftTime: 4,\n    xpReward: 10,\n    discoverable: false,\n  },\n  {\n    id: 'catfish_wrap',\n    name: 'Catfish Wrap',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'catfish', quantity: 1 },\n      { itemId: 'tortilla', quantity: 1 },\n      { itemId: 'hot_pepper', quantity: 1 },\n    ],\n    output: { itemId: 'catfish_wrap', quantity: 1 },\n    craftTime: 4,\n    xpReward: 10,\n    discoverable: false,\n  },\n  {\n    id: 'sturgeon_feast',\n    name: 'Sturgeon Feast',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'sturgeon', quantity: 1 },\n      { itemId: 'potato', quantity: 2 },\n      { itemId: 'tomato', quantity: 1 },\n      { itemId: 'honey', quantity: 1 },\n    ],\n    output: { itemId: 'sturgeon_feast', quantity: 1 },\n    craftTime: 12,\n    xpReward: 50,\n    discoverable: true,\n  },\n  {\n    id: 'pufferfish_sake',\n    name: 'Pufferfish Sake',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'pufferfish', quantity: 1 },\n      { itemId: 'wheat', quantity: 3 },\n    ],\n    output: { itemId: 'pufferfish_sake', quantity: 1 },\n    craftTime: 8,\n    xpReward: 25,\n    discoverable: true,\n  },\n\n  // ===========================================\n  // Meat Dishes (Wild Animal Drops)\n  // ===========================================\n  {\n    id: 'cooked_meat',\n    name: 'Cooked Meat',\n    category: 'cooking',\n    station: 'campfire',\n    ingredients: [\n      { itemId: 'raw_meat', quantity: 1 },\n    ],\n    output: { itemId: 'cooked_meat', quantity: 1 },\n    craftTime: 3,\n    xpReward: 5,\n    discoverable: false,\n  },\n  {\n    id: 'roasted_venison',\n    name: 'Roasted Venison',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'venison', quantity: 1 },\n      { itemId: 'honey', quantity: 1 },\n    ],\n    output: { itemId: 'roasted_venison', quantity: 1 },\n    craftTime: 7,\n    xpReward: 15,\n    discoverable: false,\n  },\n  {\n    id: 'grilled_boar',\n    name: 'Grilled Wild Boar',\n    category: 'cooking',\n    station: 'campfire',\n    ingredients: [\n      { itemId: 'boar_meat', quantity: 1 },\n    ],\n    output: { itemId: 'grilled_boar', quantity: 1 },\n    craftTime: 5,\n    xpReward: 10,\n    discoverable: false,\n  },\n  {\n    id: 'rabbit_pie',\n    name: 'Rabbit Pie',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'rabbit_meat', quantity: 2 },\n      { itemId: 'potato', quantity: 1 },\n      { itemId: 'carrot', quantity: 1 },\n    ],\n    output: { itemId: 'rabbit_pie', quantity: 1 },\n    craftTime: 9,\n    xpReward: 20,\n    discoverable: true,\n  },\n  {\n    id: 'meat_stew',\n    name: 'Hearty Meat Stew',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'raw_meat', quantity: 2 },\n      { itemId: 'potato', quantity: 1 },\n      { itemId: 'carrot', quantity: 1 },\n    ],\n    output: { itemId: 'meat_stew', quantity: 1 },\n    craftTime: 8,\n    xpReward: 15,\n    discoverable: false,\n  },\n  {\n    id: 'hunters_platter',\n    name: \"Hunter's Platter\",\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'venison', quantity: 1 },\n      { itemId: 'boar_meat', quantity: 1 },\n      { itemId: 'rabbit_meat', quantity: 1 },\n    ],\n    output: { itemId: 'hunters_platter', quantity: 1 },\n    craftTime: 12,\n    xpReward: 50,\n    discoverable: true,\n  },\n  {\n    id: 'honey_glazed_ham',\n    name: 'Honey Glazed Ham',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'boar_meat', quantity: 2 },\n      { itemId: 'honey', quantity: 2 },\n    ],\n    output: { itemId: 'honey_glazed_ham', quantity: 1 },\n    craftTime: 10,\n    xpReward: 20,\n    discoverable: true,\n  },\n  {\n    id: 'peppered_venison',\n    name: 'Peppered Venison Steak',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'venison', quantity: 1 },\n      { itemId: 'hot_pepper', quantity: 2 },\n    ],\n    output: { itemId: 'peppered_venison', quantity: 1 },\n    craftTime: 6,\n    xpReward: 15,\n    discoverable: true,\n  },\n\n  // ===========================================\n  // Soups & Stews\n  // ===========================================\n  {\n    id: 'tomato_soup',\n    name: 'Tomato Soup',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'tomato', quantity: 3 },\n    ],\n    output: { itemId: 'tomato_soup', quantity: 1 },\n    craftTime: 4,\n    xpReward: 5,\n    discoverable: false,\n  },\n  {\n    id: 'corn_chowder',\n    name: 'Corn Chowder',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'corn', quantity: 2 },\n      { itemId: 'potato', quantity: 1 },\n      { itemId: 'milk', quantity: 1 },\n    ],\n    output: { itemId: 'corn_chowder', quantity: 1 },\n    craftTime: 6,\n    xpReward: 10,\n    discoverable: false,\n  },\n  {\n    id: 'mushroom_risotto',\n    name: 'Mushroom Risotto',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'mushroom', quantity: 3 },\n      { itemId: 'milk', quantity: 1 },\n    ],\n    output: { itemId: 'mushroom_risotto', quantity: 1 },\n    craftTime: 7,\n    xpReward: 15,\n    discoverable: true,\n  },\n  {\n    id: 'dark_mushroom_broth',\n    name: 'Dark Mushroom Broth',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'red_mushroom', quantity: 2 },\n      { itemId: 'green_mushroom', quantity: 2 },\n      { itemId: 'mushroom', quantity: 1 },\n    ],\n    output: { itemId: 'dark_mushroom_broth', quantity: 1 },\n    craftTime: 6,\n    xpReward: 15,\n    discoverable: true,\n  },\n  {\n    id: 'pumpkin_stew',\n    name: 'Pumpkin Stew',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'pumpkin', quantity: 1 },\n      { itemId: 'potato', quantity: 1 },\n      { itemId: 'milk', quantity: 1 },\n    ],\n    output: { itemId: 'pumpkin_stew', quantity: 1 },\n    craftTime: 7,\n    xpReward: 10,\n    discoverable: false,\n  },\n  {\n    id: 'bone_marrow_soup',\n    name: 'Bone Marrow Soup',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'bone', quantity: 3 },\n      { itemId: 'carrot', quantity: 1 },\n      { itemId: 'potato', quantity: 1 },\n    ],\n    output: { itemId: 'bone_marrow_soup', quantity: 1 },\n    craftTime: 9,\n    xpReward: 10,\n    discoverable: true,\n  },\n  {\n    id: 'hunters_stew',\n    name: \"Hunter's Stew\",\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'venison', quantity: 1 },\n      { itemId: 'mushroom', quantity: 2 },\n      { itemId: 'carrot', quantity: 1 },\n      { itemId: 'potato', quantity: 1 },\n    ],\n    output: { itemId: 'hunters_stew', quantity: 1 },\n    craftTime: 10,\n    xpReward: 20,\n    discoverable: true,\n  },\n\n  // ===========================================\n  // Fruit & Salads\n  // ===========================================\n  {\n    id: 'fruit_salad',\n    name: 'Fruit Salad',\n    category: 'cooking',\n    station: 'none',\n    ingredients: [\n      { itemId: 'apple', quantity: 2 },\n      { itemId: 'melon', quantity: 1 },\n    ],\n    output: { itemId: 'fruit_salad', quantity: 1 },\n    craftTime: 2,\n    xpReward: 5,\n    discoverable: false,\n  },\n\n  // ===========================================\n  // Baked Goods & Desserts\n  // ===========================================\n  {\n    id: 'pumpkin_pie',\n    name: 'Pumpkin Pie',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'pumpkin', quantity: 1 },\n      { itemId: 'wheat', quantity: 2 },\n      { itemId: 'egg', quantity: 1 },\n    ],\n    output: { itemId: 'pumpkin_pie', quantity: 1 },\n    craftTime: 8,\n    xpReward: 20,\n    discoverable: true,\n  },\n  {\n    id: 'honey_cake',\n    name: 'Honey Cake',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'honey', quantity: 2 },\n      { itemId: 'egg', quantity: 2 },\n      { itemId: 'wheat_flour', quantity: 1 },\n    ],\n    output: { itemId: 'honey_cake', quantity: 1 },\n    craftTime: 8,\n    xpReward: 15,\n    discoverable: true,\n  },\n  {\n    id: 'fruit_tart',\n    name: 'Fruit Tart',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'apple', quantity: 2 },\n      { itemId: 'wheat_flour', quantity: 1 },\n      { itemId: 'sugar', quantity: 1 },\n    ],\n    output: { itemId: 'fruit_tart', quantity: 1 },\n    craftTime: 6,\n    xpReward: 10,\n    discoverable: false,\n  },\n  {\n    id: 'dark_bread',\n    name: 'Dark Rye Bread',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'wheat_flour', quantity: 2 },\n      { itemId: 'honey', quantity: 1 },\n    ],\n    output: { itemId: 'dark_bread', quantity: 2 },\n    craftTime: 5,\n    xpReward: 10,\n    discoverable: false,\n  },\n  {\n    id: 'melon_sorbet',\n    name: 'Melon Sorbet',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'melon', quantity: 2 },\n      { itemId: 'sugar', quantity: 2 },\n    ],\n    output: { itemId: 'melon_sorbet', quantity: 1 },\n    craftTime: 4,\n    xpReward: 10,\n    discoverable: false,\n  },\n  {\n    id: 'goat_cheese_tart',\n    name: 'Goat Cheese Tart',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'goat_milk', quantity: 2 },\n      { itemId: 'wheat_flour', quantity: 1 },\n      { itemId: 'egg', quantity: 1 },\n    ],\n    output: { itemId: 'goat_cheese_tart', quantity: 1 },\n    craftTime: 7,\n    xpReward: 15,\n    discoverable: true,\n  },\n  {\n    id: 'truffle_pastry',\n    name: 'Truffle Pastry',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'truffle', quantity: 1 },\n      { itemId: 'wheat_flour', quantity: 1 },\n      { itemId: 'egg', quantity: 1 },\n      { itemId: 'sugar', quantity: 1 },\n    ],\n    output: { itemId: 'truffle_pastry', quantity: 1 },\n    craftTime: 8,\n    xpReward: 20,\n    discoverable: true,\n  },\n  {\n    id: 'stuffed_pumpkin',\n    name: 'Stuffed Pumpkin',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'pumpkin', quantity: 1 },\n      { itemId: 'raw_meat', quantity: 1 },\n      { itemId: 'corn', quantity: 1 },\n      { itemId: 'mushroom', quantity: 1 },\n    ],\n    output: { itemId: 'stuffed_pumpkin', quantity: 1 },\n    craftTime: 10,\n    xpReward: 20,\n    discoverable: true,\n  },\n  {\n    id: 'royal_jelly_cake',\n    name: 'Royal Jelly Cake',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'royal_jelly', quantity: 1 },\n      { itemId: 'wheat_flour', quantity: 2 },\n      { itemId: 'egg', quantity: 2 },\n      { itemId: 'sugar', quantity: 2 },\n    ],\n    output: { itemId: 'royal_jelly_cake', quantity: 1 },\n    craftTime: 12,\n    xpReward: 50,\n    discoverable: true,\n  },\n\n  // ===========================================\n  // Drinks\n  // ===========================================\n  {\n    id: 'ale',\n    name: 'Ale',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'wheat', quantity: 5 },\n      { itemId: 'hops', quantity: 2 },\n    ],\n    output: { itemId: 'ale', quantity: 2 },\n    craftTime: 5,\n    xpReward: 10,\n    discoverable: false,\n  },\n  {\n    id: 'wine',\n    name: 'Red Wine',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'grape', quantity: 5 },\n    ],\n    output: { itemId: 'wine', quantity: 1 },\n    craftTime: 6,\n    xpReward: 15,\n    discoverable: true,\n  },\n  {\n    id: 'mead',\n    name: 'Honey Mead',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'honey', quantity: 3 },\n    ],\n    output: { itemId: 'mead', quantity: 1 },\n    craftTime: 5,\n    xpReward: 10,\n    discoverable: false,\n  },\n  {\n    id: 'cider',\n    name: 'Apple Cider',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'apple', quantity: 3 },\n    ],\n    output: { itemId: 'cider', quantity: 1 },\n    craftTime: 4,\n    xpReward: 5,\n    discoverable: false,\n  },\n  {\n    id: 'herbal_tea',\n    name: 'Herbal Tea',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'magic_herb', quantity: 1 },\n    ],\n    output: { itemId: 'herbal_tea', quantity: 1 },\n    craftTime: 2,\n    xpReward: 5,\n    discoverable: false,\n  },\n  {\n    id: 'spiced_cider',\n    name: 'Spiced Cider',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'apple', quantity: 3 },\n      { itemId: 'hot_pepper', quantity: 1 },\n      { itemId: 'sugar', quantity: 1 },\n    ],\n    output: { itemId: 'spiced_cider', quantity: 1 },\n    craftTime: 5,\n    xpReward: 10,\n    discoverable: true,\n  },\n  {\n    id: 'midnight_brew',\n    name: 'Midnight Brew',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'magic_herb', quantity: 2 },\n      { itemId: 'mushroom', quantity: 2 },\n      { itemId: 'honey', quantity: 1 },\n    ],\n    output: { itemId: 'midnight_brew', quantity: 1 },\n    craftTime: 6,\n    xpReward: 15,\n    discoverable: true,\n  },\n\n  // ===========================================\n  // Special & Buff Meals\n  // ===========================================\n  {\n    id: 'farmers_lunch',\n    name: \"Farmer's Lunch\",\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'parsnip', quantity: 1 },\n      { itemId: 'potato', quantity: 1 },\n      { itemId: 'bread', quantity: 1 },\n    ],\n    output: { itemId: 'farmers_lunch', quantity: 1 },\n    craftTime: 5,\n    xpReward: 30,\n    discoverable: false,\n  },\n  {\n    id: 'miners_treat',\n    name: \"Miner's Treat\",\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'carrot', quantity: 2 },\n      { itemId: 'bread', quantity: 1 },\n    ],\n    output: { itemId: 'miners_treat', quantity: 1 },\n    craftTime: 5,\n    xpReward: 25,\n    discoverable: false,\n  },\n  {\n    id: 'lucky_lunch',\n    name: 'Lucky Lunch',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'sea_cucumber', quantity: 1 },\n      { itemId: 'tortilla', quantity: 1 },\n      { itemId: 'blue_jazz', quantity: 1 },\n    ],\n    output: { itemId: 'lucky_lunch', quantity: 1 },\n    craftTime: 10,\n    xpReward: 35,\n    discoverable: true,\n  },\n  {\n    id: 'farmers_feast',\n    name: \"Farmer's Feast\",\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'pumpkin', quantity: 1 },\n      { itemId: 'corn', quantity: 2 },\n      { itemId: 'potato', quantity: 2 },\n      { itemId: 'cauliflower', quantity: 1 },\n    ],\n    output: { itemId: 'farmers_feast', quantity: 1 },\n    craftTime: 12,\n    xpReward: 50,\n    discoverable: true,\n  },\n  {\n    id: 'adventurers_meal',\n    name: \"Adventurer's Meal\",\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'raw_meat', quantity: 2 },\n      { itemId: 'potato', quantity: 2 },\n      { itemId: 'carrot', quantity: 1 },\n      { itemId: 'bread', quantity: 1 },\n    ],\n    output: { itemId: 'adventurers_meal', quantity: 1 },\n    craftTime: 10,\n    xpReward: 20,\n    discoverable: true,\n  },\n  {\n    id: 'miners_special',\n    name: \"Miner's Special\",\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'raw_meat', quantity: 1 },\n      { itemId: 'potato', quantity: 2 },\n      { itemId: 'mushroom', quantity: 2 },\n    ],\n    output: { itemId: 'miners_special', quantity: 1 },\n    craftTime: 8,\n    xpReward: 15,\n    discoverable: true,\n  },\n  {\n    id: 'war_rations',\n    name: 'War Rations',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'raw_meat', quantity: 2 },\n      { itemId: 'bread', quantity: 2 },\n      { itemId: 'carrot', quantity: 2 },\n    ],\n    output: { itemId: 'war_rations', quantity: 2 },\n    craftTime: 7,\n    xpReward: 15,\n    discoverable: true,\n  },\n  {\n    id: 'slime_jelly_toast',\n    name: 'Slime Jelly Toast',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'slime_gel', quantity: 3 },\n      { itemId: 'sugar', quantity: 1 },\n      { itemId: 'bread', quantity: 1 },\n    ],\n    output: { itemId: 'slime_jelly_toast', quantity: 1 },\n    craftTime: 3,\n    xpReward: 10,\n    discoverable: true,\n  },\n\n  // ===========================================\n  // Seasonal & Special\n  // ===========================================\n  {\n    id: 'harvest_casserole',\n    name: 'Harvest Casserole',\n    category: 'cooking',\n    station: 'kitchen',\n    ingredients: [\n      { itemId: 'pumpkin', quantity: 1 },\n      { itemId: 'corn', quantity: 1 },\n      { itemId: 'potato', quantity: 1 },\n      { itemId: 'parsnip', quantity: 1 },\n      { itemId: 'egg', quantity: 1 },\n    ],\n    output: { itemId: 'harvest_casserole', quantity: 1 },\n    craftTime: 11,\n    xpReward: 20,\n    discoverable: true,\n  },\n];\n\n// ---------------------------------------------------------------------------\n// Aggregate & Lookup\n// ---------------------------------------------------------------------------\n\nexport const ALL_RECIPES: RecipeDef[] = [...CRAFTING_RECIPES, ...COOKING_RECIPES];\n\nexport const RECIPE_DB = new Map<string, RecipeDef>();\nALL_RECIPES.forEach(r => RECIPE_DB.set(r.id, r));\n","import { ALL_RECIPES, RECIPE_DB, RecipeDef } from '../data/recipes';\nimport { InventoryManager } from './InventoryManager';\n\n// ---------------------------------------------------------------------------\n// Save Data Shape\n// ---------------------------------------------------------------------------\n\ninterface CraftQueueEntry {\n  recipeId: string;\n  timer: number;\n  totalTime: number;\n}\n\ninterface CraftingSaveData {\n  discoveredRecipes: string[];\n  craftQueue: CraftQueueEntry[];\n}\n\n// ---------------------------------------------------------------------------\n// Crafting Manager\n// ---------------------------------------------------------------------------\n\n/**\n * Manages station-based crafting with recipe discovery and a timed craft queue.\n *\n * Recipes are either auto-discovered (discoverable: false) or must be\n * explicitly unlocked via `discoverRecipe()`. Crafting consumes inventory\n * ingredients and, after `craftTime` seconds elapse via `update()`, deposits\n * the output back into the inventory.\n */\nexport class CraftingManager {\n  private discoveredRecipes: Set<string> = new Set();\n  private craftQueue: CraftQueueEntry[] = [];\n\n  // Callbacks\n  private craftCompleteCallbacks: Array<(recipeId: string, outputItemId: string, quantity: number) => void> = [];\n\n  // ---------------------------------------------------------------------------\n  // Initialisation\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Auto-discover all recipes that do not require manual discovery\n   * (discoverable === false). Call this once after construction / load.\n   */\n  init(): void {\n    for (const recipe of ALL_RECIPES) {\n      if (!recipe.discoverable) {\n        this.discoveredRecipes.add(recipe.id);\n      }\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Recipe Discovery\n  // ---------------------------------------------------------------------------\n\n  /** Mark a recipe as known. Returns true if newly discovered, false if already known. */\n  discoverRecipe(recipeId: string): boolean {\n    if (this.discoveredRecipes.has(recipeId)) return false;\n    const def = RECIPE_DB.get(recipeId);\n    if (!def) return false;\n    this.discoveredRecipes.add(recipeId);\n    return true;\n  }\n\n  /** Whether a recipe has been discovered / is known. */\n  isRecipeDiscovered(recipeId: string): boolean {\n    return this.discoveredRecipes.has(recipeId);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Craft Eligibility\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Check whether the player can craft a recipe right now.\n   *  - Recipe must be discovered.\n   *  - All ingredients must be present in inventory (multiplied by quantity).\n   *  - Station must match (recipe.station === 'none' always matches).\n   *  - Skill / level requirements are checked via optional callbacks; by\n   *    default they are ignored here (caller should gate UI).\n   */\n  canCraft(recipeId: string, inventory: InventoryManager, station?: string): boolean {\n    const def = RECIPE_DB.get(recipeId);\n    if (!def) return false;\n\n    // Must be discovered\n    if (!this.discoveredRecipes.has(recipeId)) return false;\n\n    // Station check — 'none' recipes can always be crafted\n    if (def.station !== 'none' && station !== undefined && def.station !== station) {\n      return false;\n    }\n\n    // Ingredient check\n    for (const ing of def.ingredients) {\n      if (!inventory.hasItem(ing.itemId, ing.quantity)) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Crafting\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Start crafting a recipe. Removes ingredients from the inventory and adds\n   * an entry to the craft queue. If craftTime is 0 the output is delivered\n   * instantly (bypassing the queue).\n   *\n   * @param quantity  How many times to craft (ingredients are multiplied).\n   * @returns true if crafting started, false if requirements not met.\n   */\n  craft(recipeId: string, inventory: InventoryManager, quantity: number = 1): boolean {\n    const def = RECIPE_DB.get(recipeId);\n    if (!def) return false;\n\n    // Verify we can craft the full batch\n    for (const ing of def.ingredients) {\n      if (!inventory.hasItem(ing.itemId, ing.quantity * quantity)) {\n        return false;\n      }\n    }\n\n    // Must be discovered\n    if (!this.discoveredRecipes.has(recipeId)) return false;\n\n    // Consume ingredients\n    for (const ing of def.ingredients) {\n      inventory.removeItem(ing.itemId, ing.quantity * quantity);\n    }\n\n    // Instant craft when craftTime is 0\n    if (def.craftTime <= 0) {\n      inventory.addItem(def.output.itemId, def.output.quantity * quantity);\n      for (const cb of this.craftCompleteCallbacks) {\n        cb(recipeId, def.output.itemId, def.output.quantity * quantity);\n      }\n      return true;\n    }\n\n    // Queue one entry per unit (each has its own timer)\n    for (let i = 0; i < quantity; i++) {\n      this.craftQueue.push({\n        recipeId,\n        timer: 0,\n        totalTime: def.craftTime,\n      });\n    }\n\n    return true;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Update Loop\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Tick the craft queue. Call every frame with delta in **seconds**.\n   * When a craft finishes, the output is deposited into the provided inventory\n   * and the `onCraftComplete` callback fires.\n   */\n  update(delta: number, inventory: InventoryManager): void {\n    if (this.craftQueue.length === 0) return;\n\n    // Only the front entry ticks (FIFO queue)\n    const entry = this.craftQueue[0];\n    entry.timer += delta;\n\n    if (entry.timer >= entry.totalTime) {\n      const def = RECIPE_DB.get(entry.recipeId);\n      if (def) {\n        inventory.addItem(def.output.itemId, def.output.quantity);\n        for (const cb of this.craftCompleteCallbacks) {\n          cb(entry.recipeId, def.output.itemId, def.output.quantity);\n        }\n      }\n      this.craftQueue.shift();\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Queries\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Return all discovered recipes that can be crafted right now given the\n   * current inventory and (optionally) the station the player is at.\n   */\n  getAvailableRecipes(inventory: InventoryManager, station?: string): RecipeDef[] {\n    const result: RecipeDef[] = [];\n    for (const id of this.discoveredRecipes) {\n      if (this.canCraft(id, inventory, station)) {\n        const def = RECIPE_DB.get(id);\n        if (def) result.push(def);\n      }\n    }\n    return result;\n  }\n\n  /** Return all recipes the player has discovered, regardless of craftability. */\n  getDiscoveredRecipes(): RecipeDef[] {\n    const result: RecipeDef[] = [];\n    for (const id of this.discoveredRecipes) {\n      const def = RECIPE_DB.get(id);\n      if (def) result.push(def);\n    }\n    return result;\n  }\n\n  /** Whether there is an active craft in progress. */\n  isCrafting(): boolean {\n    return this.craftQueue.length > 0;\n  }\n\n  /** Get the progress of the current (front-of-queue) craft, 0-1, or null. */\n  getCraftProgress(): { recipeId: string; progress: number } | null {\n    if (this.craftQueue.length === 0) return null;\n    const entry = this.craftQueue[0];\n    return {\n      recipeId: entry.recipeId,\n      progress: entry.totalTime > 0 ? Math.min(entry.timer / entry.totalTime, 1) : 1,\n    };\n  }\n\n  /** Get the number of items remaining in the craft queue (including current). */\n  getQueueLength(): number {\n    return this.craftQueue.length;\n  }\n\n  /** Cancel the current craft (front of queue). Ingredients are NOT refunded. */\n  cancelCraft(): void {\n    if (this.craftQueue.length > 0) {\n      this.craftQueue.shift();\n    }\n  }\n\n  /** Cancel the entire craft queue. Ingredients are NOT refunded. */\n  cancelAll(): void {\n    this.craftQueue.length = 0;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Callbacks\n  // ---------------------------------------------------------------------------\n\n  /** Register a callback fired when a craft finishes. */\n  onCraftComplete(cb: (recipeId: string, outputItemId: string, quantity: number) => void): void {\n    this.craftCompleteCallbacks.push(cb);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Persistence\n  // ---------------------------------------------------------------------------\n\n  /** Serialize for save. */\n  serialize(): CraftingSaveData {\n    return {\n      discoveredRecipes: [...this.discoveredRecipes],\n      craftQueue: this.craftQueue.map(e => ({ ...e })),\n    };\n  }\n\n  /** Deserialize from save. */\n  deserialize(data: CraftingSaveData): void {\n    this.discoveredRecipes.clear();\n    this.craftQueue.length = 0;\n\n    if (data.discoveredRecipes) {\n      for (const id of data.discoveredRecipes) {\n        this.discoveredRecipes.add(id);\n      }\n    }\n\n    if (data.craftQueue) {\n      for (const entry of data.craftQueue) {\n        this.craftQueue.push({ ...entry });\n      }\n    }\n  }\n}\n","import { ITEM_DB } from '../data/items';\nimport { SeedDef } from '../types/items';\n\nexport interface FarmPlot {\n  x: number;\n  y: number;\n  state: 'empty' | 'tilled' | 'planted' | 'watered' | 'growing' | 'ready';\n  seedId: string | null;\n  cropId: string | null;\n  growthProgress: number;\n  growthDays: number;\n  quality: number;\n  wateredToday: boolean;\n  daysWithoutWater: number;\n  hasScarecrow: boolean;\n}\n\n/**\n * Manages tile-based farming: tilling, planting, watering, growth, and harvesting.\n */\nexport class FarmingManager {\n  private plots: Map<string, FarmPlot> = new Map();\n  private onHarvestCbs: ((cropId: string, quality: number, x: number, y: number) => void)[] = [];\n\n  private key(x: number, y: number): string {\n    return `${x},${y}`;\n  }\n\n  /** Till soil at a position */\n  tillSoil(x: number, y: number): boolean {\n    const k = this.key(x, y);\n    if (this.plots.has(k)) return false;\n\n    this.plots.set(k, {\n      x, y,\n      state: 'tilled',\n      seedId: null,\n      cropId: null,\n      growthProgress: 0,\n      growthDays: 0,\n      quality: 0,\n      wateredToday: false,\n      daysWithoutWater: 0,\n      hasScarecrow: false,\n    });\n    return true;\n  }\n\n  /** Plant a seed on a tilled plot */\n  plantSeed(x: number, y: number, seedId: string, currentSeason: string): boolean {\n    const k = this.key(x, y);\n    const plot = this.plots.get(k);\n    if (!plot || plot.state !== 'tilled') return false;\n\n    const seedDef = ITEM_DB.get(seedId);\n    if (!seedDef || seedDef.category !== 'seed') return false;\n    const seed = seedDef as SeedDef;\n\n    // Check season\n    if (!seed.seasons.includes(currentSeason.toLowerCase())) return false;\n\n    plot.state = 'planted';\n    plot.seedId = seedId;\n    plot.cropId = seed.cropId;\n    plot.growthProgress = 0;\n    plot.growthDays = seed.growthDays;\n    plot.quality = 0;\n    return true;\n  }\n\n  /** Water a plot */\n  waterPlot(x: number, y: number): boolean {\n    const k = this.key(x, y);\n    const plot = this.plots.get(k);\n    if (!plot) return false;\n    if (plot.state === 'empty' || plot.state === 'ready') return false;\n\n    plot.wateredToday = true;\n    if (plot.state === 'planted') {\n      plot.state = 'growing';\n    }\n    return true;\n  }\n\n  /** Advance all plots by one day. Called on new day. */\n  advanceDay(currentSeason: string): void {\n    for (const plot of this.plots.values()) {\n      if (plot.state === 'tilled' || plot.state === 'empty' || plot.state === 'ready') {\n        plot.wateredToday = false;\n        continue;\n      }\n\n      // Check season validity\n      if (plot.seedId) {\n        const seedDef = ITEM_DB.get(plot.seedId) as SeedDef | undefined;\n        if (seedDef && !seedDef.seasons.includes(currentSeason.toLowerCase())) {\n          plot.state = 'tilled';\n          plot.seedId = null;\n          plot.cropId = null;\n          plot.growthProgress = 0;\n          plot.wateredToday = false;\n          continue;\n        }\n      }\n\n      if (plot.wateredToday) {\n        plot.growthProgress++;\n        plot.daysWithoutWater = 0;\n\n        // Random quality upgrade (5% chance)\n        if (plot.quality < 3 && Math.random() < 0.05) {\n          plot.quality++;\n        }\n\n        if (plot.growthProgress >= plot.growthDays) {\n          plot.state = 'ready';\n        }\n      } else {\n        plot.daysWithoutWater++;\n        if (plot.daysWithoutWater > 3) {\n          plot.state = 'tilled';\n          plot.seedId = null;\n          plot.cropId = null;\n          plot.growthProgress = 0;\n          plot.daysWithoutWater = 0;\n        }\n      }\n\n      plot.wateredToday = false;\n    }\n  }\n\n  /** Harvest a ready crop */\n  harvest(x: number, y: number): { itemId: string; quantity: number; quality: number } | null {\n    const k = this.key(x, y);\n    const plot = this.plots.get(k);\n    if (!plot || plot.state !== 'ready' || !plot.cropId) return null;\n\n    const result = {\n      itemId: plot.cropId,\n      quantity: 1,\n      quality: plot.quality,\n    };\n\n    for (const cb of this.onHarvestCbs) {\n      cb(plot.cropId, plot.quality, x, y);\n    }\n\n    // Reset to tilled\n    plot.state = 'tilled';\n    plot.seedId = null;\n    plot.cropId = null;\n    plot.growthProgress = 0;\n    plot.growthDays = 0;\n    plot.quality = 0;\n    plot.daysWithoutWater = 0;\n\n    return result;\n  }\n\n  getPlot(x: number, y: number): FarmPlot | null {\n    return this.plots.get(this.key(x, y)) ?? null;\n  }\n\n  getAllPlots(): FarmPlot[] {\n    return Array.from(this.plots.values());\n  }\n\n  placeScarecrow(x: number, y: number, radius: number): void {\n    for (const plot of this.plots.values()) {\n      const dx = plot.x - x;\n      const dy = plot.y - y;\n      if (Math.sqrt(dx * dx + dy * dy) <= radius) {\n        plot.hasScarecrow = true;\n      }\n    }\n  }\n\n  /** Water all planted/growing crops (called when it rains) */\n  waterAllCrops(): void {\n    for (const plot of this.plots.values()) {\n      if (plot.state === 'planted' || plot.state === 'growing' || plot.state === 'watered') {\n        plot.wateredToday = true;\n        if (plot.state === 'planted') {\n          plot.state = 'growing';\n        }\n      }\n    }\n  }\n\n  removePlot(x: number, y: number): void {\n    this.plots.delete(this.key(x, y));\n  }\n\n  onHarvest(cb: (cropId: string, quality: number, x: number, y: number) => void): void {\n    this.onHarvestCbs.push(cb);\n  }\n\n  serialize(): FarmPlot[] {\n    return Array.from(this.plots.values());\n  }\n\n  deserialize(data: FarmPlot[]): void {\n    this.plots.clear();\n    for (const plot of data) {\n      this.plots.set(this.key(plot.x, plot.y), { ...plot });\n    }\n  }\n}\n","import { FISH } from '../data/items';\nimport { FishDef } from '../types/items';\n\nexport interface FishingSession {\n  active: boolean;\n  fishId: string | null;\n  difficulty: number;\n  progress: number;\n  barPosition: number;\n  fishPosition: number;\n  fishSpeed: number;\n  timer: number;\n  size: number;\n  baitBonus: number;\n}\n\n/**\n * Manages the fishing minigame: casting, catch bar, fish movement, and lifetime stats.\n */\nexport class FishingManager {\n  private session: FishingSession | null = null;\n  private totalCatches = 0;\n  private fishCaught: Map<string, number> = new Map();\n  private onCatchCbs: ((fishId: string, size: number) => void)[] = [];\n  private onFailCbs: (() => void)[] = [];\n\n  /** Get fish available at current conditions */\n  getAvailableFish(season: string, timeOfDay: string, location: string): FishDef[] {\n    const s = season.toLowerCase();\n    const t = timeOfDay.toLowerCase();\n    const l = location.toLowerCase();\n\n    return FISH.filter(fish => {\n      const seasonMatch = fish.seasons.length === 0 || fish.seasons.some(fs => fs.toLowerCase() === s);\n      const timeMatch = fish.timeOfDay.length === 0 || fish.timeOfDay.some(ft => ft.toLowerCase() === t);\n      const locMatch = fish.locations.length === 0 || fish.locations.some(fl => fl.toLowerCase() === l);\n      return seasonMatch && timeMatch && locMatch;\n    });\n  }\n\n  /** Start a fishing session */\n  startFishing(season: string, timeOfDay: string, location: string, baitId?: string): boolean {\n    if (this.session?.active) return false;\n\n    const available = this.getAvailableFish(season, timeOfDay, location);\n    if (available.length === 0) return false;\n\n    // Pick random fish weighted by inverse difficulty\n    const weights = available.map(f => Math.max(1, 100 - f.difficulty));\n    const totalWeight = weights.reduce((a, b) => a + b, 0);\n    let roll = Math.random() * totalWeight;\n    let picked = available[0];\n    for (let i = 0; i < available.length; i++) {\n      roll -= weights[i];\n      if (roll <= 0) {\n        picked = available[i];\n        break;\n      }\n    }\n\n    const size = picked.minSize + Math.random() * (picked.maxSize - picked.minSize);\n\n    this.session = {\n      active: true,\n      fishId: picked.id,\n      difficulty: picked.difficulty,\n      progress: 30,\n      barPosition: 50,\n      fishPosition: 50,\n      fishSpeed: 1 + picked.difficulty * 0.02,\n      timer: 30,\n      size: Math.round(size * 10) / 10,\n      baitBonus: baitId ? 1.5 : 1.0,\n    };\n\n    return true;\n  }\n\n  /** Update fishing session. Delta in seconds. */\n  update(delta: number): void {\n    if (!this.session?.active) return;\n    const s = this.session;\n\n    s.timer -= delta;\n\n    // Fish movement: sinusoidal with jitter\n    s.fishPosition = Math.sin(s.timer * s.fishSpeed) * 35 + 50\n      + Math.sin(s.timer * s.fishSpeed * 2.7) * 10;\n    s.fishPosition = Math.max(5, Math.min(95, s.fishPosition));\n\n    // Progress based on bar overlap\n    const dist = Math.abs(s.barPosition - s.fishPosition);\n    if (dist <= 15) {\n      s.progress += delta * 40 * s.baitBonus;\n    } else {\n      s.progress -= delta * 25;\n    }\n\n    s.progress = Math.max(0, Math.min(100, s.progress));\n\n    if (s.progress >= 100) {\n      this.catchFish();\n    } else if (s.progress <= 0 || s.timer <= 0) {\n      this.failFishing();\n    }\n  }\n\n  /** Player moves the catch bar */\n  moveBar(direction: number): void {\n    if (!this.session?.active) return;\n    this.session.barPosition = Math.max(0, Math.min(100, this.session.barPosition + direction));\n  }\n\n  isActive(): boolean {\n    return this.session?.active ?? false;\n  }\n\n  getSession(): FishingSession | null {\n    return this.session;\n  }\n\n  cancelFishing(): void {\n    if (this.session) {\n      this.session.active = false;\n      this.session = null;\n    }\n  }\n\n  getTotalCatches(): number {\n    return this.totalCatches;\n  }\n\n  getFishCount(fishId: string): number {\n    return this.fishCaught.get(fishId) ?? 0;\n  }\n\n  private catchFish(): void {\n    if (!this.session?.fishId) return;\n    const fishId = this.session.fishId;\n    const size = this.session.size;\n\n    this.totalCatches++;\n    this.fishCaught.set(fishId, (this.fishCaught.get(fishId) ?? 0) + 1);\n    for (const cb of this.onCatchCbs) cb(fishId, size);\n\n    this.session.active = false;\n    this.session = null;\n  }\n\n  private failFishing(): void {\n    for (const cb of this.onFailCbs) cb();\n    if (this.session) {\n      this.session.active = false;\n      this.session = null;\n    }\n  }\n\n  onCatch(cb: (fishId: string, size: number) => void): void {\n    this.onCatchCbs.push(cb);\n  }\n\n  onFail(cb: () => void): void {\n    this.onFailCbs.push(cb);\n  }\n\n  serialize(): { totalCatches: number; fishCaught: Record<string, number> } {\n    return {\n      totalCatches: this.totalCatches,\n      fishCaught: Object.fromEntries(this.fishCaught),\n    };\n  }\n\n  deserialize(data: { totalCatches: number; fishCaught: Record<string, number> }): void {\n    this.totalCatches = data.totalCatches;\n    this.fishCaught = new Map(Object.entries(data.fishCaught));\n  }\n}\n","import { COOKING_RECIPES, RecipeDef } from '../data/recipes';\nimport { ITEM_DB } from '../data/items';\nimport { FoodDef } from '../types/items';\nimport { InventoryManager } from './InventoryManager';\n\nexport interface CookingBuff {\n  type: string;\n  magnitude: number;\n  duration: number;\n  source: string;\n}\n\n/**\n * Manages cooking recipes, food consumption, and active buff tracking.\n */\nexport class CookingManager {\n  private activeBuffs: CookingBuff[] = [];\n  private totalCooked = 0;\n  private onCookCbs: ((recipeId: string) => void)[] = [];\n\n  /** Get cooking recipes the player can make */\n  getAvailableRecipes(inventory: InventoryManager): RecipeDef[] {\n    return COOKING_RECIPES.filter(recipe =>\n      recipe.ingredients.every(ing => inventory.hasItem(ing.itemId, ing.quantity)),\n    );\n  }\n\n  /** Get all cooking recipes */\n  getAllRecipes(): RecipeDef[] {\n    return COOKING_RECIPES;\n  }\n\n  /** Cook a recipe: remove ingredients, add output */\n  cook(recipeId: string, inventory: InventoryManager): boolean {\n    const recipe = COOKING_RECIPES.find(r => r.id === recipeId);\n    if (!recipe) return false;\n\n    if (!recipe.ingredients.every(ing => inventory.hasItem(ing.itemId, ing.quantity))) {\n      return false;\n    }\n\n    for (const ing of recipe.ingredients) {\n      inventory.removeItem(ing.itemId, ing.quantity);\n    }\n\n    const item = ITEM_DB.get(recipe.output.itemId);\n    const maxStack = item?.maxStack ?? 99;\n    inventory.addItem(recipe.output.itemId, recipe.output.quantity, maxStack);\n\n    this.totalCooked++;\n    for (const cb of this.onCookCbs) cb(recipeId);\n\n    return true;\n  }\n\n  /** Eat a food item. Returns heal/stamina amounts and optional buff. */\n  eatFood(foodItemId: string): { healAmount: number; staminaRestore: number; buff: CookingBuff | null } | null {\n    const item = ITEM_DB.get(foodItemId);\n    if (!item || item.category !== 'food') return null;\n\n    const food = item as FoodDef;\n\n    let buff: CookingBuff | null = null;\n    if (food.buffType && food.buffDuration && food.buffMagnitude) {\n      buff = {\n        type: food.buffType,\n        magnitude: food.buffMagnitude,\n        duration: food.buffDuration,\n        source: foodItemId,\n      };\n\n      // Don't stack same buff type — refresh\n      const existing = this.activeBuffs.findIndex(b => b.type === food.buffType);\n      if (existing >= 0) {\n        this.activeBuffs[existing] = buff;\n      } else {\n        this.activeBuffs.push(buff);\n      }\n    }\n\n    return {\n      healAmount: food.healAmount,\n      staminaRestore: food.staminaRestore,\n      buff,\n    };\n  }\n\n  /** Tick buff timers. Delta in seconds. */\n  update(delta: number): void {\n    for (let i = this.activeBuffs.length - 1; i >= 0; i--) {\n      this.activeBuffs[i].duration -= delta;\n      if (this.activeBuffs[i].duration <= 0) {\n        this.activeBuffs.splice(i, 1);\n      }\n    }\n  }\n\n  getActiveBuffs(): readonly CookingBuff[] {\n    return this.activeBuffs;\n  }\n\n  hasBuff(type: string): boolean {\n    return this.activeBuffs.some(b => b.type === type);\n  }\n\n  getBuffMagnitude(type: string): number {\n    return this.activeBuffs.find(b => b.type === type)?.magnitude ?? 0;\n  }\n\n  getTotalCooked(): number {\n    return this.totalCooked;\n  }\n\n  onCook(cb: (recipeId: string) => void): void {\n    this.onCookCbs.push(cb);\n  }\n\n  serialize(): { totalCooked: number; activeBuffs: CookingBuff[] } {\n    return {\n      totalCooked: this.totalCooked,\n      activeBuffs: this.activeBuffs.map(b => ({ ...b })),\n    };\n  }\n\n  deserialize(data: { totalCooked: number; activeBuffs: CookingBuff[] }): void {\n    this.totalCooked = data.totalCooked;\n    this.activeBuffs = data.activeBuffs.map(b => ({ ...b }));\n  }\n}\n","import { WeaponType } from '../ecs/components';\n\nexport interface MasteryXPInfo {\n  current: number;   // XP within the current level bracket\n  required: number;  // XP needed to reach the next level (from bracket start)\n}\n\n/** Milestone abilities unlocked at levels 5, 10, 15, 20 per weapon type. */\nconst MILESTONES: Record<number, Record<number, string>> = {\n  [WeaponType.Sword]:  { 5: 'Riposte',     10: 'Blade Dance',  15: 'Parry Master',   20: 'Sword Saint' },\n  [WeaponType.Axe]:    { 5: 'Cleave',       10: 'Rending Blow', 15: 'Berserker',      20: 'Axe Lord' },\n  [WeaponType.Spear]:  { 5: 'Thrust',       10: 'Sweep',        15: 'Phalanx',        20: 'Dragoon' },\n  [WeaponType.Bow]:    { 5: 'Steady Aim',   10: 'Multishot',    15: 'Eagle Eye',      20: 'Marksman' },\n  [WeaponType.Staff]:  { 5: 'Mana Shield',  10: 'Spell Echo',   15: 'Arcane Mastery', 20: 'Archmage' },\n  [WeaponType.Dagger]: { 5: 'Backstab',     10: 'Poison Coat',  15: 'Shadow Walk',    20: 'Assassin' },\n  [WeaponType.Hammer]: { 5: 'Stagger',      10: 'Earthquake',   15: 'Fortress',       20: 'Titan' },\n};\n\nconst MAX_LEVEL = 20;\nconst MILESTONE_LEVELS = [5, 10, 15, 20] as const;\n\n/** All weapon types that have mastery tracks (everything except Unarmed). */\nconst MASTERY_TYPES: WeaponType[] = [\n  WeaponType.Sword,\n  WeaponType.Axe,\n  WeaponType.Spear,\n  WeaponType.Bow,\n  WeaponType.Staff,\n  WeaponType.Dagger,\n  WeaponType.Hammer,\n];\n\ninterface MasterySaveData {\n  xp: Record<number, number>;   // WeaponType → total XP\n  levels: Record<number, number>;\n}\n\n/**\n * Tracks per-weapon-type XP and mastery levels.\n * XP curve: Level N requires 100 * N * N total XP.\n * Bonuses: +2% damage per level, +1% attack speed per level.\n * Milestone abilities unlocked at levels 5, 10, 15, 20.\n */\nexport class WeaponMasteryManager {\n  private masteryXP: Map<WeaponType, number> = new Map();\n  private masteryLevels: Map<WeaponType, number> = new Map();\n  private masteryUpCallbacks: Array<(weaponType: WeaponType, level: number) => void> = [];\n\n  constructor() {\n    for (const wt of MASTERY_TYPES) {\n      this.masteryXP.set(wt, 0);\n      this.masteryLevels.set(wt, 0);\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // XP & Level-Up\n  // ---------------------------------------------------------------------------\n\n  /** Add weapon mastery XP. Triggers onMasteryUp callbacks for each level gained. */\n  addXP(weaponType: WeaponType, amount: number): void {\n    if (weaponType === WeaponType.Unarmed || amount <= 0) return;\n    if (!this.masteryXP.has(weaponType)) return;\n\n    const prevLevel = this.masteryLevels.get(weaponType) ?? 0;\n    const newXP = (this.masteryXP.get(weaponType) ?? 0) + amount;\n    this.masteryXP.set(weaponType, newXP);\n\n    const newLevel = this.computeLevel(newXP);\n    this.masteryLevels.set(weaponType, newLevel);\n\n    for (let lvl = prevLevel + 1; lvl <= newLevel; lvl++) {\n      for (const cb of this.masteryUpCallbacks) {\n        cb(weaponType, lvl);\n      }\n    }\n  }\n\n  /** Get the current mastery level for a weapon type. Max 20. */\n  getLevel(weaponType: WeaponType): number {\n    return this.masteryLevels.get(weaponType) ?? 0;\n  }\n\n  /** Get detailed XP info for a weapon type. */\n  getXP(weaponType: WeaponType): MasteryXPInfo {\n    const totalXP = this.masteryXP.get(weaponType) ?? 0;\n    const level = this.getLevel(weaponType);\n\n    const xpForCurrentLevel = this.xpForLevel(level);\n    const current = totalXP - xpForCurrentLevel;\n    const required = level < MAX_LEVEL\n      ? this.xpForLevel(level + 1) - xpForCurrentLevel\n      : 0;\n\n    return { current, required };\n  }\n\n  // ---------------------------------------------------------------------------\n  // Bonuses\n  // ---------------------------------------------------------------------------\n\n  /** Damage bonus: +2% per mastery level (returns multiplier, e.g. 0.20 for 10%). */\n  getDamageBonus(weaponType: WeaponType): number {\n    return this.getLevel(weaponType) * 0.02;\n  }\n\n  /** Speed bonus: +1% per mastery level (returns multiplier, e.g. 0.10 for 10%). */\n  getSpeedBonus(weaponType: WeaponType): number {\n    return this.getLevel(weaponType) * 0.01;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Milestones\n  // ---------------------------------------------------------------------------\n\n  /** Returns names of milestone abilities unlocked at the current mastery level. */\n  getMilestoneUnlocks(weaponType: WeaponType): string[] {\n    const level = this.getLevel(weaponType);\n    const milestones = MILESTONES[weaponType];\n    if (!milestones) return [];\n\n    const unlocked: string[] = [];\n    for (const ml of MILESTONE_LEVELS) {\n      if (ml <= level && milestones[ml]) {\n        unlocked.push(milestones[ml]);\n      }\n    }\n    return unlocked;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Callbacks\n  // ---------------------------------------------------------------------------\n\n  /** Register a callback fired whenever any weapon mastery levels up. */\n  onMasteryUp(cb: (weaponType: WeaponType, level: number) => void): void {\n    this.masteryUpCallbacks.push(cb);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Persistence\n  // ---------------------------------------------------------------------------\n\n  /** Serialize for save. */\n  serialize(): MasterySaveData {\n    const xp: Record<number, number> = {};\n    const levels: Record<number, number> = {};\n    for (const [wt, val] of this.masteryXP) {\n      xp[wt] = val;\n    }\n    for (const [wt, val] of this.masteryLevels) {\n      levels[wt] = val;\n    }\n    return { xp, levels };\n  }\n\n  /** Deserialize from save. */\n  deserialize(data: MasterySaveData): void {\n    if (data.xp) {\n      for (const [wt, val] of Object.entries(data.xp)) {\n        this.masteryXP.set(Number(wt) as WeaponType, val);\n      }\n    }\n    if (data.levels) {\n      for (const [wt, val] of Object.entries(data.levels)) {\n        this.masteryLevels.set(Number(wt) as WeaponType, val);\n      }\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Internal\n  // ---------------------------------------------------------------------------\n\n  /** Total XP required to reach a given level: 100 * L * L. */\n  private xpForLevel(level: number): number {\n    return 100 * level * level;\n  }\n\n  /** Compute level from total accumulated XP. */\n  private computeLevel(totalXP: number): number {\n    let level = 0;\n    while (level < MAX_LEVEL && totalXP >= this.xpForLevel(level + 1)) {\n      level++;\n    }\n    return level;\n  }\n}\n","import { ChapterDef } from '../types/world';\n\nexport const CHAPTERS: ChapterDef[] = [\n  {\n    id: 1, name: 'Awakening', biome: 'haven',\n    description: 'You awaken in Haven with no memory. The village elder teaches you the basics of survival. But something dark stirs at the edge of the meadows...',\n    requiredObjectives: [\n      { type: 'talk', target: 'elder_mira', count: 1, description: 'Speak with Elder Mira' },\n      { type: 'craft', target: 'workbench', count: 1, description: 'Craft your first tool' },\n      { type: 'farm', target: 'any_crop', count: 5, description: 'Grow 5 crops' },\n      { type: 'kill', target: 'forest_slime', count: 10, description: 'Clear 10 slimes from the fields' },\n      { type: 'explore', target: 'haven_dungeon', count: 1, description: 'Discover the Overgrown Cellar' },\n      { type: 'kill', target: 'harvest_horror', count: 1, description: 'Defeat the Harvest Horror' },\n    ],\n    optionalObjectives: [\n      { type: 'fish', target: 'any_fish', count: 5, description: 'Catch 5 fish' },\n      { type: 'collect', target: 'wild_berries', count: 20, description: 'Gather 20 wild berries' },\n      { type: 'talk', target: 'all_haven_npcs', count: 5, description: 'Meet all Haven villagers' },\n    ],\n    gateBoss: 'harvest_horror',\n    unlocks: ['rotwood_access', 'crafting_stations', 'quest_board'],\n    cutsceneIds: ['intro_awakening', 'elder_tutorial', 'corruption_revealed'],\n  },\n  {\n    id: 2, name: 'The Rot Spreads', biome: 'rotwood',\n    description: 'The corruption in Rotwood grows stronger. Fungi and spores choke the forest. You must find the source and perform your first purification.',\n    requiredObjectives: [\n      { type: 'explore', target: 'rotwood_entrance', count: 1, description: 'Enter the Rotwood' },\n      { type: 'kill', target: 'rotwood_enemies', count: 25, description: 'Slay 25 corrupted creatures' },\n      { type: 'collect', target: 'purification_reagent', count: 3, description: 'Gather 3 purification reagents' },\n      { type: 'craft', target: 'purification_charm', count: 1, description: 'Craft a Purification Charm' },\n      { type: 'explore', target: 'fungal_depths', count: 1, description: 'Reach the Fungal Depths dungeon' },\n      { type: 'kill', target: 'blight_mother', count: 1, description: 'Defeat the Blight Mother' },\n    ],\n    optionalObjectives: [\n      { type: 'collect', target: 'mushroom_cluster', count: 30, description: 'Harvest 30 mushroom clusters' },\n      { type: 'kill', target: 'corrupted_treant', count: 5, description: 'Fell 5 Corrupted Treants' },\n    ],\n    gateBoss: 'blight_mother',\n    unlocks: ['ashlands_access', 'purification_system', 'corruption_meter'],\n    cutsceneIds: ['rotwood_entry', 'first_purification', 'blight_mother_reveal'],\n  },\n  {\n    id: 3, name: 'Forged in Fire', biome: 'ashlands',\n    description: 'The Ashlands burn with volcanic fury. Here you learn to build settlements and forge powerful equipment from the land\\'s fiery resources.',\n    requiredObjectives: [\n      { type: 'explore', target: 'ashlands_entrance', count: 1, description: 'Enter the Ashlands' },\n      { type: 'craft', target: 'fire_resistant_armor', count: 1, description: 'Forge fire-resistant armor' },\n      { type: 'reach', target: 'settlement_site_1', count: 1, description: 'Discover a settlement site' },\n      { type: 'craft', target: 'settlement_town_hall', count: 1, description: 'Build a Town Hall' },\n      { type: 'explore', target: 'volcanic_forge_dungeon', count: 1, description: 'Clear the Volcanic Forge dungeon' },\n      { type: 'kill', target: 'stone_titan', count: 1, description: 'Defeat the Stone Titan' },\n    ],\n    optionalObjectives: [\n      { type: 'craft', target: 'obsidian_weapon', count: 1, description: 'Forge an obsidian weapon' },\n      { type: 'mine', target: 'fire_crystal', count: 10, description: 'Mine 10 fire crystals' },\n    ],\n    gateBoss: 'stone_titan',\n    unlocks: ['drowned_access', 'settlement_system', 'advanced_crafting'],\n    cutsceneIds: ['ashlands_entry', 'settlement_tutorial', 'stone_titan_awakens'],\n  },\n  {\n    id: 4, name: 'Depths Below', biome: 'drowned',\n    description: 'Flooded ruins hide ancient secrets. The Rift system activates, opening portals to infinite challenges. Something massive lurks in the deep.',\n    requiredObjectives: [\n      { type: 'explore', target: 'drowned_entrance', count: 1, description: 'Enter the Drowned Depths' },\n      { type: 'collect', target: 'breathing_apparatus', count: 1, description: 'Craft underwater breathing gear' },\n      { type: 'explore', target: 'rift_portal', count: 1, description: 'Discover the first Rift Portal' },\n      { type: 'reach', target: 'rift_floor_5', count: 1, description: 'Reach Rift floor 5' },\n      { type: 'explore', target: 'sunken_temple', count: 1, description: 'Clear the Sunken Temple dungeon' },\n      { type: 'kill', target: 'kraken', count: 1, description: 'Defeat the Kraken' },\n    ],\n    optionalObjectives: [\n      { type: 'fish', target: 'deep_fish', count: 10, description: 'Catch 10 deep-sea fish' },\n      { type: 'reach', target: 'rift_floor_10', count: 1, description: 'Reach Rift floor 10' },\n    ],\n    gateBoss: 'kraken',\n    unlocks: ['bone_wastes_access', 'rift_system', 'underwater_exploration'],\n    cutsceneIds: ['drowned_entry', 'rift_discovery', 'kraken_emerges'],\n  },\n  {\n    id: 5, name: 'Valley of Bones', biome: 'bone_wastes',\n    description: 'The desert hides a war between factions vying for control. Massive titans roam the wastes. Choose your allegiances carefully.',\n    requiredObjectives: [\n      { type: 'explore', target: 'bone_wastes_entrance', count: 1, description: 'Enter the Bone Wastes' },\n      { type: 'talk', target: 'faction_leader', count: 1, description: 'Meet a faction leader' },\n      { type: 'kill', target: 'faction_outpost', count: 3, description: 'Clear 3 enemy faction outposts' },\n      { type: 'explore', target: 'titan_trail', count: 1, description: 'Find a Titan\\'s trail' },\n      { type: 'explore', target: 'bone_crypt', count: 1, description: 'Clear the Bone Crypt dungeon' },\n      { type: 'kill', target: 'sand_wyrm', count: 1, description: 'Defeat the Sand Wyrm' },\n    ],\n    optionalObjectives: [\n      { type: 'kill', target: 'titan_any', count: 1, description: 'Defeat a roaming Titan' },\n      { type: 'collect', target: 'ancient_bone', count: 50, description: 'Collect 50 ancient bones' },\n    ],\n    gateBoss: 'sand_wyrm',\n    unlocks: ['void_access', 'faction_system', 'titan_hunting'],\n    cutsceneIds: ['bone_wastes_entry', 'faction_war_begins', 'sand_wyrm_burrows'],\n  },\n  {\n    id: 6, name: 'Beyond Reality', biome: 'the_void',\n    description: 'Reality unravels. The Shadow World opens, allowing dimension-shifting between two versions of the world. The truth about EDILAS begins to emerge.',\n    requiredObjectives: [\n      { type: 'explore', target: 'void_entrance', count: 1, description: 'Enter The Void' },\n      { type: 'explore', target: 'rift_stone', count: 1, description: 'Activate a Rift Stone to enter the Shadow World' },\n      { type: 'collect', target: 'shadow_resource', count: 10, description: 'Gather 10 shadow-exclusive resources' },\n      { type: 'kill', target: 'shadow_enemies', count: 20, description: 'Slay 20 shadow creatures' },\n      { type: 'explore', target: 'reality_breach', count: 1, description: 'Clear the Reality Breach dungeon' },\n      { type: 'kill', target: 'void_weaver', count: 1, description: 'Defeat the Void Weaver' },\n    ],\n    optionalObjectives: [\n      { type: 'reach', target: 'rift_floor_25', count: 1, description: 'Reach Rift floor 25' },\n      { type: 'kill', target: 'cross_dimensional_boss', count: 1, description: 'Defeat a cross-dimensional boss' },\n    ],\n    gateBoss: 'void_weaver',\n    unlocks: ['edilas_access', 'shadow_world', 'dimension_shifting'],\n    cutsceneIds: ['void_entry', 'shadow_world_reveal', 'void_weaver_truth'],\n  },\n  {\n    id: 7, name: 'The Living Pilgrimage', biome: 'edilas',\n    description: 'The final confrontation. EDILAS itself is alive — the source of corruption, and the key to salvation. Your pilgrimage ends here.',\n    requiredObjectives: [\n      { type: 'explore', target: 'edilas_heart', count: 1, description: 'Reach the Heart of EDILAS' },\n      { type: 'collect', target: 'primordial_essence', count: 5, description: 'Gather 5 Primordial Essences' },\n      { type: 'kill', target: 'corruption_avatar', count: 3, description: 'Destroy 3 Corruption Avatars' },\n      { type: 'explore', target: 'world_core', count: 1, description: 'Enter the World Core dungeon' },\n      { type: 'kill', target: 'world_serpent', count: 1, description: 'Defeat the World Serpent' },\n    ],\n    optionalObjectives: [\n      { type: 'reach', target: 'rift_floor_50', count: 1, description: 'Reach Rift floor 50' },\n      { type: 'kill', target: 'all_titans', count: 5, description: 'Defeat all 5 Titans' },\n      { type: 'reach', target: 'max_corruption_purified', count: 1, description: 'Purify all corruption in Haven' },\n    ],\n    gateBoss: 'world_serpent',\n    unlocks: ['new_game_plus', 'endless_mode', 'mythic_crafting'],\n    cutsceneIds: ['edilas_revelation', 'world_serpent_awakens', 'ending_pilgrimage_complete'],\n  },\n];\n\nexport const CHAPTER_DB = new Map<number, ChapterDef>(CHAPTERS.map(c => [c.id, c]));\n","import { CHAPTERS } from '../data/chapters';\nimport { ChapterDef } from '../types/world';\n\ninterface ChapterProgress {\n  chapterId: number;\n  requiredProgress: number[];   // progress per required objective\n  optionalProgress: number[];   // progress per optional objective\n  completed: boolean;\n  bossDefeated: boolean;\n}\n\ninterface StorySaveData {\n  currentChapter: number;\n  chapterProgress: Record<number, ChapterProgress>;\n  unlockedBiomes: string[];\n  unlockedFeatures: string[];\n  defeatedBosses: string[];\n}\n\n/**\n * Manages chapter progression, biome unlocking, and story objectives.\n * Hooks into QuestManager and CombatManager events.\n */\nexport class StoryManager {\n  private currentChapter = 1;\n  private chapterProgress: Map<number, ChapterProgress> = new Map();\n  private unlockedBiomes: Set<string> = new Set(['haven']);\n  private unlockedFeatures: Set<string> = new Set();\n  private defeatedBosses: Set<string> = new Set();\n\n  private onChapterCompleteCbs: ((chapterId: number) => void)[] = [];\n  private onBiomeUnlockCbs: ((biomeId: string) => void)[] = [];\n  private onCutsceneCbs: ((cutsceneId: string) => void)[] = [];\n\n  constructor() {\n    this.initChapter(1);\n  }\n\n  private initChapter(chapterId: number): void {\n    const def = CHAPTERS.find(c => c.id === chapterId);\n    if (!def || this.chapterProgress.has(chapterId)) return;\n\n    this.chapterProgress.set(chapterId, {\n      chapterId,\n      requiredProgress: new Array(def.requiredObjectives.length).fill(0),\n      optionalProgress: new Array(def.optionalObjectives.length).fill(0),\n      completed: false,\n      bossDefeated: false,\n    });\n  }\n\n  /** Get current chapter number */\n  getCurrentChapter(): number {\n    return this.currentChapter;\n  }\n\n  /** Get chapter definition */\n  getChapterDef(chapterId: number): ChapterDef | null {\n    return CHAPTERS.find(c => c.id === chapterId) ?? null;\n  }\n\n  /** Get progress for a chapter */\n  getProgress(chapterId: number): ChapterProgress | null {\n    return this.chapterProgress.get(chapterId) ?? null;\n  }\n\n  /** Update a story objective (called by other systems) */\n  updateObjective(type: string, target: string, amount: number): void {\n    const def = CHAPTERS.find(c => c.id === this.currentChapter);\n    const progress = this.chapterProgress.get(this.currentChapter);\n    if (!def || !progress) return;\n\n    // Check required objectives\n    for (let i = 0; i < def.requiredObjectives.length; i++) {\n      const obj = def.requiredObjectives[i];\n      if (obj.type === type && (obj.target === target || obj.target.startsWith('any'))) {\n        progress.requiredProgress[i] = Math.min(\n          progress.requiredProgress[i] + amount,\n          obj.count,\n        );\n      }\n    }\n\n    // Check optional objectives\n    for (let i = 0; i < def.optionalObjectives.length; i++) {\n      const obj = def.optionalObjectives[i];\n      if (obj.type === type && (obj.target === target || obj.target.startsWith('any') || obj.target.startsWith('all'))) {\n        progress.optionalProgress[i] = Math.min(\n          progress.optionalProgress[i] + amount,\n          obj.count,\n        );\n      }\n    }\n\n    // Check if all required objectives complete AND boss defeated\n    this.checkChapterCompletion();\n  }\n\n  /** Record a boss kill */\n  defeatBoss(bossId: string): void {\n    this.defeatedBosses.add(bossId);\n\n    const def = CHAPTERS.find(c => c.id === this.currentChapter);\n    const progress = this.chapterProgress.get(this.currentChapter);\n    if (!def || !progress) return;\n\n    if (def.gateBoss === bossId) {\n      progress.bossDefeated = true;\n      this.updateObjective('kill', bossId, 1);\n    }\n\n    this.checkChapterCompletion();\n  }\n\n  private checkChapterCompletion(): void {\n    const def = CHAPTERS.find(c => c.id === this.currentChapter);\n    const progress = this.chapterProgress.get(this.currentChapter);\n    if (!def || !progress || progress.completed) return;\n\n    // All required objectives met?\n    const allRequired = def.requiredObjectives.every(\n      (obj, i) => progress.requiredProgress[i] >= obj.count,\n    );\n\n    if (allRequired && progress.bossDefeated) {\n      progress.completed = true;\n\n      // Unlock features\n      for (const unlock of def.unlocks) {\n        this.unlockedFeatures.add(unlock);\n\n        // Biome access unlocks\n        if (unlock.endsWith('_access')) {\n          const biomeId = unlock.replace('_access', '');\n          this.unlockedBiomes.add(biomeId);\n          for (const cb of this.onBiomeUnlockCbs) cb(biomeId);\n        }\n      }\n\n      for (const cb of this.onChapterCompleteCbs) cb(this.currentChapter);\n\n      // Advance to next chapter\n      const nextChapter = this.currentChapter + 1;\n      if (CHAPTERS.find(c => c.id === nextChapter)) {\n        this.currentChapter = nextChapter;\n        this.initChapter(nextChapter);\n      }\n    }\n  }\n\n  /** Trigger a cutscene by ID */\n  triggerCutscene(cutsceneId: string): void {\n    for (const cb of this.onCutsceneCbs) cb(cutsceneId);\n  }\n\n  /** Check if a biome is unlocked */\n  isBiomeUnlocked(biomeId: string): boolean {\n    return this.unlockedBiomes.has(biomeId);\n  }\n\n  /** Check if a feature is unlocked */\n  isFeatureUnlocked(featureId: string): boolean {\n    return this.unlockedFeatures.has(featureId);\n  }\n\n  /** Check if a boss has been defeated */\n  isBossDefeated(bossId: string): boolean {\n    return this.defeatedBosses.has(bossId);\n  }\n\n  /** Get all unlocked biomes */\n  getUnlockedBiomes(): string[] {\n    return Array.from(this.unlockedBiomes);\n  }\n\n  /** Get chapter completion percent (required objectives only) */\n  getCompletionPercent(chapterId: number): number {\n    const def = CHAPTERS.find(c => c.id === chapterId);\n    const progress = this.chapterProgress.get(chapterId);\n    if (!def || !progress || def.requiredObjectives.length === 0) return 0;\n\n    let total = 0;\n    let done = 0;\n    for (let i = 0; i < def.requiredObjectives.length; i++) {\n      total += def.requiredObjectives[i].count;\n      done += progress.requiredProgress[i];\n    }\n    return Math.min(1, done / total);\n  }\n\n  onChapterComplete(cb: (chapterId: number) => void): void {\n    this.onChapterCompleteCbs.push(cb);\n  }\n\n  onBiomeUnlock(cb: (biomeId: string) => void): void {\n    this.onBiomeUnlockCbs.push(cb);\n  }\n\n  onCutscene(cb: (cutsceneId: string) => void): void {\n    this.onCutsceneCbs.push(cb);\n  }\n\n  serialize(): StorySaveData {\n    const chapterProgress: Record<number, ChapterProgress> = {};\n    for (const [id, prog] of this.chapterProgress) {\n      chapterProgress[id] = {\n        ...prog,\n        requiredProgress: [...prog.requiredProgress],\n        optionalProgress: [...prog.optionalProgress],\n      };\n    }\n    return {\n      currentChapter: this.currentChapter,\n      chapterProgress,\n      unlockedBiomes: Array.from(this.unlockedBiomes),\n      unlockedFeatures: Array.from(this.unlockedFeatures),\n      defeatedBosses: Array.from(this.defeatedBosses),\n    };\n  }\n\n  deserialize(data: StorySaveData): void {\n    this.currentChapter = data.currentChapter;\n    this.chapterProgress.clear();\n    for (const [id, prog] of Object.entries(data.chapterProgress)) {\n      this.chapterProgress.set(Number(id), { ...prog });\n    }\n    this.unlockedBiomes = new Set(data.unlockedBiomes);\n    this.unlockedFeatures = new Set(data.unlockedFeatures);\n    this.defeatedBosses = new Set(data.defeatedBosses);\n  }\n}\n","/**\n * EDILAS (Phaser) - Corruption Manager\n * Per-chunk corruption tracking and spread simulation.\n * Corruption values are stored as Float32Arrays (16x16) keyed by chunk coordinates.\n *\n * Phase 10: Corruption system — environmental hazard that spreads across\n * active chunks, applies player debuffs at configurable thresholds, and\n * supports a Shadow World dimension toggle.\n */\n\nimport {\n  CORRUPTION_SPREAD_RATE,\n  CORRUPTION_SLOW_THRESHOLD,\n  CORRUPTION_DAMAGE_THRESHOLD,\n  CORRUPTION_SPAWN_THRESHOLD,\n  CHUNK_SIZE,\n} from '../config';\n\n// ---------------------------------------------------------------------------\n// Save Data Shape\n// ---------------------------------------------------------------------------\n\ninterface CorruptionSaveData {\n  chunks: Record<string, number[]>;\n  shadowWorld: boolean;\n}\n\n// ---------------------------------------------------------------------------\n// Corruption Manager\n// ---------------------------------------------------------------------------\n\nexport class CorruptionManager {\n  /** key = \"cx,cy\", value = flat Float32Array of CHUNK_SIZE * CHUNK_SIZE corruption values (0-1) */\n  private chunks: Map<string, Float32Array> = new Map();\n  private shadowWorld: boolean = false;\n\n  // Callbacks\n  private onCorruptionSpreadCallbacks: Array<(chunkKey: string) => void> = [];\n\n  // ---------------------------------------------------------------------------\n  // Helpers\n  // ---------------------------------------------------------------------------\n\n  /** Build a chunk key from chunk coordinates. */\n  private static key(cx: number, cy: number): string {\n    return `${cx},${cy}`;\n  }\n\n  /** Convert tile coordinates to chunk coordinates. */\n  private static tileToChunk(tileX: number, tileY: number): { cx: number; cy: number; lx: number; ly: number } {\n    const cx = Math.floor(tileX / CHUNK_SIZE);\n    const cy = Math.floor(tileY / CHUNK_SIZE);\n    const lx = ((tileX % CHUNK_SIZE) + CHUNK_SIZE) % CHUNK_SIZE;\n    const ly = ((tileY % CHUNK_SIZE) + CHUNK_SIZE) % CHUNK_SIZE;\n    return { cx, cy, lx, ly };\n  }\n\n  /** Get or create a chunk's corruption array. */\n  private ensureChunk(cx: number, cy: number): Float32Array {\n    const k = CorruptionManager.key(cx, cy);\n    let arr = this.chunks.get(k);\n    if (!arr) {\n      arr = new Float32Array(CHUNK_SIZE * CHUNK_SIZE);\n      this.chunks.set(k, arr);\n    }\n    return arr;\n  }\n\n  /** Index into the flat array from local tile coords. */\n  private static idx(lx: number, ly: number): number {\n    return ly * CHUNK_SIZE + lx;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Public API — Tile access\n  // ---------------------------------------------------------------------------\n\n  /** Get corruption at a world tile (0-1). Returns 0 for unloaded chunks. */\n  getCorruption(tileX: number, tileY: number): number {\n    const { cx, cy, lx, ly } = CorruptionManager.tileToChunk(tileX, tileY);\n    const arr = this.chunks.get(CorruptionManager.key(cx, cy));\n    if (!arr) return 0;\n    return arr[CorruptionManager.idx(lx, ly)];\n  }\n\n  /** Set corruption at a world tile (clamped to 0-1). */\n  setCorruption(tileX: number, tileY: number, value: number): void {\n    const { cx, cy, lx, ly } = CorruptionManager.tileToChunk(tileX, tileY);\n    const arr = this.ensureChunk(cx, cy);\n    arr[CorruptionManager.idx(lx, ly)] = Math.max(0, Math.min(1, value));\n  }\n\n  /** Reduce corruption at a tile by a given amount. */\n  purifyTile(tileX: number, tileY: number, amount: number): void {\n    const current = this.getCorruption(tileX, tileY);\n    this.setCorruption(tileX, tileY, current - amount);\n  }\n\n  /** Set all tiles in a chunk to 0. */\n  purifyChunk(cx: number, cy: number): void {\n    const k = CorruptionManager.key(cx, cy);\n    const arr = this.chunks.get(k);\n    if (arr) {\n      arr.fill(0);\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Public API — Spread\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Called once per tick. Spreads corruption to adjacent tiles within active\n   * chunks only. Each tile with corruption > 0 leaks CORRUPTION_SPREAD_RATE\n   * to its 4-connected neighbours (clamped to 1.0).\n   *\n   * Shadow World doubles the spread rate.\n   */\n  spreadCorruption(activeChunks: string[]): void {\n    const rate = this.shadowWorld\n      ? CORRUPTION_SPREAD_RATE * 2\n      : CORRUPTION_SPREAD_RATE;\n\n    for (const chunkKey of activeChunks) {\n      const arr = this.chunks.get(chunkKey);\n      if (!arr) continue;\n\n      // Work on a snapshot so writes don't feed back into the same tick\n      const snapshot = new Float32Array(arr);\n\n      let anySpread = false;\n\n      for (let ly = 0; ly < CHUNK_SIZE; ly++) {\n        for (let lx = 0; lx < CHUNK_SIZE; lx++) {\n          const idx = CorruptionManager.idx(lx, ly);\n          const val = snapshot[idx];\n          if (val <= 0) continue;\n\n          const spread = val * rate;\n\n          // Spread to 4-connected neighbors within the same chunk\n          const neighbors: [number, number][] = [\n            [lx - 1, ly],\n            [lx + 1, ly],\n            [lx, ly - 1],\n            [lx, ly + 1],\n          ];\n\n          for (const [nx, ny] of neighbors) {\n            if (nx < 0 || nx >= CHUNK_SIZE || ny < 0 || ny >= CHUNK_SIZE) continue;\n            const nIdx = CorruptionManager.idx(nx, ny);\n            if (arr[nIdx] < 1) {\n              arr[nIdx] = Math.min(1, arr[nIdx] + spread);\n              anySpread = true;\n            }\n          }\n        }\n      }\n\n      if (anySpread) {\n        for (const cb of this.onCorruptionSpreadCallbacks) {\n          cb(chunkKey);\n        }\n      }\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Public API — Player Effects\n  // ---------------------------------------------------------------------------\n\n  /** Check what effects the corruption level at a tile applies to the player. */\n  getPlayerEffects(tileX: number, tileY: number): {\n    slowStamina: boolean;\n    takeDamage: boolean;\n    spawnShadow: boolean;\n  } {\n    const c = this.getCorruption(tileX, tileY);\n    return {\n      slowStamina: c >= CORRUPTION_SLOW_THRESHOLD,\n      takeDamage: c >= CORRUPTION_DAMAGE_THRESHOLD,\n      spawnShadow: c >= CORRUPTION_SPAWN_THRESHOLD,\n    };\n  }\n\n  // ---------------------------------------------------------------------------\n  // Public API — Shadow World\n  // ---------------------------------------------------------------------------\n\n  /** Whether the Shadow World dimension is active. */\n  isShadowWorld(): boolean {\n    return this.shadowWorld;\n  }\n\n  /** Toggle the Shadow World dimension on or off. */\n  setShadowWorld(active: boolean): void {\n    this.shadowWorld = active;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Public API — Queries\n  // ---------------------------------------------------------------------------\n\n  /** Get the average corruption level for an entire chunk (0-1). */\n  getChunkCorruption(cx: number, cy: number): number {\n    const arr = this.chunks.get(CorruptionManager.key(cx, cy));\n    if (!arr) return 0;\n    let sum = 0;\n    for (let i = 0; i < arr.length; i++) {\n      sum += arr[i];\n    }\n    return sum / arr.length;\n  }\n\n  /** Return all chunk keys that have any corruption data. */\n  getCorruptedChunks(): string[] {\n    const result: string[] = [];\n    for (const [key, arr] of this.chunks) {\n      for (let i = 0; i < arr.length; i++) {\n        if (arr[i] > 0) {\n          result.push(key);\n          break;\n        }\n      }\n    }\n    return result;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Callbacks\n  // ---------------------------------------------------------------------------\n\n  /** Register a callback fired when corruption spreads within a chunk. */\n  onCorruptionSpread(cb: (chunkKey: string) => void): void {\n    this.onCorruptionSpreadCallbacks.push(cb);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Corruption Curse (Dead Cells-inspired gambit)\n  // ---------------------------------------------------------------------------\n\n  private curseRemaining = 0; // seconds remaining on active curse (0 = not cursed)\n  private cursed = false;\n\n  /** Apply a corruption curse. All corruption effects are maximized for the duration. */\n  applyCurse(durationSec: number): void {\n    this.curseRemaining = durationSec;\n    this.cursed = true;\n  }\n\n  /** Tick curse timer. Call each frame. */\n  tickCurse(deltaSec: number): void {\n    if (!this.cursed) return;\n    this.curseRemaining -= deltaSec;\n    if (this.curseRemaining <= 0) {\n      this.curseRemaining = 0;\n      this.cursed = false;\n    }\n  }\n\n  /** Whether the player is currently cursed */\n  isCursed(): boolean {\n    return this.cursed;\n  }\n\n  /** Remaining curse duration in seconds */\n  getCurseRemaining(): number {\n    return this.curseRemaining;\n  }\n\n  /**\n   * Get player effects with curse override.\n   * When cursed, all effects are forced active regardless of tile corruption.\n   */\n  getPlayerEffectsWithCurse(tileX: number, tileY: number): {\n    slowStamina: boolean;\n    takeDamage: boolean;\n    spawnShadow: boolean;\n  } {\n    if (this.cursed) {\n      return { slowStamina: true, takeDamage: true, spawnShadow: true };\n    }\n    return this.getPlayerEffects(tileX, tileY);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Persistence\n  // ---------------------------------------------------------------------------\n\n  /** Serialize for save. */\n  serialize(): CorruptionSaveData {\n    const chunks: Record<string, number[]> = {};\n    for (const [key, arr] of this.chunks) {\n      // Only persist chunks with non-zero corruption\n      let hasValue = false;\n      for (let i = 0; i < arr.length; i++) {\n        if (arr[i] > 0) { hasValue = true; break; }\n      }\n      if (hasValue) {\n        chunks[key] = Array.from(arr);\n      }\n    }\n    return { chunks, shadowWorld: this.shadowWorld };\n  }\n\n  /** Deserialize from save. */\n  deserialize(data: CorruptionSaveData): void {\n    this.chunks.clear();\n    this.shadowWorld = data.shadowWorld ?? false;\n\n    if (data.chunks) {\n      for (const [key, values] of Object.entries(data.chunks)) {\n        const arr = new Float32Array(CHUNK_SIZE * CHUNK_SIZE);\n        for (let i = 0; i < values.length && i < arr.length; i++) {\n          arr[i] = values[i];\n        }\n        this.chunks.set(key, arr);\n      }\n    }\n  }\n}\n","export type ModifierSeverity = 'minor' | 'major' | 'extreme';\n\nexport interface RiftModifierDef {\n  id: string;\n  name: string;\n  description: string;\n  severity: ModifierSeverity;\n  effects: {\n    enemyHpMult?: number;\n    enemyDamageMult?: number;\n    enemySpeedMult?: number;\n    enemyDefenseMult?: number;\n    enemyCountMult?: number;\n    playerVisionMult?: number;\n    playerSpeedMult?: number;\n    environmentalDamage?: number;\n    environmentalInterval?: number;\n    specialMechanic?: string;\n  };\n  visualEffect: string;\n  minFloor: number;   // Earliest floor this can appear\n}\n\nexport const RIFT_MODIFIERS: RiftModifierDef[] = [\n  // Minor (7)\n  {\n    id: 'darkness', name: 'Darkness', severity: 'minor',\n    description: 'Reduced vision radius — enemies lurk just outside sight.',\n    effects: { playerVisionMult: 0.5 },\n    visualEffect: 'fog_overlay', minFloor: 1,\n  },\n  {\n    id: 'haste', name: 'Haste', severity: 'minor',\n    description: 'Enemies move 20% faster.',\n    effects: { enemySpeedMult: 1.2 },\n    visualEffect: 'speed_trails', minFloor: 1,\n  },\n  {\n    id: 'armored', name: 'Armored', severity: 'minor',\n    description: 'Enemies have 30% more defense.',\n    effects: { enemyDefenseMult: 1.3 },\n    visualEffect: 'shield_glow', minFloor: 2,\n  },\n  {\n    id: 'thorns', name: 'Thorns', severity: 'minor',\n    description: 'Enemies reflect 5% of damage taken back to the attacker.',\n    effects: { specialMechanic: 'damage_reflect_5' },\n    visualEffect: 'thorn_aura', minFloor: 3,\n  },\n  {\n    id: 'regen', name: 'Regenerating', severity: 'minor',\n    description: 'Enemies regenerate 1% HP every 5 seconds.',\n    effects: { specialMechanic: 'enemy_regen_1_5' },\n    visualEffect: 'heal_pulse', minFloor: 3,\n  },\n  {\n    id: 'swarm', name: 'Swarm', severity: 'minor',\n    description: '50% more enemies, but each has 30% less HP.',\n    effects: { enemyCountMult: 1.5, enemyHpMult: 0.7 },\n    visualEffect: 'swarm_particles', minFloor: 2,\n  },\n  {\n    id: 'labyrinth', name: 'Labyrinth', severity: 'minor',\n    description: 'More rooms and dead ends. Good luck finding the exit.',\n    effects: { specialMechanic: 'extra_rooms_deadends' },\n    visualEffect: 'maze_overlay', minFloor: 1,\n  },\n\n  // Major (7)\n  {\n    id: 'volcanic', name: 'Volcanic', severity: 'major',\n    description: 'Lava tiles randomly appear and deal damage.',\n    effects: { environmentalDamage: 15, environmentalInterval: 3, specialMechanic: 'lava_tiles_spawn' },\n    visualEffect: 'lava_cracks', minFloor: 5,\n  },\n  {\n    id: 'frozen', name: 'Frozen', severity: 'major',\n    description: 'Ice physics — slippery movement and frozen enemies shatter on death.',\n    effects: { specialMechanic: 'ice_physics', playerSpeedMult: 0.8 },\n    visualEffect: 'frost_overlay', minFloor: 5,\n  },\n  {\n    id: 'toxic', name: 'Toxic', severity: 'major',\n    description: 'Poison fog patches deal damage over time.',\n    effects: { environmentalDamage: 8, environmentalInterval: 2, specialMechanic: 'poison_fog_patches' },\n    visualEffect: 'toxic_fog', minFloor: 6,\n  },\n  {\n    id: 'gravity_shift', name: 'Gravity Shift', severity: 'major',\n    description: 'Random gravity reversal zones pull you toward the ceiling.',\n    effects: { specialMechanic: 'gravity_zones' },\n    visualEffect: 'gravity_distortion', minFloor: 8,\n  },\n  {\n    id: 'mirror', name: 'Mirror', severity: 'major',\n    description: 'Enemies copy your equipped weapon abilities.',\n    effects: { specialMechanic: 'enemy_copy_abilities' },\n    visualEffect: 'mirror_shimmer', minFloor: 10,\n  },\n  {\n    id: 'nightfall', name: 'Nightfall', severity: 'major',\n    description: 'No minimap, limited light. Only a small circle of visibility.',\n    effects: { playerVisionMult: 0.25, specialMechanic: 'no_minimap' },\n    visualEffect: 'deep_darkness', minFloor: 7,\n  },\n  {\n    id: 'temporal', name: 'Temporal', severity: 'major',\n    description: 'Random speed zones — some speed you up, others slow you to a crawl.',\n    effects: { specialMechanic: 'time_zones' },\n    visualEffect: 'time_distortion', minFloor: 8,\n  },\n\n  // Extreme (4)\n  {\n    id: 'void_rift', name: 'Void Rift', severity: 'extreme',\n    description: 'Random teleportation — portals whisk you to unknown locations on the floor.',\n    effects: { specialMechanic: 'random_teleport' },\n    visualEffect: 'void_portals', minFloor: 15,\n  },\n  {\n    id: 'corruption_surge', name: 'Corruption Surge', severity: 'extreme',\n    description: 'Corruption rapidly spreads from enemies — purify or be consumed.',\n    effects: { specialMechanic: 'rapid_corruption', environmentalDamage: 10, environmentalInterval: 2 },\n    visualEffect: 'corruption_wave', minFloor: 20,\n  },\n  {\n    id: 'boss_rush', name: 'Boss Rush', severity: 'extreme',\n    description: 'A mini-boss spawns every 3 rooms instead of every 5 floors.',\n    effects: { specialMechanic: 'frequent_bosses' },\n    visualEffect: 'boss_aura', minFloor: 15,\n  },\n  {\n    id: 'permadeath', name: 'Permadeath', severity: 'extreme',\n    description: 'One life. No respawns. Death means starting over from the checkpoint.',\n    effects: { specialMechanic: 'no_respawn' },\n    visualEffect: 'death_aura', minFloor: 25,\n  },\n];\n\nexport const RIFT_MODIFIER_DB = new Map<string, RiftModifierDef>(\n  RIFT_MODIFIERS.map(m => [m.id, m]),\n);\n","/**\n * EDILAS (Phaser) - Rift Manager\n * Infinite procedural rift dungeon with scaling difficulty, modifiers,\n * boss/miniboss intervals, checkpoints, and instability.\n *\n * Phase 11: Rift system — endgame procedural content.\n * Phase 3 Stream F: Expanded with floor modifier system (minor/major/extreme),\n * deterministic modifier assignment, instability meter per rift, rift crystals\n * spending, and per-rift checkpoints.\n */\n\nimport {\n  RIFT_HP_SCALING,\n  RIFT_DMG_SCALING,\n  RIFT_SPEED_SCALING_INTERVAL,\n  RIFT_SPEED_SCALING,\n  RIFT_MINIBOSS_INTERVAL,\n  RIFT_BOSS_INTERVAL,\n  RIFT_CHECKPOINT_INTERVAL,\n} from '../config';\nimport { RIFT_MODIFIERS, RiftModifierDef, ModifierSeverity } from '../data/riftModifiers';\n\n// ---------------------------------------------------------------------------\n// Floor Modifier Definitions (Phase 3 Stream F)\n// ---------------------------------------------------------------------------\n\n/** Stat multipliers applied by a floor modifier to enemies. */\nexport interface FloorModifierStatMultipliers {\n  enemyHp: number;\n  enemyDmg: number;\n  enemySpeed: number;\n}\n\n/** A floor modifier definition with stat effects. */\nexport interface FloorModifierDef {\n  id: string;\n  name: string;\n  description: string;\n  severity: ModifierSeverity;\n  statMultipliers: FloorModifierStatMultipliers;\n}\n\n/** Minor floor modifiers (7). */\nexport const FLOOR_MODIFIERS_MINOR: FloorModifierDef[] = [\n  { id: 'darkness',  name: 'Darkness',  description: 'Reduced vision radius.',                       severity: 'minor', statMultipliers: { enemyHp: 1.0, enemyDmg: 1.0,  enemySpeed: 1.0  } },\n  { id: 'haste',     name: 'Haste',     description: 'Enemies move 20% faster.',                     severity: 'minor', statMultipliers: { enemyHp: 1.0, enemyDmg: 1.0,  enemySpeed: 1.2  } },\n  { id: 'armored',   name: 'Armored',   description: 'Enemies have 30% more HP.',                    severity: 'minor', statMultipliers: { enemyHp: 1.3, enemyDmg: 1.0,  enemySpeed: 1.0  } },\n  { id: 'thorns',    name: 'Thorns',    description: 'Enemies reflect damage back to attackers.',     severity: 'minor', statMultipliers: { enemyHp: 1.0, enemyDmg: 1.1,  enemySpeed: 1.0  } },\n  { id: 'regen',     name: 'Regen',     description: 'Enemies regenerate health over time.',          severity: 'minor', statMultipliers: { enemyHp: 1.15,enemyDmg: 1.0,  enemySpeed: 1.0  } },\n  { id: 'swarm',     name: 'Swarm',     description: '50% more enemies with less HP each.',           severity: 'minor', statMultipliers: { enemyHp: 0.7, enemyDmg: 1.0,  enemySpeed: 1.0  } },\n  { id: 'labyrinth', name: 'Labyrinth', description: 'More rooms and dead ends.',                     severity: 'minor', statMultipliers: { enemyHp: 1.0, enemyDmg: 1.0,  enemySpeed: 1.0  } },\n];\n\n/** Major floor modifiers (7). */\nexport const FLOOR_MODIFIERS_MAJOR: FloorModifierDef[] = [\n  { id: 'volcanic',      name: 'Volcanic',      description: 'Lava tiles spawn and deal damage.',              severity: 'major', statMultipliers: { enemyHp: 1.2,  enemyDmg: 1.2,  enemySpeed: 1.0  } },\n  { id: 'frozen',        name: 'Frozen',        description: 'Ice physics and slower movement.',               severity: 'major', statMultipliers: { enemyHp: 1.0,  enemyDmg: 1.0,  enemySpeed: 0.8  } },\n  { id: 'toxic',         name: 'Toxic',         description: 'Poison fog patches deal damage over time.',      severity: 'major', statMultipliers: { enemyHp: 1.1,  enemyDmg: 1.15, enemySpeed: 1.0  } },\n  { id: 'gravity_shift', name: 'Gravity Shift', description: 'Random gravity reversal zones.',                 severity: 'major', statMultipliers: { enemyHp: 1.0,  enemyDmg: 1.0,  enemySpeed: 1.1  } },\n  { id: 'mirror',        name: 'Mirror',        description: 'Enemies copy your weapon abilities.',            severity: 'major', statMultipliers: { enemyHp: 1.0,  enemyDmg: 1.3,  enemySpeed: 1.0  } },\n  { id: 'nightfall',     name: 'Nightfall',     description: 'No minimap, extremely limited visibility.',      severity: 'major', statMultipliers: { enemyHp: 1.0,  enemyDmg: 1.1,  enemySpeed: 1.1  } },\n  { id: 'temporal',      name: 'Temporal',      description: 'Random speed zones alter movement speed.',       severity: 'major', statMultipliers: { enemyHp: 1.0,  enemyDmg: 1.0,  enemySpeed: 1.2  } },\n];\n\n/** Extreme floor modifiers (4). */\nexport const FLOOR_MODIFIERS_EXTREME: FloorModifierDef[] = [\n  { id: 'void_rift',        name: 'Void Rift',        description: 'Random teleportation portals.',                     severity: 'extreme', statMultipliers: { enemyHp: 1.3,  enemyDmg: 1.3,  enemySpeed: 1.2  } },\n  { id: 'corruption_surge', name: 'Corruption Surge', description: 'Corruption rapidly spreads from enemies.',          severity: 'extreme', statMultipliers: { enemyHp: 1.5,  enemyDmg: 1.2,  enemySpeed: 1.0  } },\n  { id: 'boss_rush',        name: 'Boss Rush',        description: 'Mini-bosses spawn far more frequently.',            severity: 'extreme', statMultipliers: { enemyHp: 1.2,  enemyDmg: 1.5,  enemySpeed: 1.1  } },\n  { id: 'permadeath',       name: 'Permadeath',       description: 'One life. Death resets to last checkpoint.',         severity: 'extreme', statMultipliers: { enemyHp: 1.0,  enemyDmg: 1.0,  enemySpeed: 1.0  } },\n];\n\n/** All floor modifiers combined, indexed by ID for quick lookup. */\nexport const ALL_FLOOR_MODIFIERS: FloorModifierDef[] = [\n  ...FLOOR_MODIFIERS_MINOR,\n  ...FLOOR_MODIFIERS_MAJOR,\n  ...FLOOR_MODIFIERS_EXTREME,\n];\n\nexport const FLOOR_MODIFIER_DB = new Map<string, FloorModifierDef>(\n  ALL_FLOOR_MODIFIERS.map(m => [m.id, m]),\n);\n\n/** Instability fill rate: 5 units per second per floor level. */\nconst INSTABILITY_FILL_RATE = 5;\n\n/** Instability max value. */\nconst INSTABILITY_MAX = 100;\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport interface RiftFloorState {\n  floor: number;\n  modifiers: string[];\n  enemyHpMult: number;\n  enemyDmgMult: number;\n  enemySpeedMult: number;\n  instability: number;\n  isMiniboss: boolean;\n  isBoss: boolean;\n  isCheckpoint: boolean;\n}\n\n/** Per-rift instance state for tracking instability and checkpoints separately. */\ninterface RiftInstanceState {\n  instability: number;\n  checkpoint: number;\n}\n\ninterface RiftSaveData {\n  currentFloor: RiftFloorState | null;\n  highestFloor: number;\n  riftCrystals: number;\n  checkpoint: number;\n  /** Per-rift instance state (Phase 3 Stream F). */\n  riftInstances: Record<string, RiftInstanceState>;\n  /** Per-rift checkpoints (Phase 3 Stream F). */\n  riftCheckpoints: Record<string, number>;\n}\n\n// ---------------------------------------------------------------------------\n// Rift Manager\n// ---------------------------------------------------------------------------\n\n/**\n * Manages infinite rift dungeon progression. Tracks the current floor,\n * rolling modifiers, scaling multipliers, instability, checkpoints,\n * and rift crystal currency.\n */\nexport class RiftManager {\n  private currentFloor: RiftFloorState | null = null;\n  private highestFloor: number = 0;\n  private riftCrystals: number = 0;\n  private checkpoint: number = 0;\n\n  /** Per-rift instability tracking. riftId -> instability (0-100). */\n  private riftInstabilities: Map<string, number> = new Map();\n  /** Per-rift checkpoint tracking. riftId -> floor number. */\n  private riftCheckpoints: Map<string, number> = new Map();\n\n  // Callbacks\n  private floorCompleteCallbacks: Array<(floor: number, crystals: number) => void> = [];\n  private eliteWaveCallbacks: Array<(riftId: string) => void> = [];\n\n  // ---------------------------------------------------------------------------\n  // Scaling\n  // ---------------------------------------------------------------------------\n\n  /** Calculate enemy multipliers for a given floor. */\n  getScaling(floor: number): { hpMult: number; dmgMult: number; speedMult: number } {\n    return {\n      hpMult: 1 + floor * RIFT_HP_SCALING,\n      dmgMult: 1 + floor * RIFT_DMG_SCALING,\n      speedMult: 1 + Math.floor(floor / RIFT_SPEED_SCALING_INTERVAL) * RIFT_SPEED_SCALING,\n    };\n  }\n\n  // ---------------------------------------------------------------------------\n  // Modifier Rolling\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Roll modifiers for a floor. Always picks 1 minor. May add 1 major\n   * (after floor 5) and 1 extreme (after floor 15). Higher floors increase\n   * the likelihood of stronger modifiers.\n   */\n  rollModifiers(floor: number): string[] {\n    const result: string[] = [];\n\n    const pick = (severity: ModifierSeverity): string | null => {\n      const pool = RIFT_MODIFIERS.filter(\n        m => m.severity === severity && m.minFloor <= floor,\n      );\n      if (pool.length === 0) return null;\n      return pool[Math.floor(Math.random() * pool.length)].id;\n    };\n\n    // Always 1 minor\n    const minor = pick('minor');\n    if (minor) result.push(minor);\n\n    // Major: chance increases linearly from 0 at floor 1 to ~80% at floor 20+\n    if (floor >= 5) {\n      const majorChance = Math.min(0.8, (floor - 4) * 0.05);\n      if (Math.random() < majorChance) {\n        const major = pick('major');\n        if (major) result.push(major);\n      }\n    }\n\n    // Extreme: chance increases from 0 at floor 15 to ~50% at floor 40+\n    if (floor >= 15) {\n      const extremeChance = Math.min(0.5, (floor - 14) * 0.02);\n      if (Math.random() < extremeChance) {\n        const extreme = pick('extreme');\n        if (extreme) result.push(extreme);\n      }\n    }\n\n    return result;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Floor Generation\n  // ---------------------------------------------------------------------------\n\n  /** Generate the full state for a given floor number. */\n  generateFloor(floor: number): RiftFloorState {\n    const scaling = this.getScaling(floor);\n    const modifiers = this.rollModifiers(floor);\n\n    // Apply modifier effects to scaling\n    let hpMult = scaling.hpMult;\n    let dmgMult = scaling.dmgMult;\n    let speedMult = scaling.speedMult;\n\n    for (const modId of modifiers) {\n      const def = RIFT_MODIFIERS.find(m => m.id === modId);\n      if (!def) continue;\n      if (def.effects.enemyHpMult !== undefined) hpMult *= def.effects.enemyHpMult;\n      if (def.effects.enemyDamageMult !== undefined) dmgMult *= def.effects.enemyDamageMult;\n      if (def.effects.enemySpeedMult !== undefined) speedMult *= def.effects.enemySpeedMult;\n    }\n\n    return {\n      floor,\n      modifiers,\n      enemyHpMult: hpMult,\n      enemyDmgMult: dmgMult,\n      enemySpeedMult: speedMult,\n      instability: 0,\n      isMiniboss: floor > 0 && floor % RIFT_MINIBOSS_INTERVAL === 0 && floor % RIFT_BOSS_INTERVAL !== 0,\n      isBoss: floor > 0 && floor % RIFT_BOSS_INTERVAL === 0,\n      isCheckpoint: floor > 0 && floor % RIFT_CHECKPOINT_INTERVAL === 0,\n    };\n  }\n\n  // ---------------------------------------------------------------------------\n  // Rift Lifecycle\n  // ---------------------------------------------------------------------------\n\n  /** Begin the rift from floor 1 (or last checkpoint). */\n  startRift(): void {\n    const startFloor = this.checkpoint > 0 ? this.checkpoint : 1;\n    this.currentFloor = this.generateFloor(startFloor);\n  }\n\n  /** Advance to the next floor. Fires floor-complete callbacks and returns the new floor state. */\n  advanceFloor(): RiftFloorState {\n    if (this.currentFloor) {\n      const prevFloor = this.currentFloor.floor;\n\n      // Award rift crystals: base 1 + bonus for boss/miniboss\n      let crystalReward = 1;\n      if (this.currentFloor.isBoss) crystalReward += 5;\n      else if (this.currentFloor.isMiniboss) crystalReward += 2;\n\n      this.addCrystals(crystalReward);\n\n      // Fire callbacks\n      for (const cb of this.floorCompleteCallbacks) {\n        cb(prevFloor, crystalReward);\n      }\n    }\n\n    const nextFloorNum = (this.currentFloor?.floor ?? 0) + 1;\n    this.currentFloor = this.generateFloor(nextFloorNum);\n\n    // Update highest floor\n    if (nextFloorNum > this.highestFloor) {\n      this.highestFloor = nextFloorNum;\n    }\n\n    // Auto-set checkpoint on checkpoint floors\n    if (this.currentFloor.isCheckpoint) {\n      this.checkpoint = nextFloorNum;\n    }\n\n    return this.currentFloor;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Floor & Checkpoint Access\n  // ---------------------------------------------------------------------------\n\n  /** Get the current floor state, or null if the rift has not started. */\n  getCurrentFloor(): RiftFloorState | null {\n    return this.currentFloor;\n  }\n\n  /** Get the highest floor ever reached. */\n  getHighestFloor(): number {\n    return this.highestFloor;\n  }\n\n  /** Set a checkpoint at a specific floor. */\n  setCheckpoint(floor: number): void {\n    this.checkpoint = floor;\n  }\n\n  /** Get the current checkpoint floor. */\n  getCheckpoint(): number {\n    return this.checkpoint;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Rift Crystals\n  // ---------------------------------------------------------------------------\n\n  /** Get current rift crystal balance. */\n  getRiftCrystals(): number {\n    return this.riftCrystals;\n  }\n\n  /** Add rift crystals. */\n  addCrystals(amount: number): void {\n    this.riftCrystals += Math.max(0, amount);\n  }\n\n  /** Spend rift crystals. Returns false if insufficient balance. */\n  spendCrystals(amount: number): boolean {\n    if (amount < 0 || this.riftCrystals < amount) return false;\n    this.riftCrystals -= amount;\n    return true;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Instability\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Increase instability of the current floor over time. Instability rises\n   * from 0 toward 1; at 1 the floor becomes catastrophically unstable.\n   */\n  updateInstability(delta: number): void {\n    if (!this.currentFloor) return;\n    // Base instability rate: 0.01 per second, scaled by floor number\n    const rate = 0.01 * (1 + this.currentFloor.floor * 0.005);\n    this.currentFloor.instability = Math.min(1, this.currentFloor.instability + rate * delta);\n  }\n\n  /** Check if instability has reached its maximum. */\n  isInstabilityFull(): boolean {\n    return this.currentFloor !== null && this.currentFloor.instability >= 1;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Callbacks\n  // ---------------------------------------------------------------------------\n\n  /** Register a callback fired when a floor is completed. */\n  onFloorComplete(cb: (floor: number, crystals: number) => void): void {\n    this.floorCompleteCallbacks.push(cb);\n  }\n\n  /** Register a callback fired when instability reaches 100 (elite wave triggered). */\n  onEliteWave(cb: (riftId: string) => void): void {\n    this.eliteWaveCallbacks.push(cb);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Floor Modifier System (Phase 3 Stream F)\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Get the deterministic set of floor modifiers for a given floor number.\n   * Uses a seeded selection based on floor number for consistency:\n   * - Floor 1-5: 1 minor modifier\n   * - Floor 6-10: 2 minor modifiers\n   * - Floor 11-20: 1 minor + 1 major\n   * - Floor 21-50: 2 minor + 1 major\n   * - Floor 51+: 1 minor + 1 major + 1 extreme\n   * @param floor - The floor number to get modifiers for.\n   * @returns Array of modifier IDs active on the specified floor.\n   */\n  getFloorModifiers(floor: number): string[] {\n    const result: string[] = [];\n\n    // Seeded random based on floor number for deterministic selection\n    const seed = (floor * 2654435761) >>> 0; // Knuth multiplicative hash\n    const pseudoRandom = (index: number): number => {\n      const h = ((seed + index * 1013904223) * 1664525 + 1013904223) >>> 0;\n      return (h & 0x7fffffff) / 0x7fffffff;\n    };\n\n    const pickFromPool = (pool: FloorModifierDef[], seedOffset: number): string => {\n      const idx = Math.floor(pseudoRandom(seedOffset) * pool.length);\n      return pool[idx].id;\n    };\n\n    const pickMinorUnique = (exclude: string[], seedOffset: number): string => {\n      const available = FLOOR_MODIFIERS_MINOR.filter(m => !exclude.includes(m.id));\n      if (available.length === 0) return FLOOR_MODIFIERS_MINOR[0].id;\n      const idx = Math.floor(pseudoRandom(seedOffset) * available.length);\n      return available[idx].id;\n    };\n\n    if (floor >= 1 && floor <= 5) {\n      // 1 minor\n      result.push(pickFromPool(FLOOR_MODIFIERS_MINOR, 0));\n    } else if (floor >= 6 && floor <= 10) {\n      // 2 minor (unique)\n      const first = pickFromPool(FLOOR_MODIFIERS_MINOR, 0);\n      result.push(first);\n      result.push(pickMinorUnique([first], 1));\n    } else if (floor >= 11 && floor <= 20) {\n      // 1 minor + 1 major\n      result.push(pickFromPool(FLOOR_MODIFIERS_MINOR, 0));\n      result.push(pickFromPool(FLOOR_MODIFIERS_MAJOR, 1));\n    } else if (floor >= 21 && floor <= 50) {\n      // 2 minor + 1 major\n      const first = pickFromPool(FLOOR_MODIFIERS_MINOR, 0);\n      result.push(first);\n      result.push(pickMinorUnique([first], 1));\n      result.push(pickFromPool(FLOOR_MODIFIERS_MAJOR, 2));\n    } else if (floor >= 51) {\n      // 1 minor + 1 major + 1 extreme\n      result.push(pickFromPool(FLOOR_MODIFIERS_MINOR, 0));\n      result.push(pickFromPool(FLOOR_MODIFIERS_MAJOR, 1));\n      result.push(pickFromPool(FLOOR_MODIFIERS_EXTREME, 2));\n    }\n\n    return result;\n  }\n\n  /**\n   * Get a floor modifier definition by ID.\n   * @param modifierId - The modifier ID to look up.\n   */\n  getFloorModifierDef(modifierId: string): FloorModifierDef | null {\n    return FLOOR_MODIFIER_DB.get(modifierId) ?? null;\n  }\n\n  /**\n   * Calculate the combined stat multipliers for all modifiers on a floor.\n   * @param floor - The floor number.\n   * @returns Combined stat multipliers.\n   */\n  getFloorModifierMultipliers(floor: number): FloorModifierStatMultipliers {\n    const modifiers = this.getFloorModifiers(floor);\n    let enemyHp = 1.0;\n    let enemyDmg = 1.0;\n    let enemySpeed = 1.0;\n\n    for (const modId of modifiers) {\n      const def = FLOOR_MODIFIER_DB.get(modId);\n      if (!def) continue;\n      enemyHp *= def.statMultipliers.enemyHp;\n      enemyDmg *= def.statMultipliers.enemyDmg;\n      enemySpeed *= def.statMultipliers.enemySpeed;\n    }\n\n    return { enemyHp, enemyDmg, enemySpeed };\n  }\n\n  // ---------------------------------------------------------------------------\n  // Per-Rift Instability (Phase 3 Stream F)\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Get the instability level for a specific rift instance (0-100).\n   * @param riftId - The rift instance identifier.\n   * @returns Instability value from 0 to 100.\n   */\n  getInstability(riftId: string): number {\n    return this.riftInstabilities.get(riftId) ?? 0;\n  }\n\n  /**\n   * Update instability for a specific rift. Fills at 5 per second per floor level.\n   * When instability reaches 100, an elite wave is triggered.\n   * @param riftId - The rift instance identifier.\n   * @param floorLevel - The current floor level of the rift.\n   * @param deltaSec - Time elapsed in seconds.\n   */\n  updateRiftInstability(riftId: string, floorLevel: number, deltaSec: number): void {\n    const current = this.riftInstabilities.get(riftId) ?? 0;\n    const rate = INSTABILITY_FILL_RATE * floorLevel;\n    const newValue = Math.min(INSTABILITY_MAX, current + rate * deltaSec);\n\n    this.riftInstabilities.set(riftId, newValue);\n\n    // Trigger elite wave at 100\n    if (current < INSTABILITY_MAX && newValue >= INSTABILITY_MAX) {\n      for (const cb of this.eliteWaveCallbacks) {\n        cb(riftId);\n      }\n    }\n  }\n\n  /**\n   * Reset instability for a rift (e.g., after clearing an elite wave).\n   * @param riftId - The rift instance identifier.\n   */\n  resetInstability(riftId: string): void {\n    this.riftInstabilities.set(riftId, 0);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Rift Crystals (Expanded - Phase 3 Stream F)\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Add rift crystals to the player's balance (named alias for clarity).\n   * @param amount - Number of crystals to add.\n   */\n  addRiftCrystals(amount: number): void {\n    this.addCrystals(amount);\n  }\n\n  /**\n   * Spend rift crystals from the player's balance (named alias for clarity).\n   * @param amount - Number of crystals to spend.\n   * @returns `true` if the player had enough crystals and they were spent.\n   */\n  spendRiftCrystals(amount: number): boolean {\n    return this.spendCrystals(amount);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Per-Rift Checkpoints (Phase 3 Stream F)\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Set a checkpoint for a specific rift instance. Checkpoints are set every 10 floors.\n   * @param riftId - The rift instance identifier.\n   * @param floor - The floor to checkpoint at. Must be a multiple of 10.\n   */\n  setRiftCheckpoint(riftId: string, floor: number): void {\n    // Only allow checkpoints at multiples of 10\n    if (floor > 0 && floor % 10 === 0) {\n      this.riftCheckpoints.set(riftId, floor);\n    }\n  }\n\n  /**\n   * Get the checkpoint floor for a specific rift instance.\n   * @param riftId - The rift instance identifier.\n   * @returns The checkpoint floor, or 0 if none set.\n   */\n  getRiftCheckpoint(riftId: string): number {\n    return this.riftCheckpoints.get(riftId) ?? 0;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Persistence\n  // ---------------------------------------------------------------------------\n\n  /** Serialize for save. */\n  serialize(): RiftSaveData {\n    const riftInstances: Record<string, RiftInstanceState> = {};\n    for (const [riftId, instability] of this.riftInstabilities) {\n      riftInstances[riftId] = {\n        instability,\n        checkpoint: this.riftCheckpoints.get(riftId) ?? 0,\n      };\n    }\n\n    const riftCheckpoints: Record<string, number> = {};\n    for (const [riftId, floor] of this.riftCheckpoints) {\n      riftCheckpoints[riftId] = floor;\n    }\n\n    return {\n      currentFloor: this.currentFloor ? { ...this.currentFloor } : null,\n      highestFloor: this.highestFloor,\n      riftCrystals: this.riftCrystals,\n      checkpoint: this.checkpoint,\n      riftInstances,\n      riftCheckpoints,\n    };\n  }\n\n  /** Deserialize from save. */\n  deserialize(data: RiftSaveData): void {\n    this.currentFloor = data.currentFloor ? { ...data.currentFloor } : null;\n    this.highestFloor = data.highestFloor ?? 0;\n    this.riftCrystals = data.riftCrystals ?? 0;\n    this.checkpoint = data.checkpoint ?? 0;\n\n    // Restore per-rift instance states (Phase 3 Stream F)\n    this.riftInstabilities.clear();\n    this.riftCheckpoints.clear();\n\n    if (data.riftInstances) {\n      for (const [riftId, state] of Object.entries(data.riftInstances)) {\n        this.riftInstabilities.set(riftId, state.instability ?? 0);\n        if (state.checkpoint > 0) {\n          this.riftCheckpoints.set(riftId, state.checkpoint);\n        }\n      }\n    }\n\n    if (data.riftCheckpoints) {\n      for (const [riftId, floor] of Object.entries(data.riftCheckpoints)) {\n        if (!this.riftCheckpoints.has(riftId)) {\n          this.riftCheckpoints.set(riftId, floor);\n        }\n      }\n    }\n  }\n}\n","import { SettlementSiteDef, BuildingDef, RaidDef } from '../types/settlement';\n\nexport const SETTLEMENT_SITES: SettlementSiteDef[] = [\n  { id: 'haven_camp', name: 'Haven Camp', biome: 'haven', x: 50, y: 50, maxBuildings: 20, gridWidth: 10, gridHeight: 10, description: 'Your first settlement in the peaceful meadows of Haven.' },\n  { id: 'forest_haven', name: 'Forest Haven', biome: 'rotwood', x: 350, y: 150, maxBuildings: 18, gridWidth: 9, gridHeight: 9, description: 'A clearing in the Rotwood, protected by ancient trees.' },\n  { id: 'mountain_hold', name: 'Mountain Hold', biome: 'ashlands', x: 650, y: 300, maxBuildings: 16, gridWidth: 8, gridHeight: 8, description: 'A fortified position on a volcanic plateau.' },\n  { id: 'desert_outpost', name: 'Desert Outpost', biome: 'bone_wastes', x: 1200, y: 500, maxBuildings: 15, gridWidth: 8, gridHeight: 8, description: 'An oasis in the Bone Wastes, sheltered from sandstorms.' },\n  { id: 'snow_fortress', name: 'Snow Fortress', biome: 'haven', x: -100, y: -300, maxBuildings: 14, gridWidth: 7, gridHeight: 7, description: 'A frozen stronghold in the northern reaches.' },\n  { id: 'coastal_port', name: 'Coastal Port', biome: 'drowned', x: 900, y: 800, maxBuildings: 18, gridWidth: 9, gridHeight: 9, description: 'A port town built on stilts above the acidic waters.' },\n  { id: 'swamp_camp', name: 'Swamp Camp', biome: 'rotwood', x: 400, y: -200, maxBuildings: 12, gridWidth: 6, gridHeight: 6, description: 'A makeshift camp in the marshes, surrounded by mist.' },\n  { id: 'volcanic_forge', name: 'Volcanic Forge', biome: 'ashlands', x: 700, y: 100, maxBuildings: 14, gridWidth: 7, gridHeight: 7, description: 'Built around a natural lava forge, ideal for smelting.' },\n];\n\nexport const BUILDINGS: BuildingDef[] = [\n  // Production\n  { id: 'farm', name: 'Farm', category: 'production', maxTier: 3, description: 'Grows crops automatically.',\n    tiers: [\n      { cost: [{ itemId: 'wood', quantity: 20 }, { itemId: 'stone', quantity: 10 }], goldCost: 100, buildTimeMinutes: 10, production: { itemId: 'wheat', quantity: 2, intervalMinutes: 30 }, capacity: 1 },\n      { cost: [{ itemId: 'wood', quantity: 50 }, { itemId: 'iron_bar', quantity: 5 }], goldCost: 500, buildTimeMinutes: 30, production: { itemId: 'wheat', quantity: 5, intervalMinutes: 25 }, capacity: 2 },\n      { cost: [{ itemId: 'hardwood', quantity: 30 }, { itemId: 'gold_bar', quantity: 3 }], goldCost: 2000, buildTimeMinutes: 60, production: { itemId: 'wheat', quantity: 10, intervalMinutes: 20 }, capacity: 3 },\n    ] },\n  { id: 'mine', name: 'Mine', category: 'production', maxTier: 3, description: 'Extracts ore automatically.',\n    tiers: [\n      { cost: [{ itemId: 'wood', quantity: 30 }, { itemId: 'stone', quantity: 30 }], goldCost: 200, buildTimeMinutes: 15, production: { itemId: 'copper_ore', quantity: 2, intervalMinutes: 40 }, capacity: 1 },\n      { cost: [{ itemId: 'iron_bar', quantity: 10 }, { itemId: 'stone', quantity: 50 }], goldCost: 800, buildTimeMinutes: 40, production: { itemId: 'iron_ore', quantity: 3, intervalMinutes: 35 }, capacity: 2 },\n      { cost: [{ itemId: 'gold_bar', quantity: 5 }, { itemId: 'obsidian', quantity: 10 }], goldCost: 3000, buildTimeMinutes: 90, production: { itemId: 'gold_ore', quantity: 2, intervalMinutes: 30 }, capacity: 3 },\n    ] },\n  { id: 'lumber_mill', name: 'Lumber Mill', category: 'production', maxTier: 3, description: 'Produces wood automatically.',\n    tiers: [\n      { cost: [{ itemId: 'wood', quantity: 40 }, { itemId: 'stone', quantity: 15 }], goldCost: 150, buildTimeMinutes: 10, production: { itemId: 'wood', quantity: 3, intervalMinutes: 25 }, capacity: 1 },\n      { cost: [{ itemId: 'iron_bar', quantity: 8 }, { itemId: 'wood', quantity: 60 }], goldCost: 600, buildTimeMinutes: 30, production: { itemId: 'hardwood', quantity: 2, intervalMinutes: 30 }, capacity: 2 },\n      { cost: [{ itemId: 'gold_bar', quantity: 3 }, { itemId: 'hardwood', quantity: 40 }], goldCost: 2500, buildTimeMinutes: 60, production: { itemId: 'hardwood', quantity: 5, intervalMinutes: 25 }, capacity: 3 },\n    ] },\n  { id: 'workshop', name: 'Workshop', category: 'production', maxTier: 3, description: 'Crafts basic items automatically.',\n    tiers: [\n      { cost: [{ itemId: 'wood', quantity: 25 }, { itemId: 'stone', quantity: 20 }], goldCost: 200, buildTimeMinutes: 15, capacity: 1 },\n      { cost: [{ itemId: 'iron_bar', quantity: 10 }, { itemId: 'wood', quantity: 40 }], goldCost: 800, buildTimeMinutes: 40, capacity: 2 },\n      { cost: [{ itemId: 'gold_bar', quantity: 5 }, { itemId: 'hardwood', quantity: 30 }], goldCost: 3000, buildTimeMinutes: 90, capacity: 3 },\n    ] },\n  { id: 'forge', name: 'Forge', category: 'production', maxTier: 3, description: 'Smelts ore and forges equipment.',\n    tiers: [\n      { cost: [{ itemId: 'stone', quantity: 40 }, { itemId: 'copper_ore', quantity: 10 }], goldCost: 300, buildTimeMinutes: 20, capacity: 1 },\n      { cost: [{ itemId: 'iron_bar', quantity: 15 }, { itemId: 'fire_crystal', quantity: 3 }], goldCost: 1200, buildTimeMinutes: 50, capacity: 2 },\n      { cost: [{ itemId: 'obsidian', quantity: 20 }, { itemId: 'magma_iron', quantity: 10 }], goldCost: 5000, buildTimeMinutes: 120, capacity: 3 },\n    ] },\n  { id: 'alchemy_lab', name: 'Alchemy Lab', category: 'production', maxTier: 3, description: 'Brews potions and elixirs.',\n    tiers: [\n      { cost: [{ itemId: 'wood', quantity: 20 }, { itemId: 'stone', quantity: 25 }], goldCost: 250, buildTimeMinutes: 15, capacity: 1 },\n      { cost: [{ itemId: 'iron_bar', quantity: 8 }, { itemId: 'crystal', quantity: 5 }], goldCost: 1000, buildTimeMinutes: 45, capacity: 2 },\n      { cost: [{ itemId: 'void_essence', quantity: 5 }, { itemId: 'gold_bar', quantity: 8 }], goldCost: 4000, buildTimeMinutes: 100, capacity: 3 },\n    ] },\n  { id: 'kitchen', name: 'Kitchen', category: 'production', maxTier: 3, description: 'Cooks food automatically.',\n    tiers: [\n      { cost: [{ itemId: 'wood', quantity: 30 }, { itemId: 'stone', quantity: 15 }], goldCost: 150, buildTimeMinutes: 10, capacity: 1 },\n      { cost: [{ itemId: 'iron_bar', quantity: 5 }, { itemId: 'wood', quantity: 40 }], goldCost: 600, buildTimeMinutes: 30, capacity: 2 },\n      { cost: [{ itemId: 'gold_bar', quantity: 3 }, { itemId: 'hardwood', quantity: 20 }], goldCost: 2000, buildTimeMinutes: 60, capacity: 3 },\n    ] },\n  { id: 'fishing_dock', name: 'Fishing Dock', category: 'production', maxTier: 3, description: 'Catches fish automatically.',\n    tiers: [\n      { cost: [{ itemId: 'wood', quantity: 35 }, { itemId: 'fiber', quantity: 20 }], goldCost: 200, buildTimeMinutes: 12, production: { itemId: 'raw_fish', quantity: 1, intervalMinutes: 20 }, capacity: 1 },\n      { cost: [{ itemId: 'hardwood', quantity: 20 }, { itemId: 'iron_bar', quantity: 5 }], goldCost: 700, buildTimeMinutes: 35, production: { itemId: 'raw_fish', quantity: 3, intervalMinutes: 18 }, capacity: 2 },\n      { cost: [{ itemId: 'hardwood', quantity: 40 }, { itemId: 'gold_bar', quantity: 3 }], goldCost: 2500, buildTimeMinutes: 70, production: { itemId: 'raw_fish', quantity: 5, intervalMinutes: 15 }, capacity: 3 },\n    ] },\n  // Defense\n  { id: 'wall', name: 'Wall', category: 'defense', maxTier: 3, description: 'Perimeter defense.',\n    tiers: [\n      { cost: [{ itemId: 'wood', quantity: 15 }], goldCost: 50, buildTimeMinutes: 5, defense: 10 },\n      { cost: [{ itemId: 'stone', quantity: 30 }], goldCost: 200, buildTimeMinutes: 15, defense: 30 },\n      { cost: [{ itemId: 'iron_bar', quantity: 10 }], goldCost: 800, buildTimeMinutes: 30, defense: 60 },\n    ] },\n  { id: 'guard_tower', name: 'Guard Tower', category: 'defense', maxTier: 3, description: 'Ranged defense position.',\n    tiers: [\n      { cost: [{ itemId: 'wood', quantity: 25 }, { itemId: 'stone', quantity: 15 }], goldCost: 150, buildTimeMinutes: 10, defense: 20, capacity: 1 },\n      { cost: [{ itemId: 'stone', quantity: 40 }, { itemId: 'iron_bar', quantity: 5 }], goldCost: 500, buildTimeMinutes: 25, defense: 50, capacity: 2 },\n      { cost: [{ itemId: 'iron_bar', quantity: 15 }, { itemId: 'gold_bar', quantity: 2 }], goldCost: 1500, buildTimeMinutes: 50, defense: 100, capacity: 3 },\n    ] },\n  { id: 'ballista', name: 'Ballista', category: 'defense', maxTier: 3, description: 'Heavy siege defense weapon.',\n    tiers: [\n      { cost: [{ itemId: 'wood', quantity: 40 }, { itemId: 'iron_bar', quantity: 8 }], goldCost: 400, buildTimeMinutes: 20, defense: 40 },\n      { cost: [{ itemId: 'iron_bar', quantity: 20 }, { itemId: 'hardwood', quantity: 30 }], goldCost: 1200, buildTimeMinutes: 45, defense: 80 },\n      { cost: [{ itemId: 'obsidian', quantity: 15 }, { itemId: 'gold_bar', quantity: 5 }], goldCost: 4000, buildTimeMinutes: 90, defense: 150 },\n    ] },\n  { id: 'barracks', name: 'Barracks', category: 'defense', maxTier: 3, description: 'Houses garrison soldiers.',\n    tiers: [\n      { cost: [{ itemId: 'wood', quantity: 30 }, { itemId: 'stone', quantity: 20 }], goldCost: 200, buildTimeMinutes: 15, defense: 15, capacity: 2 },\n      { cost: [{ itemId: 'stone', quantity: 50 }, { itemId: 'iron_bar', quantity: 10 }], goldCost: 800, buildTimeMinutes: 40, defense: 35, capacity: 4 },\n      { cost: [{ itemId: 'iron_bar', quantity: 20 }, { itemId: 'gold_bar', quantity: 5 }], goldCost: 3000, buildTimeMinutes: 80, defense: 70, capacity: 8 },\n    ] },\n  // Civic\n  { id: 'town_hall', name: 'Town Hall', category: 'civic', maxTier: 3, description: 'Settlement center. Required for all other buildings.',\n    tiers: [\n      { cost: [{ itemId: 'wood', quantity: 50 }, { itemId: 'stone', quantity: 30 }], goldCost: 500, buildTimeMinutes: 30, capacity: 5 },\n      { cost: [{ itemId: 'hardwood', quantity: 40 }, { itemId: 'iron_bar', quantity: 15 }], goldCost: 2000, buildTimeMinutes: 60, capacity: 10 },\n      { cost: [{ itemId: 'gold_bar', quantity: 10 }, { itemId: 'obsidian', quantity: 20 }], goldCost: 8000, buildTimeMinutes: 120, capacity: 20 },\n    ] },\n  { id: 'market', name: 'Market', category: 'civic', maxTier: 3, description: 'Trade goods between settlements.',\n    tiers: [\n      { cost: [{ itemId: 'wood', quantity: 35 }, { itemId: 'stone', quantity: 20 }], goldCost: 300, buildTimeMinutes: 15 },\n      { cost: [{ itemId: 'hardwood', quantity: 25 }, { itemId: 'iron_bar', quantity: 8 }], goldCost: 1000, buildTimeMinutes: 40 },\n      { cost: [{ itemId: 'gold_bar', quantity: 5 }, { itemId: 'hardwood', quantity: 40 }], goldCost: 4000, buildTimeMinutes: 80 },\n    ] },\n  { id: 'inn', name: 'Inn', category: 'civic', maxTier: 3, description: 'Rest point and NPC happiness boost.',\n    tiers: [\n      { cost: [{ itemId: 'wood', quantity: 30 }, { itemId: 'fiber', quantity: 15 }], goldCost: 200, buildTimeMinutes: 12 },\n      { cost: [{ itemId: 'hardwood', quantity: 20 }, { itemId: 'iron_bar', quantity: 5 }], goldCost: 700, buildTimeMinutes: 30 },\n      { cost: [{ itemId: 'gold_bar', quantity: 3 }, { itemId: 'hardwood', quantity: 30 }], goldCost: 2500, buildTimeMinutes: 60 },\n    ] },\n  { id: 'library', name: 'Library', category: 'civic', maxTier: 3, description: 'Boosts XP gain for all settlers.',\n    tiers: [\n      { cost: [{ itemId: 'wood', quantity: 25 }, { itemId: 'stone', quantity: 25 }], goldCost: 300, buildTimeMinutes: 15 },\n      { cost: [{ itemId: 'hardwood', quantity: 30 }, { itemId: 'iron_bar', quantity: 8 }], goldCost: 1200, buildTimeMinutes: 40 },\n      { cost: [{ itemId: 'gold_bar', quantity: 8 }, { itemId: 'echo_crystal', quantity: 3 }], goldCost: 5000, buildTimeMinutes: 90 },\n    ] },\n  { id: 'temple', name: 'Temple', category: 'civic', maxTier: 3, description: 'Provides purification and corruption resistance.',\n    tiers: [\n      { cost: [{ itemId: 'stone', quantity: 40 }, { itemId: 'wood', quantity: 20 }], goldCost: 400, buildTimeMinutes: 20 },\n      { cost: [{ itemId: 'stone', quantity: 80 }, { itemId: 'gold_bar', quantity: 3 }], goldCost: 1500, buildTimeMinutes: 50 },\n      { cost: [{ itemId: 'void_essence', quantity: 5 }, { itemId: 'gold_bar', quantity: 10 }], goldCost: 6000, buildTimeMinutes: 120 },\n    ] },\n  { id: 'warehouse', name: 'Warehouse', category: 'civic', maxTier: 3, description: 'Stores surplus resources.',\n    tiers: [\n      { cost: [{ itemId: 'wood', quantity: 40 }, { itemId: 'stone', quantity: 10 }], goldCost: 100, buildTimeMinutes: 8, capacity: 100 },\n      { cost: [{ itemId: 'hardwood', quantity: 30 }, { itemId: 'iron_bar', quantity: 5 }], goldCost: 400, buildTimeMinutes: 20, capacity: 300 },\n      { cost: [{ itemId: 'iron_bar', quantity: 15 }, { itemId: 'hardwood', quantity: 50 }], goldCost: 1500, buildTimeMinutes: 50, capacity: 800 },\n    ] },\n];\n\nexport const RAIDS: RaidDef[] = [\n  { id: 'bandit_raid', name: 'Bandit Raid', minTier: 1, maxTier: 2, waves: [{ enemyId: 'bandit', count: 5 }, { enemyId: 'bandit_archer', count: 3 }], rewardMultiplier: 1.0 },\n  { id: 'faction_scout', name: 'Faction Scout Party', minTier: 2, maxTier: 3, waves: [{ enemyId: 'faction_scout', count: 4 }, { enemyId: 'faction_warrior', count: 4 }], rewardMultiplier: 1.5 },\n  { id: 'faction_assault', name: 'Faction Assault', minTier: 3, maxTier: 4, waves: [{ enemyId: 'faction_warrior', count: 6 }, { enemyId: 'faction_mage', count: 3 }, { enemyId: 'faction_captain', count: 1 }], rewardMultiplier: 2.0 },\n  { id: 'monster_horde', name: 'Monster Horde', minTier: 4, maxTier: 5, waves: [{ enemyId: 'horde_beast', count: 12 }, { enemyId: 'horde_alpha', count: 2 }], rewardMultiplier: 2.5 },\n  { id: 'corruption_wave', name: 'Corruption Wave', minTier: 5, maxTier: 5, waves: [{ enemyId: 'corruption_spawn', count: 8 }, { enemyId: 'corruption_elite', count: 4 }, { enemyId: 'corruption_avatar', count: 1 }], rewardMultiplier: 3.0 },\n  { id: 'void_incursion', name: 'Void Incursion', minTier: 5, maxTier: 5, waves: [{ enemyId: 'void_shade', count: 6 }, { enemyId: 'phase_stalker', count: 4 }, { enemyId: 'dimension_crawler', count: 3 }, { enemyId: 'void_lord', count: 1 }], rewardMultiplier: 4.0 },\n];\n\nexport const SETTLEMENT_SITE_DB = new Map<string, SettlementSiteDef>(SETTLEMENT_SITES.map(s => [s.id, s]));\nexport const BUILDING_DB = new Map<string, BuildingDef>(BUILDINGS.map(b => [b.id, b]));\n","/**\n * EDILAS (Phaser) - Settlement Manager\n * Colony building and management system.\n * Handles settlement founding, building placement/upgrades, NPC assignment,\n * daily production ticks, morale tracking, tier upgrades, and raid events.\n *\n * Phase 12: Settlement system.\n * Phase 3 Stream F: Expanded with 18 building types (3 tiers each),\n * worker assignment, settlement tier labels, NPC recruitment, morale calc,\n * raid defense, and trade routes.\n */\n\nimport { SETTLEMENT_SITES, BUILDINGS, SETTLEMENT_SITE_DB, BUILDING_DB } from '../data/settlements';\nimport { MAX_SETTLEMENTS, SETTLEMENT_TIERS } from '../config';\nimport { BuildingDef, SettlementSiteDef } from '../types/settlement';\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport interface BuiltBuilding {\n  typeId: string;\n  tier: number;\n  position: { x: number; y: number };\n  assignedNpcId: string | null;\n  buildTimeRemaining: number; // minutes remaining; 0 = complete\n  /** Number of generic workers assigned (separate from NPC). */\n  workersAssigned: number;\n  /** Effective production rate multiplier (base 1.0). */\n  productionRate: number;\n}\n\nexport interface Settlement {\n  id: string;\n  siteId: string;\n  name: string;\n  tier: number;\n  buildings: BuiltBuilding[];\n  assignedNpcs: string[];\n  morale: number;\n  resources: Record<string, number>;\n  lastRaidTime: number; // in-game day when last raided\n  /** NPC IDs recruited to this settlement (not necessarily assigned to buildings). */\n  recruitedNpcs: string[];\n  /** Trade route connections: other settlement IDs connected to this one. */\n  tradeRoutes: string[];\n  /** Total workers available (unassigned pool). */\n  availableWorkers: number;\n  /** Corruption proximity factor 0-1 affecting morale. */\n  corruptionProximity: number;\n}\n\n/** Result of a raid defense calculation. */\nexport interface RaidResult {\n  success: boolean;\n  defenseRating: number;\n  raidPower: number;\n  damageDealt: number;\n  buildingsDestroyed: number;\n  moraleChange: number;\n}\n\n/** Trade route between two settlements. */\nexport interface TradeRoute {\n  fromId: string;\n  toId: string;\n}\n\n/** Settlement tier label based on building count. */\nexport type SettlementTierLabel = 'Camp' | 'Village' | 'Town' | 'City' | 'Capital';\n\ninterface SettlementSaveData {\n  settlements: Settlement[];\n}\n\n// ---------------------------------------------------------------------------\n// Building Types & Costs\n// ---------------------------------------------------------------------------\n\n/** All 18 building type IDs organized by category. */\nexport const BUILDING_TYPES = {\n  production: ['farm', 'mine', 'lumber_mill', 'workshop', 'forge', 'alchemy_lab', 'kitchen', 'fishing_dock'] as const,\n  defense: ['wall', 'guard_tower', 'ballista', 'barracks'] as const,\n  civic: ['town_hall', 'market', 'inn', 'library', 'temple', 'warehouse'] as const,\n} as const;\n\n/** Cost definition for a single building tier. */\nexport interface BuildingTierCost {\n  resources: Record<string, number>;\n  gold: number;\n  buildTimeMinutes: number;\n}\n\n/**\n * Building costs organized by type and tier (1-3).\n * These are simplified costs for the expanded build/upgrade system.\n */\nexport const BUILDING_COSTS: Record<string, BuildingTierCost[]> = {\n  // Production\n  farm:         [\n    { resources: { wood: 20, stone: 10 }, gold: 100, buildTimeMinutes: 10 },\n    { resources: { wood: 50, iron_bar: 5 }, gold: 500, buildTimeMinutes: 30 },\n    { resources: { hardwood: 30, gold_bar: 3 }, gold: 2000, buildTimeMinutes: 60 },\n  ],\n  mine:         [\n    { resources: { wood: 30, stone: 30 }, gold: 200, buildTimeMinutes: 15 },\n    { resources: { iron_bar: 10, stone: 50 }, gold: 800, buildTimeMinutes: 40 },\n    { resources: { gold_bar: 5, obsidian: 10 }, gold: 3000, buildTimeMinutes: 90 },\n  ],\n  lumber_mill:  [\n    { resources: { wood: 40, stone: 15 }, gold: 150, buildTimeMinutes: 10 },\n    { resources: { iron_bar: 8, wood: 60 }, gold: 600, buildTimeMinutes: 30 },\n    { resources: { gold_bar: 3, hardwood: 40 }, gold: 2500, buildTimeMinutes: 60 },\n  ],\n  workshop:     [\n    { resources: { wood: 25, stone: 20 }, gold: 200, buildTimeMinutes: 15 },\n    { resources: { iron_bar: 10, wood: 40 }, gold: 800, buildTimeMinutes: 40 },\n    { resources: { gold_bar: 5, hardwood: 30 }, gold: 3000, buildTimeMinutes: 90 },\n  ],\n  forge:        [\n    { resources: { stone: 40, copper_ore: 10 }, gold: 300, buildTimeMinutes: 20 },\n    { resources: { iron_bar: 15, fire_crystal: 3 }, gold: 1200, buildTimeMinutes: 50 },\n    { resources: { obsidian: 20, magma_iron: 10 }, gold: 5000, buildTimeMinutes: 120 },\n  ],\n  alchemy_lab:  [\n    { resources: { wood: 20, stone: 25 }, gold: 250, buildTimeMinutes: 15 },\n    { resources: { iron_bar: 8, crystal: 5 }, gold: 1000, buildTimeMinutes: 45 },\n    { resources: { void_essence: 5, gold_bar: 8 }, gold: 4000, buildTimeMinutes: 100 },\n  ],\n  kitchen:      [\n    { resources: { wood: 30, stone: 15 }, gold: 150, buildTimeMinutes: 10 },\n    { resources: { iron_bar: 5, wood: 40 }, gold: 600, buildTimeMinutes: 30 },\n    { resources: { gold_bar: 3, hardwood: 20 }, gold: 2000, buildTimeMinutes: 60 },\n  ],\n  fishing_dock: [\n    { resources: { wood: 35, fiber: 20 }, gold: 200, buildTimeMinutes: 12 },\n    { resources: { hardwood: 20, iron_bar: 5 }, gold: 700, buildTimeMinutes: 35 },\n    { resources: { hardwood: 40, gold_bar: 3 }, gold: 2500, buildTimeMinutes: 70 },\n  ],\n  // Defense\n  wall:         [\n    { resources: { wood: 15 }, gold: 50, buildTimeMinutes: 5 },\n    { resources: { stone: 30 }, gold: 200, buildTimeMinutes: 15 },\n    { resources: { iron_bar: 10 }, gold: 800, buildTimeMinutes: 30 },\n  ],\n  guard_tower:  [\n    { resources: { wood: 25, stone: 15 }, gold: 150, buildTimeMinutes: 10 },\n    { resources: { stone: 40, iron_bar: 5 }, gold: 500, buildTimeMinutes: 25 },\n    { resources: { iron_bar: 15, gold_bar: 2 }, gold: 1500, buildTimeMinutes: 50 },\n  ],\n  ballista:     [\n    { resources: { wood: 40, iron_bar: 8 }, gold: 400, buildTimeMinutes: 20 },\n    { resources: { iron_bar: 20, hardwood: 30 }, gold: 1200, buildTimeMinutes: 45 },\n    { resources: { obsidian: 15, gold_bar: 5 }, gold: 4000, buildTimeMinutes: 90 },\n  ],\n  barracks:     [\n    { resources: { wood: 30, stone: 20 }, gold: 200, buildTimeMinutes: 15 },\n    { resources: { stone: 50, iron_bar: 10 }, gold: 800, buildTimeMinutes: 40 },\n    { resources: { iron_bar: 20, gold_bar: 5 }, gold: 3000, buildTimeMinutes: 80 },\n  ],\n  // Civic\n  town_hall:    [\n    { resources: { wood: 50, stone: 30 }, gold: 500, buildTimeMinutes: 30 },\n    { resources: { hardwood: 40, iron_bar: 15 }, gold: 2000, buildTimeMinutes: 60 },\n    { resources: { gold_bar: 10, obsidian: 20 }, gold: 8000, buildTimeMinutes: 120 },\n  ],\n  market:       [\n    { resources: { wood: 35, stone: 20 }, gold: 300, buildTimeMinutes: 15 },\n    { resources: { hardwood: 25, iron_bar: 8 }, gold: 1000, buildTimeMinutes: 40 },\n    { resources: { gold_bar: 5, hardwood: 40 }, gold: 4000, buildTimeMinutes: 80 },\n  ],\n  inn:          [\n    { resources: { wood: 30, fiber: 15 }, gold: 200, buildTimeMinutes: 12 },\n    { resources: { hardwood: 20, iron_bar: 5 }, gold: 700, buildTimeMinutes: 30 },\n    { resources: { gold_bar: 3, hardwood: 30 }, gold: 2500, buildTimeMinutes: 60 },\n  ],\n  library:      [\n    { resources: { wood: 25, stone: 25 }, gold: 300, buildTimeMinutes: 15 },\n    { resources: { hardwood: 30, iron_bar: 8 }, gold: 1200, buildTimeMinutes: 40 },\n    { resources: { gold_bar: 8, echo_crystal: 3 }, gold: 5000, buildTimeMinutes: 90 },\n  ],\n  temple:       [\n    { resources: { stone: 40, wood: 20 }, gold: 400, buildTimeMinutes: 20 },\n    { resources: { stone: 80, gold_bar: 3 }, gold: 1500, buildTimeMinutes: 50 },\n    { resources: { void_essence: 5, gold_bar: 10 }, gold: 6000, buildTimeMinutes: 120 },\n  ],\n  warehouse:    [\n    { resources: { wood: 40, stone: 10 }, gold: 100, buildTimeMinutes: 8 },\n    { resources: { hardwood: 30, iron_bar: 5 }, gold: 400, buildTimeMinutes: 20 },\n    { resources: { iron_bar: 15, hardwood: 50 }, gold: 1500, buildTimeMinutes: 50 },\n  ],\n};\n\n/** Settlement tier labels based on building count thresholds. */\nconst SETTLEMENT_TIER_THRESHOLDS: { min: number; max: number; label: SettlementTierLabel }[] = [\n  { min: 1,  max: 3,  label: 'Camp' },\n  { min: 4,  max: 7,  label: 'Village' },\n  { min: 8,  max: 12, label: 'Town' },\n  { min: 13, max: 16, label: 'City' },\n  { min: 17, max: 18, label: 'Capital' },\n];\n\n// ---------------------------------------------------------------------------\n// Settlement Manager\n// ---------------------------------------------------------------------------\n\n/**\n * Manages settlement lifecycle: founding, building placement, upgrades,\n * NPC assignment, resource production, morale, tier advancement, and raids.\n */\nexport class SettlementManager {\n  private settlements: Map<string, Settlement> = new Map();\n\n  // Callbacks\n  private raidCallbacks: Array<(settlementId: string, raidPower: number) => void> = [];\n  private buildingCompleteCallbacks: Array<(settlementId: string, buildingIndex: number) => void> = [];\n\n  // ---------------------------------------------------------------------------\n  // Founding\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Found a new settlement at a predefined site. Returns true on success.\n   * Fails if the site is invalid, already occupied, or MAX_SETTLEMENTS reached.\n   */\n  foundSettlement(siteId: string, name: string): boolean {\n    if (this.settlements.size >= MAX_SETTLEMENTS) return false;\n\n    const siteDef = SETTLEMENT_SITE_DB.get(siteId);\n    if (!siteDef) return false;\n\n    // Check if this site is already occupied\n    for (const s of this.settlements.values()) {\n      if (s.siteId === siteId) return false;\n    }\n\n    const id = `settlement_${siteId}_${Date.now()}`;\n    const settlement: Settlement = {\n      id,\n      siteId,\n      name,\n      tier: 0, // Camp\n      buildings: [],\n      assignedNpcs: [],\n      morale: 50,\n      resources: {},\n      lastRaidTime: 0,\n      recruitedNpcs: [],\n      tradeRoutes: [],\n      availableWorkers: 5,\n      corruptionProximity: 0,\n    };\n\n    this.settlements.set(id, settlement);\n    return true;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Buildings\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Place a new building (tier 0) at a position within a settlement.\n   * Returns true on success.\n   */\n  placeBuilding(settlementId: string, buildingTypeId: string, x: number, y: number): boolean {\n    const settlement = this.settlements.get(settlementId);\n    if (!settlement) return false;\n\n    const siteDef = SETTLEMENT_SITE_DB.get(settlement.siteId);\n    if (!siteDef) return false;\n\n    const buildingDef = BUILDING_DB.get(buildingTypeId);\n    if (!buildingDef) return false;\n\n    // Check building limit\n    if (settlement.buildings.length >= siteDef.maxBuildings) return false;\n\n    // Check grid bounds\n    if (x < 0 || x >= siteDef.gridWidth || y < 0 || y >= siteDef.gridHeight) return false;\n\n    // Check for overlap (no two buildings on the same tile)\n    const occupied = settlement.buildings.some(\n      b => b.position.x === x && b.position.y === y,\n    );\n    if (occupied) return false;\n\n    // Check resource costs for tier 0\n    const tierData = buildingDef.tiers[0];\n    if (!tierData) return false;\n\n    if (!this.hasResources(settlement, tierData.cost, tierData.goldCost)) return false;\n    this.deductResources(settlement, tierData.cost, tierData.goldCost);\n\n    settlement.buildings.push({\n      typeId: buildingTypeId,\n      tier: 0,\n      position: { x, y },\n      assignedNpcId: null,\n      buildTimeRemaining: tierData.buildTimeMinutes,\n      workersAssigned: 0,\n      productionRate: 1.0,\n    });\n\n    return true;\n  }\n\n  /**\n   * Upgrade an existing building to the next tier.\n   * Returns true on success.\n   */\n  upgradeBuilding(settlementId: string, buildingIndex: number): boolean {\n    const settlement = this.settlements.get(settlementId);\n    if (!settlement) return false;\n\n    const building = settlement.buildings[buildingIndex];\n    if (!building) return false;\n\n    const buildingDef = BUILDING_DB.get(building.typeId);\n    if (!buildingDef) return false;\n\n    // Check if already at max tier\n    const nextTier = building.tier + 1;\n    if (nextTier >= buildingDef.maxTier) return false;\n\n    // Must be finished building before upgrading\n    if (building.buildTimeRemaining > 0) return false;\n\n    const tierData = buildingDef.tiers[nextTier];\n    if (!tierData) return false;\n\n    if (!this.hasResources(settlement, tierData.cost, tierData.goldCost)) return false;\n    this.deductResources(settlement, tierData.cost, tierData.goldCost);\n\n    building.tier = nextTier;\n    building.buildTimeRemaining = tierData.buildTimeMinutes;\n\n    return true;\n  }\n\n  // ---------------------------------------------------------------------------\n  // NPC Assignment\n  // ---------------------------------------------------------------------------\n\n  /** Assign an NPC to a specific building within a settlement. */\n  assignNPC(settlementId: string, npcId: string, buildingIndex: number): boolean {\n    const settlement = this.settlements.get(settlementId);\n    if (!settlement) return false;\n\n    const building = settlement.buildings[buildingIndex];\n    if (!building) return false;\n\n    // Check building has capacity\n    const buildingDef = BUILDING_DB.get(building.typeId);\n    if (!buildingDef) return false;\n    const tierData = buildingDef.tiers[building.tier];\n    if (!tierData) return false;\n\n    // Only buildings with capacity can have NPCs assigned\n    if (tierData.capacity === undefined || tierData.capacity <= 0) return false;\n\n    // Check if NPC is already assigned somewhere in this settlement\n    if (settlement.assignedNpcs.includes(npcId)) return false;\n\n    // Check if building already has an assigned NPC\n    if (building.assignedNpcId !== null) return false;\n\n    building.assignedNpcId = npcId;\n    settlement.assignedNpcs.push(npcId);\n    return true;\n  }\n\n  /** Remove an NPC from their assigned building. */\n  unassignNPC(settlementId: string, npcId: string): void {\n    const settlement = this.settlements.get(settlementId);\n    if (!settlement) return;\n\n    // Remove from the building\n    for (const building of settlement.buildings) {\n      if (building.assignedNpcId === npcId) {\n        building.assignedNpcId = null;\n        break;\n      }\n    }\n\n    // Remove from the settlement's NPC list\n    const idx = settlement.assignedNpcs.indexOf(npcId);\n    if (idx >= 0) {\n      settlement.assignedNpcs.splice(idx, 1);\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Daily Tick\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Advance one in-game day for a settlement.\n   * Ticks build timers, runs production, updates morale, and checks raid timer.\n   */\n  advanceDay(settlementId: string): void {\n    const settlement = this.settlements.get(settlementId);\n    if (!settlement) return;\n\n    // Tick build timers (1 day = some amount of build-time minutes)\n    // Assume 1 in-game day = 24 build-time minutes\n    const buildMinutesPerDay = 24;\n\n    for (let i = 0; i < settlement.buildings.length; i++) {\n      const building = settlement.buildings[i];\n      if (building.buildTimeRemaining > 0) {\n        building.buildTimeRemaining = Math.max(0, building.buildTimeRemaining - buildMinutesPerDay);\n        if (building.buildTimeRemaining === 0) {\n          for (const cb of this.buildingCompleteCallbacks) {\n            cb(settlementId, i);\n          }\n        }\n      }\n    }\n\n    // Production tick\n    for (const building of settlement.buildings) {\n      if (building.buildTimeRemaining > 0) continue; // Still under construction\n\n      const buildingDef = BUILDING_DB.get(building.typeId);\n      if (!buildingDef) continue;\n      const tierData = buildingDef.tiers[building.tier];\n      if (!tierData || !tierData.production) continue;\n\n      // Production rate: base quantity per interval (in minutes)\n      // Simplified: produce 1x per day if interval <= 30, otherwise fractional\n      const production = tierData.production;\n      const dailyOutput = Math.max(1, Math.floor(production.quantity * (buildMinutesPerDay / production.intervalMinutes)));\n\n      // Bonus if NPC is assigned: +50%\n      const npcBonus = building.assignedNpcId ? 1.5 : 1.0;\n      const finalOutput = Math.floor(dailyOutput * npcBonus);\n\n      const current = settlement.resources[production.itemId] ?? 0;\n      settlement.resources[production.itemId] = current + finalOutput;\n    }\n\n    // Update morale\n    settlement.morale = this.calculateMorale(settlement);\n\n    // Check raid timer: raids can happen every 7 days after tier 1+\n    if (settlement.tier >= 1) {\n      // We don't have access to the current game day here, so use a simple counter approach\n      // External caller should track this via TimeManager; here we fire the raid callback\n      // if enough time has passed (external systems track lastRaidTime vs current day)\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Morale\n  // ---------------------------------------------------------------------------\n\n  /** Calculate morale for a settlement based on buildings, NPCs, and conditions. */\n  calculateMorale(settlement: Settlement): number {\n    let morale = 50; // base\n\n    // +5 per civic building\n    for (const building of settlement.buildings) {\n      if (building.buildTimeRemaining > 0) continue;\n      const def = BUILDING_DB.get(building.typeId);\n      if (def && def.category === 'civic') morale += 5;\n      if (def && def.category === 'production') morale += 2;\n    }\n\n    // +3 per assigned NPC (settlers feel productive)\n    morale += settlement.assignedNpcs.length * 3;\n\n    // -10 per tier (higher tiers have more maintenance concerns)\n    morale -= settlement.tier * 5;\n\n    // Clamp 0 - 100\n    return Math.max(0, Math.min(100, morale));\n  }\n\n  // ---------------------------------------------------------------------------\n  // Tier Upgrades\n  // ---------------------------------------------------------------------------\n\n  /** Check whether a settlement can upgrade to the next tier. */\n  canUpgradeTier(settlementId: string): boolean {\n    const settlement = this.settlements.get(settlementId);\n    if (!settlement) return false;\n\n    // Already at max tier\n    if (settlement.tier >= SETTLEMENT_TIERS.length - 1) return false;\n\n    // Require a minimum number of completed buildings per tier\n    const requiredBuildings = (settlement.tier + 1) * 3;\n    const completedBuildings = settlement.buildings.filter(b => b.buildTimeRemaining <= 0).length;\n    if (completedBuildings < requiredBuildings) return false;\n\n    // Require minimum morale\n    if (settlement.morale < 40) return false;\n\n    return true;\n  }\n\n  /** Upgrade settlement to the next tier. Returns true on success. */\n  upgradeTier(settlementId: string): boolean {\n    if (!this.canUpgradeTier(settlementId)) return false;\n\n    const settlement = this.settlements.get(settlementId)!;\n    settlement.tier++;\n    return true;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Queries\n  // ---------------------------------------------------------------------------\n\n  /** Get a settlement by ID, or null if not found. */\n  getSettlement(id: string): Settlement | null {\n    return this.settlements.get(id) ?? null;\n  }\n\n  /** Get all settlements. */\n  getAllSettlements(): Settlement[] {\n    return Array.from(this.settlements.values());\n  }\n\n  /** Get the display name for a settlement tier index. */\n  getSettlementTierName(tier: number): string {\n    if (tier < 0 || tier >= SETTLEMENT_TIERS.length) return 'Unknown';\n    return SETTLEMENT_TIERS[tier];\n  }\n\n  /** Get the aggregated production output for a settlement (per day). */\n  getProductionOutput(settlementId: string): { itemId: string; quantity: number }[] {\n    const settlement = this.settlements.get(settlementId);\n    if (!settlement) return [];\n\n    const output: Map<string, number> = new Map();\n    const buildMinutesPerDay = 24;\n\n    for (const building of settlement.buildings) {\n      if (building.buildTimeRemaining > 0) continue;\n\n      const buildingDef = BUILDING_DB.get(building.typeId);\n      if (!buildingDef) continue;\n      const tierData = buildingDef.tiers[building.tier];\n      if (!tierData || !tierData.production) continue;\n\n      const production = tierData.production;\n      const dailyOutput = Math.max(1, Math.floor(production.quantity * (buildMinutesPerDay / production.intervalMinutes)));\n      const npcBonus = building.assignedNpcId ? 1.5 : 1.0;\n      const finalOutput = Math.floor(dailyOutput * npcBonus);\n\n      const current = output.get(production.itemId) ?? 0;\n      output.set(production.itemId, current + finalOutput);\n    }\n\n    return Array.from(output.entries()).map(([itemId, quantity]) => ({ itemId, quantity }));\n  }\n\n  /** Get the total defense rating of a settlement. */\n  getDefenseRating(settlementId: string): number {\n    const settlement = this.settlements.get(settlementId);\n    if (!settlement) return 0;\n\n    let defense = 0;\n    for (const building of settlement.buildings) {\n      if (building.buildTimeRemaining > 0) continue;\n      const buildingDef = BUILDING_DB.get(building.typeId);\n      if (!buildingDef) continue;\n      const tierData = buildingDef.tiers[building.tier];\n      if (tierData && tierData.defense) {\n        defense += tierData.defense;\n      }\n    }\n    return defense;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Raids\n  // ---------------------------------------------------------------------------\n\n  /** Trigger a raid event on a settlement. External systems call this. */\n  triggerRaid(settlementId: string, raidPower: number): void {\n    const settlement = this.settlements.get(settlementId);\n    if (!settlement) return;\n\n    for (const cb of this.raidCallbacks) {\n      cb(settlementId, raidPower);\n    }\n  }\n\n  /** Register a callback fired when a raid occurs. */\n  onRaid(cb: (settlementId: string, raidPower: number) => void): void {\n    this.raidCallbacks.push(cb);\n  }\n\n  /** Register a callback fired when a building finishes construction. */\n  onBuildingComplete(cb: (settlementId: string, buildingIndex: number) => void): void {\n    this.buildingCompleteCallbacks.push(cb);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Expanded Building System (Phase 3 Stream F)\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Build a new building using the expanded building type system.\n   * Uses BUILDING_COSTS for cost lookup. Places at next available grid position.\n   * @param settlementId - The settlement to build in.\n   * @param buildingType - One of the 18 building type IDs.\n   * @returns `true` if the building was placed successfully.\n   */\n  buildBuilding(settlementId: string, buildingType: string): boolean {\n    const settlement = this.settlements.get(settlementId);\n    if (!settlement) return false;\n\n    const siteDef = SETTLEMENT_SITE_DB.get(settlement.siteId);\n    if (!siteDef) return false;\n\n    // Validate building type exists in BUILDING_COSTS\n    const tierCosts = BUILDING_COSTS[buildingType];\n    if (!tierCosts || tierCosts.length === 0) return false;\n\n    // Check building limit\n    if (settlement.buildings.length >= siteDef.maxBuildings) return false;\n\n    // Check tier 1 costs (index 0)\n    const cost = tierCosts[0];\n    const costItems = Object.entries(cost.resources).map(([itemId, quantity]) => ({ itemId, quantity }));\n    if (!this.hasResources(settlement, costItems, cost.gold)) return false;\n\n    // Find next available grid position\n    let placed = false;\n    let px = 0;\n    let py = 0;\n    for (let y = 0; y < siteDef.gridHeight && !placed; y++) {\n      for (let x = 0; x < siteDef.gridWidth && !placed; x++) {\n        const occupied = settlement.buildings.some(\n          b => b.position.x === x && b.position.y === y,\n        );\n        if (!occupied) {\n          px = x;\n          py = y;\n          placed = true;\n        }\n      }\n    }\n\n    if (!placed) return false;\n\n    this.deductResources(settlement, costItems, cost.gold);\n\n    settlement.buildings.push({\n      typeId: buildingType,\n      tier: 1,\n      position: { x: px, y: py },\n      assignedNpcId: null,\n      buildTimeRemaining: cost.buildTimeMinutes,\n      workersAssigned: 0,\n      productionRate: 1.0,\n    });\n\n    return true;\n  }\n\n  /**\n   * Upgrade a building to the next tier using the expanded cost system.\n   * @param settlementId - The settlement containing the building.\n   * @param buildingId - Index of the building in the settlement's building array.\n   * @returns `true` if the upgrade was successful.\n   */\n  upgradeBuildingExpanded(settlementId: string, buildingId: number): boolean {\n    const settlement = this.settlements.get(settlementId);\n    if (!settlement) return false;\n\n    const building = settlement.buildings[buildingId];\n    if (!building) return false;\n\n    // Must be finished building before upgrading\n    if (building.buildTimeRemaining > 0) return false;\n\n    // Check max tier (3 tiers total)\n    if (building.tier >= 3) return false;\n\n    const tierCosts = BUILDING_COSTS[building.typeId];\n    if (!tierCosts) return false;\n\n    const nextTierCost = tierCosts[building.tier]; // tier is 1-based, array is 0-based, so tier 1 -> index 1 for upgrade to 2\n    if (!nextTierCost) return false;\n\n    const costItems = Object.entries(nextTierCost.resources).map(([itemId, quantity]) => ({ itemId, quantity }));\n    if (!this.hasResources(settlement, costItems, nextTierCost.gold)) return false;\n\n    this.deductResources(settlement, costItems, nextTierCost.gold);\n\n    building.tier++;\n    building.buildTimeRemaining = nextTierCost.buildTimeMinutes;\n\n    return true;\n  }\n\n  /**\n   * Assign a generic worker to a building. Workers boost production rate.\n   * @param settlementId - The settlement containing the building.\n   * @param buildingId - Index of the building in the settlement's building array.\n   * @returns `true` if a worker was assigned successfully.\n   */\n  assignWorker(settlementId: string, buildingId: number): boolean {\n    const settlement = this.settlements.get(settlementId);\n    if (!settlement) return false;\n\n    const building = settlement.buildings[buildingId];\n    if (!building) return false;\n\n    // Must have available workers\n    if (settlement.availableWorkers <= 0) return false;\n\n    // Max workers per building = tier level\n    if (building.workersAssigned >= building.tier) return false;\n\n    settlement.availableWorkers--;\n    building.workersAssigned++;\n\n    // Recalculate production rate: +10% per worker\n    building.productionRate = 1.0 + building.workersAssigned * 0.1;\n\n    return true;\n  }\n\n  /**\n   * Remove a worker from a building, returning them to the available pool.\n   * @param settlementId - The settlement containing the building.\n   * @param buildingId - Index of the building in the settlement's building array.\n   * @returns `true` if a worker was removed successfully.\n   */\n  removeWorker(settlementId: string, buildingId: number): boolean {\n    const settlement = this.settlements.get(settlementId);\n    if (!settlement) return false;\n\n    const building = settlement.buildings[buildingId];\n    if (!building) return false;\n\n    if (building.workersAssigned <= 0) return false;\n\n    building.workersAssigned--;\n    settlement.availableWorkers++;\n\n    // Recalculate production rate\n    building.productionRate = 1.0 + building.workersAssigned * 0.1;\n\n    return true;\n  }\n\n  /**\n   * Get the aggregated resources produced per day for a settlement,\n   * factoring in workers and production rates.\n   * @param settlementId - The settlement to query.\n   */\n  getProduction(settlementId: string): Record<string, number> {\n    const settlement = this.settlements.get(settlementId);\n    if (!settlement) return {};\n\n    const output: Record<string, number> = {};\n    const buildMinutesPerDay = 24;\n\n    for (const building of settlement.buildings) {\n      if (building.buildTimeRemaining > 0) continue;\n\n      const buildingDef = BUILDING_DB.get(building.typeId);\n      if (!buildingDef) continue;\n\n      // Use tier index: tier is 0-based in original system, may be 1-based in expanded\n      const tierIndex = Math.min(building.tier, buildingDef.tiers.length - 1);\n      const tierData = buildingDef.tiers[tierIndex];\n      if (!tierData || !tierData.production) continue;\n\n      const production = tierData.production;\n      const dailyOutput = Math.max(1, Math.floor(production.quantity * (buildMinutesPerDay / production.intervalMinutes)));\n\n      // Apply NPC bonus + worker production rate\n      const npcBonus = building.assignedNpcId ? 1.5 : 1.0;\n      const finalOutput = Math.floor(dailyOutput * npcBonus * building.productionRate);\n\n      const current = output[production.itemId] ?? 0;\n      output[production.itemId] = current + finalOutput;\n    }\n\n    return output;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Settlement Tier (Building Count Based)\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Get the settlement tier label based on total completed building count.\n   * Camp (1-3) -> Village (4-7) -> Town (8-12) -> City (13-16) -> Capital (17-18).\n   * @param settlementId - The settlement to query.\n   */\n  getSettlementTier(settlementId: string): SettlementTierLabel {\n    const settlement = this.settlements.get(settlementId);\n    if (!settlement) return 'Camp';\n\n    const completedCount = settlement.buildings.filter(b => b.buildTimeRemaining <= 0).length;\n\n    for (const threshold of SETTLEMENT_TIER_THRESHOLDS) {\n      if (completedCount >= threshold.min && completedCount <= threshold.max) {\n        return threshold.label;\n      }\n    }\n\n    // Default: if 0 buildings or more than 18\n    if (completedCount === 0) return 'Camp';\n    return 'Capital';\n  }\n\n  // ---------------------------------------------------------------------------\n  // NPC Recruitment\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Recruit an NPC to a settlement. Recruited NPCs live in the settlement\n   * and can later be assigned to buildings.\n   * @param settlementId - The settlement to recruit to.\n   * @param npcId - The NPC to recruit.\n   * @returns `true` if the NPC was recruited successfully.\n   */\n  recruitNPC(settlementId: string, npcId: string): boolean {\n    const settlement = this.settlements.get(settlementId);\n    if (!settlement) return false;\n\n    // Check if already recruited\n    if (settlement.recruitedNpcs.includes(npcId)) return false;\n\n    settlement.recruitedNpcs.push(npcId);\n    return true;\n  }\n\n  /**\n   * Get all recruited NPCs for a settlement.\n   * @param settlementId - The settlement to query.\n   */\n  getRecruitedNPCs(settlementId: string): string[] {\n    const settlement = this.settlements.get(settlementId);\n    if (!settlement) return [];\n    return [...settlement.recruitedNpcs];\n  }\n\n  // ---------------------------------------------------------------------------\n  // Morale (Expanded)\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Get the current morale of a settlement. Morale is influenced by\n   * defense buildings, food production, building variety, and corruption proximity.\n   * @param settlementId - The settlement to query.\n   */\n  getMorale(settlementId: string): number {\n    const settlement = this.settlements.get(settlementId);\n    if (!settlement) return 0;\n\n    let morale = 50; // base\n\n    // +5 per civic building, +2 per production building, +3 per defense building\n    const categories = new Set<string>();\n    let hasFoodProduction = false;\n\n    for (const building of settlement.buildings) {\n      if (building.buildTimeRemaining > 0) continue;\n      const def = BUILDING_DB.get(building.typeId);\n      if (!def) continue;\n\n      categories.add(building.typeId);\n\n      if (def.category === 'civic') morale += 5;\n      if (def.category === 'production') morale += 2;\n      if (def.category === 'defense') morale += 3;\n\n      // Check for food-producing buildings\n      if (building.typeId === 'farm' || building.typeId === 'kitchen' || building.typeId === 'fishing_dock') {\n        hasFoodProduction = true;\n      }\n    }\n\n    // +3 per assigned NPC (settlers feel productive)\n    morale += settlement.assignedNpcs.length * 3;\n\n    // Building variety bonus: +2 per unique building type\n    morale += categories.size * 2;\n\n    // Food production bonus\n    if (hasFoodProduction) morale += 5;\n\n    // Defense presence bonus\n    const defenseRating = this.getDefenseRating(settlementId);\n    if (defenseRating > 0) morale += Math.min(10, Math.floor(defenseRating / 10));\n\n    // -10 per tier (higher tiers have more maintenance concerns)\n    morale -= settlement.tier * 5;\n\n    // Corruption proximity penalty: up to -20\n    morale -= Math.floor(settlement.corruptionProximity * 20);\n\n    // Clamp 0 - 100\n    return Math.max(0, Math.min(100, morale));\n  }\n\n  /**\n   * Set the corruption proximity factor for a settlement.\n   * @param settlementId - The settlement to update.\n   * @param proximity - Value 0-1 where 0 is no corruption nearby and 1 is heavily corrupted.\n   */\n  setCorruptionProximity(settlementId: string, proximity: number): void {\n    const settlement = this.settlements.get(settlementId);\n    if (!settlement) return;\n    settlement.corruptionProximity = Math.max(0, Math.min(1, proximity));\n  }\n\n  // ---------------------------------------------------------------------------\n  // Raid Defense (Expanded)\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Trigger a raid on a settlement and calculate the defense result.\n   * @param settlementId - The settlement being raided.\n   * @param difficulty - Raid difficulty (power level).\n   * @returns The raid result including success/failure, damage dealt, and morale impact.\n   */\n  triggerRaidExpanded(settlementId: string, difficulty: number): RaidResult {\n    const settlement = this.settlements.get(settlementId);\n    if (!settlement) {\n      return {\n        success: false, defenseRating: 0, raidPower: difficulty,\n        damageDealt: 0, buildingsDestroyed: 0, moraleChange: 0,\n      };\n    }\n\n    const defenseRating = this.getDefenseRating(settlementId);\n\n    // Defense success if defenseRating >= raidPower\n    const success = defenseRating >= difficulty;\n\n    let damageDealt = 0;\n    let buildingsDestroyed = 0;\n    let moraleChange = 0;\n\n    if (success) {\n      // Successful defense: minor morale boost\n      moraleChange = 10;\n    } else {\n      // Failed defense: calculate damage\n      const overflow = difficulty - defenseRating;\n      damageDealt = overflow;\n\n      // Each 50 overflow damage destroys a random building (max 3)\n      buildingsDestroyed = Math.min(3, Math.floor(overflow / 50));\n\n      // Remove buildings (lowest tier first)\n      if (buildingsDestroyed > 0) {\n        const destroyable = settlement.buildings\n          .map((b, i) => ({ building: b, index: i }))\n          .filter(e => e.building.buildTimeRemaining <= 0)\n          .sort((a, b) => a.building.tier - b.building.tier);\n\n        const toRemove = destroyable.slice(0, buildingsDestroyed).map(e => e.index);\n        // Remove in reverse index order to preserve indices\n        toRemove.sort((a, b) => b - a);\n        for (const idx of toRemove) {\n          const removed = settlement.buildings[idx];\n          if (removed.assignedNpcId) {\n            this.unassignNPC(settlementId, removed.assignedNpcId);\n          }\n          settlement.buildings.splice(idx, 1);\n        }\n      }\n\n      moraleChange = -(10 + buildingsDestroyed * 5);\n    }\n\n    settlement.morale = Math.max(0, Math.min(100, settlement.morale + moraleChange));\n\n    // Fire existing raid callbacks\n    for (const cb of this.raidCallbacks) {\n      cb(settlementId, difficulty);\n    }\n\n    return {\n      success,\n      defenseRating,\n      raidPower: difficulty,\n      damageDealt,\n      buildingsDestroyed,\n      moraleChange,\n    };\n  }\n\n  // ---------------------------------------------------------------------------\n  // Trade Routes\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Establish a trade route between two settlements.\n   * @param fromId - Source settlement ID.\n   * @param toId - Destination settlement ID.\n   * @returns `true` if the trade route was established.\n   */\n  establishTradeRoute(fromId: string, toId: string): boolean {\n    const fromSettlement = this.settlements.get(fromId);\n    const toSettlement = this.settlements.get(toId);\n    if (!fromSettlement || !toSettlement) return false;\n    if (fromId === toId) return false;\n\n    // Check if route already exists\n    if (fromSettlement.tradeRoutes.includes(toId)) return false;\n\n    // Both settlements must have a market building\n    const hasMarketFrom = fromSettlement.buildings.some(\n      b => b.typeId === 'market' && b.buildTimeRemaining <= 0,\n    );\n    const hasMarketTo = toSettlement.buildings.some(\n      b => b.typeId === 'market' && b.buildTimeRemaining <= 0,\n    );\n    if (!hasMarketFrom || !hasMarketTo) return false;\n\n    fromSettlement.tradeRoutes.push(toId);\n    toSettlement.tradeRoutes.push(fromId);\n\n    return true;\n  }\n\n  /**\n   * Remove a trade route between two settlements.\n   * @param fromId - Source settlement ID.\n   * @param toId - Destination settlement ID.\n   * @returns `true` if the trade route was removed.\n   */\n  removeTradeRoute(fromId: string, toId: string): boolean {\n    const fromSettlement = this.settlements.get(fromId);\n    const toSettlement = this.settlements.get(toId);\n    if (!fromSettlement || !toSettlement) return false;\n\n    const fromIdx = fromSettlement.tradeRoutes.indexOf(toId);\n    const toIdx = toSettlement.tradeRoutes.indexOf(fromId);\n\n    if (fromIdx < 0) return false;\n\n    fromSettlement.tradeRoutes.splice(fromIdx, 1);\n    if (toIdx >= 0) {\n      toSettlement.tradeRoutes.splice(toIdx, 1);\n    }\n\n    return true;\n  }\n\n  /**\n   * Get all trade routes for a settlement.\n   * @param settlementId - The settlement to query.\n   * @returns Array of connected settlement IDs.\n   */\n  getTradeRoutes(settlementId: string): string[] {\n    const settlement = this.settlements.get(settlementId);\n    if (!settlement) return [];\n    return [...settlement.tradeRoutes];\n  }\n\n  /**\n   * Get all trade routes across all settlements as TradeRoute objects.\n   * Each route appears once (deduplicated).\n   */\n  getAllTradeRoutes(): TradeRoute[] {\n    const seen = new Set<string>();\n    const routes: TradeRoute[] = [];\n\n    for (const settlement of this.settlements.values()) {\n      for (const targetId of settlement.tradeRoutes) {\n        const key = [settlement.id, targetId].sort().join('|');\n        if (!seen.has(key)) {\n          seen.add(key);\n          routes.push({ fromId: settlement.id, toId: targetId });\n        }\n      }\n    }\n\n    return routes;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Internal Helpers\n  // ---------------------------------------------------------------------------\n\n  /** Check if a settlement has enough resources for a cost. */\n  private hasResources(settlement: Settlement, costs: { itemId: string; quantity: number }[], goldCost: number): boolean {\n    for (const cost of costs) {\n      const available = settlement.resources[cost.itemId] ?? 0;\n      if (available < cost.quantity) return false;\n    }\n    const gold = settlement.resources['gold'] ?? 0;\n    if (gold < goldCost) return false;\n    return true;\n  }\n\n  /** Deduct resources from a settlement. */\n  private deductResources(settlement: Settlement, costs: { itemId: string; quantity: number }[], goldCost: number): void {\n    for (const cost of costs) {\n      const current = settlement.resources[cost.itemId] ?? 0;\n      settlement.resources[cost.itemId] = current - cost.quantity;\n    }\n    const gold = settlement.resources['gold'] ?? 0;\n    settlement.resources['gold'] = gold - goldCost;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Persistence\n  // ---------------------------------------------------------------------------\n\n  /** Serialize for save. */\n  serialize(): SettlementSaveData {\n    const settlements: Settlement[] = [];\n    for (const s of this.settlements.values()) {\n      settlements.push({\n        ...s,\n        buildings: s.buildings.map(b => ({\n          ...b,\n          position: { ...b.position },\n          workersAssigned: b.workersAssigned ?? 0,\n          productionRate: b.productionRate ?? 1.0,\n        })),\n        assignedNpcs: [...s.assignedNpcs],\n        resources: { ...s.resources },\n        recruitedNpcs: [...(s.recruitedNpcs ?? [])],\n        tradeRoutes: [...(s.tradeRoutes ?? [])],\n        availableWorkers: s.availableWorkers ?? 5,\n        corruptionProximity: s.corruptionProximity ?? 0,\n      });\n    }\n    return { settlements };\n  }\n\n  /** Deserialize from save. */\n  deserialize(data: SettlementSaveData): void {\n    this.settlements.clear();\n\n    if (data.settlements) {\n      for (const s of data.settlements) {\n        this.settlements.set(s.id, {\n          ...s,\n          buildings: s.buildings.map(b => ({\n            ...b,\n            position: { ...b.position },\n            workersAssigned: (b as BuiltBuilding).workersAssigned ?? 0,\n            productionRate: (b as BuiltBuilding).productionRate ?? 1.0,\n          })),\n          assignedNpcs: [...s.assignedNpcs],\n          resources: { ...s.resources },\n          recruitedNpcs: [...((s as Settlement).recruitedNpcs ?? [])],\n          tradeRoutes: [...((s as Settlement).tradeRoutes ?? [])],\n          availableWorkers: (s as Settlement).availableWorkers ?? 5,\n          corruptionProximity: (s as Settlement).corruptionProximity ?? 0,\n        });\n      }\n    }\n  }\n}\n","export interface FactionDef {\n  id: string;\n  name: string;\n  biome: string;\n  description: string;\n  color: number;\n  enemyTypes: string[];\n  tactics: string[];\n  leaderId: string;\n  leaderName: string;\n  territory: { centerX: number; centerY: number; radius: number };\n  hostility: number; // 0-1, base hostility toward player\n}\n\nexport const FACTIONS: FactionDef[] = [\n  {\n    id: 'rotwood_cult', name: 'Rotwood Cult', biome: 'rotwood',\n    description: 'Fungal druids who worship the corruption as a gift. They spread spores and poison to \"enlighten\" the world.',\n    color: 0x44aa22,\n    enemyTypes: ['cult_druid', 'spore_warrior', 'fungal_beast', 'poison_archer'],\n    tactics: ['poison_cloud', 'spore_trap', 'fungal_minion_summon', 'terrain_corruption'],\n    leaderId: 'archdruid_mycelium', leaderName: 'Archdruid Mycelium',\n    territory: { centerX: 350, centerY: 200, radius: 150 },\n    hostility: 0.6,\n  },\n  {\n    id: 'ashlands_legion', name: 'Ashlands Legion', biome: 'ashlands',\n    description: 'Fire warriors who forge weapons in volcanic heat. They believe strength through fire purifies weakness.',\n    color: 0xff4400,\n    enemyTypes: ['legion_soldier', 'fire_mage', 'siege_engineer', 'flame_berserker'],\n    tactics: ['fire_barrage', 'siege_weapon', 'shield_wall', 'scorched_earth'],\n    leaderId: 'warlord_ignatius', leaderName: 'Warlord Ignatius',\n    territory: { centerX: 650, centerY: 400, radius: 180 },\n    hostility: 0.7,\n  },\n  {\n    id: 'drowned_court', name: 'Drowned Court', biome: 'drowned',\n    description: 'Aquatic sorcerers from sunken civilizations. They command tides and seek to flood the surface world.',\n    color: 0x0088cc,\n    enemyTypes: ['court_sorcerer', 'tide_guardian', 'water_elemental', 'siren'],\n    tactics: ['flooding', 'whirlpool_trap', 'water_barrier', 'siren_call'],\n    leaderId: 'queen_abyssia', leaderName: 'Queen Abyssia',\n    territory: { centerX: 950, centerY: 900, radius: 160 },\n    hostility: 0.5,\n  },\n  {\n    id: 'bone_covenant', name: 'Bone Covenant', biome: 'bone_wastes',\n    description: 'An undead army led by necromancers. They raise the bones of fallen titans to bolster their numbers endlessly.',\n    color: 0xccbb88,\n    enemyTypes: ['skeleton_soldier', 'necromancer', 'bone_golem', 'death_knight'],\n    tactics: ['undead_swarm', 'necromancy_revive', 'bone_cage', 'death_curse'],\n    leaderId: 'lich_king_osteros', leaderName: 'Lich King Osteros',\n    territory: { centerX: 1250, centerY: 600, radius: 200 },\n    hostility: 0.8,\n  },\n  {\n    id: 'void_collective', name: 'Void Collective', biome: 'the_void',\n    description: 'Reality-bending elites who have merged with the void. Unpredictable and terrifyingly powerful.',\n    color: 0x8800cc,\n    enemyTypes: ['void_acolyte', 'reality_bender', 'phase_assassin', 'void_titan'],\n    tactics: ['dimension_swap', 'reality_tear', 'phase_shift', 'mind_break'],\n    leaderId: 'the_architect', leaderName: 'The Architect',\n    territory: { centerX: 1550, centerY: 300, radius: 170 },\n    hostility: 0.9,\n  },\n];\n\nexport const FACTION_DB = new Map<string, FactionDef>(FACTIONS.map(f => [f.id, f]));\n","/**\n * EDILAS (Phaser) - Faction Manager\n * Faction territory control and AI expansion.\n * Tracks per-chunk influence for each faction, determines dominant factions,\n * handles territory expansion / contraction, leader state, and inter-faction conflict.\n *\n * Phase 13: Faction system.\n * Phase 3 Stream F: Expanded with territory control per chunk key,\n * faction evolution (adaptive resistances), inter-faction conflict simulation,\n * weekly events, and named faction leaders with 7-day respawn.\n */\n\nimport { FACTIONS, FactionDef, FACTION_DB } from '../data/factions';\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport interface FactionEvent {\n  type: string;\n  factionId: string;\n  details: string;\n}\n\ninterface FactionLeaderState {\n  alive: boolean;\n  respawnTimer: number; // days until respawn; 0 = alive or permanently dead\n}\n\n/** Damage types that factions can develop resistance to. */\nexport type DamageType = 'fire' | 'ice' | 'lightning' | 'poison' | 'physical' | 'void' | 'holy';\n\n/** All recognized damage types. */\nexport const DAMAGE_TYPES: DamageType[] = ['fire', 'ice', 'lightning', 'poison', 'physical', 'void', 'holy'];\n\n/** Faction leader information. */\nexport interface FactionLeaderInfo {\n  factionId: string;\n  name: string;\n  alive: boolean;\n  respawnDaysRemaining: number;\n}\n\n/** Weekly event generated by the faction system. */\nexport interface FactionWeeklyEvent {\n  type: 'push' | 'war' | 'siege';\n  factions: string[];\n  location: string;\n}\n\n/** Faction conflict result. */\nexport interface FactionConflictResult {\n  winner: string;\n  loser: string;\n  influenceShift: number;\n}\n\ninterface FactionSaveData {\n  influence: Record<string, Record<string, number>>; // factionId -> chunkKey -> influence\n  leaders: Record<string, FactionLeaderState>;\n  /** Per-faction resistance tracking (Phase 3 Stream F). */\n  resistances: Record<string, Record<string, number>>;\n  /** Player attack behavior tracking (Phase 3 Stream F). */\n  playerBehavior: Record<string, number>;\n}\n\n// ---------------------------------------------------------------------------\n// Faction Manager\n// ---------------------------------------------------------------------------\n\n/**\n * Manages faction territories through per-chunk influence values (0-100).\n * Provides AI expansion logic, leader state tracking, and inter-faction\n * conflict resolution.\n */\nexport class FactionManager {\n  /** factionId -> (chunkKey -> influence 0-100) */\n  private influence: Map<string, Map<string, number>> = new Map();\n  /** factionId -> leader alive/respawn state */\n  private leaders: Map<string, FactionLeaderState> = new Map();\n\n  /** factionId -> (damageType -> resistance 0-1). Phase 3 Stream F. */\n  private resistances: Map<string, Map<string, number>> = new Map();\n  /** Tracks how many times the player uses each attack type. Phase 3 Stream F. */\n  private playerBehavior: Map<string, number> = new Map();\n\n  // Callbacks\n  private factionEventCallbacks: Array<(event: FactionEvent) => void> = [];\n\n  constructor() {\n    // Initialize default leader states\n    for (const faction of FACTIONS) {\n      this.leaders.set(faction.id, { alive: true, respawnTimer: 0 });\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Helpers\n  // ---------------------------------------------------------------------------\n\n  private static chunkKey(chunkX: number, chunkY: number): string {\n    return `${chunkX},${chunkY}`;\n  }\n\n  private static parseChunkKey(key: string): { cx: number; cy: number } {\n    const [cx, cy] = key.split(',').map(Number);\n    return { cx, cy };\n  }\n\n  /** Get or create a faction's influence map. */\n  private ensureFaction(factionId: string): Map<string, number> {\n    let map = this.influence.get(factionId);\n    if (!map) {\n      map = new Map();\n      this.influence.set(factionId, map);\n    }\n    return map;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Influence Access\n  // ---------------------------------------------------------------------------\n\n  /** Get the influence of a faction in a specific chunk (0-100). */\n  getInfluence(factionId: string, chunkX: number, chunkY: number): number {\n    const map = this.influence.get(factionId);\n    if (!map) return 0;\n    return map.get(FactionManager.chunkKey(chunkX, chunkY)) ?? 0;\n  }\n\n  /** Set the influence of a faction in a specific chunk (clamped 0-100). */\n  setInfluence(factionId: string, chunkX: number, chunkY: number, value: number): void {\n    const map = this.ensureFaction(factionId);\n    const key = FactionManager.chunkKey(chunkX, chunkY);\n    const clamped = Math.max(0, Math.min(100, value));\n    if (clamped <= 0) {\n      map.delete(key);\n    } else {\n      map.set(key, clamped);\n    }\n  }\n\n  /**\n   * Get the dominant faction in a chunk (the one with the highest influence).\n   * Returns null if no faction has influence > 0 in that chunk.\n   */\n  getDominantFaction(chunkX: number, chunkY: number): string | null {\n    let bestId: string | null = null;\n    let bestValue = 0;\n\n    for (const [factionId, map] of this.influence) {\n      const value = map.get(FactionManager.chunkKey(chunkX, chunkY)) ?? 0;\n      if (value > bestValue) {\n        bestValue = value;\n        bestId = factionId;\n      }\n    }\n\n    return bestId;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Territory Expansion / Reduction\n  // ---------------------------------------------------------------------------\n\n  /**\n   * AI expansion: a faction spreads influence to chunks adjacent to its\n   * existing territory. Only expands if the leader is alive.\n   */\n  expandTerritory(factionId: string): void {\n    const leaderState = this.leaders.get(factionId);\n    if (!leaderState || !leaderState.alive) return;\n\n    const map = this.influence.get(factionId);\n    if (!map) return;\n\n    const expansionTargets: Map<string, number> = new Map();\n\n    for (const [key, value] of map) {\n      if (value < 20) continue; // Only strong tiles can expand\n\n      const { cx, cy } = FactionManager.parseChunkKey(key);\n      const neighbors: [number, number][] = [\n        [cx - 1, cy], [cx + 1, cy],\n        [cx, cy - 1], [cx, cy + 1],\n      ];\n\n      for (const [nx, ny] of neighbors) {\n        const nKey = FactionManager.chunkKey(nx, ny);\n        const existing = map.get(nKey) ?? 0;\n        if (existing < 100) {\n          // Spread rate: 5 base, scaled by source tile strength\n          const spread = Math.min(5, value * 0.1);\n          const currentTarget = expansionTargets.get(nKey) ?? existing;\n          expansionTargets.set(nKey, Math.min(100, currentTarget + spread));\n        }\n      }\n    }\n\n    // Apply expansion\n    for (const [key, value] of expansionTargets) {\n      map.set(key, value);\n    }\n  }\n\n  /** Player clears an outpost: reduce a faction's influence in a chunk. */\n  reduceInfluence(factionId: string, chunkX: number, chunkY: number, amount: number): void {\n    const map = this.influence.get(factionId);\n    if (!map) return;\n\n    const key = FactionManager.chunkKey(chunkX, chunkY);\n    const current = map.get(key) ?? 0;\n    const newValue = Math.max(0, current - amount);\n\n    if (newValue <= 0) {\n      map.delete(key);\n    } else {\n      map.set(key, newValue);\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Leader State\n  // ---------------------------------------------------------------------------\n\n  /** Check if a faction's leader is alive. */\n  isLeaderAlive(factionId: string): boolean {\n    return this.leaders.get(factionId)?.alive ?? false;\n  }\n\n  /** Kill a faction's leader. Weakens expansion and triggers an event. */\n  killLeader(factionId: string): void {\n    const state = this.leaders.get(factionId);\n    if (!state || !state.alive) return;\n\n    state.alive = false;\n    state.respawnTimer = 14; // 14 in-game days to respawn\n\n    this.emitEvent({\n      type: 'leader_killed',\n      factionId,\n      details: `The leader of ${FACTION_DB.get(factionId)?.name ?? factionId} has been slain!`,\n    });\n  }\n\n  /** Respawn a faction's leader immediately. */\n  respawnLeader(factionId: string): void {\n    const state = this.leaders.get(factionId);\n    if (!state) return;\n\n    state.alive = true;\n    state.respawnTimer = 0;\n\n    this.emitEvent({\n      type: 'leader_respawn',\n      factionId,\n      details: `The leader of ${FACTION_DB.get(factionId)?.name ?? factionId} has returned!`,\n    });\n  }\n\n  // ---------------------------------------------------------------------------\n  // Queries\n  // ---------------------------------------------------------------------------\n\n  /** Get IDs of all factions that currently hold at least one chunk. */\n  getActiveFactions(): string[] {\n    const result: string[] = [];\n    for (const [factionId, map] of this.influence) {\n      if (map.size > 0) result.push(factionId);\n    }\n    return result;\n  }\n\n  /** Get the number of chunks a faction controls (influence > 50). */\n  getTerritoryCount(factionId: string): number {\n    const map = this.influence.get(factionId);\n    if (!map) return 0;\n\n    let count = 0;\n    for (const value of map.values()) {\n      if (value > 50) count++;\n    }\n    return count;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Weekly Tick\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Called once per in-game week. Handles:\n   * - Faction territory expansion (AI)\n   * - Inter-faction conflict (opposing factions reduce each other's influence)\n   * - Leader respawn timers\n   */\n  advanceWeek(): void {\n    // Tick leader respawn timers (7 days per week)\n    for (const [factionId, state] of this.leaders) {\n      if (!state.alive && state.respawnTimer > 0) {\n        state.respawnTimer = Math.max(0, state.respawnTimer - 7);\n        if (state.respawnTimer <= 0) {\n          this.respawnLeader(factionId);\n        }\n      }\n    }\n\n    // Expand territories\n    for (const faction of FACTIONS) {\n      this.expandTerritory(faction.id);\n    }\n\n    // Inter-faction conflict: where two factions share a chunk,\n    // the weaker one loses influence proportional to the difference\n    const allChunks = new Set<string>();\n    for (const map of this.influence.values()) {\n      for (const key of map.keys()) {\n        allChunks.add(key);\n      }\n    }\n\n    for (const chunkKey of allChunks) {\n      const factionValues: { factionId: string; value: number }[] = [];\n      for (const [factionId, map] of this.influence) {\n        const val = map.get(chunkKey);\n        if (val !== undefined && val > 0) {\n          factionValues.push({ factionId, value: val });\n        }\n      }\n\n      if (factionValues.length < 2) continue;\n\n      // Sort strongest first\n      factionValues.sort((a, b) => b.value - a.value);\n      const strongest = factionValues[0];\n\n      // All weaker factions lose influence\n      for (let i = 1; i < factionValues.length; i++) {\n        const weaker = factionValues[i];\n        const loss = Math.min(weaker.value, (strongest.value - weaker.value) * 0.2);\n        const map = this.influence.get(weaker.factionId)!;\n        const newVal = weaker.value - loss;\n        if (newVal <= 0) {\n          map.delete(chunkKey);\n        } else {\n          map.set(chunkKey, newVal);\n        }\n      }\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Callbacks\n  // ---------------------------------------------------------------------------\n\n  /** Register a callback fired on faction events (leader death, respawn, conflict, etc.). */\n  onFactionEvent(cb: (event: FactionEvent) => void): void {\n    this.factionEventCallbacks.push(cb);\n  }\n\n  private emitEvent(event: FactionEvent): void {\n    for (const cb of this.factionEventCallbacks) {\n      cb(event);\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Territory Control per Chunk Key (Phase 3 Stream F)\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Set a faction's influence in a chunk using a string chunk key.\n   * @param chunkKey - The chunk key (e.g., \"5,3\").\n   * @param factionId - The faction to set influence for.\n   * @param influence - The influence value (clamped 0-100).\n   */\n  setFactionInfluence(chunkKey: string, factionId: string, influence: number): void {\n    const map = this.ensureFaction(factionId);\n    const clamped = Math.max(0, Math.min(100, influence));\n    if (clamped <= 0) {\n      map.delete(chunkKey);\n    } else {\n      map.set(chunkKey, clamped);\n    }\n  }\n\n  /**\n   * Get all faction influences for a specific chunk.\n   * @param chunkKey - The chunk key (e.g., \"5,3\").\n   * @returns A record mapping faction IDs to their influence values in that chunk.\n   */\n  getFactionInfluence(chunkKey: string): Record<string, number> {\n    const result: Record<string, number> = {};\n    for (const [factionId, map] of this.influence) {\n      const value = map.get(chunkKey);\n      if (value !== undefined && value > 0) {\n        result[factionId] = value;\n      }\n    }\n    return result;\n  }\n\n  /**\n   * Get the dominant faction in a chunk using a string chunk key.\n   * Returns the faction with the highest influence, or null if none.\n   * @param chunkKey - The chunk key (e.g., \"5,3\").\n   */\n  getDominantFactionByKey(chunkKey: string): string | null {\n    let bestId: string | null = null;\n    let bestValue = 0;\n\n    for (const [factionId, map] of this.influence) {\n      const value = map.get(chunkKey) ?? 0;\n      if (value > bestValue) {\n        bestValue = value;\n        bestId = factionId;\n      }\n    }\n\n    return bestId;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Faction Evolution / Adaptive Resistance (Phase 3 Stream F)\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Record a player attack type. Over time, factions develop resistance\n   * to the player's most-used damage types.\n   * @param attackType - The damage type used (e.g., 'fire', 'ice').\n   */\n  recordPlayerBehavior(attackType: string): void {\n    const current = this.playerBehavior.get(attackType) ?? 0;\n    this.playerBehavior.set(attackType, current + 1);\n  }\n\n  /**\n   * Update faction resistances based on accumulated player behavior.\n   * Should be called periodically (e.g., weekly). Factions develop resistance\n   * proportional to how often the player uses a given attack type.\n   */\n  updateFactionResistances(): void {\n    // Calculate total attacks\n    let totalAttacks = 0;\n    for (const count of this.playerBehavior.values()) {\n      totalAttacks += count;\n    }\n    if (totalAttacks === 0) return;\n\n    // For each attack type, if it represents > 30% of attacks, factions develop resistance\n    for (const [attackType, count] of this.playerBehavior) {\n      const ratio = count / totalAttacks;\n      if (ratio < 0.3) continue;\n\n      // Resistance scales with usage: max 0.5 resistance at 100% usage\n      const resistanceGain = Math.min(0.05, ratio * 0.1);\n\n      for (const faction of FACTIONS) {\n        const factionResMap = this.ensureResistances(faction.id);\n        const current = factionResMap.get(attackType) ?? 0;\n        factionResMap.set(attackType, Math.min(1.0, current + resistanceGain));\n      }\n    }\n  }\n\n  /**\n   * Get a faction's resistance to a specific damage type.\n   * @param factionId - The faction to query.\n   * @param damageType - The damage type.\n   * @returns Resistance multiplier from 0 (no resistance) to 1 (full immunity).\n   */\n  getFactionResistance(factionId: string, damageType: string): number {\n    const map = this.resistances.get(factionId);\n    if (!map) return 0;\n    return map.get(damageType) ?? 0;\n  }\n\n  /**\n   * Get all resistances for a faction.\n   * @param factionId - The faction to query.\n   */\n  getAllFactionResistances(factionId: string): Record<string, number> {\n    const map = this.resistances.get(factionId);\n    if (!map) return {};\n    const result: Record<string, number> = {};\n    for (const [key, value] of map) {\n      result[key] = value;\n    }\n    return result;\n  }\n\n  /** Ensure a faction has a resistance map. */\n  private ensureResistances(factionId: string): Map<string, number> {\n    let map = this.resistances.get(factionId);\n    if (!map) {\n      map = new Map();\n      this.resistances.set(factionId, map);\n    }\n    return map;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Inter-Faction Conflict (Phase 3 Stream F)\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Simulate a conflict between two factions and determine the winner.\n   * Winner is determined by territory count, leader alive status, and a\n   * random factor.\n   * @param faction1 - First faction ID.\n   * @param faction2 - Second faction ID.\n   * @returns The conflict result including winner, loser, and influence shift.\n   */\n  simulateFactionConflict(faction1: string, faction2: string): FactionConflictResult {\n    // Calculate power for each faction\n    const power1 = this.calculateFactionPower(faction1);\n    const power2 = this.calculateFactionPower(faction2);\n\n    // Add randomness (±20%)\n    const roll1 = power1 * (0.8 + Math.random() * 0.4);\n    const roll2 = power2 * (0.8 + Math.random() * 0.4);\n\n    const winner = roll1 >= roll2 ? faction1 : faction2;\n    const loser = winner === faction1 ? faction2 : faction1;\n\n    // Influence shift: winner gains, loser loses in contested chunks\n    const influenceShift = Math.floor(Math.abs(roll1 - roll2) * 0.5) + 5;\n\n    // Apply: in chunks where both have influence, shift toward winner\n    const loserMap = this.influence.get(loser);\n    const winnerMap = this.ensureFaction(winner);\n\n    if (loserMap) {\n      const contestedChunks: string[] = [];\n      for (const key of loserMap.keys()) {\n        if (winnerMap.has(key)) {\n          contestedChunks.push(key);\n        }\n      }\n\n      for (const key of contestedChunks) {\n        const loserVal = loserMap.get(key) ?? 0;\n        const winnerVal = winnerMap.get(key) ?? 0;\n\n        const newLoserVal = Math.max(0, loserVal - influenceShift);\n        const newWinnerVal = Math.min(100, winnerVal + Math.floor(influenceShift * 0.5));\n\n        if (newLoserVal <= 0) {\n          loserMap.delete(key);\n        } else {\n          loserMap.set(key, newLoserVal);\n        }\n        winnerMap.set(key, newWinnerVal);\n      }\n    }\n\n    this.emitEvent({\n      type: 'faction_conflict',\n      factionId: winner,\n      details: `${FACTION_DB.get(winner)?.name ?? winner} defeated ${FACTION_DB.get(loser)?.name ?? loser} in territorial conflict!`,\n    });\n\n    return { winner, loser, influenceShift };\n  }\n\n  /** Calculate the overall power of a faction. */\n  private calculateFactionPower(factionId: string): number {\n    let power = 0;\n\n    // Territory count contributes to power\n    power += this.getTerritoryCount(factionId) * 10;\n\n    // Leader alive bonus\n    if (this.isLeaderAlive(factionId)) {\n      power += 50;\n    }\n\n    // Total influence contributes\n    const map = this.influence.get(factionId);\n    if (map) {\n      for (const value of map.values()) {\n        power += value * 0.1;\n      }\n    }\n\n    return power;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Weekly Events (Phase 3 Stream F)\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Generate a random weekly event involving factions.\n   * @returns A weekly event with type, involved factions, and location.\n   */\n  generateWeeklyEvent(): FactionWeeklyEvent {\n    const activeFactions = this.getActiveFactions();\n    const eventTypes: Array<'push' | 'war' | 'siege'> = ['push', 'war', 'siege'];\n\n    // Pick a random event type\n    const type = eventTypes[Math.floor(Math.random() * eventTypes.length)];\n\n    // Pick involved factions (1-2 factions)\n    let factions: string[];\n    if (activeFactions.length >= 2 && (type === 'war' || type === 'siege')) {\n      // Pick two different factions\n      const idx1 = Math.floor(Math.random() * activeFactions.length);\n      let idx2 = Math.floor(Math.random() * (activeFactions.length - 1));\n      if (idx2 >= idx1) idx2++;\n      factions = [activeFactions[idx1], activeFactions[idx2]];\n    } else if (activeFactions.length >= 1) {\n      factions = [activeFactions[Math.floor(Math.random() * activeFactions.length)]];\n    } else {\n      // Fallback to a known faction\n      factions = [FACTIONS[0].id];\n    }\n\n    // Determine location from a contested chunk or random territory\n    let location = '0,0';\n    if (factions.length >= 2) {\n      // Find a contested chunk between the two factions\n      const map1 = this.influence.get(factions[0]);\n      const map2 = this.influence.get(factions[1]);\n      if (map1 && map2) {\n        for (const key of map1.keys()) {\n          if (map2.has(key)) {\n            location = key;\n            break;\n          }\n        }\n      }\n    } else {\n      // Pick a random chunk from the faction's territory\n      const map = this.influence.get(factions[0]);\n      if (map && map.size > 0) {\n        const keys = Array.from(map.keys());\n        location = keys[Math.floor(Math.random() * keys.length)];\n      }\n    }\n\n    this.emitEvent({\n      type: `weekly_${type}`,\n      factionId: factions[0],\n      details: `Weekly event: ${type} involving ${factions.map(f => FACTION_DB.get(f)?.name ?? f).join(' vs ')} at ${location}`,\n    });\n\n    return { type, factions, location };\n  }\n\n  // ---------------------------------------------------------------------------\n  // Named Faction Leaders (Phase 3 Stream F)\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Get detailed information about a faction's leader.\n   * @param factionId - The faction to query.\n   * @returns Leader info including name, alive status, and respawn timer.\n   */\n  getFactionLeader(factionId: string): FactionLeaderInfo | null {\n    const factionDef = FACTION_DB.get(factionId);\n    if (!factionDef) return null;\n\n    const leaderState = this.leaders.get(factionId);\n    if (!leaderState) return null;\n\n    return {\n      factionId,\n      name: factionDef.leaderName,\n      alive: leaderState.alive,\n      respawnDaysRemaining: leaderState.respawnTimer,\n    };\n  }\n\n  /**\n   * Defeat a faction's leader. Sets the leader to dead with a 7-day respawn timer.\n   * Different from killLeader which uses 14 days — this uses the Phase 3 Stream F\n   * 7-day respawn mechanic.\n   * @param factionId - The faction whose leader to defeat.\n   * @returns `true` if the leader was alive and is now defeated.\n   */\n  defeatFactionLeader(factionId: string): boolean {\n    const state = this.leaders.get(factionId);\n    if (!state || !state.alive) return false;\n\n    state.alive = false;\n    state.respawnTimer = 7; // 7 in-game days to respawn (Phase 3 Stream F)\n\n    this.emitEvent({\n      type: 'leader_defeated',\n      factionId,\n      details: `${FACTION_DB.get(factionId)?.leaderName ?? 'The leader'} of ${FACTION_DB.get(factionId)?.name ?? factionId} has been defeated! They will return in 7 days.`,\n    });\n\n    return true;\n  }\n\n  /**\n   * Get all faction leaders with their info.\n   * @returns Array of all faction leader infos.\n   */\n  getAllFactionLeaders(): FactionLeaderInfo[] {\n    const leaders: FactionLeaderInfo[] = [];\n    for (const faction of FACTIONS) {\n      const info = this.getFactionLeader(faction.id);\n      if (info) leaders.push(info);\n    }\n    return leaders;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Persistence\n  // ---------------------------------------------------------------------------\n\n  /** Serialize for save. */\n  serialize(): FactionSaveData {\n    const influence: Record<string, Record<string, number>> = {};\n    for (const [factionId, map] of this.influence) {\n      const chunks: Record<string, number> = {};\n      for (const [key, value] of map) {\n        chunks[key] = value;\n      }\n      influence[factionId] = chunks;\n    }\n\n    const leaders: Record<string, FactionLeaderState> = {};\n    for (const [factionId, state] of this.leaders) {\n      leaders[factionId] = { ...state };\n    }\n\n    // Serialize resistances (Phase 3 Stream F)\n    const resistances: Record<string, Record<string, number>> = {};\n    for (const [factionId, map] of this.resistances) {\n      const res: Record<string, number> = {};\n      for (const [key, value] of map) {\n        res[key] = value;\n      }\n      resistances[factionId] = res;\n    }\n\n    // Serialize player behavior (Phase 3 Stream F)\n    const playerBehavior: Record<string, number> = {};\n    for (const [key, value] of this.playerBehavior) {\n      playerBehavior[key] = value;\n    }\n\n    return { influence, leaders, resistances, playerBehavior };\n  }\n\n  /** Deserialize from save. */\n  deserialize(data: FactionSaveData): void {\n    this.influence.clear();\n    this.leaders.clear();\n    this.resistances.clear();\n    this.playerBehavior.clear();\n\n    if (data.influence) {\n      for (const [factionId, chunks] of Object.entries(data.influence)) {\n        const map = new Map<string, number>();\n        for (const [key, value] of Object.entries(chunks)) {\n          map.set(key, value);\n        }\n        this.influence.set(factionId, map);\n      }\n    }\n\n    if (data.leaders) {\n      for (const [factionId, state] of Object.entries(data.leaders)) {\n        this.leaders.set(factionId, { ...state });\n      }\n    }\n\n    // Ensure all known factions have leader state\n    for (const faction of FACTIONS) {\n      if (!this.leaders.has(faction.id)) {\n        this.leaders.set(faction.id, { alive: true, respawnTimer: 0 });\n      }\n    }\n\n    // Restore resistances (Phase 3 Stream F)\n    if (data.resistances) {\n      for (const [factionId, res] of Object.entries(data.resistances)) {\n        const map = new Map<string, number>();\n        for (const [key, value] of Object.entries(res)) {\n          map.set(key, value);\n        }\n        this.resistances.set(factionId, map);\n      }\n    }\n\n    // Restore player behavior (Phase 3 Stream F)\n    if (data.playerBehavior) {\n      for (const [key, value] of Object.entries(data.playerBehavior)) {\n        this.playerBehavior.set(key, value);\n      }\n    }\n  }\n}\n","export interface TitanPhaseDef {\n  hpThreshold: number;\n  abilities: string[];\n  speed: number;\n  damageMult: number;\n  description: string;\n}\n\nexport interface TitanDef {\n  id: string;\n  name: string;\n  title: string;\n  biome: string;\n  hp: number;\n  damage: number;\n  defense: number;\n  phases: TitanPhaseDef[];\n  patrolPath: { x: number; y: number }[];\n  preparationItems: { itemId: string; quantity: number; description: string }[];\n  drops: { itemId: string; chance: number; minQty: number; maxQty: number }[];\n  uniqueAbilityUnlock: string;\n  respawnDays: number;\n  statScalePerKill: number;\n  xpReward: number;\n}\n\nexport const TITANS: TitanDef[] = [\n  {\n    id: 'mossback_behemoth', name: 'Mossback Behemoth', title: 'The Forest Shaper',\n    biome: 'rotwood', hp: 15000, damage: 120, defense: 80,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['tree_throw', 'vine_slam', 'root_cage'], speed: 30, damageMult: 1.0, description: 'Hurls trees and slams with massive vines' },\n      { hpThreshold: 0.6, abilities: ['tree_throw', 'vine_slam', 'root_cage', 'forest_regeneration'], speed: 35, damageMult: 1.3, description: 'Begins regenerating health from nearby trees' },\n      { hpThreshold: 0.3, abilities: ['tree_throw', 'vine_slam', 'root_cage', 'forest_regeneration', 'nature_wrath'], speed: 40, damageMult: 1.8, description: 'Enters a frenzy, the entire forest attacks' },\n    ],\n    patrolPath: [{ x: 250, y: 100 }, { x: 400, y: 200 }, { x: 350, y: 350 }, { x: 200, y: 250 }],\n    preparationItems: [\n      { itemId: 'fire_trap', quantity: 5, description: 'Burn away regenerating roots' },\n      { itemId: 'anti_regen_poison', quantity: 3, description: 'Stop forest regeneration phase' },\n    ],\n    drops: [\n      { itemId: 'titan_heartwood', chance: 1.0, minQty: 1, maxQty: 1 },\n      { itemId: 'behemoth_bark', chance: 1.0, minQty: 3, maxQty: 5 },\n      { itemId: 'ancient_seed', chance: 0.5, minQty: 1, maxQty: 1 },\n    ],\n    uniqueAbilityUnlock: 'natures_grasp',\n    respawnDays: 7, statScalePerKill: 0.1, xpReward: 5000,\n  },\n  {\n    id: 'magma_colossus', name: 'Magma Colossus', title: 'The Mountain Walker',\n    biome: 'ashlands', hp: 20000, damage: 150, defense: 120,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['lava_trail', 'magma_fist', 'eruption'], speed: 20, damageMult: 1.0, description: 'Leaves lava in its wake, punches with molten fists' },\n      { hpThreshold: 0.5, abilities: ['lava_trail', 'magma_fist', 'eruption', 'terrain_melt'], speed: 25, damageMult: 1.5, description: 'Melts the terrain around it, creating lava pools' },\n      { hpThreshold: 0.2, abilities: ['lava_trail', 'magma_fist', 'eruption', 'terrain_melt', 'volcanic_explosion'], speed: 30, damageMult: 2.0, description: 'Triggers volcanic explosions across the battlefield' },\n    ],\n    patrolPath: [{ x: 550, y: 200 }, { x: 700, y: 350 }, { x: 750, y: 500 }, { x: 600, y: 400 }],\n    preparationItems: [\n      { itemId: 'frost_bomb', quantity: 5, description: 'Cool and harden lava trails' },\n      { itemId: 'fire_resistance_potion', quantity: 3, description: 'Survive volcanic explosions' },\n    ],\n    drops: [\n      { itemId: 'titan_magma_core', chance: 1.0, minQty: 1, maxQty: 1 },\n      { itemId: 'colossus_plate', chance: 1.0, minQty: 2, maxQty: 4 },\n      { itemId: 'eternal_ember', chance: 0.3, minQty: 1, maxQty: 1 },\n    ],\n    uniqueAbilityUnlock: 'molten_armor',\n    respawnDays: 7, statScalePerKill: 0.1, xpReward: 7000,\n  },\n  {\n    id: 'leviathan', name: 'Leviathan', title: 'The Deep Terror',\n    biome: 'drowned', hp: 18000, damage: 140, defense: 90,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['tidal_wave', 'tentacle_slam', 'whirlpool'], speed: 35, damageMult: 1.0, description: 'Controls the water, creating waves and whirlpools' },\n      { hpThreshold: 0.5, abilities: ['tidal_wave', 'tentacle_slam', 'whirlpool', 'swallow_attack'], speed: 40, damageMult: 1.4, description: 'Attempts to swallow the player whole' },\n      { hpThreshold: 0.2, abilities: ['tidal_wave', 'tentacle_slam', 'whirlpool', 'swallow_attack', 'tsunami'], speed: 45, damageMult: 1.8, description: 'Summons a massive tsunami that reshapes the coast' },\n    ],\n    patrolPath: [{ x: 850, y: 700 }, { x: 1000, y: 850 }, { x: 950, y: 1000 }, { x: 800, y: 900 }],\n    preparationItems: [\n      { itemId: 'lightning_harpoon', quantity: 4, description: 'Electrify the water around the Leviathan' },\n      { itemId: 'breathing_apparatus', quantity: 1, description: 'Survive being swallowed' },\n    ],\n    drops: [\n      { itemId: 'titan_pearl', chance: 1.0, minQty: 1, maxQty: 1 },\n      { itemId: 'leviathan_scale', chance: 1.0, minQty: 3, maxQty: 6 },\n      { itemId: 'abyssal_trident_fragment', chance: 0.4, minQty: 1, maxQty: 1 },\n    ],\n    uniqueAbilityUnlock: 'tidal_force',\n    respawnDays: 7, statScalePerKill: 0.1, xpReward: 6000,\n  },\n  {\n    id: 'bone_emperor', name: 'Bone Emperor', title: 'The Undying Sovereign',\n    biome: 'bone_wastes', hp: 22000, damage: 130, defense: 100,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['army_summon', 'bone_cage', 'death_beam'], speed: 25, damageMult: 1.0, description: 'Raises armies of skeletons and imprisons foes in bone cages' },\n      { hpThreshold: 0.5, abilities: ['army_summon', 'bone_cage', 'death_beam', 'sandstorm'], speed: 30, damageMult: 1.3, description: 'Conjures a sandstorm that blinds and damages' },\n      { hpThreshold: 0.2, abilities: ['army_summon', 'bone_cage', 'death_beam', 'sandstorm', 'titan_resurrection'], speed: 35, damageMult: 2.0, description: 'Resurrects fallen titan bones as weapons' },\n    ],\n    patrolPath: [{ x: 1100, y: 400 }, { x: 1300, y: 550 }, { x: 1350, y: 700 }, { x: 1150, y: 600 }],\n    preparationItems: [\n      { itemId: 'holy_water', quantity: 5, description: 'Destroy summoned undead instantly' },\n      { itemId: 'binding_rune', quantity: 3, description: 'Prevent titan resurrection phase' },\n    ],\n    drops: [\n      { itemId: 'titan_crown_shard', chance: 1.0, minQty: 1, maxQty: 1 },\n      { itemId: 'emperor_bone', chance: 1.0, minQty: 3, maxQty: 5 },\n      { itemId: 'necromancer_staff_fragment', chance: 0.35, minQty: 1, maxQty: 1 },\n    ],\n    uniqueAbilityUnlock: 'death_sovereign',\n    respawnDays: 7, statScalePerKill: 0.1, xpReward: 8000,\n  },\n  {\n    id: 'void_hydra', name: 'Void Hydra', title: 'The Reality Shatterer',\n    biome: 'the_void', hp: 25000, damage: 180, defense: 110,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['portal_breath', 'head_slam', 'dimension_tear'], speed: 30, damageMult: 1.0, description: 'Multi-headed attacks through portals from multiple dimensions' },\n      { hpThreshold: 0.5, abilities: ['portal_breath', 'head_slam', 'dimension_tear', 'head_regeneration'], speed: 35, damageMult: 1.5, description: 'Cut off heads grow back stronger — must kill all at once' },\n      { hpThreshold: 0.2, abilities: ['portal_breath', 'head_slam', 'dimension_tear', 'head_regeneration', 'reality_shatter'], speed: 40, damageMult: 2.5, description: 'Shatters reality itself, creating a chaotic arena' },\n    ],\n    patrolPath: [{ x: 1450, y: 200 }, { x: 1600, y: 350 }, { x: 1650, y: 150 }, { x: 1500, y: 300 }],\n    preparationItems: [\n      { itemId: 'reality_anchor', quantity: 3, description: 'Stabilize reality during the final phase' },\n      { itemId: 'void_bane', quantity: 5, description: 'Prevent head regeneration temporarily' },\n    ],\n    drops: [\n      { itemId: 'titan_void_heart', chance: 1.0, minQty: 1, maxQty: 1 },\n      { itemId: 'hydra_fang', chance: 1.0, minQty: 4, maxQty: 7 },\n      { itemId: 'dimension_key', chance: 0.25, minQty: 1, maxQty: 1 },\n    ],\n    uniqueAbilityUnlock: 'void_step',\n    respawnDays: 7, statScalePerKill: 0.1, xpReward: 10000,\n  },\n];\n\nexport const TITAN_DB = new Map<string, TitanDef>(TITANS.map(t => [t.id, t]));\n","/**\n * EDILAS (Phaser) - Titan Manager\n * Roaming mega-boss management.\n * Handles titan patrol movement, trap preparation, weakened state,\n * defeat/respawn cycle, scaled stats per kill, and visibility checks.\n *\n * Phase 13: Titan system.\n */\n\nimport { TITANS, TitanDef, TITAN_DB } from '../data/titans';\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport interface TitanState {\n  id: string;\n  alive: boolean;\n  currentX: number;\n  currentY: number;\n  patrolIndex: number;\n  killCount: number;\n  respawnTimer: number; // days remaining; 0 = alive\n  weakened: boolean;\n  trapsSet: number;\n}\n\ninterface TitanSaveData {\n  titans: TitanState[];\n}\n\n// ---------------------------------------------------------------------------\n// Constants\n// ---------------------------------------------------------------------------\n\n/** Number of traps required to weaken a titan. */\nconst TRAPS_TO_WEAKEN = 3;\n\n/** Weakened titan stat debuff multiplier. */\nconst WEAKENED_STAT_MULT = 0.7;\n\n/** Stat escalation per kill. */\nconst STAT_SCALE_PER_KILL = 0.1;\n\n/** Patrol movement speed in world units per second. */\nconst PATROL_SPEED = 15;\n\n// ---------------------------------------------------------------------------\n// Titan Manager\n// ---------------------------------------------------------------------------\n\n/**\n * Manages roaming titans: patrol movement along predefined paths,\n * trap placement / weakening, defeat / respawn lifecycle, stat scaling\n * per kill count, and player-visibility queries.\n */\nexport class TitanManager {\n  private titans: Map<string, TitanState> = new Map();\n\n  // Callbacks\n  private onTitanDefeatedCallbacks: Array<(titanId: string, killCount: number) => void> = [];\n  private onTitanSpottedCallbacks: Array<(titanId: string) => void> = [];\n\n  constructor() {\n    // Initialize state for each titan definition\n    for (const def of TITANS) {\n      const startPos = def.patrolPath[0] ?? { x: 0, y: 0 };\n      this.titans.set(def.id, {\n        id: def.id,\n        alive: true,\n        currentX: startPos.x,\n        currentY: startPos.y,\n        patrolIndex: 0,\n        killCount: 0,\n        respawnTimer: 0,\n        weakened: false,\n        trapsSet: 0,\n      });\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Update Loop\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Called every frame. Moves living titans along their patrol paths\n   * and ticks respawn timers for dead titans.\n   *\n   * @param delta Time since last frame in seconds.\n   */\n  update(delta: number): void {\n    for (const state of this.titans.values()) {\n      if (!state.alive) {\n        // Respawn timer ticks are handled by advanceDay, not per-frame\n        continue;\n      }\n\n      const def = TITAN_DB.get(state.id);\n      if (!def || def.patrolPath.length < 2) continue;\n\n      // Move toward the next patrol waypoint\n      const target = def.patrolPath[state.patrolIndex];\n      const dx = target.x - state.currentX;\n      const dy = target.y - state.currentY;\n      const dist = Math.sqrt(dx * dx + dy * dy);\n\n      if (dist < 2) {\n        // Reached waypoint — advance to next\n        state.patrolIndex = (state.patrolIndex + 1) % def.patrolPath.length;\n      } else {\n        const moveDistance = PATROL_SPEED * delta;\n        const ratio = Math.min(1, moveDistance / dist);\n        state.currentX += dx * ratio;\n        state.currentY += dy * ratio;\n      }\n    }\n  }\n\n  /**\n   * Advance one in-game day. Ticks respawn timers for dead titans.\n   * Call this from the day-change event.\n   */\n  advanceDay(): void {\n    for (const state of this.titans.values()) {\n      if (!state.alive && state.respawnTimer > 0) {\n        state.respawnTimer--;\n        if (state.respawnTimer <= 0) {\n          this.respawnTitan(state.id);\n        }\n      }\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Queries\n  // ---------------------------------------------------------------------------\n\n  /** Get the state of a titan, or null if the ID is invalid. */\n  getTitanState(titanId: string): TitanState | null {\n    return this.titans.get(titanId) ?? null;\n  }\n\n  /** Get all titan states. */\n  getAllTitans(): TitanState[] {\n    return Array.from(this.titans.values());\n  }\n\n  /**\n   * Get titans that are alive and within view range of the player.\n   * Also fires onTitanSpotted callbacks for each visible titan.\n   */\n  getVisibleTitans(playerX: number, playerY: number, viewRange: number): TitanState[] {\n    const result: TitanState[] = [];\n    const rangeSq = viewRange * viewRange;\n\n    for (const state of this.titans.values()) {\n      if (!state.alive) continue;\n      const dx = state.currentX - playerX;\n      const dy = state.currentY - playerY;\n      if (dx * dx + dy * dy <= rangeSq) {\n        result.push(state);\n        for (const cb of this.onTitanSpottedCallbacks) {\n          cb(state.id);\n        }\n      }\n    }\n\n    return result;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Traps & Weakening\n  // ---------------------------------------------------------------------------\n\n  /** Set a trap for a titan. Increments the trap count. */\n  setTrap(titanId: string): void {\n    const state = this.titans.get(titanId);\n    if (!state || !state.alive) return;\n\n    state.trapsSet++;\n\n    if (state.trapsSet >= TRAPS_TO_WEAKEN) {\n      state.weakened = true;\n    }\n  }\n\n  /** Check if a titan has been weakened by enough traps. */\n  isWeakened(titanId: string): boolean {\n    return this.titans.get(titanId)?.weakened ?? false;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Defeat & Respawn\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Defeat a titan. Kills it, starts the respawn timer, increments kill\n   * count, and fires the onTitanDefeated callbacks.\n   */\n  defeatTitan(titanId: string): void {\n    const state = this.titans.get(titanId);\n    if (!state || !state.alive) return;\n\n    const def = TITAN_DB.get(titanId);\n\n    state.alive = false;\n    state.killCount++;\n    state.respawnTimer = def?.respawnDays ?? 7;\n    state.weakened = false;\n    state.trapsSet = 0;\n\n    for (const cb of this.onTitanDefeatedCallbacks) {\n      cb(titanId, state.killCount);\n    }\n  }\n\n  /**\n   * Respawn a titan at the start of its patrol path.\n   * Resets weakened/traps state but preserves kill count.\n   */\n  private respawnTitan(titanId: string): void {\n    const state = this.titans.get(titanId);\n    if (!state) return;\n\n    const def = TITAN_DB.get(titanId);\n    const startPos = def?.patrolPath[0] ?? { x: 0, y: 0 };\n\n    state.alive = true;\n    state.currentX = startPos.x;\n    state.currentY = startPos.y;\n    state.patrolIndex = 0;\n    state.respawnTimer = 0;\n    state.weakened = false;\n    state.trapsSet = 0;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Stat Scaling\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Get the scaled combat stats for a titan, accounting for kill count\n   * (each kill increases stats by statScalePerKill from the TitanDef, defaulting\n   * to STAT_SCALE_PER_KILL) and weakened state.\n   */\n  getScaledStats(titanId: string): { hp: number; damage: number; defense: number } {\n    const state = this.titans.get(titanId);\n    const def = TITAN_DB.get(titanId);\n\n    if (!state || !def) return { hp: 0, damage: 0, defense: 0 };\n\n    const scalePerKill = def.statScalePerKill ?? STAT_SCALE_PER_KILL;\n    const killMult = 1 + state.killCount * scalePerKill;\n    const weakMult = state.weakened ? WEAKENED_STAT_MULT : 1;\n\n    return {\n      hp: Math.round(def.hp * killMult * weakMult),\n      damage: Math.round(def.damage * killMult * weakMult),\n      defense: Math.round(def.defense * killMult * weakMult),\n    };\n  }\n\n  // ---------------------------------------------------------------------------\n  // Callbacks\n  // ---------------------------------------------------------------------------\n\n  /** Register a callback fired when a titan is defeated. */\n  onTitanDefeated(cb: (titanId: string, killCount: number) => void): void {\n    this.onTitanDefeatedCallbacks.push(cb);\n  }\n\n  /** Register a callback fired when a titan enters the player's view range. */\n  onTitanSpotted(cb: (titanId: string) => void): void {\n    this.onTitanSpottedCallbacks.push(cb);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Persistence\n  // ---------------------------------------------------------------------------\n\n  /** Serialize for save. */\n  serialize(): TitanSaveData {\n    const titans: TitanState[] = [];\n    for (const state of this.titans.values()) {\n      titans.push({ ...state });\n    }\n    return { titans };\n  }\n\n  /** Deserialize from save. */\n  deserialize(data: TitanSaveData): void {\n    this.titans.clear();\n\n    if (data.titans) {\n      for (const state of data.titans) {\n        this.titans.set(state.id, { ...state });\n      }\n    }\n\n    // Ensure all known titans have state (handles new titans added after save)\n    for (const def of TITANS) {\n      if (!this.titans.has(def.id)) {\n        const startPos = def.patrolPath[0] ?? { x: 0, y: 0 };\n        this.titans.set(def.id, {\n          id: def.id,\n          alive: true,\n          currentX: startPos.x,\n          currentY: startPos.y,\n          patrolIndex: 0,\n          killCount: 0,\n          respawnTimer: 0,\n          weakened: false,\n          trapsSet: 0,\n        });\n      }\n    }\n  }\n}\n","import { BiomeDataDef } from '../types/world';\n\nexport const BIOMES: BiomeDataDef[] = [\n  {\n    id: 'haven', name: 'Haven',\n    description: 'Peaceful meadows and gentle hills. A safe tutorial zone where the pilgrimage begins.',\n    distanceRange: [0, 200],\n    palette: { grass: '#4a7c3f', dirt: '#8b6914', stone: '#888888', water: '#2266aa', accent: '#7dd3fc' },\n    enemyTypes: ['forest_slime', 'wild_boar', 'angry_bee', 'field_rat'],\n    levelRange: [1, 5],\n    resources: ['wood', 'stone', 'copper_ore', 'fiber', 'wild_berries'],\n    hazards: [],\n    weather: { clear: 40, cloudy: 25, rain: 20, fog: 10, storm: 5 },\n    temperature: { base: 20, variance: 5 },\n    music: 'haven_theme',\n    gateBoss: 'harvest_horror',\n    difficultyMultiplier: 1.0,\n    corruptionRate: 0.0001,\n  },\n  {\n    id: 'rotwood', name: 'Rotwood',\n    description: 'Dense corrupted forest choked with fungi and poison fog. The corruption first took root here.',\n    distanceRange: [200, 500],\n    palette: { grass: '#2d4a2d', dirt: '#4a3520', stone: '#555544', water: '#336644', accent: '#88cc44' },\n    enemyTypes: ['rot_spider', 'fungal_crawler', 'poison_moth', 'corrupted_treant', 'spore_bat'],\n    levelRange: [5, 12],\n    resources: ['dark_wood', 'iron_ore', 'mushroom_cluster', 'spider_silk', 'toxic_sap'],\n    hazards: [{ type: 'poison_fog', damage: 2, interval: 3 }],\n    weather: { cloudy: 30, rain: 25, fog: 25, spore_cloud: 15, storm: 5 },\n    temperature: { base: 15, variance: 3 },\n    music: 'rotwood_theme',\n    gateBoss: 'blight_mother',\n    difficultyMultiplier: 1.3,\n    corruptionRate: 0.0005,\n  },\n  {\n    id: 'ashlands', name: 'Ashlands',\n    description: 'Volcanic wasteland of lava rivers and ember rain. Heat distorts the air, and the ground cracks beneath your feet.',\n    distanceRange: [500, 800],\n    palette: { grass: '#5a3a2a', dirt: '#3a2010', stone: '#555555', water: '#ff4400', accent: '#ff8844' },\n    enemyTypes: ['fire_imp', 'lava_golem', 'ash_wraith', 'magma_beetle', 'flame_serpent'],\n    levelRange: [12, 20],\n    resources: ['obsidian', 'fire_crystal', 'volcanic_ash', 'magma_iron', 'ember_dust'],\n    hazards: [{ type: 'ember_rain', damage: 3, interval: 5 }, { type: 'lava', damage: 15, interval: 1 }],\n    weather: { clear: 20, cloudy: 15, ember_rain: 35, storm: 15, fog: 15 },\n    temperature: { base: 45, variance: 10 },\n    music: 'ashlands_theme',\n    gateBoss: 'stone_titan',\n    difficultyMultiplier: 1.7,\n    corruptionRate: 0.0008,\n  },\n  {\n    id: 'drowned', name: 'Drowned Depths',\n    description: 'Flooded ruins submerged in acid water, lit by bioluminescent growths. Ancient civilizations rest below.',\n    distanceRange: [800, 1100],\n    palette: { grass: '#2a4a5a', dirt: '#1a3040', stone: '#3a5060', water: '#00cc88', accent: '#44ffcc' },\n    enemyTypes: ['drowned_ghoul', 'acid_jellyfish', 'coral_golem', 'deep_lurker', 'tide_witch'],\n    levelRange: [20, 28],\n    resources: ['abyssal_pearl', 'coral_chunk', 'bioluminescent_algae', 'waterlogged_wood', 'deep_iron'],\n    hazards: [{ type: 'acid_water', damage: 5, interval: 2 }, { type: 'flooding', damage: 0, interval: 30 }],\n    weather: { rain: 35, storm: 20, acid_rain: 20, fog: 15, cloudy: 10 },\n    temperature: { base: 10, variance: 3 },\n    music: 'drowned_theme',\n    gateBoss: 'kraken',\n    difficultyMultiplier: 2.0,\n    corruptionRate: 0.001,\n  },\n  {\n    id: 'bone_wastes', name: 'Bone Wastes',\n    description: 'Skeletal desert where sandstorms rage and mirages deceive. The bones of titans litter the landscape.',\n    distanceRange: [1100, 1400],\n    palette: { grass: '#dbc07c', dirt: '#aa9060', stone: '#ccbbaa', water: '#887744', accent: '#ffe4b5' },\n    enemyTypes: ['bone_warrior', 'sand_scorpion', 'mirage_phantom', 'dust_devil', 'skeletal_archer'],\n    levelRange: [28, 36],\n    resources: ['ancient_bone', 'gold_ore', 'desert_crystal', 'sun_stone', 'titan_bone_fragment'],\n    hazards: [{ type: 'sandstorm', damage: 4, interval: 3 }, { type: 'heat', damage: 2, interval: 5 }],\n    weather: { clear: 25, sandstorm: 35, cloudy: 15, fog: 10, storm: 15 },\n    temperature: { base: 40, variance: 15 },\n    music: 'bone_wastes_theme',\n    gateBoss: 'sand_wyrm',\n    difficultyMultiplier: 2.5,\n    corruptionRate: 0.0015,\n  },\n  {\n    id: 'the_void', name: 'The Void',\n    description: 'Reality breaks down here. Floating islands, gravity shifts, and things that should not exist. The barrier between worlds is thin.',\n    distanceRange: [1400, 1700],\n    palette: { grass: '#220033', dirt: '#110022', stone: '#332244', water: '#6600cc', accent: '#cc44ff' },\n    enemyTypes: ['void_shade', 'reality_tear', 'phase_stalker', 'echo_wraith', 'dimension_crawler'],\n    levelRange: [36, 44],\n    resources: ['void_essence', 'reality_shard', 'echo_crystal', 'nightmare_dust', 'phantom_silk'],\n    hazards: [{ type: 'void_tear', damage: 8, interval: 4 }, { type: 'gravity_shift', damage: 0, interval: 10 }],\n    weather: { void_storm: 40, fog: 20, clear: 15, storm: 15, cloudy: 10 },\n    temperature: { base: -10, variance: 30 },\n    music: 'void_theme',\n    gateBoss: 'void_weaver',\n    difficultyMultiplier: 3.0,\n    corruptionRate: 0.003,\n  },\n  {\n    id: 'edilas', name: 'EDILAS',\n    description: 'The living land itself. Terrain reacts to the player, the ground breathes, and the corruption source pulses at its heart.',\n    distanceRange: [1700, Infinity],\n    palette: { grass: '#1a0022', dirt: '#0a0011', stone: '#221133', water: '#8800ff', accent: '#ff00ff' },\n    enemyTypes: ['living_terrain', 'corruption_avatar', 'world_serpent_spawn', 'edilas_guardian', 'reality_anchor'],\n    levelRange: [44, 50],\n    resources: ['edilas_heartstone', 'living_metal', 'corruption_crystal', 'world_thread', 'primordial_essence'],\n    hazards: [{ type: 'corruption_surge', damage: 10, interval: 3 }, { type: 'terrain_shift', damage: 5, interval: 8 }],\n    weather: { void_storm: 50, corruption_storm: 30, fog: 10, clear: 10 },\n    temperature: { base: 0, variance: 50 },\n    music: 'edilas_theme',\n    gateBoss: 'world_serpent',\n    difficultyMultiplier: 3.5,\n    corruptionRate: 0.005,\n  },\n];\n\nexport const BIOME_DB = new Map<string, BiomeDataDef>(BIOMES.map(b => [b.id, b]));\n","/**\n * EDILAS (Phaser) - Weather Manager\n * Biome-specific weather system with transitions, visibility effects,\n * temperature modifiers, and forced weather overrides.\n *\n * Phase 14 (independent): Weather system.\n */\n\nimport { BIOMES, BIOME_DB } from '../data/biomes';\nimport { BiomeDataDef } from '../types/world';\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport interface WeatherState {\n  type: string;\n  intensity: number;        // 0-1\n  duration: number;         // total duration in seconds\n  elapsed: number;          // seconds elapsed\n  transitioning: boolean;\n  nextType: string | null;\n}\n\ninterface WeatherSaveData {\n  type: string;\n  intensity: number;\n  duration: number;\n  elapsed: number;\n  transitioning: boolean;\n  nextType: string | null;\n  transitionElapsed: number;\n}\n\n// ---------------------------------------------------------------------------\n// Constants\n// ---------------------------------------------------------------------------\n\n/** Minimum weather duration in seconds (5 minutes). */\nconst MIN_DURATION_S = 300;\n\n/** Maximum weather duration in seconds (30 minutes). */\nconst MAX_DURATION_S = 1800;\n\n/** Transition time between weather states in seconds. */\nconst TRANSITION_TIME_S = 30;\n\n/** Weather types that count as rain. */\nconst RAIN_TYPES = new Set(['rain', 'storm', 'acid_rain']);\n\n/** Visibility reduction per weather type (multiplier 0-1, lower = worse visibility). */\nconst VISIBILITY_MAP: Record<string, number> = {\n  clear: 1.0,\n  cloudy: 0.9,\n  rain: 0.7,\n  storm: 0.5,\n  fog: 0.3,\n  sandstorm: 0.2,\n  acid_rain: 0.6,\n  ember_rain: 0.6,\n  spore_cloud: 0.4,\n  void_storm: 0.15,\n  corruption_storm: 0.25,\n};\n\n/** Temperature modifier per weather type (degrees offset). */\nconst TEMPERATURE_MAP: Record<string, number> = {\n  clear: 0,\n  cloudy: -2,\n  rain: -5,\n  storm: -8,\n  fog: -3,\n  sandstorm: 5,\n  acid_rain: -4,\n  ember_rain: 10,\n  spore_cloud: 0,\n  void_storm: -15,\n  corruption_storm: -10,\n};\n\n// ---------------------------------------------------------------------------\n// Weather Manager\n// ---------------------------------------------------------------------------\n\n/**\n * Manages dynamic weather that changes over time based on biome-specific\n * weight tables. Supports smooth transitions, forced overrides, and\n * provides gameplay-relevant queries (visibility, temperature, rain check).\n */\nexport class WeatherManager {\n  private state: WeatherState = {\n    type: 'clear',\n    intensity: 0.5,\n    duration: MIN_DURATION_S,\n    elapsed: 0,\n    transitioning: false,\n    nextType: null,\n  };\n\n  /** Progress through the 30-second transition (0 = start, TRANSITION_TIME_S = done). */\n  private transitionElapsed: number = 0;\n\n  // Callbacks\n  private weatherChangeCallbacks: Array<(oldType: string, newType: string) => void> = [];\n\n  // ---------------------------------------------------------------------------\n  // Update\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Tick the weather system. Call every frame.\n   *\n   * @param delta  Time since last frame in seconds.\n   * @param biomeId  The biome the player is currently in.\n   */\n  update(delta: number, biomeId: string): void {\n    this.state.elapsed += delta;\n\n    if (this.state.transitioning && this.state.nextType !== null) {\n      // Transition in progress\n      this.transitionElapsed += delta;\n\n      // Lerp intensity toward 0 during first half, then back up\n      const halfTransition = TRANSITION_TIME_S / 2;\n      if (this.transitionElapsed < halfTransition) {\n        this.state.intensity = Math.max(0, 1 - (this.transitionElapsed / halfTransition));\n      } else {\n        this.state.intensity = Math.min(1, (this.transitionElapsed - halfTransition) / halfTransition);\n      }\n\n      if (this.transitionElapsed >= TRANSITION_TIME_S) {\n        // Transition complete\n        const oldType = this.state.type;\n        this.state.type = this.state.nextType;\n        this.state.nextType = null;\n        this.state.transitioning = false;\n        this.state.elapsed = 0;\n        this.state.intensity = 0.5 + Math.random() * 0.5;\n        this.state.duration = MIN_DURATION_S + Math.random() * (MAX_DURATION_S - MIN_DURATION_S);\n        this.transitionElapsed = 0;\n\n        for (const cb of this.weatherChangeCallbacks) {\n          cb(oldType, this.state.type);\n        }\n      }\n    } else if (this.state.elapsed >= this.state.duration) {\n      // Current weather expired — begin transition to new weather\n      const nextWeather = this.pickWeather(biomeId);\n      if (nextWeather !== this.state.type) {\n        this.state.transitioning = true;\n        this.state.nextType = nextWeather;\n        this.transitionElapsed = 0;\n      } else {\n        // Same weather re-rolled — just reset duration\n        this.state.elapsed = 0;\n        this.state.duration = MIN_DURATION_S + Math.random() * (MAX_DURATION_S - MIN_DURATION_S);\n      }\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Weather Picking\n  // ---------------------------------------------------------------------------\n\n  /** Pick a random weather type from a biome's weather weight table. */\n  private pickWeather(biomeId: string): string {\n    const biomeDef = BIOME_DB.get(biomeId);\n    if (!biomeDef || !biomeDef.weather) return 'clear';\n\n    const types = Object.keys(biomeDef.weather);\n    const weights = Object.values(biomeDef.weather);\n    const totalWeight = weights.reduce((sum, w) => sum + w, 0);\n\n    if (totalWeight <= 0) return 'clear';\n\n    let roll = Math.random() * totalWeight;\n    for (let i = 0; i < types.length; i++) {\n      roll -= weights[i];\n      if (roll <= 0) return types[i];\n    }\n\n    return types[types.length - 1];\n  }\n\n  // ---------------------------------------------------------------------------\n  // Public API — State Queries\n  // ---------------------------------------------------------------------------\n\n  /** Get the full current weather state. */\n  getCurrentWeather(): WeatherState {\n    return { ...this.state };\n  }\n\n  /** Get the current weather type string. */\n  getWeatherType(): string {\n    return this.state.type;\n  }\n\n  /** True if the current weather is rain, storm, or acid_rain. */\n  isRaining(): boolean {\n    return RAIN_TYPES.has(this.state.type);\n  }\n\n  /**\n   * Get current visibility as a 0-1 multiplier.\n   * 1 = full visibility, 0 = blind.\n   * Factors in weather type and transition state.\n   */\n  getVisibility(): number {\n    const baseVisibility = VISIBILITY_MAP[this.state.type] ?? 1.0;\n\n    // During transition, lerp between current and next\n    if (this.state.transitioning && this.state.nextType !== null) {\n      const nextVisibility = VISIBILITY_MAP[this.state.nextType] ?? 1.0;\n      const t = this.transitionElapsed / TRANSITION_TIME_S;\n      return baseVisibility + (nextVisibility - baseVisibility) * t;\n    }\n\n    return baseVisibility;\n  }\n\n  /**\n   * Get the effective temperature for the current biome and weather.\n   * Returns degrees as a number.\n   */\n  getTemperature(biomeId: string): number {\n    const biomeDef = BIOME_DB.get(biomeId);\n    const baseTemp = biomeDef?.temperature.base ?? 20;\n    const weatherMod = TEMPERATURE_MAP[this.state.type] ?? 0;\n    return baseTemp + weatherMod;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Forced Weather\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Force a specific weather type for a given duration.\n   * Immediately transitions to the specified weather.\n   */\n  forceWeather(type: string, duration: number): void {\n    const oldType = this.state.type;\n\n    this.state.type = type;\n    this.state.intensity = 0.8;\n    this.state.duration = duration;\n    this.state.elapsed = 0;\n    this.state.transitioning = false;\n    this.state.nextType = null;\n    this.transitionElapsed = 0;\n\n    if (oldType !== type) {\n      for (const cb of this.weatherChangeCallbacks) {\n        cb(oldType, type);\n      }\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Callbacks\n  // ---------------------------------------------------------------------------\n\n  /** Register a callback fired when the weather type changes. */\n  onWeatherChange(cb: (oldType: string, newType: string) => void): void {\n    this.weatherChangeCallbacks.push(cb);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Persistence\n  // ---------------------------------------------------------------------------\n\n  /** Serialize for save. */\n  serialize(): WeatherSaveData {\n    return {\n      type: this.state.type,\n      intensity: this.state.intensity,\n      duration: this.state.duration,\n      elapsed: this.state.elapsed,\n      transitioning: this.state.transitioning,\n      nextType: this.state.nextType,\n      transitionElapsed: this.transitionElapsed,\n    };\n  }\n\n  /** Deserialize from save. */\n  deserialize(data: WeatherSaveData): void {\n    this.state.type = data.type ?? 'clear';\n    this.state.intensity = data.intensity ?? 0.5;\n    this.state.duration = data.duration ?? MIN_DURATION_S;\n    this.state.elapsed = data.elapsed ?? 0;\n    this.state.transitioning = data.transitioning ?? false;\n    this.state.nextType = data.nextType ?? null;\n    this.transitionElapsed = data.transitionElapsed ?? 0;\n  }\n}\n","import Phaser from 'phaser';\n\ninterface AudioTrack {\n  key: string;\n  volume: number;\n  loop: boolean;\n}\n\n/** Per-biome music and ambient sound mappings */\nconst BIOME_MUSIC: Record<string, string> = {\n  haven: 'music_haven',\n  rotwood: 'music_rotwood',\n  ashlands: 'music_ashlands',\n  drowned: 'music_drowned',\n  bone: 'music_bone_wastes',\n  void: 'music_void',\n  edilas: 'music_edilas',\n};\n\nconst BIOME_AMBIENT: Record<string, string> = {\n  haven: 'ambient_forest',\n  rotwood: 'ambient_spores',\n  ashlands: 'ambient_lava',\n  drowned: 'ambient_water',\n  bone: 'ambient_wind',\n  void: 'ambient_void',\n  edilas: 'ambient_celestial',\n};\n\n/** SFX keys for common game actions */\nexport const SFX = {\n  SWORD_SWING: 'sfx_sword_swing',\n  AXE_SWING: 'sfx_axe_swing',\n  BOW_SHOOT: 'sfx_bow_shoot',\n  STAFF_CAST: 'sfx_staff_cast',\n  HAMMER_SMASH: 'sfx_hammer_smash',\n  DAGGER_STAB: 'sfx_dagger_stab',\n  SPEAR_THRUST: 'sfx_spear_thrust',\n  ENEMY_HIT: 'sfx_enemy_hit',\n  PLAYER_HIT: 'sfx_player_hit',\n  ENEMY_DIE: 'sfx_enemy_die',\n  ITEM_PICKUP: 'sfx_item_pickup',\n  GOLD_PICKUP: 'sfx_gold_pickup',\n  LEVEL_UP: 'sfx_level_up',\n  QUEST_COMPLETE: 'sfx_quest_complete',\n  UI_OPEN: 'sfx_ui_open',\n  UI_CLOSE: 'sfx_ui_close',\n  UI_CLICK: 'sfx_ui_click',\n  CRAFT_SUCCESS: 'sfx_craft_success',\n  DOOR_OPEN: 'sfx_door_open',\n  CHEST_OPEN: 'sfx_chest_open',\n  BOSS_INTRO: 'sfx_boss_intro',\n  CRIT_HIT: 'sfx_crit_hit',\n  FOOTSTEP_GRASS: 'sfx_footstep_grass',\n  FOOTSTEP_STONE: 'sfx_footstep_stone',\n  FOOTSTEP_SAND: 'sfx_footstep_sand',\n  FOOTSTEP_WATER: 'sfx_footstep_water',\n} as const;\n\n/**\n * Manages music, SFX, and ambient audio with crossfading and dynamic mixing.\n */\nexport class AudioManager {\n  private scene: Phaser.Scene;\n  private currentMusic: Phaser.Sound.BaseSound | null = null;\n  private currentMusicKey = '';\n  private currentAmbient: Phaser.Sound.BaseSound | null = null;\n  private currentAmbientKey = '';\n\n  private musicVolume = 0.5;\n  private sfxVolume = 0.7;\n  private ambientVolume = 0.3;\n  private masterVolume = 1.0;\n  private muted = false;\n\n  // Crossfade state\n  private crossfading = false;\n  private crossfadeTarget: string | null = null;\n  private crossfadeProgress = 0;\n  private crossfadeDuration = 2000; // ms\n\n  constructor(scene: Phaser.Scene) {\n    this.scene = scene;\n  }\n\n  /** Play background music with optional crossfade */\n  playMusic(key: string, loop: boolean = true): void {\n    if (key === this.currentMusicKey || this.muted) return;\n\n    if (this.currentMusic) {\n      // Crossfade to new track\n      this.crossfading = true;\n      this.crossfadeTarget = key;\n      this.crossfadeProgress = 0;\n\n      // Start new track quietly\n      try {\n        const newMusic = this.scene.sound.add(key, {\n          volume: 0,\n          loop,\n        });\n        newMusic.play();\n\n        // Fade old out, new in\n        this.scene.tweens.add({\n          targets: this.currentMusic,\n          volume: 0,\n          duration: this.crossfadeDuration,\n          onComplete: () => {\n            this.currentMusic?.destroy();\n            this.currentMusic = newMusic;\n            this.currentMusicKey = key;\n            this.crossfading = false;\n          },\n        });\n\n        this.scene.tweens.add({\n          targets: newMusic,\n          volume: this.musicVolume * this.masterVolume,\n          duration: this.crossfadeDuration,\n        });\n      } catch {\n        // Audio not loaded, skip\n        this.currentMusicKey = key;\n      }\n    } else {\n      try {\n        this.currentMusic = this.scene.sound.add(key, {\n          volume: this.musicVolume * this.masterVolume,\n          loop,\n        });\n        this.currentMusic.play();\n        this.currentMusicKey = key;\n      } catch {\n        this.currentMusicKey = key;\n      }\n    }\n  }\n\n  /** Play ambient sound loop */\n  playAmbient(key: string): void {\n    if (key === this.currentAmbientKey || this.muted) return;\n\n    if (this.currentAmbient) {\n      this.currentAmbient.destroy();\n    }\n\n    try {\n      this.currentAmbient = this.scene.sound.add(key, {\n        volume: this.ambientVolume * this.masterVolume,\n        loop: true,\n      });\n      this.currentAmbient.play();\n      this.currentAmbientKey = key;\n    } catch {\n      this.currentAmbientKey = key;\n    }\n  }\n\n  /** Play a one-shot sound effect */\n  playSFX(key: string, volume: number = 1.0): void {\n    if (this.muted) return;\n    try {\n      this.scene.sound.play(key, {\n        volume: this.sfxVolume * this.masterVolume * volume,\n      });\n    } catch {\n      // SFX not loaded, skip silently\n    }\n  }\n\n  /** Stop all audio */\n  stopAll(): void {\n    this.currentMusic?.destroy();\n    this.currentMusic = null;\n    this.currentMusicKey = '';\n    this.currentAmbient?.destroy();\n    this.currentAmbient = null;\n    this.currentAmbientKey = '';\n  }\n\n  /** Stop music only */\n  stopMusic(): void {\n    this.currentMusic?.destroy();\n    this.currentMusic = null;\n    this.currentMusicKey = '';\n  }\n\n  /** Duck music volume (for dialogue) */\n  duckMusic(targetVolume: number = 0.15, duration: number = 500): void {\n    if (this.currentMusic) {\n      this.scene.tweens.add({\n        targets: this.currentMusic,\n        volume: targetVolume * this.masterVolume,\n        duration,\n      });\n    }\n  }\n\n  /** Restore music volume after ducking */\n  unduckMusic(duration: number = 500): void {\n    if (this.currentMusic) {\n      this.scene.tweens.add({\n        targets: this.currentMusic,\n        volume: this.musicVolume * this.masterVolume,\n        duration,\n      });\n    }\n  }\n\n  /** Swell music (boss phase change) */\n  swellMusic(targetVolume: number = 0.9, duration: number = 1000): void {\n    if (this.currentMusic) {\n      this.scene.tweens.add({\n        targets: this.currentMusic,\n        volume: targetVolume * this.masterVolume,\n        duration,\n        yoyo: true,\n        hold: 500,\n      });\n    }\n  }\n\n  // Volume controls\n  setMusicVolume(vol: number): void {\n    this.musicVolume = Math.max(0, Math.min(1, vol));\n    if (this.currentMusic && 'volume' in this.currentMusic) {\n      (this.currentMusic as Phaser.Sound.WebAudioSound).setVolume(this.musicVolume * this.masterVolume);\n    }\n  }\n\n  setSFXVolume(vol: number): void {\n    this.sfxVolume = Math.max(0, Math.min(1, vol));\n  }\n\n  setAmbientVolume(vol: number): void {\n    this.ambientVolume = Math.max(0, Math.min(1, vol));\n    if (this.currentAmbient && 'volume' in this.currentAmbient) {\n      (this.currentAmbient as Phaser.Sound.WebAudioSound).setVolume(this.ambientVolume * this.masterVolume);\n    }\n  }\n\n  setMasterVolume(vol: number): void {\n    this.masterVolume = Math.max(0, Math.min(1, vol));\n  }\n\n  setMuted(muted: boolean): void {\n    this.muted = muted;\n    if (muted) {\n      this.scene.sound.setMute(true);\n    } else {\n      this.scene.sound.setMute(false);\n    }\n  }\n\n  isMuted(): boolean {\n    return this.muted;\n  }\n\n  getMusicVolume(): number { return this.musicVolume; }\n  getSFXVolume(): number { return this.sfxVolume; }\n  getAmbientVolume(): number { return this.ambientVolume; }\n  getMasterVolume(): number { return this.masterVolume; }\n  getCurrentMusicKey(): string { return this.currentMusicKey; }\n\n  /** Switch music/ambient based on biome */\n  setBiomeAudio(biomeId: string): void {\n    const musicKey = BIOME_MUSIC[biomeId];\n    if (musicKey) this.playMusic(musicKey);\n    const ambientKey = BIOME_AMBIENT[biomeId];\n    if (ambientKey) this.playAmbient(ambientKey);\n  }\n\n  /** Play combat music, ducking normal biome music */\n  playCombatMusic(): void {\n    this.duckMusic(0.1);\n    this.playSFX(SFX.BOSS_INTRO, 0.6);\n  }\n\n  /** Stop combat music, restore normal biome music */\n  stopCombatMusic(): void {\n    this.unduckMusic();\n  }\n\n  serialize(): { musicVolume: number; sfxVolume: number; ambientVolume: number; masterVolume: number; muted: boolean } {\n    return {\n      musicVolume: this.musicVolume,\n      sfxVolume: this.sfxVolume,\n      ambientVolume: this.ambientVolume,\n      masterVolume: this.masterVolume,\n      muted: this.muted,\n    };\n  }\n\n  deserialize(data: { musicVolume: number; sfxVolume: number; ambientVolume: number; masterVolume: number; muted: boolean }): void {\n    this.musicVolume = data.musicVolume;\n    this.sfxVolume = data.sfxVolume;\n    this.ambientVolume = data.ambientVolume;\n    this.masterVolume = data.masterVolume;\n    this.muted = data.muted;\n  }\n}\n","/**\n * EDILAS (Phaser) - Lighting Manager\n * Time-of-day tint overlay, point lights, and biome-specific ambient lighting.\n */\n\nimport Phaser from 'phaser';\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\ninterface PointLight {\n  id: string;\n  x: number;\n  y: number;\n  radius: number;\n  color: number;\n  intensity: number;\n  flicker: boolean;\n}\n\ninterface LightingConfig {\n  /** Hours 0-23 mapped to tint color + alpha */\n  dayNightCycle: { hour: number; tint: number; alpha: number }[];\n  /** Biome ambient overrides */\n  biomeAmbient: Record<string, { tint: number; alpha: number }>;\n}\n\n// ---------------------------------------------------------------------------\n// Constants\n// ---------------------------------------------------------------------------\n\n/** Time-of-day color cycle (hour → tint + alpha) */\nconst DAY_CYCLE: { hour: number; tint: number; alpha: number }[] = [\n  { hour: 0,  tint: 0x0a0a2e, alpha: 0.65 },  // midnight — deep blue\n  { hour: 4,  tint: 0x0a0a2e, alpha: 0.55 },  // late night\n  { hour: 5,  tint: 0x1a1040, alpha: 0.40 },  // predawn\n  { hour: 6,  tint: 0xffaa44, alpha: 0.20 },  // dawn — warm yellow\n  { hour: 8,  tint: 0xffffff, alpha: 0.00 },  // morning — clear\n  { hour: 12, tint: 0xffffff, alpha: 0.00 },  // noon — clear\n  { hour: 16, tint: 0xffffff, alpha: 0.00 },  // afternoon — clear\n  { hour: 18, tint: 0xff8844, alpha: 0.15 },  // dusk — orange\n  { hour: 19, tint: 0xcc4422, alpha: 0.25 },  // sunset\n  { hour: 20, tint: 0x1a1040, alpha: 0.40 },  // evening\n  { hour: 22, tint: 0x0a0a2e, alpha: 0.55 },  // night\n  { hour: 24, tint: 0x0a0a2e, alpha: 0.65 },  // wraps to midnight\n];\n\n/** Biome-specific ambient overlays (applied on top of day/night) */\nconst BIOME_AMBIENT: Record<string, { tint: number; alpha: number }> = {\n  haven:    { tint: 0x000000, alpha: 0.00 },  // no extra tint\n  rotwood:  { tint: 0x002200, alpha: 0.10 },  // slight green murk\n  ashlands: { tint: 0x330000, alpha: 0.12 },  // red volcanic glow\n  drowned:  { tint: 0x002233, alpha: 0.15 },  // blue-green murk\n  bone:     { tint: 0x111100, alpha: 0.08 },  // dusty brown\n  void:     { tint: 0x110022, alpha: 0.20 },  // purple shimmer\n  edilas:   { tint: 0x001122, alpha: 0.10 },  // ethereal blue\n};\n\n/** Dungeon darkness settings */\nconst DUNGEON_REVEAL_RADIUS = 120;\nconst DUNGEON_DARKNESS_ALPHA = 0.92;\n\n/**\n * Torch/light risk-reward tiers (Darkest Dungeon-inspired).\n * Lower light = harder enemies but better loot.\n */\nexport interface LightTier {\n  name: string;\n  threshold: number;    // Fuel must be >= this to be at this tier\n  enemyDmgMult: number; // Multiplier on enemy damage\n  enemyHpMult: number;  // Multiplier on enemy max HP (applied as effective)\n  lootRarityBonus: number; // Added to loot rarity luck rolls\n  corruptionRate: number;  // Multiplier on corruption accumulation\n  revealMult: number;   // Multiplier on reveal radius\n}\n\nexport const LIGHT_TIERS: LightTier[] = [\n  { name: 'Radiant',     threshold: 75, enemyDmgMult: 1.0,  enemyHpMult: 1.0, lootRarityBonus: 0, corruptionRate: 0.5, revealMult: 1.0 },\n  { name: 'Dim',         threshold: 50, enemyDmgMult: 1.15, enemyHpMult: 1.1, lootRarityBonus: 1, corruptionRate: 1.0, revealMult: 0.75 },\n  { name: 'Dark',        threshold: 25, enemyDmgMult: 1.3,  enemyHpMult: 1.2, lootRarityBonus: 2, corruptionRate: 1.5, revealMult: 0.5 },\n  { name: 'Pitch Black', threshold: 0,  enemyDmgMult: 1.5,  enemyHpMult: 1.3, lootRarityBonus: 3, corruptionRate: 2.0, revealMult: 0.3 },\n];\n\n// ---------------------------------------------------------------------------\n// Lighting Manager\n// ---------------------------------------------------------------------------\n\nexport class LightingManager {\n  private scene: Phaser.Scene;\n\n  /** Full-screen tint overlay rectangle */\n  private tintOverlay: Phaser.GameObjects.Rectangle | null = null;\n\n  /** Biome ambient overlay */\n  private biomeOverlay: Phaser.GameObjects.Rectangle | null = null;\n\n  /** Dungeon darkness overlay (circle mask reveals around player) */\n  private dungeonOverlay: Phaser.GameObjects.Graphics | null = null;\n\n  /** Point light graphics layer */\n  private lightGraphics: Phaser.GameObjects.Graphics | null = null;\n\n  /** Active point lights */\n  private pointLights: Map<string, PointLight> = new Map();\n\n  /** Current interpolated tint color */\n  private currentTint = 0xffffff;\n  private currentAlpha = 0;\n\n  /** Current biome */\n  private currentBiome = 'haven';\n\n  /** Is this a dungeon (full darkness with reveal) */\n  private isDungeon = false;\n\n  /** Torch fuel system (Darkest Dungeon-inspired): 0-100 */\n  private fuel = 100;\n  private fuelBurnRate = 2; // fuel consumed per minute in dungeons (100 fuel = 50 min at default)\n  private currentLightTier: LightTier = LIGHT_TIERS[0];\n\n  constructor(scene: Phaser.Scene) {\n    this.scene = scene;\n  }\n\n  // =========================================================================\n  // INITIALIZATION\n  // =========================================================================\n\n  /** Create the overlay layers. Call in scene.create(). */\n  init(isDungeon: boolean = false): void {\n    this.isDungeon = isDungeon;\n    const { width, height } = this.scene.cameras.main;\n\n    // Day/night tint overlay (full screen, scrollFactor 0)\n    this.tintOverlay = this.scene.add.rectangle(\n      width / 2, height / 2, width, height, 0x000000, 0,\n    ).setScrollFactor(0).setDepth(7000).setBlendMode(Phaser.BlendModes.MULTIPLY);\n\n    // Biome ambient overlay\n    this.biomeOverlay = this.scene.add.rectangle(\n      width / 2, height / 2, width, height, 0x000000, 0,\n    ).setScrollFactor(0).setDepth(7001).setBlendMode(Phaser.BlendModes.ADD);\n\n    // Point light graphics\n    this.lightGraphics = this.scene.add.graphics().setDepth(7002).setBlendMode(Phaser.BlendModes.ADD);\n\n    if (isDungeon) {\n      // Dungeon: full dark overlay with circular reveal\n      this.dungeonOverlay = this.scene.add.graphics().setDepth(7500);\n    }\n  }\n\n  // =========================================================================\n  // UPDATE\n  // =========================================================================\n\n  /**\n   * Update lighting. Call every frame.\n   * @param hour Current hour (0-24, can be fractional like 14.5)\n   * @param biomeId Current biome string ID\n   * @param playerX Player world X (for dungeon reveal)\n   * @param playerY Player world Y (for dungeon reveal)\n   */\n  update(hour: number, biomeId: string, playerX: number, playerY: number): void {\n    this.currentBiome = biomeId;\n\n    if (!this.isDungeon) {\n      // Day/night cycle\n      this.updateDayNightTint(hour);\n      this.updateBiomeAmbient(biomeId);\n    } else {\n      // Dungeon: fixed dark with reveal\n      this.updateDungeonDarkness(playerX, playerY);\n    }\n\n    // Point lights\n    this.renderPointLights(playerX, playerY);\n  }\n\n  private updateDayNightTint(hour: number): void {\n    if (!this.tintOverlay) return;\n\n    // Find the two cycle entries to interpolate between\n    let lower = DAY_CYCLE[0];\n    let upper = DAY_CYCLE[DAY_CYCLE.length - 1];\n\n    for (let i = 0; i < DAY_CYCLE.length - 1; i++) {\n      if (hour >= DAY_CYCLE[i].hour && hour < DAY_CYCLE[i + 1].hour) {\n        lower = DAY_CYCLE[i];\n        upper = DAY_CYCLE[i + 1];\n        break;\n      }\n    }\n\n    // Interpolation factor\n    const range = upper.hour - lower.hour;\n    const t = range > 0 ? (hour - lower.hour) / range : 0;\n\n    // Lerp color channels\n    const r = Math.round(((lower.tint >> 16) & 0xff) + (((upper.tint >> 16) & 0xff) - ((lower.tint >> 16) & 0xff)) * t);\n    const g = Math.round(((lower.tint >> 8) & 0xff) + (((upper.tint >> 8) & 0xff) - ((lower.tint >> 8) & 0xff)) * t);\n    const b = Math.round((lower.tint & 0xff) + ((upper.tint & 0xff) - (lower.tint & 0xff)) * t);\n    const alpha = lower.alpha + (upper.alpha - lower.alpha) * t;\n\n    this.currentTint = (r << 16) | (g << 8) | b;\n    this.currentAlpha = alpha;\n\n    this.tintOverlay.setFillStyle(this.currentTint, this.currentAlpha);\n  }\n\n  private updateBiomeAmbient(biomeId: string): void {\n    if (!this.biomeOverlay) return;\n\n    const ambient = BIOME_AMBIENT[biomeId] ?? BIOME_AMBIENT['haven'];\n    this.biomeOverlay.setFillStyle(ambient.tint, ambient.alpha);\n  }\n\n  private updateDungeonDarkness(playerX: number, playerY: number): void {\n    if (!this.dungeonOverlay) return;\n\n    const cam = this.scene.cameras.main;\n    this.dungeonOverlay.clear();\n\n    // Full dark rectangle\n    this.dungeonOverlay.fillStyle(0x000000, DUNGEON_DARKNESS_ALPHA);\n    this.dungeonOverlay.fillRect(\n      cam.scrollX - 100, cam.scrollY - 100,\n      cam.width / cam.zoom + 200, cam.height / cam.zoom + 200,\n    );\n\n    // Reveal circle around player (scales with torch fuel)\n    const revealRadius = DUNGEON_REVEAL_RADIUS * this.currentLightTier.revealMult;\n    this.dungeonOverlay.fillStyle(0x000000, 0);\n    // Use a radial gradient effect via concentric circles with decreasing alpha\n    for (let r = revealRadius; r > 0; r -= 4) {\n      const alpha = DUNGEON_DARKNESS_ALPHA * (r / revealRadius);\n      this.dungeonOverlay.fillStyle(0x000000, alpha);\n      this.dungeonOverlay.fillCircle(playerX, playerY, r);\n    }\n    // Clear center\n    this.dungeonOverlay.fillStyle(0x000000, 0);\n    this.dungeonOverlay.fillCircle(playerX, playerY, revealRadius * 0.4);\n  }\n\n  // =========================================================================\n  // POINT LIGHTS\n  // =========================================================================\n\n  /** Add a point light source (torch, campfire, etc.) */\n  addLight(id: string, x: number, y: number, radius: number = 80, color: number = 0xffaa44, intensity: number = 0.5, flicker: boolean = true): void {\n    this.pointLights.set(id, { id, x, y, radius, color, intensity, flicker });\n  }\n\n  /** Remove a point light */\n  removeLight(id: string): void {\n    this.pointLights.delete(id);\n  }\n\n  /** Clear all point lights */\n  clearLights(): void {\n    this.pointLights.clear();\n  }\n\n  private renderPointLights(playerX: number, playerY: number): void {\n    if (!this.lightGraphics) return;\n    this.lightGraphics.clear();\n\n    const viewDist = 600; // Only render lights within view distance\n\n    for (const light of this.pointLights.values()) {\n      const dx = light.x - playerX;\n      const dy = light.y - playerY;\n      if (dx * dx + dy * dy > viewDist * viewDist) continue;\n\n      let intensity = light.intensity;\n      if (light.flicker) {\n        // Simple flicker: +-10% random per frame\n        intensity *= 0.9 + Math.random() * 0.2;\n      }\n\n      // Draw additive light as concentric semi-transparent circles\n      const steps = 6;\n      for (let i = steps; i >= 1; i--) {\n        const frac = i / steps;\n        const r = ((light.color >> 16) & 0xff);\n        const g = ((light.color >> 8) & 0xff);\n        const b = (light.color & 0xff);\n        const dimR = Math.round(r * frac);\n        const dimG = Math.round(g * frac);\n        const dimB = Math.round(b * frac);\n        const dimColor = (dimR << 16) | (dimG << 8) | dimB;\n\n        this.lightGraphics.fillStyle(dimColor, intensity * frac * 0.15);\n        this.lightGraphics.fillCircle(light.x, light.y, light.radius * frac);\n      }\n    }\n  }\n\n  // =========================================================================\n  // TORCH FUEL SYSTEM\n  // =========================================================================\n\n  /** Consume fuel over time. Call each frame in dungeon scenes. */\n  updateFuel(deltaSec: number): void {\n    if (!this.isDungeon || this.fuel <= 0) return;\n    this.fuel = Math.max(0, this.fuel - (this.fuelBurnRate / 60) * deltaSec);\n    this.recalcLightTier();\n  }\n\n  /** Add fuel (e.g. using a lantern item or torch). Caps at 100. */\n  addFuel(amount: number): void {\n    this.fuel = Math.min(100, this.fuel + amount);\n    this.recalcLightTier();\n  }\n\n  /** Get current fuel level (0-100) */\n  getFuel(): number {\n    return this.fuel;\n  }\n\n  /** Set fuel burn rate (fuel per minute) */\n  setFuelBurnRate(rate: number): void {\n    this.fuelBurnRate = rate;\n  }\n\n  /** Get current light tier (determines gameplay modifiers) */\n  getLightTier(): LightTier {\n    return this.currentLightTier;\n  }\n\n  private recalcLightTier(): void {\n    for (const tier of LIGHT_TIERS) {\n      if (this.fuel >= tier.threshold) {\n        this.currentLightTier = tier;\n        return;\n      }\n    }\n    this.currentLightTier = LIGHT_TIERS[LIGHT_TIERS.length - 1];\n  }\n\n  // =========================================================================\n  // QUERIES\n  // =========================================================================\n\n  /** Get current tint color */\n  getCurrentTint(): number {\n    return this.currentTint;\n  }\n\n  /** Get current darkness alpha (0 = bright, 1 = fully dark) */\n  getDarknessAlpha(): number {\n    return this.currentAlpha;\n  }\n\n  /** Check if it's nighttime (alpha > 0.3) */\n  isNight(): boolean {\n    return this.currentAlpha > 0.3;\n  }\n\n  // =========================================================================\n  // CLEANUP\n  // =========================================================================\n\n  destroy(): void {\n    this.tintOverlay?.destroy();\n    this.biomeOverlay?.destroy();\n    this.dungeonOverlay?.destroy();\n    this.lightGraphics?.destroy();\n    this.pointLights.clear();\n  }\n}\n","/**\n * EDILAS (Phaser) - Particle Manager\n * Lightweight custom particle system using Phaser graphics.\n * Handles combat effects, weather particles, ambient effects, and notifications.\n */\n\nimport Phaser from 'phaser';\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\ninterface Particle {\n  x: number;\n  y: number;\n  vx: number;\n  vy: number;\n  life: number;        // remaining lifetime in seconds\n  maxLife: number;      // original lifetime\n  color: number;\n  size: number;\n  gravity: number;      // vertical acceleration\n  fadeOut: boolean;\n  shrink: boolean;\n}\n\ninterface EmitterConfig {\n  x: number;\n  y: number;\n  count: number;\n  color: number | number[];   // single color or array to pick from\n  size: { min: number; max: number };\n  speed: { min: number; max: number };\n  angle: { min: number; max: number }; // degrees\n  life: { min: number; max: number };\n  gravity: number;\n  fadeOut: boolean;\n  shrink: boolean;\n  /** Follow a target position each frame */\n  follow?: { x: number; y: number };\n}\n\n/** Continuous emitter that spawns particles over time */\ninterface ContinuousEmitter {\n  id: string;\n  config: EmitterConfig;\n  rate: number;         // particles per second\n  accumulator: number;\n  active: boolean;\n}\n\n// ---------------------------------------------------------------------------\n// Preset emitter configs\n// ---------------------------------------------------------------------------\n\nconst PRESETS = {\n  /** Blood splatter on hit */\n  blood: (x: number, y: number): EmitterConfig => ({\n    x, y,\n    count: 6,\n    color: [0xcc0000, 0x880000, 0x660000],\n    size: { min: 2, max: 4 },\n    speed: { min: 40, max: 120 },\n    angle: { min: 0, max: 360 },\n    life: { min: 0.3, max: 0.6 },\n    gravity: 200,\n    fadeOut: true,\n    shrink: true,\n  }),\n\n  /** Hit sparks (melee) */\n  sparks: (x: number, y: number): EmitterConfig => ({\n    x, y,\n    count: 8,\n    color: [0xffffff, 0xffee88, 0xffcc44],\n    size: { min: 1, max: 3 },\n    speed: { min: 80, max: 200 },\n    angle: { min: 0, max: 360 },\n    life: { min: 0.1, max: 0.3 },\n    gravity: 0,\n    fadeOut: true,\n    shrink: false,\n  }),\n\n  /** Critical hit flash */\n  critFlash: (x: number, y: number): EmitterConfig => ({\n    x, y,\n    count: 12,\n    color: [0xffaa00, 0xffdd00, 0xffffff],\n    size: { min: 2, max: 5 },\n    speed: { min: 100, max: 250 },\n    angle: { min: 0, max: 360 },\n    life: { min: 0.2, max: 0.5 },\n    gravity: -50,\n    fadeOut: true,\n    shrink: true,\n  }),\n\n  /** Harvest sparkles */\n  harvest: (x: number, y: number): EmitterConfig => ({\n    x, y,\n    count: 10,\n    color: [0x44ff44, 0x88ff88, 0xaaffaa],\n    size: { min: 1, max: 3 },\n    speed: { min: 20, max: 60 },\n    angle: { min: 220, max: 320 }, // upward\n    life: { min: 0.5, max: 1.0 },\n    gravity: -30,\n    fadeOut: true,\n    shrink: false,\n  }),\n\n  /** Gold pickup shimmer */\n  goldPickup: (x: number, y: number): EmitterConfig => ({\n    x, y,\n    count: 8,\n    color: [0xffcc00, 0xffdd44, 0xffee88],\n    size: { min: 1, max: 3 },\n    speed: { min: 30, max: 80 },\n    angle: { min: 240, max: 300 },\n    life: { min: 0.3, max: 0.7 },\n    gravity: -60,\n    fadeOut: true,\n    shrink: false,\n  }),\n\n  /** Level up burst */\n  levelUp: (x: number, y: number): EmitterConfig => ({\n    x, y,\n    count: 30,\n    color: [0xffdd00, 0xffffff, 0x44ddff, 0xff44ff],\n    size: { min: 2, max: 5 },\n    speed: { min: 80, max: 200 },\n    angle: { min: 0, max: 360 },\n    life: { min: 0.5, max: 1.5 },\n    gravity: -40,\n    fadeOut: true,\n    shrink: true,\n  }),\n\n  /** Corruption miasma */\n  corruption: (x: number, y: number): EmitterConfig => ({\n    x, y,\n    count: 4,\n    color: [0x440066, 0x330055, 0x220044],\n    size: { min: 3, max: 6 },\n    speed: { min: 5, max: 20 },\n    angle: { min: 240, max: 300 },\n    life: { min: 1.0, max: 2.0 },\n    gravity: -15,\n    fadeOut: true,\n    shrink: false,\n  }),\n\n  /** Poison DoT effect */\n  poison: (x: number, y: number): EmitterConfig => ({\n    x, y,\n    count: 3,\n    color: [0x00cc00, 0x009900, 0x44ff44],\n    size: { min: 1, max: 3 },\n    speed: { min: 10, max: 30 },\n    angle: { min: 240, max: 300 },\n    life: { min: 0.4, max: 0.8 },\n    gravity: -40,\n    fadeOut: true,\n    shrink: false,\n  }),\n\n  /** Burn DoT effect */\n  burn: (x: number, y: number): EmitterConfig => ({\n    x, y,\n    count: 4,\n    color: [0xff4400, 0xff6600, 0xffaa00],\n    size: { min: 2, max: 4 },\n    speed: { min: 15, max: 40 },\n    angle: { min: 240, max: 300 },\n    life: { min: 0.3, max: 0.6 },\n    gravity: -80,\n    fadeOut: true,\n    shrink: true,\n  }),\n\n  /** Freeze effect */\n  freeze: (x: number, y: number): EmitterConfig => ({\n    x, y,\n    count: 6,\n    color: [0x88ccff, 0xaaddff, 0xffffff],\n    size: { min: 1, max: 3 },\n    speed: { min: 10, max: 30 },\n    angle: { min: 0, max: 360 },\n    life: { min: 0.5, max: 1.0 },\n    gravity: 20,\n    fadeOut: true,\n    shrink: false,\n  }),\n};\n\n// ---------------------------------------------------------------------------\n// Weather Particle Configs (continuous emitters)\n// ---------------------------------------------------------------------------\n\nfunction makeWeatherConfig(type: string, screenW: number, screenH: number): EmitterConfig | null {\n  switch (type) {\n    case 'rain':\n      return {\n        x: 0, y: -10,\n        count: 1,\n        color: 0x6688cc,\n        size: { min: 1, max: 2 },\n        speed: { min: 300, max: 400 },\n        angle: { min: 250, max: 260 },\n        life: { min: 0.8, max: 1.2 },\n        gravity: 100,\n        fadeOut: false,\n        shrink: false,\n      };\n    case 'storm':\n      return {\n        x: 0, y: -10,\n        count: 1,\n        color: [0x5577bb, 0x4466aa],\n        size: { min: 1, max: 3 },\n        speed: { min: 400, max: 600 },\n        angle: { min: 240, max: 255 },\n        life: { min: 0.6, max: 1.0 },\n        gravity: 150,\n        fadeOut: false,\n        shrink: false,\n      };\n    case 'snow':\n      return {\n        x: 0, y: -10,\n        count: 1,\n        color: [0xffffff, 0xeeeeff, 0xddddee],\n        size: { min: 2, max: 4 },\n        speed: { min: 20, max: 60 },\n        angle: { min: 250, max: 290 },\n        life: { min: 2.0, max: 4.0 },\n        gravity: 30,\n        fadeOut: true,\n        shrink: false,\n      };\n    case 'sandstorm':\n      return {\n        x: 0, y: 0,\n        count: 1,\n        color: [0xccaa66, 0xbb9955, 0xaa8844],\n        size: { min: 2, max: 5 },\n        speed: { min: 200, max: 400 },\n        angle: { min: 170, max: 190 },\n        life: { min: 0.5, max: 1.5 },\n        gravity: 20,\n        fadeOut: true,\n        shrink: false,\n      };\n    case 'ember_rain':\n      return {\n        x: 0, y: -10,\n        count: 1,\n        color: [0xff4400, 0xff6600, 0xffaa00],\n        size: { min: 2, max: 4 },\n        speed: { min: 40, max: 100 },\n        angle: { min: 250, max: 290 },\n        life: { min: 1.0, max: 2.0 },\n        gravity: 50,\n        fadeOut: true,\n        shrink: true,\n      };\n    case 'spore_cloud':\n      return {\n        x: 0, y: 0,\n        count: 1,\n        color: [0x88cc00, 0xaadd22, 0xccee44],\n        size: { min: 3, max: 6 },\n        speed: { min: 5, max: 20 },\n        angle: { min: 0, max: 360 },\n        life: { min: 2.0, max: 4.0 },\n        gravity: -10,\n        fadeOut: true,\n        shrink: false,\n      };\n    case 'acid_rain':\n      return {\n        x: 0, y: -10,\n        count: 1,\n        color: [0x44cc44, 0x66dd44, 0x88ee44],\n        size: { min: 1, max: 2 },\n        speed: { min: 280, max: 380 },\n        angle: { min: 252, max: 262 },\n        life: { min: 0.8, max: 1.2 },\n        gravity: 100,\n        fadeOut: false,\n        shrink: false,\n      };\n    case 'void_storm':\n      return {\n        x: 0, y: 0,\n        count: 1,\n        color: [0x6600cc, 0x8800ff, 0xaa44ff],\n        size: { min: 2, max: 5 },\n        speed: { min: 100, max: 300 },\n        angle: { min: 0, max: 360 },\n        life: { min: 0.3, max: 0.8 },\n        gravity: 0,\n        fadeOut: true,\n        shrink: true,\n      };\n    default:\n      return null;\n  }\n}\n\n// ---------------------------------------------------------------------------\n// Particle Manager\n// ---------------------------------------------------------------------------\n\nexport class ParticleManager {\n  private scene: Phaser.Scene;\n  private graphics: Phaser.GameObjects.Graphics;\n  private particles: Particle[] = [];\n  private continuousEmitters: Map<string, ContinuousEmitter> = new Map();\n\n  /** Max particles to prevent performance issues */\n  private readonly MAX_PARTICLES = 500;\n\n  constructor(scene: Phaser.Scene) {\n    this.scene = scene;\n    this.graphics = scene.add.graphics().setDepth(6500);\n  }\n\n  // =========================================================================\n  // BURST EMISSION\n  // =========================================================================\n\n  /** Emit a burst of particles from a preset */\n  emit(preset: keyof typeof PRESETS, x: number, y: number): void {\n    const config = PRESETS[preset](x, y);\n    this.emitFromConfig(config);\n  }\n\n  /** Emit particles from a custom config */\n  emitFromConfig(config: EmitterConfig): void {\n    for (let i = 0; i < config.count; i++) {\n      if (this.particles.length >= this.MAX_PARTICLES) break;\n\n      const angle = Phaser.Math.FloatBetween(config.angle.min, config.angle.max) * Math.PI / 180;\n      const speed = Phaser.Math.FloatBetween(config.speed.min, config.speed.max);\n      const life = Phaser.Math.FloatBetween(config.life.min, config.life.max);\n      const size = Phaser.Math.FloatBetween(config.size.min, config.size.max);\n\n      let color: number;\n      if (Array.isArray(config.color)) {\n        color = config.color[Math.floor(Math.random() * config.color.length)];\n      } else {\n        color = config.color;\n      }\n\n      this.particles.push({\n        x: config.x + (Math.random() - 0.5) * 8,\n        y: config.y + (Math.random() - 0.5) * 8,\n        vx: Math.cos(angle) * speed,\n        vy: Math.sin(angle) * speed,\n        life,\n        maxLife: life,\n        color,\n        size,\n        gravity: config.gravity,\n        fadeOut: config.fadeOut,\n        shrink: config.shrink,\n      });\n    }\n  }\n\n  // =========================================================================\n  // CONTINUOUS EMITTERS\n  // =========================================================================\n\n  /** Start a continuous particle emitter */\n  startEmitter(id: string, config: EmitterConfig, rate: number): void {\n    this.continuousEmitters.set(id, {\n      id,\n      config,\n      rate,\n      accumulator: 0,\n      active: true,\n    });\n  }\n\n  /** Stop a continuous emitter */\n  stopEmitter(id: string): void {\n    this.continuousEmitters.delete(id);\n  }\n\n  /** Set weather particles */\n  setWeatherParticles(weatherType: string): void {\n    // Remove old weather emitter\n    this.stopEmitter('weather');\n\n    const cam = this.scene.cameras.main;\n    const config = makeWeatherConfig(weatherType, cam.width, cam.height);\n\n    if (config) {\n      // Weather particles need to spawn across the screen\n      const rate = weatherType === 'storm' ? 80 : weatherType === 'rain' ? 40 : 15;\n      this.startEmitter('weather', config, rate);\n    }\n  }\n\n  // =========================================================================\n  // UPDATE\n  // =========================================================================\n\n  /** Update all particles. Call every frame. */\n  update(dt: number, cameraX: number, cameraY: number, cameraW: number, cameraH: number): void {\n    // Process continuous emitters\n    for (const emitter of this.continuousEmitters.values()) {\n      if (!emitter.active) continue;\n\n      emitter.accumulator += dt * emitter.rate;\n      while (emitter.accumulator >= 1) {\n        emitter.accumulator -= 1;\n\n        // For weather, randomize spawn position across screen\n        const config = { ...emitter.config };\n        if (emitter.id === 'weather') {\n          config.x = cameraX + Math.random() * cameraW;\n          config.y = cameraY + (config.y < 0 ? config.y : Math.random() * cameraH);\n        }\n\n        const singleConfig = { ...config, count: 1 };\n        this.emitFromConfig(singleConfig);\n      }\n    }\n\n    // Update all particles\n    this.graphics.clear();\n\n    for (let i = this.particles.length - 1; i >= 0; i--) {\n      const p = this.particles[i];\n      p.life -= dt;\n\n      if (p.life <= 0) {\n        this.particles.splice(i, 1);\n        continue;\n      }\n\n      // Physics\n      p.vy += p.gravity * dt;\n      p.x += p.vx * dt;\n      p.y += p.vy * dt;\n\n      // Calculate alpha and size\n      const lifeRatio = p.life / p.maxLife;\n      let alpha = 1.0;\n      let size = p.size;\n\n      if (p.fadeOut) {\n        alpha = lifeRatio;\n      }\n      if (p.shrink) {\n        size = p.size * lifeRatio;\n      }\n\n      // Skip if off-screen (with margin)\n      const margin = 50;\n      if (p.x < cameraX - margin || p.x > cameraX + cameraW + margin ||\n          p.y < cameraY - margin || p.y > cameraY + cameraH + margin) {\n        continue;\n      }\n\n      // Render\n      this.graphics.fillStyle(p.color, alpha);\n      if (size <= 2) {\n        this.graphics.fillRect(p.x - size / 2, p.y - size / 2, size, size);\n      } else {\n        this.graphics.fillCircle(p.x, p.y, size / 2);\n      }\n    }\n  }\n\n  // =========================================================================\n  // QUERIES\n  // =========================================================================\n\n  /** Get current particle count */\n  getParticleCount(): number {\n    return this.particles.length;\n  }\n\n  // =========================================================================\n  // CLEANUP\n  // =========================================================================\n\n  destroy(): void {\n    this.graphics.destroy();\n    this.particles = [];\n    this.continuousEmitters.clear();\n  }\n}\n","/**\n * EDILAS (Phaser) - Corruption Visual Overlay\n * Renders per-tile corruption effects on top of the world.\n * Purple/black gradient based on corruption level (0.0–1.0).\n */\n\nimport Phaser from 'phaser';\nimport { TILE_SIZE, CHUNK_SIZE } from '../config';\nimport type { CorruptionManager } from './CorruptionManager';\nimport type { ParticleManager } from './ParticleManager';\n\n// ---------------------------------------------------------------------------\n// Constants\n// ---------------------------------------------------------------------------\n\n/** Corruption levels that trigger different visual tiers */\nconst TIER_LOW = 0.1;\nconst TIER_MEDIUM = 0.3;\nconst TIER_HIGH = 0.6;\nconst TIER_MAX = 0.9;\n\n/** Colors per corruption tier */\nconst COLOR_LOW = 0x330044;     // subtle purple\nconst COLOR_MEDIUM = 0x440066;  // deeper purple\nconst COLOR_HIGH = 0x220033;    // dark purple-black\nconst COLOR_MAX = 0x110011;     // near-black void\n\n/** How often to spawn ambient corruption particles (seconds) */\nconst PARTICLE_INTERVAL = 0.4;\n\n// ---------------------------------------------------------------------------\n// Corruption Overlay\n// ---------------------------------------------------------------------------\n\nexport class CorruptionOverlay {\n  private scene: Phaser.Scene;\n  private graphics: Phaser.GameObjects.Graphics;\n  private corruptionManager: CorruptionManager;\n  private particleManager: ParticleManager | null;\n\n  /** Accumulator for ambient corruption particle spawning */\n  private particleTimer = 0;\n\n  /** Pulse phase for medium+ corruption visual effect */\n  private pulsePhase = 0;\n\n  constructor(\n    scene: Phaser.Scene,\n    corruptionManager: CorruptionManager,\n    particleManager: ParticleManager | null = null,\n  ) {\n    this.scene = scene;\n    this.corruptionManager = corruptionManager;\n    this.particleManager = particleManager;\n\n    // Create graphics layer between tiles and entities\n    this.graphics = scene.add.graphics().setDepth(2000);\n  }\n\n  /**\n   * Update the corruption overlay. Call every frame.\n   * Only renders tiles within the camera viewport for performance.\n   */\n  update(\n    dt: number,\n    cameraX: number,\n    cameraY: number,\n    cameraW: number,\n    cameraH: number,\n  ): void {\n    this.graphics.clear();\n    this.pulsePhase += dt * 2; // ~2 Hz pulse\n\n    // Calculate visible tile range (with 1-tile margin)\n    const startTX = Math.floor(cameraX / TILE_SIZE) - 1;\n    const startTY = Math.floor(cameraY / TILE_SIZE) - 1;\n    const endTX = Math.ceil((cameraX + cameraW) / TILE_SIZE) + 1;\n    const endTY = Math.ceil((cameraY + cameraH) / TILE_SIZE) + 1;\n\n    // Track high-corruption tiles for ambient particles\n    let highCorruptionTiles: { x: number; y: number }[] = [];\n\n    for (let ty = startTY; ty <= endTY; ty++) {\n      for (let tx = startTX; tx <= endTX; tx++) {\n        const corruption = this.corruptionManager.getCorruption(tx, ty);\n        if (corruption < TIER_LOW) continue;\n\n        const worldX = tx * TILE_SIZE;\n        const worldY = ty * TILE_SIZE;\n\n        if (corruption >= TIER_MAX) {\n          // Max corruption: near-black void with slight pulse\n          const pulseAlpha = 0.7 + Math.sin(this.pulsePhase * 1.5) * 0.1;\n          this.graphics.fillStyle(COLOR_MAX, pulseAlpha);\n          this.graphics.fillRect(worldX, worldY, TILE_SIZE, TILE_SIZE);\n\n          // Void veins (cross pattern)\n          this.graphics.fillStyle(0x6600cc, 0.3);\n          this.graphics.fillRect(worldX + TILE_SIZE / 2 - 1, worldY, 2, TILE_SIZE);\n          this.graphics.fillRect(worldX, worldY + TILE_SIZE / 2 - 1, TILE_SIZE, 2);\n\n          highCorruptionTiles.push({ x: worldX + TILE_SIZE / 2, y: worldY + TILE_SIZE / 2 });\n        } else if (corruption >= TIER_HIGH) {\n          // High corruption: heavy dark overlay with pulsing\n          const pulseAlpha = 0.45 + Math.sin(this.pulsePhase + tx * 0.3) * 0.1;\n          this.graphics.fillStyle(COLOR_HIGH, pulseAlpha);\n          this.graphics.fillRect(worldX, worldY, TILE_SIZE, TILE_SIZE);\n\n          // Dark vein edges\n          this.graphics.fillStyle(0x440066, 0.2);\n          this.graphics.fillRect(worldX, worldY, TILE_SIZE, 2);\n          this.graphics.fillRect(worldX, worldY, 2, TILE_SIZE);\n\n          highCorruptionTiles.push({ x: worldX + TILE_SIZE / 2, y: worldY + TILE_SIZE / 2 });\n        } else if (corruption >= TIER_MEDIUM) {\n          // Medium corruption: purple overlay with subtle pulse\n          const pulseAlpha = 0.2 + Math.sin(this.pulsePhase * 0.8 + ty * 0.5) * 0.05;\n          this.graphics.fillStyle(COLOR_MEDIUM, pulseAlpha);\n          this.graphics.fillRect(worldX, worldY, TILE_SIZE, TILE_SIZE);\n        } else {\n          // Low corruption: subtle purple tint\n          const alpha = 0.08 + (corruption - TIER_LOW) / (TIER_MEDIUM - TIER_LOW) * 0.1;\n          this.graphics.fillStyle(COLOR_LOW, alpha);\n          this.graphics.fillRect(worldX, worldY, TILE_SIZE, TILE_SIZE);\n        }\n      }\n    }\n\n    // Spawn ambient corruption particles on high-corruption tiles\n    if (this.particleManager && highCorruptionTiles.length > 0) {\n      this.particleTimer += dt;\n      if (this.particleTimer >= PARTICLE_INTERVAL) {\n        this.particleTimer -= PARTICLE_INTERVAL;\n\n        // Pick a random high-corruption tile to emit from\n        const tile = highCorruptionTiles[Math.floor(Math.random() * highCorruptionTiles.length)];\n        this.particleManager.emit('corruption', tile.x, tile.y);\n      }\n    }\n  }\n\n  destroy(): void {\n    this.graphics.destroy();\n  }\n}\n","/**\n * EDILAS (Phaser) - Festival Manager\n * Seasonal festival system with 8 festivals across the four seasons.\n * Tracks attendance, completion, activities, and rewards.\n *\n * Phase 3 Stream E: Life Systems — Festivals.\n */\n\nimport { SEASONS } from '../config';\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\n/** A season type derived from the game config. */\nexport type FestivalSeason = typeof SEASONS[number];\n\n/** An activity available during a festival. */\nexport interface FestivalActivity {\n  id: string;\n  name: string;\n  description: string;\n}\n\n/** Reward granted upon festival completion. */\nexport interface FestivalReward {\n  itemId?: string;\n  quantity?: number;\n  gold?: number;\n}\n\n/** Static definition for a festival. */\nexport interface FestivalDef {\n  id: string;\n  name: string;\n  season: FestivalSeason;\n  day: number;\n  description: string;\n  activities: FestivalActivity[];\n  rewards: FestivalReward[];\n}\n\n/** Runtime state for a festival within the current year. */\ninterface FestivalState {\n  attended: boolean;\n  completed: boolean;\n}\n\n/** Save data shape. */\ninterface FestivalSaveData {\n  year: number;\n  states: Record<string, FestivalState>;\n}\n\n// ---------------------------------------------------------------------------\n// Festival Definitions\n// ---------------------------------------------------------------------------\n\n/**\n * All 8 seasonal festivals.\n * Each festival occurs on a specific season and day (1-28).\n */\nexport const FESTIVALS: FestivalDef[] = [\n  // -- Spring --\n  {\n    id: 'egg_festival',\n    name: 'Egg Festival',\n    season: 'Spring',\n    day: 13,\n    description:\n      'A beloved spring tradition! Compete in an egg hunt across the town, collecting as many hidden eggs as you can before the timer runs out.',\n    activities: [\n      { id: 'egg_hunt', name: 'Egg Hunt', description: 'Find and collect hidden eggs scattered around town before the timer runs out.' },\n      { id: 'egg_decorating', name: 'Egg Decorating', description: 'Decorate eggs at the painting station for bonus prizes.' },\n    ],\n    rewards: [\n      { itemId: 'straw_hat', quantity: 1 },\n      { gold: 500 },\n    ],\n  },\n  {\n    id: 'flower_dance',\n    name: 'Flower Dance',\n    season: 'Spring',\n    day: 24,\n    description:\n      'An elegant ceremony where townsfolk pair up to dance among the spring blossoms. A strong relationship is required to be chosen as a dance partner.',\n    activities: [\n      { id: 'partner_selection', name: 'Dance Partner Selection', description: 'Ask an NPC to be your dance partner. Requires at least 4 hearts of friendship.' },\n      { id: 'flower_dance_performance', name: 'Flower Dance', description: 'Perform the traditional flower dance with your partner.' },\n    ],\n    rewards: [\n      { itemId: 'flower_crown', quantity: 1 },\n      { gold: 300 },\n    ],\n  },\n\n  // -- Summer --\n  {\n    id: 'luau',\n    name: 'Luau',\n    season: 'Summer',\n    day: 11,\n    description:\n      'The whole town gathers for a grand potluck feast on the beach. Contribute an ingredient to the communal pot — the quality of your contribution determines the outcome!',\n    activities: [\n      { id: 'potluck_contribution', name: 'Potluck Contribution', description: 'Add an ingredient to the communal pot. Higher-quality items yield a better feast.' },\n      { id: 'beach_games', name: 'Beach Games', description: 'Participate in beach activities while the feast cooks.' },\n    ],\n    rewards: [\n      { itemId: 'luau_lei', quantity: 1 },\n      { gold: 750 },\n    ],\n  },\n  {\n    id: 'moonlight_jellies',\n    name: 'Moonlight Jellies',\n    season: 'Summer',\n    day: 28,\n    description:\n      'On the last night of summer, the townsfolk gather at the beach to watch the rare moonlight jellies drift along the shore. A contemplative, magical event.',\n    activities: [\n      { id: 'watch_jellies', name: 'Watch the Jellies', description: 'Gather at the docks and watch the bioluminescent jellies pass through the bay.' },\n      { id: 'special_dialogue', name: 'Starlit Conversations', description: 'Share special dialogue with NPCs under the moonlit sky.' },\n    ],\n    rewards: [\n      { itemId: 'moonlight_jelly_charm', quantity: 1 },\n      { gold: 200 },\n    ],\n  },\n\n  // -- Autumn --\n  {\n    id: 'harvest_fair',\n    name: 'Harvest Fair',\n    season: 'Autumn',\n    day: 16,\n    description:\n      'The annual celebration of the harvest! Set up a grange display to be judged on the quality and variety of your crops, artisan goods, and foraged items.',\n    activities: [\n      { id: 'grange_display', name: 'Grange Display', description: 'Arrange up to 9 items in your display case. Judged on quality, variety, and rarity.' },\n      { id: 'fair_games', name: 'Fair Games', description: 'Play carnival mini-games to earn star tokens for prizes.' },\n    ],\n    rewards: [\n      { itemId: 'stardrop', quantity: 1 },\n      { gold: 1000 },\n    ],\n  },\n  {\n    id: 'spirits_eve',\n    name: \"Spirit's Eve\",\n    season: 'Autumn',\n    day: 27,\n    description:\n      'A spooky celebration at the town square! Brave the haunted maze and discover its secrets for rare rewards.',\n    activities: [\n      { id: 'haunted_maze', name: 'Haunted Maze', description: 'Navigate the haunted maze to find the golden pumpkin hidden at its center.' },\n      { id: 'costume_contest', name: 'Costume Contest', description: 'Show off your spookiest outfit for a chance at prizes.' },\n    ],\n    rewards: [\n      { itemId: 'golden_pumpkin', quantity: 1 },\n      { gold: 500 },\n    ],\n  },\n\n  // -- Winter --\n  {\n    id: 'ice_festival',\n    name: 'Ice Festival',\n    season: 'Winter',\n    day: 8,\n    description:\n      'Bundle up and head to the frozen lake for the annual ice fishing competition! Catch the most (or the rarest) fish to claim victory.',\n    activities: [\n      { id: 'ice_fishing_competition', name: 'Ice Fishing Competition', description: 'Compete against the townsfolk to catch the most valuable fish through the ice.' },\n      { id: 'ice_sculpting', name: 'Ice Sculpting', description: 'Admire the ice sculptures or try your hand at carving one.' },\n    ],\n    rewards: [\n      { itemId: 'ice_rod', quantity: 1 },\n      { gold: 600 },\n    ],\n  },\n  {\n    id: 'feast_of_winter_star',\n    name: 'Feast of the Winter Star',\n    season: 'Winter',\n    day: 25,\n    description:\n      'The most heartwarming festival of the year! The whole town gathers for a grand feast and secret gift exchange. Each person is assigned a secret santa.',\n    activities: [\n      { id: 'secret_santa', name: 'Secret Gift Exchange', description: 'Give a gift to your assigned townsfolk and receive one in return.' },\n      { id: 'winter_feast', name: 'Winter Feast', description: 'Enjoy the grand communal feast with all the townsfolk.' },\n    ],\n    rewards: [\n      { itemId: 'winter_star_ornament', quantity: 1 },\n      { gold: 800 },\n    ],\n  },\n];\n\n/** Lookup map for festival definitions by ID. */\nexport const FESTIVAL_DB = new Map<string, FestivalDef>(\n  FESTIVALS.map((f) => [f.id, f])\n);\n\n// ---------------------------------------------------------------------------\n// Festival Manager\n// ---------------------------------------------------------------------------\n\n/**\n * Manages seasonal festivals: checking if a festival is happening,\n * starting and completing festivals, tracking yearly attendance,\n * and providing rewards.\n */\nexport class FestivalManager {\n  /** Per-festival attendance and completion tracking for the current year. */\n  private states: Map<string, FestivalState> = new Map();\n\n  /** The in-game year these states are tracking. Resets on new year. */\n  private currentYear: number = 1;\n\n  // Callbacks\n  private onFestivalStartCallbacks: Array<(festival: FestivalDef) => void> = [];\n  private onFestivalCompleteCallbacks: Array<(festival: FestivalDef, rewards: FestivalReward[]) => void> = [];\n\n  constructor() {\n    this.resetStates();\n  }\n\n  // ---------------------------------------------------------------------------\n  // Helpers\n  // ---------------------------------------------------------------------------\n\n  /** Reset all festival states for a new year. */\n  private resetStates(): void {\n    this.states.clear();\n    for (const festival of FESTIVALS) {\n      this.states.set(festival.id, { attended: false, completed: false });\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Public API — Festival Queries\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Check if a festival is happening on the given season and day.\n   * Returns the festival definition if one matches, or null.\n   */\n  checkFestival(season: string, day: number): FestivalDef | null {\n    for (const festival of FESTIVALS) {\n      if (festival.season === season && festival.day === day) {\n        return festival;\n      }\n    }\n    return null;\n  }\n\n  /** Get a festival definition by ID. */\n  getFestival(id: string): FestivalDef | null {\n    return FESTIVAL_DB.get(id) ?? null;\n  }\n\n  /** Get all festival definitions. */\n  getAllFestivals(): FestivalDef[] {\n    return [...FESTIVALS];\n  }\n\n  /** Get all festivals for a specific season. */\n  getFestivalsBySeason(season: string): FestivalDef[] {\n    return FESTIVALS.filter((f) => f.season === season);\n  }\n\n  /** Check if a festival has been attended this year. */\n  hasAttended(festivalId: string): boolean {\n    return this.states.get(festivalId)?.attended ?? false;\n  }\n\n  /** Check if a festival has been completed this year. */\n  hasCompleted(festivalId: string): boolean {\n    return this.states.get(festivalId)?.completed ?? false;\n  }\n\n  /** Get all festivals attended this year. */\n  getAttendedFestivals(): string[] {\n    const result: string[] = [];\n    for (const [id, state] of this.states) {\n      if (state.attended) result.push(id);\n    }\n    return result;\n  }\n\n  /** Get all festivals completed this year. */\n  getCompletedFestivals(): string[] {\n    const result: string[] = [];\n    for (const [id, state] of this.states) {\n      if (state.completed) result.push(id);\n    }\n    return result;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Public API — Festival Lifecycle\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Start attending a festival. Marks it as attended and fires the\n   * onFestivalStart callback.\n   * Returns false if the festival ID is invalid or already attended.\n   */\n  startFestival(id: string): boolean {\n    const festival = FESTIVAL_DB.get(id);\n    if (!festival) return false;\n\n    const state = this.states.get(id);\n    if (!state || state.attended) return false;\n\n    state.attended = true;\n\n    for (const cb of this.onFestivalStartCallbacks) {\n      cb(festival);\n    }\n\n    return true;\n  }\n\n  /**\n   * Complete a festival. Marks it as completed and fires the\n   * onFestivalComplete callback with rewards.\n   * Returns the rewards array, or null if the festival hasn't been\n   * attended or was already completed.\n   */\n  completeFestival(id: string): FestivalReward[] | null {\n    const festival = FESTIVAL_DB.get(id);\n    if (!festival) return null;\n\n    const state = this.states.get(id);\n    if (!state || !state.attended || state.completed) return null;\n\n    state.completed = true;\n\n    for (const cb of this.onFestivalCompleteCallbacks) {\n      cb(festival, festival.rewards);\n    }\n\n    return [...festival.rewards];\n  }\n\n  // ---------------------------------------------------------------------------\n  // Year Management\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Advance to a new year. Resets all festival attendance and completion\n   * tracking.\n   */\n  advanceYear(newYear: number): void {\n    this.currentYear = newYear;\n    this.resetStates();\n  }\n\n  /** Get the current tracked year. */\n  getCurrentYear(): number {\n    return this.currentYear;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Callbacks\n  // ---------------------------------------------------------------------------\n\n  /** Register a callback fired when a festival starts. */\n  onFestivalStart(cb: (festival: FestivalDef) => void): void {\n    this.onFestivalStartCallbacks.push(cb);\n  }\n\n  /** Register a callback fired when a festival is completed. */\n  onFestivalComplete(cb: (festival: FestivalDef, rewards: FestivalReward[]) => void): void {\n    this.onFestivalCompleteCallbacks.push(cb);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Persistence\n  // ---------------------------------------------------------------------------\n\n  /** Serialize for save. */\n  serialize(): FestivalSaveData {\n    const states: Record<string, FestivalState> = {};\n    for (const [id, state] of this.states) {\n      states[id] = { ...state };\n    }\n    return { year: this.currentYear, states };\n  }\n\n  /** Deserialize from save. */\n  deserialize(data: FestivalSaveData): void {\n    this.currentYear = data?.year ?? 1;\n    this.resetStates();\n\n    if (data?.states) {\n      for (const [id, state] of Object.entries(data.states)) {\n        if (this.states.has(id)) {\n          this.states.set(id, {\n            attended: state?.attended ?? false,\n            completed: state?.completed ?? false,\n          });\n        }\n      }\n    }\n  }\n}\n","/**\n * EDILAS (Phaser) - Romance Manager\n * Romance and marriage system with relationship stages, heart events,\n * gift preferences, dating, engagement, and marriage.\n *\n * Builds on RelationshipManager friendship points (1 heart = 250 pts there,\n * but romance stages use their own thresholds mapped to the same point scale).\n *\n * Phase 3 Stream E: Life Systems — Romance.\n */\n\nimport { NPCS, NPC_DB, NPCGiftPreference } from '../data/npcs';\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\n/** The 7 relationship stages in order. */\nexport type RelationshipStage =\n  | 'Stranger'\n  | 'Acquaintance'\n  | 'Friend'\n  | 'CloseFriend'\n  | 'Dating'\n  | 'Engaged'\n  | 'Married';\n\n/** Stage thresholds — minimum friendship points to reach each stage. */\nconst STAGE_THRESHOLDS: { stage: RelationshipStage; minPoints: number }[] = [\n  { stage: 'Stranger', minPoints: 0 },\n  { stage: 'Acquaintance', minPoints: 50 },\n  { stage: 'Friend', minPoints: 100 },\n  { stage: 'CloseFriend', minPoints: 200 },\n  { stage: 'Dating', minPoints: 300 },\n  { stage: 'Engaged', minPoints: 400 },\n  { stage: 'Married', minPoints: 500 },\n];\n\n/** Heart levels at which heart events trigger (2, 4, 6, 8, 10 hearts). */\nconst HEART_EVENT_LEVELS = [2, 4, 6, 8, 10] as const;\n\n/** Points per heart (mirrors RelationshipManager: 250 pts/heart). */\nconst POINTS_PER_HEART = 250;\n\n/** Birthday gift multiplier. */\nconst BIRTHDAY_MULTIPLIER = 8;\n\n/** Gift preference tier → base points. */\nexport type GiftTier = 'loved' | 'liked' | 'neutral' | 'disliked' | 'hated';\n\nconst GIFT_TIER_POINTS: Record<GiftTier, number> = {\n  loved: 80,\n  liked: 45,\n  neutral: 20,\n  disliked: -20,\n  hated: -40,\n};\n\n/** Per-NPC romance tracking state. */\ninterface RomanceState {\n  /** Whether the bouquet has been used to start dating. */\n  bouquetUsed: boolean;\n  /** Whether the pendant has been used to propose. */\n  pendantUsed: boolean;\n  /** Whether the NPC is currently married to the player. */\n  married: boolean;\n  /** Heart event levels that have been seen. */\n  heartEventsSeen: Set<number>;\n}\n\n/** Save data shape for the romance system. */\ninterface RomanceSaveData {\n  romanceStates: Record<string, {\n    bouquetUsed: boolean;\n    pendantUsed: boolean;\n    married: boolean;\n    heartEventsSeen: number[];\n  }>;\n}\n\n// ---------------------------------------------------------------------------\n// Romance Manager\n// ---------------------------------------------------------------------------\n\n/**\n * Manages the romance and marriage system. Works alongside RelationshipManager\n * to gate romance progression behind friendship point thresholds and special\n * item usage (bouquet for dating, pendant for engagement).\n */\nexport class RomanceManager {\n  /** Per-NPC romance tracking. */\n  private romanceStates: Map<string, RomanceState> = new Map();\n\n  // Callbacks\n  private heartEventCallbacks: Array<(npcId: string, heartLevel: number) => void> = [];\n  private stageChangeCallbacks: Array<(npcId: string, stage: RelationshipStage) => void> = [];\n\n  constructor() {\n    for (const npc of NPCS) {\n      this.romanceStates.set(npc.id, {\n        bouquetUsed: false,\n        pendantUsed: false,\n        married: false,\n        heartEventsSeen: new Set(),\n      });\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Stage Queries\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Get the current relationship stage for an NPC based on friendship points.\n   * Dating/Engaged/Married require the corresponding item usage flags.\n   *\n   * @param npcId  The NPC identifier.\n   * @param friendshipPoints  The current friendship points from RelationshipManager.\n   */\n  getStage(npcId: string, friendshipPoints: number): RelationshipStage {\n    const state = this.romanceStates.get(npcId);\n\n    // Married is the highest — check flag first\n    if (state?.married) return 'Married';\n    if (state?.pendantUsed && friendshipPoints >= 400) return 'Engaged';\n    if (state?.bouquetUsed && friendshipPoints >= 300) return 'Dating';\n\n    // Non-romance stages determined purely by points\n    let result: RelationshipStage = 'Stranger';\n    for (const { stage, minPoints } of STAGE_THRESHOLDS) {\n      // Skip romance-gated stages\n      if (stage === 'Dating' || stage === 'Engaged' || stage === 'Married') continue;\n      if (friendshipPoints >= minPoints) {\n        result = stage;\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Get the stage name as a display-friendly string.\n   */\n  getStageName(npcId: string, friendshipPoints: number): string {\n    return this.getStage(npcId, friendshipPoints);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Romance Actions\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Check if the player can start dating an NPC.\n   * Requires CloseFriend stage (>= 200 points) and the bouquet not yet used.\n   */\n  canDateNPC(npcId: string, friendshipPoints: number): boolean {\n    const state = this.romanceStates.get(npcId);\n    if (!state) return false;\n    if (state.bouquetUsed || state.married) return false;\n    return friendshipPoints >= 200; // CloseFriend threshold\n  }\n\n  /**\n   * Use a bouquet to start dating an NPC.\n   * Returns true on success, false if conditions are not met.\n   */\n  useBouquet(npcId: string, friendshipPoints: number): boolean {\n    if (!this.canDateNPC(npcId, friendshipPoints)) return false;\n    const state = this.romanceStates.get(npcId);\n    if (!state) return false;\n\n    state.bouquetUsed = true;\n\n    for (const cb of this.stageChangeCallbacks) {\n      cb(npcId, 'Dating');\n    }\n\n    return true;\n  }\n\n  /**\n   * Check if the player can propose to an NPC.\n   * Requires Dating stage (>= 300 points, bouquet used) and pendant not yet used.\n   */\n  canProposeNPC(npcId: string, friendshipPoints: number): boolean {\n    const state = this.romanceStates.get(npcId);\n    if (!state) return false;\n    if (!state.bouquetUsed || state.pendantUsed || state.married) return false;\n    return friendshipPoints >= 300; // Dating threshold\n  }\n\n  /**\n   * Use a pendant to propose to an NPC.\n   * Returns true on success, false if conditions are not met.\n   */\n  usePendant(npcId: string, friendshipPoints: number): boolean {\n    if (!this.canProposeNPC(npcId, friendshipPoints)) return false;\n    const state = this.romanceStates.get(npcId);\n    if (!state) return false;\n\n    state.pendantUsed = true;\n\n    for (const cb of this.stageChangeCallbacks) {\n      cb(npcId, 'Engaged');\n    }\n\n    return true;\n  }\n\n  /**\n   * Marry an NPC. Transitions to Married status.\n   * Requires Engaged stage (pendant used, >= 400 points).\n   * Returns true on success.\n   */\n  marry(npcId: string, friendshipPoints: number): boolean {\n    const state = this.romanceStates.get(npcId);\n    if (!state) return false;\n    if (!state.pendantUsed || state.married) return false;\n    if (friendshipPoints < 400) return false;\n\n    state.married = true;\n\n    for (const cb of this.stageChangeCallbacks) {\n      cb(npcId, 'Married');\n    }\n\n    return true;\n  }\n\n  /** Check if an NPC is currently married to the player. */\n  isMarried(npcId: string): boolean {\n    return this.romanceStates.get(npcId)?.married ?? false;\n  }\n\n  /** Check if the player is dating an NPC (bouquet used). */\n  isDating(npcId: string): boolean {\n    const state = this.romanceStates.get(npcId);\n    return state?.bouquetUsed === true && !state?.married;\n  }\n\n  /** Get the NPC the player is married to, if any. */\n  getSpouse(): string | null {\n    for (const [npcId, state] of this.romanceStates) {\n      if (state.married) return npcId;\n    }\n    return null;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Heart Events\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Get heart events that have been seen for an NPC.\n   * Returns an array of heart levels (e.g. [2, 4]).\n   */\n  getHeartEvents(npcId: string): number[] {\n    const state = this.romanceStates.get(npcId);\n    if (!state) return [];\n    return Array.from(state.heartEventsSeen).sort((a, b) => a - b);\n  }\n\n  /**\n   * Mark a heart event as seen for an NPC.\n   * Only valid heart levels are 2, 4, 6, 8, 10.\n   */\n  markHeartEventSeen(npcId: string, heartLevel: number): void {\n    const state = this.romanceStates.get(npcId);\n    if (!state) return;\n    if (!(HEART_EVENT_LEVELS as readonly number[]).includes(heartLevel)) return;\n\n    if (!state.heartEventsSeen.has(heartLevel)) {\n      state.heartEventsSeen.add(heartLevel);\n\n      for (const cb of this.heartEventCallbacks) {\n        cb(npcId, heartLevel);\n      }\n    }\n  }\n\n  /**\n   * Check if a heart event is available (not yet seen and points are sufficient).\n   *\n   * @param npcId  The NPC identifier.\n   * @param friendshipPoints  Current friendship points.\n   */\n  getAvailableHeartEvents(npcId: string, friendshipPoints: number): number[] {\n    const state = this.romanceStates.get(npcId);\n    if (!state) return [];\n\n    const currentHearts = Math.floor(friendshipPoints / POINTS_PER_HEART);\n    const available: number[] = [];\n\n    for (const level of HEART_EVENT_LEVELS) {\n      if (currentHearts >= level && !state.heartEventsSeen.has(level)) {\n        available.push(level);\n      }\n    }\n\n    return available;\n  }\n\n  /** Check if a specific heart event has been seen. */\n  hasSeenHeartEvent(npcId: string, heartLevel: number): boolean {\n    return this.romanceStates.get(npcId)?.heartEventsSeen.has(heartLevel) ?? false;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Gift Preferences\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Get the gift preference tier for an NPC and item.\n   * Delegates to the NPC's gift data.\n   */\n  getGiftPreference(npcId: string, itemId: string): GiftTier {\n    const npc = NPC_DB.get(npcId);\n    if (!npc) return 'neutral';\n\n    if (npc.gifts.loved.includes(itemId)) return 'loved';\n    if (npc.gifts.liked.includes(itemId)) return 'liked';\n    if (npc.gifts.hated.includes(itemId)) return 'hated';\n    if (npc.gifts.disliked.includes(itemId)) return 'disliked';\n    return 'neutral';\n  }\n\n  /**\n   * Calculate gift points including birthday multiplier.\n   *\n   * @param npcId  The NPC identifier.\n   * @param itemId  The item being gifted.\n   * @param isBirthday  Whether today is the NPC's birthday.\n   */\n  calculateGiftPoints(npcId: string, itemId: string, isBirthday: boolean = false): number {\n    const tier = this.getGiftPreference(npcId, itemId);\n    let points = GIFT_TIER_POINTS[tier];\n\n    if (isBirthday) {\n      points *= BIRTHDAY_MULTIPLIER;\n    }\n\n    return points;\n  }\n\n  /**\n   * Get the full gift preference lists for an NPC.\n   * Returns null if the NPC is not found.\n   */\n  getGiftPreferences(npcId: string): NPCGiftPreference | null {\n    const npc = NPC_DB.get(npcId);\n    return npc?.gifts ?? null;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Callbacks\n  // ---------------------------------------------------------------------------\n\n  /** Register a callback fired when a heart event is triggered. */\n  onHeartEvent(cb: (npcId: string, heartLevel: number) => void): void {\n    this.heartEventCallbacks.push(cb);\n  }\n\n  /** Register a callback fired when a relationship stage changes. */\n  onStageChange(cb: (npcId: string, stage: RelationshipStage) => void): void {\n    this.stageChangeCallbacks.push(cb);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Persistence\n  // ---------------------------------------------------------------------------\n\n  /** Serialize for save. */\n  serialize(): RomanceSaveData {\n    const romanceStates: RomanceSaveData['romanceStates'] = {};\n    for (const [npcId, state] of this.romanceStates) {\n      romanceStates[npcId] = {\n        bouquetUsed: state.bouquetUsed,\n        pendantUsed: state.pendantUsed,\n        married: state.married,\n        heartEventsSeen: Array.from(state.heartEventsSeen),\n      };\n    }\n    return { romanceStates };\n  }\n\n  /** Deserialize from save. */\n  deserialize(data: RomanceSaveData): void {\n    if (!data?.romanceStates) return;\n\n    for (const [npcId, saved] of Object.entries(data.romanceStates)) {\n      let state = this.romanceStates.get(npcId);\n      if (!state) {\n        state = {\n          bouquetUsed: false,\n          pendantUsed: false,\n          married: false,\n          heartEventsSeen: new Set(),\n        };\n        this.romanceStates.set(npcId, state);\n      }\n\n      state.bouquetUsed = saved?.bouquetUsed ?? false;\n      state.pendantUsed = saved?.pendantUsed ?? false;\n      state.married = saved?.married ?? false;\n      state.heartEventsSeen = new Set(saved?.heartEventsSeen ?? []);\n    }\n  }\n}\n","/**\n * EDILAS (Phaser) - Career Manager\n * Career progression system with 5 careers, 10 levels each, and\n * specializations at level 5 and level 10.\n *\n * Phase 3 Stream E: Life Systems — Careers.\n */\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\n/** Bonuses granted by a career. */\nexport interface CareerBonuses {\n  /** Multiplier for gold earned from career-related activities. */\n  incomeMultiplier: number;\n  /** Multiplier for career-specific XP gain. */\n  xpMultiplier: number;\n}\n\n/** A specialization unlocked at a specific career level. */\nexport interface CareerSpecialization {\n  id: string;\n  name: string;\n  description: string;\n  level: number;        // The career level at which this unlocks (5 or 10)\n  bonuses: CareerBonuses;\n}\n\n/** Static definition for a career. */\nexport interface CareerDef {\n  id: string;\n  name: string;\n  description: string;\n  bonuses: CareerBonuses;\n  /** XP required to reach each level (index 0 = level 1, index 9 = level 10). */\n  xpPerLevel: number[];\n  specializations: CareerSpecialization[];\n}\n\n/** Save data shape. */\ninterface CareerSaveData {\n  selectedCareerId: string | null;\n  careerXP: number;\n  careerLevel: number;\n  selectedSpecializationIds: string[];\n}\n\n// ---------------------------------------------------------------------------\n// Career Definitions\n// ---------------------------------------------------------------------------\n\n/**\n * All 5 careers with their bonuses, XP curves, and specializations.\n */\nexport const CAREERS: CareerDef[] = [\n  {\n    id: 'farmer',\n    name: 'Farmer',\n    description:\n      'Master the land and its bounty. Farmers earn more from crops and gain farming XP faster. Specializations unlock advanced growing techniques.',\n    bonuses: { incomeMultiplier: 1.2, xpMultiplier: 1.15 },\n    xpPerLevel: [100, 200, 350, 550, 800, 1100, 1500, 2000, 2600, 3500],\n    specializations: [\n      {\n        id: 'rancher',\n        name: 'Rancher',\n        description: 'Animal products sell for 20% more. Animals have higher quality produce.',\n        level: 5,\n        bonuses: { incomeMultiplier: 1.2, xpMultiplier: 1.1 },\n      },\n      {\n        id: 'artisan',\n        name: 'Artisan',\n        description: 'Artisan goods (wine, cheese, preserves) sell for 40% more.',\n        level: 5,\n        bonuses: { incomeMultiplier: 1.4, xpMultiplier: 1.0 },\n      },\n      {\n        id: 'agriculturist',\n        name: 'Agriculturist',\n        description: 'Crops grow 10% faster. Rare seed yields doubled.',\n        level: 10,\n        bonuses: { incomeMultiplier: 1.1, xpMultiplier: 1.2 },\n      },\n      {\n        id: 'shepherd',\n        name: 'Shepherd',\n        description: 'Animals befriend faster. Wool and milk quality always gold-star.',\n        level: 10,\n        bonuses: { incomeMultiplier: 1.15, xpMultiplier: 1.15 },\n      },\n    ],\n  },\n  {\n    id: 'fisher',\n    name: 'Fisher',\n    description:\n      'Rule the waters. Fishers catch rarer fish and earn more from their hauls. Specializations unlock legendary techniques.',\n    bonuses: { incomeMultiplier: 1.25, xpMultiplier: 1.15 },\n    xpPerLevel: [80, 180, 320, 500, 750, 1050, 1400, 1900, 2500, 3300],\n    specializations: [\n      {\n        id: 'angler',\n        name: 'Angler',\n        description: 'Fish sell for 50% more. Rare fish appear more frequently.',\n        level: 5,\n        bonuses: { incomeMultiplier: 1.5, xpMultiplier: 1.0 },\n      },\n      {\n        id: 'trapper',\n        name: 'Trapper',\n        description: 'Crab pots no longer require bait. Trap yield doubled.',\n        level: 5,\n        bonuses: { incomeMultiplier: 1.1, xpMultiplier: 1.2 },\n      },\n      {\n        id: 'pirate',\n        name: 'Pirate',\n        description: 'Chance to find treasure chests doubled while fishing.',\n        level: 10,\n        bonuses: { incomeMultiplier: 1.3, xpMultiplier: 1.1 },\n      },\n      {\n        id: 'mariner',\n        name: 'Mariner',\n        description: 'Crab pots never catch junk. Legendary fish easier to reel in.',\n        level: 10,\n        bonuses: { incomeMultiplier: 1.2, xpMultiplier: 1.15 },\n      },\n    ],\n  },\n  {\n    id: 'tavern_keep',\n    name: 'TavernKeep',\n    description:\n      'Serve the community. TavernKeeps earn more from cooked meals and drinks, and gain social XP faster through conversations.',\n    bonuses: { incomeMultiplier: 1.15, xpMultiplier: 1.2 },\n    xpPerLevel: [90, 190, 330, 520, 770, 1080, 1450, 1950, 2550, 3400],\n    specializations: [\n      {\n        id: 'brewmaster',\n        name: 'Brewmaster',\n        description: 'Beverages sell for 35% more. New exclusive drink recipes unlocked.',\n        level: 5,\n        bonuses: { incomeMultiplier: 1.35, xpMultiplier: 1.05 },\n      },\n      {\n        id: 'host',\n        name: 'Host',\n        description: 'Friendship gained from talking is doubled. NPCs visit the tavern more often.',\n        level: 5,\n        bonuses: { incomeMultiplier: 1.1, xpMultiplier: 1.25 },\n      },\n      {\n        id: 'entertainer',\n        name: 'Entertainer',\n        description: 'Festival rewards doubled. Special festival dialogue options.',\n        level: 10,\n        bonuses: { incomeMultiplier: 1.2, xpMultiplier: 1.2 },\n      },\n      {\n        id: 'restaurateur',\n        name: 'Restaurateur',\n        description: 'All food items sell for 30% more. Tavern generates passive daily income.',\n        level: 10,\n        bonuses: { incomeMultiplier: 1.3, xpMultiplier: 1.1 },\n      },\n    ],\n  },\n  {\n    id: 'chef',\n    name: 'Chef',\n    description:\n      'Culinary mastery at its finest. Chefs craft higher-quality food with better buffs and sell cooked dishes for premium prices.',\n    bonuses: { incomeMultiplier: 1.2, xpMultiplier: 1.15 },\n    xpPerLevel: [100, 200, 350, 550, 800, 1100, 1500, 2000, 2600, 3500],\n    specializations: [\n      {\n        id: 'gourmet',\n        name: 'Gourmet',\n        description: 'Cooked dishes always have +1 quality star. Buff durations extended 25%.',\n        level: 5,\n        bonuses: { incomeMultiplier: 1.25, xpMultiplier: 1.1 },\n      },\n      {\n        id: 'baker',\n        name: 'Baker',\n        description: 'Baked goods heal 50% more. New exclusive pastry recipes unlocked.',\n        level: 5,\n        bonuses: { incomeMultiplier: 1.15, xpMultiplier: 1.15 },\n      },\n      {\n        id: 'master_chef',\n        name: 'Master Chef',\n        description: 'All cooking requires 1 fewer ingredient (min 1). Legendary recipe unlocked.',\n        level: 10,\n        bonuses: { incomeMultiplier: 1.3, xpMultiplier: 1.15 },\n      },\n      {\n        id: 'alchemist_chef',\n        name: 'Alchemist Chef',\n        description: 'Food can grant potion-like buffs. New fusion recipes unlocked.',\n        level: 10,\n        bonuses: { incomeMultiplier: 1.2, xpMultiplier: 1.2 },\n      },\n    ],\n  },\n  {\n    id: 'adventurer',\n    name: 'Adventurer',\n    description:\n      'Seek glory in the dungeons. Adventurers deal more damage, find better loot, and gain combat XP faster.',\n    bonuses: { incomeMultiplier: 1.15, xpMultiplier: 1.2 },\n    xpPerLevel: [120, 250, 400, 600, 900, 1250, 1700, 2200, 2900, 3800],\n    specializations: [\n      {\n        id: 'warrior',\n        name: 'Warrior',\n        description: 'Melee damage +15%. Block chance +10%.',\n        level: 5,\n        bonuses: { incomeMultiplier: 1.1, xpMultiplier: 1.15 },\n      },\n      {\n        id: 'scout',\n        name: 'Scout',\n        description: 'Move 10% faster in dungeons. Trap detection range doubled.',\n        level: 5,\n        bonuses: { incomeMultiplier: 1.15, xpMultiplier: 1.1 },\n      },\n      {\n        id: 'champion',\n        name: 'Champion',\n        description: 'Critical hit chance +20%. Boss loot quality improved.',\n        level: 10,\n        bonuses: { incomeMultiplier: 1.25, xpMultiplier: 1.15 },\n      },\n      {\n        id: 'treasure_hunter',\n        name: 'Treasure Hunter',\n        description: 'Rare loot drop rate doubled. Secret rooms always revealed.',\n        level: 10,\n        bonuses: { incomeMultiplier: 1.35, xpMultiplier: 1.1 },\n      },\n    ],\n  },\n];\n\n/** Lookup map for career definitions by ID. */\nexport const CAREER_DB = new Map<string, CareerDef>(\n  CAREERS.map((c) => [c.id, c])\n);\n\n// ---------------------------------------------------------------------------\n// Career Manager\n// ---------------------------------------------------------------------------\n\n/**\n * Manages career selection, XP accumulation, leveling, and specialization\n * choices. A career is a one-time choice that provides passive bonuses and\n * unlocks specializations at level 5 and 10.\n */\nexport class CareerManager {\n  /** The selected career ID, or null if none chosen. */\n  private selectedCareerId: string | null = null;\n\n  /** Accumulated career-specific XP. */\n  private careerXP: number = 0;\n\n  /** Current career level (1-10). 0 if no career selected. */\n  private careerLevel: number = 0;\n\n  /** Chosen specialization IDs (up to 2: one at level 5, one at level 10). */\n  private selectedSpecializationIds: Set<string> = new Set();\n\n  // Callbacks\n  private levelUpCallbacks: Array<(level: number) => void> = [];\n  private specializationCallbacks: Array<(specId: string) => void> = [];\n\n  // ---------------------------------------------------------------------------\n  // Career Selection\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Select a career. This is a one-time choice.\n   * Returns true on success, false if a career is already selected or the ID is invalid.\n   */\n  selectCareer(careerId: string): boolean {\n    if (this.selectedCareerId !== null) return false;\n    if (!CAREER_DB.has(careerId)) return false;\n\n    this.selectedCareerId = careerId;\n    this.careerXP = 0;\n    this.careerLevel = 1;\n\n    return true;\n  }\n\n  /** Get the selected career definition, or null if none chosen. */\n  getCareer(): CareerDef | null {\n    if (!this.selectedCareerId) return null;\n    return CAREER_DB.get(this.selectedCareerId) ?? null;\n  }\n\n  /** Get the selected career ID, or null. */\n  getCareerId(): string | null {\n    return this.selectedCareerId;\n  }\n\n  /** Whether a career has been selected. */\n  hasCareer(): boolean {\n    return this.selectedCareerId !== null;\n  }\n\n  // ---------------------------------------------------------------------------\n  // XP & Leveling\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Add career-specific XP. Triggers level-up callbacks as appropriate.\n   * XP multiplier from career bonuses is applied externally (by the caller).\n   */\n  addCareerXP(amount: number): void {\n    if (!this.selectedCareerId || amount <= 0) return;\n\n    const career = CAREER_DB.get(this.selectedCareerId);\n    if (!career) return;\n\n    const prevLevel = this.careerLevel;\n    this.careerXP += amount;\n\n    // Recalculate level\n    const newLevel = this.computeLevel(career);\n    this.careerLevel = newLevel;\n\n    // Fire callbacks for each level gained\n    for (let lvl = prevLevel + 1; lvl <= newLevel; lvl++) {\n      for (const cb of this.levelUpCallbacks) {\n        cb(lvl);\n      }\n    }\n  }\n\n  /** Get the current career level (1-10, or 0 if no career). */\n  getCareerLevel(): number {\n    return this.careerLevel;\n  }\n\n  /** Get career XP info. */\n  getCareerXP(): { current: number; required: number; total: number } {\n    if (!this.selectedCareerId) {\n      return { current: 0, required: 0, total: 0 };\n    }\n\n    const career = CAREER_DB.get(this.selectedCareerId);\n    if (!career) return { current: 0, required: 0, total: 0 };\n\n    let xpSpent = 0;\n    for (let i = 0; i < this.careerLevel - 1 && i < career.xpPerLevel.length; i++) {\n      xpSpent += career.xpPerLevel[i];\n    }\n\n    const current = this.careerXP - xpSpent;\n    const required = this.careerLevel <= career.xpPerLevel.length\n      ? career.xpPerLevel[this.careerLevel - 1] ?? 0\n      : 0;\n\n    return { current: Math.max(0, current), required, total: this.careerXP };\n  }\n\n  // ---------------------------------------------------------------------------\n  // Specializations\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Get available specializations at the current level.\n   * Returns specializations that match the current level threshold\n   * and have not yet been chosen.\n   */\n  getAvailableSpecializations(): CareerSpecialization[] {\n    const career = this.getCareer();\n    if (!career) return [];\n\n    return career.specializations.filter(\n      (s) => s.level <= this.careerLevel && !this.selectedSpecializationIds.has(s.id)\n    );\n  }\n\n  /**\n   * Choose a specialization. Only one specialization per level tier (5 or 10).\n   * Returns true on success.\n   */\n  selectSpecialization(specId: string): boolean {\n    const career = this.getCareer();\n    if (!career) return false;\n\n    const spec = career.specializations.find((s) => s.id === specId);\n    if (!spec) return false;\n    if (spec.level > this.careerLevel) return false;\n\n    // Check if a spec at this tier is already chosen\n    const sameTierChosen = career.specializations.some(\n      (s) => s.level === spec.level && this.selectedSpecializationIds.has(s.id)\n    );\n    if (sameTierChosen) return false;\n\n    this.selectedSpecializationIds.add(specId);\n\n    for (const cb of this.specializationCallbacks) {\n      cb(specId);\n    }\n\n    return true;\n  }\n\n  /** Get all chosen specializations. */\n  getSelectedSpecializations(): CareerSpecialization[] {\n    const career = this.getCareer();\n    if (!career) return [];\n\n    return career.specializations.filter((s) => this.selectedSpecializationIds.has(s.id));\n  }\n\n  /** Check if a specialization is selected. */\n  hasSpecialization(specId: string): boolean {\n    return this.selectedSpecializationIds.has(specId);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Bonuses\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Get the effective income multiplier including career base and specialization bonuses.\n   */\n  getEffectiveIncomeMultiplier(): number {\n    const career = this.getCareer();\n    if (!career) return 1.0;\n\n    let mult = career.bonuses.incomeMultiplier;\n    for (const spec of this.getSelectedSpecializations()) {\n      mult *= spec.bonuses.incomeMultiplier;\n    }\n    return mult;\n  }\n\n  /**\n   * Get the effective XP multiplier including career base and specialization bonuses.\n   */\n  getEffectiveXPMultiplier(): number {\n    const career = this.getCareer();\n    if (!career) return 1.0;\n\n    let mult = career.bonuses.xpMultiplier;\n    for (const spec of this.getSelectedSpecializations()) {\n      mult *= spec.bonuses.xpMultiplier;\n    }\n    return mult;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Callbacks\n  // ---------------------------------------------------------------------------\n\n  /** Register a callback fired on career level-up. */\n  onLevelUp(cb: (level: number) => void): void {\n    this.levelUpCallbacks.push(cb);\n  }\n\n  /** Register a callback fired when a specialization is chosen. */\n  onSpecialization(cb: (specId: string) => void): void {\n    this.specializationCallbacks.push(cb);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Persistence\n  // ---------------------------------------------------------------------------\n\n  /** Serialize for save. */\n  serialize(): CareerSaveData {\n    return {\n      selectedCareerId: this.selectedCareerId,\n      careerXP: this.careerXP,\n      careerLevel: this.careerLevel,\n      selectedSpecializationIds: Array.from(this.selectedSpecializationIds),\n    };\n  }\n\n  /** Deserialize from save. */\n  deserialize(data: CareerSaveData): void {\n    this.selectedCareerId = data?.selectedCareerId ?? null;\n    this.careerXP = data?.careerXP ?? 0;\n    this.careerLevel = data?.careerLevel ?? 0;\n    this.selectedSpecializationIds = new Set(data?.selectedSpecializationIds ?? []);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Internal\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Compute career level from accumulated XP.\n   * Level starts at 1 once a career is selected.\n   */\n  private computeLevel(career: CareerDef): number {\n    let remaining = this.careerXP;\n    for (let lvl = 0; lvl < career.xpPerLevel.length; lvl++) {\n      if (remaining < career.xpPerLevel[lvl]) return lvl + 1;\n      remaining -= career.xpPerLevel[lvl];\n    }\n    return career.xpPerLevel.length + 1 > 10 ? 10 : career.xpPerLevel.length + 1;\n  }\n}\n","/**\n * EDILAS (Phaser) - Achievement Manager\n * Tracks player achievements across 5 categories with bronze/silver/gold tiers.\n * 30 total achievements (6 per category) with meaningful progression thresholds.\n *\n * Phase 3 Stream E: Life Systems — Achievements.\n */\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\n/** Achievement categories. */\nexport type AchievementCategory = 'Farming' | 'Fishing' | 'Combat' | 'Social' | 'Exploration';\n\n/** Tier thresholds for an achievement. */\nexport interface AchievementTier {\n  bronze: number;\n  silver: number;\n  gold: number;\n}\n\n/** Tier level a player has reached. */\nexport type TierLevel = 'none' | 'bronze' | 'silver' | 'gold';\n\n/** Static definition for an achievement. */\nexport interface AchievementDef {\n  id: string;\n  name: string;\n  description: string;\n  category: AchievementCategory;\n  tiers: AchievementTier;\n}\n\n/** Result of checking an achievement's progress. */\nexport interface AchievementProgress {\n  id: string;\n  name: string;\n  description: string;\n  category: AchievementCategory;\n  currentValue: number;\n  tier: TierLevel;\n  tiers: AchievementTier;\n}\n\n/** Save data shape. */\ninterface AchievementSaveData {\n  progress: Record<string, number>;\n}\n\n// ---------------------------------------------------------------------------\n// Achievement Definitions — 30 total (6 per category)\n// ---------------------------------------------------------------------------\n\nexport const ACHIEVEMENTS: AchievementDef[] = [\n  // =========================================================================\n  // Farming (6)\n  // =========================================================================\n  {\n    id: 'crops_harvested',\n    name: 'Green Thumb',\n    description: 'Harvest crops from your farm.',\n    category: 'Farming',\n    tiers: { bronze: 50, silver: 250, gold: 1000 },\n  },\n  {\n    id: 'gold_star_crops',\n    name: 'Quality Farmer',\n    description: 'Harvest gold-star quality crops.',\n    category: 'Farming',\n    tiers: { bronze: 10, silver: 50, gold: 200 },\n  },\n  {\n    id: 'seeds_planted',\n    name: 'Sower of Fields',\n    description: 'Plant seeds on your farm.',\n    category: 'Farming',\n    tiers: { bronze: 100, silver: 500, gold: 2000 },\n  },\n  {\n    id: 'animals_raised',\n    name: 'Animal Whisperer',\n    description: 'Raise farm animals to maximum happiness.',\n    category: 'Farming',\n    tiers: { bronze: 5, silver: 15, gold: 50 },\n  },\n  {\n    id: 'artisan_goods_crafted',\n    name: 'Artisan Master',\n    description: 'Craft artisan goods (wine, cheese, preserves, etc.).',\n    category: 'Farming',\n    tiers: { bronze: 25, silver: 100, gold: 500 },\n  },\n  {\n    id: 'total_gold_earned_farming',\n    name: 'Harvest Tycoon',\n    description: 'Earn gold from selling farm products.',\n    category: 'Farming',\n    tiers: { bronze: 5000, silver: 50000, gold: 500000 },\n  },\n\n  // =========================================================================\n  // Fishing (6)\n  // =========================================================================\n  {\n    id: 'fish_caught',\n    name: 'Angler',\n    description: 'Catch fish from various bodies of water.',\n    category: 'Fishing',\n    tiers: { bronze: 25, silver: 100, gold: 500 },\n  },\n  {\n    id: 'unique_fish_caught',\n    name: 'Ichthyologist',\n    description: 'Catch different species of fish.',\n    category: 'Fishing',\n    tiers: { bronze: 10, silver: 25, gold: 50 },\n  },\n  {\n    id: 'legendary_fish_caught',\n    name: 'Legend of the Lake',\n    description: 'Catch legendary fish.',\n    category: 'Fishing',\n    tiers: { bronze: 1, silver: 3, gold: 5 },\n  },\n  {\n    id: 'perfect_catches',\n    name: 'Perfect Cast',\n    description: 'Achieve perfect catches (fish never leaves the bar).',\n    category: 'Fishing',\n    tiers: { bronze: 10, silver: 50, gold: 200 },\n  },\n  {\n    id: 'crab_pot_harvests',\n    name: 'Trap Master',\n    description: 'Harvest items from crab pots.',\n    category: 'Fishing',\n    tiers: { bronze: 25, silver: 100, gold: 500 },\n  },\n  {\n    id: 'total_gold_earned_fishing',\n    name: 'Master Angler',\n    description: 'Earn gold from selling fish and seafood.',\n    category: 'Fishing',\n    tiers: { bronze: 2500, silver: 25000, gold: 250000 },\n  },\n\n  // =========================================================================\n  // Combat (6)\n  // =========================================================================\n  {\n    id: 'enemies_defeated',\n    name: 'Monster Slayer',\n    description: 'Defeat enemies in combat.',\n    category: 'Combat',\n    tiers: { bronze: 50, silver: 250, gold: 1000 },\n  },\n  {\n    id: 'bosses_defeated',\n    name: 'Boss Hunter',\n    description: 'Defeat boss monsters.',\n    category: 'Combat',\n    tiers: { bronze: 3, silver: 10, gold: 25 },\n  },\n  {\n    id: 'dungeon_floors_cleared',\n    name: 'Dungeon Delver',\n    description: 'Clear dungeon floors.',\n    category: 'Combat',\n    tiers: { bronze: 25, silver: 100, gold: 500 },\n  },\n  {\n    id: 'critical_hits',\n    name: 'Precision Strike',\n    description: 'Land critical hits on enemies.',\n    category: 'Combat',\n    tiers: { bronze: 50, silver: 250, gold: 1000 },\n  },\n  {\n    id: 'rift_waves_survived',\n    name: 'Rift Walker',\n    description: 'Survive waves in the Rift.',\n    category: 'Combat',\n    tiers: { bronze: 10, silver: 50, gold: 200 },\n  },\n  {\n    id: 'damage_dealt_total',\n    name: 'Wrath Incarnate',\n    description: 'Deal total damage to enemies.',\n    category: 'Combat',\n    tiers: { bronze: 10000, silver: 100000, gold: 1000000 },\n  },\n\n  // =========================================================================\n  // Social (6)\n  // =========================================================================\n  {\n    id: 'npcs_befriended',\n    name: 'Friendly Neighbor',\n    description: 'Reach 5+ hearts with different NPCs.',\n    category: 'Social',\n    tiers: { bronze: 3, silver: 8, gold: 15 },\n  },\n  {\n    id: 'gifts_given',\n    name: 'Generous Soul',\n    description: 'Give gifts to NPCs.',\n    category: 'Social',\n    tiers: { bronze: 25, silver: 100, gold: 500 },\n  },\n  {\n    id: 'heart_events_seen',\n    name: 'Storyteller',\n    description: 'Witness heart events with NPCs.',\n    category: 'Social',\n    tiers: { bronze: 5, silver: 15, gold: 40 },\n  },\n  {\n    id: 'festivals_attended',\n    name: 'Life of the Party',\n    description: 'Attend seasonal festivals.',\n    category: 'Social',\n    tiers: { bronze: 4, silver: 16, gold: 40 },\n  },\n  {\n    id: 'quests_completed',\n    name: 'Helpful Hand',\n    description: 'Complete quests for townsfolk.',\n    category: 'Social',\n    tiers: { bronze: 10, silver: 30, gold: 100 },\n  },\n  {\n    id: 'npc_max_hearts',\n    name: 'Beloved',\n    description: 'Reach maximum hearts (10) with NPCs.',\n    category: 'Social',\n    tiers: { bronze: 1, silver: 5, gold: 10 },\n  },\n\n  // =========================================================================\n  // Exploration (6)\n  // =========================================================================\n  {\n    id: 'biomes_discovered',\n    name: 'Trailblazer',\n    description: 'Discover different biomes.',\n    category: 'Exploration',\n    tiers: { bronze: 2, silver: 5, gold: 7 },\n  },\n  {\n    id: 'chunks_explored',\n    name: 'Cartographer',\n    description: 'Explore map chunks.',\n    category: 'Exploration',\n    tiers: { bronze: 50, silver: 200, gold: 1000 },\n  },\n  {\n    id: 'items_collected',\n    name: 'Collector',\n    description: 'Collect unique items.',\n    category: 'Exploration',\n    tiers: { bronze: 50, silver: 150, gold: 400 },\n  },\n  {\n    id: 'treasure_chests_opened',\n    name: 'Fortune Seeker',\n    description: 'Open treasure chests found in the world.',\n    category: 'Exploration',\n    tiers: { bronze: 10, silver: 50, gold: 200 },\n  },\n  {\n    id: 'corruption_purified',\n    name: 'Purifier',\n    description: 'Purify corrupted tiles.',\n    category: 'Exploration',\n    tiers: { bronze: 100, silver: 500, gold: 2000 },\n  },\n  {\n    id: 'secrets_found',\n    name: 'Secret Keeper',\n    description: 'Discover hidden secrets and locations.',\n    category: 'Exploration',\n    tiers: { bronze: 5, silver: 15, gold: 50 },\n  },\n];\n\n/** Lookup map for achievement definitions by ID. */\nexport const ACHIEVEMENT_DB = new Map<string, AchievementDef>(\n  ACHIEVEMENTS.map((a) => [a.id, a])\n);\n\n// ---------------------------------------------------------------------------\n// Achievement Manager\n// ---------------------------------------------------------------------------\n\n/**\n * Tracks player progress toward achievements across 5 categories.\n * Each achievement has bronze, silver, and gold tiers with numeric thresholds.\n * Progress is accumulated via `trackProgress()` and persisted via serialize/deserialize.\n */\nexport class AchievementManager {\n  /** Accumulated progress per achievement ID. */\n  private progress: Map<string, number> = new Map();\n\n  // Callbacks\n  private onUnlockCallbacks: Array<(achievementId: string, tier: TierLevel) => void> = [];\n\n  constructor() {\n    for (const achievement of ACHIEVEMENTS) {\n      this.progress.set(achievement.id, 0);\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Progress Tracking\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Add progress toward an achievement.\n   * Fires onAchievementUnlock callbacks when a new tier is reached.\n   *\n   * @param achievementId  The achievement to track.\n   * @param amount  The amount to add (default 1).\n   */\n  trackProgress(achievementId: string, amount: number = 1): void {\n    const def = ACHIEVEMENT_DB.get(achievementId);\n    if (!def || amount <= 0) return;\n\n    const prevValue = this.progress.get(achievementId) ?? 0;\n    const prevTier = this.computeTier(def, prevValue);\n\n    const newValue = prevValue + amount;\n    this.progress.set(achievementId, newValue);\n\n    const newTier = this.computeTier(def, newValue);\n\n    // Check if we crossed any tier thresholds\n    if (newTier !== prevTier) {\n      // Fire callbacks for each tier crossed\n      const tierOrder: TierLevel[] = ['none', 'bronze', 'silver', 'gold'];\n      const prevIdx = tierOrder.indexOf(prevTier);\n      const newIdx = tierOrder.indexOf(newTier);\n\n      for (let i = prevIdx + 1; i <= newIdx; i++) {\n        const tier = tierOrder[i];\n        if (tier !== 'none') {\n          for (const cb of this.onUnlockCallbacks) {\n            cb(achievementId, tier);\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Set progress to an exact value (useful for achievements that track\n   * a current state rather than cumulative, like \"unique fish caught\").\n   */\n  setProgress(achievementId: string, value: number): void {\n    const def = ACHIEVEMENT_DB.get(achievementId);\n    if (!def) return;\n\n    const prevValue = this.progress.get(achievementId) ?? 0;\n    if (value <= prevValue) return; // Only allow increases\n\n    const prevTier = this.computeTier(def, prevValue);\n    this.progress.set(achievementId, value);\n    const newTier = this.computeTier(def, value);\n\n    if (newTier !== prevTier) {\n      const tierOrder: TierLevel[] = ['none', 'bronze', 'silver', 'gold'];\n      const prevIdx = tierOrder.indexOf(prevTier);\n      const newIdx = tierOrder.indexOf(newTier);\n\n      for (let i = prevIdx + 1; i <= newIdx; i++) {\n        const tier = tierOrder[i];\n        if (tier !== 'none') {\n          for (const cb of this.onUnlockCallbacks) {\n            cb(achievementId, tier);\n          }\n        }\n      }\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Queries\n  // ---------------------------------------------------------------------------\n\n  /** Get progress and tier info for a specific achievement. */\n  getAchievementProgress(achievementId: string): AchievementProgress | null {\n    const def = ACHIEVEMENT_DB.get(achievementId);\n    if (!def) return null;\n\n    const currentValue = this.progress.get(achievementId) ?? 0;\n    const tier = this.computeTier(def, currentValue);\n\n    return {\n      id: def.id,\n      name: def.name,\n      description: def.description,\n      category: def.category,\n      currentValue,\n      tier,\n      tiers: { ...def.tiers },\n    };\n  }\n\n  /** Get all achievements that have reached at least bronze tier. */\n  getUnlocked(): AchievementProgress[] {\n    const unlocked: AchievementProgress[] = [];\n    for (const def of ACHIEVEMENTS) {\n      const value = this.progress.get(def.id) ?? 0;\n      const tier = this.computeTier(def, value);\n      if (tier !== 'none') {\n        unlocked.push({\n          id: def.id,\n          name: def.name,\n          description: def.description,\n          category: def.category,\n          currentValue: value,\n          tier,\n          tiers: { ...def.tiers },\n        });\n      }\n    }\n    return unlocked;\n  }\n\n  /** Get all achievements filtered by category. */\n  getByCategory(category: AchievementCategory): AchievementProgress[] {\n    return ACHIEVEMENTS\n      .filter((def) => def.category === category)\n      .map((def) => {\n        const value = this.progress.get(def.id) ?? 0;\n        return {\n          id: def.id,\n          name: def.name,\n          description: def.description,\n          category: def.category,\n          currentValue: value,\n          tier: this.computeTier(def, value),\n          tiers: { ...def.tiers },\n        };\n      });\n  }\n\n  /** Get all achievements with full progress info. */\n  getAllAchievements(): AchievementProgress[] {\n    return ACHIEVEMENTS.map((def) => {\n      const value = this.progress.get(def.id) ?? 0;\n      return {\n        id: def.id,\n        name: def.name,\n        description: def.description,\n        category: def.category,\n        currentValue: value,\n        tier: this.computeTier(def, value),\n        tiers: { ...def.tiers },\n      };\n    });\n  }\n\n  /** Get the number of gold-tier achievements. */\n  getGoldCount(): number {\n    let count = 0;\n    for (const def of ACHIEVEMENTS) {\n      const value = this.progress.get(def.id) ?? 0;\n      if (value >= def.tiers.gold) count++;\n    }\n    return count;\n  }\n\n  /** Get completion percentage (gold = 100% per achievement). */\n  getCompletionPercentage(): number {\n    let totalPoints = 0;\n    let earnedPoints = 0;\n\n    for (const def of ACHIEVEMENTS) {\n      totalPoints += 3; // 3 tiers per achievement\n      const value = this.progress.get(def.id) ?? 0;\n      if (value >= def.tiers.bronze) earnedPoints++;\n      if (value >= def.tiers.silver) earnedPoints++;\n      if (value >= def.tiers.gold) earnedPoints++;\n    }\n\n    return totalPoints > 0 ? (earnedPoints / totalPoints) * 100 : 0;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Callbacks\n  // ---------------------------------------------------------------------------\n\n  /** Register a callback fired when an achievement tier is unlocked. */\n  onAchievementUnlock(cb: (achievementId: string, tier: TierLevel) => void): void {\n    this.onUnlockCallbacks.push(cb);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Persistence\n  // ---------------------------------------------------------------------------\n\n  /** Serialize for save. */\n  serialize(): AchievementSaveData {\n    const progress: Record<string, number> = {};\n    for (const [id, value] of this.progress) {\n      if (value > 0) {\n        progress[id] = value;\n      }\n    }\n    return { progress };\n  }\n\n  /** Deserialize from save. */\n  deserialize(data: AchievementSaveData): void {\n    // Reset all to 0, then apply saved values\n    for (const achievement of ACHIEVEMENTS) {\n      this.progress.set(achievement.id, 0);\n    }\n\n    if (data?.progress) {\n      for (const [id, value] of Object.entries(data.progress)) {\n        if (this.progress.has(id)) {\n          this.progress.set(id, value ?? 0);\n        }\n      }\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Internal\n  // ---------------------------------------------------------------------------\n\n  /** Compute the current tier for a value against tier thresholds. */\n  private computeTier(def: AchievementDef, value: number): TierLevel {\n    if (value >= def.tiers.gold) return 'gold';\n    if (value >= def.tiers.silver) return 'silver';\n    if (value >= def.tiers.bronze) return 'bronze';\n    return 'none';\n  }\n}\n","/**\n * EDILAS (Phaser) - Mail Manager\n * In-game mail system for letters, attachments, and system notifications.\n * Supports NPC letters, relationship milestones, story events, NPC birthdays,\n * and festival announcements.\n *\n * Phase 3 Stream E: Life Systems — Mail.\n */\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\n/** An attachment that can be included with a letter (items or gold). */\nexport interface MailAttachment {\n  /** Item ID, or null for gold-only attachments. */\n  itemId?: string;\n  /** Quantity of the item. */\n  quantity?: number;\n  /** Gold amount. */\n  gold?: number;\n}\n\n/** A letter in the player's mailbox. */\nexport interface MailLetter {\n  /** Unique ID for this letter. */\n  id: string;\n  /** Sender NPC ID or 'system' for automated mail. */\n  senderId: string;\n  /** Subject line. */\n  subject: string;\n  /** Body text of the letter. */\n  body: string;\n  /** Attached items or gold the player can claim. */\n  attachments: MailAttachment[];\n  /** Timestamp (in-game day number) when the letter was sent. */\n  sentDay: number;\n  /** Timestamp (in-game day number) when the letter was read, or null if unread. */\n  readAt: number | null;\n  /** Whether attachments have been claimed. */\n  attachmentsClaimed: boolean;\n}\n\n/** Category of system mail for filtering. */\nexport type MailCategory =\n  | 'relationship_milestone'\n  | 'story_event'\n  | 'npc_birthday'\n  | 'festival_announcement'\n  | 'npc_letter'\n  | 'system'\n  | 'quest_reward';\n\n/** Save data shape. */\ninterface MailSaveData {\n  inbox: MailLetter[];\n  nextMailId: number;\n}\n\n// ---------------------------------------------------------------------------\n// Mail Manager\n// ---------------------------------------------------------------------------\n\n/**\n * Manages the player's mailbox. Letters arrive from NPCs and system events,\n * can contain item/gold attachments, and are tracked as read/unread.\n */\nexport class MailManager {\n  /** The player's inbox, newest first. */\n  private inbox: MailLetter[] = [];\n\n  /** Auto-incrementing ID counter for letters. */\n  private nextMailId: number = 1;\n\n  // Callbacks\n  private onMailReceivedCallbacks: Array<(letter: MailLetter) => void> = [];\n\n  // ---------------------------------------------------------------------------\n  // Public API — Adding Mail\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Add a letter to the player's inbox.\n   * The `id` field is auto-generated if not provided.\n   *\n   * @param letter  Partial letter data. At minimum, provide senderId, subject, and body.\n   * @returns The full MailLetter that was added.\n   */\n  addMail(letter: Omit<MailLetter, 'id' | 'readAt' | 'attachmentsClaimed'> & { id?: string }): MailLetter {\n    const fullLetter: MailLetter = {\n      id: letter.id ?? `mail_${this.nextMailId++}`,\n      senderId: letter.senderId,\n      subject: letter.subject,\n      body: letter.body,\n      attachments: letter.attachments ?? [],\n      sentDay: letter.sentDay,\n      readAt: null,\n      attachmentsClaimed: false,\n    };\n\n    // If we used a manual ID, still advance counter if needed\n    if (!letter.id) {\n      // Counter was already incremented above\n    }\n\n    this.inbox.unshift(fullLetter); // Newest first\n\n    for (const cb of this.onMailReceivedCallbacks) {\n      cb(fullLetter);\n    }\n\n    return fullLetter;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Public API — Convenience Senders\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Send a system mail for a relationship milestone.\n   */\n  sendRelationshipMilestoneMail(npcId: string, npcName: string, hearts: number, currentDay: number): MailLetter {\n    return this.addMail({\n      senderId: npcId,\n      subject: `From ${npcName}`,\n      body: `Dear Farmer,\\n\\nI just wanted to say thank you for being such a wonderful friend. Here's a small token of my appreciation.\\n\\nWith ${hearts >= 8 ? 'love' : 'warm regards'},\\n${npcName}`,\n      attachments: [{ gold: hearts * 100 }],\n      sentDay: currentDay,\n    });\n  }\n\n  /**\n   * Send a system mail for a story event.\n   */\n  sendStoryEventMail(subject: string, body: string, attachments: MailAttachment[], currentDay: number): MailLetter {\n    return this.addMail({\n      senderId: 'system',\n      subject,\n      body,\n      attachments,\n      sentDay: currentDay,\n    });\n  }\n\n  /**\n   * Send a birthday reminder mail from an NPC.\n   */\n  sendBirthdayMail(npcId: string, npcName: string, currentDay: number): MailLetter {\n    return this.addMail({\n      senderId: npcId,\n      subject: `${npcName}'s Birthday`,\n      body: `It's ${npcName}'s birthday today! Don't forget to stop by and say happy birthday. A thoughtful gift would mean the world to them.`,\n      attachments: [],\n      sentDay: currentDay,\n    });\n  }\n\n  /**\n   * Send a festival announcement mail.\n   */\n  sendFestivalAnnouncementMail(festivalName: string, season: string, day: number, currentDay: number): MailLetter {\n    return this.addMail({\n      senderId: 'system',\n      subject: `Festival Announcement: ${festivalName}`,\n      body: `The ${festivalName} is coming up on ${season} ${day}! Head to the town square to join in the festivities. Don't miss out on the fun and prizes!`,\n      attachments: [],\n      sentDay: currentDay,\n    });\n  }\n\n  // ---------------------------------------------------------------------------\n  // Public API — Reading & Claiming\n  // ---------------------------------------------------------------------------\n\n  /** Get all unread letters. */\n  getUnread(): MailLetter[] {\n    return this.inbox.filter((m) => m.readAt === null);\n  }\n\n  /** Get the count of unread letters. */\n  getUnreadCount(): number {\n    return this.inbox.filter((m) => m.readAt === null).length;\n  }\n\n  /**\n   * Mark a letter as read.\n   *\n   * @param mailId  The letter ID to mark as read.\n   * @param currentDay  The current in-game day number.\n   */\n  markRead(mailId: string, currentDay: number): boolean {\n    const letter = this.inbox.find((m) => m.id === mailId);\n    if (!letter) return false;\n    if (letter.readAt !== null) return false;\n\n    letter.readAt = currentDay;\n    return true;\n  }\n\n  /**\n   * Claim attachments from a letter.\n   * Returns the attachments to be added to the player's inventory,\n   * or null if already claimed or no attachments exist.\n   */\n  claimAttachments(mailId: string): MailAttachment[] | null {\n    const letter = this.inbox.find((m) => m.id === mailId);\n    if (!letter) return null;\n    if (letter.attachmentsClaimed) return null;\n    if (letter.attachments.length === 0) return null;\n\n    letter.attachmentsClaimed = true;\n    return [...letter.attachments];\n  }\n\n  /** Check if a letter has unclaimed attachments. */\n  hasUnclaimedAttachments(mailId: string): boolean {\n    const letter = this.inbox.find((m) => m.id === mailId);\n    if (!letter) return false;\n    return !letter.attachmentsClaimed && letter.attachments.length > 0;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Public API — Queries\n  // ---------------------------------------------------------------------------\n\n  /** Get all mail in the inbox. */\n  getAllMail(): MailLetter[] {\n    return [...this.inbox];\n  }\n\n  /** Get a specific letter by ID. */\n  getMail(mailId: string): MailLetter | null {\n    return this.inbox.find((m) => m.id === mailId) ?? null;\n  }\n\n  /** Get mail from a specific sender. */\n  getMailFromSender(senderId: string): MailLetter[] {\n    return this.inbox.filter((m) => m.senderId === senderId);\n  }\n\n  /** Get total number of letters in the inbox. */\n  getMailCount(): number {\n    return this.inbox.length;\n  }\n\n  /**\n   * Delete a letter from the inbox.\n   * Returns true if the letter was found and deleted.\n   */\n  deleteMail(mailId: string): boolean {\n    const index = this.inbox.findIndex((m) => m.id === mailId);\n    if (index === -1) return false;\n    this.inbox.splice(index, 1);\n    return true;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Callbacks\n  // ---------------------------------------------------------------------------\n\n  /** Register a callback fired when new mail is received. */\n  onMailReceived(cb: (letter: MailLetter) => void): void {\n    this.onMailReceivedCallbacks.push(cb);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Persistence\n  // ---------------------------------------------------------------------------\n\n  /** Serialize for save. */\n  serialize(): MailSaveData {\n    return {\n      inbox: this.inbox.map((m) => ({ ...m, attachments: [...m.attachments] })),\n      nextMailId: this.nextMailId,\n    };\n  }\n\n  /** Deserialize from save. */\n  deserialize(data: MailSaveData): void {\n    this.inbox = [];\n    this.nextMailId = data?.nextMailId ?? 1;\n\n    if (data?.inbox) {\n      for (const saved of data.inbox) {\n        this.inbox.push({\n          id: saved.id ?? `mail_${this.nextMailId++}`,\n          senderId: saved.senderId ?? 'system',\n          subject: saved.subject ?? '',\n          body: saved.body ?? '',\n          attachments: saved.attachments ?? [],\n          sentDay: saved.sentDay ?? 0,\n          readAt: saved.readAt ?? null,\n          attachmentsClaimed: saved.attachmentsClaimed ?? false,\n        });\n      }\n    }\n  }\n}\n","/**\n * EDILAS (Phaser) - Storage Manager\n * Chest and storage container system. Allows players to place storage\n * containers in the world and manage item storage across scenes.\n *\n * Phase 3 Stream E: Life Systems — Storage.\n */\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\n/** Number of slots per storage container. */\nconst STORAGE_SLOTS = 36;\n\n/** A single slot within a storage container. */\nexport interface StorageSlot {\n  itemId: string;\n  quantity: number;\n}\n\n/** A storage container placed in the world. */\nexport interface StorageContainer {\n  /** Unique ID for this container. */\n  id: string;\n  /** World X position. */\n  x: number;\n  /** World Y position. */\n  y: number;\n  /** The scene/map this container belongs to. */\n  sceneId: string;\n  /** The item slots (fixed-length array). */\n  slots: StorageSlot[];\n  /** Optional label for the container. */\n  label: string;\n}\n\n/** Save data shape. */\ninterface StorageSaveData {\n  containers: Record<string, {\n    id: string;\n    x: number;\n    y: number;\n    sceneId: string;\n    slots: StorageSlot[];\n    label: string;\n  }>;\n  nextStorageId: number;\n}\n\n// ---------------------------------------------------------------------------\n// Storage Manager\n// ---------------------------------------------------------------------------\n\n/**\n * Manages chest and storage containers placed in the world.\n * Each container has 36 slots for storing items, a position, and\n * a scene association.\n */\nexport class StorageManager {\n  /** All storage containers keyed by ID. */\n  private containers: Map<string, StorageContainer> = new Map();\n\n  /** Auto-incrementing ID counter. */\n  private nextStorageId: number = 1;\n\n  // Callbacks\n  private onStorageChangedCallbacks: Array<(storageId: string) => void> = [];\n\n  // ---------------------------------------------------------------------------\n  // Public API — Container Management\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Create a new storage container at the given position.\n   *\n   * @param x  World X coordinate.\n   * @param y  World Y coordinate.\n   * @param sceneId  The scene this container is placed in.\n   * @param label  Optional label for the container.\n   * @returns The new container's ID.\n   */\n  createStorage(x: number, y: number, sceneId: string, label: string = 'Chest'): string {\n    const id = `storage_${this.nextStorageId++}`;\n\n    const container: StorageContainer = {\n      id,\n      x,\n      y,\n      sceneId,\n      slots: Array.from({ length: STORAGE_SLOTS }, () => ({\n        itemId: '',\n        quantity: 0,\n      })),\n      label,\n    };\n\n    this.containers.set(id, container);\n    return id;\n  }\n\n  /**\n   * Remove a storage container. Returns true if it was found and removed.\n   * WARNING: All items in the container are lost.\n   */\n  removeStorage(storageId: string): boolean {\n    return this.containers.delete(storageId);\n  }\n\n  /**\n   * Get a storage container by ID.\n   * Returns a copy to prevent external mutation.\n   */\n  getStorage(storageId: string): StorageContainer | null {\n    const container = this.containers.get(storageId);\n    if (!container) return null;\n\n    return {\n      ...container,\n      slots: container.slots.map((s) => ({ ...s })),\n    };\n  }\n\n  /**\n   * Get all storage containers in a specific scene.\n   */\n  getAllStorages(sceneId: string): StorageContainer[] {\n    const result: StorageContainer[] = [];\n    for (const container of this.containers.values()) {\n      if (container.sceneId === sceneId) {\n        result.push({\n          ...container,\n          slots: container.slots.map((s) => ({ ...s })),\n        });\n      }\n    }\n    return result;\n  }\n\n  /** Get all storage container IDs. */\n  getAllStorageIds(): string[] {\n    return Array.from(this.containers.keys());\n  }\n\n  /** Set the label of a storage container. */\n  setLabel(storageId: string, label: string): boolean {\n    const container = this.containers.get(storageId);\n    if (!container) return false;\n    container.label = label;\n    return true;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Public API — Item Operations\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Add an item to a storage container.\n   * Stacks with existing items first, then fills empty slots.\n   * Returns the leftover quantity that couldn't be stored.\n   *\n   * @param storageId  The container ID.\n   * @param itemId  The item to add.\n   * @param quantity  Amount to add.\n   * @param maxStack  Maximum stack size for this item (default 99).\n   */\n  addItemToStorage(storageId: string, itemId: string, quantity: number, maxStack: number = 99): number {\n    const container = this.containers.get(storageId);\n    if (!container || quantity <= 0) return quantity;\n\n    let remaining = quantity;\n\n    // First pass: fill existing stacks\n    for (const slot of container.slots) {\n      if (remaining <= 0) break;\n      if (slot.itemId === itemId && slot.quantity < maxStack) {\n        const canAdd = Math.min(remaining, maxStack - slot.quantity);\n        slot.quantity += canAdd;\n        remaining -= canAdd;\n      }\n    }\n\n    // Second pass: fill empty slots\n    for (const slot of container.slots) {\n      if (remaining <= 0) break;\n      if (slot.itemId === '') {\n        const canAdd = Math.min(remaining, maxStack);\n        slot.itemId = itemId;\n        slot.quantity = canAdd;\n        remaining -= canAdd;\n      }\n    }\n\n    this.emitStorageChanged(storageId);\n    return remaining;\n  }\n\n  /**\n   * Remove an item from a storage container.\n   * Returns the actual quantity removed.\n   *\n   * @param storageId  The container ID.\n   * @param itemId  The item to remove.\n   * @param quantity  Amount to remove.\n   */\n  removeItemFromStorage(storageId: string, itemId: string, quantity: number): number {\n    const container = this.containers.get(storageId);\n    if (!container || quantity <= 0) return 0;\n\n    let toRemove = quantity;\n\n    for (const slot of container.slots) {\n      if (toRemove <= 0) break;\n      if (slot.itemId === itemId) {\n        const removing = Math.min(toRemove, slot.quantity);\n        slot.quantity -= removing;\n        toRemove -= removing;\n        if (slot.quantity <= 0) {\n          slot.itemId = '';\n          slot.quantity = 0;\n        }\n      }\n    }\n\n    this.emitStorageChanged(storageId);\n    return quantity - toRemove;\n  }\n\n  /**\n   * Check if a storage container has at least `quantity` of an item.\n   */\n  hasItem(storageId: string, itemId: string, quantity: number = 1): boolean {\n    const container = this.containers.get(storageId);\n    if (!container) return false;\n\n    let total = 0;\n    for (const slot of container.slots) {\n      if (slot.itemId === itemId) total += slot.quantity;\n    }\n    return total >= quantity;\n  }\n\n  /**\n   * Count total quantity of an item in a storage container.\n   */\n  countItem(storageId: string, itemId: string): number {\n    const container = this.containers.get(storageId);\n    if (!container) return 0;\n\n    let total = 0;\n    for (const slot of container.slots) {\n      if (slot.itemId === itemId) total += slot.quantity;\n    }\n    return total;\n  }\n\n  /**\n   * Get all non-empty slots in a storage container.\n   */\n  getItems(storageId: string): StorageSlot[] {\n    const container = this.containers.get(storageId);\n    if (!container) return [];\n    return container.slots.filter((s) => s.itemId !== '').map((s) => ({ ...s }));\n  }\n\n  /**\n   * Check if a storage container is full (no empty slots).\n   */\n  isFull(storageId: string): boolean {\n    const container = this.containers.get(storageId);\n    if (!container) return true;\n    return container.slots.every((s) => s.itemId !== '');\n  }\n\n  /**\n   * Get the number of empty slots in a storage container.\n   */\n  getEmptySlotCount(storageId: string): number {\n    const container = this.containers.get(storageId);\n    if (!container) return 0;\n    return container.slots.filter((s) => s.itemId === '').length;\n  }\n\n  /**\n   * Swap two slots within a storage container.\n   */\n  swapSlots(storageId: string, slotA: number, slotB: number): boolean {\n    const container = this.containers.get(storageId);\n    if (!container) return false;\n    if (slotA < 0 || slotA >= STORAGE_SLOTS || slotB < 0 || slotB >= STORAGE_SLOTS) return false;\n\n    const temp = container.slots[slotA];\n    container.slots[slotA] = container.slots[slotB];\n    container.slots[slotB] = temp;\n\n    this.emitStorageChanged(storageId);\n    return true;\n  }\n\n  /**\n   * Bulk-update all slots for a storage container.\n   * Used by the StorageUI to persist changes after transfers.\n   */\n  updateSlots(storageId: string, slots: StorageSlot[]): boolean {\n    const container = this.containers.get(storageId);\n    if (!container) return false;\n\n    for (let i = 0; i < container.slots.length && i < slots.length; i++) {\n      container.slots[i].itemId = slots[i].itemId;\n      container.slots[i].quantity = slots[i].quantity;\n    }\n\n    this.emitStorageChanged(storageId);\n    return true;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Callbacks\n  // ---------------------------------------------------------------------------\n\n  /** Register a callback fired when a storage container's contents change. */\n  onStorageChanged(cb: (storageId: string) => void): void {\n    this.onStorageChangedCallbacks.push(cb);\n  }\n\n  private emitStorageChanged(storageId: string): void {\n    for (const cb of this.onStorageChangedCallbacks) {\n      cb(storageId);\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Persistence\n  // ---------------------------------------------------------------------------\n\n  /** Serialize for save. */\n  serialize(): StorageSaveData {\n    const containers: StorageSaveData['containers'] = {};\n    for (const [id, container] of this.containers) {\n      containers[id] = {\n        id: container.id,\n        x: container.x,\n        y: container.y,\n        sceneId: container.sceneId,\n        slots: container.slots.map((s) => ({ ...s })),\n        label: container.label,\n      };\n    }\n    return { containers, nextStorageId: this.nextStorageId };\n  }\n\n  /** Deserialize from save. */\n  deserialize(data: StorageSaveData): void {\n    this.containers.clear();\n    this.nextStorageId = data?.nextStorageId ?? 1;\n\n    if (data?.containers) {\n      for (const [id, saved] of Object.entries(data.containers)) {\n        const slots: StorageSlot[] = Array.from({ length: STORAGE_SLOTS }, (_, i) => {\n          const savedSlot = saved.slots?.[i];\n          return {\n            itemId: savedSlot?.itemId ?? '',\n            quantity: savedSlot?.quantity ?? 0,\n          };\n        });\n\n        this.containers.set(id, {\n          id: saved.id ?? id,\n          x: saved.x ?? 0,\n          y: saved.y ?? 0,\n          sceneId: saved.sceneId ?? '',\n          slots,\n          label: saved.label ?? 'Chest',\n        });\n      }\n    }\n  }\n}\n","/**\n * EDILAS (Phaser) - Temperature Manager\n * Temperature system that combines biome base temperatures, seasonal modifiers,\n * weather modifiers, and time-of-day modifiers. Determines player comfort\n * and applies gameplay effects.\n *\n * Phase 3 Stream E: Life Systems — Temperature.\n */\n\nimport { SEASONS } from '../config';\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\n/** A season type derived from the game config. */\ntype Season = typeof SEASONS[number];\n\n/** Player comfort state. */\nexport interface ComfortState {\n  /** Whether the player is within the comfortable temperature range. */\n  comfortable: boolean;\n  /** Whether the player is overheating (above 35°C). */\n  tooHot: boolean;\n  /** Whether the player is freezing (below 10°C). */\n  tooCold: boolean;\n}\n\n/** Gameplay effects from temperature. */\nexport interface TemperatureEffects {\n  /** Multiplier for stamina regeneration (1.0 = normal, 0.5 = cold penalty). */\n  staminaRegenMultiplier: number;\n  /** Multiplier for stamina drain (1.0 = normal, 2.0 = heat penalty). */\n  staminaDrainMultiplier: number;\n}\n\n/** Save data shape. */\ninterface TemperatureSaveData {\n  lastTemperature: number;\n  coldExposureTime: number;\n  heatExposureTime: number;\n}\n\n// ---------------------------------------------------------------------------\n// Constants\n// ---------------------------------------------------------------------------\n\n/** Base temperature per biome (°C). */\nconst BIOME_BASE_TEMPS: Record<string, number> = {\n  haven: 20,\n  rotwood: 18,\n  ashlands: 45,\n  drowned: 15,\n  bone_wastes: 35,\n  the_void: 5,\n  edilas: 22,\n};\n\n/** Season temperature modifiers (°C). */\nconst SEASON_MODIFIERS: Record<string, number> = {\n  Spring: 0,\n  Summer: 10,\n  Autumn: -5,\n  Winter: -15,\n};\n\n/** Weather type temperature modifiers (°C). */\nconst WEATHER_MODIFIERS: Record<string, number> = {\n  clear: 2,\n  cloudy: 0,\n  rain: -3,\n  storm: -5,\n  snow: -10,\n  fog: -2,\n  sandstorm: 5,\n  acid_rain: -3,\n  ember_rain: 8,\n  spore_cloud: 0,\n  void_storm: -12,\n  corruption_storm: -8,\n};\n\n/** Time-of-day temperature modifiers based on hour (°C). */\ninterface TimeRange {\n  startHour: number;\n  endHour: number;\n  modifier: number;\n  label: string;\n}\n\n/**\n * Time period definitions:\n * Night: 22-5 → -5°C\n * Dawn: 5-7 → -2°C\n * Day: 7-18 → +0°C\n * Dusk: 18-22 → -2°C\n */\nconst TIME_PERIODS: TimeRange[] = [\n  { startHour: 5, endHour: 7, modifier: -2, label: 'dawn' },\n  { startHour: 7, endHour: 18, modifier: 0, label: 'day' },\n  { startHour: 18, endHour: 22, modifier: -2, label: 'dusk' },\n  // Night is the default fallback\n];\n\nconst NIGHT_MODIFIER = -5;\n\n/** Comfortable temperature range (°C). */\nconst COMFORT_MIN = 10;\nconst COMFORT_MAX = 35;\n\n/** Cold effect: stamina regen reduced by 50%. */\nconst COLD_STAMINA_REGEN_MULT = 0.5;\n\n/** Heat effect: stamina drain doubled. */\nconst HEAT_STAMINA_DRAIN_MULT = 2.0;\n\n// ---------------------------------------------------------------------------\n// Temperature Manager\n// ---------------------------------------------------------------------------\n\n/**\n * Calculates effective temperature from biome, season, weather, and time of day.\n * Determines player comfort and applies gameplay effects (stamina penalties).\n */\nexport class TemperatureManager {\n  /** The last computed temperature (cached for queries). */\n  private lastTemperature: number = 20;\n\n  /** Accumulated time spent in cold exposure (seconds). */\n  private coldExposureTime: number = 0;\n\n  /** Accumulated time spent in heat exposure (seconds). */\n  private heatExposureTime: number = 0;\n\n  // Callbacks\n  private comfortChangeCallbacks: Array<(comfort: ComfortState) => void> = [];\n\n  /** Previous comfort state for detecting changes. */\n  private lastComfort: ComfortState = { comfortable: true, tooHot: false, tooCold: false };\n\n  // ---------------------------------------------------------------------------\n  // Public API — Temperature Calculation\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Calculate the effective temperature at the player's current location.\n   *\n   * @param biomeId  The biome the player is in.\n   * @param season  The current season.\n   * @param weatherType  The current weather type string.\n   * @param hour  The current in-game hour (0-23).\n   * @returns The effective temperature in degrees Celsius.\n   */\n  getTemperature(biomeId: string, season: string, weatherType: string, hour: number): number {\n    const baseTemp = BIOME_BASE_TEMPS[biomeId] ?? 20;\n    const seasonMod = SEASON_MODIFIERS[season] ?? 0;\n    const weatherMod = WEATHER_MODIFIERS[weatherType] ?? 0;\n    const timeMod = this.getTimeModifier(hour);\n\n    return baseTemp + seasonMod + weatherMod + timeMod;\n  }\n\n  /**\n   * Update the cached temperature and track exposure time.\n   * Call this periodically (e.g., once per game tick or minute).\n   *\n   * @param biomeId  The biome the player is in.\n   * @param season  The current season.\n   * @param weatherType  The current weather type string.\n   * @param hour  The current in-game hour (0-23).\n   * @param deltaSeconds  Time elapsed since last update, in seconds.\n   */\n  update(biomeId: string, season: string, weatherType: string, hour: number, deltaSeconds: number): void {\n    this.lastTemperature = this.getTemperature(biomeId, season, weatherType, hour);\n    const comfort = this.getPlayerComfort(this.lastTemperature);\n\n    // Track exposure time\n    if (comfort.tooCold) {\n      this.coldExposureTime += deltaSeconds;\n      this.heatExposureTime = Math.max(0, this.heatExposureTime - deltaSeconds);\n    } else if (comfort.tooHot) {\n      this.heatExposureTime += deltaSeconds;\n      this.coldExposureTime = Math.max(0, this.coldExposureTime - deltaSeconds);\n    } else {\n      // Comfortable — exposure gradually fades\n      this.coldExposureTime = Math.max(0, this.coldExposureTime - deltaSeconds * 2);\n      this.heatExposureTime = Math.max(0, this.heatExposureTime - deltaSeconds * 2);\n    }\n\n    // Detect comfort state changes and fire callbacks\n    if (\n      comfort.comfortable !== this.lastComfort.comfortable ||\n      comfort.tooHot !== this.lastComfort.tooHot ||\n      comfort.tooCold !== this.lastComfort.tooCold\n    ) {\n      this.lastComfort = { ...comfort };\n      for (const cb of this.comfortChangeCallbacks) {\n        cb(comfort);\n      }\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Public API — Comfort & Effects\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Determine the player's comfort state at a given temperature.\n   *\n   * @param temp  Temperature in degrees Celsius.\n   * @returns Comfort state: comfortable, tooHot, tooCold.\n   */\n  getPlayerComfort(temp: number): ComfortState {\n    return {\n      comfortable: temp >= COMFORT_MIN && temp <= COMFORT_MAX,\n      tooHot: temp > COMFORT_MAX,\n      tooCold: temp < COMFORT_MIN,\n    };\n  }\n\n  /**\n   * Get gameplay effects based on the current cached temperature.\n   *\n   * Cold (below 10°C): stamina regen -50%\n   * Hot (above 35°C): stamina drain 2x\n   */\n  getTemperatureEffects(): TemperatureEffects {\n    const comfort = this.getPlayerComfort(this.lastTemperature);\n\n    return {\n      staminaRegenMultiplier: comfort.tooCold ? COLD_STAMINA_REGEN_MULT : 1.0,\n      staminaDrainMultiplier: comfort.tooHot ? HEAT_STAMINA_DRAIN_MULT : 1.0,\n    };\n  }\n\n  /** Get the last computed temperature. */\n  getLastTemperature(): number {\n    return this.lastTemperature;\n  }\n\n  /** Get the last comfort state. */\n  getLastComfort(): ComfortState {\n    return { ...this.lastComfort };\n  }\n\n  /** Get cold exposure time in seconds. */\n  getColdExposureTime(): number {\n    return this.coldExposureTime;\n  }\n\n  /** Get heat exposure time in seconds. */\n  getHeatExposureTime(): number {\n    return this.heatExposureTime;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Public API — Queries\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Get the base temperature for a biome (without modifiers).\n   */\n  getBiomeBaseTemp(biomeId: string): number {\n    return BIOME_BASE_TEMPS[biomeId] ?? 20;\n  }\n\n  /**\n   * Get the season modifier for a given season.\n   */\n  getSeasonModifier(season: string): number {\n    return SEASON_MODIFIERS[season] ?? 0;\n  }\n\n  /**\n   * Get the weather modifier for a given weather type.\n   */\n  getWeatherModifier(weatherType: string): number {\n    return WEATHER_MODIFIERS[weatherType] ?? 0;\n  }\n\n  /**\n   * Get the time-of-day label for a given hour.\n   */\n  getTimePeriod(hour: number): string {\n    for (const period of TIME_PERIODS) {\n      if (hour >= period.startHour && hour < period.endHour) {\n        return period.label;\n      }\n    }\n    return 'night';\n  }\n\n  /**\n   * Get a formatted temperature string.\n   */\n  getTemperatureString(temp: number): string {\n    return `${Math.round(temp)}°C`;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Callbacks\n  // ---------------------------------------------------------------------------\n\n  /** Register a callback fired when the player's comfort state changes. */\n  onComfortChange(cb: (comfort: ComfortState) => void): void {\n    this.comfortChangeCallbacks.push(cb);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Persistence\n  // ---------------------------------------------------------------------------\n\n  /** Serialize for save. */\n  serialize(): TemperatureSaveData {\n    return {\n      lastTemperature: this.lastTemperature,\n      coldExposureTime: this.coldExposureTime,\n      heatExposureTime: this.heatExposureTime,\n    };\n  }\n\n  /** Deserialize from save. */\n  deserialize(data: TemperatureSaveData): void {\n    this.lastTemperature = data?.lastTemperature ?? 20;\n    this.coldExposureTime = data?.coldExposureTime ?? 0;\n    this.heatExposureTime = data?.heatExposureTime ?? 0;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Internal\n  // ---------------------------------------------------------------------------\n\n  /** Get the time-of-day temperature modifier for a given hour. */\n  private getTimeModifier(hour: number): number {\n    for (const period of TIME_PERIODS) {\n      if (hour >= period.startHour && hour < period.endHour) {\n        return period.modifier;\n      }\n    }\n    return NIGHT_MODIFIER; // Default: night\n  }\n}\n","/**\n * EDILAS (Phaser) - Shadow World Manager\n * Manages the Shadow World parallel dimension system.\n * Handles entering/exiting the shadow world, exclusive shadow resources,\n * enemy stat multipliers, channeling, and cooldowns.\n *\n * Phase 3 Stream F: World Systems — Shadow World.\n */\n\n// ---------------------------------------------------------------------------\n// Constants\n// ---------------------------------------------------------------------------\n\n/** The 8 exclusive shadow resources only obtainable in the shadow world. */\nexport const SHADOW_RESOURCES = [\n  'void_essence',\n  'shadow_silk',\n  'corruption_crystal',\n  'dark_iron',\n  'phantom_wood',\n  'abyssal_pearl',\n  'nightmare_dust',\n  'echo_shard',\n] as const;\n\nexport type ShadowResource = typeof SHADOW_RESOURCES[number];\n\n/** Duration of the channeling period to enter the shadow world (ms). */\nconst CHANNEL_DURATION_MS = 5_000;\n\n/** Cooldown between shadow world transitions (ms). */\nconst COOLDOWN_DURATION_MS = 60_000;\n\n/** Stat multiplier applied to enemies while in the shadow world. */\nconst SHADOW_STAT_MULTIPLIER = 1.5;\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\ninterface ShadowWorldSaveData {\n  inShadowWorld: boolean;\n  channeling: boolean;\n  channelStartTime: number;\n  lastExitTime: number;\n  shadowInventory: Record<string, number>;\n}\n\n// ---------------------------------------------------------------------------\n// Shadow World Manager\n// ---------------------------------------------------------------------------\n\n/**\n * Manages the Shadow World — a parallel dimension the player can phase into.\n * While in the shadow world, enemies gain +50% stats and exclusive shadow\n * resources become harvestable. Entering requires a 5-second channel and\n * has a 60-second cooldown after exiting.\n */\nexport class ShadowWorldManager {\n  /** Whether the player is currently in the shadow world. */\n  private inShadowWorld: boolean = false;\n\n  /** Whether the player is currently channeling to enter. */\n  private channeling: boolean = false;\n\n  /** Timestamp (ms) when channeling started. 0 if not channeling. */\n  private channelStartTime: number = 0;\n\n  /** Timestamp (ms) when the player last exited the shadow world. 0 if never. */\n  private lastExitTime: number = 0;\n\n  /** Current game time reference for cooldown/channel calculations. */\n  private currentTime: number = 0;\n\n  /** Shadow-exclusive resource inventory. */\n  private shadowInventory: Map<string, number> = new Map();\n\n  // Callbacks\n  private enterCallbacks: Array<() => void> = [];\n  private exitCallbacks: Array<() => void> = [];\n\n  // ---------------------------------------------------------------------------\n  // Time Update\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Update the manager's internal clock. Should be called each frame.\n   * Also completes channeling if the channel duration has elapsed.\n   * @param currentTimeMs - The current game time in milliseconds.\n   */\n  update(currentTimeMs: number): void {\n    this.currentTime = currentTimeMs;\n\n    // Check if channeling completes\n    if (this.channeling && this.currentTime - this.channelStartTime >= CHANNEL_DURATION_MS) {\n      this.channeling = false;\n      this.inShadowWorld = true;\n      for (const cb of this.enterCallbacks) {\n        cb();\n      }\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Enter / Exit\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Begin channeling to enter the shadow world.\n   * Takes 5 seconds to complete. Fails if already in the shadow world,\n   * currently channeling, or the cooldown has not expired.\n   * @returns `true` if channeling started successfully.\n   */\n  enterShadowWorld(): boolean {\n    if (this.inShadowWorld) return false;\n    if (this.channeling) return false;\n    if (this.getCooldownRemaining() > 0) return false;\n\n    this.channeling = true;\n    this.channelStartTime = this.currentTime;\n    return true;\n  }\n\n  /**\n   * Exit the shadow world immediately.\n   * Starts the 60-second cooldown timer.\n   * @returns `true` if the player was in the shadow world and exited.\n   */\n  exitShadowWorld(): boolean {\n    if (!this.inShadowWorld) return false;\n\n    this.inShadowWorld = false;\n    this.lastExitTime = this.currentTime;\n\n    for (const cb of this.exitCallbacks) {\n      cb();\n    }\n\n    return true;\n  }\n\n  /**\n   * Cancel an in-progress channel. Does not trigger cooldown.\n   * @returns `true` if channeling was cancelled.\n   */\n  cancelChannel(): boolean {\n    if (!this.channeling) return false;\n    this.channeling = false;\n    this.channelStartTime = 0;\n    return true;\n  }\n\n  // ---------------------------------------------------------------------------\n  // State Queries\n  // ---------------------------------------------------------------------------\n\n  /** Check whether the player is currently in the shadow world. */\n  isInShadowWorld(): boolean {\n    return this.inShadowWorld;\n  }\n\n  /** Check whether the player is currently channeling to enter. */\n  isChanneling(): boolean {\n    return this.channeling;\n  }\n\n  /**\n   * Get the remaining channeling time in seconds.\n   * Returns 0 if not channeling.\n   */\n  getChannelRemaining(): number {\n    if (!this.channeling) return 0;\n    const elapsed = this.currentTime - this.channelStartTime;\n    return Math.max(0, (CHANNEL_DURATION_MS - elapsed) / 1000);\n  }\n\n  /**\n   * Get the remaining cooldown in seconds before the shadow world can be\n   * entered again. Returns 0 if the cooldown has expired or never started.\n   */\n  getCooldownRemaining(): number {\n    if (this.lastExitTime === 0) return 0;\n    const elapsed = this.currentTime - this.lastExitTime;\n    return Math.max(0, (COOLDOWN_DURATION_MS - elapsed) / 1000);\n  }\n\n  /**\n   * Get the stat multiplier for shadow enemies.\n   * Returns 1.5 if in the shadow world, 1.0 otherwise.\n   */\n  getShadowStatMultiplier(): number {\n    return this.inShadowWorld ? SHADOW_STAT_MULTIPLIER : 1.0;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Shadow Resources\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Check if a resource ID is a shadow-exclusive resource.\n   * @param resourceId - The resource identifier to check.\n   */\n  isShadowResource(resourceId: string): boolean {\n    return (SHADOW_RESOURCES as readonly string[]).includes(resourceId);\n  }\n\n  /**\n   * Add a shadow resource to the shadow inventory.\n   * @param resourceId - Must be one of the 8 shadow resource types.\n   * @param amount - Quantity to add (must be positive).\n   * @returns `true` if the resource was added successfully.\n   */\n  addShadowResource(resourceId: string, amount: number): boolean {\n    if (!this.isShadowResource(resourceId)) return false;\n    if (amount <= 0) return false;\n\n    const current = this.shadowInventory.get(resourceId) ?? 0;\n    this.shadowInventory.set(resourceId, current + amount);\n    return true;\n  }\n\n  /**\n   * Get the quantity of a shadow resource in the shadow inventory.\n   * @param resourceId - The shadow resource to query.\n   */\n  getShadowResource(resourceId: string): number {\n    return this.shadowInventory.get(resourceId) ?? 0;\n  }\n\n  /** Get all shadow resources as a plain record. */\n  getAllShadowResources(): Record<string, number> {\n    const result: Record<string, number> = {};\n    for (const [key, value] of this.shadowInventory) {\n      result[key] = value;\n    }\n    return result;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Callbacks\n  // ---------------------------------------------------------------------------\n\n  /** Register a callback fired when the player enters the shadow world. */\n  onEnter(cb: () => void): void {\n    this.enterCallbacks.push(cb);\n  }\n\n  /** Register a callback fired when the player exits the shadow world. */\n  onExit(cb: () => void): void {\n    this.exitCallbacks.push(cb);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Persistence\n  // ---------------------------------------------------------------------------\n\n  /** Serialize for save. */\n  serialize(): ShadowWorldSaveData {\n    const shadowInventory: Record<string, number> = {};\n    for (const [key, value] of this.shadowInventory) {\n      shadowInventory[key] = value;\n    }\n\n    return {\n      inShadowWorld: this.inShadowWorld,\n      channeling: this.channeling,\n      channelStartTime: this.channelStartTime,\n      lastExitTime: this.lastExitTime,\n      shadowInventory,\n    };\n  }\n\n  /** Deserialize from save. */\n  deserialize(data: ShadowWorldSaveData): void {\n    this.inShadowWorld = data.inShadowWorld ?? false;\n    this.channeling = data.channeling ?? false;\n    this.channelStartTime = data.channelStartTime ?? 0;\n    this.lastExitTime = data.lastExitTime ?? 0;\n\n    this.shadowInventory.clear();\n    if (data.shadowInventory) {\n      for (const [key, value] of Object.entries(data.shadowInventory)) {\n        this.shadowInventory.set(key, value);\n      }\n    }\n  }\n}\n","/**\n * EDILAS (Phaser) - City Level Manager\n * City leveling system with XP progression, unlocks, and passive income.\n * Tracks 12 cities, each with levels 1-10, XP from various sources,\n * and per-level unlocks (shop tier, NPC, service).\n *\n * Phase 3 Stream F: World Systems — City Leveling.\n */\n\n// ---------------------------------------------------------------------------\n// Constants\n// ---------------------------------------------------------------------------\n\n/** Maximum number of cities tracked by the system. */\nconst MAX_CITIES = 12;\n\n/** Maximum city level. */\nconst MAX_CITY_LEVEL = 10;\n\n/** XP thresholds for each level (index 0 = level 1, index 9 = level 10). */\nconst LEVEL_THRESHOLDS: readonly number[] = [0, 100, 300, 600, 1000, 1500, 2100, 2800, 3600, 4500];\n\n/** XP amounts awarded per activity type. */\nexport const CITY_XP_SOURCES = {\n  trading: 10,\n  quest_complete: 50,\n  resource_donation: 5,\n  raid_defense: 100,\n} as const;\n\n/** Passive gold income per day for level 10 cities, indexed by city position (0-11). */\nconst LEVEL_10_PASSIVE_INCOME = 50;\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\n/** Unlock information for a city at a given level. */\nexport interface CityLevelUnlock {\n  shopTier: number;\n  npcName: string;\n  service: string;\n}\n\n/** XP progress information for a city. */\nexport interface CityXPProgress {\n  current: number;\n  needed: number;\n  level: number;\n}\n\n/** Per-city state tracked by the manager. */\ninterface CityState {\n  xp: number;\n}\n\ninterface CityLevelSaveData {\n  cities: Record<string, CityState>;\n}\n\n// ---------------------------------------------------------------------------\n// Level Unlock Data\n// ---------------------------------------------------------------------------\n\n/**\n * Defines what each level unlocks. Key = level (1-10).\n * Each level grants a new shop tier, a new NPC, and a new service.\n */\nconst LEVEL_UNLOCKS: Record<number, CityLevelUnlock> = {\n  1:  { shopTier: 1, npcName: 'Merchant',         service: 'basic_shop' },\n  2:  { shopTier: 1, npcName: 'Blacksmith',        service: 'repair' },\n  3:  { shopTier: 2, npcName: 'Alchemist',         service: 'potions' },\n  4:  { shopTier: 2, npcName: 'Enchanter',         service: 'enchanting' },\n  5:  { shopTier: 3, npcName: 'Master Craftsman',  service: 'advanced_crafting' },\n  6:  { shopTier: 3, npcName: 'Banker',            service: 'banking' },\n  7:  { shopTier: 4, npcName: 'Lorekeeper',        service: 'quest_board' },\n  8:  { shopTier: 4, npcName: 'War Marshal',       service: 'mercenaries' },\n  9:  { shopTier: 5, npcName: 'Archmage',          service: 'teleportation' },\n  10: { shopTier: 5, npcName: 'Grand Steward',     service: 'passive_income' },\n};\n\n// ---------------------------------------------------------------------------\n// City Level Manager\n// ---------------------------------------------------------------------------\n\n/**\n * Manages city leveling across up to 12 cities. Each city levels from 1 to 10\n * by accumulating XP from trading, quests, resource donations, and raid defense.\n * Higher levels unlock new shop tiers, NPCs, and services. Level 10 cities\n * generate passive gold income.\n */\nexport class CityLevelManager {\n  /** cityId -> CityState */\n  private cities: Map<string, CityState> = new Map();\n\n  // Callbacks\n  private levelUpCallbacks: Array<(cityId: string, newLevel: number) => void> = [];\n\n  // ---------------------------------------------------------------------------\n  // City Registration\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Register a city for tracking. Initializes at 0 XP (level 1).\n   * Fails if the maximum number of cities is reached or the city already exists.\n   * @param cityId - Unique identifier for the city.\n   * @returns `true` if the city was registered successfully.\n   */\n  registerCity(cityId: string): boolean {\n    if (this.cities.has(cityId)) return false;\n    if (this.cities.size >= MAX_CITIES) return false;\n\n    this.cities.set(cityId, { xp: 0 });\n    return true;\n  }\n\n  // ---------------------------------------------------------------------------\n  // XP\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Add XP to a city. Automatically handles level-up detection and callbacks.\n   * @param cityId - The city to award XP to.\n   * @param amount - The amount of XP to add (must be positive).\n   * @returns `true` if XP was added successfully.\n   */\n  addCityXP(cityId: string, amount: number): boolean {\n    const state = this.cities.get(cityId);\n    if (!state) return false;\n    if (amount <= 0) return false;\n\n    const oldLevel = this.getLevelFromXP(state.xp);\n    state.xp += amount;\n    const newLevel = this.getLevelFromXP(state.xp);\n\n    // Fire level-up callbacks for each level gained\n    if (newLevel > oldLevel) {\n      for (let level = oldLevel + 1; level <= newLevel; level++) {\n        for (const cb of this.levelUpCallbacks) {\n          cb(cityId, level);\n        }\n      }\n    }\n\n    return true;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Level Queries\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Get the current level of a city (1-10).\n   * Returns 1 if the city is not found.\n   * @param cityId - The city to query.\n   */\n  getCityLevel(cityId: string): number {\n    const state = this.cities.get(cityId);\n    if (!state) return 1;\n    return this.getLevelFromXP(state.xp);\n  }\n\n  /**\n   * Get the XP progress for a city including current XP, XP needed for the\n   * next level, and the current level.\n   * @param cityId - The city to query.\n   */\n  getCityXPProgress(cityId: string): CityXPProgress {\n    const state = this.cities.get(cityId);\n    if (!state) return { current: 0, needed: LEVEL_THRESHOLDS[1] ?? 100, level: 1 };\n\n    const level = this.getLevelFromXP(state.xp);\n    const currentThreshold = LEVEL_THRESHOLDS[level - 1] ?? 0;\n    const nextThreshold = level < MAX_CITY_LEVEL\n      ? (LEVEL_THRESHOLDS[level] ?? currentThreshold)\n      : currentThreshold;\n\n    return {\n      current: state.xp - currentThreshold,\n      needed: level < MAX_CITY_LEVEL ? nextThreshold - currentThreshold : 0,\n      level,\n    };\n  }\n\n  /**\n   * Get the unlocks available at a given city level.\n   * @param level - The city level (1-10).\n   */\n  getCityUnlocks(level: number): CityLevelUnlock | null {\n    return LEVEL_UNLOCKS[level] ?? null;\n  }\n\n  /**\n   * Get all unlocks accumulated up to and including the city's current level.\n   * @param cityId - The city to query.\n   */\n  getAllUnlocksForCity(cityId: string): CityLevelUnlock[] {\n    const level = this.getCityLevel(cityId);\n    const unlocks: CityLevelUnlock[] = [];\n    for (let i = 1; i <= level; i++) {\n      const unlock = LEVEL_UNLOCKS[i];\n      if (unlock) unlocks.push(unlock);\n    }\n    return unlocks;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Passive Income\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Get the passive gold income per day for a city.\n   * Only level 10 cities generate passive income.\n   * @param cityId - The city to query.\n   * @returns Gold per day (0 if not level 10).\n   */\n  getPassiveIncome(cityId: string): number {\n    const level = this.getCityLevel(cityId);\n    if (level < MAX_CITY_LEVEL) return 0;\n    return LEVEL_10_PASSIVE_INCOME;\n  }\n\n  /**\n   * Get the total passive income across all level 10 cities.\n   * @returns Total gold per day from all maxed cities.\n   */\n  getTotalPassiveIncome(): number {\n    let total = 0;\n    for (const cityId of this.cities.keys()) {\n      total += this.getPassiveIncome(cityId);\n    }\n    return total;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Queries\n  // ---------------------------------------------------------------------------\n\n  /** Get all registered city IDs. */\n  getAllCityIds(): string[] {\n    return Array.from(this.cities.keys());\n  }\n\n  /** Check whether a city is registered. */\n  hasCity(cityId: string): boolean {\n    return this.cities.has(cityId);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Callbacks\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Register a callback fired when a city levels up.\n   * @param cb - Callback receiving the city ID and new level.\n   */\n  onCityLevelUp(cb: (cityId: string, newLevel: number) => void): void {\n    this.levelUpCallbacks.push(cb);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Internal Helpers\n  // ---------------------------------------------------------------------------\n\n  /** Convert raw XP to a level (1-10). */\n  private getLevelFromXP(xp: number): number {\n    let level = 1;\n    for (let i = 1; i < LEVEL_THRESHOLDS.length; i++) {\n      if (xp >= LEVEL_THRESHOLDS[i]) {\n        level = i + 1;\n      } else {\n        break;\n      }\n    }\n    return Math.min(level, MAX_CITY_LEVEL);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Persistence\n  // ---------------------------------------------------------------------------\n\n  /** Serialize for save. */\n  serialize(): CityLevelSaveData {\n    const cities: Record<string, CityState> = {};\n    for (const [cityId, state] of this.cities) {\n      cities[cityId] = { ...state };\n    }\n    return { cities };\n  }\n\n  /** Deserialize from save. */\n  deserialize(data: CityLevelSaveData): void {\n    this.cities.clear();\n\n    if (data.cities) {\n      for (const [cityId, state] of Object.entries(data.cities)) {\n        this.cities.set(cityId, {\n          xp: state.xp ?? 0,\n        });\n      }\n    }\n  }\n}\n","/**\n * EDILAS (Phaser) - New Game Plus Manager\n * Tracks NG+ cycle (0-5), applies difficulty multipliers, manages carryover\n * options, and unlocks exclusive items at each NG+ cycle.\n *\n * Phase 4: Endgame Systems — New Game Plus.\n */\n\n// ---------------------------------------------------------------------------\n// Constants\n// ---------------------------------------------------------------------------\n\n/** Maximum NG+ cycle. */\nconst MAX_CYCLE = 5;\n\n/** Difficulty multiplier per NG+ cycle. Cycle 0 has no multiplier. */\nconst DIFFICULTY_MULTIPLIERS: Record<number, number> = {\n  0: 1.0,\n  1: 1.5,\n  2: 2.0,\n  3: 3.0,\n  4: 4.0,\n  5: 5.0,\n};\n\n/** Valid carryover option keys. */\nconst VALID_CARRYOVER_OPTIONS: ReadonlySet<string> = new Set([\n  'gold',\n  'items',\n  'skills',\n  'relationships',\n  'achievements',\n  'titles',\n]);\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\n/** Definition for a NG+ exclusive item. */\nexport interface NGPlusExclusiveItem {\n  id: string;\n  name: string;\n  description: string;\n  /** The NG+ cycle at which this item becomes available. */\n  unlockedAtCycle: number;\n}\n\ninterface NewGamePlusSaveData {\n  cycle: number;\n  carryoverOptions: string[];\n}\n\n// ---------------------------------------------------------------------------\n// Exclusive Item Data\n// ---------------------------------------------------------------------------\n\nconst EXCLUSIVE_ITEMS: readonly NGPlusExclusiveItem[] = [\n  {\n    id: 'galaxy_soul',\n    name: 'Galaxy Soul',\n    description: 'A crystallized fragment of the cosmos, pulsing with infinite energy.',\n    unlockedAtCycle: 1,\n  },\n  {\n    id: 'prismatic_ring',\n    name: 'Prismatic Ring',\n    description: 'A ring that refracts light into all colors, granting elemental mastery.',\n    unlockedAtCycle: 2,\n  },\n  {\n    id: 'infinity_blade',\n    name: 'Infinity Blade',\n    description: 'A weapon forged beyond the boundaries of time, its edge never dulls.',\n    unlockedAtCycle: 3,\n  },\n  {\n    id: 'celestial_orb',\n    name: 'Celestial Orb',\n    description: 'An orb containing a trapped star, radiating immense power.',\n    unlockedAtCycle: 4,\n  },\n  {\n    id: 'void_amulet',\n    name: 'Void Amulet',\n    description: 'An amulet from the space between worlds, granting passage through the void.',\n    unlockedAtCycle: 5,\n  },\n];\n\n// ---------------------------------------------------------------------------\n// New Game Plus Manager\n// ---------------------------------------------------------------------------\n\n/**\n * Manages New Game+ cycles (0-5), difficulty scaling, carryover options,\n * and exclusive item unlocks. Cycle 0 represents the initial playthrough;\n * cycles 1-5 are successive NG+ runs with increasing difficulty.\n */\nexport class NewGamePlusManager {\n  /** Current NG+ cycle (0 = first playthrough, 1-5 = NG+ runs). */\n  private cycle: number = 0;\n\n  /** Carryover options selected for the current NG+ run. */\n  private carryoverOptions: Set<string> = new Set();\n\n  // Callbacks\n  private newGamePlusStartCallbacks: Array<(cycle: number, carryover: Set<string>) => void> = [];\n\n  constructor() {\n    // Starts at cycle 0 (initial playthrough)\n  }\n\n  // ---------------------------------------------------------------------------\n  // NG+ Lifecycle\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Start a New Game Plus run. Increments the cycle (up to MAX_CYCLE),\n   * applies the selected carryover options, and fires callbacks.\n   * @param carryoverOptions - Set of carryover option keys to preserve.\n   * @returns `true` if NG+ was started successfully.\n   */\n  startNewGamePlus(carryoverOptions: Set<string>): boolean {\n    if (this.cycle >= MAX_CYCLE) return false;\n\n    this.cycle++;\n\n    // Filter to only valid carryover options\n    this.carryoverOptions = new Set(\n      [...carryoverOptions].filter(opt => VALID_CARRYOVER_OPTIONS.has(opt)),\n    );\n\n    for (const cb of this.newGamePlusStartCallbacks) {\n      cb(this.cycle, this.carryoverOptions);\n    }\n\n    return true;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Queries\n  // ---------------------------------------------------------------------------\n\n  /** Get the difficulty multiplier for the current NG+ cycle. */\n  getDifficultyMultiplier(): number {\n    return DIFFICULTY_MULTIPLIERS[this.cycle] ?? 1.0;\n  }\n\n  /** Get the current NG+ cycle (0-5). */\n  getCycle(): number {\n    return this.cycle;\n  }\n\n  /** Whether the player is on a New Game Plus run (cycle >= 1). */\n  isNewGamePlus(): boolean {\n    return this.cycle > 0;\n  }\n\n  /** Get the carryover options for the current NG+ run. */\n  getCarryoverOptions(): Set<string> {\n    return new Set(this.carryoverOptions);\n  }\n\n  /** Check whether a specific option was carried over. */\n  hasCarryover(option: string): boolean {\n    return this.carryoverOptions.has(option);\n  }\n\n  /**\n   * Get NG+ exclusive items available at the current cycle.\n   * Returns items whose `unlockedAtCycle` is <= the current cycle.\n   */\n  getExclusiveItems(): NGPlusExclusiveItem[] {\n    return EXCLUSIVE_ITEMS.filter(item => item.unlockedAtCycle <= this.cycle);\n  }\n\n  /** Get all valid carryover option keys. */\n  getValidCarryoverOptions(): string[] {\n    return Array.from(VALID_CARRYOVER_OPTIONS);\n  }\n\n  /** Get the maximum NG+ cycle. */\n  getMaxCycle(): number {\n    return MAX_CYCLE;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Callbacks\n  // ---------------------------------------------------------------------------\n\n  /** Register a callback fired when a New Game Plus run starts. */\n  onNewGamePlusStart(cb: (cycle: number, carryover: Set<string>) => void): void {\n    this.newGamePlusStartCallbacks.push(cb);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Persistence\n  // ---------------------------------------------------------------------------\n\n  /** Serialize for save. */\n  serialize(): NewGamePlusSaveData {\n    return {\n      cycle: this.cycle,\n      carryoverOptions: Array.from(this.carryoverOptions),\n    };\n  }\n\n  /** Deserialize from save. */\n  deserialize(data: NewGamePlusSaveData): void {\n    this.cycle = Math.min(Math.max(data.cycle ?? 0, 0), MAX_CYCLE);\n    this.carryoverOptions = new Set(data.carryoverOptions ?? []);\n  }\n}\n","/**\n * EDILAS (Phaser) - Endgame Manager\n * Tracks 5 endgame requirements to unlock the EDILAS portal.\n * Each requirement must be fully completed before the portal opens.\n *\n * Phase 4: Endgame Systems — Portal Unlock Requirements.\n */\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\n/** Status of a single endgame requirement. */\nexport interface EndgameRequirement {\n  id: string;\n  name: string;\n  description: string;\n  current: number;\n  required: number;\n  completed: boolean;\n}\n\n/** Internal tracked state for a requirement. */\ninterface RequirementState {\n  current: number;\n}\n\ninterface EndgameSaveData {\n  requirements: Record<string, RequirementState>;\n  portalUnlocked: boolean;\n}\n\n// ---------------------------------------------------------------------------\n// Requirement Definitions\n// ---------------------------------------------------------------------------\n\n/** Static definitions for the 5 endgame requirements. */\ninterface RequirementDef {\n  id: string;\n  name: string;\n  description: string;\n  required: number;\n}\n\nconst REQUIREMENT_DEFS: readonly RequirementDef[] = [\n  {\n    id: 'discoverAllCities',\n    name: 'World Explorer',\n    description: 'Discover all 12 cities across the world of EDILAS.',\n    required: 12,\n  },\n  {\n    id: 'maxLevelCities',\n    name: 'City Builder',\n    description: 'Raise at least 3 cities to their maximum level (10).',\n    required: 3,\n  },\n  {\n    id: 'masterWeapon',\n    name: 'Weapon Master',\n    description: 'Master at least 1 weapon type by reaching mastery level 20.',\n    required: 1,\n  },\n  {\n    id: 'defeatGateBosses',\n    name: 'Gate Breaker',\n    description: 'Defeat all 7 gate bosses guarding the regions of EDILAS.',\n    required: 7,\n  },\n  {\n    id: 'collectAncientSeals',\n    name: 'Seal Collector',\n    description: 'Collect all 3 ancient seals from dungeon seal floors (50, 75, and 100).',\n    required: 3,\n  },\n];\n\n/** Map for quick lookup by requirement ID. */\nconst REQUIREMENT_DEF_MAP: Map<string, RequirementDef> = new Map(\n  REQUIREMENT_DEFS.map(def => [def.id, def]),\n);\n\n// ---------------------------------------------------------------------------\n// Endgame Manager\n// ---------------------------------------------------------------------------\n\n/**\n * Tracks endgame requirements and determines when the EDILAS portal unlocks.\n * Other systems call `checkRequirement()` to update progress. Once all 5\n * requirements are met, the portal unlocks and callbacks fire.\n */\nexport class EndgameManager {\n  /** requirementId -> current progress */\n  private requirements: Map<string, RequirementState> = new Map();\n\n  /** Whether the portal has been unlocked. */\n  private portalUnlocked: boolean = false;\n\n  // Callbacks\n  private portalUnlockCallbacks: Array<() => void> = [];\n\n  constructor() {\n    for (const def of REQUIREMENT_DEFS) {\n      this.requirements.set(def.id, { current: 0 });\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Progress Updates\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Update progress for a specific endgame requirement.\n   * @param reqId - The requirement ID to update.\n   * @param value - The new progress value (absolute, not delta).\n   */\n  checkRequirement(reqId: string, value: number): void {\n    const def = REQUIREMENT_DEF_MAP.get(reqId);\n    if (!def) return;\n\n    const state = this.requirements.get(reqId);\n    if (!state) return;\n\n    state.current = Math.max(state.current, value);\n\n    // Check if all requirements are now met\n    if (!this.portalUnlocked && this.allRequirementsMet()) {\n      this.portalUnlocked = true;\n      for (const cb of this.portalUnlockCallbacks) {\n        cb();\n      }\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Queries\n  // ---------------------------------------------------------------------------\n\n  /** Whether the EDILAS portal is unlocked (all requirements met). */\n  isPortalUnlocked(): boolean {\n    return this.portalUnlocked;\n  }\n\n  /** Get all requirements with their current progress. */\n  getRequirements(): EndgameRequirement[] {\n    return REQUIREMENT_DEFS.map(def => {\n      const state = this.requirements.get(def.id);\n      const current = state?.current ?? 0;\n      return {\n        id: def.id,\n        name: def.name,\n        description: def.description,\n        current: Math.min(current, def.required),\n        required: def.required,\n        completed: current >= def.required,\n      };\n    });\n  }\n\n  /** Get a single requirement by ID. */\n  getRequirement(reqId: string): EndgameRequirement | null {\n    const def = REQUIREMENT_DEF_MAP.get(reqId);\n    if (!def) return null;\n\n    const state = this.requirements.get(reqId);\n    const current = state?.current ?? 0;\n    return {\n      id: def.id,\n      name: def.name,\n      description: def.description,\n      current: Math.min(current, def.required),\n      required: def.required,\n      completed: current >= def.required,\n    };\n  }\n\n  /** Get the number of completed requirements. */\n  getCompletedCount(): number {\n    let count = 0;\n    for (const def of REQUIREMENT_DEFS) {\n      const state = this.requirements.get(def.id);\n      if (state && state.current >= def.required) {\n        count++;\n      }\n    }\n    return count;\n  }\n\n  /** Get the total number of requirements. */\n  getTotalCount(): number {\n    return REQUIREMENT_DEFS.length;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Callbacks\n  // ---------------------------------------------------------------------------\n\n  /** Register a callback fired when the EDILAS portal is unlocked. */\n  onPortalUnlock(cb: () => void): void {\n    this.portalUnlockCallbacks.push(cb);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Persistence\n  // ---------------------------------------------------------------------------\n\n  /** Serialize for save. */\n  serialize(): EndgameSaveData {\n    const requirements: Record<string, RequirementState> = {};\n    for (const [id, state] of this.requirements) {\n      requirements[id] = { current: state.current };\n    }\n    return {\n      requirements,\n      portalUnlocked: this.portalUnlocked,\n    };\n  }\n\n  /** Deserialize from save. */\n  deserialize(data: EndgameSaveData): void {\n    this.portalUnlocked = data.portalUnlocked ?? false;\n\n    if (data.requirements) {\n      for (const [id, state] of Object.entries(data.requirements)) {\n        if (this.requirements.has(id)) {\n          this.requirements.set(id, { current: state.current ?? 0 });\n        }\n      }\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Internal\n  // ---------------------------------------------------------------------------\n\n  /** Check if all endgame requirements have been met. */\n  private allRequirementsMet(): boolean {\n    for (const def of REQUIREMENT_DEFS) {\n      const state = this.requirements.get(def.id);\n      if (!state || state.current < def.required) return false;\n    }\n    return true;\n  }\n}\n","/**\n * EDILAS (Phaser) - Tutorial Manager\n * Tracks which tutorial tips have been shown to the player.\n * Tips are shown once and then dismissed permanently (persisted across saves).\n *\n * Phase 4: Endgame Systems — Tutorial Tips.\n */\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\n/** Definition for a tutorial tip. */\nexport interface TutorialTipDef {\n  key: string;\n  title: string;\n  body: string;\n  /** Whether the player can dismiss this tip manually. */\n  dismissable: boolean;\n}\n\ninterface TutorialSaveData {\n  shownTips: string[];\n}\n\n// ---------------------------------------------------------------------------\n// Tutorial Tip Definitions\n// ---------------------------------------------------------------------------\n\nconst TUTORIAL_TIPS: readonly TutorialTipDef[] = [\n  {\n    key: 'first_tool_use',\n    title: 'Using Tools',\n    body: 'Equip a tool from your inventory and use it on the world. Different tools work on different objects — try your axe on trees and your pickaxe on rocks.',\n    dismissable: true,\n  },\n  {\n    key: 'first_crop',\n    title: 'Planting Crops',\n    body: 'Till the soil with your hoe, plant a seed, and water it daily. Crops take several days to grow — check back often!',\n    dismissable: true,\n  },\n  {\n    key: 'first_combat',\n    title: 'Combat Basics',\n    body: 'Attack enemies with your equipped weapon. Watch your health bar and dodge incoming attacks. Use potions to heal when needed.',\n    dismissable: true,\n  },\n  {\n    key: 'first_npc',\n    title: 'Meeting NPCs',\n    body: 'Talk to NPCs to learn about the world, accept quests, and build relationships. Give gifts to increase your friendship level.',\n    dismissable: true,\n  },\n  {\n    key: 'first_dungeon',\n    title: 'Entering Dungeons',\n    body: 'Dungeons are dangerous multi-floor challenges. Prepare with food, potions, and upgraded gear before descending deeper.',\n    dismissable: true,\n  },\n  {\n    key: 'first_crafting',\n    title: 'Crafting Items',\n    body: 'Visit a crafting station to combine materials into new items. Recipes unlock as you discover new materials and level up your skills.',\n    dismissable: true,\n  },\n  {\n    key: 'first_fishing',\n    title: 'Fishing',\n    body: 'Cast your line into water and wait for a bite. Time your catch carefully — rarer fish are harder to reel in.',\n    dismissable: true,\n  },\n  {\n    key: 'first_cooking',\n    title: 'Cooking Meals',\n    body: 'Use a kitchen to cook meals from ingredients. Cooked food restores more health and energy than raw ingredients.',\n    dismissable: true,\n  },\n  {\n    key: 'first_quest',\n    title: 'Your First Quest',\n    body: 'Check the quest log to see your objectives. Complete all objectives to earn rewards like gold, items, and experience.',\n    dismissable: true,\n  },\n  {\n    key: 'first_boss',\n    title: 'Boss Encounter',\n    body: 'Bosses are powerful enemies with unique attack patterns. Study their moves, dodge carefully, and strike when they are vulnerable.',\n    dismissable: false,\n  },\n];\n\n/** Map for quick lookup by tip key. */\nconst TIP_MAP: Map<string, TutorialTipDef> = new Map(\n  TUTORIAL_TIPS.map(tip => [tip.key, tip]),\n);\n\n// ---------------------------------------------------------------------------\n// Tutorial Manager\n// ---------------------------------------------------------------------------\n\n/**\n * Manages tutorial tips shown to the player. Each tip is shown once and\n * permanently dismissed. The set of shown tips is persisted across saves.\n */\nexport class TutorialManager {\n  /** Keys of tips that have already been shown. */\n  private shownTips: Set<string> = new Set();\n\n  // Callbacks\n  private tipShowCallbacks: Array<(tip: TutorialTipDef) => void> = [];\n\n  constructor() {\n    // No initialization needed; all tips start as unseen\n  }\n\n  // ---------------------------------------------------------------------------\n  // Tip Display\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Show a tutorial tip if it has not already been shown.\n   * Fires `onTipShow` callbacks when a tip is newly displayed.\n   * @param key - The tip key to show.\n   * @returns `true` if the tip was shown (first time), `false` if already seen.\n   */\n  showTip(key: string): boolean {\n    if (this.shownTips.has(key)) return false;\n\n    const def = TIP_MAP.get(key);\n    if (!def) return false;\n\n    this.shownTips.add(key);\n\n    for (const cb of this.tipShowCallbacks) {\n      cb(def);\n    }\n\n    return true;\n  }\n\n  /**\n   * Check if a tutorial tip has been seen.\n   * @param key - The tip key to check.\n   */\n  hasSeen(key: string): boolean {\n    return this.shownTips.has(key);\n  }\n\n  /**\n   * Mark a tip as seen without triggering the show callbacks.\n   * Useful for dismissing tips programmatically.\n   * @param key - The tip key to dismiss.\n   */\n  dismiss(key: string): void {\n    this.shownTips.add(key);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Queries\n  // ---------------------------------------------------------------------------\n\n  /** Get all tutorial tip definitions. */\n  getAllTips(): TutorialTipDef[] {\n    return [...TUTORIAL_TIPS];\n  }\n\n  /** Get a specific tip definition by key, or null if not found. */\n  getTip(key: string): TutorialTipDef | null {\n    return TIP_MAP.get(key) ?? null;\n  }\n\n  /** Get the number of tips that have been shown. */\n  getShownCount(): number {\n    return this.shownTips.size;\n  }\n\n  /** Get the total number of tutorial tips. */\n  getTotalCount(): number {\n    return TUTORIAL_TIPS.length;\n  }\n\n  /** Get all unseen tip keys. */\n  getUnseenTips(): string[] {\n    return TUTORIAL_TIPS\n      .filter(tip => !this.shownTips.has(tip.key))\n      .map(tip => tip.key);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Callbacks\n  // ---------------------------------------------------------------------------\n\n  /** Register a callback fired when a tutorial tip is shown for the first time. */\n  onTipShow(cb: (tip: TutorialTipDef) => void): void {\n    this.tipShowCallbacks.push(cb);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Persistence\n  // ---------------------------------------------------------------------------\n\n  /** Serialize for save. */\n  serialize(): TutorialSaveData {\n    return {\n      shownTips: Array.from(this.shownTips),\n    };\n  }\n\n  /** Deserialize from save. */\n  deserialize(data: TutorialSaveData): void {\n    this.shownTips = new Set(data.shownTips ?? []);\n  }\n}\n","/**\n * EDILAS (Phaser) - Interior Manager\n * Tracks which interior/building the player is currently inside.\n * Provides definitions for all interior spaces including dimensions and exits.\n *\n * Phase 4: Endgame Systems — Interior/Building Maps.\n */\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\n/** An exit point within an interior, leading to another scene or the overworld. */\nexport interface InteriorExit {\n  x: number;\n  y: number;\n  targetScene: string;\n  targetX: number;\n  targetY: number;\n}\n\n/** Definition for an interior space. */\nexport interface InteriorDef {\n  id: string;\n  name: string;\n  /** Width of the interior in tiles. */\n  width: number;\n  /** Height of the interior in tiles. */\n  height: number;\n  /** Exit points from this interior. */\n  exits: InteriorExit[];\n}\n\ninterface InteriorSaveData {\n  currentInterior: string | null;\n}\n\n// ---------------------------------------------------------------------------\n// Interior Definitions\n// ---------------------------------------------------------------------------\n\nconst INTERIOR_DEFS: readonly InteriorDef[] = [\n  {\n    id: 'player_home',\n    name: 'Your Home',\n    width: 12,\n    height: 10,\n    exits: [{ x: 6, y: 9, targetScene: 'overworld', targetX: 50, targetY: 52 }],\n  },\n  {\n    id: 'general_store',\n    name: 'General Store',\n    width: 14,\n    height: 10,\n    exits: [{ x: 7, y: 9, targetScene: 'overworld', targetX: 45, targetY: 40 }],\n  },\n  {\n    id: 'blacksmith',\n    name: 'Blacksmith',\n    width: 12,\n    height: 12,\n    exits: [{ x: 6, y: 11, targetScene: 'overworld', targetX: 55, targetY: 40 }],\n  },\n  {\n    id: 'tavern',\n    name: 'Tavern',\n    width: 16,\n    height: 12,\n    exits: [{ x: 8, y: 11, targetScene: 'overworld', targetX: 60, targetY: 45 }],\n  },\n  {\n    id: 'inn',\n    name: 'Inn',\n    width: 14,\n    height: 14,\n    exits: [{ x: 7, y: 13, targetScene: 'overworld', targetX: 65, targetY: 45 }],\n  },\n  {\n    id: 'library',\n    name: 'Library',\n    width: 16,\n    height: 10,\n    exits: [{ x: 8, y: 9, targetScene: 'overworld', targetX: 40, targetY: 50 }],\n  },\n  {\n    id: 'temple',\n    name: 'Temple',\n    width: 18,\n    height: 14,\n    exits: [{ x: 9, y: 13, targetScene: 'overworld', targetX: 50, targetY: 35 }],\n  },\n  {\n    id: 'mayor_house',\n    name: \"Mayor's House\",\n    width: 14,\n    height: 12,\n    exits: [{ x: 7, y: 11, targetScene: 'overworld', targetX: 48, targetY: 38 }],\n  },\n  {\n    id: 'farmer_house',\n    name: \"Farmer's House\",\n    width: 10,\n    height: 8,\n    exits: [{ x: 5, y: 7, targetScene: 'overworld', targetX: 35, targetY: 55 }],\n  },\n  {\n    id: 'fisher_house',\n    name: \"Fisher's House\",\n    width: 10,\n    height: 8,\n    exits: [{ x: 5, y: 7, targetScene: 'overworld', targetX: 70, targetY: 60 }],\n  },\n  {\n    id: 'wizard_tower',\n    name: \"Wizard's Tower\",\n    width: 10,\n    height: 16,\n    exits: [{ x: 5, y: 15, targetScene: 'overworld', targetX: 30, targetY: 30 }],\n  },\n  {\n    id: 'guard_barracks',\n    name: 'Guard Barracks',\n    width: 16,\n    height: 10,\n    exits: [{ x: 8, y: 9, targetScene: 'overworld', targetX: 55, targetY: 35 }],\n  },\n];\n\n/** Map for quick lookup by interior ID. */\nconst INTERIOR_DEF_MAP: Map<string, InteriorDef> = new Map(\n  INTERIOR_DEFS.map(def => [def.id, def]),\n);\n\n// ---------------------------------------------------------------------------\n// Interior Manager\n// ---------------------------------------------------------------------------\n\n/**\n * Tracks the player's current interior location. When the player enters a\n * building, `enterInterior()` is called; when they leave, `exitInterior()`\n * returns them to the overworld. The current interior state is persisted.\n */\nexport class InteriorManager {\n  /** The ID of the interior the player is currently in, or null for overworld. */\n  private currentInterior: string | null = null;\n\n  // Callbacks\n  private enterCallbacks: Array<(interiorId: string, def: InteriorDef) => void> = [];\n  private exitCallbacks: Array<(interiorId: string) => void> = [];\n\n  constructor() {\n    // Player starts in the overworld\n  }\n\n  // ---------------------------------------------------------------------------\n  // Interior Transitions\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Enter an interior space by ID.\n   * @param interiorId - The interior to enter.\n   * @returns `true` if the interior was entered successfully.\n   */\n  enterInterior(interiorId: string): boolean {\n    const def = INTERIOR_DEF_MAP.get(interiorId);\n    if (!def) return false;\n\n    this.currentInterior = interiorId;\n\n    for (const cb of this.enterCallbacks) {\n      cb(interiorId, def);\n    }\n\n    return true;\n  }\n\n  /**\n   * Exit the current interior, returning to the overworld.\n   * @returns `true` if the player was in an interior and exited.\n   */\n  exitInterior(): boolean {\n    if (this.currentInterior === null) return false;\n\n    const prevInterior = this.currentInterior;\n    this.currentInterior = null;\n\n    for (const cb of this.exitCallbacks) {\n      cb(prevInterior);\n    }\n\n    return true;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Queries\n  // ---------------------------------------------------------------------------\n\n  /** Get the ID of the current interior, or null if in the overworld. */\n  getCurrentInterior(): string | null {\n    return this.currentInterior;\n  }\n\n  /** Whether the player is currently inside an interior. */\n  isInInterior(): boolean {\n    return this.currentInterior !== null;\n  }\n\n  /** Get the definition for an interior by ID, or null if not found. */\n  getInteriorDef(id: string): InteriorDef | null {\n    return INTERIOR_DEF_MAP.get(id) ?? null;\n  }\n\n  /** Get all interior definitions. */\n  getAllInteriors(): InteriorDef[] {\n    return [...INTERIOR_DEFS];\n  }\n\n  /** Get the definition for the current interior, or null if in the overworld. */\n  getCurrentInteriorDef(): InteriorDef | null {\n    if (this.currentInterior === null) return null;\n    return INTERIOR_DEF_MAP.get(this.currentInterior) ?? null;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Callbacks\n  // ---------------------------------------------------------------------------\n\n  /** Register a callback fired when the player enters an interior. */\n  onEnterInterior(cb: (interiorId: string, def: InteriorDef) => void): void {\n    this.enterCallbacks.push(cb);\n  }\n\n  /** Register a callback fired when the player exits an interior. */\n  onExitInterior(cb: (interiorId: string) => void): void {\n    this.exitCallbacks.push(cb);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Persistence\n  // ---------------------------------------------------------------------------\n\n  /** Serialize for save. */\n  serialize(): InteriorSaveData {\n    return {\n      currentInterior: this.currentInterior,\n    };\n  }\n\n  /** Deserialize from save. */\n  deserialize(data: InteriorSaveData): void {\n    this.currentInterior = data.currentInterior ?? null;\n  }\n}\n","/**\n * EDILAS (Phaser) - Legendary Quest Manager\n * Manages 5 multi-stage legendary quest chains with unique rewards.\n * Each quest has a linear sequence of stages that must be completed in order.\n *\n * Phase 4: Endgame Systems — Legendary Quest Chains.\n */\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\n/** A single stage within a legendary quest. */\nexport interface LegendaryQuestStage {\n  id: string;\n  name: string;\n  description: string;\n  /** Amount required to complete this stage. 1 for binary objectives. */\n  required: number;\n}\n\n/** Reward granted upon completing a legendary quest. */\nexport interface LegendaryQuestReward {\n  /** Item IDs granted as rewards. */\n  items: string[];\n  /** Title granted as a reward (if any). */\n  title: string | null;\n}\n\n/** Definition for a legendary quest chain. */\nexport interface LegendaryQuestDef {\n  id: string;\n  name: string;\n  description: string;\n  stages: LegendaryQuestStage[];\n  reward: LegendaryQuestReward;\n}\n\n/** Progress state for a single legendary quest. */\ninterface QuestProgressState {\n  /** Index of the current stage (0-based). */\n  currentStageIndex: number;\n  /** Progress toward the current stage's requirement. */\n  stageProgress: number;\n  /** Whether the quest has been started. */\n  started: boolean;\n  /** Whether the quest has been completed. */\n  completed: boolean;\n}\n\ninterface LegendaryQuestSaveData {\n  progress: Record<string, QuestProgressState>;\n}\n\n// ---------------------------------------------------------------------------\n// Quest Definitions\n// ---------------------------------------------------------------------------\n\nconst LEGENDARY_QUESTS: readonly LegendaryQuestDef[] = [\n  {\n    id: 'legend_of_the_void',\n    name: 'Legend of the Void',\n    description: 'Unravel the mystery of the Void and defeat the Shadow Lord who dwells within.',\n    stages: [\n      { id: 'gather_void_essence', name: 'Gather Void Essence', description: 'Collect 50 Void Essence from corrupted enemies.', required: 50 },\n      { id: 'find_void_portal', name: 'Find the Void Portal', description: 'Locate the hidden Void Portal in the depths of the world.', required: 1 },\n      { id: 'defeat_shadow_lord', name: 'Defeat the Shadow Lord', description: 'Confront and defeat the Shadow Lord within the Void.', required: 1 },\n    ],\n    reward: { items: [], title: 'Voidwalker' },\n  },\n  {\n    id: 'dragon_slayer',\n    name: 'Dragon Slayer',\n    description: 'Forge the legendary Dragonbane and slay the Ancient Dragon terrorizing the realm.',\n    stages: [\n      { id: 'forge_dragonbane', name: 'Forge Dragonbane', description: 'Forge the legendary Dragonbane sword from ancient materials.', required: 1 },\n      { id: 'collect_dragon_scales', name: 'Collect Dragon Scales', description: 'Collect 20 Dragon Scales from lesser dragons.', required: 20 },\n      { id: 'slay_ancient_dragon', name: 'Slay the Ancient Dragon', description: 'Defeat the Ancient Dragon in its mountain lair.', required: 1 },\n    ],\n    reward: { items: ['dragon_mount'], title: 'Dragon Slayer' },\n  },\n  {\n    id: 'king_of_the_sea',\n    name: 'King of the Sea',\n    description: 'Catch every legendary fish to prove your mastery of the ocean.',\n    stages: [\n      { id: 'catch_legend', name: 'Catch the Legend', description: 'Catch the mythical Legend fish.', required: 1 },\n      { id: 'catch_glacierfish', name: 'Catch the Glacierfish', description: 'Catch the elusive Glacierfish in frozen waters.', required: 1 },\n      { id: 'catch_crimsonfish', name: 'Catch the Crimsonfish', description: 'Catch the Crimsonfish in the volcanic sea.', required: 1 },\n      { id: 'catch_angler', name: 'Catch the Angler', description: 'Catch the Angler in the deepest ocean trench.', required: 1 },\n      { id: 'catch_mutant_carp', name: 'Catch the Mutant Carp', description: 'Catch the Mutant Carp in the toxic swamp.', required: 1 },\n    ],\n    reward: { items: ['neptunes_trident'], title: 'King of the Sea' },\n  },\n  {\n    id: 'the_ancient_fruit',\n    name: 'The Ancient Fruit',\n    description: 'Rediscover the lost Ancient Fruit and create the most prized wine in the world.',\n    stages: [\n      { id: 'find_ancient_seed', name: 'Find the Ancient Seed', description: 'Discover an Ancient Seed buried deep in the ruins.', required: 1 },\n      { id: 'grow_ancient_fruit', name: 'Grow the Ancient Fruit', description: 'Grow the Ancient Fruit to full maturity.', required: 1 },\n      { id: 'craft_ancient_wine_gold', name: 'Craft Gold Ancient Wine', description: 'Age the Ancient Fruit into gold-quality Ancient Wine.', required: 1 },\n    ],\n    reward: { items: ['ancient_greenhouse'], title: 'Ancient Cultivator' },\n  },\n  {\n    id: 'world_purifier',\n    name: 'World Purifier',\n    description: 'Cleanse every corrupted region and restore EDILAS to its former glory.',\n    stages: [\n      { id: 'purify_haven', name: 'Purify Haven', description: 'Cleanse the corruption from Haven.', required: 1 },\n      { id: 'purify_rotwood', name: 'Purify Rotwood', description: 'Cleanse the corruption from Rotwood Forest.', required: 1 },\n      { id: 'purify_ashlands', name: 'Purify the Ashlands', description: 'Cleanse the corruption from the Ashlands.', required: 1 },\n      { id: 'purify_drowned', name: 'Purify the Drowned Coast', description: 'Cleanse the corruption from the Drowned Coast.', required: 1 },\n      { id: 'purify_bone_wastes', name: 'Purify the Bone Wastes', description: 'Cleanse the corruption from the Bone Wastes.', required: 1 },\n      { id: 'purify_the_void', name: 'Purify the Void', description: 'Cleanse the corruption from the Void.', required: 1 },\n      { id: 'purify_edilas', name: 'Purify EDILAS', description: 'Perform the final purification ritual to heal the world.', required: 1 },\n    ],\n    reward: { items: ['world_healing_aura'], title: 'Guardian' },\n  },\n];\n\n/** Map for quick lookup by quest ID. */\nconst QUEST_DEF_MAP: Map<string, LegendaryQuestDef> = new Map(\n  LEGENDARY_QUESTS.map(q => [q.id, q]),\n);\n\n// ---------------------------------------------------------------------------\n// Legendary Quest Manager\n// ---------------------------------------------------------------------------\n\n/**\n * Manages 5 legendary quest chains, each with multiple sequential stages.\n * Other systems call `advanceStage()` when the player completes relevant\n * actions. Quests auto-complete when all stages are finished.\n */\nexport class LegendaryQuestManager {\n  /** questId -> progress state */\n  private progress: Map<string, QuestProgressState> = new Map();\n\n  // Callbacks\n  private questCompleteCallbacks: Array<(questId: string, reward: LegendaryQuestReward) => void> = [];\n  private stageCompleteCallbacks: Array<(questId: string, stageId: string, stageIndex: number) => void> = [];\n\n  constructor() {\n    // Initialize all quests as not started\n    for (const quest of LEGENDARY_QUESTS) {\n      this.progress.set(quest.id, {\n        currentStageIndex: 0,\n        stageProgress: 0,\n        started: false,\n        completed: false,\n      });\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Quest Lifecycle\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Start a legendary quest. Must be called before stages can be advanced.\n   * @param questId - The quest to start.\n   * @returns `true` if the quest was started successfully.\n   */\n  startQuest(questId: string): boolean {\n    const def = QUEST_DEF_MAP.get(questId);\n    if (!def) return false;\n\n    const state = this.progress.get(questId);\n    if (!state) return false;\n\n    // Cannot restart a completed or already started quest\n    if (state.started) return false;\n\n    state.started = true;\n    state.currentStageIndex = 0;\n    state.stageProgress = 0;\n    return true;\n  }\n\n  /**\n   * Advance a quest stage by contributing progress toward its requirement.\n   * @param questId - The quest to advance.\n   * @param stageId - The stage ID to contribute to (must be the current stage).\n   * @param amount - The amount of progress to add (default 1).\n   * @returns `true` if progress was applied.\n   */\n  advanceStage(questId: string, stageId: string, amount: number = 1): boolean {\n    const def = QUEST_DEF_MAP.get(questId);\n    if (!def) return false;\n\n    const state = this.progress.get(questId);\n    if (!state || !state.started || state.completed) return false;\n\n    // Ensure the stageId matches the current stage\n    const currentStage = def.stages[state.currentStageIndex];\n    if (!currentStage || currentStage.id !== stageId) return false;\n\n    state.stageProgress = Math.min(state.stageProgress + amount, currentStage.required);\n\n    // Check if the current stage is complete\n    if (state.stageProgress >= currentStage.required) {\n      const completedStageIndex = state.currentStageIndex;\n      const completedStageId = currentStage.id;\n\n      // Fire stage complete callbacks\n      for (const cb of this.stageCompleteCallbacks) {\n        cb(questId, completedStageId, completedStageIndex);\n      }\n\n      // Advance to next stage or complete the quest\n      if (state.currentStageIndex + 1 >= def.stages.length) {\n        // Quest complete\n        state.completed = true;\n        for (const cb of this.questCompleteCallbacks) {\n          cb(questId, def.reward);\n        }\n      } else {\n        // Move to next stage\n        state.currentStageIndex++;\n        state.stageProgress = 0;\n      }\n    }\n\n    return true;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Queries\n  // ---------------------------------------------------------------------------\n\n  /** Whether a specific quest has been completed. */\n  isQuestComplete(questId: string): boolean {\n    const state = this.progress.get(questId);\n    return state?.completed ?? false;\n  }\n\n  /**\n   * Get detailed progress for a quest.\n   * Returns null if the quest ID is invalid.\n   */\n  getQuestProgress(questId: string): {\n    quest: LegendaryQuestDef;\n    currentStageIndex: number;\n    stageProgress: number;\n    started: boolean;\n    completed: boolean;\n  } | null {\n    const def = QUEST_DEF_MAP.get(questId);\n    if (!def) return null;\n\n    const state = this.progress.get(questId);\n    if (!state) return null;\n\n    return {\n      quest: def,\n      currentStageIndex: state.currentStageIndex,\n      stageProgress: state.stageProgress,\n      started: state.started,\n      completed: state.completed,\n    };\n  }\n\n  /** Get all quests that have been started but not yet completed. */\n  getActiveQuests(): LegendaryQuestDef[] {\n    const active: LegendaryQuestDef[] = [];\n    for (const quest of LEGENDARY_QUESTS) {\n      const state = this.progress.get(quest.id);\n      if (state && state.started && !state.completed) {\n        active.push(quest);\n      }\n    }\n    return active;\n  }\n\n  /** Get all quests that have been completed. */\n  getCompletedQuests(): LegendaryQuestDef[] {\n    const completed: LegendaryQuestDef[] = [];\n    for (const quest of LEGENDARY_QUESTS) {\n      const state = this.progress.get(quest.id);\n      if (state && state.completed) {\n        completed.push(quest);\n      }\n    }\n    return completed;\n  }\n\n  /** Get all legendary quest definitions. */\n  getAllQuests(): LegendaryQuestDef[] {\n    return [...LEGENDARY_QUESTS];\n  }\n\n  /** Get a quest definition by ID, or null if not found. */\n  getQuestDef(questId: string): LegendaryQuestDef | null {\n    return QUEST_DEF_MAP.get(questId) ?? null;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Callbacks\n  // ---------------------------------------------------------------------------\n\n  /** Register a callback fired when a legendary quest is completed. */\n  onQuestComplete(cb: (questId: string, reward: LegendaryQuestReward) => void): void {\n    this.questCompleteCallbacks.push(cb);\n  }\n\n  /** Register a callback fired when a quest stage is completed. */\n  onStageComplete(cb: (questId: string, stageId: string, stageIndex: number) => void): void {\n    this.stageCompleteCallbacks.push(cb);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Persistence\n  // ---------------------------------------------------------------------------\n\n  /** Serialize for save. */\n  serialize(): LegendaryQuestSaveData {\n    const progress: Record<string, QuestProgressState> = {};\n    for (const [id, state] of this.progress) {\n      progress[id] = { ...state };\n    }\n    return { progress };\n  }\n\n  /** Deserialize from save. */\n  deserialize(data: LegendaryQuestSaveData): void {\n    if (data.progress) {\n      for (const [id, state] of Object.entries(data.progress)) {\n        if (this.progress.has(id)) {\n          this.progress.set(id, {\n            currentStageIndex: state.currentStageIndex ?? 0,\n            stageProgress: state.stageProgress ?? 0,\n            started: state.started ?? false,\n            completed: state.completed ?? false,\n          });\n        }\n      }\n    }\n  }\n}\n","import { WeaponType } from '../ecs/components';\n\nexport interface AbilityDef {\n  id: string;\n  name: string;\n  weaponType: WeaponType;\n  cooldown: number;        // Seconds\n  staminaCost: number;\n  damageMult: number;\n  aoeRadius: number;       // 0 = single target\n  statusEffect?: string;\n  statusDuration?: number;\n  statusChance?: number;\n  comboChain?: string;     // Next ability ID in combo\n  description: string;\n}\n\nexport interface AbilityState {\n  cooldownRemaining: number;\n}\n\n/**\n * Manages weapon abilities, combo chains, and the 4-slot ability hotbar.\n */\nexport class AbilityManager {\n  private abilities: Map<string, AbilityDef> = new Map();\n  private hotbar: (string | null)[] = [null, null, null, null];\n  private cooldowns: Map<string, number> = new Map();\n  private unlockedAbilities: Set<string> = new Set();\n  private lastUsedAbility: string | null = null;\n  private comboTimer: number = 0;\n  private readonly COMBO_WINDOW = 1.5; // seconds\n\n  constructor() {\n    // Register all 30 abilities\n    for (const ability of ALL_ABILITIES) {\n      this.abilities.set(ability.id, ability);\n    }\n  }\n\n  /** Unlock an ability for use */\n  unlock(abilityId: string): void {\n    this.unlockedAbilities.add(abilityId);\n  }\n\n  /** Assign ability to hotbar slot (0-3) */\n  setHotbar(slot: number, abilityId: string | null): void {\n    if (slot >= 0 && slot < 4) {\n      this.hotbar[slot] = abilityId;\n    }\n  }\n\n  /** Get hotbar contents */\n  getHotbar(): readonly (string | null)[] {\n    return this.hotbar;\n  }\n\n  /** Try to use an ability. Returns the ability def if successful, null if on cooldown/no stamina. */\n  useAbility(abilityId: string, currentStamina: number): AbilityDef | null {\n    const ability = this.abilities.get(abilityId);\n    if (!ability) return null;\n    if (!this.unlockedAbilities.has(abilityId)) return null;\n\n    const cd = this.cooldowns.get(abilityId) ?? 0;\n    if (cd > 0) return null;\n    if (currentStamina < ability.staminaCost) return null;\n\n    // Check combo chain\n    if (ability.comboChain && this.lastUsedAbility === ability.comboChain && this.comboTimer > 0) {\n      // Combo bonus: reduced cooldown\n      this.cooldowns.set(abilityId, ability.cooldown * 0.5);\n    } else {\n      this.cooldowns.set(abilityId, ability.cooldown);\n    }\n\n    this.lastUsedAbility = abilityId;\n    this.comboTimer = this.COMBO_WINDOW;\n\n    return ability;\n  }\n\n  /** Update cooldown timers */\n  update(delta: number): void {\n    for (const [id, cd] of this.cooldowns) {\n      const newCd = cd - delta;\n      if (newCd <= 0) {\n        this.cooldowns.delete(id);\n      } else {\n        this.cooldowns.set(id, newCd);\n      }\n    }\n\n    if (this.comboTimer > 0) {\n      this.comboTimer -= delta;\n      if (this.comboTimer <= 0) {\n        this.lastUsedAbility = null;\n      }\n    }\n  }\n\n  /** Get ability def */\n  getAbility(id: string): AbilityDef | undefined {\n    return this.abilities.get(id);\n  }\n\n  /** Get abilities for a weapon type */\n  getAbilitiesForWeapon(weaponType: WeaponType): AbilityDef[] {\n    return [...this.abilities.values()].filter(a => a.weaponType === weaponType);\n  }\n\n  /** Get cooldown remaining */\n  getCooldown(id: string): number {\n    return this.cooldowns.get(id) ?? 0;\n  }\n\n  /** Check if ability is unlocked */\n  isUnlocked(id: string): boolean {\n    return this.unlockedAbilities.has(id);\n  }\n\n  /** Serialize */\n  serialize(): { unlocked: string[]; hotbar: (string | null)[] } {\n    return {\n      unlocked: [...this.unlockedAbilities],\n      hotbar: [...this.hotbar],\n    };\n  }\n\n  /** Deserialize */\n  deserialize(data: { unlocked: string[]; hotbar: (string | null)[] }): void {\n    this.unlockedAbilities = new Set(data.unlocked);\n    this.hotbar = [...data.hotbar];\n  }\n}\n\n/** All 30 weapon abilities */\nexport const ALL_ABILITIES: AbilityDef[] = [\n  // Sword (5)\n  { id: 'whirlwind_slash', name: 'Whirlwind Slash', weaponType: WeaponType.Sword, cooldown: 6, staminaCost: 20, damageMult: 1.5, aoeRadius: 48, description: 'Spin attack hitting all nearby enemies' },\n  { id: 'rising_cut', name: 'Rising Cut', weaponType: WeaponType.Sword, cooldown: 4, staminaCost: 12, damageMult: 1.8, aoeRadius: 0, comboChain: 'whirlwind_slash', description: 'Upward slash that launches enemies' },\n  { id: 'parry_counter', name: 'Parry Counter', weaponType: WeaponType.Sword, cooldown: 8, staminaCost: 15, damageMult: 2.5, aoeRadius: 0, description: 'Counter next attack for massive damage' },\n  { id: 'judgment_cut', name: 'Judgment Cut', weaponType: WeaponType.Sword, cooldown: 12, staminaCost: 30, damageMult: 3.0, aoeRadius: 32, description: 'Precise dimensional slash' },\n  { id: 'blade_storm', name: 'Blade Storm', weaponType: WeaponType.Sword, cooldown: 20, staminaCost: 45, damageMult: 2.0, aoeRadius: 64, statusEffect: 'bleed', statusDuration: 5, statusChance: 0.5, description: 'Flurry of slashes creating a storm of blades' },\n\n  // Axe (4)\n  { id: 'mighty_cleave', name: 'Mighty Cleave', weaponType: WeaponType.Axe, cooldown: 5, staminaCost: 18, damageMult: 2.0, aoeRadius: 32, description: 'Powerful overhead chop' },\n  { id: 'rending_strike', name: 'Rending Strike', weaponType: WeaponType.Axe, cooldown: 7, staminaCost: 22, damageMult: 1.6, aoeRadius: 0, statusEffect: 'bleed', statusDuration: 6, statusChance: 0.8, description: 'Tearing strike that causes bleeding' },\n  { id: 'berserker_rage', name: 'Berserker Rage', weaponType: WeaponType.Axe, cooldown: 25, staminaCost: 35, damageMult: 1.0, aoeRadius: 0, description: '+50% damage and speed for 8 seconds' },\n  { id: 'executioner_blow', name: \"Executioner's Blow\", weaponType: WeaponType.Axe, cooldown: 15, staminaCost: 40, damageMult: 4.0, aoeRadius: 0, description: 'Massive damage to enemies below 30% HP' },\n\n  // Spear (4)\n  { id: 'piercing_thrust', name: 'Piercing Thrust', weaponType: WeaponType.Spear, cooldown: 3, staminaCost: 10, damageMult: 1.8, aoeRadius: 0, description: 'Long-range piercing attack' },\n  { id: 'cyclone_spin', name: 'Cyclone Spin', weaponType: WeaponType.Spear, cooldown: 8, staminaCost: 25, damageMult: 1.4, aoeRadius: 56, description: 'Spinning spear attack hitting all around' },\n  { id: 'pinning_strike', name: 'Pinning Strike', weaponType: WeaponType.Spear, cooldown: 10, staminaCost: 20, damageMult: 1.5, aoeRadius: 0, statusEffect: 'stun', statusDuration: 2, statusChance: 1.0, description: 'Pin enemy in place' },\n  { id: 'sky_piercer', name: 'Sky Piercer', weaponType: WeaponType.Spear, cooldown: 18, staminaCost: 35, damageMult: 3.5, aoeRadius: 24, description: 'Leap into the air and slam down' },\n\n  // Bow (4)\n  { id: 'power_shot', name: 'Power Shot', weaponType: WeaponType.Bow, cooldown: 4, staminaCost: 12, damageMult: 2.2, aoeRadius: 0, description: 'Charged shot with extra damage' },\n  { id: 'arrow_rain', name: 'Arrow Rain', weaponType: WeaponType.Bow, cooldown: 12, staminaCost: 30, damageMult: 1.0, aoeRadius: 80, description: 'Rain of arrows in a wide area' },\n  { id: 'frost_arrow', name: 'Frost Arrow', weaponType: WeaponType.Bow, cooldown: 8, staminaCost: 18, damageMult: 1.5, aoeRadius: 0, statusEffect: 'freeze', statusDuration: 3, statusChance: 0.7, description: 'Freezing arrow that slows enemies' },\n  { id: 'deadeye', name: 'Deadeye', weaponType: WeaponType.Bow, cooldown: 15, staminaCost: 25, damageMult: 5.0, aoeRadius: 0, description: 'Perfect shot — guaranteed critical hit' },\n\n  // Staff (5)\n  { id: 'arcane_bolt', name: 'Arcane Bolt', weaponType: WeaponType.Staff, cooldown: 2, staminaCost: 8, damageMult: 1.4, aoeRadius: 0, description: 'Fast magic projectile' },\n  { id: 'chain_lightning', name: 'Chain Lightning', weaponType: WeaponType.Staff, cooldown: 8, staminaCost: 22, damageMult: 1.2, aoeRadius: 48, description: 'Lightning that chains between enemies' },\n  { id: 'arcane_barrier', name: 'Arcane Barrier', weaponType: WeaponType.Staff, cooldown: 15, staminaCost: 30, damageMult: 0, aoeRadius: 0, description: 'Shield that absorbs 50% damage for 6s' },\n  { id: 'meteor_strike', name: 'Meteor Strike', weaponType: WeaponType.Staff, cooldown: 20, staminaCost: 45, damageMult: 3.5, aoeRadius: 72, statusEffect: 'burn', statusDuration: 4, statusChance: 1.0, description: 'Call down a meteor on target area' },\n  { id: 'time_warp', name: 'Time Warp', weaponType: WeaponType.Staff, cooldown: 30, staminaCost: 50, damageMult: 0, aoeRadius: 96, description: 'Slow all enemies in area by 60% for 5s' },\n\n  // Dagger (4)\n  { id: 'shadow_step', name: 'Shadow Step', weaponType: WeaponType.Dagger, cooldown: 5, staminaCost: 15, damageMult: 2.0, aoeRadius: 0, description: 'Teleport behind target and backstab' },\n  { id: 'fan_of_knives', name: 'Fan of Knives', weaponType: WeaponType.Dagger, cooldown: 7, staminaCost: 20, damageMult: 1.2, aoeRadius: 56, description: 'Throw knives in a cone' },\n  { id: 'poison_blade', name: 'Poison Blade', weaponType: WeaponType.Dagger, cooldown: 10, staminaCost: 18, damageMult: 1.3, aoeRadius: 0, statusEffect: 'poison', statusDuration: 8, statusChance: 1.0, description: 'Coat blade in poison for 3 attacks' },\n  { id: 'death_mark', name: 'Death Mark', weaponType: WeaponType.Dagger, cooldown: 20, staminaCost: 35, damageMult: 1.0, aoeRadius: 0, description: 'Mark target — all damage +40% for 6s' },\n\n  // Hammer (4)\n  { id: 'ground_pound', name: 'Ground Pound', weaponType: WeaponType.Hammer, cooldown: 6, staminaCost: 22, damageMult: 1.8, aoeRadius: 48, statusEffect: 'stun', statusDuration: 1.5, statusChance: 0.6, description: 'Slam ground, stunning nearby enemies' },\n  { id: 'shockwave', name: 'Shockwave', weaponType: WeaponType.Hammer, cooldown: 10, staminaCost: 28, damageMult: 1.5, aoeRadius: 72, description: 'Send shockwave in a line' },\n  { id: 'fortify', name: 'Fortify', weaponType: WeaponType.Hammer, cooldown: 18, staminaCost: 20, damageMult: 0, aoeRadius: 0, description: '+50% defense for 8 seconds' },\n  { id: 'titans_grip', name: \"Titan's Grip\", weaponType: WeaponType.Hammer, cooldown: 22, staminaCost: 45, damageMult: 5.0, aoeRadius: 32, statusEffect: 'stun', statusDuration: 3, statusChance: 1.0, description: 'Massive overhead smash' },\n];\n","/**\n * EDILAS (Phaser) - Cutscene Manager\n * Simple cutscene playback system supporting narration, dialogue, and wait steps.\n * Cutscenes are ephemeral (not serialized) — they play once and are discarded.\n *\n * Phase 4: Endgame Systems — Cutscene Playback.\n */\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\n/** A single step in a cutscene sequence. */\nexport interface CutsceneStep {\n  /** The type of cutscene step. */\n  type: 'narration' | 'dialogue' | 'wait';\n  /** Text to display (used for narration and dialogue). */\n  text?: string;\n  /** Speaker name (used for dialogue). */\n  speaker?: string;\n  /** Duration in milliseconds (used for wait steps). */\n  duration?: number;\n}\n\n// ---------------------------------------------------------------------------\n// Cutscene Manager\n// ---------------------------------------------------------------------------\n\n/**\n * Manages cutscene playback with support for narration, dialogue, and timed\n * wait steps. Playback is driven externally: the rendering layer reads the\n * current step and calls `advance()` when the player presses a key or a\n * timed wait expires.\n */\nexport class CutsceneManager {\n  /** The current cutscene steps being played. */\n  private steps: CutsceneStep[] = [];\n\n  /** Index of the current step. */\n  private currentStepIndex: number = -1;\n\n  /** Whether a cutscene is currently playing. */\n  private playing: boolean = false;\n\n  // Callbacks\n  private cutsceneStartCallbacks: Array<(steps: CutsceneStep[]) => void> = [];\n  private cutsceneEndCallbacks: Array<() => void> = [];\n  private stepChangeCallbacks: Array<(step: CutsceneStep, index: number) => void> = [];\n\n  constructor() {\n    // No initialization needed\n  }\n\n  // ---------------------------------------------------------------------------\n  // Playback Control\n  // ---------------------------------------------------------------------------\n\n  /**\n   * Start playing a cutscene from the given steps.\n   * If a cutscene is already playing, it will be replaced.\n   * @param steps - Array of cutscene steps to play.\n   */\n  playCutscene(steps: CutsceneStep[]): void {\n    if (steps.length === 0) return;\n\n    this.steps = [...steps];\n    this.currentStepIndex = 0;\n    this.playing = true;\n\n    for (const cb of this.cutsceneStartCallbacks) {\n      cb(this.steps);\n    }\n\n    // Notify step change for the first step\n    const firstStep = this.steps[0];\n    for (const cb of this.stepChangeCallbacks) {\n      cb(firstStep, 0);\n    }\n  }\n\n  /**\n   * Advance to the next step in the cutscene.\n   * If the current step is the last one, the cutscene ends.\n   */\n  advance(): void {\n    if (!this.playing) return;\n\n    this.currentStepIndex++;\n\n    if (this.currentStepIndex >= this.steps.length) {\n      this.endCutscene();\n      return;\n    }\n\n    const step = this.steps[this.currentStepIndex];\n    for (const cb of this.stepChangeCallbacks) {\n      cb(step, this.currentStepIndex);\n    }\n  }\n\n  /**\n   * Skip the entire cutscene immediately.\n   * Fires the cutscene end callbacks.\n   */\n  skip(): void {\n    if (!this.playing) return;\n    this.endCutscene();\n  }\n\n  // ---------------------------------------------------------------------------\n  // Queries\n  // ---------------------------------------------------------------------------\n\n  /** Whether a cutscene is currently playing. */\n  isPlaying(): boolean {\n    return this.playing;\n  }\n\n  /** Get the current cutscene step, or null if not playing. */\n  getCurrentStep(): CutsceneStep | null {\n    if (!this.playing || this.currentStepIndex < 0 || this.currentStepIndex >= this.steps.length) {\n      return null;\n    }\n    return this.steps[this.currentStepIndex];\n  }\n\n  /** Get the current step index. Returns -1 if not playing. */\n  getCurrentStepIndex(): number {\n    return this.playing ? this.currentStepIndex : -1;\n  }\n\n  /** Get the total number of steps in the current cutscene. */\n  getTotalSteps(): number {\n    return this.steps.length;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Callbacks\n  // ---------------------------------------------------------------------------\n\n  /** Register a callback fired when a cutscene starts. */\n  onCutsceneStart(cb: (steps: CutsceneStep[]) => void): void {\n    this.cutsceneStartCallbacks.push(cb);\n  }\n\n  /** Register a callback fired when a cutscene ends (completed or skipped). */\n  onCutsceneEnd(cb: () => void): void {\n    this.cutsceneEndCallbacks.push(cb);\n  }\n\n  /** Register a callback fired when the active step changes. */\n  onStepChange(cb: (step: CutsceneStep, index: number) => void): void {\n    this.stepChangeCallbacks.push(cb);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Internal\n  // ---------------------------------------------------------------------------\n\n  /** End the current cutscene and fire callbacks. */\n  private endCutscene(): void {\n    this.playing = false;\n    this.currentStepIndex = -1;\n    this.steps = [];\n\n    for (const cb of this.cutsceneEndCallbacks) {\n      cb();\n    }\n  }\n}\n","/**\n * EDILAS — Lore Fragments (Dark Souls / Hollow Knight-inspired environmental storytelling)\n * Discoverable text fragments scattered through the world that piece together the\n * history of the corruption and the world's fall. Found via ground pickups, enemy drops,\n * fishing, farming, and dungeon exploration.\n */\n\nexport interface LoreFragmentDef {\n  id: string;\n  title: string;\n  text: string;\n  biome: string;\n  source: 'ground' | 'enemy_drop' | 'fishing' | 'farming' | 'dungeon' | 'chest';\n  rarity: number;        // 0=common, 1=uncommon, 2=rare, 3=legendary\n  codexCategory: string; // Groups fragments in the codex UI\n}\n\nexport const LORE_FRAGMENTS: LoreFragmentDef[] = [\n  // ── HAVEN: The Last Refuge ──\n  {\n    id: 'haven_01', title: 'A Warden\\'s Journal', codexCategory: 'haven',\n    text: 'Day 347. The corruption stopped at the river. We built walls, lit fires, and told ourselves it was enough. But at night, you can hear the trees on the far bank whispering in tongues no living mouth should shape.',\n    biome: 'haven', source: 'ground', rarity: 0,\n  },\n  {\n    id: 'haven_02', title: 'Carved Prayer Stone', codexCategory: 'haven',\n    text: 'To whoever reads this after we are gone: Haven was not always a refuge. Before the corruption, it was simply a crossroads. We made it holy by refusing to let it fall.',\n    biome: 'haven', source: 'farming', rarity: 0,\n  },\n  {\n    id: 'haven_03', title: 'Merchant\\'s Lament', codexCategory: 'haven',\n    text: 'The caravans stopped coming three seasons ago. Now we trade in hope and fear, and both are in dwindling supply. I saw a child yesterday who had never tasted sugar.',\n    biome: 'haven', source: 'ground', rarity: 0,\n  },\n  {\n    id: 'haven_04', title: 'The First Campfire', codexCategory: 'haven',\n    text: 'They say the first campfire was lit by a traveler who refused to sleep in darkness. She burned everything she had — books, clothes, a painting of her daughter — just to keep the flame alive until dawn.',\n    biome: 'haven', source: 'chest', rarity: 1,\n  },\n  {\n    id: 'haven_05', title: 'Faded Map Fragment', codexCategory: 'haven',\n    text: 'This torn map shows roads that no longer exist, connecting cities that no longer stand. Someone has drawn a single star over Haven with the word \"STILL\" in desperate handwriting.',\n    biome: 'haven', source: 'fishing', rarity: 1,\n  },\n\n  // ── ROTWOOD: The Poisoned Forest ──\n  {\n    id: 'rotwood_01', title: 'Druid\\'s Final Entry', codexCategory: 'corruption',\n    text: 'The trees are not dying. They are changing. I pressed my ear to the eldest oak and heard a heartbeat — slow, alien, impossibly deep. The forest is not being consumed. It is being replaced.',\n    biome: 'rotwood', source: 'ground', rarity: 0,\n  },\n  {\n    id: 'rotwood_02', title: 'Hunter\\'s Warning', codexCategory: 'corruption',\n    text: 'Do not drink the water. Do not eat the fruit. Do not sleep beneath the canopy. The corruption enters through trust — it mimics the familiar until you forget what was real.',\n    biome: 'rotwood', source: 'enemy_drop', rarity: 0,\n  },\n  {\n    id: 'rotwood_03', title: 'Spore Analysis Notes', codexCategory: 'corruption',\n    text: 'The spores are not random. They form patterns — spirals, fractals, mathematical precision no natural growth should achieve. Whatever drives the corruption has intelligence. And patience.',\n    biome: 'rotwood', source: 'ground', rarity: 1,\n  },\n  {\n    id: 'rotwood_04', title: 'Bark Inscription', codexCategory: 'corruption',\n    text: 'Cut into the corrupted bark in an unknown script. When translated by the last linguist in Haven, it read simply: \"WE WERE HERE BEFORE YOUR SUN.\"',\n    biome: 'rotwood', source: 'chest', rarity: 2,\n  },\n  {\n    id: 'rotwood_05', title: 'Ranger\\'s Bones', codexCategory: 'haven',\n    text: 'Found clutching a locket with two portraits inside — a woman and child. The ranger\\'s armor bears Haven\\'s crest. They came to scout the forest\\'s edge. They never reported back.',\n    biome: 'rotwood', source: 'dungeon', rarity: 1,\n  },\n\n  // ── ASHLANDS: The Burning Waste ──\n  {\n    id: 'ash_01', title: 'Blacksmith\\'s Testament', codexCategory: 'titans',\n    text: 'The mountain did not erupt. It was pushed open from inside. I watched the Ash Titan rise from the caldera, a thing of ember and fury older than language. The forges I spent my life tending were toys beside its fire.',\n    biome: 'ashlands', source: 'ground', rarity: 0,\n  },\n  {\n    id: 'ash_02', title: 'Scorched Battle Standard', codexCategory: 'titans',\n    text: 'An entire regiment marched against the Titan. Three hundred souls with blessed weapons and songs of courage. The ash fields are their grave. Not one returned.',\n    biome: 'ashlands', source: 'enemy_drop', rarity: 0,\n  },\n  {\n    id: 'ash_03', title: 'Volcanic Glass Tablet', codexCategory: 'corruption',\n    text: 'The corruption and the fire are not allies. They compete for the same territory — our world. The Ashlands burn because two apocalypses collided, and we are caught between them.',\n    biome: 'ashlands', source: 'ground', rarity: 1,\n  },\n  {\n    id: 'ash_04', title: 'Obsidian Mirror Shard', codexCategory: 'shadow_world',\n    text: 'When you look into volcanic glass at midnight, you see another world layered over ours — buildings where there are ruins, people where there are bones. The Shadow World remembers what we have lost.',\n    biome: 'ashlands', source: 'dungeon', rarity: 2,\n  },\n  {\n    id: 'ash_05', title: 'Phoenix Feather Scroll', codexCategory: 'titans',\n    text: 'The Titan is not mindless. It grieves. I saw it stand motionless for three days over a pool of cooled magma, and when it left, the pool had crystallized into the shape of a woman holding a child.',\n    biome: 'ashlands', source: 'chest', rarity: 2,\n  },\n\n  // ── DROWNED: The Sunken Coast ──\n  {\n    id: 'drowned_01', title: 'Sailor\\'s Logbook', codexCategory: 'corruption',\n    text: 'The sea did not rise. The land sank. In a single night, the coastline retreated inland by ten leagues. From the new shore, we could see the rooftops of our homes beneath the waves, lights still burning.',\n    biome: 'drowned', source: 'fishing', rarity: 0,\n  },\n  {\n    id: 'drowned_02', title: 'Barnacled Shield', codexCategory: 'factions',\n    text: 'The Tide Guard defended the harbors until the water claimed them. Their final act was to chain the harbor gates shut so the things swimming up from the deep could not follow the survivors inland.',\n    biome: 'drowned', source: 'enemy_drop', rarity: 0,\n  },\n  {\n    id: 'drowned_03', title: 'Deep Sea Specimen', codexCategory: 'corruption',\n    text: 'This creature has no eyes, no mouth, and no brain — yet it moves with purpose. Dissection reveals its body is a single continuous cell. It should not be alive. It should not exist at all.',\n    biome: 'drowned', source: 'fishing', rarity: 1,\n  },\n  {\n    id: 'drowned_04', title: 'Sunken Temple Relic', codexCategory: 'shadow_world',\n    text: 'Carved from coral that grows only in waters tainted by the Shadow World\\'s bleed-through. The inscription warns: \"The boundary is thinnest where salt water meets corruption. Do not swim at night.\"',\n    biome: 'drowned', source: 'dungeon', rarity: 2,\n  },\n  {\n    id: 'drowned_05', title: 'Lighthouse Keeper\\'s Vigil', codexCategory: 'haven',\n    text: 'The lighthouse still burns. I refuel it each week, though no ships come. Perhaps it is not for the living. Perhaps the dead at sea need a light to know they are not forgotten.',\n    biome: 'drowned', source: 'ground', rarity: 1,\n  },\n\n  // ── BONE WASTES: The Graveyard of Empires ──\n  {\n    id: 'bone_01', title: 'Archaeologist\\'s Discovery', codexCategory: 'history',\n    text: 'The bones are not from any species I recognize. They predate human settlement by millennia. Something vast lived here, died here, and its skeleton became the foundation of an empire that is itself now dead.',\n    biome: 'bone', source: 'ground', rarity: 0,\n  },\n  {\n    id: 'bone_02', title: 'Imperial Decree (Crumbling)', codexCategory: 'history',\n    text: '\"By order of the Emperor: all citizens are to evacuate beyond the third wall. The corruption has breached the second. Those who remain will be considered already dead.\" The decree is dated 200 years ago.',\n    biome: 'bone', source: 'enemy_drop', rarity: 0,\n  },\n  {\n    id: 'bone_03', title: 'Gravedigger\\'s Philosophy', codexCategory: 'history',\n    text: 'I have buried kings and beggars. The corruption treats them the same — both rise again on the third night. There is a terrible equality in this apocalypse that the living never achieved.',\n    biome: 'bone', source: 'ground', rarity: 1,\n  },\n  {\n    id: 'bone_04', title: 'Soul Gem Fragment', codexCategory: 'shadow_world',\n    text: 'This gem pulses with trapped memories. Touching it floods your mind with images: a thriving city, a great library, children playing in sunlit streets. Then darkness. Then nothing. Then you are back in the wastes.',\n    biome: 'bone', source: 'dungeon', rarity: 2,\n  },\n  {\n    id: 'bone_05', title: 'The Emperor\\'s Last Letter', codexCategory: 'history',\n    text: 'My dearest — I write this from the throne room as the walls fall. I was wrong to fight. I was wrong to stay. I was wrong about everything except loving you. Forgive me. The darkness is kind, in its way.',\n    biome: 'bone', source: 'chest', rarity: 2,\n  },\n\n  // ── THE VOID: The Edge of Reality ──\n  {\n    id: 'void_01', title: 'Scholar\\'s Madness', codexCategory: 'shadow_world',\n    text: 'I have seen the truth. The corruption is not an invasion — it is a correction. Our world is the anomaly, a bubble of matter floating in an infinite sea of void. The corruption is the void reclaiming what was always its own.',\n    biome: 'void', source: 'ground', rarity: 1,\n  },\n  {\n    id: 'void_02', title: 'Void-Touched Stone', codexCategory: 'shadow_world',\n    text: 'This stone exists in two places simultaneously. In our world, it is cold and dark. In the Shadow World, it burns with white fire. Between the two, in the space that should not exist, it whispers.',\n    biome: 'void', source: 'enemy_drop', rarity: 1,\n  },\n  {\n    id: 'void_03', title: 'Time-Lost Message', codexCategory: 'shadow_world',\n    text: 'This note is written in your handwriting, in ink that has not yet been made, on paper from a tree that has not yet grown. It says: \"Do not trust the light at the center. It remembers what you will forget.\"',\n    biome: 'void', source: 'ground', rarity: 2,\n  },\n  {\n    id: 'void_04', title: 'The Void Anchor\\'s Memory', codexCategory: 'titans',\n    text: 'Before the Titans woke, they dreamed. Their dreams became the corruption. Their nightmares became the Shadow World. And the Void? The Void is what happens when even nightmares stop caring.',\n    biome: 'void', source: 'dungeon', rarity: 2,\n  },\n  {\n    id: 'void_05', title: 'A Letter to No One', codexCategory: 'shadow_world',\n    text: 'I am the last researcher. My colleagues walked into the Void and did not return. They did not die — I can still hear them speaking. But their voices come from everywhere at once, and they are speaking in futures that haven\\'t happened.',\n    biome: 'void', source: 'chest', rarity: 3,\n  },\n\n  // ── EDILAS: The Heart of the World ──\n  {\n    id: 'edilas_01', title: 'The World\\'s Name', codexCategory: 'history',\n    text: 'Edilas was not always the name of a place. It was a promise — in the old tongue, it means \"that which endures.\" The first settlers chose it deliberately, defiantly, as if naming it could make it true.',\n    biome: 'edilas', source: 'ground', rarity: 1,\n  },\n  {\n    id: 'edilas_02', title: 'The Corruption\\'s Origin', codexCategory: 'corruption',\n    text: 'It did not come from outside. The corruption rose from within — from the deepest mines, from the oldest wells, from the foundation stones of the first cities. We built our civilization on top of its sleeping body.',\n    biome: 'edilas', source: 'enemy_drop', rarity: 2,\n  },\n  {\n    id: 'edilas_03', title: 'The Titan\\'s Bargain', codexCategory: 'titans',\n    text: 'The five Titans were not born of corruption — they were created to fight it. Ancient god-weapons forged by hands now forgotten. But something went wrong. They absorbed what they were meant to destroy, and now they serve both sides of the war.',\n    biome: 'edilas', source: 'dungeon', rarity: 2,\n  },\n  {\n    id: 'edilas_04', title: 'The Shadow World\\'s Truth', codexCategory: 'shadow_world',\n    text: 'The Shadow World is not a reflection. It is the original. Our world is the shadow — a fading echo of what existed before the corruption rewrote reality. Everything we call \"real\" is a memory the Shadow World is slowly forgetting.',\n    biome: 'edilas', source: 'chest', rarity: 3,\n  },\n  {\n    id: 'edilas_05', title: 'Edilas Endures', codexCategory: 'history',\n    text: 'I have seen empires crumble, titans fall, and corruption consume everything. Yet people still plant seeds, still light fires, still tell stories to their children. Edilas endures not because it is strong, but because its people refuse to stop trying.',\n    biome: 'edilas', source: 'ground', rarity: 3,\n  },\n];\n\n/** Fragment lookup by ID */\nexport const FRAGMENT_DB = new Map<string, LoreFragmentDef>();\nfor (const f of LORE_FRAGMENTS) FRAGMENT_DB.set(f.id, f);\n\n/** Get fragments by biome */\nexport function getFragmentsByBiome(biome: string): LoreFragmentDef[] {\n  return LORE_FRAGMENTS.filter(f => f.biome === biome);\n}\n\n/** Get fragments by source type */\nexport function getFragmentsBySource(source: LoreFragmentDef['source']): LoreFragmentDef[] {\n  return LORE_FRAGMENTS.filter(f => f.source === source);\n}\n\n/** Codex categories for grouping */\nexport const CODEX_CATEGORIES = ['haven', 'corruption', 'titans', 'history', 'shadow_world', 'factions'] as const;\n","/**\n * EDILAS — Codex Manager\n * Tracks discovered lore fragments and provides codex queries.\n * Inspired by Dark Souls item descriptions and Hollow Knight environmental lore.\n */\n\nimport { LORE_FRAGMENTS, FRAGMENT_DB, CODEX_CATEGORIES } from '../data/loreFragments';\nimport type { LoreFragmentDef } from '../data/loreFragments';\n\nexport interface CodexEntry {\n  fragment: LoreFragmentDef;\n  discoveredAt: number; // timestamp\n}\n\nexport class CodexManager {\n  /** Set of discovered fragment IDs */\n  private discovered: Map<string, CodexEntry> = new Map();\n\n  /** Callbacks for fragment discovery events */\n  private onDiscoverCbs: ((fragment: LoreFragmentDef) => void)[] = [];\n\n  /** Register a callback for when a new fragment is discovered */\n  onDiscover(cb: (fragment: LoreFragmentDef) => void): void {\n    this.onDiscoverCbs.push(cb);\n  }\n\n  /** Discover a lore fragment by ID. Returns true if new, false if already known. */\n  discover(fragmentId: string): boolean {\n    if (this.discovered.has(fragmentId)) return false;\n    const fragment = FRAGMENT_DB.get(fragmentId);\n    if (!fragment) return false;\n\n    this.discovered.set(fragmentId, {\n      fragment,\n      discoveredAt: Date.now(),\n    });\n\n    for (const cb of this.onDiscoverCbs) cb(fragment);\n    return true;\n  }\n\n  /** Check if a fragment has been discovered */\n  isDiscovered(fragmentId: string): boolean {\n    return this.discovered.has(fragmentId);\n  }\n\n  /** Get all discovered entries */\n  getAllDiscovered(): CodexEntry[] {\n    return Array.from(this.discovered.values());\n  }\n\n  /** Get discovered entries by codex category */\n  getByCategory(category: string): CodexEntry[] {\n    return this.getAllDiscovered().filter(e => e.fragment.codexCategory === category);\n  }\n\n  /** Get discovery count per category */\n  getCategoryCounts(): Record<string, { found: number; total: number }> {\n    const counts: Record<string, { found: number; total: number }> = {};\n    for (const cat of CODEX_CATEGORIES) {\n      const total = LORE_FRAGMENTS.filter(f => f.codexCategory === cat).length;\n      const found = this.getByCategory(cat).length;\n      counts[cat] = { found, total };\n    }\n    return counts;\n  }\n\n  /** Total fragments discovered / total available */\n  getProgress(): { found: number; total: number } {\n    return { found: this.discovered.size, total: LORE_FRAGMENTS.length };\n  }\n\n  /**\n   * Roll whether a fragment drops from a given source in a given biome.\n   * Returns the fragment ID if one drops, null otherwise.\n   * Drop chance scales with rarity: common=5%, uncommon=2%, rare=0.5%, legendary=0.1%\n   */\n  rollFragmentDrop(biome: string, source: LoreFragmentDef['source']): string | null {\n    const candidates = LORE_FRAGMENTS.filter(\n      f => f.biome === biome && f.source === source && !this.discovered.has(f.id),\n    );\n    if (candidates.length === 0) return null;\n\n    const RARITY_CHANCES = [0.05, 0.02, 0.005, 0.001];\n\n    for (const frag of candidates) {\n      const chance = RARITY_CHANCES[frag.rarity] ?? 0.001;\n      if (Math.random() < chance) return frag.id;\n    }\n    return null;\n  }\n\n  // ── Serialization ──\n\n  serialize(): string[] {\n    return Array.from(this.discovered.keys());\n  }\n\n  deserialize(fragmentIds: string[]): void {\n    this.discovered.clear();\n    for (const id of fragmentIds) {\n      const fragment = FRAGMENT_DB.get(id);\n      if (fragment) {\n        this.discovered.set(id, { fragment, discoveredAt: 0 });\n      }\n    }\n  }\n}\n","/**\n * EDILAS — Scar Reading Memories (Hollow Knight Dream Nail-inspired)\n * Environmental lore delivered at the moment of interaction, not through menus.\n * The player's Mark pulses near traumatic locations and fallen creatures,\n * letting them read echoes of past events.\n *\n * Two categories:\n *   - Enemy memories: brief thoughts/final memories readable from corpses\n *   - World memories: readable from environmental objects (shrines, ruins, etc.)\n */\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport interface ScarMemory {\n  id: string;\n  /** What triggers this memory: enemy corpse, world object, or special location */\n  type: 'enemy' | 'world' | 'boss';\n  /** Enemy ID (for enemy/boss type) or world object key (for world type) */\n  sourceId: string;\n  /** Biome where this memory can be found */\n  biome: string;\n  /** The memory text — short, evocative, 1-2 sentences */\n  text: string;\n  /** Whether this is the \"alive\" thought or \"corpse\" memory (enemies/bosses only) */\n  state: 'alive' | 'dead' | 'any';\n  /** Codex category for tracking */\n  codexCategory: string;\n}\n\n// ---------------------------------------------------------------------------\n// Enemy Memories (thoughts when alive, final memories when dead)\n// ---------------------------------------------------------------------------\n\nexport const SCAR_MEMORIES: ScarMemory[] = [\n  // ── HAVEN ──\n  { id: 'sm_slime_alive', type: 'enemy', sourceId: 'forest_slime', biome: 'haven', state: 'alive',\n    text: 'Warm... light... food nearby... consume...', codexCategory: 'haven' },\n  { id: 'sm_slime_dead', type: 'enemy', sourceId: 'forest_slime', biome: 'haven', state: 'dead',\n    text: 'Once I was rain. I fell through corrupted soil and forgot how to evaporate.', codexCategory: 'haven' },\n  { id: 'sm_corpse_alive', type: 'enemy', sourceId: 'shambling_corpse', biome: 'haven', state: 'alive',\n    text: 'Must... walk... home... where is home... the walls... the walls are gone...', codexCategory: 'haven' },\n  { id: 'sm_corpse_dead', type: 'enemy', sourceId: 'shambling_corpse', biome: 'haven', state: 'dead',\n    text: 'I remember a daughter. I remember a door. I do not remember which I was walking toward.', codexCategory: 'haven' },\n  { id: 'sm_boar_alive', type: 'enemy', sourceId: 'wild_boar', biome: 'haven', state: 'alive',\n    text: 'Intruder in the grass. Charge. Protect the young. CHARGE.', codexCategory: 'haven' },\n  { id: 'sm_wolf_dead', type: 'enemy', sourceId: 'wild_wolf', biome: 'haven', state: 'dead',\n    text: 'The pack howls at dusk. One fewer voice tonight. The others will remember for exactly three moons.', codexCategory: 'haven' },\n  { id: 'sm_soul_alive', type: 'enemy', sourceId: 'lost_soul', biome: 'haven', state: 'alive',\n    text: 'I can see the living. They are so bright it hurts. Why won\\'t they look at me?', codexCategory: 'shadow_world' },\n\n  // ── ROTWOOD ──\n  { id: 'sm_spider_alive', type: 'enemy', sourceId: 'corpse_spider', biome: 'rotwood', state: 'alive',\n    text: 'Silk. Silk. Everything in silk. The prey stops screaming when wrapped tight enough.', codexCategory: 'corruption' },\n  { id: 'sm_treant_dead', type: 'enemy', sourceId: 'rotting_treant', biome: 'rotwood', state: 'dead',\n    text: 'Three hundred years I grew toward the sun. Then the sun turned black. I grew toward that instead.', codexCategory: 'corruption' },\n  { id: 'sm_wisp_alive', type: 'enemy', sourceId: 'will_o_wisp', biome: 'rotwood', state: 'alive',\n    text: 'Follow me. Follow me into the dark. I am the last lantern and I burn for no one.', codexCategory: 'corruption' },\n  { id: 'sm_spore_dead', type: 'enemy', sourceId: 'spore_cloud', biome: 'rotwood', state: 'dead',\n    text: 'We are not many. We are one mind, scattered into spores. Each death is a forgetting.', codexCategory: 'corruption' },\n  { id: 'sm_moth_alive', type: 'enemy', sourceId: 'poison_moth', biome: 'rotwood', state: 'alive',\n    text: 'The pollen tastes of copper and grief. I carry it between the dead flowers because there are no living ones left.', codexCategory: 'corruption' },\n\n  // ── ASHLANDS ──\n  { id: 'sm_imp_alive', type: 'enemy', sourceId: 'fire_imp', biome: 'ashlands', state: 'alive',\n    text: 'Burn bright! Burn fast! Better to be flame than fuel!', codexCategory: 'titans' },\n  { id: 'sm_imp_dead', type: 'enemy', sourceId: 'fire_imp', biome: 'ashlands', state: 'dead',\n    text: 'The Titan breathed, and we were born from the ash. We did not ask to burn.', codexCategory: 'titans' },\n  { id: 'sm_golem_alive', type: 'enemy', sourceId: 'magma_golem', biome: 'ashlands', state: 'alive',\n    text: 'DEFEND. THE. CALDERA. The master sleeps beneath. No one passes.', codexCategory: 'titans' },\n  { id: 'sm_golem_dead', type: 'enemy', sourceId: 'magma_golem', biome: 'ashlands', state: 'dead',\n    text: 'I was a wall before I was a soldier. The mountain shaped me to guard what it could not protect itself.', codexCategory: 'titans' },\n  { id: 'sm_knight_alive', type: 'enemy', sourceId: 'obsidian_knight', biome: 'ashlands', state: 'alive',\n    text: 'My oath did not end when the kingdom burned. If anything, it burns brighter now.', codexCategory: 'history' },\n  { id: 'sm_knight_dead', type: 'enemy', sourceId: 'obsidian_knight', biome: 'ashlands', state: 'dead',\n    text: 'Under the obsidian, a human face. Under the oath, a human fear. I was afraid every single day.', codexCategory: 'history' },\n\n  // ── DROWNED ──\n  { id: 'sm_lurker_alive', type: 'enemy', sourceId: 'marsh_lurker', biome: 'drowned', state: 'alive',\n    text: 'Still. Be still. The water hides us. The water feeds us. Wait for feet.', codexCategory: 'corruption' },\n  { id: 'sm_lurker_dead', type: 'enemy', sourceId: 'marsh_lurker', biome: 'drowned', state: 'dead',\n    text: 'We were fishermen once. The tide came in and we forgot to walk on land.', codexCategory: 'history' },\n  { id: 'sm_wraith_alive', type: 'enemy', sourceId: 'drowned_wraith', biome: 'drowned', state: 'alive',\n    text: 'The water is so cold. I have been drowning for years. Why does no one hear me screaming?', codexCategory: 'shadow_world' },\n  { id: 'sm_toad_dead', type: 'enemy', sourceId: 'poison_toad', biome: 'drowned', state: 'dead',\n    text: 'The pond where I was born is a mile inland now. Somewhere beneath these waves, tadpoles swim through a church.', codexCategory: 'history' },\n  { id: 'sm_jelly_alive', type: 'enemy', sourceId: 'acid_jellyfish', biome: 'drowned', state: 'alive',\n    text: 'Current... drift... sting what touches... no mind to think but still... still afraid of the deep.', codexCategory: 'corruption' },\n\n  // ── BONE WASTES ──\n  { id: 'sm_skeleton_alive', type: 'enemy', sourceId: 'skeletal_warrior', biome: 'bone', state: 'alive',\n    text: 'The Emperor said we would be remembered. He was right. We cannot stop remembering.', codexCategory: 'history' },\n  { id: 'sm_skeleton_dead', type: 'enemy', sourceId: 'skeletal_warrior', biome: 'bone', state: 'dead',\n    text: 'At last. Silence. The marching orders finally stopped echoing through my skull.', codexCategory: 'history' },\n  { id: 'sm_lich_alive', type: 'enemy', sourceId: 'bone_lich', biome: 'bone', state: 'alive',\n    text: 'I chose undeath because I was afraid of what came after. Now I know — this is what comes after.', codexCategory: 'shadow_world' },\n  { id: 'sm_revenant_dead', type: 'enemy', sourceId: 'bone_revenant', biome: 'bone', state: 'dead',\n    text: 'I was buried with honors. Medals on my chest. A flag over my coffin. The corruption did not care about any of it.', codexCategory: 'history' },\n\n  // ── VOID ──\n  { id: 'sm_void_walker_alive', type: 'enemy', sourceId: 'void_walker', biome: 'void', state: 'alive',\n    text: 'We walk between the cracks in reality. Your world looks so fragile from out here.', codexCategory: 'shadow_world' },\n  { id: 'sm_void_walker_dead', type: 'enemy', sourceId: 'void_walker', biome: 'void', state: 'dead',\n    text: 'I was a scholar who looked too long into the space between atoms. I found something looking back.', codexCategory: 'shadow_world' },\n  { id: 'sm_null_alive', type: 'enemy', sourceId: 'null_entity', biome: 'void', state: 'alive',\n    text: '...', codexCategory: 'shadow_world' },\n  { id: 'sm_null_dead', type: 'enemy', sourceId: 'null_entity', biome: 'void', state: 'dead',\n    text: 'Even nothingness has a memory. It remembers when there was something. It wants that back.', codexCategory: 'shadow_world' },\n\n  // ── EDILAS ──\n  { id: 'sm_titan_guard_alive', type: 'enemy', sourceId: 'titan_guard', biome: 'edilas', state: 'alive',\n    text: 'The heart of the world beats below. We are its immune system. You are the infection.', codexCategory: 'titans' },\n  { id: 'sm_titan_guard_dead', type: 'enemy', sourceId: 'titan_guard', biome: 'edilas', state: 'dead',\n    text: 'We were made to protect Edilas. We were never told that Edilas would need protection from us.', codexCategory: 'titans' },\n\n  // =========================================================================\n  // World Memories (readable from environmental objects)\n  // =========================================================================\n\n  // ── HAVEN ──\n  { id: 'sm_haven_campfire', type: 'world', sourceId: 'campfire_remains', biome: 'haven', state: 'any',\n    text: 'Someone sat here for a very long time. The ash has shaped itself around the absence of a body.', codexCategory: 'haven' },\n  { id: 'sm_haven_shrine', type: 'world', sourceId: 'old_shrine', biome: 'haven', state: 'any',\n    text: 'Offerings of dried flowers and copper coins. The god this shrine honors has been dead for decades, but the faithful keep coming.', codexCategory: 'haven' },\n  { id: 'sm_haven_well', type: 'world', sourceId: 'abandoned_well', biome: 'haven', state: 'any',\n    text: 'The water tastes of iron and old prayers. Someone dropped a wedding ring down this well and never came back for it.', codexCategory: 'haven' },\n  { id: 'sm_haven_grave', type: 'world', sourceId: 'unmarked_grave', biome: 'haven', state: 'any',\n    text: 'No name. No date. Just a stone over disturbed earth and a child\\'s wooden toy placed carefully on top.', codexCategory: 'haven' },\n\n  // ── ROTWOOD ──\n  { id: 'sm_rotwood_altar', type: 'world', sourceId: 'druid_altar', biome: 'rotwood', state: 'any',\n    text: 'The druids carved these runes to keep the forest healthy. Now the runes are growing bark. The spell worked too well.', codexCategory: 'corruption' },\n  { id: 'sm_rotwood_nest', type: 'world', sourceId: 'massive_web', biome: 'rotwood', state: 'any',\n    text: 'This web is large enough to catch a horse. The spider that built it is nowhere to be found. Perhaps it outgrew even this.', codexCategory: 'corruption' },\n  { id: 'sm_rotwood_stump', type: 'world', sourceId: 'ancient_stump', biome: 'rotwood', state: 'any',\n    text: 'Someone counted the rings before giving up. There is a note stuck in the bark: \"Older than the kingdom. Older than language.\"', codexCategory: 'history' },\n\n  // ── ASHLANDS ──\n  { id: 'sm_ash_forge', type: 'world', sourceId: 'ruined_forge', biome: 'ashlands', state: 'any',\n    text: 'The anvil still radiates heat. A sword was being forged when the eruption came. It remains, half-finished, perfect in its incompleteness.', codexCategory: 'titans' },\n  { id: 'sm_ash_statue', type: 'world', sourceId: 'melted_statue', biome: 'ashlands', state: 'any',\n    text: 'This was a monument to victory. The heat has softened the soldier\\'s face into an expression that looks more like grief.', codexCategory: 'history' },\n  { id: 'sm_ash_bones', type: 'world', sourceId: 'charred_remains', biome: 'ashlands', state: 'any',\n    text: 'Two sets of bones, arms wrapped around each other. They chose to face the fire together. That is its own kind of victory.', codexCategory: 'haven' },\n\n  // ── DROWNED ──\n  { id: 'sm_drowned_boat', type: 'world', sourceId: 'sunken_boat', biome: 'drowned', state: 'any',\n    text: 'The barnacles have made this boat their kingdom. In a hundred years, no one will know this was once a vessel. They will think it was always a reef.', codexCategory: 'history' },\n  { id: 'sm_drowned_bell', type: 'world', sourceId: 'submerged_bell', biome: 'drowned', state: 'any',\n    text: 'This church bell still rings when the current shifts. The fish have learned to avoid the sound. The ghosts have not.', codexCategory: 'shadow_world' },\n  { id: 'sm_drowned_chain', type: 'world', sourceId: 'harbor_chains', biome: 'drowned', state: 'any',\n    text: 'The Tide Guard chained these gates shut from the inside. They knew they would drown. They did it anyway.', codexCategory: 'factions' },\n\n  // ── BONE WASTES ──\n  { id: 'sm_bone_throne', type: 'world', sourceId: 'broken_throne', biome: 'bone', state: 'any',\n    text: 'The Emperor\\'s throne, split in two. On one half, the word \"JUSTICE.\" On the other, \"MERCY.\" Someone wanted to remind him he could not have both.', codexCategory: 'history' },\n  { id: 'sm_bone_library', type: 'world', sourceId: 'ruined_library', biome: 'bone', state: 'any',\n    text: 'Pages scattered like autumn leaves. An entire civilization\\'s knowledge, reduced to mulch. One page is still legible: a recipe for bread.', codexCategory: 'history' },\n  { id: 'sm_bone_wall', type: 'world', sourceId: 'crumbled_wall', biome: 'bone', state: 'any',\n    text: 'The third wall. The last defense. You can still see where the soldiers stood by the wear in the stone. They held this wall for eleven days.', codexCategory: 'factions' },\n\n  // ── VOID ──\n  { id: 'sm_void_mirror', type: 'world', sourceId: 'void_mirror', biome: 'void', state: 'any',\n    text: 'Your reflection looks back at you, but it is smiling when you are not. It mouths words you cannot hear. It looks relieved.', codexCategory: 'shadow_world' },\n  { id: 'sm_void_anchor', type: 'world', sourceId: 'reality_anchor', biome: 'void', state: 'any',\n    text: 'This anchor holds the boundary between worlds in place. It is cracked. The crack is growing. Someone has written \"SOON\" on the stone.', codexCategory: 'shadow_world' },\n\n  // ── EDILAS (endgame) ──\n  { id: 'sm_edilas_heart', type: 'world', sourceId: 'world_heart', biome: 'edilas', state: 'any',\n    text: 'The heart of Edilas. It beats once per century. You can feel it in your teeth. It is not beating for you. It is beating despite you.', codexCategory: 'titans' },\n  { id: 'sm_edilas_inscription', type: 'world', sourceId: 'ancient_inscription', biome: 'edilas', state: 'any',\n    text: '\"That which endures.\" The words are carved in a language older than the stone itself. Below them, in fresh ink: \"Still?\"', codexCategory: 'history' },\n];\n\n// ---------------------------------------------------------------------------\n// Lookup helpers\n// ---------------------------------------------------------------------------\n\n/** Memory lookup by ID */\nexport const MEMORY_DB = new Map<string, ScarMemory>();\nfor (const m of SCAR_MEMORIES) MEMORY_DB.set(m.id, m);\n\n/** Get memories for a specific enemy type */\nexport function getEnemyMemories(enemyId: string, state?: 'alive' | 'dead'): ScarMemory[] {\n  return SCAR_MEMORIES.filter(\n    m => (m.type === 'enemy' || m.type === 'boss') &&\n         m.sourceId === enemyId &&\n         (state === undefined || m.state === state || m.state === 'any'),\n  );\n}\n\n/** Get world memories for a biome */\nexport function getWorldMemories(biome: string): ScarMemory[] {\n  return SCAR_MEMORIES.filter(m => m.type === 'world' && m.biome === biome);\n}\n\n/** Get all memories for a biome */\nexport function getBiomeMemories(biome: string): ScarMemory[] {\n  return SCAR_MEMORIES.filter(m => m.biome === biome);\n}\n","/**\n * EDILAS — Scar Reading Manager (Hollow Knight Dream Nail-inspired)\n * Tracks which environmental memories the player has read and provides\n * queries for the codex integration. Reading a memory near an enemy corpse\n * or world object reveals lore delivered in-the-moment, not through menus.\n */\n\nimport { SCAR_MEMORIES, MEMORY_DB, getEnemyMemories } from '../data/scarMemories';\nimport type { ScarMemory } from '../data/scarMemories';\n\n// ---------------------------------------------------------------------------\n// Save Data\n// ---------------------------------------------------------------------------\n\ninterface ScarReadingSaveData {\n  readMemories: string[];  // IDs of memories that have been read\n}\n\n// ---------------------------------------------------------------------------\n// Manager\n// ---------------------------------------------------------------------------\n\nexport class ScarReadingManager {\n  /** Set of memory IDs the player has already read */\n  private readMemories: Set<string> = new Set();\n\n  /** Callback fired when a new memory is read */\n  private onReadCallbacks: Array<(memory: ScarMemory) => void> = [];\n\n  // ── Public API ──\n\n  /** Register a callback fired when a new memory is read */\n  onRead(cb: (memory: ScarMemory) => void): void {\n    this.onReadCallbacks.push(cb);\n  }\n\n  /**\n   * Attempt to read a memory from a fallen enemy.\n   * Returns the memory text if new, null if already read or no memory exists.\n   */\n  readEnemyMemory(enemyId: string, state: 'alive' | 'dead'): ScarMemory | null {\n    const memories = getEnemyMemories(enemyId, state);\n    if (memories.length === 0) return null;\n\n    // Pick first unread memory; if all read, return null\n    for (const memory of memories) {\n      if (!this.readMemories.has(memory.id)) {\n        this.readMemories.add(memory.id);\n        for (const cb of this.onReadCallbacks) cb(memory);\n        return memory;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Attempt to read a world memory at a location.\n   * @param sourceId The world object identifier (e.g. 'old_shrine', 'ruined_forge')\n   * @param biome Current biome\n   */\n  readWorldMemory(sourceId: string, biome: string): ScarMemory | null {\n    const memory = SCAR_MEMORIES.find(\n      m => m.type === 'world' && m.sourceId === sourceId && m.biome === biome,\n    );\n    if (!memory) return null;\n    if (this.readMemories.has(memory.id)) return null;\n\n    this.readMemories.add(memory.id);\n    for (const cb of this.onReadCallbacks) cb(memory);\n    return memory;\n  }\n\n  /** Check if a specific memory has been read */\n  isRead(memoryId: string): boolean {\n    return this.readMemories.has(memoryId);\n  }\n\n  /** Get all read memories */\n  getAllRead(): ScarMemory[] {\n    const result: ScarMemory[] = [];\n    for (const id of this.readMemories) {\n      const m = MEMORY_DB.get(id);\n      if (m) result.push(m);\n    }\n    return result;\n  }\n\n  /** Get progress: read / total */\n  getProgress(): { read: number; total: number } {\n    return { read: this.readMemories.size, total: SCAR_MEMORIES.length };\n  }\n\n  /** Get progress per biome */\n  getBiomeProgress(biome: string): { read: number; total: number } {\n    const biomeMemories = SCAR_MEMORIES.filter(m => m.biome === biome);\n    const read = biomeMemories.filter(m => this.readMemories.has(m.id)).length;\n    return { read, total: biomeMemories.length };\n  }\n\n  /** Check if all memories in the \"What Was Lost\" hidden chapter are unlocked */\n  isHiddenChapterComplete(): boolean {\n    return this.readMemories.size >= SCAR_MEMORIES.length;\n  }\n\n  // ── Persistence ──\n\n  serialize(): ScarReadingSaveData {\n    return { readMemories: Array.from(this.readMemories) };\n  }\n\n  deserialize(data: ScarReadingSaveData): void {\n    this.readMemories.clear();\n    if (data.readMemories) {\n      for (const id of data.readMemories) {\n        this.readMemories.add(id);\n      }\n    }\n  }\n}\n","/**\n * EDILAS — Chosen's Pact (Hades Pact of Punishment-inspired)\n * Player-authored difficulty scaling: toggle conditions for extra \"Burden\"\n * points, which unlock exclusive rewards at thresholds.\n *\n * Conditions are flags consumed by existing systems (CombatSystem,\n * CorruptionManager, LightingManager, etc.) — no architectural changes.\n */\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport enum PactCondition {\n  NoSecondChance = 'no_second_chance',     // Death Defiance disabled\n  StarvingWorld = 'starving_world',         // Food buff duration halved\n  AncientHostility = 'ancient_hostility',   // All enemies get a random elite affix\n  SeveredLight = 'severed_light',           // Torch/lantern radius -40%\n  BlindExpedition = 'blind_expedition',     // No minimap\n  SpreadingDarkness = 'spreading_darkness', // Corruption spreads at 3x\n  CursedGround = 'cursed_ground',          // Entire expedition = corruption curse\n  FragileResolve = 'fragile_resolve',       // Start with half resolve\n  IronPrices = 'iron_prices',              // Shop prices doubled\n  RelentlessFoes = 'relentless_foes',      // Enemy attack speed +30%\n}\n\nexport interface PactConditionDef {\n  id: PactCondition;\n  name: string;\n  description: string;\n  burdenCost: number;     // How many burden points this condition adds\n  maxStacks: number;      // Some conditions can be applied multiple times (1 = toggle)\n}\n\n/** Reward tier unlocked at a burden threshold */\nexport interface PactRewardTier {\n  burdenRequired: number;\n  name: string;\n  description: string;\n  lootRarityBonus: number;   // Added to rarity luck rolls\n  exclusiveMaterial: string; // Special drop only available at this tier\n}\n\n// ---------------------------------------------------------------------------\n// Data\n// ---------------------------------------------------------------------------\n\nexport const PACT_CONDITIONS: PactConditionDef[] = [\n  {\n    id: PactCondition.NoSecondChance,\n    name: 'No Second Chance',\n    description: 'Death Defiance is disabled for this expedition.',\n    burdenCost: 3,\n    maxStacks: 1,\n  },\n  {\n    id: PactCondition.StarvingWorld,\n    name: 'Starving World',\n    description: 'Food buff duration is halved.',\n    burdenCost: 2,\n    maxStacks: 1,\n  },\n  {\n    id: PactCondition.AncientHostility,\n    name: 'Ancient Hostility',\n    description: 'All enemies gain a random elite affix.',\n    burdenCost: 2,\n    maxStacks: 1,\n  },\n  {\n    id: PactCondition.SeveredLight,\n    name: 'Severed Light',\n    description: 'Torch and lantern reveal radius reduced by 40%.',\n    burdenCost: 1,\n    maxStacks: 1,\n  },\n  {\n    id: PactCondition.BlindExpedition,\n    name: 'Blind Expedition',\n    description: 'The minimap is hidden.',\n    burdenCost: 2,\n    maxStacks: 1,\n  },\n  {\n    id: PactCondition.SpreadingDarkness,\n    name: 'Spreading Darkness',\n    description: 'Corruption spreads at 3x the normal rate.',\n    burdenCost: 2,\n    maxStacks: 1,\n  },\n  {\n    id: PactCondition.CursedGround,\n    name: 'Cursed Ground',\n    description: 'The entire expedition area is treated as a corruption curse zone.',\n    burdenCost: 3,\n    maxStacks: 1,\n  },\n  {\n    id: PactCondition.FragileResolve,\n    name: 'Fragile Resolve',\n    description: 'Resolve starts at 50% instead of 100%.',\n    burdenCost: 1,\n    maxStacks: 1,\n  },\n  {\n    id: PactCondition.IronPrices,\n    name: 'Iron Prices',\n    description: 'Shop prices are doubled.',\n    burdenCost: 1,\n    maxStacks: 1,\n  },\n  {\n    id: PactCondition.RelentlessFoes,\n    name: 'Relentless Foes',\n    description: 'Enemy attack speed is increased by 30%.',\n    burdenCost: 2,\n    maxStacks: 1,\n  },\n];\n\nexport const PACT_CONDITION_DB = new Map<PactCondition, PactConditionDef>();\nfor (const c of PACT_CONDITIONS) PACT_CONDITION_DB.set(c.id, c);\n\nexport const PACT_REWARD_TIERS: PactRewardTier[] = [\n  { burdenRequired: 4,  name: 'Ember Vow',     description: 'Ember materials drop.',     lootRarityBonus: 1, exclusiveMaterial: 'pact_ember' },\n  { burdenRequired: 8,  name: 'Ash Covenant',   description: 'Ash materials drop.',       lootRarityBonus: 2, exclusiveMaterial: 'pact_ash' },\n  { burdenRequired: 12, name: 'Shadow Pledge',  description: 'Shadow materials drop.',    lootRarityBonus: 3, exclusiveMaterial: 'pact_shadow' },\n  { burdenRequired: 16, name: 'Void Offering',  description: 'Void materials drop.',      lootRarityBonus: 4, exclusiveMaterial: 'pact_void' },\n  { burdenRequired: 20, name: 'Edilas Endures',  description: 'Legendary materials drop.', lootRarityBonus: 5, exclusiveMaterial: 'pact_edilas' },\n];\n\n// ---------------------------------------------------------------------------\n// Manager\n// ---------------------------------------------------------------------------\n\nexport class PactManager {\n  /** Currently active pact conditions (condition → stack count) */\n  private activeConditions: Map<PactCondition, number> = new Map();\n\n  /** Whether the pact was configured this expedition (reset on expedition end) */\n  private pactActive = false;\n\n  /** Highest burden the player has completed per biome (tracks progression) */\n  private highestBurdenPerBiome: Map<string, number> = new Map();\n\n  // ── Configuration ──\n\n  /** Toggle a condition on or off. Returns new state. */\n  toggle(condition: PactCondition): boolean {\n    const def = PACT_CONDITION_DB.get(condition);\n    if (!def) return false;\n\n    const current = this.activeConditions.get(condition) ?? 0;\n    if (current > 0) {\n      this.activeConditions.delete(condition);\n      return false;\n    } else {\n      this.activeConditions.set(condition, 1);\n      return true;\n    }\n  }\n\n  /** Set a specific stack count for a condition */\n  setStacks(condition: PactCondition, stacks: number): void {\n    const def = PACT_CONDITION_DB.get(condition);\n    if (!def) return;\n    const clamped = Math.min(Math.max(0, stacks), def.maxStacks);\n    if (clamped === 0) {\n      this.activeConditions.delete(condition);\n    } else {\n      this.activeConditions.set(condition, clamped);\n    }\n  }\n\n  /** Clear all conditions */\n  clearAll(): void {\n    this.activeConditions.clear();\n    this.pactActive = false;\n  }\n\n  /** Lock in the pact for the current expedition */\n  activate(): void {\n    this.pactActive = this.getTotalBurden() > 0;\n  }\n\n  // ── Queries ──\n\n  /** Check if a condition is active */\n  isActive(condition: PactCondition): boolean {\n    return (this.activeConditions.get(condition) ?? 0) > 0;\n  }\n\n  /** Get current stack count for a condition */\n  getStacks(condition: PactCondition): number {\n    return this.activeConditions.get(condition) ?? 0;\n  }\n\n  /** Calculate total burden from all active conditions */\n  getTotalBurden(): number {\n    let total = 0;\n    for (const [cond, stacks] of this.activeConditions) {\n      const def = PACT_CONDITION_DB.get(cond);\n      if (def) total += def.burdenCost * stacks;\n    }\n    return total;\n  }\n\n  /** Get all active conditions */\n  getActiveConditions(): PactCondition[] {\n    return Array.from(this.activeConditions.keys());\n  }\n\n  /** Whether the pact is currently active (expedition started with burden) */\n  isPactActive(): boolean {\n    return this.pactActive;\n  }\n\n  /** Get the current reward tier based on burden */\n  getCurrentRewardTier(): PactRewardTier | null {\n    const burden = this.getTotalBurden();\n    let best: PactRewardTier | null = null;\n    for (const tier of PACT_REWARD_TIERS) {\n      if (burden >= tier.burdenRequired) {\n        best = tier;\n      }\n    }\n    return best;\n  }\n\n  /** Get all unlocked reward tiers */\n  getUnlockedTiers(): PactRewardTier[] {\n    const burden = this.getTotalBurden();\n    return PACT_REWARD_TIERS.filter(t => burden >= t.burdenRequired);\n  }\n\n  /** Get total loot rarity bonus from pact */\n  getLootRarityBonus(): number {\n    const tier = this.getCurrentRewardTier();\n    return tier ? tier.lootRarityBonus : 0;\n  }\n\n  /** Get exclusive material for current tier (null if no tier unlocked) */\n  getExclusiveMaterial(): string | null {\n    const tier = this.getCurrentRewardTier();\n    return tier ? tier.exclusiveMaterial : null;\n  }\n\n  // ── Gameplay Modifiers (consumed by other systems) ──\n\n  /** Food buff duration multiplier */\n  getFoodDurationMult(): number {\n    return this.isActive(PactCondition.StarvingWorld) ? 0.5 : 1.0;\n  }\n\n  /** Corruption spread rate multiplier */\n  getCorruptionSpreadMult(): number {\n    return this.isActive(PactCondition.SpreadingDarkness) ? 3.0 : 1.0;\n  }\n\n  /** Light reveal radius multiplier */\n  getLightRevealMult(): number {\n    return this.isActive(PactCondition.SeveredLight) ? 0.6 : 1.0;\n  }\n\n  /** Enemy attack speed multiplier */\n  getEnemyAttackSpeedMult(): number {\n    return this.isActive(PactCondition.RelentlessFoes) ? 1.3 : 1.0;\n  }\n\n  /** Shop price multiplier */\n  getShopPriceMult(): number {\n    return this.isActive(PactCondition.IronPrices) ? 2.0 : 1.0;\n  }\n\n  // ── Progression ──\n\n  /** Record a completed expedition with current burden for a biome */\n  recordExpeditionComplete(biome: string): void {\n    const burden = this.getTotalBurden();\n    const prev = this.highestBurdenPerBiome.get(biome) ?? 0;\n    if (burden > prev) {\n      this.highestBurdenPerBiome.set(biome, burden);\n    }\n  }\n\n  /** Get highest burden completed for a biome */\n  getHighestBurden(biome: string): number {\n    return this.highestBurdenPerBiome.get(biome) ?? 0;\n  }\n\n  // ── Persistence ──\n\n  serialize(): { highestBurden: Record<string, number> } {\n    const highestBurden: Record<string, number> = {};\n    for (const [biome, val] of this.highestBurdenPerBiome) {\n      highestBurden[biome] = val;\n    }\n    return { highestBurden };\n  }\n\n  deserialize(data: { highestBurden?: Record<string, number> }): void {\n    this.highestBurdenPerBiome.clear();\n    this.activeConditions.clear();\n    this.pactActive = false;\n    if (data.highestBurden) {\n      for (const [biome, val] of Object.entries(data.highestBurden)) {\n        this.highestBurdenPerBiome.set(biome, val);\n      }\n    }\n  }\n}\n","/**\n * EDILAS — Resolve Manager (Don't Starve Sanity-inspired)\n * Tracks the player's mental fortitude as a 0-100 bar. Resolve drains in\n * hostile conditions (corruption, darkness, Shadow World, bad food, combat losses)\n * and recovers through rest, good food, and NPC interaction.\n *\n * At low resolve, visual/audio distortions occur and shadow phantoms spawn.\n * At resolve 0, a trauma event triggers (Darkest Dungeon-inspired affliction/virtue).\n */\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport interface ResolveEffect {\n  /** Visual grain/distortion intensity (0 = none, 1 = max) */\n  grainIntensity: number;\n  /** Whether shadow phantoms should spawn nearby */\n  spawnPhantoms: boolean;\n  /** Combat stat penalty multiplier (1.0 = no penalty, 0.7 = -30%) */\n  combatMult: number;\n  /** Whether the player is in the critical \"shattered\" state */\n  shattered: boolean;\n}\n\nexport type TraumaType = 'affliction' | 'virtue';\n\nexport interface TraumaState {\n  type: TraumaType;\n  name: string;\n  description: string;\n  /** Duration remaining in seconds */\n  remaining: number;\n  /** Total duration for progress bar */\n  duration: number;\n  /** Stat modifiers while active */\n  damageMult: number;\n  defenseAdd: number;\n  /** Whether death defiance is disabled */\n  disableDeathDefiance: boolean;\n  /** Whether player can use consumables */\n  disableConsumables: boolean;\n  /** Whether the player auto-attacks when enemies are near */\n  autoAttack: boolean;\n  /** Resolve restore per kill (0 = none) */\n  resolvePerKill: number;\n}\n\n// ---------------------------------------------------------------------------\n// Affliction / Virtue Tables\n// ---------------------------------------------------------------------------\n\nconst AFFLICTIONS: Omit<TraumaState, 'remaining' | 'duration'>[] = [\n  {\n    type: 'affliction', name: 'Reckless',\n    description: 'Overwhelmed by fear, you strike wildly at anything that moves.',\n    damageMult: 1.25, defenseAdd: 0, disableDeathDefiance: false,\n    disableConsumables: false, autoAttack: true, resolvePerKill: 0,\n  },\n  {\n    type: 'affliction', name: 'Paranoid',\n    description: 'Trust is gone. You cannot interact with anyone or anything.',\n    damageMult: 1.0, defenseAdd: 0, disableDeathDefiance: false,\n    disableConsumables: true, autoAttack: false, resolvePerKill: 0,\n  },\n  {\n    type: 'affliction', name: 'Despairing',\n    description: 'Hope has left you. There will be no second chances.',\n    damageMult: 0.8, defenseAdd: 0, disableDeathDefiance: true,\n    disableConsumables: false, autoAttack: false, resolvePerKill: 0,\n  },\n  {\n    type: 'affliction', name: 'Feral',\n    description: 'Instinct takes over. You fight harder but forget how to use tools.',\n    damageMult: 1.4, defenseAdd: -5, disableDeathDefiance: false,\n    disableConsumables: true, autoAttack: false, resolvePerKill: 0,\n  },\n];\n\nconst VIRTUES: Omit<TraumaState, 'remaining' | 'duration'>[] = [\n  {\n    type: 'virtue', name: 'Defiant',\n    description: 'Against all odds, your will hardens. Death shall not have you today.',\n    damageMult: 1.15, defenseAdd: 5, disableDeathDefiance: false,\n    disableConsumables: false, autoAttack: false, resolvePerKill: 2,\n  },\n  {\n    type: 'virtue', name: 'Focused',\n    description: 'Clarity cuts through the madness. Every strike lands true.',\n    damageMult: 1.3, defenseAdd: 0, disableDeathDefiance: false,\n    disableConsumables: false, autoAttack: false, resolvePerKill: 1,\n  },\n  {\n    type: 'virtue', name: 'Survivor',\n    description: 'Each enemy felled restores a fragment of your shattered mind.',\n    damageMult: 1.1, defenseAdd: 3, disableDeathDefiance: false,\n    disableConsumables: false, autoAttack: false, resolvePerKill: 5,\n  },\n];\n\n// ---------------------------------------------------------------------------\n// Constants\n// ---------------------------------------------------------------------------\n\nconst MAX_RESOLVE = 100;\nconst TRAUMA_DURATION = 90; // seconds (≈3 in-game hours at default time scale)\n\n/** Resolve drain/recovery rates (per second) */\nconst RATES = {\n  corruptionDrain: 1.5,     // Per second while standing on corrupted tiles\n  darknessDrain: 0.8,       // Per second in darkness (LightingManager.isNight or dungeon)\n  shadowWorldDrain: 2.0,    // Per second while in Shadow World\n  combatLossDrain: 5,       // Per hit taken\n  campfireRecovery: 8,      // Per second at a campfire\n  foodRecovery: 3,          // Per second after eating good food (for 10s)\n  cityRecovery: 2,          // Per second while in Haven/city\n  npcRecovery: 10,          // Flat amount per NPC interaction\n};\n\n// ---------------------------------------------------------------------------\n// Manager\n// ---------------------------------------------------------------------------\n\nexport class ResolveManager {\n  private resolve = MAX_RESOLVE;\n  private trauma: TraumaState | null = null;\n\n  /** Temporary food-based recovery buff (seconds remaining) */\n  private foodRecoveryTimer = 0;\n\n  /** Callbacks */\n  private onTraumaCbs: Array<(trauma: TraumaState) => void> = [];\n  private onShatteredCbs: Array<() => void> = [];\n\n  // ── Callbacks ──\n\n  onTrauma(cb: (trauma: TraumaState) => void): void {\n    this.onTraumaCbs.push(cb);\n  }\n\n  onShattered(cb: () => void): void {\n    this.onShatteredCbs.push(cb);\n  }\n\n  // ── Core Update ──\n\n  /**\n   * Main update tick. Called each frame.\n   * @param deltaSec Delta time in seconds\n   * @param inCorruption Whether standing on a corrupted tile\n   * @param inDarkness Whether in darkness (night or dungeon without light)\n   * @param inShadowWorld Whether the Shadow World is active\n   * @param inCity Whether in Haven/city hub\n   * @param atCampfire Whether resting at a campfire\n   */\n  update(\n    deltaSec: number,\n    inCorruption: boolean,\n    inDarkness: boolean,\n    inShadowWorld: boolean,\n    inCity: boolean,\n    atCampfire: boolean,\n  ): void {\n    // Tick trauma duration\n    if (this.trauma) {\n      this.trauma.remaining -= deltaSec;\n      if (this.trauma.remaining <= 0) {\n        this.trauma = null;\n      }\n    }\n\n    // Tick food recovery buff\n    if (this.foodRecoveryTimer > 0) {\n      this.foodRecoveryTimer -= deltaSec;\n      this.addResolve(RATES.foodRecovery * deltaSec);\n    }\n\n    // --- Drain sources ---\n    if (inCorruption) this.drain(RATES.corruptionDrain * deltaSec);\n    if (inDarkness) this.drain(RATES.darknessDrain * deltaSec);\n    if (inShadowWorld) this.drain(RATES.shadowWorldDrain * deltaSec);\n\n    // --- Recovery sources ---\n    if (atCampfire) this.addResolve(RATES.campfireRecovery * deltaSec);\n    if (inCity) this.addResolve(RATES.cityRecovery * deltaSec);\n  }\n\n  // ── Drain / Recovery ──\n\n  private drain(amount: number): void {\n    const prev = this.resolve;\n    this.resolve = Math.max(0, this.resolve - amount);\n\n    // Trigger shattered state at resolve 0\n    if (prev > 0 && this.resolve <= 0 && !this.trauma) {\n      this.triggerTrauma();\n    }\n  }\n\n  private addResolve(amount: number): void {\n    this.resolve = Math.min(MAX_RESOLVE, this.resolve + amount);\n  }\n\n  /** Called when the player takes damage */\n  onPlayerHit(): void {\n    this.drain(RATES.combatLossDrain);\n  }\n\n  /** Called when the player eats good food */\n  onGoodFood(): void {\n    this.foodRecoveryTimer = 10; // 10 seconds of recovery\n  }\n\n  /** Called when the player interacts with a friendly NPC */\n  onNPCInteraction(): void {\n    this.addResolve(RATES.npcRecovery);\n  }\n\n  /** Called when the player kills an enemy (for virtue resolve-per-kill) */\n  onEnemyKill(): void {\n    if (this.trauma && this.trauma.resolvePerKill > 0) {\n      this.addResolve(this.trauma.resolvePerKill);\n    }\n  }\n\n  /** Directly set resolve (e.g., Pact condition starts at 50) */\n  setResolve(value: number): void {\n    this.resolve = Math.max(0, Math.min(MAX_RESOLVE, value));\n  }\n\n  // ── Trauma ──\n\n  private triggerTrauma(): void {\n    // 30% chance of Virtue, 70% Affliction\n    const isVirtue = Math.random() < 0.3;\n    const pool = isVirtue ? VIRTUES : AFFLICTIONS;\n    const selected = pool[Math.floor(Math.random() * pool.length)];\n\n    this.trauma = {\n      ...selected,\n      remaining: TRAUMA_DURATION,\n      duration: TRAUMA_DURATION,\n    };\n\n    // Restore a small amount of resolve so we don't immediately re-trigger\n    this.resolve = 15;\n\n    for (const cb of this.onTraumaCbs) cb(this.trauma);\n    for (const cb of this.onShatteredCbs) cb();\n  }\n\n  // ── Queries ──\n\n  getResolve(): number {\n    return this.resolve;\n  }\n\n  getMaxResolve(): number {\n    return MAX_RESOLVE;\n  }\n\n  getResolvePct(): number {\n    return this.resolve / MAX_RESOLVE;\n  }\n\n  getTrauma(): TraumaState | null {\n    return this.trauma;\n  }\n\n  /** Get the current visual/gameplay effects based on resolve level */\n  getEffects(): ResolveEffect {\n    const pct = this.resolve / MAX_RESOLVE;\n\n    if (this.trauma?.type === 'affliction') {\n      return {\n        grainIntensity: 0.6,\n        spawnPhantoms: true,\n        combatMult: this.trauma.damageMult,\n        shattered: true,\n      };\n    }\n\n    if (this.trauma?.type === 'virtue') {\n      return {\n        grainIntensity: 0,\n        spawnPhantoms: false,\n        combatMult: this.trauma.damageMult,\n        shattered: false,\n      };\n    }\n\n    if (pct <= 0.1) {\n      return { grainIntensity: 0.5, spawnPhantoms: true, combatMult: 0.7, shattered: false };\n    }\n    if (pct <= 0.3) {\n      return { grainIntensity: 0.3, spawnPhantoms: true, combatMult: 0.85, shattered: false };\n    }\n    if (pct <= 0.6) {\n      return { grainIntensity: 0.1, spawnPhantoms: false, combatMult: 0.95, shattered: false };\n    }\n    return { grainIntensity: 0, spawnPhantoms: false, combatMult: 1.0, shattered: false };\n  }\n\n  // ── Persistence ──\n\n  serialize(): { resolve: number; trauma: TraumaState | null } {\n    return { resolve: this.resolve, trauma: this.trauma };\n  }\n\n  deserialize(data: { resolve?: number; trauma?: TraumaState | null }): void {\n    this.resolve = data.resolve ?? MAX_RESOLVE;\n    this.trauma = data.trauma ?? null;\n  }\n}\n","/**\n * EDILAS — Bounty Contract Manager (Dead Cells Cursed Sword-inspired)\n * Opt-in risk/reward challenges the player can accept mid-expedition.\n * Success = 3x gold + guaranteed rare item + rift crystals.\n * Failure = lose a random inventory item.\n *\n * Contracts are session-scoped: they activate when accepted and resolve\n * within the same expedition. Multiple contracts cannot stack.\n */\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport type ContractCondition =\n  | 'kill_no_damage'    // Kill X enemies without taking damage\n  | 'survive_timer'     // Survive for X seconds\n  | 'no_items'          // Kill X enemies without using consumables\n  | 'kill_streak'       // Kill X enemies within Y seconds\n  | 'low_hp'            // Kill X enemies while below 30% HP\n  | 'no_dodge'          // Kill X enemies without dodging\n  | 'corruption_walk'   // Survive X seconds on corrupted tiles\n  | 'parry_master';     // Parry X enemy attacks\n\nexport interface ContractDef {\n  id: string;\n  name: string;\n  description: string;\n  condition: ContractCondition;\n  /** Target count to complete the contract */\n  targetCount: number;\n  /** Time limit in seconds (0 = no time limit) */\n  timeLimit: number;\n  /** Difficulty tier (1-3) — affects rewards */\n  tier: number;\n  /** Gold multiplier on success */\n  goldMult: number;\n}\n\nexport interface ActiveContract {\n  def: ContractDef;\n  progress: number;\n  timeElapsed: number;\n  /** Whether the player has failed the contract condition */\n  failed: boolean;\n  /** Whether the contract has been completed */\n  completed: boolean;\n  /** Streak sub-timer for kill_streak condition */\n  streakTimer: number;\n  /** Items used counter for no_items condition */\n  itemsUsed: number;\n  /** Dodges used counter for no_dodge condition */\n  dodgesUsed: number;\n}\n\n// ---------------------------------------------------------------------------\n// Contract Definitions\n// ---------------------------------------------------------------------------\n\nexport const CONTRACT_DEFS: ContractDef[] = [\n  {\n    id: 'flawless_hunter',\n    name: 'Flawless Hunter',\n    description: 'Kill 10 enemies without taking any damage.',\n    condition: 'kill_no_damage',\n    targetCount: 10,\n    timeLimit: 0,\n    tier: 3,\n    goldMult: 3,\n  },\n  {\n    id: 'endurance_trial',\n    name: 'Endurance Trial',\n    description: 'Survive for 120 seconds in hostile territory.',\n    condition: 'survive_timer',\n    targetCount: 120,\n    timeLimit: 0,\n    tier: 1,\n    goldMult: 2,\n  },\n  {\n    id: 'purist_blade',\n    name: 'Purist\\'s Blade',\n    description: 'Kill 8 enemies without using any consumable items.',\n    condition: 'no_items',\n    targetCount: 8,\n    timeLimit: 0,\n    tier: 2,\n    goldMult: 2.5,\n  },\n  {\n    id: 'bloodrush',\n    name: 'Bloodrush',\n    description: 'Kill 5 enemies within 30 seconds.',\n    condition: 'kill_streak',\n    targetCount: 5,\n    timeLimit: 30,\n    tier: 2,\n    goldMult: 2.5,\n  },\n  {\n    id: 'deaths_edge',\n    name: 'Death\\'s Edge',\n    description: 'Kill 6 enemies while below 30% HP.',\n    condition: 'low_hp',\n    targetCount: 6,\n    timeLimit: 0,\n    tier: 3,\n    goldMult: 3,\n  },\n  {\n    id: 'iron_stance',\n    name: 'Iron Stance',\n    description: 'Kill 8 enemies without using dodge/roll.',\n    condition: 'no_dodge',\n    targetCount: 8,\n    timeLimit: 0,\n    tier: 2,\n    goldMult: 2.5,\n  },\n  {\n    id: 'void_walker',\n    name: 'Void Walker',\n    description: 'Survive 60 seconds standing on corrupted tiles.',\n    condition: 'corruption_walk',\n    targetCount: 60,\n    timeLimit: 0,\n    tier: 2,\n    goldMult: 2.5,\n  },\n  {\n    id: 'blade_dancer',\n    name: 'Blade Dancer',\n    description: 'Parry 5 enemy attacks.',\n    condition: 'parry_master',\n    targetCount: 5,\n    timeLimit: 0,\n    tier: 3,\n    goldMult: 3,\n  },\n];\n\nexport const CONTRACT_DB = new Map<string, ContractDef>();\nfor (const c of CONTRACT_DEFS) CONTRACT_DB.set(c.id, c);\n\n// ---------------------------------------------------------------------------\n// Manager\n// ---------------------------------------------------------------------------\n\nexport class BountyContractManager {\n  private active: ActiveContract | null = null;\n  private contractsCompleted = 0;\n  private contractsFailed = 0;\n  /** Consecutive contracts completed (for achievement tracking) */\n  private streak = 0;\n\n  /** Callbacks */\n  private onCompleteCbs: Array<(contract: ContractDef) => void> = [];\n  private onFailCbs: Array<(contract: ContractDef) => void> = [];\n\n  // ── Callbacks ──\n\n  onComplete(cb: (contract: ContractDef) => void): void {\n    this.onCompleteCbs.push(cb);\n  }\n\n  onFail(cb: (contract: ContractDef) => void): void {\n    this.onFailCbs.push(cb);\n  }\n\n  // ── Contract Lifecycle ──\n\n  /** Get a random contract the player can accept */\n  getAvailableContracts(count: number = 3): ContractDef[] {\n    const shuffled = [...CONTRACT_DEFS].sort(() => Math.random() - 0.5);\n    return shuffled.slice(0, Math.min(count, shuffled.length));\n  }\n\n  /** Accept a contract (only one active at a time) */\n  accept(contractId: string): boolean {\n    if (this.active) return false;\n    const def = CONTRACT_DB.get(contractId);\n    if (!def) return false;\n\n    this.active = {\n      def,\n      progress: 0,\n      timeElapsed: 0,\n      failed: false,\n      completed: false,\n      streakTimer: 0,\n      itemsUsed: 0,\n      dodgesUsed: 0,\n    };\n    return true;\n  }\n\n  /** Abandon the current contract (counts as failure) */\n  abandon(): void {\n    if (!this.active) return;\n    this.failContract();\n  }\n\n  /** Check if there's an active contract */\n  hasActive(): boolean {\n    return this.active !== null && !this.active.failed && !this.active.completed;\n  }\n\n  /** Get the active contract (for HUD display) */\n  getActive(): ActiveContract | null {\n    return this.active;\n  }\n\n  // ── Event Hooks (called by OverworldScene) ──\n\n  /** Called each frame */\n  update(deltaSec: number, onCorruption: boolean): void {\n    if (!this.active || this.active.failed || this.active.completed) return;\n\n    this.active.timeElapsed += deltaSec;\n\n    // Timer-based conditions\n    if (this.active.def.condition === 'survive_timer') {\n      this.active.progress = this.active.timeElapsed;\n      if (this.active.progress >= this.active.def.targetCount) {\n        this.completeContract();\n        return;\n      }\n    }\n\n    if (this.active.def.condition === 'corruption_walk' && onCorruption) {\n      this.active.progress += deltaSec;\n      if (this.active.progress >= this.active.def.targetCount) {\n        this.completeContract();\n        return;\n      }\n    }\n\n    // Kill streak timer decay\n    if (this.active.def.condition === 'kill_streak') {\n      if (this.active.streakTimer > 0) {\n        this.active.streakTimer -= deltaSec;\n        if (this.active.streakTimer <= 0 && this.active.progress > 0) {\n          // Streak expired — reset progress\n          this.active.progress = 0;\n          this.active.streakTimer = 0;\n        }\n      }\n    }\n\n    // Time limit check\n    if (this.active.def.timeLimit > 0 && this.active.timeElapsed >= this.active.def.timeLimit) {\n      if (this.active.progress < this.active.def.targetCount) {\n        this.failContract();\n      }\n    }\n  }\n\n  /** Called when player kills an enemy */\n  onEnemyKill(playerHpPct: number): void {\n    if (!this.active || this.active.failed || this.active.completed) return;\n\n    const cond = this.active.def.condition;\n\n    if (cond === 'kill_no_damage' || cond === 'no_items' || cond === 'no_dodge') {\n      this.active.progress++;\n    }\n\n    if (cond === 'kill_streak') {\n      this.active.progress++;\n      this.active.streakTimer = this.active.def.timeLimit;\n    }\n\n    if (cond === 'low_hp' && playerHpPct <= 0.3) {\n      this.active.progress++;\n    }\n\n    // Check completion\n    if (this.active.progress >= this.active.def.targetCount) {\n      this.completeContract();\n    }\n  }\n\n  /** Called when player takes damage */\n  onPlayerHit(): void {\n    if (!this.active || this.active.failed || this.active.completed) return;\n\n    if (this.active.def.condition === 'kill_no_damage') {\n      this.failContract();\n    }\n  }\n\n  /** Called when player uses a consumable item */\n  onItemUsed(): void {\n    if (!this.active || this.active.failed || this.active.completed) return;\n\n    if (this.active.def.condition === 'no_items') {\n      this.active.itemsUsed++;\n      this.failContract();\n    }\n  }\n\n  /** Called when player dodges */\n  onDodge(): void {\n    if (!this.active || this.active.failed || this.active.completed) return;\n\n    if (this.active.def.condition === 'no_dodge') {\n      this.active.dodgesUsed++;\n      this.failContract();\n    }\n  }\n\n  /** Called when player parries an enemy attack */\n  onParry(): void {\n    if (!this.active || this.active.failed || this.active.completed) return;\n\n    if (this.active.def.condition === 'parry_master') {\n      this.active.progress++;\n      if (this.active.progress >= this.active.def.targetCount) {\n        this.completeContract();\n      }\n    }\n  }\n\n  // ── Resolution ──\n\n  private completeContract(): void {\n    if (!this.active) return;\n    this.active.completed = true;\n    this.contractsCompleted++;\n    this.streak++;\n    for (const cb of this.onCompleteCbs) cb(this.active.def);\n  }\n\n  private failContract(): void {\n    if (!this.active) return;\n    this.active.failed = true;\n    this.contractsFailed++;\n    this.streak = 0;\n    for (const cb of this.onFailCbs) cb(this.active.def);\n  }\n\n  /** Clear the active contract after rewards/penalties have been applied */\n  clearActive(): void {\n    this.active = null;\n  }\n\n  // ── Queries ──\n\n  getCompletedCount(): number {\n    return this.contractsCompleted;\n  }\n\n  getFailedCount(): number {\n    return this.contractsFailed;\n  }\n\n  getStreak(): number {\n    return this.streak;\n  }\n\n  /** Get progress as a 0-1 fraction for HUD display */\n  getProgressPct(): number {\n    if (!this.active) return 0;\n    return Math.min(1, this.active.progress / this.active.def.targetCount);\n  }\n\n  /** Get gold reward multiplier for the current contract */\n  getGoldMultiplier(): number {\n    if (!this.active || !this.active.completed) return 1;\n    return this.active.def.goldMult;\n  }\n\n  // ── Persistence ──\n\n  serialize(): { completed: number; failed: number; streak: number } {\n    return {\n      completed: this.contractsCompleted,\n      failed: this.contractsFailed,\n      streak: this.streak,\n    };\n  }\n\n  deserialize(data: { completed?: number; failed?: number; streak?: number }): void {\n    this.contractsCompleted = data.completed ?? 0;\n    this.contractsFailed = data.failed ?? 0;\n    this.streak = data.streak ?? 0;\n    this.active = null;\n  }\n}\n","/**\n * EDILAS — Enemy Weakness Discovery (Darkest Dungeon Bestiary-inspired)\n * Each enemy type has hidden weakness/resistance profiles that are progressively\n * revealed as the player fights more of that type. Discovered weaknesses provide\n * concrete combat bonuses (+30% damage with the right weapon type).\n *\n * Kill thresholds: 3 kills = reveal weakness, 7 kills = reveal resistance,\n * 15 kills = reveal exploit tip, 25 kills = unlock mastery bonus.\n */\n\nimport { WeaponType } from '../ecs/components';\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport interface WeaknessProfile {\n  /** Weapon type this enemy is weak to (+30% damage) */\n  weakTo: WeaponType;\n  /** Weapon type this enemy resists (-30% damage) */\n  resistTo: WeaponType;\n  /** Status effect this enemy is immune to */\n  statusImmunity: string;\n  /** Behavioral exploit tip shown at kill threshold */\n  exploitTip: string;\n  /** Mastery bonus description at max kills */\n  masteryBonus: string;\n  /** Mastery: extra damage multiplier (e.g., 1.1 = 10% bonus on all hits) */\n  masteryDamageMult: number;\n}\n\nexport interface DiscoveryState {\n  kills: number;\n  weaknessRevealed: boolean;   // 3 kills\n  resistanceRevealed: boolean; // 7 kills\n  exploitRevealed: boolean;    // 15 kills\n  masteryUnlocked: boolean;    // 25 kills\n}\n\n// ---------------------------------------------------------------------------\n// Kill Thresholds\n// ---------------------------------------------------------------------------\n\nconst THRESHOLD_WEAKNESS = 3;\nconst THRESHOLD_RESISTANCE = 7;\nconst THRESHOLD_EXPLOIT = 15;\nconst THRESHOLD_MASTERY = 25;\n\n// ---------------------------------------------------------------------------\n// Weakness Data (per enemy type)\n// ---------------------------------------------------------------------------\n\nconst WEAKNESS_PROFILES: Record<string, WeaknessProfile> = {\n  // Haven\n  forest_slime:     { weakTo: WeaponType.Hammer, resistTo: WeaponType.Sword, statusImmunity: 'bleed', exploitTip: 'Slimes split when hit — finish them quickly before they multiply.', masteryBonus: '+10% damage to all slimes', masteryDamageMult: 1.1 },\n  shambling_corpse: { weakTo: WeaponType.Axe, resistTo: WeaponType.Dagger, statusImmunity: 'poison', exploitTip: 'Corpses lunge in straight lines. Sidestep and counter.', masteryBonus: '+10% damage to undead', masteryDamageMult: 1.1 },\n  crawler:          { weakTo: WeaponType.Spear, resistTo: WeaponType.Hammer, statusImmunity: 'stun', exploitTip: 'Crawlers hesitate after a charge. Strike then.', masteryBonus: '+10% damage to insects', masteryDamageMult: 1.1 },\n  plague_rat:       { weakTo: WeaponType.Bow, resistTo: WeaponType.Staff, statusImmunity: 'poison', exploitTip: 'Rats panic when their pack leader falls. Kill the biggest first.', masteryBonus: '+10% damage to beasts', masteryDamageMult: 1.1 },\n  lost_soul:        { weakTo: WeaponType.Staff, resistTo: WeaponType.Spear, statusImmunity: 'bleed', exploitTip: 'Souls phase through attacks — time your hits when they solidify.', masteryBonus: '+10% damage to spectral enemies', masteryDamageMult: 1.1 },\n  wild_boar:        { weakTo: WeaponType.Spear, resistTo: WeaponType.Staff, statusImmunity: 'stun', exploitTip: 'Boars always charge forward. Step aside and strike the flank.', masteryBonus: '+10% damage to beasts', masteryDamageMult: 1.1 },\n  angry_bee:        { weakTo: WeaponType.Bow, resistTo: WeaponType.Axe, statusImmunity: 'burn', exploitTip: 'Bees swoop in arcs. Attack at the apex of their dive.', masteryBonus: '+10% damage to flyers', masteryDamageMult: 1.1 },\n  field_rat:        { weakTo: WeaponType.Dagger, resistTo: WeaponType.Hammer, statusImmunity: 'slow', exploitTip: 'Rats flee when injured. Corner them against obstacles.', masteryBonus: '+10% damage to beasts', masteryDamageMult: 1.1 },\n  garden_spider:    { weakTo: WeaponType.Hammer, resistTo: WeaponType.Bow, statusImmunity: 'poison', exploitTip: 'Spiders ambush from hiding. Watch for silk threads on the ground.', masteryBonus: '+10% damage to insects', masteryDamageMult: 1.1 },\n  scarecrow_mimic:  { weakTo: WeaponType.Axe, resistTo: WeaponType.Sword, statusImmunity: 'bleed', exploitTip: 'Mimics freeze when you look away. Attack when they drop their guard.', masteryBonus: '+10% damage to constructs', masteryDamageMult: 1.1 },\n  wild_wolf:        { weakTo: WeaponType.Sword, resistTo: WeaponType.Dagger, statusImmunity: 'slow', exploitTip: 'Wolves circle before pouncing. The leader signals the attack.', masteryBonus: '+10% damage to beasts', masteryDamageMult: 1.1 },\n\n  // Rotwood\n  corpse_spider:    { weakTo: WeaponType.Hammer, resistTo: WeaponType.Bow, statusImmunity: 'poison', exploitTip: 'Corpse spiders spray webs. Stay mobile to avoid entanglement.', masteryBonus: '+10% damage to insects', masteryDamageMult: 1.1 },\n  rotting_treant:   { weakTo: WeaponType.Axe, resistTo: WeaponType.Spear, statusImmunity: 'stun', exploitTip: 'Treants root themselves before swinging. Hit the base during wind-up.', masteryBonus: '+10% damage to plants', masteryDamageMult: 1.1 },\n  will_o_wisp:      { weakTo: WeaponType.Staff, resistTo: WeaponType.Hammer, statusImmunity: 'burn', exploitTip: 'Wisps blink rapidly. Their pattern repeats every 3 blinks.', masteryBonus: '+10% damage to spectral', masteryDamageMult: 1.1 },\n  spore_cloud:      { weakTo: WeaponType.Bow, resistTo: WeaponType.Sword, statusImmunity: 'poison', exploitTip: 'Spore clouds grow when damaged. Kill them in one burst.', masteryBonus: '+10% damage to fungi', masteryDamageMult: 1.1 },\n  rot_spider:       { weakTo: WeaponType.Hammer, resistTo: WeaponType.Dagger, statusImmunity: 'poison', exploitTip: 'Rot spiders leave acid trails. Lure them across their own pools.', masteryBonus: '+10% damage to insects', masteryDamageMult: 1.1 },\n  fungal_crawler:   { weakTo: WeaponType.Axe, resistTo: WeaponType.Staff, statusImmunity: 'slow', exploitTip: 'Fungal crawlers release spores on death. Step back after the killing blow.', masteryBonus: '+10% damage to fungi', masteryDamageMult: 1.1 },\n  poison_moth:      { weakTo: WeaponType.Bow, resistTo: WeaponType.Axe, statusImmunity: 'poison', exploitTip: 'Moths dive when their dust runs out. Wait for the lull.', masteryBonus: '+10% damage to flyers', masteryDamageMult: 1.1 },\n  spore_bat:        { weakTo: WeaponType.Spear, resistTo: WeaponType.Staff, statusImmunity: 'poison', exploitTip: 'Spore bats screech before diving. The screech is the telegraph.', masteryBonus: '+10% damage to flyers', masteryDamageMult: 1.1 },\n  vine_strangler:   { weakTo: WeaponType.Axe, resistTo: WeaponType.Spear, statusImmunity: 'slow', exploitTip: 'Vines retract after grabbing. Strike during the retraction.', masteryBonus: '+10% damage to plants', masteryDamageMult: 1.1 },\n  mushroom_golem:   { weakTo: WeaponType.Hammer, resistTo: WeaponType.Dagger, statusImmunity: 'poison', exploitTip: 'Mushroom golems stagger after three hits. Use the opening.', masteryBonus: '+10% damage to fungi', masteryDamageMult: 1.1 },\n  corrupted_treant: { weakTo: WeaponType.Axe, resistTo: WeaponType.Staff, statusImmunity: 'burn', exploitTip: 'Corrupted treants regenerate in corruption zones. Pull them out.', masteryBonus: '+10% damage to plants', masteryDamageMult: 1.1 },\n\n  // Ashlands\n  fire_imp:         { weakTo: WeaponType.Bow, resistTo: WeaponType.Staff, statusImmunity: 'burn', exploitTip: 'Imps always teleport behind you. Turn immediately after they vanish.', masteryBonus: '+10% damage to demons', masteryDamageMult: 1.1 },\n  magma_golem:      { weakTo: WeaponType.Hammer, resistTo: WeaponType.Sword, statusImmunity: 'burn', exploitTip: 'Magma golems cool down after their slam. Hit the darkened rock.', masteryBonus: '+10% damage to elementals', masteryDamageMult: 1.1 },\n  flame_sprite:     { weakTo: WeaponType.Spear, resistTo: WeaponType.Axe, statusImmunity: 'burn', exploitTip: 'Sprites flicker before casting. That flicker is your parry window.', masteryBonus: '+10% damage to elementals', masteryDamageMult: 1.1 },\n  ember_bat:        { weakTo: WeaponType.Bow, resistTo: WeaponType.Hammer, statusImmunity: 'burn', exploitTip: 'Ember bats ignite on death. Do not stand in the fire.', masteryBonus: '+10% damage to flyers', masteryDamageMult: 1.1 },\n  lava_golem:       { weakTo: WeaponType.Hammer, resistTo: WeaponType.Dagger, statusImmunity: 'burn', exploitTip: 'Identical to magma golems but with a wider slam radius.', masteryBonus: '+10% damage to elementals', masteryDamageMult: 1.1 },\n  ash_wraith:       { weakTo: WeaponType.Staff, resistTo: WeaponType.Bow, statusImmunity: 'bleed', exploitTip: 'Ash wraiths reform from dust. Hit the dust cloud before it solidifies.', masteryBonus: '+10% damage to spectral', masteryDamageMult: 1.1 },\n  magma_beetle:     { weakTo: WeaponType.Spear, resistTo: WeaponType.Bow, statusImmunity: 'burn', exploitTip: 'Beetles flip over when hit hard. Attack the exposed underbelly.', masteryBonus: '+10% damage to insects', masteryDamageMult: 1.1 },\n  flame_serpent:    { weakTo: WeaponType.Axe, resistTo: WeaponType.Staff, statusImmunity: 'burn', exploitTip: 'Serpents coil before striking. The tighter the coil, the longer the range.', masteryBonus: '+10% damage to beasts', masteryDamageMult: 1.1 },\n  ember_elemental:  { weakTo: WeaponType.Hammer, resistTo: WeaponType.Staff, statusImmunity: 'burn', exploitTip: 'Elementals grow stronger near lava. Fight them on cool ground.', masteryBonus: '+10% damage to elementals', masteryDamageMult: 1.1 },\n  obsidian_knight:  { weakTo: WeaponType.Hammer, resistTo: WeaponType.Bow, statusImmunity: 'stun', exploitTip: 'Knights lower their guard during two-handed swings. Parry then.', masteryBonus: '+10% damage to armored', masteryDamageMult: 1.1 },\n\n  // Drowned\n  marsh_lurker:     { weakTo: WeaponType.Axe, resistTo: WeaponType.Bow, statusImmunity: 'slow', exploitTip: 'Lurkers retreat into water when damaged. Block their escape route.', masteryBonus: '+10% damage to amphibians', masteryDamageMult: 1.1 },\n  poison_toad:      { weakTo: WeaponType.Spear, resistTo: WeaponType.Dagger, statusImmunity: 'poison', exploitTip: 'Toads swell before spitting. That is the dodge window.', masteryBonus: '+10% damage to amphibians', masteryDamageMult: 1.1 },\n  swamp_zombie:     { weakTo: WeaponType.Axe, resistTo: WeaponType.Spear, statusImmunity: 'poison', exploitTip: 'Swamp zombies grab. Mash attack to break free faster.', masteryBonus: '+10% damage to undead', masteryDamageMult: 1.1 },\n  drowned_wraith:   { weakTo: WeaponType.Staff, resistTo: WeaponType.Sword, statusImmunity: 'bleed', exploitTip: 'Drowned wraiths vanish into puddles. Watch ripples for their reappearance.', masteryBonus: '+10% damage to spectral', masteryDamageMult: 1.1 },\n  drowned_ghoul:    { weakTo: WeaponType.Hammer, resistTo: WeaponType.Dagger, statusImmunity: 'poison', exploitTip: 'Ghouls attack in bursts of three. Counter after the third swing.', masteryBonus: '+10% damage to undead', masteryDamageMult: 1.1 },\n  acid_jellyfish:   { weakTo: WeaponType.Bow, resistTo: WeaponType.Hammer, statusImmunity: 'poison', exploitTip: 'Jellyfish pulse before stinging. Attack between pulses.', masteryBonus: '+10% damage to aquatic', masteryDamageMult: 1.1 },\n  coral_golem:      { weakTo: WeaponType.Hammer, resistTo: WeaponType.Sword, statusImmunity: 'stun', exploitTip: 'Coral golems regenerate in water. Lure them onto dry ground.', masteryBonus: '+10% damage to constructs', masteryDamageMult: 1.1 },\n  deep_lurker:      { weakTo: WeaponType.Spear, resistTo: WeaponType.Staff, statusImmunity: 'slow', exploitTip: 'Deep lurkers ambush from below. Watch for bubbles on the surface.', masteryBonus: '+10% damage to aquatic', masteryDamageMult: 1.1 },\n\n  // Fallback for unknown enemies\n  shadow_wraith:    { weakTo: WeaponType.Staff, resistTo: WeaponType.Bow, statusImmunity: 'bleed', exploitTip: 'Shadow wraiths are fragments of lost resolve. Steel your mind.', masteryBonus: '+10% damage to shadows', masteryDamageMult: 1.1 },\n  shadow_phantom:   { weakTo: WeaponType.Staff, resistTo: WeaponType.Bow, statusImmunity: 'bleed', exploitTip: 'Phantoms are echoes of your doubt. They weaken as your resolve rises.', masteryBonus: '+10% damage to shadows', masteryDamageMult: 1.1 },\n};\n\n// ---------------------------------------------------------------------------\n// Manager\n// ---------------------------------------------------------------------------\n\nexport class EnemyWeaknessManager {\n  /** Discovery progress per enemy type ID */\n  private discoveries: Map<string, DiscoveryState> = new Map();\n\n  /** Callbacks */\n  private onRevealCbs: Array<(enemyId: string, tier: 'weakness' | 'resistance' | 'exploit' | 'mastery') => void> = [];\n\n  // ── Callbacks ──\n\n  onReveal(cb: (enemyId: string, tier: 'weakness' | 'resistance' | 'exploit' | 'mastery') => void): void {\n    this.onRevealCbs.push(cb);\n  }\n\n  // ── Kill Tracking ──\n\n  /** Record an enemy kill and check for new discoveries */\n  recordKill(enemyId: string): void {\n    let state = this.discoveries.get(enemyId);\n    if (!state) {\n      state = {\n        kills: 0,\n        weaknessRevealed: false,\n        resistanceRevealed: false,\n        exploitRevealed: false,\n        masteryUnlocked: false,\n      };\n      this.discoveries.set(enemyId, state);\n    }\n\n    state.kills++;\n\n    // Check thresholds\n    if (state.kills >= THRESHOLD_WEAKNESS && !state.weaknessRevealed) {\n      state.weaknessRevealed = true;\n      for (const cb of this.onRevealCbs) cb(enemyId, 'weakness');\n    }\n    if (state.kills >= THRESHOLD_RESISTANCE && !state.resistanceRevealed) {\n      state.resistanceRevealed = true;\n      for (const cb of this.onRevealCbs) cb(enemyId, 'resistance');\n    }\n    if (state.kills >= THRESHOLD_EXPLOIT && !state.exploitRevealed) {\n      state.exploitRevealed = true;\n      for (const cb of this.onRevealCbs) cb(enemyId, 'exploit');\n    }\n    if (state.kills >= THRESHOLD_MASTERY && !state.masteryUnlocked) {\n      state.masteryUnlocked = true;\n      for (const cb of this.onRevealCbs) cb(enemyId, 'mastery');\n    }\n  }\n\n  // ── Combat Queries ──\n\n  /**\n   * Get the damage multiplier for attacking an enemy with a specific weapon.\n   * Returns a multiplier (default 1.0):\n   * - +30% if weapon matches weakness AND weakness is revealed\n   * - -30% if weapon matches resistance AND resistance is revealed\n   * - Additional +10% if mastery is unlocked\n   */\n  getDamageMultiplier(enemyId: string, weaponType: WeaponType): number {\n    const profile = WEAKNESS_PROFILES[enemyId];\n    if (!profile) return 1.0;\n\n    const state = this.discoveries.get(enemyId);\n    if (!state) return 1.0;\n\n    let mult = 1.0;\n\n    // Weakness bonus (even if not revealed to player, the profile exists —\n    // but we only apply the bonus if the player has discovered it)\n    if (state.weaknessRevealed && weaponType === profile.weakTo) {\n      mult += 0.3;\n    }\n\n    // Resistance penalty (always applied once revealed)\n    if (state.resistanceRevealed && weaponType === profile.resistTo) {\n      mult -= 0.3;\n    }\n\n    // Mastery bonus\n    if (state.masteryUnlocked) {\n      mult *= profile.masteryDamageMult;\n    }\n\n    return mult;\n  }\n\n  /** Check if a status effect is resisted by this enemy type */\n  isStatusImmune(enemyId: string, statusEffect: string): boolean {\n    const profile = WEAKNESS_PROFILES[enemyId];\n    if (!profile) return false;\n    return profile.statusImmunity === statusEffect;\n  }\n\n  // ── Display Queries (for Bestiary UI) ──\n\n  /** Get what the player knows about an enemy type */\n  getKnowledge(enemyId: string): {\n    kills: number;\n    weakness: WeaponType | null;\n    resistance: WeaponType | null;\n    statusImmunity: string | null;\n    exploitTip: string | null;\n    masteryBonus: string | null;\n    masteryUnlocked: boolean;\n  } {\n    const state = this.discoveries.get(enemyId);\n    const profile = WEAKNESS_PROFILES[enemyId];\n\n    if (!state || !profile) {\n      return {\n        kills: state?.kills ?? 0,\n        weakness: null,\n        resistance: null,\n        statusImmunity: null,\n        exploitTip: null,\n        masteryBonus: null,\n        masteryUnlocked: false,\n      };\n    }\n\n    return {\n      kills: state.kills,\n      weakness: state.weaknessRevealed ? profile.weakTo : null,\n      resistance: state.resistanceRevealed ? profile.resistTo : null,\n      statusImmunity: state.resistanceRevealed ? profile.statusImmunity : null,\n      exploitTip: state.exploitRevealed ? profile.exploitTip : null,\n      masteryBonus: state.masteryUnlocked ? profile.masteryBonus : null,\n      masteryUnlocked: state.masteryUnlocked,\n    };\n  }\n\n  /** Get discovery state for an enemy type */\n  getDiscoveryState(enemyId: string): DiscoveryState | null {\n    return this.discoveries.get(enemyId) ?? null;\n  }\n\n  /** Get all discovered enemy types */\n  getDiscoveredEnemies(): string[] {\n    return Array.from(this.discoveries.keys());\n  }\n\n  /** Get overall bestiary completion (enemies with at least 1 kill / total defined) */\n  getBestiaryProgress(): { discovered: number; total: number } {\n    return {\n      discovered: this.discoveries.size,\n      total: Object.keys(WEAKNESS_PROFILES).length,\n    };\n  }\n\n  /** Check if a weakness profile exists for an enemy type */\n  hasProfile(enemyId: string): boolean {\n    return WEAKNESS_PROFILES[enemyId] !== undefined;\n  }\n\n  // ── Persistence ──\n\n  serialize(): { discoveries: Record<string, DiscoveryState> } {\n    const discoveries: Record<string, DiscoveryState> = {};\n    for (const [id, state] of this.discoveries) {\n      discoveries[id] = { ...state };\n    }\n    return { discoveries };\n  }\n\n  deserialize(data: { discoveries?: Record<string, DiscoveryState> }): void {\n    this.discoveries.clear();\n    if (data.discoveries) {\n      for (const [id, state] of Object.entries(data.discoveries)) {\n        this.discoveries.set(id, state);\n      }\n    }\n  }\n}\n","/**\n * EDILAS — Omen Slot System (Hollow Knight Charm Notch-inspired)\n * Players equip passive \"Omens\" — buffs that consume limited capacity slots.\n * Exceeding capacity triggers \"Overcharged\" state (double damage taken).\n * Omens are found as loot, bought from NPCs, or earned from bosses.\n *\n * Capacity grows with progression (boss kills, city upgrades, etc.)\n */\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport interface OmenDef {\n  id: string;\n  name: string;\n  description: string;\n  /** Number of capacity slots required */\n  notchCost: number;\n  /** Stat modifiers when equipped */\n  effects: OmenEffects;\n  /** How the omen is obtained */\n  source: 'loot' | 'shop' | 'boss' | 'quest' | 'secret';\n  /** Flavor text */\n  lore: string;\n}\n\nexport interface OmenEffects {\n  damageMult?: number;      // Multiplicative damage bonus (1.15 = +15%)\n  defenseMult?: number;     // Multiplicative defense bonus\n  speedMult?: number;       // Movement speed multiplier\n  critChanceAdd?: number;   // Flat crit chance addition\n  critMultAdd?: number;     // Flat crit multiplier addition\n  maxHpAdd?: number;        // Flat max HP bonus\n  maxStaminaAdd?: number;   // Flat max stamina bonus\n  hpRegen?: number;         // HP per second\n  staminaRegen?: number;    // Stamina per second\n  backstabMult?: number;    // Extra backstab damage multiplier\n  resolveResist?: number;   // Resolve drain reduction (0.2 = 20% less drain)\n  xpMult?: number;          // XP gain multiplier\n  goldMult?: number;        // Gold gain multiplier\n  thorns?: number;          // Reflect damage (flat per hit received)\n  lifeSteal?: number;       // Fraction of damage dealt healed (0.05 = 5%)\n}\n\n// ---------------------------------------------------------------------------\n// Omen Data\n// ---------------------------------------------------------------------------\n\nexport const OMEN_DEFS: OmenDef[] = [\n  // --- 1 Notch (Minor) ---\n  {\n    id: 'omen_quick_step',\n    name: 'Quick Step',\n    description: '+10% movement speed.',\n    notchCost: 1,\n    effects: { speedMult: 1.1 },\n    source: 'loot',\n    lore: 'A fragment of wind, captured in crystal.',\n  },\n  {\n    id: 'omen_keen_edge',\n    name: 'Keen Edge',\n    description: '+5% crit chance.',\n    notchCost: 1,\n    effects: { critChanceAdd: 0.05 },\n    source: 'loot',\n    lore: 'The blade remembers every kill.',\n  },\n  {\n    id: 'omen_iron_skin',\n    name: 'Iron Skin',\n    description: '+10% defense.',\n    notchCost: 1,\n    effects: { defenseMult: 1.1 },\n    source: 'shop',\n    lore: 'Forged in the Ashlands, tempered in blood.',\n  },\n  {\n    id: 'omen_scavenger',\n    name: 'Scavenger',\n    description: '+15% gold from kills.',\n    notchCost: 1,\n    effects: { goldMult: 1.15 },\n    source: 'loot',\n    lore: 'Every corpse has something worth taking.',\n  },\n  {\n    id: 'omen_scholars_mark',\n    name: 'Scholar\\'s Mark',\n    description: '+15% XP gain.',\n    notchCost: 1,\n    effects: { xpMult: 1.15 },\n    source: 'quest',\n    lore: 'Knowledge is the truest weapon.',\n  },\n\n  // --- 2 Notch (Standard) ---\n  {\n    id: 'omen_blood_drinker',\n    name: 'Blood Drinker',\n    description: 'Heal 5% of damage dealt.',\n    notchCost: 2,\n    effects: { lifeSteal: 0.05 },\n    source: 'boss',\n    lore: 'The Blight Mother\\'s gift: hunger that sustains.',\n  },\n  {\n    id: 'omen_thorned_shell',\n    name: 'Thorned Shell',\n    description: 'Reflect 3 damage when hit.',\n    notchCost: 2,\n    effects: { thorns: 3 },\n    source: 'loot',\n    lore: 'Pain given is pain returned.',\n  },\n  {\n    id: 'omen_steadfast_heart',\n    name: 'Steadfast Heart',\n    description: '+20 max HP.',\n    notchCost: 2,\n    effects: { maxHpAdd: 20 },\n    source: 'shop',\n    lore: 'The heart that refuses to stop beating.',\n  },\n  {\n    id: 'omen_endurance',\n    name: 'Endurance',\n    description: '+15 max stamina.',\n    notchCost: 2,\n    effects: { maxStaminaAdd: 15 },\n    source: 'loot',\n    lore: 'Second wind. Third. Fourth.',\n  },\n  {\n    id: 'omen_shadow_step',\n    name: 'Shadow Step',\n    description: '+25% backstab damage.',\n    notchCost: 2,\n    effects: { backstabMult: 1.25 },\n    source: 'secret',\n    lore: 'Move like the darkness between worlds.',\n  },\n  {\n    id: 'omen_resolve_ward',\n    name: 'Resolve Ward',\n    description: 'Reduce resolve drain by 20%.',\n    notchCost: 2,\n    effects: { resolveResist: 0.2 },\n    source: 'quest',\n    lore: 'Your mind is a fortress. Walls do not crumble easily.',\n  },\n  {\n    id: 'omen_regeneration',\n    name: 'Regeneration',\n    description: 'Heal 1 HP per second.',\n    notchCost: 2,\n    effects: { hpRegen: 1 },\n    source: 'loot',\n    lore: 'The wound closes, as if it never was.',\n  },\n\n  // --- 3 Notch (Major) ---\n  {\n    id: 'omen_berserker',\n    name: 'Berserker\\'s Fury',\n    description: '+25% damage, -15% defense.',\n    notchCost: 3,\n    effects: { damageMult: 1.25, defenseMult: 0.85 },\n    source: 'boss',\n    lore: 'Rage is the purest form of strength.',\n  },\n  {\n    id: 'omen_executioner',\n    name: 'Executioner',\n    description: '+40% crit multiplier.',\n    notchCost: 3,\n    effects: { critMultAdd: 0.4 },\n    source: 'boss',\n    lore: 'One clean strike. That is all it takes.',\n  },\n  {\n    id: 'omen_void_embrace',\n    name: 'Void Embrace',\n    description: '+20% damage, +30% XP, but resolve drains 30% faster.',\n    notchCost: 3,\n    effects: { damageMult: 1.2, xpMult: 1.3, resolveResist: -0.3 },\n    source: 'secret',\n    lore: 'The Void offers power freely. The cost is your mind.',\n  },\n  {\n    id: 'omen_titan_guard',\n    name: 'Titan Guard',\n    description: '+40 max HP, +20% defense, -10% speed.',\n    notchCost: 3,\n    effects: { maxHpAdd: 40, defenseMult: 1.2, speedMult: 0.9 },\n    source: 'boss',\n    lore: 'Stand like stone. Move like stone.',\n  },\n];\n\nexport const OMEN_DB = new Map<string, OmenDef>();\nfor (const o of OMEN_DEFS) OMEN_DB.set(o.id, o);\n\n// ---------------------------------------------------------------------------\n// Manager\n// ---------------------------------------------------------------------------\n\nexport class OmenSlotManager {\n  /** Max capacity (grows with progression) */\n  private maxCapacity = 5;\n  /** Currently equipped omen IDs */\n  private equipped: string[] = [];\n  /** All omens the player has collected (unlocked) */\n  private collected: Set<string> = new Set();\n\n  /** Callbacks */\n  private onEquipChangeCbs: Array<() => void> = [];\n\n  // ── Callbacks ──\n\n  onEquipChange(cb: () => void): void {\n    this.onEquipChangeCbs.push(cb);\n  }\n\n  private fireEquipChange(): void {\n    for (const cb of this.onEquipChangeCbs) cb();\n  }\n\n  // ── Collection ──\n\n  /** Unlock an omen (player found/bought it) */\n  collect(omenId: string): boolean {\n    if (!OMEN_DB.has(omenId)) return false;\n    if (this.collected.has(omenId)) return false;\n    this.collected.add(omenId);\n    return true;\n  }\n\n  /** Check if player has collected an omen */\n  hasCollected(omenId: string): boolean {\n    return this.collected.has(omenId);\n  }\n\n  /** Get all collected omen IDs */\n  getCollected(): string[] {\n    return Array.from(this.collected);\n  }\n\n  // ── Equip ──\n\n  /** Equip an omen (must be collected first) */\n  equip(omenId: string): boolean {\n    if (!this.collected.has(omenId)) return false;\n    if (this.equipped.includes(omenId)) return false;\n    this.equipped.push(omenId);\n    this.fireEquipChange();\n    return true;\n  }\n\n  /** Unequip an omen */\n  unequip(omenId: string): boolean {\n    const idx = this.equipped.indexOf(omenId);\n    if (idx === -1) return false;\n    this.equipped.splice(idx, 1);\n    this.fireEquipChange();\n    return true;\n  }\n\n  /** Get currently equipped omen IDs */\n  getEquipped(): string[] {\n    return [...this.equipped];\n  }\n\n  /** Check if an omen is currently equipped */\n  isEquipped(omenId: string): boolean {\n    return this.equipped.includes(omenId);\n  }\n\n  // ── Capacity ──\n\n  /** Get current notch usage */\n  getUsedCapacity(): number {\n    let total = 0;\n    for (const id of this.equipped) {\n      const def = OMEN_DB.get(id);\n      if (def) total += def.notchCost;\n    }\n    return total;\n  }\n\n  /** Get max capacity */\n  getMaxCapacity(): number {\n    return this.maxCapacity;\n  }\n\n  /** Increase max capacity (boss kill, city upgrade, etc.) */\n  addCapacity(amount: number): void {\n    this.maxCapacity += amount;\n  }\n\n  /** Whether player is \"Overcharged\" (over capacity) */\n  isOvercharged(): boolean {\n    return this.getUsedCapacity() > this.maxCapacity;\n  }\n\n  // ── Combined Effects ──\n\n  /** Get the combined effects of all equipped omens */\n  getCombinedEffects(): OmenEffects {\n    const combined: OmenEffects = {};\n\n    for (const id of this.equipped) {\n      const def = OMEN_DB.get(id);\n      if (!def) continue;\n\n      const e = def.effects;\n      // Multiplicative effects stack multiplicatively\n      if (e.damageMult) combined.damageMult = (combined.damageMult ?? 1) * e.damageMult;\n      if (e.defenseMult) combined.defenseMult = (combined.defenseMult ?? 1) * e.defenseMult;\n      if (e.speedMult) combined.speedMult = (combined.speedMult ?? 1) * e.speedMult;\n\n      // Additive effects stack additively\n      if (e.critChanceAdd) combined.critChanceAdd = (combined.critChanceAdd ?? 0) + e.critChanceAdd;\n      if (e.critMultAdd) combined.critMultAdd = (combined.critMultAdd ?? 0) + e.critMultAdd;\n      if (e.maxHpAdd) combined.maxHpAdd = (combined.maxHpAdd ?? 0) + e.maxHpAdd;\n      if (e.maxStaminaAdd) combined.maxStaminaAdd = (combined.maxStaminaAdd ?? 0) + e.maxStaminaAdd;\n      if (e.hpRegen) combined.hpRegen = (combined.hpRegen ?? 0) + e.hpRegen;\n      if (e.staminaRegen) combined.staminaRegen = (combined.staminaRegen ?? 0) + e.staminaRegen;\n      if (e.thorns) combined.thorns = (combined.thorns ?? 0) + e.thorns;\n      if (e.lifeSteal) combined.lifeSteal = (combined.lifeSteal ?? 0) + e.lifeSteal;\n      if (e.resolveResist) combined.resolveResist = (combined.resolveResist ?? 0) + e.resolveResist;\n      if (e.xpMult) combined.xpMult = (combined.xpMult ?? 1) * e.xpMult;\n      if (e.goldMult) combined.goldMult = (combined.goldMult ?? 1) * e.goldMult;\n\n      // Backstab mult stacks multiplicatively\n      if (e.backstabMult) combined.backstabMult = (combined.backstabMult ?? 1) * e.backstabMult;\n    }\n\n    return combined;\n  }\n\n  // ── Persistence ──\n\n  serialize(): {\n    maxCapacity: number;\n    equipped: string[];\n    collected: string[];\n  } {\n    return {\n      maxCapacity: this.maxCapacity,\n      equipped: [...this.equipped],\n      collected: Array.from(this.collected),\n    };\n  }\n\n  deserialize(data: {\n    maxCapacity?: number;\n    equipped?: string[];\n    collected?: string[];\n  }): void {\n    this.maxCapacity = data.maxCapacity ?? 5;\n    this.equipped = data.equipped ?? [];\n    this.collected = new Set(data.collected ?? []);\n  }\n}\n","/**\n * EDILAS — Companion Manager (Darkest Dungeon Party + Stardew Valley Social)\n * Recruit NPCs as combat companions that follow the player and fight enemies.\n * Companions have HP, damage, morale (stress), and loyalty.\n *\n * Morale drains in hostile environments (dungeons, corruption, darkness)\n * and recovers at campfires, cities, and through food/gifts.\n * Low morale causes negative effects; high loyalty grants passive bonuses.\n *\n * One companion active at a time. Companion must be recruited via\n * relationship level 3+ with the NPC.\n */\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport interface CompanionDef {\n  npcId: string;\n  name: string;\n  /** Base stats */\n  hp: number;\n  damage: number;\n  defense: number;\n  speed: number;\n  /** AI attack style */\n  style: 'melee' | 'ranged' | 'support';\n  /** Passive bonus at high loyalty */\n  loyaltyBonus: CompanionBonus;\n  /** Dialogue when recruited */\n  recruitLine: string;\n  /** Dialogue at low morale */\n  lowMoraleLine: string;\n}\n\nexport interface CompanionBonus {\n  type: 'damage' | 'defense' | 'speed' | 'xp' | 'gold' | 'resolve';\n  value: number;\n  description: string;\n}\n\nexport interface CompanionState {\n  npcId: string;\n  currentHp: number;\n  maxHp: number;\n  morale: number;       // 0-100\n  loyalty: number;      // 0-100 (grows over time)\n  isKnockedOut: boolean;\n  knockoutTimer: number; // seconds until revive\n}\n\n// ---------------------------------------------------------------------------\n// Companion Data\n// ---------------------------------------------------------------------------\n\nexport const COMPANION_DEFS: CompanionDef[] = [\n  {\n    npcId: 'elder_mira',\n    name: 'Elder Mira',\n    hp: 60, damage: 8, defense: 5, speed: 40,\n    style: 'support',\n    loyaltyBonus: { type: 'resolve', value: 3, description: '+3 resolve recovery/sec' },\n    recruitLine: 'I may be old, but I still have fight left in me.',\n    lowMoraleLine: 'Perhaps we should rest... my bones ache.',\n  },\n  {\n    npcId: 'kai',\n    name: 'Kai',\n    hp: 100, damage: 15, defense: 8, speed: 65,\n    style: 'melee',\n    loyaltyBonus: { type: 'damage', value: 0.1, description: '+10% player damage' },\n    recruitLine: 'Finally, some action! Lead the way.',\n    lowMoraleLine: 'I... I need a moment. This place is getting to me.',\n  },\n  {\n    npcId: 'sera',\n    name: 'Sera',\n    hp: 70, damage: 12, defense: 3, speed: 55,\n    style: 'ranged',\n    loyaltyBonus: { type: 'xp', value: 0.15, description: '+15% XP gain' },\n    recruitLine: 'My bow is yours. Let us see what lies beyond.',\n    lowMoraleLine: 'The shadows... they whisper things I don\\'t want to hear.',\n  },\n  {\n    npcId: 'varn',\n    name: 'Varn',\n    hp: 140, damage: 10, defense: 15, speed: 35,\n    style: 'melee',\n    loyaltyBonus: { type: 'defense', value: 5, description: '+5 player defense' },\n    recruitLine: 'I am your shield. Nothing gets past me.',\n    lowMoraleLine: 'Even stone can crack under enough pressure...',\n  },\n  {\n    npcId: 'luna',\n    name: 'Luna',\n    hp: 50, damage: 6, defense: 2, speed: 60,\n    style: 'support',\n    loyaltyBonus: { type: 'gold', value: 0.2, description: '+20% gold from kills' },\n    recruitLine: 'I know every hidden cache in these lands. Follow me!',\n    lowMoraleLine: 'I... I can\\'t think clearly anymore. The corruption...',\n  },\n];\n\nexport const COMPANION_DB = new Map<string, CompanionDef>();\nfor (const c of COMPANION_DEFS) COMPANION_DB.set(c.npcId, c);\n\n// ---------------------------------------------------------------------------\n// Constants\n// ---------------------------------------------------------------------------\n\nconst MAX_MORALE = 100;\nconst MAX_LOYALTY = 100;\nconst KNOCKOUT_REVIVE_TIME = 30; // seconds to auto-revive\n\n/** Morale drain/recovery rates */\nconst MORALE_RATES = {\n  corruptionDrain: 1.0,   // per second on corrupted tiles\n  darknessDrain: 0.5,     // per second at night\n  combatDrain: 2,         // flat per hit taken\n  campfireRecovery: 5,    // per second near campfire\n  cityRecovery: 3,        // per second in city\n  foodRecovery: 15,       // flat when player eats\n  giftRecovery: 10,       // flat when player gives gift\n};\n\n// ---------------------------------------------------------------------------\n// Manager\n// ---------------------------------------------------------------------------\n\nexport class CompanionManager {\n  /** Currently active companion (null = no companion) */\n  private active: CompanionState | null = null;\n\n  /** Callbacks */\n  private onRecruitCbs: Array<(npcId: string) => void> = [];\n  private onDismissCbs: Array<(npcId: string) => void> = [];\n  private onKnockoutCbs: Array<(npcId: string) => void> = [];\n  private onMoraleLowCbs: Array<(npcId: string) => void> = [];\n\n  // ── Callbacks ──\n\n  onRecruit(cb: (npcId: string) => void): void { this.onRecruitCbs.push(cb); }\n  onDismiss(cb: (npcId: string) => void): void { this.onDismissCbs.push(cb); }\n  onKnockout(cb: (npcId: string) => void): void { this.onKnockoutCbs.push(cb); }\n  onMoraleLow(cb: (npcId: string) => void): void { this.onMoraleLowCbs.push(cb); }\n\n  // ── Recruitment ──\n\n  /** Recruit a companion (relationship level 3+ required, checked by caller) */\n  recruit(npcId: string): boolean {\n    const def = COMPANION_DB.get(npcId);\n    if (!def) return false;\n    if (this.active) return false; // already have one\n\n    this.active = {\n      npcId,\n      currentHp: def.hp,\n      maxHp: def.hp,\n      morale: MAX_MORALE,\n      loyalty: 0,\n      isKnockedOut: false,\n      knockoutTimer: 0,\n    };\n\n    for (const cb of this.onRecruitCbs) cb(npcId);\n    return true;\n  }\n\n  /** Dismiss the current companion */\n  dismiss(): void {\n    if (!this.active) return;\n    const npcId = this.active.npcId;\n    this.active = null;\n    for (const cb of this.onDismissCbs) cb(npcId);\n  }\n\n  /** Check if a companion is active */\n  hasCompanion(): boolean {\n    return this.active !== null;\n  }\n\n  /** Get active companion state */\n  getActive(): CompanionState | null {\n    return this.active;\n  }\n\n  /** Get active companion def */\n  getActiveDef(): CompanionDef | null {\n    if (!this.active) return null;\n    return COMPANION_DB.get(this.active.npcId) ?? null;\n  }\n\n  // ── Update ──\n\n  /**\n   * Main update tick. Called each frame.\n   * @param deltaSec Delta time in seconds\n   * @param inCorruption Whether on corrupted tile\n   * @param inDarkness Whether in darkness\n   * @param inCity Whether in city\n   * @param atCampfire Whether near campfire\n   */\n  update(\n    deltaSec: number,\n    inCorruption: boolean,\n    inDarkness: boolean,\n    inCity: boolean,\n    atCampfire: boolean,\n  ): void {\n    if (!this.active) return;\n\n    // Handle knockout timer\n    if (this.active.isKnockedOut) {\n      this.active.knockoutTimer -= deltaSec;\n      if (this.active.knockoutTimer <= 0) {\n        this.active.isKnockedOut = false;\n        this.active.currentHp = Math.round(this.active.maxHp * 0.3); // Revive at 30% HP\n        this.active.morale = Math.max(10, this.active.morale); // Minimum 10 morale on revive\n      }\n      return; // Skip other updates while knocked out\n    }\n\n    // Morale drain\n    if (inCorruption) this.drainMorale(MORALE_RATES.corruptionDrain * deltaSec);\n    if (inDarkness) this.drainMorale(MORALE_RATES.darknessDrain * deltaSec);\n\n    // Morale recovery\n    if (atCampfire) this.addMorale(MORALE_RATES.campfireRecovery * deltaSec);\n    if (inCity) this.addMorale(MORALE_RATES.cityRecovery * deltaSec);\n\n    // Loyalty grows slowly while adventuring together\n    this.active.loyalty = Math.min(MAX_LOYALTY, this.active.loyalty + 0.02 * deltaSec);\n\n    // HP regen in safe zones\n    if (inCity || atCampfire) {\n      this.active.currentHp = Math.min(\n        this.active.maxHp,\n        this.active.currentHp + 2 * deltaSec,\n      );\n    }\n  }\n\n  // ── Events ──\n\n  /** Companion takes damage */\n  onCompanionHit(damage: number): void {\n    if (!this.active || this.active.isKnockedOut) return;\n\n    this.active.currentHp -= damage;\n    this.drainMorale(MORALE_RATES.combatDrain);\n\n    if (this.active.currentHp <= 0) {\n      this.active.currentHp = 0;\n      this.active.isKnockedOut = true;\n      this.active.knockoutTimer = KNOCKOUT_REVIVE_TIME;\n      for (const cb of this.onKnockoutCbs) cb(this.active.npcId);\n    }\n  }\n\n  /** Called when player eats food (companion morale boost) */\n  onPlayerFood(): void {\n    if (!this.active || this.active.isKnockedOut) return;\n    this.addMorale(MORALE_RATES.foodRecovery);\n  }\n\n  /** Called when player gives a gift to the companion's NPC */\n  onGift(): void {\n    if (!this.active || this.active.isKnockedOut) return;\n    this.addMorale(MORALE_RATES.giftRecovery);\n    this.active.loyalty = Math.min(MAX_LOYALTY, this.active.loyalty + 2);\n  }\n\n  /** Heal companion at campfire (full heal) */\n  healAtCampfire(): void {\n    if (!this.active) return;\n    if (this.active.isKnockedOut) {\n      this.active.isKnockedOut = false;\n      this.active.knockoutTimer = 0;\n    }\n    this.active.currentHp = this.active.maxHp;\n    this.active.morale = Math.min(MAX_MORALE, this.active.morale + 30);\n  }\n\n  // ── Morale ──\n\n  private drainMorale(amount: number): void {\n    if (!this.active) return;\n    const prev = this.active.morale;\n    this.active.morale = Math.max(0, this.active.morale - amount);\n\n    // Fire low morale callback at thresholds\n    if (prev > 20 && this.active.morale <= 20) {\n      for (const cb of this.onMoraleLowCbs) cb(this.active.npcId);\n    }\n  }\n\n  private addMorale(amount: number): void {\n    if (!this.active) return;\n    this.active.morale = Math.min(MAX_MORALE, this.active.morale + amount);\n  }\n\n  // ── Queries ──\n\n  /** Get companion combat stats (factored by morale) */\n  getCombatStats(): { damage: number; defense: number; speed: number } | null {\n    if (!this.active || this.active.isKnockedOut) return null;\n    const def = COMPANION_DB.get(this.active.npcId);\n    if (!def) return null;\n\n    // Morale affects combat performance: below 30 = penalty\n    const moraleFactor = this.active.morale < 30\n      ? 0.5 + (this.active.morale / 30) * 0.5  // 0.5-1.0\n      : 1.0;\n\n    return {\n      damage: Math.round(def.damage * moraleFactor),\n      defense: Math.round(def.defense * moraleFactor),\n      speed: Math.round(def.speed * moraleFactor),\n    };\n  }\n\n  /** Get loyalty bonus if loyalty is high enough (50+) */\n  getLoyaltyBonus(): CompanionBonus | null {\n    if (!this.active || this.active.loyalty < 50) return null;\n    const def = COMPANION_DB.get(this.active.npcId);\n    return def?.loyaltyBonus ?? null;\n  }\n\n  /** Get morale state for UI display */\n  getMoraleState(): 'high' | 'normal' | 'low' | 'critical' | null {\n    if (!this.active) return null;\n    if (this.active.morale >= 70) return 'high';\n    if (this.active.morale >= 40) return 'normal';\n    if (this.active.morale >= 20) return 'low';\n    return 'critical';\n  }\n\n  // ── Persistence ──\n\n  serialize(): { active: CompanionState | null } {\n    return { active: this.active ? { ...this.active } : null };\n  }\n\n  deserialize(data: { active?: CompanionState | null }): void {\n    this.active = data.active ?? null;\n  }\n}\n","/**\n * EDILAS — Boon Manager (Hades Boon System)\n * After clearing dungeon rooms or rift floors, the player chooses one of\n * three randomly offered boons — temporary buffs that last for the current\n * expedition/run. Boons come in three rarity tiers with escalating power.\n *\n * Boons modify combat stats, abilities, and passive effects. They stack\n * with equipment and omen effects but reset on expedition end.\n */\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport type BoonRarity = 'common' | 'rare' | 'epic';\n\nexport interface BoonDef {\n  id: string;\n  name: string;\n  description: string;\n  rarity: BoonRarity;\n  /** Which deity/source offers this boon (for theming) */\n  source: string;\n  /** Stat modifiers */\n  effects: BoonEffects;\n  /** Icon color for display */\n  color: string;\n}\n\nexport interface BoonEffects {\n  flatDamage?: number;        // +X flat damage per hit\n  damageMult?: number;        // Multiplicative damage bonus\n  attackSpeedMult?: number;   // Attack speed multiplier\n  critChanceAdd?: number;     // Flat crit chance addition\n  critMultAdd?: number;       // Flat crit mult addition\n  maxHpAdd?: number;          // Flat max HP\n  defenseAdd?: number;        // Flat defense\n  speedMult?: number;         // Movement speed mult\n  lifeSteal?: number;         // Fraction of damage healed\n  thornsDamage?: number;      // Reflect damage per hit received\n  dodgeChance?: number;       // % chance to completely avoid damage\n  statusOnHit?: string;       // Apply this status effect on hit (poison/burn/freeze/bleed)\n  statusDuration?: number;    // Duration of the applied status\n  statusDamage?: number;      // DPS of the applied status\n  aoeRadius?: number;         // AoE splash damage radius on kill\n  aoeDamage?: number;         // AoE splash damage amount\n  xpMult?: number;            // XP multiplier\n  goldMult?: number;          // Gold multiplier\n}\n\n// ---------------------------------------------------------------------------\n// Boon Definitions\n// ---------------------------------------------------------------------------\n\nconst BOON_DEFS: BoonDef[] = [\n  // === Common (frequent, modest bonuses) ===\n  { id: 'boon_swift_blade', name: 'Swift Blade', description: '+15% attack speed.', rarity: 'common', source: 'Wind Spirit', effects: { attackSpeedMult: 1.15 }, color: '#88ccff' },\n  { id: 'boon_iron_will', name: 'Iron Will', description: '+15 max HP.', rarity: 'common', source: 'Stone Spirit', effects: { maxHpAdd: 15 }, color: '#aaaaaa' },\n  { id: 'boon_keen_senses', name: 'Keen Senses', description: '+5% crit chance.', rarity: 'common', source: 'Shadow Spirit', effects: { critChanceAdd: 0.05 }, color: '#cc88ff' },\n  { id: 'boon_thick_skin', name: 'Thick Skin', description: '+3 defense.', rarity: 'common', source: 'Stone Spirit', effects: { defenseAdd: 3 }, color: '#aaaaaa' },\n  { id: 'boon_fleet_foot', name: 'Fleet Foot', description: '+10% movement speed.', rarity: 'common', source: 'Wind Spirit', effects: { speedMult: 1.1 }, color: '#88ccff' },\n  { id: 'boon_heavy_strike', name: 'Heavy Strike', description: '+3 flat damage per hit.', rarity: 'common', source: 'Fire Spirit', effects: { flatDamage: 3 }, color: '#ff8844' },\n  { id: 'boon_prospector', name: 'Prospector', description: '+20% gold from kills.', rarity: 'common', source: 'Earth Spirit', effects: { goldMult: 1.2 }, color: '#ffdd44' },\n  { id: 'boon_student', name: 'Student', description: '+20% XP gain.', rarity: 'common', source: 'Wisdom Spirit', effects: { xpMult: 1.2 }, color: '#44ddff' },\n\n  // === Rare (less frequent, meaningful bonuses) ===\n  { id: 'boon_venomous_strikes', name: 'Venomous Strikes', description: 'Attacks apply poison (3s, 2 DPS).', rarity: 'rare', source: 'Shadow Spirit', effects: { statusOnHit: 'poison', statusDuration: 3, statusDamage: 2 }, color: '#44ff44' },\n  { id: 'boon_flame_touch', name: 'Flame Touch', description: 'Attacks apply burn (2s, 3 DPS).', rarity: 'rare', source: 'Fire Spirit', effects: { statusOnHit: 'burn', statusDuration: 2, statusDamage: 3 }, color: '#ff4400' },\n  { id: 'boon_frost_edge', name: 'Frost Edge', description: 'Attacks apply freeze (1.5s slow).', rarity: 'rare', source: 'Ice Spirit', effects: { statusOnHit: 'freeze', statusDuration: 1.5 }, color: '#88ddff' },\n  { id: 'boon_blood_frenzy', name: 'Blood Frenzy', description: '+25% damage, +20% attack speed.', rarity: 'rare', source: 'War Spirit', effects: { damageMult: 1.25, attackSpeedMult: 1.2 }, color: '#ff2222' },\n  { id: 'boon_vampiric_touch', name: 'Vampiric Touch', description: 'Heal 8% of damage dealt.', rarity: 'rare', source: 'Shadow Spirit', effects: { lifeSteal: 0.08 }, color: '#cc0044' },\n  { id: 'boon_mirror_shield', name: 'Mirror Shield', description: 'Reflect 5 damage when hit.', rarity: 'rare', source: 'Stone Spirit', effects: { thornsDamage: 5 }, color: '#aaccff' },\n  { id: 'boon_critical_edge', name: 'Critical Edge', description: '+50% crit multiplier.', rarity: 'rare', source: 'War Spirit', effects: { critMultAdd: 0.5 }, color: '#ffaa00' },\n  { id: 'boon_phantom_step', name: 'Phantom Step', description: '10% chance to dodge attacks entirely.', rarity: 'rare', source: 'Wind Spirit', effects: { dodgeChance: 0.1 }, color: '#ccccff' },\n\n  // === Epic (rare, powerful bonuses) ===\n  { id: 'boon_death_nova', name: 'Death Nova', description: 'Enemies explode on death (30 dmg, 40px radius).', rarity: 'epic', source: 'Void Spirit', effects: { aoeRadius: 40, aoeDamage: 30 }, color: '#aa00ff' },\n  { id: 'boon_berserker_rage', name: 'Berserker Rage', description: '+50% damage, +30% attack speed, -20 max HP.', rarity: 'epic', source: 'War Spirit', effects: { damageMult: 1.5, attackSpeedMult: 1.3, maxHpAdd: -20 }, color: '#ff0000' },\n  { id: 'boon_hemorrhage', name: 'Hemorrhage', description: 'Attacks apply bleed (4s, 4 DPS).', rarity: 'epic', source: 'Shadow Spirit', effects: { statusOnHit: 'bleed', statusDuration: 4, statusDamage: 4 }, color: '#ff2244' },\n  { id: 'boon_fortress', name: 'Fortress', description: '+50 max HP, +8 defense, -10% speed.', rarity: 'epic', source: 'Stone Spirit', effects: { maxHpAdd: 50, defenseAdd: 8, speedMult: 0.9 }, color: '#886644' },\n  { id: 'boon_spectral_blade', name: 'Spectral Blade', description: '+8 flat damage, +10% crit, attacks apply stun (0.3s).', rarity: 'epic', source: 'Void Spirit', effects: { flatDamage: 8, critChanceAdd: 0.1, statusOnHit: 'stun', statusDuration: 0.3 }, color: '#dd44ff' },\n];\n\nconst BOON_DB = new Map<string, BoonDef>();\nfor (const b of BOON_DEFS) BOON_DB.set(b.id, b);\n\n// Rarity weights for rolling\nconst RARITY_WEIGHTS: Record<BoonRarity, number> = {\n  common: 60,\n  rare: 30,\n  epic: 10,\n};\n\n// ---------------------------------------------------------------------------\n// Manager\n// ---------------------------------------------------------------------------\n\nexport class BoonManager {\n  /** Currently active boons for this run */\n  private activeBoons: BoonDef[] = [];\n  /** Total boons collected across all runs (for achievements) */\n  private totalCollected = 0;\n\n  /** Callbacks */\n  private onBoonChoiceCbs: Array<(choices: BoonDef[]) => void> = [];\n  private onBoonSelectedCbs: Array<(boon: BoonDef) => void> = [];\n\n  // ── Callbacks ──\n\n  onBoonChoice(cb: (choices: BoonDef[]) => void): void {\n    this.onBoonChoiceCbs.push(cb);\n  }\n\n  onBoonSelected(cb: (boon: BoonDef) => void): void {\n    this.onBoonSelectedCbs.push(cb);\n  }\n\n  // ── Boon Offering ──\n\n  /**\n   * Roll 3 boon choices (called when a room is cleared).\n   * Avoids offering boons the player already has.\n   * @param luckBonus Extra weight toward higher rarities\n   */\n  offerBoonChoice(luckBonus: number = 0): BoonDef[] {\n    const available = BOON_DEFS.filter(b => !this.activeBoons.some(a => a.id === b.id));\n    if (available.length === 0) return [];\n\n    // Adjust rarity weights by luck\n    const weights = { ...RARITY_WEIGHTS };\n    weights.rare += luckBonus * 5;\n    weights.epic += luckBonus * 3;\n\n    const choices: BoonDef[] = [];\n    const used = new Set<string>();\n\n    for (let i = 0; i < 3 && choices.length < 3; i++) {\n      // Roll rarity\n      const rarity = this.rollRarity(weights);\n      const pool = available.filter(b => b.rarity === rarity && !used.has(b.id));\n\n      if (pool.length > 0) {\n        const pick = pool[Math.floor(Math.random() * pool.length)];\n        choices.push(pick);\n        used.add(pick.id);\n      } else {\n        // Fallback: pick any unused boon\n        const fallback = available.filter(b => !used.has(b.id));\n        if (fallback.length > 0) {\n          const pick = fallback[Math.floor(Math.random() * fallback.length)];\n          choices.push(pick);\n          used.add(pick.id);\n        }\n      }\n    }\n\n    for (const cb of this.onBoonChoiceCbs) cb(choices);\n    return choices;\n  }\n\n  private rollRarity(weights: Record<BoonRarity, number>): BoonRarity {\n    const total = weights.common + weights.rare + weights.epic;\n    const roll = Math.random() * total;\n    if (roll < weights.common) return 'common';\n    if (roll < weights.common + weights.rare) return 'rare';\n    return 'epic';\n  }\n\n  /** Player selects a boon from the offered choices */\n  selectBoon(boonId: string): boolean {\n    const def = BOON_DB.get(boonId);\n    if (!def) return false;\n    if (this.activeBoons.some(b => b.id === boonId)) return false;\n\n    this.activeBoons.push(def);\n    this.totalCollected++;\n    for (const cb of this.onBoonSelectedCbs) cb(def);\n    return true;\n  }\n\n  // ── Run Management ──\n\n  /** Clear all boons (called at expedition end) */\n  clearRun(): void {\n    this.activeBoons = [];\n  }\n\n  /** Get all active boons */\n  getActiveBoons(): BoonDef[] {\n    return [...this.activeBoons];\n  }\n\n  /** Get number of active boons */\n  getActiveCount(): number {\n    return this.activeBoons.length;\n  }\n\n  // ── Combined Effects ──\n\n  /** Get combined effects of all active boons */\n  getCombinedEffects(): BoonEffects {\n    const combined: BoonEffects = {};\n\n    for (const boon of this.activeBoons) {\n      const e = boon.effects;\n\n      // Additive\n      if (e.flatDamage) combined.flatDamage = (combined.flatDamage ?? 0) + e.flatDamage;\n      if (e.maxHpAdd) combined.maxHpAdd = (combined.maxHpAdd ?? 0) + e.maxHpAdd;\n      if (e.defenseAdd) combined.defenseAdd = (combined.defenseAdd ?? 0) + e.defenseAdd;\n      if (e.critChanceAdd) combined.critChanceAdd = (combined.critChanceAdd ?? 0) + e.critChanceAdd;\n      if (e.critMultAdd) combined.critMultAdd = (combined.critMultAdd ?? 0) + e.critMultAdd;\n      if (e.lifeSteal) combined.lifeSteal = (combined.lifeSteal ?? 0) + e.lifeSteal;\n      if (e.thornsDamage) combined.thornsDamage = (combined.thornsDamage ?? 0) + e.thornsDamage;\n      if (e.dodgeChance) combined.dodgeChance = (combined.dodgeChance ?? 0) + e.dodgeChance;\n      if (e.aoeDamage) combined.aoeDamage = (combined.aoeDamage ?? 0) + e.aoeDamage;\n      if (e.aoeRadius) combined.aoeRadius = Math.max(combined.aoeRadius ?? 0, e.aoeRadius);\n\n      // Multiplicative\n      if (e.damageMult) combined.damageMult = (combined.damageMult ?? 1) * e.damageMult;\n      if (e.attackSpeedMult) combined.attackSpeedMult = (combined.attackSpeedMult ?? 1) * e.attackSpeedMult;\n      if (e.speedMult) combined.speedMult = (combined.speedMult ?? 1) * e.speedMult;\n      if (e.xpMult) combined.xpMult = (combined.xpMult ?? 1) * e.xpMult;\n      if (e.goldMult) combined.goldMult = (combined.goldMult ?? 1) * e.goldMult;\n\n      // Status on hit: keep the strongest\n      if (e.statusOnHit) {\n        if (!combined.statusOnHit || (e.statusDamage ?? 0) > (combined.statusDamage ?? 0)) {\n          combined.statusOnHit = e.statusOnHit;\n          combined.statusDuration = e.statusDuration;\n          combined.statusDamage = e.statusDamage;\n        }\n      }\n    }\n\n    return combined;\n  }\n\n  // ── Persistence ──\n\n  serialize(): { totalCollected: number; activeBoonIds: string[] } {\n    return {\n      totalCollected: this.totalCollected,\n      activeBoonIds: this.activeBoons.map(b => b.id),\n    };\n  }\n\n  deserialize(data: { totalCollected?: number; activeBoonIds?: string[] }): void {\n    this.totalCollected = data.totalCollected ?? 0;\n    this.activeBoons = [];\n    if (data.activeBoonIds) {\n      for (const id of data.activeBoonIds) {\n        const def = BOON_DB.get(id);\n        if (def) this.activeBoons.push(def);\n      }\n    }\n  }\n}\n","/**\n * EDILAS — Resource Cycle Manager (Don't Starve + Valheim-inspired)\n * Tracks harvested resources per region. Resources deplete when harvested\n * and regrow over in-game days. Forces biome rotation for gathering and\n * creates strategic decisions about when/where to gather.\n *\n * Regions are 4x4 chunk areas. Each region tracks depletion per resource\n * type and has a regrowth timer.\n */\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport interface RegionState {\n  /** Number of resources harvested (trees, rocks, etc.) */\n  harvested: number;\n  /** Maximum before region is \"depleted\" */\n  maxResources: number;\n  /** Days remaining until full regrowth */\n  regrowthDays: number;\n  /** Whether region is currently depleted (>80% harvested) */\n  depleted: boolean;\n}\n\n// ---------------------------------------------------------------------------\n// Constants\n// ---------------------------------------------------------------------------\n\nconst REGION_SIZE = 4; // 4x4 chunks per region\nconst BASE_MAX_RESOURCES = 20; // Resources per region before depletion\nconst DEPLETION_THRESHOLD = 0.8; // 80% harvested = depleted\nconst REGROWTH_DAYS = 3; // Days to fully regrow\nconst REGROWTH_PER_DAY = 0.33; // Fraction of resources that regrow per day\n\n// ---------------------------------------------------------------------------\n// Manager\n// ---------------------------------------------------------------------------\n\nexport class ResourceCycleManager {\n  /** Region state keyed by \"regionX,regionY\" */\n  private regions: Map<string, RegionState> = new Map();\n\n  /** Callbacks */\n  private onDepletedCbs: Array<(regionKey: string) => void> = [];\n  private onRegrowthCbs: Array<(regionKey: string) => void> = [];\n\n  // ── Callbacks ──\n\n  onDepleted(cb: (regionKey: string) => void): void {\n    this.onDepletedCbs.push(cb);\n  }\n\n  onRegrowth(cb: (regionKey: string) => void): void {\n    this.onRegrowthCbs.push(cb);\n  }\n\n  // ── Region Key ──\n\n  /** Convert tile coordinates to region key */\n  getRegionKey(tileX: number, tileY: number): string {\n    const rx = Math.floor(tileX / (REGION_SIZE * 16)); // 16 tiles per chunk\n    const ry = Math.floor(tileY / (REGION_SIZE * 16));\n    return `${rx},${ry}`;\n  }\n\n  // ── Harvest Tracking ──\n\n  /**\n   * Record a resource harvest at a tile location.\n   * Returns whether the harvest is allowed (false if region depleted).\n   */\n  recordHarvest(tileX: number, tileY: number): boolean {\n    const key = this.getRegionKey(tileX, tileY);\n    let region = this.regions.get(key);\n\n    if (!region) {\n      region = {\n        harvested: 0,\n        maxResources: BASE_MAX_RESOURCES,\n        regrowthDays: 0,\n        depleted: false,\n      };\n      this.regions.set(key, region);\n    }\n\n    // Check if depleted\n    if (region.depleted) return false;\n\n    region.harvested++;\n    region.regrowthDays = REGROWTH_DAYS;\n\n    // Check depletion threshold\n    if (region.harvested / region.maxResources >= DEPLETION_THRESHOLD) {\n      region.depleted = true;\n      for (const cb of this.onDepletedCbs) cb(key);\n    }\n\n    return true;\n  }\n\n  /**\n   * Check if a region allows harvesting (not depleted).\n   */\n  canHarvest(tileX: number, tileY: number): boolean {\n    const key = this.getRegionKey(tileX, tileY);\n    const region = this.regions.get(key);\n    if (!region) return true;\n    return !region.depleted;\n  }\n\n  /** Get depletion percentage for a region (0-1) */\n  getDepletionPct(tileX: number, tileY: number): number {\n    const key = this.getRegionKey(tileX, tileY);\n    const region = this.regions.get(key);\n    if (!region) return 0;\n    return region.harvested / region.maxResources;\n  }\n\n  // ── Day Cycle ──\n\n  /** Called once per in-game day. Regrows depleted regions. */\n  advanceDay(): void {\n    for (const [key, region] of this.regions) {\n      if (region.harvested <= 0) continue;\n\n      region.regrowthDays--;\n\n      // Partial regrowth each day\n      const regrowAmount = Math.ceil(region.maxResources * REGROWTH_PER_DAY);\n      region.harvested = Math.max(0, region.harvested - regrowAmount);\n\n      // Check if fully regrown\n      if (region.harvested <= 0 || region.regrowthDays <= 0) {\n        region.harvested = 0;\n        region.regrowthDays = 0;\n\n        if (region.depleted) {\n          region.depleted = false;\n          for (const cb of this.onRegrowthCbs) cb(key);\n        }\n      }\n    }\n  }\n\n  // ── Queries ──\n\n  /** Get all depleted regions */\n  getDepletedRegions(): string[] {\n    const result: string[] = [];\n    for (const [key, region] of this.regions) {\n      if (region.depleted) result.push(key);\n    }\n    return result;\n  }\n\n  /** Get region state (for UI/map display) */\n  getRegionState(tileX: number, tileY: number): RegionState | null {\n    const key = this.getRegionKey(tileX, tileY);\n    return this.regions.get(key) ?? null;\n  }\n\n  // ── Persistence ──\n\n  serialize(): { regions: Record<string, RegionState> } {\n    const regions: Record<string, RegionState> = {};\n    for (const [key, state] of this.regions) {\n      regions[key] = { ...state };\n    }\n    return { regions };\n  }\n\n  deserialize(data: { regions?: Record<string, RegionState> }): void {\n    this.regions.clear();\n    if (data.regions) {\n      for (const [key, state] of Object.entries(data.regions)) {\n        this.regions.set(key, state);\n      }\n    }\n  }\n}\n","/**\n * EDILAS — Shortcut Manager (Hollow Knight Stagway / Dark Souls Shortcut)\n * Permanent one-way gates between biomes that unlock from the far side.\n * Once opened, shortcuts provide fast travel between connected waypoints.\n * Each shortcut costs a resource (gold, boss soul, or special material).\n *\n * Shortcuts make the world feel interconnected and reward thorough\n * exploration of later biomes.\n */\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport interface ShortcutDef {\n  id: string;\n  name: string;\n  description: string;\n  /** Biome where the shortcut entrance is */\n  fromBiome: string;\n  /** Biome where the shortcut exit is */\n  toBiome: string;\n  /** World position of the entrance */\n  fromX: number;\n  fromY: number;\n  /** World position of the exit */\n  toX: number;\n  toY: number;\n  /** Cost to unlock */\n  cost: ShortcutCost;\n  /** Whether this is a two-way shortcut */\n  bidirectional: boolean;\n}\n\nexport interface ShortcutCost {\n  gold?: number;\n  itemId?: string;\n  itemQty?: number;\n}\n\n// ---------------------------------------------------------------------------\n// Shortcut Data\n// ---------------------------------------------------------------------------\n\nexport const SHORTCUT_DEFS: ShortcutDef[] = [\n  // Haven ↔ Rotwood\n  {\n    id: 'haven_rotwood_bridge',\n    name: 'Collapsed Bridge',\n    description: 'An old stone bridge connecting Haven to Rotwood. Repair it to cross freely.',\n    fromBiome: 'haven', toBiome: 'rotwood',\n    fromX: 800, fromY: 200, toX: 1200, toY: 200,\n    cost: { gold: 200 },\n    bidirectional: true,\n  },\n  {\n    id: 'haven_rotwood_tunnel',\n    name: 'Root Tunnel',\n    description: 'A hidden tunnel beneath ancient tree roots.',\n    fromBiome: 'haven', toBiome: 'rotwood',\n    fromX: 400, fromY: 600, toX: 1000, toY: 500,\n    cost: { itemId: 'dark_wood', itemQty: 10 },\n    bidirectional: true,\n  },\n\n  // Rotwood ↔ Ashlands\n  {\n    id: 'rotwood_ashlands_gate',\n    name: 'Scorched Gate',\n    description: 'A massive iron gate sealed by volcanic heat.',\n    fromBiome: 'rotwood', toBiome: 'ashlands',\n    fromX: 1600, fromY: 300, toX: 2000, toY: 300,\n    cost: { gold: 500 },\n    bidirectional: true,\n  },\n  {\n    id: 'rotwood_ashlands_cavern',\n    name: 'Lava Cavern',\n    description: 'A treacherous cave passage through volcanic rock.',\n    fromBiome: 'rotwood', toBiome: 'ashlands',\n    fromX: 1400, fromY: 700, toX: 1900, toY: 600,\n    cost: { itemId: 'fire_essence', itemQty: 5 },\n    bidirectional: true,\n  },\n\n  // Ashlands ↔ Drowned\n  {\n    id: 'ashlands_drowned_aqueduct',\n    name: 'Ruined Aqueduct',\n    description: 'An ancient water channel connecting fire and flood.',\n    fromBiome: 'ashlands', toBiome: 'drowned',\n    fromX: 2400, fromY: 400, toX: 2800, toY: 400,\n    cost: { gold: 800 },\n    bidirectional: true,\n  },\n\n  // Drowned ↔ Bone Wastes\n  {\n    id: 'drowned_bone_passage',\n    name: 'Sunken Passage',\n    description: 'A flooded corridor leading to the desert.',\n    fromBiome: 'drowned', toBiome: 'bone',\n    fromX: 3200, fromY: 300, toX: 3600, toY: 300,\n    cost: { gold: 1200 },\n    bidirectional: true,\n  },\n\n  // Bone Wastes ↔ The Void\n  {\n    id: 'bone_void_rift',\n    name: 'Void Rift',\n    description: 'A tear in reality leading to the space between worlds.',\n    fromBiome: 'bone', toBiome: 'void',\n    fromX: 4000, fromY: 400, toX: 4400, toY: 400,\n    cost: { itemId: 'void_shard', itemQty: 3 },\n    bidirectional: true,\n  },\n\n  // Haven ↔ Ashlands (long shortcut, expensive)\n  {\n    id: 'haven_ashlands_portal',\n    name: 'Ancient Portal',\n    description: 'A forgotten teleportation circle from before the corruption.',\n    fromBiome: 'haven', toBiome: 'ashlands',\n    fromX: 600, fromY: 100, toX: 2200, toY: 100,\n    cost: { gold: 1500, itemId: 'crystal_shard', itemQty: 10 },\n    bidirectional: true,\n  },\n\n  // Rotwood ↔ Drowned (skip shortcut)\n  {\n    id: 'rotwood_drowned_canal',\n    name: 'Flooded Canal',\n    description: 'A water-filled canal connecting the forest to the depths.',\n    fromBiome: 'rotwood', toBiome: 'drowned',\n    fromX: 1500, fromY: 500, toX: 2900, toY: 500,\n    cost: { gold: 1000 },\n    bidirectional: true,\n  },\n];\n\nexport const SHORTCUT_DB = new Map<string, ShortcutDef>();\nfor (const s of SHORTCUT_DEFS) SHORTCUT_DB.set(s.id, s);\n\n// ---------------------------------------------------------------------------\n// Manager\n// ---------------------------------------------------------------------------\n\nexport class ShortcutManager {\n  /** Set of unlocked shortcut IDs */\n  private unlocked: Set<string> = new Set();\n\n  /** Callbacks */\n  private onUnlockCbs: Array<(shortcutId: string) => void> = [];\n\n  // ── Callbacks ──\n\n  onUnlock(cb: (shortcutId: string) => void): void {\n    this.onUnlockCbs.push(cb);\n  }\n\n  // ── Unlock ──\n\n  /**\n   * Attempt to unlock a shortcut. Returns true if successful.\n   * Caller must verify the player has the required cost.\n   */\n  unlock(shortcutId: string): boolean {\n    if (!SHORTCUT_DB.has(shortcutId)) return false;\n    if (this.unlocked.has(shortcutId)) return false;\n\n    this.unlocked.add(shortcutId);\n    for (const cb of this.onUnlockCbs) cb(shortcutId);\n    return true;\n  }\n\n  /** Check if a shortcut is unlocked */\n  isUnlocked(shortcutId: string): boolean {\n    return this.unlocked.has(shortcutId);\n  }\n\n  // ── Queries ──\n\n  /** Get all unlocked shortcuts */\n  getUnlockedShortcuts(): ShortcutDef[] {\n    return SHORTCUT_DEFS.filter(s => this.unlocked.has(s.id));\n  }\n\n  /** Get shortcuts available from a specific biome */\n  getShortcutsFrom(biome: string): ShortcutDef[] {\n    return SHORTCUT_DEFS.filter(\n      s => this.unlocked.has(s.id) && (s.fromBiome === biome || (s.bidirectional && s.toBiome === biome)),\n    );\n  }\n\n  /** Get all shortcuts (for map display — locked ones shown differently) */\n  getAllShortcuts(): { def: ShortcutDef; unlocked: boolean }[] {\n    return SHORTCUT_DEFS.map(s => ({ def: s, unlocked: this.unlocked.has(s.id) }));\n  }\n\n  /** Get the destination position for a shortcut from a given position */\n  getDestination(shortcutId: string, fromX: number, fromY: number): { x: number; y: number } | null {\n    const def = SHORTCUT_DB.get(shortcutId);\n    if (!def || !this.unlocked.has(shortcutId)) return null;\n\n    // Determine which end the player is at and teleport to the other\n    const distFrom = Math.sqrt((fromX - def.fromX) ** 2 + (fromY - def.fromY) ** 2);\n    const distTo = Math.sqrt((fromX - def.toX) ** 2 + (fromY - def.toY) ** 2);\n\n    if (distFrom < distTo) {\n      return { x: def.toX, y: def.toY };\n    } else if (def.bidirectional) {\n      return { x: def.fromX, y: def.fromY };\n    }\n\n    return null;\n  }\n\n  /** Get the number of unlocked shortcuts */\n  getUnlockedCount(): number {\n    return this.unlocked.size;\n  }\n\n  /** Get total shortcut count */\n  getTotalCount(): number {\n    return SHORTCUT_DEFS.length;\n  }\n\n  // ── Persistence ──\n\n  serialize(): { unlocked: string[] } {\n    return { unlocked: Array.from(this.unlocked) };\n  }\n\n  deserialize(data: { unlocked?: string[] }): void {\n    this.unlocked.clear();\n    if (data.unlocked) {\n      for (const id of data.unlocked) {\n        this.unlocked.add(id);\n      }\n    }\n  }\n}\n","/**\n * EDILAS — Forsaken Imprint System (Valheim Forsaken Power-inspired)\n * After defeating a gate boss, the player absorbs its essence as an Imprint.\n * Up to 3 Imprints can be active simultaneously, providing passive stat bonuses\n * and world-altering effects. Imprints can be swapped at Shrine locations.\n *\n * Each Imprint also carries a \"resonance\" — enemies of the boss's faction\n * become more aggressive when the player carries their master's stolen power.\n */\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport interface ImprintDef {\n  id: string;\n  /** Boss that grants this imprint */\n  bossId: string;\n  name: string;\n  description: string;\n  /** Passive stat modifiers */\n  effects: ImprintEffects;\n  /** Enemies of this biome become more aggressive */\n  aggroBiome: string;\n  /** How much extra aggro (1.0 = normal, 1.5 = 50% more) */\n  aggroMult: number;\n  /** Color tint for visual feedback */\n  color: string;\n  /** Lore text */\n  lore: string;\n}\n\nexport interface ImprintEffects {\n  damageMult?: number;       // 1.15 = +15% damage\n  defenseMult?: number;      // 1.1 = +10% defense\n  speedMult?: number;        // Movement speed multiplier\n  maxHpAdd?: number;         // Flat HP bonus\n  maxStaminaAdd?: number;    // Flat stamina bonus\n  critChanceAdd?: number;    // Flat crit chance\n  hpRegen?: number;          // HP per second\n  staminaRegen?: number;     // Stamina per second\n  resolveResist?: number;    // Resolve drain reduction\n  elementalDamageMult?: number; // Bonus to elemental damage\n  xpMult?: number;           // XP gain multiplier\n  goldMult?: number;         // Gold gain multiplier\n}\n\n// ---------------------------------------------------------------------------\n// Imprint Data (one per gate boss)\n// ---------------------------------------------------------------------------\n\nexport const IMPRINT_DEFS: ImprintDef[] = [\n  {\n    id: 'imprint_harvest_horror',\n    bossId: 'harvest_horror',\n    name: 'Nature\\'s Wrath',\n    description: '+15% damage, +1 HP/s regen. Haven enemies become aggressive.',\n    effects: { damageMult: 1.15, hpRegen: 1 },\n    aggroBiome: 'haven',\n    aggroMult: 1.5,\n    color: '#44ff44',\n    lore: 'The Horror\\'s primal fury courses through you. The forest knows.',\n  },\n  {\n    id: 'imprint_blight_mother',\n    bossId: 'blight_mother',\n    name: 'Spore Veil',\n    description: '+20% defense, -15% resolve drain. Rotwood enemies become aggressive.',\n    effects: { defenseMult: 1.2, resolveResist: 0.15 },\n    aggroBiome: 'rotwood',\n    aggroMult: 1.6,\n    color: '#88aa44',\n    lore: 'Decay is patient. You have absorbed the Mother\\'s endurance.',\n  },\n  {\n    id: 'imprint_stone_titan',\n    bossId: 'stone_titan',\n    name: 'Titan\\'s Fortitude',\n    description: '+40 max HP, +10 max stamina, -5% speed. Ashlands enemies become aggressive.',\n    effects: { maxHpAdd: 40, maxStaminaAdd: 10, speedMult: 0.95 },\n    aggroBiome: 'ashlands',\n    aggroMult: 1.5,\n    color: '#ff6600',\n    lore: 'Stone remembers. You carry the weight of the mountain itself.',\n  },\n  {\n    id: 'imprint_kraken',\n    bossId: 'kraken',\n    name: 'Depth\\'s Embrace',\n    description: '+20% speed, +5% crit. Drowned enemies become aggressive.',\n    effects: { speedMult: 1.2, critChanceAdd: 0.05 },\n    aggroBiome: 'drowned',\n    aggroMult: 1.7,\n    color: '#4488ff',\n    lore: 'The deep currents flow through you. Tides obey your movement.',\n  },\n  {\n    id: 'imprint_sand_wyrm',\n    bossId: 'sand_wyrm',\n    name: 'Burrower\\'s Instinct',\n    description: '+2 stamina/s regen, +15% XP. Bone Wastes enemies become aggressive.',\n    effects: { staminaRegen: 2, xpMult: 1.15 },\n    aggroBiome: 'bone',\n    aggroMult: 1.6,\n    color: '#ccaa44',\n    lore: 'The sands whisper. You sense what lies beneath.',\n  },\n  {\n    id: 'imprint_void_weaver',\n    bossId: 'void_weaver',\n    name: 'Void Sight',\n    description: '+25% damage, +20% gold. Void enemies become aggressive.',\n    effects: { damageMult: 1.25, goldMult: 1.2 },\n    aggroBiome: 'void',\n    aggroMult: 1.8,\n    color: '#aa44ff',\n    lore: 'You have glimpsed the space between spaces. Nothing is hidden.',\n  },\n  {\n    id: 'imprint_storm_lord',\n    bossId: 'storm_lord',\n    name: 'Tempest Crown',\n    description: '+10% all stats. Edilas enemies become aggressive.',\n    effects: { damageMult: 1.1, defenseMult: 1.1, speedMult: 1.1, xpMult: 1.1 },\n    aggroBiome: 'edilas',\n    aggroMult: 2.0,\n    color: '#ffdd44',\n    lore: 'Lightning answers to you now. The storm is yours to command.',\n  },\n  {\n    id: 'imprint_world_serpent',\n    bossId: 'world_serpent',\n    name: 'Serpent\\'s Cycle',\n    description: '+30% damage, +20% defense, +3 HP/s regen. All enemies more aggressive.',\n    effects: { damageMult: 1.3, defenseMult: 1.2, hpRegen: 3 },\n    aggroBiome: 'all',\n    aggroMult: 1.5,\n    color: '#ff4488',\n    lore: 'The cycle of the world flows through you. Creation and destruction are one.',\n  },\n];\n\nexport const IMPRINT_DB = new Map<string, ImprintDef>();\nfor (const imp of IMPRINT_DEFS) IMPRINT_DB.set(imp.id, imp);\n\n/** Map boss ID → imprint ID for lookup on kill */\nexport const BOSS_TO_IMPRINT = new Map<string, string>();\nfor (const imp of IMPRINT_DEFS) BOSS_TO_IMPRINT.set(imp.bossId, imp.id);\n\n// ---------------------------------------------------------------------------\n// Constants\n// ---------------------------------------------------------------------------\n\nconst MAX_ACTIVE_SLOTS = 3;\n\n// ---------------------------------------------------------------------------\n// Manager\n// ---------------------------------------------------------------------------\n\nexport class ImprintManager {\n  /** Imprints the player has unlocked (earned from boss kills) */\n  private unlocked: Set<string> = new Set();\n  /** Currently active imprint IDs (max 3) */\n  private active: string[] = [];\n\n  /** Callbacks */\n  private onUnlockCbs: Array<(imprintId: string) => void> = [];\n  private onEquipChangeCbs: Array<() => void> = [];\n\n  // ── Callbacks ──\n\n  onUnlock(cb: (imprintId: string) => void): void {\n    this.onUnlockCbs.push(cb);\n  }\n\n  onEquipChange(cb: () => void): void {\n    this.onEquipChangeCbs.push(cb);\n  }\n\n  // ── Unlock ──\n\n  /** Unlock an imprint (called when boss is defeated) */\n  unlockFromBoss(bossId: string): boolean {\n    const imprintId = BOSS_TO_IMPRINT.get(bossId);\n    if (!imprintId) return false;\n    if (this.unlocked.has(imprintId)) return false;\n\n    this.unlocked.add(imprintId);\n    for (const cb of this.onUnlockCbs) cb(imprintId);\n    return true;\n  }\n\n  /** Check if an imprint is unlocked */\n  isUnlocked(imprintId: string): boolean {\n    return this.unlocked.has(imprintId);\n  }\n\n  /** Get all unlocked imprint IDs */\n  getUnlocked(): string[] {\n    return Array.from(this.unlocked);\n  }\n\n  // ── Equip ──\n\n  /** Equip an imprint into an active slot */\n  equip(imprintId: string): boolean {\n    if (!this.unlocked.has(imprintId)) return false;\n    if (this.active.includes(imprintId)) return false;\n    if (this.active.length >= MAX_ACTIVE_SLOTS) return false;\n\n    this.active.push(imprintId);\n    for (const cb of this.onEquipChangeCbs) cb();\n    return true;\n  }\n\n  /** Unequip an imprint from active slots */\n  unequip(imprintId: string): boolean {\n    const idx = this.active.indexOf(imprintId);\n    if (idx === -1) return false;\n\n    this.active.splice(idx, 1);\n    for (const cb of this.onEquipChangeCbs) cb();\n    return true;\n  }\n\n  /** Get active imprint IDs */\n  getActive(): string[] {\n    return [...this.active];\n  }\n\n  /** Check if an imprint is active */\n  isActive(imprintId: string): boolean {\n    return this.active.includes(imprintId);\n  }\n\n  /** Get remaining slots */\n  getRemainingSlots(): number {\n    return MAX_ACTIVE_SLOTS - this.active.length;\n  }\n\n  // ── Combined Effects ──\n\n  /** Get combined effects of all active imprints */\n  getCombinedEffects(): ImprintEffects {\n    const combined: ImprintEffects = {};\n\n    for (const id of this.active) {\n      const def = IMPRINT_DB.get(id);\n      if (!def) continue;\n      const e = def.effects;\n\n      // Multiplicative\n      if (e.damageMult) combined.damageMult = (combined.damageMult ?? 1) * e.damageMult;\n      if (e.defenseMult) combined.defenseMult = (combined.defenseMult ?? 1) * e.defenseMult;\n      if (e.speedMult) combined.speedMult = (combined.speedMult ?? 1) * e.speedMult;\n      if (e.xpMult) combined.xpMult = (combined.xpMult ?? 1) * e.xpMult;\n      if (e.goldMult) combined.goldMult = (combined.goldMult ?? 1) * e.goldMult;\n      if (e.elementalDamageMult) combined.elementalDamageMult = (combined.elementalDamageMult ?? 1) * e.elementalDamageMult;\n\n      // Additive\n      if (e.maxHpAdd) combined.maxHpAdd = (combined.maxHpAdd ?? 0) + e.maxHpAdd;\n      if (e.maxStaminaAdd) combined.maxStaminaAdd = (combined.maxStaminaAdd ?? 0) + e.maxStaminaAdd;\n      if (e.critChanceAdd) combined.critChanceAdd = (combined.critChanceAdd ?? 0) + e.critChanceAdd;\n      if (e.hpRegen) combined.hpRegen = (combined.hpRegen ?? 0) + e.hpRegen;\n      if (e.staminaRegen) combined.staminaRegen = (combined.staminaRegen ?? 0) + e.staminaRegen;\n      if (e.resolveResist) combined.resolveResist = (combined.resolveResist ?? 0) + e.resolveResist;\n    }\n\n    return combined;\n  }\n\n  /** Get aggro multiplier for a biome based on active imprints */\n  getAggroMultForBiome(biome: string): number {\n    let mult = 1;\n    for (const id of this.active) {\n      const def = IMPRINT_DB.get(id);\n      if (!def) continue;\n      if (def.aggroBiome === biome || def.aggroBiome === 'all') {\n        mult *= def.aggroMult;\n      }\n    }\n    return mult;\n  }\n\n  /** Get all active imprint defs */\n  getActiveDefs(): ImprintDef[] {\n    return this.active\n      .map(id => IMPRINT_DB.get(id))\n      .filter((d): d is ImprintDef => d !== undefined);\n  }\n\n  // ── Persistence ──\n\n  serialize(): { unlocked: string[]; active: string[] } {\n    return {\n      unlocked: Array.from(this.unlocked),\n      active: [...this.active],\n    };\n  }\n\n  deserialize(data: { unlocked?: string[]; active?: string[] }): void {\n    this.unlocked = new Set(data.unlocked ?? []);\n    this.active = data.active ?? [];\n  }\n}\n","/**\n * EDILAS — Quirk Crystallization System (Darkest Dungeon Quirk-inspired)\n * Players accumulate behavioral quirks from repeated actions — fighting\n * in darkness, eating raw food, surviving near death, parrying often, etc.\n *\n * Quirks start unstable (instability decays toward 0 = quirk fades).\n * Spending a Memstone at a crafting station \"crystallizes\" a quirk,\n * making it permanent and unlocking a hidden bonus effect.\n *\n * Max 5 positive + 5 negative quirks. Quirks affect stats, behavior,\n * and companion morale.\n */\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport type QuirkPolarity = 'positive' | 'negative';\n\nexport interface QuirkDef {\n  id: string;\n  name: string;\n  description: string;\n  polarity: QuirkPolarity;\n  /** What behavior triggers this quirk */\n  trigger: BehaviorTag;\n  /** How many occurrences needed to acquire */\n  triggerThreshold: number;\n  /** Base stat modifier */\n  effects: QuirkEffects;\n  /** Bonus effect unlocked when crystallized */\n  crystallizedBonus: QuirkEffects;\n  /** Crystallized description */\n  crystallizedDescription: string;\n}\n\nexport type BehaviorTag =\n  | 'fight_in_dark'      // Kill enemies during night\n  | 'fight_in_corruption'// Kill enemies on corrupted tiles\n  | 'survive_low_hp'     // Survive below 20% HP for 10s+\n  | 'eat_raw_food'       // Consume uncooked food\n  | 'eat_cooked_food'    // Consume cooked food\n  | 'parry_often'        // Successfully parry attacks\n  | 'dodge_often'        // Successfully dodge attacks\n  | 'backstab_often'     // Land backstab kills\n  | 'take_many_hits'     // Get hit frequently (in a short window)\n  | 'explore_new_biome'  // Enter a new biome for the first time\n  | 'hoard_gold'         // Hold 5000+ gold\n  | 'use_no_items'       // Clear a dungeon without using items\n  | 'overkill'           // Deal 200%+ damage needed for a kill\n  | 'run_from_combat'    // Disengage from enemies by fleeing;\n\nexport interface QuirkEffects {\n  damageMult?: number;\n  defenseMult?: number;\n  speedMult?: number;\n  maxHpAdd?: number;\n  critChanceAdd?: number;\n  critMultAdd?: number;\n  resolveResist?: number;\n  xpMult?: number;\n  goldMult?: number;\n  dodgeChance?: number;\n  /** Special flag effects */\n  noFoodDecay?: boolean;     // Food doesn't spoil\n  nightVision?: boolean;     // Reduced darkness penalty\n  corruptionResist?: boolean;// Reduced corruption damage\n}\n\nexport interface ActiveQuirk {\n  defId: string;\n  /** Instability: 100 = fresh, decays toward 0. At 0 the quirk fades. */\n  instability: number;\n  crystallized: boolean;\n}\n\n// ---------------------------------------------------------------------------\n// Quirk Definitions\n// ---------------------------------------------------------------------------\n\nexport const QUIRK_DEFS: QuirkDef[] = [\n  // === Positive Quirks ===\n  {\n    id: 'quirk_night_hunter',\n    name: 'Night Hunter',\n    description: '+10% damage in darkness.',\n    polarity: 'positive',\n    trigger: 'fight_in_dark',\n    triggerThreshold: 15,\n    effects: { damageMult: 1.1 },\n    crystallizedBonus: { nightVision: true, critChanceAdd: 0.05 },\n    crystallizedDescription: 'Night vision + 5% crit in darkness.',\n  },\n  {\n    id: 'quirk_ironclad',\n    name: 'Ironclad',\n    description: '+10% defense.',\n    polarity: 'positive',\n    trigger: 'take_many_hits',\n    triggerThreshold: 50,\n    effects: { defenseMult: 1.1 },\n    crystallizedBonus: { maxHpAdd: 15 },\n    crystallizedDescription: '+15 max HP.',\n  },\n  {\n    id: 'quirk_blade_dancer',\n    name: 'Blade Dancer',\n    description: '+3% dodge chance.',\n    polarity: 'positive',\n    trigger: 'dodge_often',\n    triggerThreshold: 30,\n    effects: { dodgeChance: 0.03 },\n    crystallizedBonus: { speedMult: 1.1 },\n    crystallizedDescription: '+10% movement speed.',\n  },\n  {\n    id: 'quirk_shadow_striker',\n    name: 'Shadow Striker',\n    description: '+5% crit chance.',\n    polarity: 'positive',\n    trigger: 'backstab_often',\n    triggerThreshold: 20,\n    effects: { critChanceAdd: 0.05 },\n    crystallizedBonus: { critMultAdd: 0.2 },\n    crystallizedDescription: '+20% crit multiplier.',\n  },\n  {\n    id: 'quirk_deflector',\n    name: 'Deflector',\n    description: '+5% defense, +2% dodge.',\n    polarity: 'positive',\n    trigger: 'parry_often',\n    triggerThreshold: 25,\n    effects: { defenseMult: 1.05, dodgeChance: 0.02 },\n    crystallizedBonus: { damageMult: 1.05 },\n    crystallizedDescription: '+5% damage (parry mastery).',\n  },\n  {\n    id: 'quirk_gourmet',\n    name: 'Gourmet',\n    description: '+10% XP gain.',\n    polarity: 'positive',\n    trigger: 'eat_cooked_food',\n    triggerThreshold: 20,\n    effects: { xpMult: 1.1 },\n    crystallizedBonus: { maxHpAdd: 10 },\n    crystallizedDescription: '+10 max HP from well-nourished body.',\n  },\n  {\n    id: 'quirk_explorer',\n    name: 'Explorer',\n    description: '+10% speed, +10% gold.',\n    polarity: 'positive',\n    trigger: 'explore_new_biome',\n    triggerThreshold: 4,\n    effects: { speedMult: 1.1, goldMult: 1.1 },\n    crystallizedBonus: { xpMult: 1.1 },\n    crystallizedDescription: '+10% XP from worldly experience.',\n  },\n  {\n    id: 'quirk_last_stand',\n    name: 'Last Stand',\n    description: '+15% damage when below 30% HP.',\n    polarity: 'positive',\n    trigger: 'survive_low_hp',\n    triggerThreshold: 10,\n    effects: { damageMult: 1.15 },\n    crystallizedBonus: { resolveResist: 0.1 },\n    crystallizedDescription: '+10% resolve resistance from tempered will.',\n  },\n\n  // === Negative Quirks ===\n  {\n    id: 'quirk_corruption_touched',\n    name: 'Corruption Touched',\n    description: '-5% max HP.',\n    polarity: 'negative',\n    trigger: 'fight_in_corruption',\n    triggerThreshold: 20,\n    effects: { maxHpAdd: -10 },\n    crystallizedBonus: { corruptionResist: true, damageMult: 1.1 },\n    crystallizedDescription: 'Corruption resistance + 10% damage on corrupted tiles.',\n  },\n  {\n    id: 'quirk_savage_appetite',\n    name: 'Savage Appetite',\n    description: '-5% defense.',\n    polarity: 'negative',\n    trigger: 'eat_raw_food',\n    triggerThreshold: 10,\n    effects: { defenseMult: 0.95 },\n    crystallizedBonus: { noFoodDecay: true },\n    crystallizedDescription: 'Food never spoils (iron stomach).',\n  },\n  {\n    id: 'quirk_gold_fever',\n    name: 'Gold Fever',\n    description: '-5% speed.',\n    polarity: 'negative',\n    trigger: 'hoard_gold',\n    triggerThreshold: 3,\n    effects: { speedMult: 0.95 },\n    crystallizedBonus: { goldMult: 1.25 },\n    crystallizedDescription: '+25% gold from kills.',\n  },\n  {\n    id: 'quirk_reckless',\n    name: 'Reckless',\n    description: '-5% defense, +5% damage.',\n    polarity: 'negative',\n    trigger: 'overkill',\n    triggerThreshold: 20,\n    effects: { defenseMult: 0.95, damageMult: 1.05 },\n    crystallizedBonus: { critMultAdd: 0.3 },\n    crystallizedDescription: '+30% crit multiplier from unhinged fury.',\n  },\n  {\n    id: 'quirk_cowardly',\n    name: 'Cowardly',\n    description: '-10% damage.',\n    polarity: 'negative',\n    trigger: 'run_from_combat',\n    triggerThreshold: 10,\n    effects: { damageMult: 0.9 },\n    crystallizedBonus: { speedMult: 1.15, dodgeChance: 0.05 },\n    crystallizedDescription: '+15% speed, +5% dodge (tactical retreat mastery).',\n  },\n];\n\nexport const QUIRK_DB = new Map<string, QuirkDef>();\nfor (const q of QUIRK_DEFS) QUIRK_DB.set(q.id, q);\n\n// ---------------------------------------------------------------------------\n// Constants\n// ---------------------------------------------------------------------------\n\nconst MAX_POSITIVE_QUIRKS = 5;\nconst MAX_NEGATIVE_QUIRKS = 5;\nconst INSTABILITY_DECAY_PER_DAY = 15; // How much instability drops per in-game day\nconst MEMSTONE_ITEM_ID = 'memstone';\n\n// ---------------------------------------------------------------------------\n// Manager\n// ---------------------------------------------------------------------------\n\nexport class QuirkManager {\n  /** Active quirks */\n  private quirks: ActiveQuirk[] = [];\n  /** Behavior counters (reset when threshold met and quirk acquired) */\n  private behaviorCounters: Map<BehaviorTag, number> = new Map();\n\n  /** Callbacks */\n  private onQuirkGainedCbs: Array<(quirkId: string) => void> = [];\n  private onQuirkLostCbs: Array<(quirkId: string) => void> = [];\n  private onQuirkCrystallizedCbs: Array<(quirkId: string) => void> = [];\n\n  // ── Callbacks ──\n\n  onQuirkGained(cb: (quirkId: string) => void): void { this.onQuirkGainedCbs.push(cb); }\n  onQuirkLost(cb: (quirkId: string) => void): void { this.onQuirkLostCbs.push(cb); }\n  onQuirkCrystallized(cb: (quirkId: string) => void): void { this.onQuirkCrystallizedCbs.push(cb); }\n\n  // ── Behavior Recording ──\n\n  /** Record a behavior occurrence. May trigger quirk acquisition. */\n  recordBehavior(tag: BehaviorTag): void {\n    const current = (this.behaviorCounters.get(tag) ?? 0) + 1;\n    this.behaviorCounters.set(tag, current);\n\n    // Check if any quirk should be acquired\n    for (const def of QUIRK_DEFS) {\n      if (def.trigger !== tag) continue;\n      if (current < def.triggerThreshold) continue;\n      if (this.quirks.some(q => q.defId === def.id)) continue;\n\n      // Check slot limits\n      const polarityCount = this.quirks.filter(q => {\n        const d = QUIRK_DB.get(q.defId);\n        return d && d.polarity === def.polarity;\n      }).length;\n\n      const max = def.polarity === 'positive' ? MAX_POSITIVE_QUIRKS : MAX_NEGATIVE_QUIRKS;\n      if (polarityCount >= max) continue;\n\n      // Acquire the quirk\n      this.quirks.push({ defId: def.id, instability: 100, crystallized: false });\n      this.behaviorCounters.set(tag, 0); // Reset counter\n      for (const cb of this.onQuirkGainedCbs) cb(def.id);\n    }\n  }\n\n  // ── Day Cycle ──\n\n  /** Called once per in-game day. Decays non-crystallized quirk instability. */\n  advanceDay(): void {\n    for (let i = this.quirks.length - 1; i >= 0; i--) {\n      const quirk = this.quirks[i];\n      if (quirk.crystallized) continue;\n\n      quirk.instability -= INSTABILITY_DECAY_PER_DAY;\n      if (quirk.instability <= 0) {\n        const defId = quirk.defId;\n        this.quirks.splice(i, 1);\n        for (const cb of this.onQuirkLostCbs) cb(defId);\n      }\n    }\n  }\n\n  // ── Crystallize ──\n\n  /**\n   * Crystallize a quirk (make it permanent + unlock bonus).\n   * Requires Memstone item — caller should check inventory and remove it.\n   * Returns true if successful.\n   */\n  crystallize(quirkId: string): boolean {\n    const quirk = this.quirks.find(q => q.defId === quirkId);\n    if (!quirk || quirk.crystallized) return false;\n\n    quirk.crystallized = true;\n    quirk.instability = 100; // No longer matters, but kept at 100\n    for (const cb of this.onQuirkCrystallizedCbs) cb(quirkId);\n    return true;\n  }\n\n  // ── Queries ──\n\n  /** Get all active quirks */\n  getQuirks(): ActiveQuirk[] {\n    return [...this.quirks];\n  }\n\n  /** Get quirks by polarity */\n  getQuirksByPolarity(polarity: QuirkPolarity): ActiveQuirk[] {\n    return this.quirks.filter(q => {\n      const def = QUIRK_DB.get(q.defId);\n      return def && def.polarity === polarity;\n    });\n  }\n\n  /** Check if player has a specific quirk */\n  hasQuirk(quirkId: string): boolean {\n    return this.quirks.some(q => q.defId === quirkId);\n  }\n\n  /** Check if a quirk is crystallized */\n  isCrystallized(quirkId: string): boolean {\n    return this.quirks.some(q => q.defId === quirkId && q.crystallized);\n  }\n\n  /** Get combined effects of all active quirks */\n  getCombinedEffects(): QuirkEffects {\n    const combined: QuirkEffects = {};\n\n    for (const quirk of this.quirks) {\n      const def = QUIRK_DB.get(quirk.defId);\n      if (!def) continue;\n\n      // Apply base effects\n      this.mergeEffects(combined, def.effects);\n\n      // Apply crystallized bonus if crystallized\n      if (quirk.crystallized) {\n        this.mergeEffects(combined, def.crystallizedBonus);\n      }\n    }\n\n    return combined;\n  }\n\n  private mergeEffects(combined: QuirkEffects, e: QuirkEffects): void {\n    // Multiplicative\n    if (e.damageMult) combined.damageMult = (combined.damageMult ?? 1) * e.damageMult;\n    if (e.defenseMult) combined.defenseMult = (combined.defenseMult ?? 1) * e.defenseMult;\n    if (e.speedMult) combined.speedMult = (combined.speedMult ?? 1) * e.speedMult;\n    if (e.xpMult) combined.xpMult = (combined.xpMult ?? 1) * e.xpMult;\n    if (e.goldMult) combined.goldMult = (combined.goldMult ?? 1) * e.goldMult;\n\n    // Additive\n    if (e.maxHpAdd) combined.maxHpAdd = (combined.maxHpAdd ?? 0) + e.maxHpAdd;\n    if (e.critChanceAdd) combined.critChanceAdd = (combined.critChanceAdd ?? 0) + e.critChanceAdd;\n    if (e.critMultAdd) combined.critMultAdd = (combined.critMultAdd ?? 0) + e.critMultAdd;\n    if (e.resolveResist) combined.resolveResist = (combined.resolveResist ?? 0) + e.resolveResist;\n    if (e.dodgeChance) combined.dodgeChance = (combined.dodgeChance ?? 0) + e.dodgeChance;\n\n    // Flags\n    if (e.noFoodDecay) combined.noFoodDecay = true;\n    if (e.nightVision) combined.nightVision = true;\n    if (e.corruptionResist) combined.corruptionResist = true;\n  }\n\n  /** Get behavior counter for a tag */\n  getBehaviorCount(tag: BehaviorTag): number {\n    return this.behaviorCounters.get(tag) ?? 0;\n  }\n\n  /** Get the Memstone item ID (for UI display) */\n  getMemstoneItemId(): string {\n    return MEMSTONE_ITEM_ID;\n  }\n\n  // ── Persistence ──\n\n  serialize(): { quirks: ActiveQuirk[]; counters: [BehaviorTag, number][] } {\n    return {\n      quirks: this.quirks.map(q => ({ ...q })),\n      counters: Array.from(this.behaviorCounters.entries()),\n    };\n  }\n\n  deserialize(data: { quirks?: ActiveQuirk[]; counters?: [BehaviorTag, number][] }): void {\n    this.quirks = (data.quirks ?? []).map(q => ({ ...q }));\n    this.behaviorCounters.clear();\n    if (data.counters) {\n      for (const [tag, count] of data.counters) {\n        this.behaviorCounters.set(tag, count);\n      }\n    }\n  }\n}\n","/**\n * EDILAS — Weapon Echo System (Dead Cells Weapon Synergy + Hollow Knight Soul)\n * Each weapon tracks a rolling kill log. Landing kills with specific \"kill type\"\n * sequences (e.g., backstab → crit → crit) builds Echo charges.\n *\n * Spending an Echo charge releases a phantom strike — a burst of damage\n * replicating the combined power of the kill sequence. This rewards\n * consecutive skilled play and gives experienced players hidden burst output.\n *\n * Echo charges decay over time if combat pauses (15s timer).\n */\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport type KillTypeTag = 'normal' | 'backstab' | 'crit' | 'elemental' | 'parry_kill' | 'overkill';\n\nexport interface KillEntry {\n  killType: KillTypeTag;\n  damage: number;\n  timestamp: number;\n}\n\nexport interface EchoPattern {\n  id: string;\n  name: string;\n  /** Sequence of kill types required (in order) */\n  sequence: KillTypeTag[];\n  /** Damage multiplier for the phantom strike */\n  damageMult: number;\n  /** Description for UI */\n  description: string;\n  /** Visual color */\n  color: string;\n}\n\n// ---------------------------------------------------------------------------\n// Echo Patterns\n// ---------------------------------------------------------------------------\n\nexport const ECHO_PATTERNS: EchoPattern[] = [\n  {\n    id: 'echo_assassin',\n    name: 'Assassin\\'s Echo',\n    sequence: ['backstab', 'backstab'],\n    damageMult: 2.5,\n    description: 'Two backstab kills: phantom backstab strike.',\n    color: '#ff88ff',\n  },\n  {\n    id: 'echo_executioner',\n    name: 'Executioner\\'s Echo',\n    sequence: ['crit', 'crit', 'crit'],\n    damageMult: 3.0,\n    description: 'Three critical kills: devastating phantom strike.',\n    color: '#ffaa00',\n  },\n  {\n    id: 'echo_riposte',\n    name: 'Riposte Echo',\n    sequence: ['parry_kill', 'normal'],\n    damageMult: 2.0,\n    description: 'Parry kill then normal kill: retaliatory phantom strike.',\n    color: '#44aaff',\n  },\n  {\n    id: 'echo_elemental_surge',\n    name: 'Elemental Surge',\n    sequence: ['elemental', 'elemental'],\n    damageMult: 2.2,\n    description: 'Two elemental kills: phantom elemental burst.',\n    color: '#44ffaa',\n  },\n  {\n    id: 'echo_berserker',\n    name: 'Berserker\\'s Echo',\n    sequence: ['overkill', 'overkill'],\n    damageMult: 3.5,\n    description: 'Two overkills: massive phantom strike.',\n    color: '#ff2222',\n  },\n  {\n    id: 'echo_shadow_dance',\n    name: 'Shadow Dance',\n    sequence: ['backstab', 'crit'],\n    damageMult: 2.8,\n    description: 'Backstab then crit kill: shadowy phantom slash.',\n    color: '#cc44ff',\n  },\n  {\n    id: 'echo_perfect_chain',\n    name: 'Perfect Chain',\n    sequence: ['parry_kill', 'backstab', 'crit'],\n    damageMult: 4.0,\n    description: 'Parry → backstab → crit: ultimate phantom chain.',\n    color: '#ffffff',\n  },\n];\n\nconst ECHO_PATTERN_DB = new Map<string, EchoPattern>();\nfor (const p of ECHO_PATTERNS) ECHO_PATTERN_DB.set(p.id, p);\n\n// ---------------------------------------------------------------------------\n// Constants\n// ---------------------------------------------------------------------------\n\nconst MAX_KILL_LOG = 5;        // Rolling kill log size\nconst MAX_ECHO_CHARGES = 3;   // Max stored echo charges\nconst ECHO_DECAY_TIME = 15;   // Seconds before charges decay\nconst CHARGE_DECAY_RATE = 1;  // Charges lost per decay tick\n\n// ---------------------------------------------------------------------------\n// Manager\n// ---------------------------------------------------------------------------\n\nexport class WeaponEchoManager {\n  /** Rolling kill log (most recent at end) */\n  private killLog: KillEntry[] = [];\n  /** Current echo charges */\n  private echoCharges = 0;\n  /** Which pattern triggered the latest charge (for visual/SFX) */\n  private lastPatternId: string | null = null;\n  /** Decay timer (resets on kill, counts down in seconds) */\n  private decayTimer = 0;\n  /** Total damage stored in the echo (average of kill log damages) */\n  private storedDamage = 0;\n  /** Total echos released (for achievements) */\n  private totalEchosReleased = 0;\n\n  /** Callbacks */\n  private onEchoChargedCbs: Array<(patternId: string, charges: number) => void> = [];\n  private onEchoReleasedCbs: Array<(damage: number, patternId: string | null) => void> = [];\n\n  // ── Callbacks ──\n\n  onEchoCharged(cb: (patternId: string, charges: number) => void): void {\n    this.onEchoChargedCbs.push(cb);\n  }\n\n  onEchoReleased(cb: (damage: number, patternId: string | null) => void): void {\n    this.onEchoReleasedCbs.push(cb);\n  }\n\n  // ── Kill Recording ──\n\n  /**\n   * Record a kill. Pushes onto the rolling log, checks for pattern matches.\n   * @param killType What kind of kill it was\n   * @param damage How much damage the killing blow dealt\n   */\n  recordKill(killType: KillTypeTag, damage: number): void {\n    this.killLog.push({ killType, damage, timestamp: Date.now() });\n    if (this.killLog.length > MAX_KILL_LOG) {\n      this.killLog.shift();\n    }\n\n    // Reset decay timer on any kill\n    this.decayTimer = ECHO_DECAY_TIME;\n\n    // Check pattern matches against the tail of the kill log\n    this.checkPatterns();\n  }\n\n  private checkPatterns(): void {\n    for (const pattern of ECHO_PATTERNS) {\n      const seq = pattern.sequence;\n      if (this.killLog.length < seq.length) continue;\n\n      // Check if the last N entries match the pattern\n      const tail = this.killLog.slice(-seq.length);\n      let match = true;\n      for (let i = 0; i < seq.length; i++) {\n        if (tail[i].killType !== seq[i]) {\n          match = false;\n          break;\n        }\n      }\n\n      if (match && this.echoCharges < MAX_ECHO_CHARGES) {\n        this.echoCharges++;\n        this.lastPatternId = pattern.id;\n\n        // Store average damage from the matching kills\n        const totalDmg = tail.reduce((sum, k) => sum + k.damage, 0);\n        this.storedDamage = Math.round(totalDmg / tail.length);\n\n        for (const cb of this.onEchoChargedCbs) cb(pattern.id, this.echoCharges);\n\n        // Clear matched entries to prevent double-matching\n        this.killLog.splice(-seq.length);\n        break; // Only match one pattern per kill\n      }\n    }\n  }\n\n  // ── Echo Release ──\n\n  /**\n   * Release an echo charge. Returns the phantom strike damage, or 0 if no charges.\n   * Caller should apply this damage to nearby enemies.\n   */\n  releaseEcho(): number {\n    if (this.echoCharges <= 0) return 0;\n\n    const pattern = this.lastPatternId ? ECHO_PATTERN_DB.get(this.lastPatternId) : null;\n    const mult = pattern?.damageMult ?? 2.0;\n    const damage = Math.round(this.storedDamage * mult);\n\n    this.echoCharges--;\n    this.totalEchosReleased++;\n\n    for (const cb of this.onEchoReleasedCbs) cb(damage, this.lastPatternId);\n\n    if (this.echoCharges <= 0) {\n      this.lastPatternId = null;\n      this.storedDamage = 0;\n    }\n\n    return damage;\n  }\n\n  // ── Update ──\n\n  /** Called each frame. Handles echo charge decay. */\n  update(deltaSec: number): void {\n    if (this.echoCharges <= 0) return;\n\n    this.decayTimer -= deltaSec;\n    if (this.decayTimer <= 0) {\n      this.echoCharges = Math.max(0, this.echoCharges - CHARGE_DECAY_RATE);\n      if (this.echoCharges <= 0) {\n        this.lastPatternId = null;\n        this.storedDamage = 0;\n      }\n      this.decayTimer = ECHO_DECAY_TIME; // Reset for next decay tick\n    }\n  }\n\n  // ── Queries ──\n\n  /** Get current echo charge count */\n  getCharges(): number {\n    return this.echoCharges;\n  }\n\n  /** Get max echo charges */\n  getMaxCharges(): number {\n    return MAX_ECHO_CHARGES;\n  }\n\n  /** Get the last pattern that triggered a charge */\n  getLastPattern(): EchoPattern | null {\n    return this.lastPatternId ? ECHO_PATTERN_DB.get(this.lastPatternId) ?? null : null;\n  }\n\n  /** Get decay timer remaining */\n  getDecayTimer(): number {\n    return this.decayTimer;\n  }\n\n  /** Get stored damage amount */\n  getStoredDamage(): number {\n    return this.storedDamage;\n  }\n\n  /** Get kill log (for UI display) */\n  getKillLog(): KillEntry[] {\n    return [...this.killLog];\n  }\n\n  /** Get total echos released */\n  getTotalReleased(): number {\n    return this.totalEchosReleased;\n  }\n\n  // ── Persistence ──\n\n  serialize(): {\n    killLog: KillEntry[];\n    echoCharges: number;\n    lastPatternId: string | null;\n    storedDamage: number;\n    totalReleased: number;\n  } {\n    return {\n      killLog: [...this.killLog],\n      echoCharges: this.echoCharges,\n      lastPatternId: this.lastPatternId,\n      storedDamage: this.storedDamage,\n      totalReleased: this.totalEchosReleased,\n    };\n  }\n\n  deserialize(data: {\n    killLog?: KillEntry[];\n    echoCharges?: number;\n    lastPatternId?: string | null;\n    storedDamage?: number;\n    totalReleased?: number;\n  }): void {\n    this.killLog = data.killLog ?? [];\n    this.echoCharges = data.echoCharges ?? 0;\n    this.lastPatternId = data.lastPatternId ?? null;\n    this.storedDamage = data.storedDamage ?? 0;\n    this.totalEchosReleased = data.totalReleased ?? 0;\n    this.decayTimer = this.echoCharges > 0 ? ECHO_DECAY_TIME : 0;\n  }\n}\n","import Phaser from 'phaser';\nimport { Position, Velocity, AI, AIState } from '../ecs/components';\nimport { createNPC } from '../ecs/world';\nimport { NPCDef, NPCScheduleEntry } from '../data/npcs';\n\n/**\n * NPC entity controller — manages schedule-based movement,\n * interaction radius, and dialogue triggers.\n */\nexport class NPCController {\n  private eid: number;\n  private scene: Phaser.Scene;\n  private sprite: Phaser.GameObjects.Image;\n  private nameText: Phaser.GameObjects.Text;\n  private def: NPCDef;\n\n  // Schedule movement\n  private currentTarget: { x: number; y: number } | null = null;\n  private moveSpeed = 40; // pixels per second\n\n  // Interaction\n  private interactable = false;\n  private interactIcon: Phaser.GameObjects.Text | null = null;\n\n  constructor(scene: Phaser.Scene, def: NPCDef, startX: number, startY: number) {\n    this.scene = scene;\n    this.def = def;\n\n    // Create ECS entity\n    this.eid = createNPC(startX, startY, def.texture);\n\n    // Visual sprite\n    this.sprite = scene.add.image(startX, startY, def.texture);\n    this.sprite.setDepth(5000);\n\n    // Name label\n    this.nameText = scene.add.text(startX, startY - 24, def.name, {\n      fontFamily: 'monospace',\n      fontSize: '9px',\n      color: '#aaffaa',\n      stroke: '#000000',\n      strokeThickness: 1,\n    });\n    this.nameText.setOrigin(0.5);\n    this.nameText.setDepth(5001);\n  }\n\n  /** Update NPC each frame. Delta in seconds. */\n  update(delta: number, playerX: number, playerY: number, interactionRadius: number): void {\n    const eid = this.eid;\n\n    // Move toward schedule target\n    if (this.currentTarget) {\n      const px = Position.x[eid];\n      const py = Position.y[eid];\n      const dx = this.currentTarget.x - px;\n      const dy = this.currentTarget.y - py;\n      const dist = Math.sqrt(dx * dx + dy * dy);\n\n      if (dist > 4) {\n        const nx = dx / dist;\n        const ny = dy / dist;\n        Velocity.vx[eid] = nx * this.moveSpeed;\n        Velocity.vy[eid] = ny * this.moveSpeed;\n        this.sprite.setFlipX(nx < 0);\n      } else {\n        // Arrived\n        Velocity.vx[eid] = 0;\n        Velocity.vy[eid] = 0;\n        this.currentTarget = null;\n        AI.state[eid] = AIState.Idle;\n      }\n    } else {\n      Velocity.vx[eid] = 0;\n      Velocity.vy[eid] = 0;\n    }\n\n    // Sync sprite to ECS position\n    this.sprite.setPosition(Position.x[eid], Position.y[eid]);\n    this.nameText.setPosition(Position.x[eid], Position.y[eid] - 24);\n\n    // Check interaction range\n    const distToPlayer = Phaser.Math.Distance.Between(\n      Position.x[eid], Position.y[eid], playerX, playerY,\n    );\n    const wasInteractable = this.interactable;\n    this.interactable = distToPlayer <= interactionRadius;\n\n    if (this.interactable && !wasInteractable) {\n      this.showInteractIcon();\n    } else if (!this.interactable && wasInteractable) {\n      this.hideInteractIcon();\n    }\n\n    if (this.interactIcon) {\n      this.interactIcon.setPosition(Position.x[eid], Position.y[eid] - 36);\n    }\n  }\n\n  /** Update NPC schedule based on current time and season */\n  updateSchedule(hour: number, season: string): void {\n    const schedule = this.def.schedule[season.toLowerCase()]\n      ?? this.def.schedule['spring']\n      ?? [];\n\n    // Find the schedule entry for the current hour\n    // Use the most recent entry that's <= current hour\n    let best: NPCScheduleEntry | null = null;\n    for (const entry of schedule) {\n      if (entry.hour <= hour) {\n        if (!best || entry.hour > best.hour) {\n          best = entry;\n        }\n      }\n    }\n\n    if (best) {\n      this.currentTarget = { x: best.x, y: best.y };\n      AI.state[this.eid] = AIState.Patrol;\n    }\n  }\n\n  /** Check if player can interact right now */\n  isInteractable(): boolean {\n    return this.interactable;\n  }\n\n  /** Get the NPC definition */\n  getDef(): NPCDef {\n    return this.def;\n  }\n\n  /** Get NPC ID */\n  getId(): string {\n    return this.def.id;\n  }\n\n  /** Get ECS entity ID */\n  getEid(): number {\n    return this.eid;\n  }\n\n  /** Get position */\n  getPosition(): { x: number; y: number } {\n    return { x: Position.x[this.eid], y: Position.y[this.eid] };\n  }\n\n  /** Whether NPC has a shop */\n  hasShop(): boolean {\n    return !!this.def.shop;\n  }\n\n  /** Get shop items and prices */\n  getShop(): { items: string[]; priceMultiplier: number } | null {\n    return this.def.shop ?? null;\n  }\n\n  private showInteractIcon(): void {\n    if (this.interactIcon) return;\n    this.interactIcon = this.scene.add.text(0, 0, '[E]', {\n      fontFamily: 'monospace',\n      fontSize: '10px',\n      color: '#ffff00',\n      stroke: '#000000',\n      strokeThickness: 2,\n    });\n    this.interactIcon.setOrigin(0.5);\n    this.interactIcon.setDepth(5002);\n  }\n\n  private hideInteractIcon(): void {\n    if (this.interactIcon) {\n      this.interactIcon.destroy();\n      this.interactIcon = null;\n    }\n  }\n\n  destroy(): void {\n    this.sprite.destroy();\n    this.nameText.destroy();\n    this.hideInteractIcon();\n  }\n}\n\n/**\n * Manages all NPCs in the overworld — spawning, schedule updates, interaction.\n */\nexport class NPCManager {\n  private npcs: Map<string, NPCController> = new Map();\n  private scene: Phaser.Scene;\n  private lastHour = -1;\n\n  constructor(scene: Phaser.Scene) {\n    this.scene = scene;\n  }\n\n  /** Spawn an NPC from their definition */\n  spawnNPC(def: NPCDef, x: number, y: number): NPCController {\n    const controller = new NPCController(this.scene, def, x, y);\n    this.npcs.set(def.id, controller);\n    return controller;\n  }\n\n  /** Update all NPCs */\n  update(delta: number, playerX: number, playerY: number, interactionRadius: number): void {\n    for (const npc of this.npcs.values()) {\n      npc.update(delta, playerX, playerY, interactionRadius);\n    }\n  }\n\n  /** Update schedules when hour changes */\n  updateSchedules(hour: number, season: string): void {\n    if (hour === this.lastHour) return;\n    this.lastHour = hour;\n    for (const npc of this.npcs.values()) {\n      npc.updateSchedule(hour, season);\n    }\n  }\n\n  /** Get the NPC the player can interact with (closest interactable) */\n  getInteractableNPC(): NPCController | null {\n    for (const npc of this.npcs.values()) {\n      if (npc.isInteractable()) return npc;\n    }\n    return null;\n  }\n\n  /** Get NPC by ID */\n  getNPC(id: string): NPCController | null {\n    return this.npcs.get(id) ?? null;\n  }\n\n  /** Get all NPC IDs */\n  getAllIds(): string[] {\n    return Array.from(this.npcs.keys());\n  }\n\n  destroy(): void {\n    for (const npc of this.npcs.values()) {\n      npc.destroy();\n    }\n    this.npcs.clear();\n  }\n}\n","/**\n * EDILAS Phaser - City Definitions\n * All 12 cities ported from the original EDILAS project\n */\n\n// ---------------------------------------------------------------------------\n// Interfaces\n// ---------------------------------------------------------------------------\n\nexport interface CityBuilding {\n  id: string;\n  name: string;\n  type:\n    | 'shop'\n    | 'inn'\n    | 'blacksmith'\n    | 'guild'\n    | 'temple'\n    | 'library'\n    | 'tavern'\n    | 'market'\n    | 'house'\n    | 'farm'\n    | 'dock'\n    | 'other';\n  services: string[];\n}\n\nexport interface CityDef {\n  id: string;\n  name: string;\n  description: string;\n  biome: string;\n  population: number;\n  x: number;\n  y: number;\n  buildings: CityBuilding[];\n  shops: { shopId: string; items: string[] }[];\n  npcs: string[];\n  unlockCondition?: string;\n  hasDungeon: boolean;\n  dungeonId?: string;\n  hasRiftPortal: boolean;\n}\n\n// ---------------------------------------------------------------------------\n// City Data - 12 Cities\n// ---------------------------------------------------------------------------\n\nexport const CITIES: CityDef[] = [\n  // =========================================================================\n  // 1. HAVEN  -  Starting safe-zone town (always discovered)\n  // =========================================================================\n  {\n    id: 'haven',\n    name: 'Haven',\n    description: 'The last safe refuge in a world overrun by darkness.',\n    biome: 'plains',\n    population: 25,\n    x: 0,\n    y: 0,\n    buildings: [\n      {\n        id: 'house',\n        name: 'Player House',\n        type: 'house',\n        services: ['bed', 'storage'],\n      },\n      {\n        id: 'guild_hall',\n        name: \"Adventurer's Guild\",\n        type: 'guild',\n        services: ['quests', 'bounties', 'training'],\n      },\n      {\n        id: 'blacksmith',\n        name: \"Garrett's Forge\",\n        type: 'blacksmith',\n        services: ['repair', 'upgrade', 'smelt'],\n      },\n      {\n        id: 'tavern',\n        name: 'The Rusty Tankard',\n        type: 'tavern',\n        services: ['bed', 'food', 'drink', 'socialize'],\n      },\n      {\n        id: 'general_store',\n        name: \"Martha's General Store\",\n        type: 'shop',\n        services: ['buy', 'sell'],\n      },\n      {\n        id: 'farm_stand',\n        name: 'Farm Stand',\n        type: 'farm',\n        services: ['buy_seeds', 'sell_crops'],\n      },\n      {\n        id: 'clinic',\n        name: \"Dr. Elena's Clinic\",\n        type: 'other',\n        services: ['heal', 'cure_status'],\n      },\n      {\n        id: 'pet_shop',\n        name: \"Penny's Pet Paradise\",\n        type: 'shop',\n        services: ['buy_pets', 'pet_care'],\n      },\n      {\n        id: 'wizard_tower',\n        name: \"Eldric's Tower\",\n        type: 'library',\n        services: ['enchant', 'research'],\n      },\n    ],\n    shops: [\n      {\n        shopId: 'general_store',\n        items: [\n          'parsnip_seeds',\n          'potato_seeds',\n          'cauliflower_seeds',\n          'tomato_seeds',\n          'melon_seeds',\n          'corn_seeds',\n          'wheat_seeds',\n          'hot_pepper_seeds',\n          'hops_starter',\n          'pumpkin_seeds',\n          'grape_starter',\n          'carrot_seeds',\n          'bread',\n          'apple',\n          'fishing_rod',\n          'hay',\n        ],\n      },\n      {\n        shopId: 'blacksmith',\n        items: [\n          'pickaxe',\n          'axe',\n          'hoe',\n          'watering_can',\n          'sword',\n          'iron_sword',\n          'steel_sword',\n          'battle_axe',\n          'iron_battle_axe',\n          'leather_armor',\n          'leather_cap',\n          'chainmail',\n          'iron_helm',\n          'iron_ring',\n        ],\n      },\n      {\n        shopId: 'tavern',\n        items: [\n          'bread',\n          'ale',\n          'mead',\n          'wine',\n          'cider',\n          'cooked_fish',\n          'vegetable_soup',\n        ],\n      },\n      {\n        shopId: 'adventurer_guild',\n        items: [\n          'sword',\n          'dagger',\n          'iron_spear',\n          'hunting_bow',\n          'oak_staff',\n          'health_potion',\n          'stamina_potion',\n          'bomb',\n          'leather_armor',\n          'leather_cap',\n        ],\n      },\n      {\n        shopId: 'pet_shop',\n        items: ['dog', 'cat', 'parrot', 'owl', 'fox'],\n      },\n      {\n        shopId: 'ranch',\n        items: [\n          'hay',\n          'chicken',\n          'duck',\n          'rabbit',\n          'cow',\n          'goat',\n          'sheep',\n          'pig',\n          'horse',\n        ],\n      },\n    ],\n    npcs: [\n      'mayor',\n      'shopkeeper',\n      'blacksmith',\n      'farmer_girl',\n      'innkeeper',\n      'wizard',\n      'adventurer',\n      'doctor',\n      'pet_seller',\n    ],\n    hasDungeon: false,\n    hasRiftPortal: false,\n  },\n\n  // =========================================================================\n  // 2. IRONHOLD  -  Mining fortress in the mountains\n  // =========================================================================\n  {\n    id: 'ironhold',\n    name: 'Ironhold',\n    description: 'A mining fortress carved into the mountain.',\n    biome: 'mountain',\n    population: 15,\n    x: 2500,\n    y: -2000,\n    buildings: [\n      {\n        id: 'forge',\n        name: 'Ironhold Forge',\n        type: 'blacksmith',\n        services: ['smelt', 'repair', 'upgrade'],\n      },\n      {\n        id: 'mine_entrance',\n        name: 'Mine Entrance',\n        type: 'other',\n        services: ['mining', 'exploration'],\n      },\n      {\n        id: 'ore_depot',\n        name: 'Ore Depot',\n        type: 'market',\n        services: ['buy_ore', 'sell_ore', 'storage'],\n      },\n    ],\n    shops: [\n      {\n        shopId: 'blacksmith',\n        items: [\n          'pickaxe',\n          'iron_pickaxe',\n          'copper_bar',\n          'iron_bar',\n          'gold_bar',\n          'coal',\n        ],\n      },\n      {\n        shopId: 'ore_trader',\n        items: [\n          'copper_ore',\n          'iron_ore',\n          'gold_ore',\n          'iridium_ore',\n          'coal',\n          'stone',\n        ],\n      },\n    ],\n    npcs: ['ironhold_forgemaster', 'ironhold_miner', 'ironhold_trader'],\n    unlockCondition: 'explore_distance_2000',\n    hasDungeon: true,\n    dungeonId: 'ironhold_mines',\n    hasRiftPortal: false,\n  },\n\n  // =========================================================================\n  // 3. VERDANT REST  -  Hidden forest herbalist sanctuary\n  // =========================================================================\n  {\n    id: 'verdant_rest',\n    name: 'Verdant Rest',\n    description: 'A hidden sanctuary in the deep forest.',\n    biome: 'forest',\n    population: 10,\n    x: -2200,\n    y: -1500,\n    buildings: [\n      {\n        id: 'greenhouse',\n        name: 'Enchanted Greenhouse',\n        type: 'farm',\n        services: ['grow_herbs', 'rare_seeds'],\n      },\n      {\n        id: 'apothecary',\n        name: 'Apothecary',\n        type: 'shop',\n        services: ['buy_potions', 'sell_herbs', 'brew'],\n      },\n      {\n        id: 'druid_grove',\n        name: 'Druid Grove',\n        type: 'temple',\n        services: ['nature_blessing', 'heal', 'purify'],\n      },\n    ],\n    shops: [\n      {\n        shopId: 'herbalist',\n        items: [\n          'fiber',\n          'mixed_seeds',\n          'health_potion',\n          'stamina_potion',\n          'rare_herb',\n          'antidote',\n        ],\n      },\n      {\n        shopId: 'potion_shop',\n        items: [\n          'health_potion',\n          'stamina_potion',\n          'speed_potion',\n          'defense_potion',\n          'luck_potion',\n        ],\n      },\n    ],\n    npcs: ['verdant_herbalist', 'verdant_druid', 'verdant_alchemist'],\n    unlockCondition: 'quest_find_verdant',\n    hasDungeon: false,\n    hasRiftPortal: false,\n  },\n\n  // =========================================================================\n  // 4. GRIMWATCH  -  Military outpost on corrupted border\n  // =========================================================================\n  {\n    id: 'grimwatch',\n    name: 'Grimwatch',\n    description: 'A military outpost on the edge of corrupted lands.',\n    biome: 'wasteland',\n    population: 20,\n    x: 1800,\n    y: 2200,\n    buildings: [\n      {\n        id: 'barracks',\n        name: 'Barracks',\n        type: 'guild',\n        services: ['rest', 'recruit', 'training'],\n      },\n      {\n        id: 'armory',\n        name: 'Armory',\n        type: 'blacksmith',\n        services: ['buy_weapons', 'buy_armor', 'repair'],\n      },\n      {\n        id: 'training_grounds',\n        name: 'Training Grounds',\n        type: 'other',\n        services: ['combat_training', 'sparring'],\n      },\n      {\n        id: 'bounty_board',\n        name: 'Bounty Board',\n        type: 'guild',\n        services: ['bounties', 'monster_hunts'],\n      },\n    ],\n    shops: [\n      {\n        shopId: 'weapon_master',\n        items: [\n          'iron_sword',\n          'steel_sword',\n          'iron_battle_axe',\n          'iron_spear',\n          'hunting_bow',\n          'war_hammer',\n        ],\n      },\n      {\n        shopId: 'armor_smith',\n        items: [\n          'chainmail',\n          'iron_helm',\n          'iron_shield',\n          'steel_armor',\n          'steel_helm',\n          'iron_ring',\n        ],\n      },\n      {\n        shopId: 'bounty_office',\n        items: ['health_potion', 'stamina_potion', 'bomb', 'trap', 'antidote'],\n      },\n    ],\n    npcs: [\n      'grimwatch_commander',\n      'grimwatch_weaponmaster',\n      'grimwatch_armorsmith',\n      'grimwatch_bounty_hunter',\n    ],\n    unlockCondition: 'combat_level_5',\n    hasDungeon: true,\n    dungeonId: 'corrupted_wastes',\n    hasRiftPortal: false,\n  },\n\n  // =========================================================================\n  // 5. PORT DUSKFALL  -  Coastal trading hub in eternal twilight\n  // =========================================================================\n  {\n    id: 'port_duskfall',\n    name: 'Port Duskfall',\n    description: 'A coastal trading hub shrouded in eternal twilight.',\n    biome: 'coastal',\n    population: 30,\n    x: -1500,\n    y: 2500,\n    buildings: [\n      {\n        id: 'dock',\n        name: 'Main Dock',\n        type: 'dock',\n        services: ['ferry', 'fishing', 'ship_repair'],\n      },\n      {\n        id: 'warehouse',\n        name: 'Warehouse',\n        type: 'market',\n        services: ['storage', 'bulk_trade'],\n      },\n      {\n        id: 'traders_guild',\n        name: \"Trader's Guild\",\n        type: 'guild',\n        services: ['trade_routes', 'price_info', 'contracts'],\n      },\n      {\n        id: 'lighthouse',\n        name: 'Lighthouse',\n        type: 'other',\n        services: ['navigation', 'weather_forecast'],\n      },\n    ],\n    shops: [\n      {\n        shopId: 'fish_market',\n        items: [\n          'sardine',\n          'anchovy',\n          'carp',\n          'salmon',\n          'rainbow_trout',\n          'walleye',\n          'sturgeon',\n          'bait',\n          'bobber',\n        ],\n      },\n      {\n        shopId: 'exotic_goods',\n        items: [\n          'coconut',\n          'cactus_fruit',\n          'exotic_spice',\n          'pearl',\n          'coral',\n          'ancient_artifact',\n        ],\n      },\n      {\n        shopId: 'ship_supplies',\n        items: [\n          'rope',\n          'fishing_rod',\n          'bait',\n          'lantern',\n          'compass',\n          'health_potion',\n        ],\n      },\n    ],\n    npcs: [\n      'duskfall_harbormaster',\n      'duskfall_fish_merchant',\n      'duskfall_exotic_trader',\n      'duskfall_ferryman',\n    ],\n    unlockCondition: 'explore_biome_coastal',\n    hasDungeon: false,\n    hasRiftPortal: false,\n  },\n\n  // =========================================================================\n  // 6. SANCTUARY  -  Hidden temple where the light still shines\n  // =========================================================================\n  {\n    id: 'sanctuary',\n    name: 'Sanctuary',\n    description: 'A hidden temple where the light still shines.',\n    biome: 'sacred',\n    population: 12,\n    x: 0,\n    y: -3500,\n    buildings: [\n      {\n        id: 'temple',\n        name: 'Temple of Light',\n        type: 'temple',\n        services: ['blessing', 'purification', 'resurrection', 'prayer'],\n      },\n      {\n        id: 'meditation_garden',\n        name: 'Meditation Garden',\n        type: 'other',\n        services: ['meditate', 'restore_mana', 'inner_peace'],\n      },\n      {\n        id: 'relic_vault',\n        name: 'Relic Vault',\n        type: 'library',\n        services: ['store_relics', 'identify_artifacts', 'lore'],\n      },\n    ],\n    shops: [\n      {\n        shopId: 'blessed_items',\n        items: [\n          'light_fragment',\n          'holy_water',\n          'blessed_shield',\n          'sacred_amulet',\n          'purification_scroll',\n        ],\n      },\n      {\n        shopId: 'artifact_keeper',\n        items: [\n          'ancient_artifact',\n          'relic_fragment',\n          'enchanted_tome',\n          'crystal_orb',\n        ],\n      },\n    ],\n    npcs: [\n      'sanctuary_high_priest',\n      'sanctuary_relic_keeper',\n      'sanctuary_monk',\n    ],\n    unlockCondition: 'artifact_light_fragment',\n    hasDungeon: false,\n    hasRiftPortal: false,\n  },\n\n  // =========================================================================\n  // 7. VOID DIMENSION ACCESS  -  Legendary rift between worlds\n  // =========================================================================\n  {\n    id: 'void_dimension_access',\n    name: 'The Void Dimension',\n    description:\n      'A rift between worlds where shadow and light intertwine. Only the Voidwalker may enter.',\n    biome: 'void',\n    population: 3,\n    x: 4000,\n    y: -4000,\n    buildings: [\n      {\n        id: 'void_portal',\n        name: 'Void Portal',\n        type: 'other',\n        services: ['dimensional_travel', 'void_rift'],\n      },\n      {\n        id: 'shadow_forge',\n        name: 'Shadow Forge',\n        type: 'blacksmith',\n        services: ['void_enhancement', 'shadow_binding', 'dark_smithing'],\n      },\n      {\n        id: 'void_merchant_building',\n        name: 'Void Merchant Enclave',\n        type: 'shop',\n        services: ['buy', 'sell', 'void_trade'],\n      },\n    ],\n    shops: [\n      {\n        shopId: 'void_trader',\n        items: [\n          'void_essence',\n          'shadow_blade',\n          'void_shard',\n          'dark_crystal',\n          'dimensional_key',\n          'void_armor',\n        ],\n      },\n    ],\n    npcs: ['void_merchant', 'void_guardian', 'shadow_smith'],\n    unlockCondition: 'quest_legend_of_the_void',\n    hasDungeon: true,\n    dungeonId: 'void_dimension',\n    hasRiftPortal: true,\n  },\n\n  // =========================================================================\n  // 8. ANCIENT GREENHOUSE  -  Mystical year-round farming haven\n  // =========================================================================\n  {\n    id: 'ancient_greenhouse',\n    name: 'Ancient Greenhouse',\n    description:\n      'A mystical greenhouse where ancient crops grow year-round, untouched by the seasons.',\n    biome: 'enchanted',\n    population: 5,\n    x: 500,\n    y: -1000,\n    buildings: [\n      {\n        id: 'ancient_greenhouse_building',\n        name: 'Ancient Greenhouse',\n        type: 'farm',\n        services: ['year_round_growing', 'crop_enhancement', 'rare_planting'],\n      },\n      {\n        id: 'seed_vault',\n        name: 'Seed Vault',\n        type: 'shop',\n        services: ['buy_rare_seeds', 'seed_exchange'],\n      },\n      {\n        id: 'alchemist_garden',\n        name: 'Alchemist Garden',\n        type: 'other',\n        services: ['herb_growing', 'potion_brewing', 'crop_mutation'],\n      },\n    ],\n    shops: [\n      {\n        shopId: 'rare_seeds',\n        items: [\n          'ancient_fruit_seeds',\n          'starfruit_seeds',\n          'sweet_gem_berry_seeds',\n          'rare_herb_seeds',\n          'crystal_flower_seeds',\n          'void_root_seeds',\n        ],\n      },\n    ],\n    npcs: ['greenhouse_keeper', 'seed_archivist', 'crop_alchemist'],\n    unlockCondition: 'quest_the_ancient_fruit',\n    hasDungeon: false,\n    hasRiftPortal: false,\n  },\n\n  // =========================================================================\n  // 9. OCEAN TEMPLE  -  Risen underwater temple of the deep\n  // =========================================================================\n  {\n    id: 'ocean_temple',\n    name: 'Ocean Temple',\n    description:\n      'An ancient underwater temple risen from the depths, home to treasures of the deep.',\n    biome: 'ocean',\n    population: 8,\n    x: -3000,\n    y: 4000,\n    buildings: [\n      {\n        id: 'coral_hall',\n        name: 'Coral Hall',\n        type: 'guild',\n        services: ['deep_sea_quests', 'fishing_mastery', 'ocean_lore'],\n      },\n      {\n        id: 'treasure_vault',\n        name: 'Treasure Vault',\n        type: 'market',\n        services: ['store_treasure', 'appraise', 'trade_pearls'],\n      },\n      {\n        id: 'neptune_shrine',\n        name: 'Neptune Shrine',\n        type: 'temple',\n        services: ['enchanted_fishing', 'deep_dive', 'ocean_blessing'],\n      },\n    ],\n    shops: [\n      {\n        shopId: 'deep_sea_trader',\n        items: [\n          'pearl',\n          'coral',\n          'trident',\n          'diving_helm',\n          'ocean_amulet',\n          'deep_sea_bait',\n        ],\n      },\n      {\n        shopId: 'pearl_merchant',\n        items: [\n          'pearl',\n          'black_pearl',\n          'golden_pearl',\n          'pearl_necklace',\n          'pearl_ring',\n        ],\n      },\n    ],\n    npcs: [\n      'ocean_temple_guardian',\n      'deep_sea_trader_npc',\n      'pearl_merchant_npc',\n      'neptune_priest',\n    ],\n    unlockCondition: 'quest_king_of_the_sea',\n    hasDungeon: true,\n    dungeonId: 'ocean_depths',\n    hasRiftPortal: false,\n  },\n\n  // =========================================================================\n  // 10. DRAGON'S LAIR  -  Conquered lair turned fortress\n  // =========================================================================\n  {\n    id: 'dragon_lair_home',\n    name: \"Dragon's Lair\",\n    description:\n      'The conquered lair of the ancient dragon, now a fortress for the Dragon Slayer.',\n    biome: 'volcanic',\n    population: 6,\n    x: 5000,\n    y: 3000,\n    buildings: [\n      {\n        id: 'dragon_throne',\n        name: 'Dragon Throne',\n        type: 'house',\n        services: ['rest', 'trophy_display', 'command'],\n      },\n      {\n        id: 'hoard_vault',\n        name: 'Hoard Vault',\n        type: 'market',\n        services: ['storage', 'treasure_sorting', 'appraise'],\n      },\n      {\n        id: 'drake_stables',\n        name: 'Drake Stables',\n        type: 'other',\n        services: ['dragon_mount', 'drake_breeding', 'fire_training'],\n      },\n    ],\n    shops: [\n      {\n        shopId: 'dragon_forge',\n        items: [\n          'dragon_scale_armor',\n          'dragon_bone_sword',\n          'fire_enchant_scroll',\n          'dragon_helm',\n          'inferno_ring',\n        ],\n      },\n      {\n        shopId: 'scale_merchant',\n        items: [\n          'dragon_scale',\n          'dragon_bone',\n          'dragon_fang',\n          'fire_ruby',\n          'volcanic_ore',\n        ],\n      },\n    ],\n    npcs: [\n      'dragon_lair_smith',\n      'dragon_lair_scale_merchant',\n      'dragon_lair_stablemaster',\n    ],\n    unlockCondition: 'quest_dragon_slayer',\n    hasDungeon: true,\n    dungeonId: 'dragon_lair_dungeon',\n    hasRiftPortal: false,\n  },\n\n  // =========================================================================\n  // 11. MOVIE THEATER  -  Restored entertainment venue\n  // =========================================================================\n  {\n    id: 'movie_theater',\n    name: 'Movie Theater',\n    description:\n      'A restored entertainment venue where villagers gather to watch shows and socialize.',\n    biome: 'plains',\n    population: 10,\n    x: 800,\n    y: 400,\n    buildings: [\n      {\n        id: 'theater_hall',\n        name: 'Theater Hall',\n        type: 'other',\n        services: ['movie_showing', 'date_spot', 'performances'],\n      },\n      {\n        id: 'concession_stand',\n        name: 'Concession Stand',\n        type: 'shop',\n        services: ['buy_snacks', 'buy_drinks'],\n      },\n      {\n        id: 'arcade',\n        name: 'Arcade',\n        type: 'other',\n        services: ['mini_games', 'prizes', 'high_scores'],\n      },\n    ],\n    shops: [\n      {\n        shopId: 'snack_bar',\n        items: [\n          'popcorn',\n          'candy',\n          'soda',\n          'nachos',\n          'ice_cream',\n          'cotton_candy',\n        ],\n      },\n    ],\n    npcs: ['theater_owner', 'concession_worker', 'arcade_attendant'],\n    unlockCondition: 'quest_community_restoration',\n    hasDungeon: false,\n    hasRiftPortal: false,\n  },\n\n  // =========================================================================\n  // 12. DESERT BUS STOP  -  Transport hub connecting to Calico Desert\n  // =========================================================================\n  {\n    id: 'bus_repair',\n    name: 'Desert Bus Stop',\n    description:\n      'The repaired bus line connecting the valley to the Calico Desert.',\n    biome: 'desert',\n    population: 8,\n    x: 3000,\n    y: 0,\n    buildings: [\n      {\n        id: 'bus_stop',\n        name: 'Bus Stop',\n        type: 'other',\n        services: ['bus_transport', 'schedule_info'],\n      },\n      {\n        id: 'desert_outpost',\n        name: 'Desert Outpost',\n        type: 'shop',\n        services: ['buy', 'sell', 'desert_guide'],\n      },\n      {\n        id: 'oasis_well',\n        name: 'Oasis Well',\n        type: 'other',\n        services: ['water_refill', 'rest', 'cool_down'],\n      },\n    ],\n    shops: [\n      {\n        shopId: 'desert_trader',\n        items: [\n          'cactus_fruit',\n          'coconut',\n          'desert_totem',\n          'sandstone',\n          'sun_amulet',\n          'heat_potion',\n        ],\n      },\n      {\n        shopId: 'cactus_merchant',\n        items: [\n          'cactus_fruit',\n          'cactus_seeds',\n          'aloe_vera',\n          'desert_flower',\n          'sand_dollar',\n        ],\n      },\n    ],\n    npcs: ['desert_bus_driver', 'desert_trader_npc', 'cactus_merchant_npc'],\n    unlockCondition: 'quest_community_restoration',\n    hasDungeon: false,\n    hasRiftPortal: false,\n  },\n];\n\n// ---------------------------------------------------------------------------\n// Lookup Map\n// ---------------------------------------------------------------------------\n\nexport const CITY_DB = new Map<string, CityDef>(\n  CITIES.map((c) => [c.id, c]),\n);\n","import Phaser from 'phaser';\nimport { defineQuery, hasComponent } from 'bitecs';\nimport { ChunkManager } from '../world/ChunkManager';\nimport { IsometricHelper } from '../world/IsometricHelper';\nimport { TileType, ObjectType, OBJECT_PROPERTIES, OBJECT_DROPS } from '../world/TileRegistry';\nimport { BIOME_DEFS } from '../world/BiomeGenerator';\nimport { ecsWorld, createPlayer, createEnemy } from '../ecs/world';\nimport { Position, Health, Stamina, Combat, Velocity, EnemyTag, PlayerTag, Sprite as ECSSprite, AI, AIState, AIBehavior, WeaponType, SynergyStatus, EliteAffix } from '../ecs/components';\nimport { movementSystem } from '../ecs/systems/MovementSystem';\nimport { animationSystem } from '../ecs/systems/AnimationSystem';\nimport { aiSystem } from '../ecs/systems/AISystem';\nimport { combatSystem, flushDamageEvents, requestPlayerAttack, ComboTracker, grantIFrames, flushParryEvents, setSwordMasteryLevel, isRiposteActive, setExternalDamageMult } from '../ecs/systems/CombatSystem';\nimport { projectileSystem } from '../ecs/systems/ProjectileSystem';\nimport { spawnSystem, resetSpawnedChunks } from '../ecs/systems/SpawnSystem';\nimport { lootSystem, flushLootEvents, LootEvent } from '../ecs/systems/LootSystem';\nimport { PlayerController } from '../entities/Player';\nimport { BIOME_ENEMY_SPRITE } from '../entities/Enemy';\nimport { AssetManager } from '../assets/AssetManager';\nimport { getTextureName } from '../ecs/world';\nimport { ITEM_DB } from '../data/items';\nimport { AFFIXES as AFFIXES_LOOKUP } from '../data/enemyAffixes';\nimport type { ToolDef, FoodDef, SeedDef, WeaponDef, PotionDef, FoodCategory } from '../types/items';\nimport {\n  PLAYER_MAX_HP, PLAYER_MAX_STAMINA,\n  HITSTOP_DURATION_MS, CRIT_HITSTOP_DURATION_MS, KILL_HITSTOP_DURATION_MS,\n} from '../config';\nimport { TimeManager } from '../systems/TimeManager';\nimport { SaveManager } from '../systems/SaveManager';\nimport { InventoryManager } from '../systems/InventoryManager';\nimport { EquipmentManager } from '../systems/EquipmentManager';\nimport { QuestManager } from '../systems/QuestManager';\nimport { SkillManager } from '../systems/SkillManager';\nimport { RelationshipManager } from '../systems/RelationshipManager';\nimport { CraftingManager } from '../systems/CraftingManager';\nimport { FarmingManager } from '../systems/FarmingManager';\nimport { FishingManager } from '../systems/FishingManager';\nimport { CookingManager } from '../systems/CookingManager';\nimport { WeaponMasteryManager } from '../systems/WeaponMasteryManager';\nimport { StoryManager } from '../systems/StoryManager';\nimport { CorruptionManager } from '../systems/CorruptionManager';\nimport { RiftManager } from '../systems/RiftManager';\nimport { SettlementManager } from '../systems/SettlementManager';\nimport { FactionManager } from '../systems/FactionManager';\nimport { TitanManager } from '../systems/TitanManager';\nimport { WeatherManager } from '../systems/WeatherManager';\nimport { AudioManager, SFX } from '../systems/AudioManager';\nimport { LightingManager } from '../systems/LightingManager';\nimport { ParticleManager } from '../systems/ParticleManager';\nimport { CorruptionOverlay } from '../systems/CorruptionOverlay';\nimport { FestivalManager } from '../systems/FestivalManager';\nimport { RomanceManager } from '../systems/RomanceManager';\nimport { CareerManager } from '../systems/CareerManager';\nimport { AchievementManager } from '../systems/AchievementManager';\nimport { MailManager } from '../systems/MailManager';\nimport { StorageManager } from '../systems/StorageManager';\nimport { TemperatureManager } from '../systems/TemperatureManager';\nimport { ShadowWorldManager } from '../systems/ShadowWorldManager';\nimport { CityLevelManager } from '../systems/CityLevelManager';\nimport { NewGamePlusManager } from '../systems/NewGamePlusManager';\nimport { EndgameManager } from '../systems/EndgameManager';\nimport { TutorialManager } from '../systems/TutorialManager';\nimport { InteriorManager } from '../systems/InteriorManager';\nimport { LegendaryQuestManager } from '../systems/LegendaryQuestManager';\nimport { AbilityManager } from '../systems/AbilityManager';\nimport { CutsceneManager, CutsceneStep } from '../systems/CutsceneManager';\nimport { CodexManager } from '../systems/CodexManager';\nimport { ScarReadingManager } from '../systems/ScarReadingManager';\nimport { PactManager, PactCondition } from '../systems/PactManager';\nimport { ResolveManager } from '../systems/ResolveManager';\nimport { BountyContractManager } from '../systems/BountyContractManager';\nimport { EnemyWeaknessManager } from '../systems/EnemyWeaknessManager';\nimport { OmenSlotManager } from '../systems/OmenSlotManager';\nimport { CompanionManager } from '../systems/CompanionManager';\nimport { BoonManager } from '../systems/BoonManager';\nimport { ResourceCycleManager } from '../systems/ResourceCycleManager';\nimport { ShortcutManager, SHORTCUT_DB } from '../systems/ShortcutManager';\nimport { ImprintManager, IMPRINT_DB, BOSS_TO_IMPRINT } from '../systems/ImprintManager';\nimport { QuirkManager, QUIRK_DB } from '../systems/QuirkManager';\nimport { WeaponEchoManager, ECHO_PATTERNS } from '../systems/WeaponEchoManager';\nimport type { KillTypeTag } from '../systems/WeaponEchoManager';\nimport { NPCManager } from '../entities/NPC';\nimport { NPCS, NPC_DB } from '../data/npcs';\nimport { ENEMIES } from '../data/enemies';\nimport { CITIES } from '../data/cities';\nimport { INTERACTION_RADIUS } from '../config';\nimport { BiomeId } from '../world/BiomeGenerator';\nimport { DialogueScene } from './DialogueScene';\n\n/** Map BiomeId enum to data string IDs used by WeatherManager/StoryManager */\nconst BIOME_ID_MAP: Record<BiomeId, string> = {\n  [BiomeId.Haven]: 'haven',\n  [BiomeId.Rotwood]: 'rotwood',\n  [BiomeId.Ashlands]: 'ashlands',\n  [BiomeId.Drowned]: 'drowned',\n  [BiomeId.BoneWastes]: 'bone',\n  [BiomeId.TheVoid]: 'void',\n  [BiomeId.Edilas]: 'edilas',\n};\n\nconst enemyQuery = defineQuery([Position, Health, EnemyTag]);\n\n/** Cutscene step sequences keyed by cutsceneId (from chapters.ts cutsceneIds) */\nconst CUTSCENE_SCRIPTS: Record<string, CutsceneStep[]> = {\n  intro_awakening: [\n    { type: 'narration', text: 'You awaken on soft grass, the world blurring into focus...' },\n    { type: 'narration', text: 'A village stretches out before you — Haven, they call it.' },\n    { type: 'dialogue', speaker: 'Elder Mira', text: 'Ah, you\\'re awake. We found you at the edge of the meadow.' },\n    { type: 'dialogue', speaker: 'Elder Mira', text: 'You don\\'t remember anything? That\\'s... troubling. Come, let me show you around.' },\n  ],\n  corruption_revealed: [\n    { type: 'narration', text: 'A dark energy pulses from the defeated creature...' },\n    { type: 'dialogue', speaker: 'Elder Mira', text: 'This corruption... it\\'s spreading faster than I feared.' },\n    { type: 'narration', text: 'The path to Rotwood opens before you. The rot must be stopped.' },\n  ],\n  rotwood_entry: [\n    { type: 'narration', text: 'The air thickens with spores as you enter the Rotwood.' },\n    { type: 'narration', text: 'Twisted fungi cover every surface. Something is very wrong here.' },\n  ],\n  blight_mother_reveal: [\n    { type: 'narration', text: 'The ground shakes. A massive fungal form rises from the depths.' },\n    { type: 'dialogue', speaker: '???', text: 'You dare disturb the mother of rot?' },\n  ],\n  ashlands_entry: [\n    { type: 'narration', text: 'Heat washes over you. The Ashlands stretch out — a sea of ember and stone.' },\n    { type: 'narration', text: 'Here, the forges of old await those brave enough to wield fire.' },\n  ],\n  stone_titan_awakens: [\n    { type: 'narration', text: 'The mountain splits apart. A colossal figure of molten rock rises.' },\n    { type: 'dialogue', speaker: 'Stone Titan', text: 'WHO DISTURBS MY SLUMBER?' },\n  ],\n  drowned_entry: [\n    { type: 'narration', text: 'Flooded ruins stretch into darkness. Ancient structures rise from the depths.' },\n  ],\n  rift_discovery: [\n    { type: 'narration', text: 'A shimmering tear in reality pulses before you — a Rift Portal.' },\n    { type: 'narration', text: 'Step through, if you dare, to face infinite challenges.' },\n  ],\n  bone_wastes_entry: [\n    { type: 'narration', text: 'Sun-bleached bones crunch underfoot. The desert hides warring factions.' },\n  ],\n  void_entry: [\n    { type: 'narration', text: 'Reality fractures. Colors invert. You have entered The Void.' },\n    { type: 'narration', text: 'Here, the Shadow World awaits those who can channel between dimensions.' },\n  ],\n  shadow_world_reveal: [\n    { type: 'narration', text: 'The world shimmers and splits. A dark mirror of reality overlaps.' },\n    { type: 'dialogue', speaker: '???', text: 'You see it now. The truth between worlds.' },\n  ],\n  edilas_revelation: [\n    { type: 'narration', text: 'EDILAS — the name echoes through your mind. The land itself is alive.' },\n    { type: 'dialogue', speaker: 'EDILAS', text: 'You have come far, pilgrim. The corruption... it is my wound.' },\n  ],\n  world_serpent_awakens: [\n    { type: 'narration', text: 'The ground splits across the horizon. A serpent of impossible scale rises.' },\n    { type: 'dialogue', speaker: 'World Serpent', text: 'The cycle must continue. You cannot break it.' },\n  ],\n  ending_pilgrimage_complete: [\n    { type: 'narration', text: 'The World Serpent falls. The corruption recedes.' },\n    { type: 'narration', text: 'EDILAS breathes free for the first time in eons.' },\n    { type: 'dialogue', speaker: 'EDILAS', text: 'Thank you, pilgrim. The cycle is broken... or perhaps, it begins anew.' },\n    { type: 'narration', text: 'A new portal shimmers at Haven. New Game+ awaits.' },\n  ],\n};\n\n/** Map building types to interior IDs */\nconst BUILDING_INTERIOR_MAP: Record<string, string> = {\n  shop: 'general_store',\n  blacksmith: 'blacksmith',\n  tavern: 'tavern',\n  inn: 'inn',\n  library: 'library',\n  temple: 'temple',\n  house: 'player_home',\n  guild: 'guard_barracks',\n  market: 'general_store',\n  farm: 'farmer_house',\n  dock: 'fisher_house',\n};\n\n/** Loot drop on ground in overworld */\ninterface WorldLootDrop {\n  sprite: Phaser.GameObjects.Image;\n  label: Phaser.GameObjects.Text;\n  itemId: string;\n  quantity: number;\n  x: number;\n  y: number;\n  despawnTimer: number;\n}\n\n/** Dungeon entrance marker in the overworld */\ninterface DungeonEntrance {\n  x: number;\n  y: number;\n  dungeonId: string;\n  marker: Phaser.GameObjects.Image;\n  label: Phaser.GameObjects.Text;\n}\n\n/** Settlement entrance marker */\ninterface SettlementEntrance {\n  x: number;\n  y: number;\n  settlementId: string;\n  marker: Phaser.GameObjects.Image;\n  label: Phaser.GameObjects.Text;\n}\n\ninterface OverworldSceneData {\n  loadSlot?: number;\n  /** Return position after exiting dungeon */\n  returnX?: number;\n  returnY?: number;\n}\n\nexport class OverworldScene extends Phaser.Scene {\n  private loadSlot?: number;\n  private chunkManager!: ChunkManager;\n  private playerController!: PlayerController;\n  private timeManager!: TimeManager;\n  private saveManager!: SaveManager;\n  private inventoryManager!: InventoryManager;\n  private equipmentManager!: EquipmentManager;\n\n  // Life Systems\n  private questManager!: QuestManager;\n  private skillManager!: SkillManager;\n  private relationshipManager!: RelationshipManager;\n  private craftingManager!: CraftingManager;\n  private farmingManager!: FarmingManager;\n  private fishingManager!: FishingManager;\n  private cookingManager!: CookingManager;\n  private weaponMasteryManager!: WeaponMasteryManager;\n  private npcManager!: NPCManager;\n\n  // Advanced Systems\n  private storyManager!: StoryManager;\n  private corruptionManager!: CorruptionManager;\n  private riftManager!: RiftManager;\n  private settlementManager!: SettlementManager;\n  private factionManager!: FactionManager;\n  private titanManager!: TitanManager;\n  private weatherManager!: WeatherManager;\n  private audioManager!: AudioManager;\n  private lightingManager!: LightingManager;\n  private particleManager!: ParticleManager;\n  private corruptionOverlay!: CorruptionOverlay;\n\n  // Phase 3 Systems\n  private festivalManager!: FestivalManager;\n  private romanceManager!: RomanceManager;\n  private careerManager!: CareerManager;\n  private achievementManager!: AchievementManager;\n  private mailManager!: MailManager;\n  private storageManager!: StorageManager;\n  private temperatureManager!: TemperatureManager;\n  private shadowWorldManager!: ShadowWorldManager;\n  private cityLevelManager!: CityLevelManager;\n  private newGamePlusManager!: NewGamePlusManager;\n  private endgameManager!: EndgameManager;\n  private tutorialManager!: TutorialManager;\n  private interiorManager!: InteriorManager;\n  private legendaryQuestManager!: LegendaryQuestManager;\n  private abilityManager!: AbilityManager;\n  private cutsceneManager!: CutsceneManager;\n  private codexManager!: CodexManager;\n  private scarReadingManager!: ScarReadingManager;\n  private pactManager!: PactManager;\n  private resolveManager!: ResolveManager;\n  private bountyContractManager!: BountyContractManager;\n  private enemyWeaknessManager!: EnemyWeaknessManager;\n  private omenSlotManager!: OmenSlotManager;\n  private companionManager!: CompanionManager;\n  private boonManager!: BoonManager;\n  private resourceCycleManager!: ResourceCycleManager;\n  private shortcutManager!: ShortcutManager;\n  private imprintManager!: ImprintManager;\n  private quirkManager!: QuirkManager;\n  private weaponEchoManager!: WeaponEchoManager;\n  // Shortcut entrance markers in the overworld\n  private shortcutEntrances: { x: number; y: number; shortcutId: string; marker: Phaser.GameObjects.Image; label: Phaser.GameObjects.Text }[] = [];\n  // Scar reading overlay state\n  private scarReadingOverlay: Phaser.GameObjects.Container | null = null;\n  private scarReadingTimer = 0;\n  // Recently dead enemy positions for scar reading (cleaned up after 30s)\n  private recentDeadEnemies: { x: number; y: number; enemyId: string; timer: number; marker?: Phaser.GameObjects.Sprite }[] = [];\n\n  // Debug overlay\n  private weatherText!: Phaser.GameObjects.Text;\n  private biomeText!: Phaser.GameObjects.Text;\n  private coordText!: Phaser.GameObjects.Text;\n  private timeText!: Phaser.GameObjects.Text;\n\n  // --- Phase 1A: Interaction wiring ---\n  private keyE!: Phaser.Input.Keyboard.Key;\n  private inputBlocked = false;\n\n  // Enemy sprites (overworld)\n  private enemySprites: Map<number, Phaser.GameObjects.Sprite> = new Map();\n  private enemyHPBars: Map<number, Phaser.GameObjects.Graphics> = new Map();\n  private enemyAnimsCreated = false;\n\n  // Loot drops on ground\n  private lootDrops: WorldLootDrop[] = [];\n  private lootIdCounter = 0;\n\n  // Dungeon, settlement, rift & building entrances\n  private dungeonEntrances: DungeonEntrance[] = [];\n  private settlementEntrances: SettlementEntrance[] = [];\n  private riftEntrances: { x: number; y: number; marker: Phaser.GameObjects.Image; label: Phaser.GameObjects.Text }[] = [];\n  private buildingEntrances: { x: number; y: number; interiorId: string; name: string; marker: Phaser.GameObjects.Image; label: Phaser.GameObjects.Text }[] = [];\n\n  // Floating notifications\n  private notifications: { text: Phaser.GameObjects.Text; life: number }[] = [];\n\n  // Damage floaters\n  private damageTexts: { text: Phaser.GameObjects.Text; life: number }[] = [];\n\n  // Biome audio tracking\n  private lastBiomeId = '';\n\n  // --- Gameplay State ---\n  // Active buffs from food\n  private activeBuffs: { type: string; magnitude: number; remaining: number }[] = [];\n  // Object HP tracking (for destructible objects like trees/rocks)\n  private objectHP: Map<string, number> = new Map();\n  // Hotbar selection (0-9)\n  private hotbarSlot = 0;\n  // Hotbar keys\n  private hotbarKeys: Phaser.Input.Keyboard.Key[] = [];\n  // Player death state\n  private playerDead = false;\n  private deathTimer = 0;\n  // Fishing UI state\n  private fishingActive = false;\n  private fishingUI: Phaser.GameObjects.Container | null = null;\n  // Cached base+equipment stats (set by equip callback, read each frame for buff application)\n  private cachedDamage = 10;\n  private cachedDefense = 5;\n  private cachedEquipHp = 0;\n  private cachedEquipStamina = 0;\n  // Combo display\n  private comboText: Phaser.GameObjects.Text | null = null;\n  // NG+ portal\n  private ngPlusPortalActive = false;\n  // Pause menu\n  private paused = false;\n  private pauseOverlay: Phaser.GameObjects.Container | null = null;\n  private keyEsc!: Phaser.Input.Keyboard.Key;\n  private keyQ!: Phaser.Input.Keyboard.Key;\n  private keyR!: Phaser.Input.Keyboard.Key;\n  private shadowTintActive = false;\n  // Cutscene overlay\n  private cutsceneOverlay: Phaser.GameObjects.Container | null = null;\n  // Combat juice — hitstop + screen flash\n  private hitstopTimer = 0;\n  private screenFlash: Phaser.GameObjects.Rectangle | null = null;\n  // Corruption sanity tracking\n  private corruptionExposure = 0;       // 0–100, accumulates while in corrupted areas\n  private lastCorruptionMessage = 0;    // timestamp of last affliction message\n  private corruptionSpawnCooldown = 0;  // seconds until next shadow spawn\n  private resolvePhantomCooldown = 10; // seconds until next resolve phantom spawn\n\n  /** Active festival gameplay bonuses (set when a festival is active, cleared on end) */\n  private festivalXpMult = 1;           // XP multiplier (e.g. 1.5 = +50%)\n  private festivalLuckMult = 1;         // Loot rarity luck multiplier\n  private festivalGoldMult = 1;         // Gold reward multiplier\n  private festivalStaminaRegen = 0;     // Bonus stamina regen per second\n\n  /** Death Defiance (Hades-inspired): second chance on lethal damage */\n  private deathDefianceCharges = 1;     // Charges per life (refilled on respawn)\n  private maxDeathDefianceCharges = 1;  // Max charges (upgradeable)\n  /** Active diet slots (Valheim-inspired): 3 slots, one per food category */\n  private activeDietSlots: (null | {\n    itemId: string; category: FoodCategory; name: string;\n    hpBonus: number; staminaBonus: number; remaining: number; duration: number;\n  })[] = [null, null, null];\n  // Campfire respawn system (Dark Souls bonfire pattern)\n  private campfires: { x: number; y: number; marker: Phaser.GameObjects.Image; label: Phaser.GameObjects.Text; kindleLevel: number }[] = [];\n  private lastCampfirePos: { x: number; y: number } = { x: 0, y: 0 }; // default: Haven\n  // Level-up XP thresholds\n  private xpForLevel(level: number): number { return level * level * 50; }\n\n  /** Recalculate player stats incorporating active imprint + quirk effects */\n  private recalcImprintStats(): void {\n    const pEid = this.playerController.getEid();\n    const imprintFx = this.imprintManager.getCombinedEffects();\n    const quirkFx = this.quirkManager.getCombinedEffects();\n\n    // Start from cached base+equipment stats (set by equip callback)\n    const masteryWeaponType = Combat.weaponType[pEid] as WeaponType;\n    const masteryDmgBonus = this.weaponMasteryManager.getDamageBonus(masteryWeaponType);\n    const masterySpdBonus = this.weaponMasteryManager.getSpeedBonus(masteryWeaponType);\n\n    // Damage: base * mastery * imprint * quirk\n    Combat.damage[pEid] = this.cachedDamage * (1 + masteryDmgBonus)\n      * (imprintFx.damageMult ?? 1) * (quirkFx.damageMult ?? 1);\n\n    // Defense: base * imprint * quirk\n    Combat.defense[pEid] = this.cachedDefense\n      * (imprintFx.defenseMult ?? 1) * (quirkFx.defenseMult ?? 1);\n\n    // Attack speed: base * mastery * imprint speed\n    Combat.attackSpeed[pEid] = Combat.attackSpeed[pEid] * (imprintFx.speedMult ?? 1) * (quirkFx.speedMult ?? 1);\n\n    // Max HP: base + equip + imprint flat + quirk flat\n    Health.max[pEid] = PLAYER_MAX_HP + this.cachedEquipHp + (imprintFx.maxHpAdd ?? 0) + (quirkFx.maxHpAdd ?? 0);\n\n    // Max Stamina: base + equip + imprint flat\n    Stamina.max[pEid] = PLAYER_MAX_STAMINA + this.cachedEquipStamina + (imprintFx.maxStaminaAdd ?? 0);\n\n    // Crit chance: base + quirk flat + imprint flat\n    Combat.critChance[pEid] += (imprintFx.critChanceAdd ?? 0) + (quirkFx.critChanceAdd ?? 0);\n\n    // Crit multiplier: base + quirk flat\n    Combat.critMult[pEid] += (quirkFx.critMultAdd ?? 0);\n  }\n\n  constructor() {\n    super({ key: 'OverworldScene' });\n  }\n\n  private returnX?: number;\n  private returnY?: number;\n\n  init(data: OverworldSceneData): void {\n    this.loadSlot = data.loadSlot;\n    this.returnX = data.returnX;\n    this.returnY = data.returnY;\n  }\n\n  create(): void {\n    this.cameras.main.setBackgroundColor('#1a2a1a');\n    this.cameras.main.fadeIn(600, 0, 0, 0);\n\n    // Reset per-scene tracking\n    this.enemySprites.clear();\n    this.lootDrops = [];\n    this.dungeonEntrances = [];\n    this.settlementEntrances = [];\n    this.riftEntrances = [];\n    this.buildingEntrances = [];\n    this.shortcutEntrances = [];\n    this.notifications = [];\n    this.damageTexts = [];\n    this.inputBlocked = false;\n    this.activeBuffs = [];\n    this.objectHP.clear();\n    this.hotbarSlot = 0;\n    this.playerDead = false;\n    this.deathTimer = 0;\n    this.fishingActive = false;\n    this.fishingUI = null;\n\n    // World engine\n    this.chunkManager = new ChunkManager(this, 42069);\n\n    // Load enemy spritesheets\n    this.enemyAnimsCreated = false;\n    AssetManager.getInstance().loadPacks(this, ['enemies_common']).then(() => {\n      this.createEnemyAnimations();\n    });\n\n    // Core managers\n    this.timeManager = new TimeManager(1);\n    this.saveManager = new SaveManager();\n    this.inventoryManager = new InventoryManager();\n    this.equipmentManager = new EquipmentManager();\n\n    // Life system managers\n    this.questManager = new QuestManager();\n    this.skillManager = new SkillManager();\n    this.relationshipManager = new RelationshipManager();\n    this.craftingManager = new CraftingManager();\n    this.craftingManager.init();\n    this.farmingManager = new FarmingManager();\n    this.fishingManager = new FishingManager();\n    this.cookingManager = new CookingManager();\n    this.weaponMasteryManager = new WeaponMasteryManager();\n    this.npcManager = new NPCManager(this);\n\n    // Advanced system managers\n    this.storyManager = new StoryManager();\n    this.corruptionManager = new CorruptionManager();\n    this.riftManager = new RiftManager();\n    this.settlementManager = new SettlementManager();\n    this.factionManager = new FactionManager();\n    this.titanManager = new TitanManager();\n    this.weatherManager = new WeatherManager();\n    this.audioManager = new AudioManager(this);\n    this.lightingManager = new LightingManager(this);\n    this.lightingManager.init(false);\n    this.particleManager = new ParticleManager(this);\n    this.corruptionOverlay = new CorruptionOverlay(this, this.corruptionManager, this.particleManager);\n\n    // Phase 3 managers\n    this.festivalManager = new FestivalManager();\n    this.romanceManager = new RomanceManager();\n    this.careerManager = new CareerManager();\n    this.achievementManager = new AchievementManager();\n    this.mailManager = new MailManager();\n    this.storageManager = new StorageManager();\n    this.temperatureManager = new TemperatureManager();\n    this.shadowWorldManager = new ShadowWorldManager();\n    this.cityLevelManager = new CityLevelManager();\n    this.newGamePlusManager = new NewGamePlusManager();\n    this.endgameManager = new EndgameManager();\n    this.tutorialManager = new TutorialManager();\n    this.interiorManager = new InteriorManager();\n    this.legendaryQuestManager = new LegendaryQuestManager();\n    this.abilityManager = new AbilityManager();\n    this.cutsceneManager = new CutsceneManager();\n    this.codexManager = new CodexManager();\n    this.scarReadingManager = new ScarReadingManager();\n    this.pactManager = new PactManager();\n    this.resolveManager = new ResolveManager();\n    // Wire Pact FragileResolve: start with half resolve\n    if (this.pactManager.isActive(PactCondition.FragileResolve)) {\n      this.resolveManager.setResolve(50);\n    }\n\n    this.bountyContractManager = new BountyContractManager();\n    this.enemyWeaknessManager = new EnemyWeaknessManager();\n    this.omenSlotManager = new OmenSlotManager();\n    this.companionManager = new CompanionManager();\n    this.boonManager = new BoonManager();\n    this.resourceCycleManager = new ResourceCycleManager();\n    this.shortcutManager = new ShortcutManager();\n\n    // Resource depletion callbacks\n    this.resourceCycleManager.onDepleted((regionKey) => {\n      this.showNotification(`Region ${regionKey} is depleted. Resources will regrow in a few days.`);\n    });\n    this.resourceCycleManager.onRegrowth((regionKey) => {\n      this.showNotification(`Region ${regionKey} has regrown! Resources are available again.`);\n    });\n\n    this.imprintManager = new ImprintManager();\n    this.quirkManager = new QuirkManager();\n    this.weaponEchoManager = new WeaponEchoManager();\n\n    // Imprint unlock callback\n    this.imprintManager.onUnlock((imprintId) => {\n      const def = IMPRINT_DB.get(imprintId);\n      if (def) {\n        this.showNotification(`Imprint absorbed: ${def.name} — ${def.description}`);\n        this.triggerScreenFlash(parseInt(def.color.replace('#', '0x')), 0.3);\n        this.audioManager.playSFX(SFX.LEVEL_UP);\n      }\n    });\n\n    // Imprint equip change — recalculate stats\n    this.imprintManager.onEquipChange(() => {\n      this.recalcImprintStats();\n    });\n\n    // Quirk callbacks\n    this.quirkManager.onQuirkGained((quirkId) => {\n      const def = QUIRK_DB.get(quirkId);\n      this.showNotification(`Quirk acquired: ${def?.name ?? quirkId} — ${def?.description ?? ''}`);\n    });\n    this.quirkManager.onQuirkLost((quirkId) => {\n      const def = QUIRK_DB.get(quirkId);\n      this.showNotification(`Quirk faded: ${def?.name ?? quirkId}`);\n    });\n    this.quirkManager.onQuirkCrystallized((quirkId) => {\n      const def = QUIRK_DB.get(quirkId);\n      this.showNotification(`Quirk crystallized: ${def?.name ?? quirkId} — ${def?.crystallizedDescription ?? ''}`);\n      this.triggerScreenFlash(0xaaffee, 0.25);\n      this.audioManager.playSFX(SFX.LEVEL_UP);\n    });\n\n    // Weapon echo callbacks\n    this.weaponEchoManager.onEchoCharged((patternId, charges) => {\n      const pattern = ECHO_PATTERNS.find(p => p.id === patternId);\n      this.showNotification(`Echo charged [${charges}/3]: ${pattern?.name ?? 'Unknown'}`);\n      this.audioManager.playSFX(SFX.CRIT_HIT);\n    });\n    this.weaponEchoManager.onEchoReleased((damage, _patternId) => {\n      this.showNotification(`Echo Strike! ${damage} phantom damage!`);\n      this.cameras.main.shake(150, 0.01);\n    });\n\n    // Shortcut unlock callback\n    this.shortcutManager.onUnlock((shortcutId) => {\n      const def = SHORTCUT_DB.get(shortcutId);\n      if (def) {\n        this.showNotification(`Shortcut unlocked: ${def.name} — ${def.description}`);\n        this.audioManager.playSFX(SFX.DOOR_OPEN);\n        this.triggerScreenFlash(0x44ffaa, 0.25);\n      }\n    });\n\n    // Boon selection callback — notify player of selected boon\n    this.boonManager.onBoonSelected((boon) => {\n      const rarityColors: Record<string, number> = { common: 0xaaaaaa, rare: 0x4488ff, epic: 0xaa00ff };\n      this.showNotification(`Boon: ${boon.name} — ${boon.description}`);\n      this.triggerScreenFlash(rarityColors[boon.rarity] ?? 0xffffff, 0.2);\n      this.audioManager.playSFX(SFX.LEVEL_UP);\n    });\n\n    // Companion event callbacks\n    this.companionManager.onKnockout((npcId) => {\n      this.showNotification(`${npcId} has been knocked out! They'll recover in 30 seconds.`);\n      this.audioManager.playSFX(SFX.PLAYER_HIT);\n      this.cameras.main.shake(200, 0.01);\n    });\n    this.companionManager.onMoraleLow((npcId) => {\n      const def = this.companionManager.getActiveDef();\n      if (def) this.showNotification(`${def.name}: \"${def.lowMoraleLine}\"`);\n    });\n\n    // Omen slot change callback — recalculate stats\n    this.omenSlotManager.onEquipChange(() => {\n      this.recalcOmenStats();\n    });\n\n    // Bounty contract callbacks\n    this.bountyContractManager.onComplete((contract) => {\n      this.showNotification(`CONTRACT COMPLETE: ${contract.name}! Bonus rewards earned.`);\n      this.triggerScreenFlash(0x44ff44, 0.3);\n      this.audioManager.playSFX(SFX.LEVEL_UP);\n      // Award bonus gold\n      const bonusGold = Math.round(50 * contract.goldMult * contract.tier);\n      this.inventoryManager.addGold(bonusGold);\n      this.showNotification(`+${bonusGold} bonus gold`);\n      this.particleManager.emit('goldPickup', Position.x[this.playerController.getEid()], Position.y[this.playerController.getEid()]);\n      this.bountyContractManager.clearActive();\n    });\n    this.bountyContractManager.onFail((contract) => {\n      this.showNotification(`CONTRACT FAILED: ${contract.name}. An item has been lost.`);\n      this.triggerScreenFlash(0xff2222, 0.3);\n      this.cameras.main.shake(200, 0.01);\n      // Remove a random non-tool item from inventory\n      this.inventoryManager.removeRandomItem();\n      this.bountyContractManager.clearActive();\n    });\n\n    // Enemy weakness discovery callbacks\n    this.enemyWeaknessManager.onReveal((enemyId, tier) => {\n      const tierLabels = { weakness: 'Weakness', resistance: 'Resistance', exploit: 'Exploit', mastery: 'Mastery' };\n      this.showNotification(`Bestiary: ${enemyId} — ${tierLabels[tier]} discovered!`);\n      if (tier === 'mastery') {\n        this.audioManager.playSFX(SFX.LEVEL_UP);\n        this.triggerScreenFlash(0xffdd44, 0.2);\n      } else {\n        this.audioManager.playSFX(SFX.ITEM_PICKUP);\n      }\n    });\n\n    // Wire enemy weakness damage multiplier into combat system\n    const enemyByTexture = new Map<string, string>(); // texture → enemy ID\n    for (const e of ENEMIES) enemyByTexture.set(e.texture, e.id);\n    setExternalDamageMult((attackerEid, targetEid) => {\n      // Only apply weakness for player attacking enemies\n      if (!hasComponent(ecsWorld, PlayerTag, attackerEid)) return 1.0;\n      if (!hasComponent(ecsWorld, EnemyTag, targetEid)) return 1.0;\n      const texName = getTextureName(ECSSprite.textureId[targetEid]);\n      const enemyId = enemyByTexture.get(texName);\n      if (!enemyId) return 1.0;\n      const weaponType = Combat.weaponType[attackerEid];\n      return this.enemyWeaknessManager.getDamageMultiplier(enemyId, weaponType);\n    });\n\n    // Register resolve trauma callbacks\n    this.resolveManager.onTrauma((trauma) => {\n      const color = trauma.type === 'virtue' ? '#ffdd44' : '#cc3333';\n      const label = trauma.type === 'virtue' ? 'VIRTUE' : 'AFFLICTION';\n      this.showNotification(`${label}: ${trauma.name} — ${trauma.description}`);\n      if (trauma.type === 'virtue') {\n        this.triggerScreenFlash(0xffdd44, 0.3);\n        this.audioManager.playSFX(SFX.LEVEL_UP);\n      } else {\n        this.triggerScreenFlash(0x880000, 0.4);\n        this.cameras.main.shake(300, 0.015);\n      }\n    });\n\n    // Register codex discovery notification\n    this.codexManager.onDiscover((fragment) => {\n      this.showNotification(`Lore discovered: \"${fragment.title}\"`);\n      this.audioManager.playSFX(SFX.ITEM_PICKUP);\n    });\n\n    // Register scar reading notification\n    this.scarReadingManager.onRead((memory) => {\n      // Also discover it as a codex entry if matching fragment exists\n      this.codexManager.discover(memory.id);\n    });\n\n    // Spawn Haven NPCs\n    let npcOffset = 0;\n    for (const def of NPCS) {\n      if (def.homeCity === 'haven') {\n        this.npcManager.spawnNPC(def, 100 + npcOffset * 60, 100);\n        npcOffset++;\n      }\n    }\n\n    // Register save/load handlers\n    this.registerSaveHandlers();\n\n    // Cross-system event wiring\n    this.wireEvents();\n\n    // Player entity\n    const playerEid = createPlayer(0, 0);\n    this.playerController = new PlayerController(this, playerEid);\n\n    // Camera follow player\n    this.cameras.main.startFollow(this.playerController.getSprite(), true, 0.1, 0.1);\n\n    // Zoom via scroll wheel\n    this.input.on('wheel', (_pointer: Phaser.Input.Pointer, _gos: unknown[], _dx: number, dy: number) => {\n      const cam = this.cameras.main;\n      cam.setZoom(Phaser.Math.Clamp(cam.zoom - dy * 0.001, 0.5, 3));\n    });\n\n    // --- Interaction keys ---\n    this.keyE = this.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.E);\n    this.keyEsc = this.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.ESC);\n    this.keyQ = this.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.Q);\n    this.keyR = this.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.R);\n\n    // --- Ability keys (F1-F4) ---\n    const abilityKeys = [\n      this.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.F1),\n      this.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.F2),\n      this.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.F3),\n      this.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.F4),\n    ];\n    for (let i = 0; i < 4; i++) {\n      abilityKeys[i].on('down', () => {\n        if (this.inputBlocked) return;\n        const hotbar = this.abilityManager.getHotbar();\n        const abilityId = hotbar[i];\n        if (!abilityId) return;\n        const pEid = this.playerController.getEid();\n        const currentStamina = Stamina.current[pEid];\n        const result = this.abilityManager.useAbility(abilityId, currentStamina);\n        if (result) {\n          // Deduct stamina cost\n          Stamina.current[pEid] = Math.max(0, currentStamina - result.staminaCost);\n          // Apply ability damage to nearby enemies\n          const px = Position.x[pEid];\n          const py = Position.y[pEid];\n          const abilityRange = result.aoeRadius > 0 ? result.aoeRadius : 64;\n          const enemies = defineQuery([EnemyTag])(ecsWorld);\n          for (const enemy of enemies) {\n            const dist = Phaser.Math.Distance.Between(px, py, Position.x[enemy], Position.y[enemy]);\n            if (dist <= abilityRange) {\n              const dmg = Math.floor(Combat.damage[pEid] * result.damageMult);\n              Health.current[enemy] = Math.max(0, Health.current[enemy] - dmg);\n              this.particleManager.emit('blood', Position.x[enemy], Position.y[enemy]);\n            }\n          }\n          this.showNotification(`${result.name}!`);\n          this.audioManager.playSFX(SFX.SWORD_SWING);\n        }\n      });\n    }\n\n    // --- Hotbar keys (1-0 → slots 0-9) ---\n    const keyCodes = [\n      Phaser.Input.Keyboard.KeyCodes.ONE, Phaser.Input.Keyboard.KeyCodes.TWO,\n      Phaser.Input.Keyboard.KeyCodes.THREE, Phaser.Input.Keyboard.KeyCodes.FOUR,\n      Phaser.Input.Keyboard.KeyCodes.FIVE, Phaser.Input.Keyboard.KeyCodes.SIX,\n      Phaser.Input.Keyboard.KeyCodes.SEVEN, Phaser.Input.Keyboard.KeyCodes.EIGHT,\n      Phaser.Input.Keyboard.KeyCodes.NINE, Phaser.Input.Keyboard.KeyCodes.ZERO,\n    ];\n    this.hotbarKeys = keyCodes.map(kc => this.input.keyboard!.addKey(kc));\n\n    // --- Equipment stat sync callback ---\n    this.equipmentManager.onEquipChange((stats) => {\n      const pEid = this.playerController.getEid();\n      this.cachedDamage = 10 + stats.damage;\n      this.cachedDefense = 5 + stats.defense;\n      this.cachedEquipHp = stats.hp;\n      this.cachedEquipStamina = stats.stamina;\n      // Apply weapon mastery bonuses on top of equipment stats\n      const masteryWeaponType = Combat.weaponType[pEid] as WeaponType;\n      const masteryDmgBonus = this.weaponMasteryManager.getDamageBonus(masteryWeaponType);\n      const masterySpdBonus = this.weaponMasteryManager.getSpeedBonus(masteryWeaponType);\n      Combat.damage[pEid] = this.cachedDamage * (1 + masteryDmgBonus);\n      Combat.defense[pEid] = this.cachedDefense;\n      Combat.critChance[pEid] = 0.05 + stats.critChance;\n      Combat.critMult[pEid] = 1.5 + stats.critMult;\n      Combat.attackSpeed[pEid] = (1.0 + stats.attackSpeed) * (1 + masterySpdBonus);\n      Health.max[pEid] = PLAYER_MAX_HP + stats.hp;\n      Stamina.max[pEid] = PLAYER_MAX_STAMINA + stats.stamina;\n\n      // Sync weapon type to ECS for mastery tracking + auto-unlock abilities\n      const weapon = this.equipmentManager.getEquipped('weapon');\n      if (weapon) {\n        const weaponDef = ITEM_DB.get(weapon.itemId) as WeaponDef | undefined;\n        if (weaponDef) {\n          Combat.weaponType[pEid] = weaponDef.weaponType;\n          // Weapon synergy: bonus damage vs status effects (Dead Cells-inspired)\n          const SYNERGY_MAP: Record<string, SynergyStatus> = {\n            poison: SynergyStatus.Poison, burn: SynergyStatus.Burn,\n            freeze: SynergyStatus.Freeze, bleed: SynergyStatus.Bleed,\n            stun: SynergyStatus.Stun,\n          };\n          Combat.synergyStatus[pEid] = weaponDef.bonusVsStatus ? (SYNERGY_MAP[weaponDef.bonusVsStatus] ?? SynergyStatus.None) : SynergyStatus.None;\n          Combat.synergyMult[pEid] = weaponDef.synergyMult ?? 1;\n          // Auto-unlock and assign abilities for this weapon type\n          const abilities = this.abilityManager.getAbilitiesForWeapon(weaponDef.weaponType);\n          for (let i = 0; i < Math.min(abilities.length, 4); i++) {\n            this.abilityManager.unlock(abilities[i].id);\n            this.abilityManager.setHotbar(i, abilities[i].id);\n          }\n        }\n      } else {\n        Combat.weaponType[pEid] = WeaponType.Unarmed;\n        Combat.synergyStatus[pEid] = SynergyStatus.None;\n        Combat.synergyMult[pEid] = 1;\n      }\n      // Update sword mastery level for parry system\n      setSwordMasteryLevel(this.weaponMasteryManager.getLevel(WeaponType.Sword));\n    });\n\n    // --- Launch DialogueScene as persistent overlay ---\n    if (!this.scene.isActive('DialogueScene')) {\n      this.scene.launch('DialogueScene');\n    }\n\n    // --- Create dungeon entrance markers ---\n    this.createDungeonEntrances();\n\n    // --- Create settlement entrance markers ---\n    this.createSettlementEntrances();\n\n    // --- Create building entrance markers ---\n    this.createBuildingEntrances();\n\n    // --- Create world shortcut markers ---\n    this.createShortcutEntrances();\n\n    // Debug text\n    const textStyle: Phaser.Types.GameObjects.Text.TextStyle = {\n      fontFamily: 'monospace',\n      fontSize: '12px',\n      color: '#aaaaaa',\n      backgroundColor: '#000000aa',\n      padding: { x: 4, y: 2 },\n    };\n\n    this.coordText = this.add.text(10, 660, '', textStyle).setScrollFactor(0).setDepth(9999);\n    this.biomeText = this.add.text(10, 680, '', { ...textStyle, color: '#7dd3fc' }).setScrollFactor(0).setDepth(9999);\n    this.timeText = this.add.text(10, 640, '', { ...textStyle, color: '#ffb347' }).setScrollFactor(0).setDepth(9999);\n    this.weatherText = this.add.text(10, 620, '', { ...textStyle, color: '#88ccff' }).setScrollFactor(0).setDepth(9999);\n\n    // Expose hotbar slot and active buffs to UIScene\n    this.registry.set('hotbarSlot', this.hotbarSlot);\n    this.registry.set('activeBuffs', this.activeBuffs);\n\n    // Expose managers to UIScene via registry\n    this.registry.set('chunkManager', this.chunkManager);\n    this.registry.set('timeManager', this.timeManager);\n    this.registry.set('inventoryManager', this.inventoryManager);\n    this.registry.set('equipmentManager', this.equipmentManager);\n    this.registry.set('saveManager', this.saveManager);\n    this.registry.set('playerController', this.playerController);\n    this.registry.set('questManager', this.questManager);\n    this.registry.set('skillManager', this.skillManager);\n    this.registry.set('relationshipManager', this.relationshipManager);\n    this.registry.set('craftingManager', this.craftingManager);\n    this.registry.set('farmingManager', this.farmingManager);\n    this.registry.set('fishingManager', this.fishingManager);\n    this.registry.set('cookingManager', this.cookingManager);\n    this.registry.set('weaponMasteryManager', this.weaponMasteryManager);\n    this.registry.set('npcManager', this.npcManager);\n    this.registry.set('storyManager', this.storyManager);\n    this.registry.set('corruptionManager', this.corruptionManager);\n    this.registry.set('riftManager', this.riftManager);\n    this.registry.set('settlementManager', this.settlementManager);\n    this.registry.set('factionManager', this.factionManager);\n    this.registry.set('titanManager', this.titanManager);\n    this.registry.set('weatherManager', this.weatherManager);\n    this.registry.set('audioManager', this.audioManager);\n    this.registry.set('lightingManager', this.lightingManager);\n    this.registry.set('particleManager', this.particleManager);\n    this.registry.set('festivalManager', this.festivalManager);\n    this.registry.set('romanceManager', this.romanceManager);\n    this.registry.set('careerManager', this.careerManager);\n    this.registry.set('achievementManager', this.achievementManager);\n    this.registry.set('mailManager', this.mailManager);\n    this.registry.set('storageManager', this.storageManager);\n    this.registry.set('temperatureManager', this.temperatureManager);\n    this.registry.set('shadowWorldManager', this.shadowWorldManager);\n    this.registry.set('cityLevelManager', this.cityLevelManager);\n    this.registry.set('newGamePlusManager', this.newGamePlusManager);\n    this.registry.set('endgameManager', this.endgameManager);\n    this.registry.set('tutorialManager', this.tutorialManager);\n    this.registry.set('interiorManager', this.interiorManager);\n    this.registry.set('legendaryQuestManager', this.legendaryQuestManager);\n    this.registry.set('abilityManager', this.abilityManager);\n    this.registry.set('cutsceneManager', this.cutsceneManager);\n    this.registry.set('pactManager', this.pactManager);\n    this.registry.set('scarReadingManager', this.scarReadingManager);\n    this.registry.set('resolveManager', this.resolveManager);\n    this.registry.set('bountyContractManager', this.bountyContractManager);\n    this.registry.set('enemyWeaknessManager', this.enemyWeaknessManager);\n    this.registry.set('omenSlotManager', this.omenSlotManager);\n    this.registry.set('companionManager', this.companionManager);\n    this.registry.set('boonManager', this.boonManager);\n    this.registry.set('resourceCycleManager', this.resourceCycleManager);\n    this.registry.set('shortcutManager', this.shortcutManager);\n    this.registry.set('imprintManager', this.imprintManager);\n    this.registry.set('quirkManager', this.quirkManager);\n    this.registry.set('weaponEchoManager', this.weaponEchoManager);\n\n    // Load save if continuing, otherwise give starter items\n    if (this.loadSlot !== undefined) {\n      this.saveManager.load(this.loadSlot);\n    } else {\n      // New game: starting tools and supplies\n      this.inventoryManager.addItem('axe', 1, 1);\n      this.inventoryManager.addItem('pickaxe', 1, 1);\n      this.inventoryManager.addItem('hoe', 1, 1);\n      this.inventoryManager.addItem('watering_can', 1, 1);\n      this.inventoryManager.addItem('fishing_rod', 1, 1);\n      this.inventoryManager.addItem('parsnip_seeds', 15);\n      this.inventoryManager.addItem('bread', 5);\n      this.inventoryManager.addGold(500);\n    }\n\n    // Restore position if returning from dungeon\n    if (this.returnX !== undefined && this.returnY !== undefined) {\n      const pEid = this.playerController.getEid();\n      Position.x[pEid] = this.returnX;\n      Position.y[pEid] = this.returnY;\n    }\n\n    // Initial weather particles\n    this.particleManager.setWeatherParticles(this.weatherManager.getWeatherType());\n\n    // Initial load\n    this.chunkManager.update(0, 0);\n  }\n\n  update(_time: number, delta: number): void {\n    const deltaSec = delta / 1000;\n\n    // Check if a UI panel is open (set by UIScene) to block player input\n    this.inputBlocked = !!(this.registry.get('uiPanelOpen'));\n\n    // --- Pause toggle ---\n    if (Phaser.Input.Keyboard.JustDown(this.keyEsc)) {\n      if (this.paused) {\n        this.closePauseMenu();\n      } else if (!this.fishingActive && !this.inputBlocked) {\n        this.openPauseMenu();\n        return;\n      }\n    }\n    if (this.paused) return;\n\n    // Time\n    this.timeManager.update(delta);\n\n    // --- Player death check ---\n    if (this.playerDead) {\n      this.deathTimer -= deltaSec;\n      if (this.deathTimer <= 0) {\n        this.respawnPlayer();\n      }\n      return;\n    }\n\n    // Check if fishing UI is active (blocks normal input)\n    if (this.fishingActive) {\n      this.updateFishingUI(deltaSec);\n      return;\n    }\n\n    // Player input → ECS velocity (skip if UI is blocking input)\n    if (!this.inputBlocked) {\n      this.playerController.update(deltaSec);\n\n      // --- Attack input (J key or left-click) ---\n      if (this.playerController.isAttackJustPressed()) {\n        const result = this.playerController.attack();\n        if (result) {\n          requestPlayerAttack();\n          this.audioManager.playSFX(SFX.SWORD_SWING);\n        }\n      }\n\n      // --- Dodge input (SHIFT + movement) ---\n      if (this.playerController.isDodgeJustPressed()) {\n        if (this.playerController.dodge()) {\n          this.cameras.main.shake(60, 0.003);\n          this.bountyContractManager.onDodge();\n        }\n      }\n\n      // --- Tool use (Spacebar) ---\n      if (this.playerController.isToolUseJustPressed()) {\n        this.handleToolUse();\n      }\n\n      // --- Hotbar slot selection (1-0 keys) ---\n      for (let i = 0; i < this.hotbarKeys.length; i++) {\n        if (Phaser.Input.Keyboard.JustDown(this.hotbarKeys[i])) {\n          const slot = this.inventoryManager.getSlot(i);\n          if (slot && slot.itemId) {\n            const def = ITEM_DB.get(slot.itemId);\n            if (def && (def.category === 'food' || def.category === 'potion')) {\n              this.consumeItem(i);\n            } else if (def && (def.category === 'tool' || def.category === 'seed')) {\n              this.hotbarSlot = i;\n              this.registry.set('hotbarSlot', i);\n            }\n          } else {\n            // Empty slot — still select it\n            this.hotbarSlot = i;\n            this.registry.set('hotbarSlot', i);\n          }\n          break;\n        }\n      }\n    }\n\n    // --- Tick active buffs ---\n    for (let i = this.activeBuffs.length - 1; i >= 0; i--) {\n      const buff = this.activeBuffs[i];\n      buff.remaining -= deltaSec;\n      this.applyBuffTick(buff, deltaSec);\n      if (buff.remaining <= 0) {\n        this.activeBuffs.splice(i, 1);\n      }\n    }\n\n    // --- Tick active diet slots (Valheim-style) ---\n    let dietHpBonus = 0;\n    let dietStaminaBonus = 0;\n    const foodDrainMult = 1 / this.pactManager.getFoodDurationMult(); // Starving World: drain 2x faster\n    for (let i = 0; i < this.activeDietSlots.length; i++) {\n      const slot = this.activeDietSlots[i];\n      if (!slot) continue;\n      slot.remaining -= deltaSec * foodDrainMult;\n      if (slot.remaining <= 0) {\n        this.showNotification(`Diet expired: ${slot.name}`);\n        this.activeDietSlots[i] = null;\n        this.registry.set('dietSlots', this.activeDietSlots);\n      } else {\n        // Scale bonus: full for first 50% of duration, then linearly fade\n        const pct = slot.remaining / slot.duration;\n        const scale = pct > 0.5 ? 1 : pct * 2;\n        dietHpBonus += Math.round(slot.hpBonus * scale);\n        dietStaminaBonus += Math.round(slot.staminaBonus * scale);\n      }\n    }\n\n    // Apply buff + diet effects to ECS stats (on top of base+equipment)\n    {\n      const pEid = this.playerController.getEid();\n      Combat.damage[pEid] = this.cachedDamage + this.getBuffMagnitude('strength');\n      Combat.defense[pEid] = this.cachedDefense + this.getBuffMagnitude('defense');\n      this.playerController.speedBonus = this.getBuffMagnitude('speed');\n      // Diet bonuses to max HP/stamina\n      Health.max[pEid] = PLAYER_MAX_HP + this.cachedEquipHp + dietHpBonus;\n      Stamina.max[pEid] = PLAYER_MAX_STAMINA + this.cachedEquipStamina + dietStaminaBonus;\n    }\n\n    // Expose pact modifiers to registry for cross-system use\n    this.registry.set('pactEnemyAtkSpeedMult', this.pactManager.getEnemyAttackSpeedMult());\n    this.registry.set('pactCorruptionMult', this.pactManager.getCorruptionSpreadMult());\n    this.registry.set('pactLightMult', this.pactManager.getLightRevealMult());\n    this.registry.set('pactBurden', this.pactManager.getTotalBurden());\n\n    // ECS systems\n    movementSystem(ecsWorld, deltaSec);\n    animationSystem(ecsWorld, deltaSec);\n    const weatherAggro = this.registry.get('weatherAggroMult') ?? 1;\n    const imprintAggro = this.imprintManager.getAggroMultForBiome(this.lastBiomeId);\n    aiSystem(ecsWorld, deltaSec, weatherAggro * imprintAggro);\n    combatSystem(ecsWorld, deltaSec);\n    projectileSystem(ecsWorld, deltaSec);\n\n    // Spawn enemies in nearby chunks\n    const pos = this.playerController.getPosition();\n    spawnSystem(\n      ecsWorld,\n      pos.x, pos.y,\n      (tx: number, ty: number) => this.chunkManager.getBiomeAt(tx, ty),\n      this.timeManager.getDate().season,\n    );\n\n    // Process loot from dead enemies\n    lootSystem(ecsWorld, (this.festivalLuckMult > 1 ? this.festivalLuckMult : 0) + this.pactManager.getLootRarityBonus());\n\n    // Sync enemy sprites to ECS positions + create/destroy as needed\n    this.syncEnemySprites();\n\n    // Process loot events → create ground drops\n    this.processLootEvents();\n\n    // Process damage events → floating damage numbers\n    this.processDamageEvents();\n    this.processParryEvents();\n    this.updateDamageTexts(deltaSec);\n    this.updateScarReading(deltaSec);\n\n    // Combo counter display\n    this.updateComboDisplay();\n\n    // Check item pickup (player walking near loot drops)\n    this.checkLootPickup();\n\n    // Update loot drop despawn timers\n    this.updateLootDrops(deltaSec);\n\n    // --- E key interaction ---\n    if (!this.inputBlocked && Phaser.Input.Keyboard.JustDown(this.keyE)) {\n      this.handleInteraction();\n    }\n\n    // --- Q key: Shadow World toggle ---\n    if (!this.inputBlocked && Phaser.Input.Keyboard.JustDown(this.keyQ)) {\n      if (this.shadowWorldManager.isInShadowWorld()) {\n        this.shadowWorldManager.exitShadowWorld();\n      } else if (!this.shadowWorldManager.isChanneling()) {\n        const started = this.shadowWorldManager.enterShadowWorld();\n        if (started) {\n          this.showNotification('Channeling into Shadow World...');\n        } else {\n          const cd = this.shadowWorldManager.getCooldownRemaining();\n          if (cd > 0) {\n            this.showNotification(`Shadow World on cooldown (${Math.ceil(cd / 1000)}s)`);\n          }\n        }\n      } else {\n        this.shadowWorldManager.cancelChannel();\n        this.showNotification('Channeling cancelled.');\n      }\n    }\n\n    // --- R key: Weapon Echo release ---\n    if (!this.inputBlocked && Phaser.Input.Keyboard.JustDown(this.keyR)) {\n      const echoDmg = this.weaponEchoManager.releaseEcho();\n      if (echoDmg > 0) {\n        // Apply phantom strike damage to nearby enemies\n        const enemies = defineQuery([EnemyTag])(ecsWorld);\n        for (const enemy of enemies) {\n          const dist = Phaser.Math.Distance.Between(pos.x, pos.y, Position.x[enemy], Position.y[enemy]);\n          if (dist <= 80) {\n            Health.current[enemy] = Math.max(0, Health.current[enemy] - echoDmg);\n            this.particleManager.emit('critFlash', Position.x[enemy], Position.y[enemy]);\n          }\n        }\n      }\n    }\n\n    // Shadow World visual tint\n    if (this.shadowWorldManager.isInShadowWorld() && !this.shadowTintActive) {\n      this.cameras.main.setPostPipeline([]);\n      this.cameras.main.setBackgroundColor('#110022');\n      this.shadowTintActive = true;\n    } else if (!this.shadowWorldManager.isInShadowWorld() && this.shadowTintActive) {\n      this.cameras.main.setBackgroundColor('#000000');\n      this.shadowTintActive = false;\n    }\n\n    // Life systems\n    this.npcManager.update(deltaSec, pos.x, pos.y, INTERACTION_RADIUS);\n    const date = this.timeManager.getDate();\n    this.npcManager.updateSchedules(date.hour, date.season);\n    this.craftingManager.update(deltaSec, this.inventoryManager);\n    this.fishingManager.update(deltaSec);\n    this.cookingManager.update(deltaSec);\n\n    // Advanced systems\n    const tilePos = IsometricHelper.pixelToTile(pos.x, pos.y);\n    const biomeId = this.chunkManager.getBiomeAt(tilePos.tileX, tilePos.tileY);\n\n    // Biome audio — switch music/ambient when biome changes\n    const biomeStr = BIOME_ID_MAP[biomeId] ?? 'haven';\n    if (biomeStr !== this.lastBiomeId) {\n      this.lastBiomeId = biomeStr;\n      this.audioManager.setBiomeAudio(biomeStr);\n    }\n\n    this.weatherManager.update(deltaSec, biomeStr);\n    this.titanManager.update(deltaSec);\n    this.corruptionManager.spreadCorruption(this.chunkManager.getActiveChunkKeys());\n\n    // Temperature system\n    this.temperatureManager.update(\n      biomeStr,\n      date.season.toLowerCase(),\n      this.weatherManager.getWeatherType(),\n      date.hour,\n      deltaSec,\n    );\n\n    // Apply temperature effects to player stamina + HP damage from extremes\n    const tempEffects = this.temperatureManager.getTemperatureEffects();\n    this.playerController.staminaRegenMult = tempEffects.staminaRegenMultiplier;\n    this.playerController.staminaDrainMult = tempEffects.staminaDrainMultiplier;\n    // Extreme temperature HP damage (1 HP/sec when freezing or overheating for 10+ seconds)\n    const coldExposure = this.temperatureManager.getColdExposureTime();\n    const heatExposure = this.temperatureManager.getHeatExposureTime();\n    if (coldExposure > 10 || heatExposure > 10) {\n      const pEid = this.playerController.getEid();\n      Health.current[pEid] = Math.max(0, Health.current[pEid] - 1 * deltaSec);\n    }\n\n    // Festival stamina regen bonus\n    if (this.festivalStaminaRegen > 0) {\n      const pEid = this.playerController.getEid();\n      Stamina.current[pEid] = Math.min(\n        Stamina.max[pEid],\n        Stamina.current[pEid] + this.festivalStaminaRegen * deltaSec,\n      );\n    }\n\n    // Weather gameplay effects — movement/aggro penalties\n    const weatherType = this.weatherManager.getWeatherType();\n    const visibility = this.weatherManager.getVisibility();\n    // Rain/storm: slow player by 15%\n    if (weatherType === 'rain' || weatherType === 'storm' || weatherType === 'acid_rain') {\n      this.playerController.speedBonus -= 18; // ~15% reduction from base 120\n    }\n    // Snow: slow by 25%\n    if (weatherType === 'snow' || weatherType === 'blizzard') {\n      this.playerController.speedBonus -= 30;\n    }\n    // Low visibility reduces enemy aggro range (applied globally via registry for AISystem)\n    this.registry.set('weatherAggroMult', visibility);\n    // Void storm: +10% enemy damage (signaled to combat via registry)\n    this.registry.set('weatherEnemyDmgMult', weatherType === 'void_storm' ? 1.1 : 1.0);\n\n    // Corruption gameplay + sanity effects at player tile\n    const corruptionFx = this.corruptionManager.getPlayerEffects(tilePos.tileX, tilePos.tileY);\n    const tileCorruption = this.corruptionManager.getCorruption(tilePos.tileX, tilePos.tileY);\n\n    // Accumulate or decay corruption exposure (Darkest Dungeon–style sanity)\n    if (tileCorruption > 0.1) {\n      this.corruptionExposure = Math.min(100, this.corruptionExposure + tileCorruption * 5 * deltaSec);\n    } else {\n      this.corruptionExposure = Math.max(0, this.corruptionExposure - 2 * deltaSec);\n    }\n\n    // Affliction messages at thresholds (no more than once per 15s)\n    const now = Date.now();\n    if (now - this.lastCorruptionMessage > 15000) {\n      if (this.corruptionExposure > 75) {\n        const msgs = ['The void whispers your name...', 'Reality fractures around you.', 'Your vision darkens at the edges.', 'Something moves in the shadows...'];\n        this.showNotification(msgs[Math.floor(Math.random() * msgs.length)]);\n        this.lastCorruptionMessage = now;\n      } else if (this.corruptionExposure > 40) {\n        const msgs = ['A chill crawls up your spine.', 'The air feels thick with dread.', 'You sense eyes watching.'];\n        this.showNotification(msgs[Math.floor(Math.random() * msgs.length)]);\n        this.lastCorruptionMessage = now;\n      }\n    }\n\n    // Camera wobble at high corruption exposure (visual distortion)\n    if (this.corruptionExposure > 50) {\n      const wobbleIntensity = (this.corruptionExposure - 50) / 200; // 0–0.25\n      const wobbleX = Math.sin(now / 300) * wobbleIntensity * 3;\n      const wobbleY = Math.cos(now / 250) * wobbleIntensity * 2;\n      this.cameras.main.setFollowOffset(wobbleX, wobbleY);\n    } else {\n      this.cameras.main.setFollowOffset(0, 0);\n    }\n\n    // Stat penalties from corruption exposure\n    if (corruptionFx.slowStamina) {\n      this.playerController.staminaRegenMult *= 0.5;\n    }\n    if (this.corruptionExposure > 60) {\n      // Reduce damage output by up to 15% at max exposure\n      const dmgPenalty = 1 - (this.corruptionExposure - 60) / 400 * 0.6; // 0.85–1.0\n      const pEid = this.playerController.getEid();\n      Combat.damage[pEid] *= dmgPenalty;\n    }\n    if (corruptionFx.takeDamage) {\n      const pEid = this.playerController.getEid();\n      Health.current[pEid] = Math.max(0, Health.current[pEid] - 2 * deltaSec);\n    }\n\n    // Shadow entity spawning at extreme corruption\n    if (corruptionFx.spawnShadow) {\n      this.corruptionSpawnCooldown -= deltaSec;\n      if (this.corruptionSpawnCooldown <= 0) {\n        this.corruptionSpawnCooldown = 8 + Math.random() * 7; // 8–15s between spawns\n        // Spawn a shadow enemy near the player\n        const angle = Math.random() * Math.PI * 2;\n        const dist = 80 + Math.random() * 60;\n        const sx = pos.x + Math.cos(angle) * dist;\n        const sy = pos.y + Math.sin(angle) * dist;\n        createEnemy(sx, sy, 60, 12, 4, 150, 'shadow_wraith', AIBehavior.Chase);\n        this.showNotification('A shadow materializes from the corruption!');\n        this.audioManager.playSFX(SFX.ENEMY_HIT);\n      }\n    }\n\n    // Resolve mental state (Don't Starve Sanity) — drain/recovery tick\n    const nearCampfire = this.campfires.some(\n      cf => Phaser.Math.Distance.Between(pos.x, pos.y, cf.x, cf.y) < 80,\n    );\n    this.resolveManager.update(\n      deltaSec,\n      tileCorruption > 0.1,                          // inCorruption\n      this.lightingManager.isNight(),                 // inDarkness\n      this.shadowWorldManager.isInShadowWorld(),      // inShadowWorld\n      biomeStr === 'haven',                           // inCity\n      nearCampfire,                                   // atCampfire\n    );\n\n    // Apply resolve combat penalty / bonus\n    const resolveEffects = this.resolveManager.getEffects();\n    if (resolveEffects.combatMult !== 1.0) {\n      const pEid2 = this.playerController.getEid();\n      Combat.damage[pEid2] *= resolveEffects.combatMult;\n    }\n\n    // Expose resolve to registry for HUD\n    this.registry.set('resolve', this.resolveManager.getResolve());\n    this.registry.set('resolveMax', this.resolveManager.getMaxResolve());\n    this.registry.set('resolveTrauma', this.resolveManager.getTrauma());\n    this.registry.set('resolveEffects', resolveEffects);\n\n    // Bounty contract update\n    this.bountyContractManager.update(deltaSec, tileCorruption > 0.1);\n    const activeContract = this.bountyContractManager.getActive();\n    this.registry.set('bountyContract', activeContract);\n    this.registry.set('bountyContractProgress', this.bountyContractManager.getProgressPct());\n\n    // Expose weakness manager to registry\n    this.registry.set('enemyWeaknessManager', this.enemyWeaknessManager);\n\n    // Companion update (morale, knockout timer)\n    this.companionManager.update(deltaSec, tileCorruption > 0.1, this.lightingManager.isNight(), biomeStr === 'haven', nearCampfire);\n    this.registry.set('companion', this.companionManager.getActive());\n    this.registry.set('companionDef', this.companionManager.getActiveDef());\n\n    // Omen slot state to registry\n    this.registry.set('omens', this.omenSlotManager.getEquipped());\n    this.registry.set('omenOvercharged', this.omenSlotManager.isOvercharged());\n\n    // Boon run-scoped effects to registry\n    this.registry.set('boons', this.boonManager.getActiveBoons());\n    this.registry.set('boonEffects', this.boonManager.getCombinedEffects());\n\n    // Omen passive effects (HP regen, stamina regen)\n    const omenEffects = this.omenSlotManager.getCombinedEffects();\n    if (omenEffects.hpRegen) {\n      const pEid3 = this.playerController.getEid();\n      Health.current[pEid3] = Math.min(Health.max[pEid3], Health.current[pEid3] + omenEffects.hpRegen * deltaSec);\n    }\n    if (omenEffects.staminaRegen) {\n      const pEid3 = this.playerController.getEid();\n      Stamina.current[pEid3] = Math.min(Stamina.max[pEid3], Stamina.current[pEid3] + omenEffects.staminaRegen * deltaSec);\n    }\n\n    // Resolve visual distortion — camera tint darkens + wobble at low resolve\n    if (resolveEffects.grainIntensity > 0) {\n      const gi = resolveEffects.grainIntensity;\n      // Subtle desaturation via camera alpha on a dark overlay\n      const wobble = Math.sin(Date.now() / 400) * gi * 2;\n      const wobbleY = Math.cos(Date.now() / 350) * gi * 1.5;\n      // Stack with corruption wobble only if corruption isn't already dominating\n      if (this.corruptionExposure <= 50) {\n        this.cameras.main.setFollowOffset(wobble, wobbleY);\n      }\n    }\n\n    // Resolve phantom spawning (Don't Starve shadow creatures)\n    if (resolveEffects.spawnPhantoms) {\n      this.resolvePhantomCooldown = (this.resolvePhantomCooldown ?? 10) - deltaSec;\n      if (this.resolvePhantomCooldown <= 0) {\n        this.resolvePhantomCooldown = 12 + Math.random() * 8; // 12–20s between spawns\n        const angle = Math.random() * Math.PI * 2;\n        const dist = 100 + Math.random() * 60;\n        const sx = pos.x + Math.cos(angle) * dist;\n        const sy = pos.y + Math.sin(angle) * dist;\n        createEnemy(sx, sy, 40, 8, 2, 120, 'shadow_phantom', AIBehavior.Ambush);\n        this.showNotification('Something stirs in the darkness of your mind...');\n      }\n    } else {\n      this.resolvePhantomCooldown = 10;\n    }\n\n    // Ability cooldown tick\n    this.abilityManager.update(deltaSec);\n\n    // Shadow world channeling/cooldown\n    this.shadowWorldManager.update(Date.now());\n\n    // Lighting — time-of-day tint + biome ambient + point lights\n    const hour = date.hour + date.minute / 60;\n    this.lightingManager.update(hour, biomeStr, pos.x, pos.y);\n\n    // Corruption visual overlay\n    const cam = this.cameras.main;\n    this.corruptionOverlay.update(deltaSec, cam.scrollX, cam.scrollY, cam.width / cam.zoom, cam.height / cam.zoom);\n\n    // Particles — weather + combat effects\n    this.particleManager.update(deltaSec, cam.scrollX, cam.scrollY, cam.width / cam.zoom, cam.height / cam.zoom);\n\n    // Weapon echo charge decay\n    this.weaponEchoManager.update(deltaSec);\n\n    // Chunk streaming around player\n    const screenPos = IsometricHelper.worldToScreen(pos.x / 32, pos.y / 32);\n    this.chunkManager.update(screenPos.x, screenPos.y);\n\n    // Update dungeon/settlement entrance labels visibility\n    this.updateEntranceLabels(pos.x, pos.y);\n\n    // Update floating notifications\n    this.updateNotifications(deltaSec);\n\n    // --- Player death check (with Death Defiance) ---\n    const pEid = this.playerController.getEid();\n    if (Health.current[pEid] <= 0 && !this.playerDead) {\n      const traumaDisablesDefiance = this.resolveManager.getTrauma()?.disableDeathDefiance ?? false;\n      if (this.deathDefianceCharges > 0 && !this.pactManager.isActive(PactCondition.NoSecondChance) && !traumaDisablesDefiance) {\n        // Death Defiance: consume a charge, revive with 50% HP\n        this.deathDefianceCharges--;\n        Health.current[pEid] = Math.round(Health.max[pEid] * 0.5);\n        this.triggerScreenFlash(0xffffff, 0.4);\n        this.cameras.main.shake(200, 0.015);\n        this.audioManager.playSFX(SFX.LEVEL_UP);\n        this.showNotification(`Death Defiance! (${this.deathDefianceCharges}/${this.maxDeathDefianceCharges} remaining)`);\n        this.particleManager.emit('levelUp', Position.x[pEid], Position.y[pEid]);\n        // Brief invincibility (2 seconds)\n        grantIFrames(pEid, 2000);\n      } else {\n        this.handlePlayerDeath();\n      }\n    }\n\n    // Auto-save\n    this.saveManager.updateAutoSave(delta, {\n      x: Position.x[pEid],\n      y: Position.y[pEid],\n      hp: this.playerController.getHealth().current,\n      maxHp: this.playerController.getHealth().max,\n      stamina: this.playerController.getStamina().current,\n      maxStamina: this.playerController.getStamina().max,\n      level: Combat.level[pEid],\n      xp: Combat.xp[pEid],\n    });\n\n    // Debug text\n    const biomeDef = BIOME_DEFS[biomeId];\n    this.coordText.setText(`Tile: ${tilePos.tileX}, ${tilePos.tileY}`);\n    this.biomeText.setText(`Biome: ${biomeDef.name} (x${biomeDef.difficultyMult})`);\n    this.timeText.setText(`${this.timeManager.getDateString()} ${this.timeManager.getTimeString()}`);\n    this.weatherText.setText(`Weather: ${this.weatherManager.getWeatherType()} (${Math.round(this.weatherManager.getVisibility() * 100)}% vis)`);\n  }\n\n  // =========================================================================\n  // INTERACTION HANDLER (E key)\n  // =========================================================================\n\n  private handleInteraction(): void {\n    const pos = this.playerController.getPosition();\n\n    // Priority 1: NPC dialogue\n    const npc = this.npcManager.getInteractableNPC();\n    if (npc) {\n      this.resolveManager.onNPCInteraction(); // Resolve recovery from friendly NPC\n      this.openNPCDialogue(npc.getDef());\n      return;\n    }\n\n    // Priority 2: Dungeon entrance\n    for (const entrance of this.dungeonEntrances) {\n      const dist = Phaser.Math.Distance.Between(pos.x, pos.y, entrance.x, entrance.y);\n      if (dist <= INTERACTION_RADIUS) {\n        this.enterDungeon(entrance.dungeonId);\n        return;\n      }\n    }\n\n    // Priority 3: Settlement entrance\n    for (const entrance of this.settlementEntrances) {\n      const dist = Phaser.Math.Distance.Between(pos.x, pos.y, entrance.x, entrance.y);\n      if (dist <= INTERACTION_RADIUS) {\n        this.enterSettlement(entrance.settlementId);\n        return;\n      }\n    }\n\n    // Priority 4: Storage chest (world tile object)\n    const facing = this.playerController.getFacing();\n    const facingTile = IsometricHelper.pixelToTile(pos.x + facing.x * 48, pos.y + facing.y * 48);\n    const objAtTile = this.chunkManager.getObjectAt(facingTile.tileX, facingTile.tileY);\n    if (objAtTile === ObjectType.Chest) {\n      this.openStorageChest(facingTile.tileX, facingTile.tileY);\n      return;\n    }\n\n    // Priority 5: Rift portal\n    for (const rift of this.riftEntrances) {\n      const dist = Phaser.Math.Distance.Between(pos.x, pos.y, rift.x, rift.y);\n      if (dist <= INTERACTION_RADIUS) {\n        this.enterRift();\n        return;\n      }\n    }\n\n    // Priority 6: Building interior entrance\n    for (const bldg of this.buildingEntrances) {\n      const dist = Phaser.Math.Distance.Between(pos.x, pos.y, bldg.x, bldg.y);\n      if (dist <= INTERACTION_RADIUS) {\n        this.enterBuilding(bldg.interiorId, bldg.name);\n        return;\n      }\n    }\n\n    // Priority 7: NG+ portal at Haven center (0,0)\n    if (this.ngPlusPortalActive) {\n      const distToPortal = Phaser.Math.Distance.Between(pos.x, pos.y, 0, 0);\n      if (distToPortal <= INTERACTION_RADIUS * 2) {\n        this.openNGPlusDialog();\n        return;\n      }\n    }\n\n    // Priority 8: Campfire rest (hold SHIFT+E to kindle with Spirit Ember)\n    for (const campfire of this.campfires) {\n      const dist = Phaser.Math.Distance.Between(pos.x, pos.y, campfire.x, campfire.y);\n      if (dist <= INTERACTION_RADIUS) {\n        const shift = this.input.keyboard?.addKey('SHIFT')?.isDown ?? false;\n        if (shift && campfire.kindleLevel < 3) {\n          this.kindleCampfire(campfire);\n        } else {\n          this.restAtCampfire(campfire);\n        }\n        return;\n      }\n    }\n\n    // Priority 9: World shortcut — unlock or fast travel\n    for (const sc of this.shortcutEntrances) {\n      const dist = Phaser.Math.Distance.Between(pos.x, pos.y, sc.x, sc.y);\n      if (dist <= INTERACTION_RADIUS) {\n        this.interactWithShortcut(sc.shortcutId, sc.x, sc.y);\n        return;\n      }\n    }\n\n    // Priority 10: Scar Reading — read memories from fallen enemies\n    for (let i = this.recentDeadEnemies.length - 1; i >= 0; i--) {\n      const dead = this.recentDeadEnemies[i];\n      const dist = Phaser.Math.Distance.Between(pos.x, pos.y, dead.x, dead.y);\n      if (dist <= INTERACTION_RADIUS) {\n        const memory = this.scarReadingManager.readEnemyMemory(dead.enemyId, 'dead');\n        if (memory) {\n          this.showScarReadingOverlay(memory.text);\n          this.recentDeadEnemies.splice(i, 1);\n          return;\n        }\n      }\n    }\n  }\n\n  private enterRift(): void {\n    this.riftManager.startRift();\n    const floor = this.riftManager.getCurrentFloor();\n    this.showNotification(`Entering Rift — Floor ${floor?.floor ?? 1}`);\n    this.audioManager.playSFX(SFX.DOOR_OPEN);\n    // Transition to dungeon scene in rift mode\n    const returnPos = this.playerController.getPosition();\n    this.cameras.main.fadeOut(400, 0, 0, 0);\n    this.time.delayedCall(450, () => {\n      this.cleanUp();\n      this.scene.start('DungeonScene', {\n        dungeonId: 'rift',\n        returnX: returnPos.x,\n        returnY: returnPos.y,\n      });\n    });\n  }\n\n  private enterBuilding(interiorId: string, buildingName: string): void {\n    const entered = this.interiorManager.enterInterior(interiorId);\n    if (!entered) {\n      this.showNotification(`Cannot enter ${buildingName}.`);\n      return;\n    }\n    this.audioManager.playSFX(SFX.DOOR_OPEN);\n    this.showNotification(`Entered ${buildingName}`);\n\n    // Inn/house: restore HP and stamina\n    if (interiorId === 'inn' || interiorId === 'player_home') {\n      const pEid = this.playerController.getEid();\n      Health.current[pEid] = Health.max[pEid];\n      Stamina.current[pEid] = Stamina.max[pEid];\n      this.showNotification('Fully rested — HP & Stamina restored!');\n    }\n\n    // Temple: restore HP\n    if (interiorId === 'temple') {\n      const pEid = this.playerController.getEid();\n      Health.current[pEid] = Health.max[pEid];\n      this.showNotification('Blessed — HP fully restored!');\n    }\n\n    // Auto-exit after a short delay (no interior scene yet)\n    this.time.delayedCall(1500, () => {\n      this.interiorManager.exitInterior();\n    });\n  }\n\n  // =========================================================================\n  // WORLD SHORTCUT SYSTEM\n  // =========================================================================\n\n  private interactWithShortcut(shortcutId: string, entranceX: number, entranceY: number): void {\n    if (this.shortcutManager.isUnlocked(shortcutId)) {\n      // Already unlocked — teleport to the other end\n      const pos = this.playerController.getPosition();\n      const dest = this.shortcutManager.getDestination(shortcutId, pos.x, pos.y);\n      if (dest) {\n        this.audioManager.playSFX(SFX.DOOR_OPEN);\n        this.cameras.main.fadeOut(300, 0, 0, 0);\n        this.time.delayedCall(350, () => {\n          const pEid = this.playerController.getEid();\n          Position.x[pEid] = dest.x;\n          Position.y[pEid] = dest.y;\n          this.cameras.main.fadeIn(300, 0, 0, 0);\n          const def = SHORTCUT_DB.get(shortcutId);\n          this.showNotification(`Traveled via ${def?.name ?? 'shortcut'}`);\n        });\n      }\n    } else {\n      // Not yet unlocked — try to pay the cost\n      const def = SHORTCUT_DB.get(shortcutId);\n      if (!def) return;\n      const cost = def.cost;\n\n      // Check if player can afford\n      let canAfford = true;\n      if (cost.gold && this.inventoryManager.getGold() < cost.gold) canAfford = false;\n      if (cost.itemId && cost.itemQty) {\n        const count = this.inventoryManager.countItem(cost.itemId);\n        if (count < cost.itemQty) canAfford = false;\n      }\n\n      if (!canAfford) {\n        let costStr = '';\n        if (cost.gold) costStr += `${cost.gold} gold`;\n        if (cost.itemId && cost.itemQty) {\n          if (costStr) costStr += ' + ';\n          costStr += `${cost.itemQty}x ${cost.itemId}`;\n        }\n        this.showNotification(`Cannot unlock ${def.name}. Need: ${costStr}`);\n        return;\n      }\n\n      // Pay cost\n      if (cost.gold) this.inventoryManager.addGold(-cost.gold);\n      if (cost.itemId && cost.itemQty) this.inventoryManager.removeItem(cost.itemId, cost.itemQty);\n\n      // Unlock\n      this.shortcutManager.unlock(shortcutId);\n    }\n  }\n\n  // =========================================================================\n  // CAMPFIRE REST SYSTEM\n  // =========================================================================\n\n  /** Place a campfire at the player's current position (from inventory item) */\n  placeCampfire(): void {\n    const pos = this.playerController.getPosition();\n\n    // Don't allow too-close placement to existing campfires\n    for (const cf of this.campfires) {\n      if (Phaser.Math.Distance.Between(pos.x, pos.y, cf.x, cf.y) < 100) {\n        this.showNotification('Too close to an existing campfire.');\n        return;\n      }\n    }\n\n    const marker = this.add.image(pos.x, pos.y - 8, 'placeholder')\n      .setTint(0xff8800).setScale(0.5).setDepth(200);\n    const label = this.add.text(pos.x, pos.y - 24, 'Campfire', {\n      fontFamily: 'monospace', fontSize: '8px', color: '#ff8800',\n      stroke: '#000000', strokeThickness: 2,\n    }).setOrigin(0.5).setDepth(201).setVisible(false);\n\n    this.campfires.push({ x: pos.x, y: pos.y, marker, label, kindleLevel: 0 });\n    this.showNotification('Campfire placed. Press E near it to rest.');\n    this.audioManager.playSFX(SFX.ITEM_PICKUP);\n  }\n\n  /** Rest at a campfire — restore HP/stamina, set respawn, apply kindle buffs */\n  private restAtCampfire(cf: { x: number; y: number; kindleLevel: number }): void {\n    const pEid = this.playerController.getEid();\n\n    // Set as respawn point\n    this.lastCampfirePos = { x: cf.x, y: cf.y };\n\n    // Restore HP and stamina\n    Health.current[pEid] = Health.max[pEid];\n    Stamina.current[pEid] = Stamina.max[pEid];\n\n    // Clear corruption exposure (rest purifies the mind)\n    this.corruptionExposure = Math.max(0, this.corruptionExposure - 30);\n\n    // Refill death defiance charges on campfire rest\n    this.deathDefianceCharges = this.maxDeathDefianceCharges;\n\n    // Respawn enemies (Dark Souls pattern — rest resets the world)\n    resetSpawnedChunks();\n\n    // Apply kindle-level buffs (last 5 min per kindle level)\n    if (cf.kindleLevel >= 1) {\n      // Kindle 1: stamina regen buff (+3/sec for 5 min)\n      this.activeBuffs.push({ type: 'regen', magnitude: 3, remaining: 300 * cf.kindleLevel });\n      this.showNotification(`Kindle ${cf.kindleLevel}: Regeneration buff active.`);\n    }\n    if (cf.kindleLevel >= 2) {\n      // Kindle 2: +15% damage buff (5 min)\n      this.activeBuffs.push({ type: 'strength', magnitude: 8, remaining: 300 });\n      this.showNotification('Kindle 2: Strength buff active.');\n    }\n    if (cf.kindleLevel >= 3) {\n      // Kindle 3: full buffs + this campfire is a fast travel point\n      this.activeBuffs.push({ type: 'defense', magnitude: 5, remaining: 300 });\n      this.showNotification('Kindle 3: Defense buff active. Fast travel unlocked.');\n    }\n\n    // Camera: brief fade to black and back (resting transition)\n    this.cameras.main.fadeOut(400, 0, 0, 0);\n    this.inputBlocked = true;\n\n    this.time.delayedCall(600, () => {\n      this.cameras.main.fadeIn(400, 0, 0, 0);\n      this.inputBlocked = false;\n    });\n\n    this.showNotification('Rested at campfire. HP & Stamina restored. Enemies respawned.');\n    this.audioManager.playSFX(SFX.LEVEL_UP);\n  }\n\n  /** Kindle a campfire by spending a Spirit Ember (increases kindle level 0→1→2→3) */\n  private kindleCampfire(cf: { x: number; y: number; kindleLevel: number; marker: Phaser.GameObjects.Image; label: Phaser.GameObjects.Text }): void {\n    if (cf.kindleLevel >= 3) {\n      this.showNotification('This campfire is fully kindled.');\n      return;\n    }\n\n    // Check for spirit_ember in inventory\n    const removed = this.inventoryManager.removeItem('spirit_ember', 1);\n    if (removed < 1) {\n      this.showNotification('Need a Spirit Ember to kindle this campfire.');\n      return;\n    }\n\n    cf.kindleLevel++;\n    // Visual feedback: campfire tint gets brighter\n    const KINDLE_TINTS = [0xff8800, 0xffaa33, 0xffcc66, 0xffee99];\n    cf.marker.setTint(KINDLE_TINTS[cf.kindleLevel] ?? 0xffee99);\n    cf.label.setText(`Campfire +${cf.kindleLevel}`);\n\n    this.triggerScreenFlash(0xff8800, 0.2);\n    this.audioManager.playSFX(SFX.LEVEL_UP);\n    this.particleManager.emit('sparks', cf.x, cf.y);\n    this.showNotification(`Campfire kindled to level ${cf.kindleLevel}!`);\n    if (cf.kindleLevel === 3) {\n      this.showNotification('Max kindle! This campfire is now a fast travel point.');\n    }\n  }\n\n  private openStorageChest(tileX: number, tileY: number): void {\n    // Use tile coordinates as a unique storage label\n    const storageLabel = `chest_${tileX}_${tileY}`;\n\n    // Find existing or create new storage container for this chest\n    const allStorages = this.storageManager.getAllStorages('overworld');\n    let storage = allStorages.find(s => s.label === storageLabel);\n    if (!storage) {\n      const id = this.storageManager.createStorage(tileX, tileY, 'overworld', storageLabel);\n      storage = this.storageManager.getStorage(id)!;\n    }\n\n    const uiScene = this.scene.get('UIScene') as import('./UIScene').UIScene;\n    if (!uiScene || !storage) return;\n\n    const storageUI = uiScene.getStorageUI();\n    storageUI.openWithStorage(storage.id, storage.slots, (id, slots) => {\n      this.storageManager.updateSlots(id, slots);\n    });\n    this.audioManager.playSFX(SFX.DOOR_OPEN);\n    this.showNotification('Chest opened');\n  }\n\n  private openNPCDialogue(npcDef: import('../data/npcs').NPCDef): void {\n    const dialogueScene = this.scene.get('DialogueScene') as DialogueScene;\n    if (dialogueScene) {\n      this.scene.pause();\n      dialogueScene.openDialogue(npcDef);\n    }\n  }\n\n  private enterDungeon(dungeonId: string): void {\n    this.showNotification(`Entering dungeon...`);\n    this.audioManager.playSFX(SFX.DOOR_OPEN);\n    const pos = this.playerController.getPosition();\n    this.cameras.main.fadeOut(400, 0, 0, 0);\n    this.time.delayedCall(500, () => {\n      this.cleanUp();\n      this.scene.start('DungeonScene', { dungeonId, floorLevel: 1, returnX: pos.x, returnY: pos.y });\n    });\n  }\n\n  private enterSettlement(settlementId: string): void {\n    this.showNotification(`Entering settlement...`);\n    this.cameras.main.fadeOut(400, 0, 0, 0);\n    this.time.delayedCall(500, () => {\n      this.cleanUp();\n      this.scene.start('SettlementScene', { settlementId });\n    });\n  }\n\n  // =========================================================================\n  // ENEMY SPRITE MANAGEMENT\n  // =========================================================================\n\n  private createEnemyAnimations(): void {\n    if (this.enemyAnimsCreated) return;\n    this.enemyAnimsCreated = true;\n\n    const bases = ['enemy_mushroom', 'enemy_goblin', 'enemy_skeleton', 'enemy_flyingeye'];\n    const animDefs: { suffix: string; repeat: number }[] = [\n      { suffix: 'idle', repeat: -1 },\n      { suffix: 'run', repeat: -1 },\n      { suffix: 'attack', repeat: 0 },\n      { suffix: 'hit', repeat: 0 },\n      { suffix: 'death', repeat: 0 },\n    ];\n\n    for (const base of bases) {\n      for (const anim of animDefs) {\n        // Flying eye uses 'flight' instead of 'idle', 'run' mapped to 'flight'\n        let textureKey: string;\n        if (base === 'enemy_flyingeye') {\n          if (anim.suffix === 'idle' || anim.suffix === 'run') {\n            textureKey = 'enemy_flyingeye_flight';\n          } else {\n            textureKey = `${base}_${anim.suffix}`;\n          }\n        } else if (base === 'enemy_skeleton' && anim.suffix === 'run') {\n          textureKey = 'enemy_skeleton_walk';\n        } else {\n          textureKey = `${base}_${anim.suffix}`;\n        }\n\n        const animKey = `${base}_${anim.suffix}`;\n        if (this.anims.exists(animKey)) continue;\n        if (!this.textures.exists(textureKey)) continue;\n\n        const frames = this.anims.generateFrameNumbers(textureKey, {});\n        if (frames.length === 0) continue;\n\n        this.anims.create({\n          key: animKey,\n          frames,\n          frameRate: 8,\n          repeat: anim.repeat,\n        });\n      }\n    }\n  }\n\n  private syncEnemySprites(): void {\n    const entities = enemyQuery(ecsWorld);\n    const activeEids = new Set<number>();\n\n    for (const eid of entities) {\n      activeEids.add(eid);\n\n      if (Health.current[eid] <= 0) {\n        // Dead enemy: destroy sprite and HP bar\n        const sprite = this.enemySprites.get(eid);\n        if (sprite) {\n          sprite.destroy();\n          this.enemySprites.delete(eid);\n        }\n        const hpBar = this.enemyHPBars.get(eid);\n        if (hpBar) {\n          hpBar.destroy();\n          this.enemyHPBars.delete(eid);\n        }\n        continue;\n      }\n\n      let sprite = this.enemySprites.get(eid);\n      if (!sprite) {\n        // Determine texture from ECS\n        const texName = getTextureName(ECSSprite.textureId[eid]);\n        const textureKey = this.textures.exists(texName) ? texName : 'enemy';\n\n        sprite = this.add.sprite(Position.x[eid], Position.y[eid], textureKey)\n          .setDepth(4000)\n          .setScale(0.4);\n        this.enemySprites.set(eid, sprite);\n\n        // Elite affix visual: tint + slight scale up\n        const a1 = EliteAffix.affix1[eid];\n        const a2 = EliteAffix.affix2[eid];\n        if (a1 !== 0) {\n          const affixDef = AFFIXES_LOOKUP[a1];\n          if (affixDef) sprite.setTint(affixDef.tint);\n          sprite.setScale(a2 !== 0 ? 0.55 : 0.48); // Dual-affix elites are bigger\n        }\n\n        // Start idle animation if available\n        if (this.enemyAnimsCreated) {\n          const baseName = texName.replace(/_idle$|_flight$/, '');\n          const idleAnim = `${baseName}_idle`;\n          if (this.anims.exists(idleAnim)) {\n            sprite.play(idleAnim);\n          }\n        }\n      }\n\n      // Sync position\n      sprite.setPosition(Position.x[eid], Position.y[eid]);\n\n      // Switch animation based on AI state\n      if (this.enemyAnimsCreated) {\n        const texName = getTextureName(ECSSprite.textureId[eid]);\n        const baseName = texName.replace(/_idle$|_flight$/, '');\n        const aiState = AI.state[eid];\n        let desiredAnim: string;\n        switch (aiState) {\n          case AIState.Chase:\n            desiredAnim = `${baseName}_run`;\n            break;\n          case AIState.Attack:\n            desiredAnim = `${baseName}_attack`;\n            break;\n          default:\n            desiredAnim = `${baseName}_idle`;\n        }\n        if (this.anims.exists(desiredAnim) && sprite.anims.currentAnim?.key !== desiredAnim) {\n          sprite.play(desiredAnim, true);\n        }\n      }\n\n      // Telegraph visual: red flash when enemy is winding up an attack\n      const telegraphT = AI.telegraphTimer[eid];\n      if (telegraphT > 0) {\n        // Pulsing red tint — flashes faster as telegraph nears completion\n        const pct = telegraphT / (AI.telegraphDuration[eid] || 1);\n        const flash = Math.sin(Date.now() * (0.01 + (1 - pct) * 0.03)) > 0;\n        sprite.setTint(flash ? 0xff3333 : 0xff8888);\n      } else if (sprite.getData('wasTelegraphing')) {\n        // Restore original tint when telegraph ends\n        const a1 = EliteAffix.affix1[eid];\n        if (a1 !== 0) {\n          const affixDef = AFFIXES_LOOKUP[a1];\n          if (affixDef) sprite.setTint(affixDef.tint);\n          else sprite.clearTint();\n        } else {\n          sprite.clearTint();\n        }\n      }\n      sprite.setData('wasTelegraphing', telegraphT > 0);\n\n      // Flip based on velocity\n      const vx = Position.x[eid] - (sprite.getData('lastX') ?? Position.x[eid]);\n      sprite.setData('lastX', Position.x[eid]);\n      if (vx < -0.1) sprite.setFlipX(true);\n      else if (vx > 0.1) sprite.setFlipX(false);\n\n      // Enemy HP bar (only when damaged)\n      const hpCurrent = Health.current[eid];\n      const hpMax = Health.max[eid];\n      if (hpCurrent < hpMax && hpMax > 0) {\n        let hpBar = this.enemyHPBars.get(eid);\n        if (!hpBar) {\n          hpBar = this.add.graphics().setDepth(4100);\n          this.enemyHPBars.set(eid, hpBar);\n        }\n        hpBar.clear();\n        const barW = 24;\n        const barH = 3;\n        const bx = Position.x[eid] - barW / 2;\n        const by = Position.y[eid] - 14;\n        const fill = Math.max(0, hpCurrent / hpMax);\n        hpBar.fillStyle(0x333333, 0.8);\n        hpBar.fillRect(bx, by, barW, barH);\n        hpBar.fillStyle(fill > 0.3 ? 0xcc3333 : 0xff0000, 0.9);\n        hpBar.fillRect(bx, by, barW * fill, barH);\n      } else {\n        // Full HP — hide bar\n        const hpBar = this.enemyHPBars.get(eid);\n        if (hpBar) {\n          hpBar.clear();\n        }\n      }\n    }\n\n    // Clean up sprites for entities that no longer exist\n    for (const [eid, sprite] of this.enemySprites) {\n      if (!activeEids.has(eid)) {\n        sprite.destroy();\n        this.enemySprites.delete(eid);\n      }\n    }\n    for (const [eid, hpBar] of this.enemyHPBars) {\n      if (!activeEids.has(eid)) {\n        hpBar.destroy();\n        this.enemyHPBars.delete(eid);\n      }\n    }\n  }\n\n  // =========================================================================\n  // LOOT SYSTEM\n  // =========================================================================\n\n  private processLootEvents(): void {\n    const events = flushLootEvents();\n    const playerEid = this.playerController.getEid();\n\n    for (const ev of events) {\n      this.createLootDrop(ev);\n\n      // --- Imprint unlock from boss kills ---\n      if (ev.enemyType) {\n        this.imprintManager.unlockFromBoss(ev.enemyType);\n      }\n\n      // --- XP/gold rewards from enemy kills (with festival + imprint/quirk multipliers) ---\n      if (ev.xpReward > 0) {\n        const imprintEffects = this.imprintManager.getCombinedEffects();\n        const quirkEffects = this.quirkManager.getCombinedEffects();\n        const xpMult = this.festivalXpMult * (imprintEffects.xpMult ?? 1) * (quirkEffects.xpMult ?? 1);\n        const xp = Math.round(ev.xpReward * xpMult);\n        this.skillManager.addXP('combat', xp);\n        Combat.xp[playerEid] += xp;\n\n        // Check level-up\n        const currentLevel = Combat.level[playerEid];\n        const xpNeeded = this.xpForLevel(currentLevel);\n        if (Combat.xp[playerEid] >= xpNeeded) {\n          Combat.level[playerEid]++;\n          Combat.xp[playerEid] -= xpNeeded;\n          this.particleManager.emit('levelUp', Position.x[playerEid], Position.y[playerEid]);\n          this.audioManager.playSFX(SFX.LEVEL_UP);\n          this.showNotification(`Level Up! → ${Combat.level[playerEid]}`);\n        }\n      }\n\n      if (ev.goldReward > 0) {\n        const imprintEffects = this.imprintManager.getCombinedEffects();\n        const quirkEffects = this.quirkManager.getCombinedEffects();\n        const goldMult = this.careerManager.getEffectiveIncomeMultiplier() * this.festivalGoldMult\n          * (imprintEffects.goldMult ?? 1) * (quirkEffects.goldMult ?? 1);\n        const finalGold = Math.round(ev.goldReward * goldMult);\n        this.inventoryManager.addGold(finalGold);\n        this.particleManager.emit('goldPickup', ev.x, ev.y);\n        this.showNotification(`+${finalGold} gold`);\n      }\n\n      // --- Weapon mastery XP from kills ---\n      if (ev.xpReward > 0) {\n        const weaponType = Combat.weaponType[playerEid] as WeaponType;\n        this.weaponMasteryManager.addXP(weaponType, Math.round(ev.xpReward * 0.5));\n      }\n\n      // --- Bestiary tracking ---\n      if (ev.xpReward > 0 && ev.enemyType) {\n        const bestiaryUI = this.registry.get('bestiaryUI') as { recordKill(id: string): void } | undefined;\n        if (bestiaryUI) {\n          bestiaryUI.recordKill(ev.enemyType);\n        }\n      }\n\n      // --- Achievement tracking ---\n      if (ev.xpReward > 0) {\n        this.achievementManager.trackProgress('enemies_defeated', 1);\n      }\n\n      // --- Lore fragment drop chance (Dark Souls-inspired) ---\n      if (ev.xpReward > 0) {\n        const fragId = this.codexManager.rollFragmentDrop(this.lastBiomeId, 'enemy_drop');\n        if (fragId) this.codexManager.discover(fragId);\n      }\n\n      // --- Resolve: enemy kill recovery (virtue resolve-per-kill) ---\n      if (ev.xpReward > 0) {\n        this.resolveManager.onEnemyKill();\n      }\n\n      // --- Bounty contract: notify kill ---\n      if (ev.xpReward > 0) {\n        const hpPct = Health.current[playerEid] / Health.max[playerEid];\n        this.bountyContractManager.onEnemyKill(hpPct);\n      }\n\n      // --- Enemy weakness: record kill for discovery ---\n      if (ev.enemyType) {\n        this.enemyWeaknessManager.recordKill(ev.enemyType);\n      }\n\n      // --- Track dead enemy for Scar Reading (Hollow Knight Dream Nail) ---\n      if (ev.enemyType) {\n        this.recentDeadEnemies.push({ x: ev.x, y: ev.y, enemyId: ev.enemyType, timer: 30 });\n      }\n    }\n  }\n\n  private createLootDrop(ev: LootEvent): void {\n    // Offset slightly to avoid stacking\n    const offsetX = (Math.random() - 0.5) * 20;\n    const offsetY = (Math.random() - 0.5) * 20;\n    const x = ev.x + offsetX;\n    const y = ev.y + offsetY;\n\n    // Rarity color: white → green → blue → purple → orange → red\n    const RARITY_HEX = ['#ffffff', '#00ff00', '#0088ff', '#aa00ff', '#ff8800', '#ff0000'];\n    const RARITY_NAMES = ['', '', '', 'Epic ', 'Legendary ', 'Mythic '];\n    const rarityColor = RARITY_HEX[ev.rarity] ?? '#ffffff';\n    const rarityPrefix = RARITY_NAMES[ev.rarity] ?? '';\n    const isHighRarity = ev.rarity >= 3; // Epic+\n\n    const sprite = this.add.image(x, y, 'item_drop').setDepth(3500);\n    // Tint sprite by rarity for visual distinction\n    if (ev.rarity >= 1) {\n      const RARITY_TINT = [0xffffff, 0x88ff88, 0x88bbff, 0xcc88ff, 0xffbb44, 0xff6666];\n      sprite.setTint(RARITY_TINT[ev.rarity] ?? 0xffffff);\n    }\n\n    const displayName = ITEM_DB.get(ev.itemId)?.name ?? ev.itemId;\n    const fontSize = isHighRarity ? '9px' : '8px';\n    const label = this.add.text(x, y - 10, `${rarityPrefix}${displayName}`, {\n      fontFamily: 'monospace',\n      fontSize,\n      color: rarityColor,\n      stroke: '#000000',\n      strokeThickness: isHighRarity ? 2 : 1,\n      fontStyle: isHighRarity ? 'bold' : 'normal',\n    }).setOrigin(0.5).setDepth(3501);\n\n    // Bounce-in animation (bigger bounce for higher rarity)\n    sprite.setScale(0);\n    this.tweens.add({\n      targets: sprite,\n      scaleX: isHighRarity ? 1.2 : 1,\n      scaleY: isHighRarity ? 1.2 : 1,\n      duration: isHighRarity ? 300 : 200,\n      ease: 'Back.easeOut',\n    });\n\n    // Sparkle particles for rare+ drops\n    if (ev.rarity >= 2) {\n      this.particleManager.emit('sparks', x, y);\n    }\n    if (ev.rarity >= 4) {\n      this.particleManager.emit('critFlash', x, y);\n    }\n\n    this.lootDrops.push({\n      sprite,\n      label,\n      itemId: ev.itemId,\n      quantity: ev.quantity,\n      x,\n      y,\n      despawnTimer: 60,\n    });\n  }\n\n  private checkLootPickup(): void {\n    const pos = this.playerController.getPosition();\n    const pickupRadius = 24;\n\n    for (let i = this.lootDrops.length - 1; i >= 0; i--) {\n      const drop = this.lootDrops[i];\n      const dist = Phaser.Math.Distance.Between(pos.x, pos.y, drop.x, drop.y);\n\n      if (dist <= pickupRadius) {\n        // Add to inventory\n        const leftover = this.inventoryManager.addItem(drop.itemId, drop.quantity);\n        const pickedUp = drop.quantity - leftover;\n\n        if (pickedUp > 0) {\n          this.showNotification(`+${pickedUp} ${ITEM_DB.get(drop.itemId)?.name ?? drop.itemId}`);\n          this.questManager.updateObjective('collect', drop.itemId, pickedUp);\n          this.particleManager.emit('goldPickup', drop.x, drop.y);\n          this.audioManager.playSFX(drop.itemId === 'gold_coin' ? SFX.GOLD_PICKUP : SFX.ITEM_PICKUP);\n        }\n\n        if (leftover > 0) {\n          // Inventory full — leave remaining on ground\n          drop.quantity = leftover;\n        } else {\n          // Fully picked up — remove\n          drop.sprite.destroy();\n          drop.label.destroy();\n          this.lootDrops.splice(i, 1);\n        }\n      }\n    }\n  }\n\n  private updateLootDrops(dt: number): void {\n    for (let i = this.lootDrops.length - 1; i >= 0; i--) {\n      const drop = this.lootDrops[i];\n      drop.despawnTimer -= dt;\n\n      // Blink when about to despawn\n      if (drop.despawnTimer < 5) {\n        drop.sprite.setAlpha(Math.sin(drop.despawnTimer * 8) * 0.5 + 0.5);\n        drop.label.setAlpha(drop.sprite.alpha);\n      }\n\n      if (drop.despawnTimer <= 0) {\n        drop.sprite.destroy();\n        drop.label.destroy();\n        this.lootDrops.splice(i, 1);\n      }\n    }\n  }\n\n  // =========================================================================\n  // DAMAGE FLOATERS\n  // =========================================================================\n\n  private processDamageEvents(): void {\n    const events = flushDamageEvents();\n    const playerEid = this.playerController.getEid();\n\n    let maxHitstop = 0; // Track strongest hitstop this frame\n\n    const enemyDmgMult: number = this.registry.get('weatherEnemyDmgMult') ?? 1;\n\n    for (const ev of events) {\n      // Apply weather damage multiplier to enemy→player hits\n      if (ev.targetEid === playerEid && enemyDmgMult !== 1) {\n        ev.damage = Math.round(ev.damage * enemyDmgMult);\n      }\n      // Omen Overcharged: player takes double damage\n      if (ev.targetEid === playerEid && this.omenSlotManager.isOvercharged()) {\n        ev.damage = Math.round(ev.damage * 2);\n      }\n\n      const isKill = Health.current[ev.targetEid] <= 0;\n      const isPlayerHit = ev.targetEid === playerEid;\n\n      // --- Damage number (scale size by damage magnitude) ---\n      const baseFontSize = ev.isCrit ? 16 : 11;\n      const dmgScale = Math.min(ev.damage / 15, 2); // bigger numbers for bigger hits\n      const fontSize = Math.round(baseFontSize + dmgScale * 2);\n      const color = isKill ? '#ff2222' : ev.isBackstab ? '#ff88ff' : ev.isCrit ? '#ffaa00' : '#ff4444';\n      const suffix = isKill ? ' KILL' : ev.isBackstab ? ' BACKSTAB' : ev.isCrit ? '!' : '';\n      const comboSuffix = ev.comboCount >= 3 ? ` x${ev.comboCount}` : '';\n      const text = this.add.text(ev.x, ev.y - 12, `${Math.round(ev.damage)}${suffix}${comboSuffix}`, {\n        fontFamily: 'monospace',\n        fontSize: `${fontSize}px`,\n        color,\n        fontStyle: (ev.isCrit || isKill) ? 'bold' : 'normal',\n        stroke: '#000000',\n        strokeThickness: ev.isCrit ? 3 : 1,\n      }).setOrigin(0.5).setDepth(9500);\n\n      // Pop-in scale tween for juicy feedback\n      text.setScale(ev.isCrit ? 1.6 : 1.2);\n      this.tweens.add({\n        targets: text,\n        scale: 1,\n        duration: ev.isCrit ? 150 : 100,\n        ease: 'Back.easeOut',\n      });\n\n      this.damageTexts.push({ text, life: 0 });\n\n      // --- Hitstop calculation ---\n      if (isKill) {\n        maxHitstop = Math.max(maxHitstop, KILL_HITSTOP_DURATION_MS);\n      } else if (ev.isCrit) {\n        maxHitstop = Math.max(maxHitstop, CRIT_HITSTOP_DURATION_MS);\n      } else if (!isPlayerHit) {\n        maxHitstop = Math.max(maxHitstop, HITSTOP_DURATION_MS);\n      }\n\n      // --- Camera shake (crits/kills stronger, player hits strongest) ---\n      if (isPlayerHit) {\n        this.audioManager.playSFX(SFX.PLAYER_HIT);\n        this.cameras.main.shake(150, 0.012);\n        this.resolveManager.onPlayerHit();\n        this.bountyContractManager.onPlayerHit();\n      } else if (isKill) {\n        this.audioManager.playSFX(ev.isCrit ? SFX.CRIT_HIT : SFX.ENEMY_HIT);\n        this.cameras.main.shake(180, 0.010);\n      } else if (ev.isCrit) {\n        this.audioManager.playSFX(SFX.CRIT_HIT);\n        this.cameras.main.shake(140, 0.008);\n      } else {\n        this.audioManager.playSFX(SFX.ENEMY_HIT);\n        // Normal hits: subtle camera nudge for feedback\n        this.cameras.main.shake(60, 0.003);\n      }\n\n      // --- Screen flash on crits and kills ---\n      if (ev.isCrit || isKill) {\n        this.triggerScreenFlash(isKill ? 0xff2222 : 0xffffff, isKill ? 0.25 : 0.15);\n      }\n\n      // --- Combat particles ---\n      this.particleManager.emit('blood', ev.x, ev.y);\n      if (isKill) {\n        // Extra particles on kill\n        this.particleManager.emit('blood', ev.x, ev.y);\n        this.particleManager.emit('critFlash', ev.x, ev.y);\n        this.particleManager.emit('sparks', ev.x, ev.y);\n      } else if (ev.isCrit) {\n        this.particleManager.emit('critFlash', ev.x, ev.y);\n        this.particleManager.emit('sparks', ev.x, ev.y);\n      } else {\n        this.particleManager.emit('sparks', ev.x, ev.y);\n      }\n\n      // --- Achievement tracking (player→enemy hits only) ---\n      if (!isPlayerHit) {\n        this.achievementManager.trackProgress('damage_dealt_total', Math.round(ev.damage));\n        if (ev.isCrit) {\n          this.achievementManager.trackProgress('critical_hits', 1);\n        }\n      }\n\n      // --- Weapon Echo: record kill type for combo patterns ---\n      if (isKill && !isPlayerHit) {\n        const killType: KillTypeTag = ev.isBackstab ? 'backstab'\n          : ev.isCrit ? 'crit'\n          : 'normal';\n        this.weaponEchoManager.recordKill(killType, Math.round(ev.damage));\n      }\n\n      // --- Quirk behavior tracking from combat ---\n      if (!isPlayerHit) {\n        if (ev.isBackstab && isKill) this.quirkManager.recordBehavior('backstab_often');\n        if (isKill) {\n          // Night kills → fight_in_dark\n          const hour = this.timeManager.getDate().hour;\n          if (hour >= 20 || hour < 6) this.quirkManager.recordBehavior('fight_in_dark');\n        }\n      }\n      if (isPlayerHit) {\n        this.quirkManager.recordBehavior('take_many_hits');\n      }\n    }\n\n    // --- Apply hitstop (brief time freeze for impact feel) ---\n    if (maxHitstop > 0 && this.hitstopTimer <= 0) {\n      this.hitstopTimer = maxHitstop;\n      this.time.timeScale = 0.05; // near-freeze\n      this.time.delayedCall(maxHitstop, () => {\n        this.time.timeScale = 1;\n        this.hitstopTimer = 0;\n      });\n    }\n  }\n\n  /** Process parry events — visual + audio feedback for successful parries */\n  private processParryEvents(): void {\n    const parries = flushParryEvents();\n    for (const ev of parries) {\n      // Parry floating text\n      const label = ev.isRiposte ? 'RIPOSTE!' : 'PARRY!';\n      const color = ev.isRiposte ? '#ffdd00' : '#44ccff';\n      const fontSize = ev.isRiposte ? 18 : 14;\n      const text = this.add.text(ev.x, ev.y - 20, label, {\n        fontFamily: 'monospace',\n        fontSize: `${fontSize}px`,\n        color,\n        fontStyle: 'bold',\n        stroke: '#000000',\n        strokeThickness: 3,\n      }).setOrigin(0.5).setDepth(9500);\n\n      // Pop-in + float up animation\n      text.setScale(1.8);\n      this.tweens.add({\n        targets: text,\n        scale: 1,\n        y: ev.y - 40,\n        alpha: 0,\n        duration: 800,\n        ease: 'Back.easeOut',\n        onComplete: () => text.destroy(),\n      });\n\n      // Camera shake (stronger for riposte)\n      this.cameras.main.shake(ev.isRiposte ? 200 : 120, ev.isRiposte ? 0.012 : 0.006);\n\n      // Screen flash (gold for riposte, cyan for parry)\n      this.triggerScreenFlash(ev.isRiposte ? 0xffdd00 : 0x44ccff, ev.isRiposte ? 0.2 : 0.12);\n\n      // Spark particles at parry location\n      this.particleManager.emit('sparks', ev.x, ev.y);\n      if (ev.isRiposte) {\n        this.particleManager.emit('critFlash', ev.x, ev.y);\n      }\n\n      // SFX — use sword swing for parry (satisfying clang sound)\n      this.audioManager.playSFX(ev.isRiposte ? SFX.CRIT_HIT : SFX.SWORD_SWING);\n\n      // Bounty contract: parry tracking\n      this.bountyContractManager.onParry();\n\n      // Quirk: parry behavior tracking\n      this.quirkManager.recordBehavior('parry_often');\n    }\n  }\n\n  /** Show scar reading memory overlay (Hollow Knight Dream Nail-inspired) */\n  private showScarReadingOverlay(text: string): void {\n    // Destroy existing overlay\n    if (this.scarReadingOverlay) {\n      this.scarReadingOverlay.destroy();\n      this.scarReadingOverlay = null;\n    }\n\n    const cam = this.cameras.main;\n    const container = this.add.container(cam.centerX, cam.height - 80).setScrollFactor(0).setDepth(9800);\n\n    // Semi-transparent backdrop\n    const bg = this.add.rectangle(0, 0, Math.min(cam.width - 60, 500), 60, 0x000000, 0.7)\n      .setOrigin(0.5);\n    bg.setStrokeStyle(1, 0xddaa44, 0.6);\n\n    // Gold edge glow effect\n    const glow = this.add.rectangle(0, 0, Math.min(cam.width - 56, 504), 64, 0xddaa44, 0.15)\n      .setOrigin(0.5);\n\n    // Memory text — italic, gold tint\n    const memText = this.add.text(0, 0, `\"${text}\"`, {\n      fontFamily: 'serif',\n      fontSize: '13px',\n      color: '#eedd88',\n      fontStyle: 'italic',\n      wordWrap: { width: Math.min(cam.width - 100, 460) },\n      align: 'center',\n    }).setOrigin(0.5);\n\n    container.add([glow, bg, memText]);\n\n    // Fade in\n    container.setAlpha(0);\n    this.tweens.add({\n      targets: container,\n      alpha: 1,\n      duration: 400,\n      ease: 'Power2',\n    });\n\n    this.scarReadingOverlay = container;\n    this.scarReadingTimer = 4; // Show for 4 seconds\n\n    // Gold screen edge flash\n    this.triggerScreenFlash(0xddaa44, 0.12);\n    this.audioManager.playSFX(SFX.ITEM_PICKUP);\n\n    // Progress notification\n    const prog = this.scarReadingManager.getProgress();\n    this.showNotification(`Memory read (${prog.read}/${prog.total})`);\n  }\n\n  /** Tick scar reading overlay and dead enemy timers */\n  private updateScarReading(deltaSec: number): void {\n    // Tick dead enemy despawn timers\n    for (let i = this.recentDeadEnemies.length - 1; i >= 0; i--) {\n      this.recentDeadEnemies[i].timer -= deltaSec;\n      if (this.recentDeadEnemies[i].timer <= 0) {\n        this.recentDeadEnemies.splice(i, 1);\n      }\n    }\n\n    // Tick scar reading overlay display\n    if (this.scarReadingTimer > 0 && this.scarReadingOverlay) {\n      this.scarReadingTimer -= deltaSec;\n      if (this.scarReadingTimer <= 0) {\n        this.tweens.add({\n          targets: this.scarReadingOverlay,\n          alpha: 0,\n          duration: 600,\n          ease: 'Power2',\n          onComplete: () => {\n            if (this.scarReadingOverlay) {\n              this.scarReadingOverlay.destroy();\n              this.scarReadingOverlay = null;\n            }\n          },\n        });\n      }\n    }\n  }\n\n  /** Flash the screen with a color (for crits, kills, big hits) */\n  private triggerScreenFlash(color: number, alpha: number): void {\n    if (!this.screenFlash) {\n      this.screenFlash = this.add.rectangle(\n        this.cameras.main.centerX, this.cameras.main.centerY,\n        this.cameras.main.width, this.cameras.main.height,\n        color, 0\n      ).setScrollFactor(0).setDepth(9900);\n    }\n    this.screenFlash.setFillStyle(color, alpha);\n    this.tweens.add({\n      targets: this.screenFlash,\n      alpha: 0,\n      duration: 120,\n      ease: 'Power2',\n      onComplete: () => { if (this.screenFlash) this.screenFlash.setAlpha(0); },\n    });\n  }\n\n  private updateComboDisplay(): void {\n    const pEid = this.playerController.getEid();\n    const combo = ComboTracker.get(pEid);\n\n    if (combo && combo.count >= 2) {\n      const pos = this.playerController.getPosition();\n      if (!this.comboText) {\n        this.comboText = this.add.text(0, 0, '', {\n          fontFamily: 'monospace', fontSize: '14px', color: '#ffaa00',\n          fontStyle: 'bold', stroke: '#000000', strokeThickness: 3,\n        }).setOrigin(0.5).setDepth(9600);\n      }\n      this.comboText.setText(`${combo.count}x COMBO!`);\n      this.comboText.setPosition(pos.x, pos.y - 32);\n      this.comboText.setAlpha(1);\n      this.comboText.setVisible(true);\n\n      // Scale pulse based on combo size\n      const scale = 1 + Math.min(combo.count * 0.05, 0.5);\n      this.comboText.setScale(scale);\n    } else if (this.comboText) {\n      this.comboText.setVisible(false);\n    }\n  }\n\n  private updateDamageTexts(dt: number): void {\n    for (let i = this.damageTexts.length - 1; i >= 0; i--) {\n      const entry = this.damageTexts[i];\n      entry.life += dt;\n      entry.text.y -= 30 * dt;\n      entry.text.setAlpha(Math.max(0, 1 - entry.life / 0.8));\n\n      if (entry.life >= 0.8) {\n        entry.text.destroy();\n        this.damageTexts.splice(i, 1);\n      }\n    }\n  }\n\n  // =========================================================================\n  // DUNGEON & SETTLEMENT ENTRANCES\n  // =========================================================================\n\n  private createDungeonEntrances(): void {\n    for (const city of CITIES) {\n      if (city.hasDungeon && city.dungeonId) {\n        // Place dungeon entrance near city center (offset slightly)\n        const x = city.x * 32 + 80;\n        const y = city.y * 32 + 80;\n\n        const marker = this.add.image(x, y, 'item_drop')\n          .setTint(0xff4444)\n          .setScale(1.5)\n          .setDepth(4500);\n\n        const label = this.add.text(x, y - 16, `[E] ${city.name} Dungeon`, {\n          fontFamily: 'monospace',\n          fontSize: '9px',\n          color: '#ff8888',\n          stroke: '#000000',\n          strokeThickness: 2,\n        }).setOrigin(0.5).setDepth(4501).setVisible(false);\n\n        this.dungeonEntrances.push({ x, y, dungeonId: city.dungeonId, marker, label });\n      }\n\n      // Rift portal near cities with hasRiftPortal\n      if (city.hasRiftPortal) {\n        const rx = city.x * 32 - 80;\n        const ry = city.y * 32 + 80;\n\n        const rMarker = this.add.image(rx, ry, 'item_drop')\n          .setTint(0x9900ff)\n          .setScale(2)\n          .setDepth(4500);\n\n        const rLabel = this.add.text(rx, ry - 16, '[E] Rift Portal', {\n          fontFamily: 'monospace',\n          fontSize: '9px',\n          color: '#cc88ff',\n          stroke: '#000000',\n          strokeThickness: 2,\n        }).setOrigin(0.5).setDepth(4501).setVisible(false);\n\n        this.riftEntrances.push({ x: rx, y: ry, marker: rMarker, label: rLabel });\n      }\n    }\n  }\n\n  private createSettlementEntrances(): void {\n    // Settlement sites at fixed locations per biome\n    const sites = [\n      { x: 150, y: 150, id: 'haven_settlement' },\n      { x: 350 * 32, y: 0, id: 'rotwood_settlement' },\n      { x: 650 * 32, y: 0, id: 'ashlands_settlement' },\n    ];\n\n    for (const site of sites) {\n      const marker = this.add.image(site.x, site.y, 'item_drop')\n        .setTint(0x44ff44)\n        .setScale(1.5)\n        .setDepth(4500);\n\n      const label = this.add.text(site.x, site.y - 16, `[E] Settlement`, {\n        fontFamily: 'monospace',\n        fontSize: '9px',\n        color: '#88ff88',\n        stroke: '#000000',\n        strokeThickness: 2,\n      }).setOrigin(0.5).setDepth(4501).setVisible(false);\n\n      this.settlementEntrances.push({ x: site.x, y: site.y, settlementId: site.id, marker, label });\n    }\n  }\n\n  private createBuildingEntrances(): void {\n    let bIndex = 0;\n    for (const city of CITIES) {\n      for (const building of city.buildings) {\n        const interiorId = BUILDING_INTERIOR_MAP[building.type];\n        if (!interiorId) continue; // skip 'other' types with no interior\n\n        // Offset each building from the city center\n        const angle = (bIndex * 1.2) % (Math.PI * 2);\n        const radius = 60 + (bIndex % 3) * 40;\n        const bx = city.x * 32 + Math.cos(angle) * radius;\n        const by = city.y * 32 + Math.sin(angle) * radius;\n\n        const marker = this.add.image(bx, by, 'item_drop')\n          .setTint(0x44aaff)\n          .setScale(1.2)\n          .setDepth(4500);\n\n        const label = this.add.text(bx, by - 16, `[E] ${building.name}`, {\n          fontFamily: 'monospace',\n          fontSize: '9px',\n          color: '#88ccff',\n          stroke: '#000000',\n          strokeThickness: 2,\n        }).setOrigin(0.5).setDepth(4501).setVisible(false);\n\n        this.buildingEntrances.push({\n          x: bx, y: by,\n          interiorId,\n          name: building.name,\n          marker, label,\n        });\n        bIndex++;\n      }\n    }\n  }\n\n  private createShortcutEntrances(): void {\n    const allShortcuts = this.shortcutManager.getAllShortcuts();\n    for (const { def, unlocked } of allShortcuts) {\n      const color = unlocked ? 0x44ffaa : 0x886644;\n      const statusText = unlocked ? '[OPEN]' : '[LOCKED]';\n      const labelColor = unlocked ? '#44ffaa' : '#886644';\n\n      // Create marker at \"from\" end\n      const fromMarker = this.add.image(def.fromX, def.fromY - 8, 'placeholder')\n        .setTint(color).setScale(0.4).setDepth(200);\n      const fromLabel = this.add.text(def.fromX, def.fromY - 24, `${def.name} ${statusText}`, {\n        fontFamily: 'monospace', fontSize: '8px',\n        color: labelColor, stroke: '#000000', strokeThickness: 2,\n      }).setOrigin(0.5).setDepth(4501).setVisible(false);\n      this.shortcutEntrances.push({ x: def.fromX, y: def.fromY, shortcutId: def.id, marker: fromMarker, label: fromLabel });\n\n      // Create marker at \"to\" end\n      const toMarker = this.add.image(def.toX, def.toY - 8, 'placeholder')\n        .setTint(color).setScale(0.4).setDepth(200);\n      const toLabel = this.add.text(def.toX, def.toY - 24, `${def.name} ${statusText}`, {\n        fontFamily: 'monospace', fontSize: '8px',\n        color: labelColor, stroke: '#000000', strokeThickness: 2,\n      }).setOrigin(0.5).setDepth(4501).setVisible(false);\n      this.shortcutEntrances.push({ x: def.toX, y: def.toY, shortcutId: def.id, marker: toMarker, label: toLabel });\n    }\n  }\n\n  private updateEntranceLabels(playerX: number, playerY: number): void {\n    const showDist = INTERACTION_RADIUS * 2;\n\n    for (const entrance of this.dungeonEntrances) {\n      const dist = Phaser.Math.Distance.Between(playerX, playerY, entrance.x, entrance.y);\n      entrance.label.setVisible(dist <= showDist);\n    }\n\n    for (const entrance of this.settlementEntrances) {\n      const dist = Phaser.Math.Distance.Between(playerX, playerY, entrance.x, entrance.y);\n      entrance.label.setVisible(dist <= showDist);\n    }\n\n    for (const rift of this.riftEntrances) {\n      const dist = Phaser.Math.Distance.Between(playerX, playerY, rift.x, rift.y);\n      rift.label.setVisible(dist <= showDist);\n    }\n\n    for (const bldg of this.buildingEntrances) {\n      const dist = Phaser.Math.Distance.Between(playerX, playerY, bldg.x, bldg.y);\n      bldg.label.setVisible(dist <= showDist);\n    }\n\n    for (const cf of this.campfires) {\n      const dist = Phaser.Math.Distance.Between(playerX, playerY, cf.x, cf.y);\n      cf.label.setVisible(dist <= showDist);\n    }\n\n    for (const sc of this.shortcutEntrances) {\n      const dist = Phaser.Math.Distance.Between(playerX, playerY, sc.x, sc.y);\n      sc.label.setVisible(dist <= showDist);\n      // Update marker color based on unlock status\n      const unlocked = this.shortcutManager.isUnlocked(sc.shortcutId);\n      sc.marker.setTint(unlocked ? 0x44ffaa : 0x886644);\n    }\n  }\n\n  // =========================================================================\n  // TOOL USAGE\n  // =========================================================================\n\n  private handleToolUse(): void {\n    const slot = this.inventoryManager.getSlot(this.hotbarSlot);\n    if (!slot || !slot.itemId) return;\n    const def = ITEM_DB.get(slot.itemId);\n    if (!def) return;\n\n    const { tileX, tileY } = this.playerController.useTool();\n\n    // Handle seed planting\n    if (def.category === 'seed') {\n      this.handleSeedPlant(slot.itemId, def as SeedDef, tileX, tileY);\n      return;\n    }\n\n    if (def.category !== 'tool') return;\n    const toolDef = def as ToolDef;\n\n    switch (toolDef.toolType) {\n      case 'axe': {\n        // Check resource depletion before allowing harvest\n        if (!this.resourceCycleManager.canHarvest(tileX, tileY)) {\n          this.showNotification('This area is depleted. Come back in a few days.');\n          break;\n        }\n        const obj = this.chunkManager.getObjectAt(tileX, tileY);\n        const props = OBJECT_PROPERTIES[obj];\n        if (props.destructible && (obj === ObjectType.Tree || obj === ObjectType.DeadTree || obj === ObjectType.Bush)) {\n          this.hitObject(tileX, tileY, obj, toolDef.efficiency * 5);\n          this.audioManager.playSFX(SFX.AXE_SWING);\n          this.skillManager.addXP('foraging', 3);\n        }\n        break;\n      }\n      case 'pickaxe': {\n        // Check resource depletion before allowing harvest\n        if (!this.resourceCycleManager.canHarvest(tileX, tileY)) {\n          this.showNotification('This area is depleted. Come back in a few days.');\n          break;\n        }\n        const obj = this.chunkManager.getObjectAt(tileX, tileY);\n        const props = OBJECT_PROPERTIES[obj];\n        if (props.destructible && (obj === ObjectType.Rock || obj === ObjectType.CopperNode\n          || obj === ObjectType.IronNode || obj === ObjectType.GoldNode\n          || obj === ObjectType.Crystal || obj === ObjectType.VoidCrystal)) {\n          this.hitObject(tileX, tileY, obj, toolDef.efficiency * 5);\n          this.audioManager.playSFX(SFX.HAMMER_SMASH);\n          this.skillManager.addXP('mining', 5);\n        }\n        break;\n      }\n      case 'hoe': {\n        // Try harvest first (if crop is ready)\n        const harvestResult = this.farmingManager.harvest(tileX, tileY);\n        if (harvestResult) {\n          // Harvest callback in wireEvents handles visual reset and inventory\n          break;\n        }\n        // Otherwise, till empty ground\n        const obj = this.chunkManager.getObjectAt(tileX, tileY);\n        if (obj === ObjectType.None) {\n          if (this.farmingManager.tillSoil(tileX, tileY)) {\n            this.chunkManager.setTileAt(tileX, tileY, TileType.Tilled);\n            this.chunkManager.rerenderChunkAt(tileX, tileY);\n            this.audioManager.playSFX(SFX.HAMMER_SMASH);\n            this.skillManager.addXP('farming', 3);\n          }\n        }\n        break;\n      }\n      case 'watering_can': {\n        if (this.farmingManager.waterPlot(tileX, tileY)) {\n          this.chunkManager.setTileAt(tileX, tileY, TileType.Watered);\n          this.chunkManager.rerenderChunkAt(tileX, tileY);\n          this.skillManager.addXP('farming', 2);\n        }\n        break;\n      }\n      case 'fishing_rod': {\n        this.startFishing();\n        break;\n      }\n    }\n  }\n\n  /** Plant a seed on tilled soil */\n  private handleSeedPlant(seedId: string, seedDef: SeedDef, tileX: number, tileY: number): void {\n    const currentSeason = this.timeManager.getDate().season.toLowerCase();\n\n    if (!this.farmingManager.plantSeed(tileX, tileY, seedId, currentSeason)) {\n      this.showNotification('Cannot plant here');\n      return;\n    }\n\n    // Remove 1 seed from inventory\n    this.inventoryManager.removeItem(seedId, 1);\n\n    // Set crop visual placeholder\n    this.chunkManager.setObjectAt(tileX, tileY, ObjectType.Flower);\n    this.chunkManager.rerenderChunkAt(tileX, tileY);\n    this.skillManager.addXP('farming', 5);\n    this.showNotification(`Planted ${seedDef.name}`);\n  }\n\n  /** Hit a destructible object, tracking HP. Destroys and spawns drops at 0. */\n  private hitObject(tileX: number, tileY: number, objType: ObjectType, damage: number): void {\n    const key = `${tileX},${tileY}`;\n    let hp = this.objectHP.get(key);\n    if (hp === undefined) {\n      hp = OBJECT_PROPERTIES[objType].hp;\n    }\n    hp -= damage;\n    this.objectHP.set(key, hp);\n\n    // Sparks particle\n    const screen = IsometricHelper.worldToScreen(tileX, tileY);\n    this.particleManager.emit('sparks', screen.x, screen.y);\n\n    if (hp <= 0) {\n      // Destroy object\n      this.chunkManager.setObjectAt(tileX, tileY, ObjectType.None);\n      this.chunkManager.rerenderChunkAt(tileX, tileY);\n      this.objectHP.delete(key);\n\n      // Record resource harvest for depletion tracking\n      this.resourceCycleManager.recordHarvest(tileX, tileY);\n\n      // Spawn drops\n      const drops = OBJECT_DROPS[objType];\n      if (drops) {\n        for (const drop of drops) {\n          const qty = drop.qty[0] + Math.floor(Math.random() * (drop.qty[1] - drop.qty[0] + 1));\n          this.inventoryManager.addItem(drop.itemId, qty);\n          this.showNotification(`+${qty} ${drop.itemId}`);\n        }\n      }\n      this.particleManager.emit('harvest', screen.x, screen.y);\n\n      // Quest tracking for resource gathering\n      if (objType === ObjectType.Tree || objType === ObjectType.DeadTree || objType === ObjectType.Bush) {\n        this.questManager.updateObjective('collect', 'wood', 1);\n      } else if (objType === ObjectType.Rock || objType === ObjectType.CopperNode\n        || objType === ObjectType.IronNode || objType === ObjectType.GoldNode) {\n        this.questManager.updateObjective('mine', 'ore', 1);\n      }\n    }\n  }\n\n  // =========================================================================\n  // FOOD CONSUMPTION + BUFFS\n  // =========================================================================\n\n  private consumeItem(slotIndex: number): void {\n    // Affliction check: Paranoid/Feral disable consumables\n    if (this.resolveManager.getTrauma()?.disableConsumables) {\n      this.showNotification('Your shattered mind refuses to use items.');\n      return;\n    }\n    const def = this.inventoryManager.useItem(slotIndex);\n    if (!def) return;\n\n    const pEid = this.playerController.getEid();\n\n    if (def.category === 'food') {\n      const food = def as FoodDef;\n      Health.current[pEid] = Math.min(Health.max[pEid], Health.current[pEid] + food.healAmount);\n      Stamina.current[pEid] = Math.min(Stamina.max[pEid], Stamina.current[pEid] + food.staminaRestore);\n      this.showNotification(`Ate ${food.name} (+${food.healAmount} HP)`);\n      // Resolve recovery from food (Don't Starve Sanity)\n      if (food.healAmount >= 10) {\n        this.resolveManager.onGoodFood();\n      }\n      // Companion morale boost from player eating\n      this.companionManager.onPlayerFood();\n\n      if (food.buffType && food.buffDuration && food.buffMagnitude) {\n        this.activeBuffs.push({\n          type: food.buffType,\n          magnitude: food.buffMagnitude,\n          remaining: food.buffDuration,\n        });\n        this.showNotification(`Buff: ${food.buffType} +${food.buffMagnitude} (${food.buffDuration}s)`);\n      }\n\n      // Active diet system (Valheim-inspired): fills a category slot with timed HP/stamina bonus\n      if (food.foodCategory && food.dietDuration) {\n        const cat = food.foodCategory;\n        // Find existing slot with same category, or first empty slot\n        let slotIdx = this.activeDietSlots.findIndex(s => s?.category === cat);\n        if (slotIdx === -1) slotIdx = this.activeDietSlots.findIndex(s => s === null);\n        if (slotIdx !== -1) {\n          this.activeDietSlots[slotIdx] = {\n            itemId: food.id, category: cat, name: food.name,\n            hpBonus: food.dietHpBonus ?? 0, staminaBonus: food.dietStaminaBonus ?? 0,\n            remaining: food.dietDuration, duration: food.dietDuration,\n          };\n          this.showNotification(`Diet [${cat}]: +${food.dietHpBonus ?? 0} HP, +${food.dietStaminaBonus ?? 0} Stamina (${Math.floor(food.dietDuration / 60)}min)`);\n          this.registry.set('dietSlots', this.activeDietSlots);\n        } else {\n          this.showNotification('All 3 diet slots full! Wait for one to expire.');\n        }\n      }\n    } else if (def.category === 'potion') {\n      const potion = def as PotionDef;\n      this.activeBuffs.push({\n        type: potion.effectType,\n        magnitude: potion.effectMagnitude,\n        remaining: potion.effectDuration,\n      });\n      this.showNotification(`Used ${potion.name} (${potion.effectType} +${potion.effectMagnitude} for ${potion.effectDuration}s)`);\n    } else if (def.id === 'campfire') {\n      this.placeCampfire();\n      return; // SFX handled in placeCampfire\n    }\n\n    this.bountyContractManager.onItemUsed();\n    this.audioManager.playSFX(SFX.ITEM_PICKUP);\n  }\n\n  private applyBuffTick(buff: { type: string; magnitude: number }, dt: number): void {\n    const pEid = this.playerController.getEid();\n\n    switch (buff.type) {\n      case 'regen':\n        Health.current[pEid] = Math.min(Health.max[pEid], Health.current[pEid] + buff.magnitude * dt);\n        break;\n      case 'strength':\n        // Strength buff adds flat damage (applied additively each frame, but only as a temporary bonus)\n        // We track base + equipment in equipChange callback; buff is applied on top\n        break;\n      case 'defense':\n        break;\n      case 'speed':\n        break;\n    }\n  }\n\n  /** Recalculate omen stats and apply to player (called on omen equip change) */\n  private recalcOmenStats(): void {\n    const effects = this.omenSlotManager.getCombinedEffects();\n    const pEid = this.playerController.getEid();\n\n    // Omen max HP / stamina bonuses\n    const omenHp = effects.maxHpAdd ?? 0;\n    const omenStamina = effects.maxStaminaAdd ?? 0;\n    this.registry.set('omenHpBonus', omenHp);\n    this.registry.set('omenStaminaBonus', omenStamina);\n    this.registry.set('omenEffects', effects);\n\n    // Crit bonuses\n    if (effects.critChanceAdd) {\n      Combat.critChance[pEid] += effects.critChanceAdd;\n    }\n    if (effects.critMultAdd) {\n      Combat.critMult[pEid] += effects.critMultAdd;\n    }\n  }\n\n  /** Get current buff magnitude for a type (used by movement/combat calculations) */\n  getBuffMagnitude(type: string): number {\n    let total = 0;\n    for (const buff of this.activeBuffs) {\n      if (buff.type === type) total += buff.magnitude;\n    }\n    return total;\n  }\n\n  // =========================================================================\n  // PLAYER DEATH + RESPAWN\n  // =========================================================================\n\n  private handlePlayerDeath(): void {\n    this.playerDead = true;\n    this.deathTimer = 3;\n\n    // Drop 20% gold\n    const goldToDrop = Math.floor(this.inventoryManager.getGold() * 0.2);\n    if (goldToDrop > 0) {\n      this.inventoryManager.removeGold(goldToDrop);\n      const pos = this.playerController.getPosition();\n      // Create a gold pile loot drop\n      this.createLootDrop({\n        x: pos.x, y: pos.y,\n        itemId: 'gold_coin', quantity: goldToDrop,\n        rarity: 0, xpReward: 0, goldReward: 0, enemyType: '',\n      });\n    }\n\n    // Camera fade out + \"You Died\" overlay\n    this.cameras.main.fadeOut(800, 0, 0, 0);\n\n    const deathText = this.add.text(\n      this.cameras.main.width / 2,\n      this.cameras.main.height / 2,\n      'You Died',\n      {\n        fontFamily: 'monospace',\n        fontSize: '32px',\n        color: '#ff4444',\n        fontStyle: 'bold',\n        backgroundColor: '#000000dd',\n        padding: { x: 20, y: 12 },\n      },\n    ).setOrigin(0.5).setScrollFactor(0).setDepth(10000);\n\n    this.time.delayedCall(2800, () => {\n      deathText.destroy();\n    });\n  }\n\n  private respawnPlayer(): void {\n    this.playerDead = false;\n    const pEid = this.playerController.getEid();\n\n    // Teleport to last campfire (or Haven at 0,0)\n    Position.x[pEid] = this.lastCampfirePos.x;\n    Position.y[pEid] = this.lastCampfirePos.y;\n    Velocity.vx[pEid] = 0;\n    Velocity.vy[pEid] = 0;\n\n    // Half HP\n    Health.current[pEid] = Health.max[pEid] * 0.5;\n    Stamina.current[pEid] = Stamina.max[pEid];\n\n    // Invincibility for 2 seconds\n    this.playerController.setInvincible(2);\n\n    // Refill death defiance charges on respawn\n    this.deathDefianceCharges = this.maxDeathDefianceCharges;\n\n    // Camera fade in\n    this.cameras.main.fadeIn(600, 0, 0, 0);\n    this.audioManager.playSFX(SFX.DOOR_OPEN);\n    this.showNotification('Respawned at Haven');\n  }\n\n  // =========================================================================\n  // FISHING MINIGAME UI\n  // =========================================================================\n\n  private startFishing(): void {\n    const date = this.timeManager.getDate();\n    const timeStr = date.hour < 6 ? 'night' : date.hour < 12 ? 'morning' : date.hour < 18 ? 'afternoon' : 'evening';\n    const tilePos = IsometricHelper.pixelToTile(\n      this.playerController.getPosition().x,\n      this.playerController.getPosition().y,\n    );\n    const biome = BIOME_ID_MAP[this.chunkManager.getBiomeAt(tilePos.tileX, tilePos.tileY)] ?? 'haven';\n    if (!this.fishingManager.startFishing(date.season.toLowerCase(), timeStr, biome)) return;\n    this.fishingActive = true;\n    this.inputBlocked = true;\n\n    // Create fishing UI overlay\n    const cam = this.cameras.main;\n    const cx = cam.width / 2;\n    const cy = cam.height / 2;\n\n    this.fishingUI = this.add.container(0, 0).setScrollFactor(0).setDepth(9950);\n\n    // Backdrop\n    const backdrop = this.add.rectangle(cx, cy, 300, 200, 0x000000, 0.7);\n    this.fishingUI.add(backdrop);\n\n    // Vertical bar background\n    const barBg = this.add.rectangle(cx, cy, 30, 160, 0x003366);\n    this.fishingUI.add(barBg);\n\n    // Catch zone (green)\n    const catchZone = this.add.rectangle(cx, cy - 20, 26, 40, 0x00aa00, 0.6);\n    catchZone.setData('name', 'catchZone');\n    this.fishingUI.add(catchZone);\n\n    // Fish indicator (yellow)\n    const fish = this.add.rectangle(cx, cy, 22, 8, 0xffff00);\n    fish.setData('name', 'fish');\n    this.fishingUI.add(fish);\n\n    // Progress bar\n    const progressBg = this.add.rectangle(cx, cy + 100, 200, 12, 0x333333);\n    this.fishingUI.add(progressBg);\n    const progressFill = this.add.rectangle(cx - 100, cy + 100, 0, 10, 0x00ff00).setOrigin(0, 0.5);\n    progressFill.setData('name', 'progressFill');\n    this.fishingUI.add(progressFill);\n\n    // Instructions\n    const instrText = this.add.text(cx, cy - 110, 'W/S to move bar | Overlap fish to fill', {\n      fontFamily: 'monospace', fontSize: '10px', color: '#aaaaaa',\n    }).setOrigin(0.5);\n    this.fishingUI.add(instrText);\n\n    // ESC to cancel\n    const escText = this.add.text(cx, cy + 115, 'ESC to cancel', {\n      fontFamily: 'monospace', fontSize: '9px', color: '#666666',\n    }).setOrigin(0.5);\n    this.fishingUI.add(escText);\n  }\n\n  private updateFishingUI(dt: number): void {\n    if (!this.fishingUI) return;\n\n    // Move bar with W/S\n    const wasdW = this.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.W);\n    const wasdS = this.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.S);\n    if (wasdW.isDown) this.fishingManager.moveBar(-2);\n    if (wasdS.isDown) this.fishingManager.moveBar(2);\n\n    this.fishingManager.update(dt);\n\n    // Get session state\n    const session = this.fishingManager.getSession();\n    if (!session || !session.active) {\n      this.endFishing(false);\n      return;\n    }\n\n    // Update visuals\n    const cam = this.cameras.main;\n    const cx = cam.width / 2;\n    const cy = cam.height / 2;\n\n    for (const child of this.fishingUI.list) {\n      const go = child as Phaser.GameObjects.Rectangle;\n      if (go.getData?.('name') === 'fish') {\n        go.setPosition(cx, cy - 80 + (session.fishPosition / 100) * 160);\n      }\n      if (go.getData?.('name') === 'catchZone') {\n        go.setPosition(cx, cy - 80 + (session.barPosition / 100) * 160);\n      }\n      if (go.getData?.('name') === 'progressFill') {\n        go.width = (session.progress / 100) * 200;\n      }\n    }\n\n    // Check completion (progress is 0-100)\n    if (session.progress >= 100) {\n      this.endFishing(true);\n    }\n\n    // ESC to cancel\n    if (this.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.ESC).isDown) {\n      this.endFishing(false);\n    }\n  }\n\n  private endFishing(success: boolean): void {\n    const session = this.fishingManager.getSession();\n    const fishId = session?.fishId;\n    this.fishingActive = false;\n    this.inputBlocked = false;\n    if (this.fishingUI) {\n      this.fishingUI.destroy(true);\n      this.fishingUI = null;\n    }\n    if (success && fishId) {\n      this.audioManager.playSFX(SFX.ITEM_PICKUP);\n      const name = ITEM_DB.get(fishId)?.name ?? fishId;\n      this.showNotification(`Caught: ${name}!`);\n    } else if (!success) {\n      this.showNotification('The fish got away...');\n    }\n  }\n\n  // =========================================================================\n  // FARMING VISUAL FEEDBACK\n  // =========================================================================\n\n  // Already wired in wireEvents for harvest callbacks.\n  // Additional: when planting, set object visual as crop placeholder.\n\n  // =========================================================================\n  // NOTIFICATIONS\n  // =========================================================================\n\n  private showNotification(message: string): void {\n    const { width } = this.cameras.main;\n    const y = 100 + this.notifications.length * 24;\n\n    const text = this.add.text(width / 2, y, message, {\n      fontFamily: 'monospace',\n      fontSize: '12px',\n      color: '#ffcc00',\n      backgroundColor: '#000000aa',\n      padding: { x: 8, y: 4 },\n    }).setOrigin(0.5).setScrollFactor(0).setDepth(9900);\n\n    this.notifications.push({ text, life: 0 });\n  }\n\n  private updateNotifications(dt: number): void {\n    for (let i = this.notifications.length - 1; i >= 0; i--) {\n      const notif = this.notifications[i];\n      notif.life += dt;\n      notif.text.y -= 10 * dt;\n      notif.text.setAlpha(Math.max(0, 1 - notif.life / 2));\n\n      if (notif.life >= 2) {\n        notif.text.destroy();\n        this.notifications.splice(i, 1);\n      }\n    }\n  }\n\n  // =========================================================================\n  // PAUSE MENU\n  // =========================================================================\n\n  private openPauseMenu(): void {\n    this.paused = true;\n    this.inputBlocked = true;\n\n    const cam = this.cameras.main;\n    const cx = cam.width / 2;\n    const cy = cam.height / 2;\n\n    this.pauseOverlay = this.add.container(0, 0).setScrollFactor(0).setDepth(9990);\n\n    // Dark backdrop\n    const bg = this.add.rectangle(cx, cy, cam.width, cam.height, 0x000000, 0.6);\n    this.pauseOverlay.add(bg);\n\n    // Title\n    const title = this.add.text(cx, cy - 80, 'PAUSED', {\n      fontFamily: 'monospace', fontSize: '24px', color: '#ffffff',\n    }).setOrigin(0.5);\n    this.pauseOverlay.add(title);\n\n    const btnStyle = { fontFamily: 'monospace', fontSize: '14px', color: '#cccccc', backgroundColor: '#333333', padding: { x: 20, y: 8 } };\n\n    // Resume button\n    const resumeBtn = this.add.text(cx, cy - 20, 'Resume', btnStyle).setOrigin(0.5).setInteractive({ useHandCursor: true });\n    resumeBtn.on('pointerover', () => resumeBtn.setColor('#ffffff'));\n    resumeBtn.on('pointerout', () => resumeBtn.setColor('#cccccc'));\n    resumeBtn.on('pointerdown', () => this.closePauseMenu());\n    this.pauseOverlay.add(resumeBtn);\n\n    // Save button\n    const saveBtn = this.add.text(cx, cy + 20, 'Save Game', btnStyle).setOrigin(0.5).setInteractive({ useHandCursor: true });\n    saveBtn.on('pointerover', () => saveBtn.setColor('#ffffff'));\n    saveBtn.on('pointerout', () => saveBtn.setColor('#cccccc'));\n    saveBtn.on('pointerdown', () => {\n      const pEid = this.playerController.getEid();\n      this.saveManager.save(0, {\n        x: Position.x[pEid], y: Position.y[pEid],\n        hp: Health.current[pEid], maxHp: Health.max[pEid],\n        stamina: Stamina.current[pEid], maxStamina: Stamina.max[pEid],\n        level: Combat.level[pEid], xp: Combat.xp[pEid],\n      });\n      saveBtn.setText('Saved!');\n      this.time.delayedCall(1000, () => { if (saveBtn.active) saveBtn.setText('Save Game'); });\n    });\n    this.pauseOverlay.add(saveBtn);\n\n    // Main Menu button\n    const menuBtn = this.add.text(cx, cy + 60, 'Main Menu', btnStyle).setOrigin(0.5).setInteractive({ useHandCursor: true });\n    menuBtn.on('pointerover', () => menuBtn.setColor('#ff6666'));\n    menuBtn.on('pointerout', () => menuBtn.setColor('#cccccc'));\n    menuBtn.on('pointerdown', () => {\n      this.closePauseMenu();\n      this.cleanUp();\n      this.scene.start('MainMenuScene');\n    });\n    this.pauseOverlay.add(menuBtn);\n  }\n\n  private closePauseMenu(): void {\n    this.paused = false;\n    this.inputBlocked = false;\n    if (this.pauseOverlay) {\n      this.pauseOverlay.destroy(true);\n      this.pauseOverlay = null;\n    }\n  }\n\n  // =========================================================================\n  // NEW GAME PLUS DIALOG\n  // =========================================================================\n\n  private openNGPlusDialog(): void {\n    this.paused = true;\n    this.inputBlocked = true;\n\n    const cam = this.cameras.main;\n    const cx = cam.width / 2;\n    const cy = cam.height / 2;\n\n    const overlay = this.add.container(0, 0).setScrollFactor(0).setDepth(9990);\n    overlay.add(this.add.rectangle(cx, cy, cam.width, cam.height, 0x000000, 0.7));\n    overlay.add(this.add.text(cx, cy - 100, 'EDILAS PORTAL', {\n      fontFamily: 'monospace', fontSize: '20px', color: '#bb88ff',\n    }).setOrigin(0.5));\n    overlay.add(this.add.text(cx, cy - 70, `Begin New Game Plus (Cycle ${this.newGamePlusManager.getCycle() + 1})?`, {\n      fontFamily: 'monospace', fontSize: '12px', color: '#cccccc',\n    }).setOrigin(0.5));\n\n    // Carryover option checkboxes\n    const options = this.newGamePlusManager.getValidCarryoverOptions();\n    const selected = new Set<string>();\n    const checkTexts: Phaser.GameObjects.Text[] = [];\n    options.forEach((opt, i) => {\n      const y = cy - 30 + i * 22;\n      const txt = this.add.text(cx - 80, y, `[ ] ${opt}`, {\n        fontFamily: 'monospace', fontSize: '11px', color: '#aaaaaa',\n      }).setInteractive({ useHandCursor: true });\n      txt.on('pointerdown', () => {\n        if (selected.has(opt)) {\n          selected.delete(opt);\n          txt.setText(`[ ] ${opt}`).setColor('#aaaaaa');\n        } else {\n          selected.add(opt);\n          txt.setText(`[x] ${opt}`).setColor('#88ff88');\n        }\n      });\n      overlay.add(txt);\n      checkTexts.push(txt);\n    });\n\n    const btnY = cy - 30 + options.length * 22 + 20;\n    const btnStyle = { fontFamily: 'monospace', fontSize: '13px', color: '#ffffff', backgroundColor: '#442266', padding: { x: 16, y: 6 } };\n\n    const startBtn = this.add.text(cx - 60, btnY, 'Start NG+', btnStyle).setOrigin(0.5).setInteractive({ useHandCursor: true });\n    startBtn.on('pointerdown', () => {\n      this.newGamePlusManager.startNewGamePlus(selected);\n      overlay.destroy(true);\n      this.paused = false;\n      this.cleanUp();\n      this.scene.start('OverworldScene');\n    });\n    overlay.add(startBtn);\n\n    const cancelBtn = this.add.text(cx + 60, btnY, 'Cancel', {\n      fontFamily: 'monospace', fontSize: '13px', color: '#cccccc', backgroundColor: '#333333', padding: { x: 16, y: 6 },\n    }).setOrigin(0.5).setInteractive({ useHandCursor: true });\n    cancelBtn.on('pointerdown', () => {\n      overlay.destroy(true);\n      this.paused = false;\n      this.inputBlocked = false;\n    });\n    overlay.add(cancelBtn);\n  }\n\n  // =========================================================================\n  // SAVE/LOAD REGISTRATION\n  // =========================================================================\n\n  private registerSaveHandlers(): void {\n    const pairs: [string, () => unknown, (data: unknown) => void][] = [\n      ['inventory', () => this.inventoryManager.serialize(), (d) => this.inventoryManager.deserialize(d as ReturnType<InventoryManager['serialize']>)],\n      ['equipment', () => this.equipmentManager.serialize(), (d) => this.equipmentManager.deserialize(d as ReturnType<EquipmentManager['serialize']>)],\n      ['time', () => this.timeManager.serialize(), (d) => this.timeManager.deserialize(d as ReturnType<TimeManager['serialize']>)],\n      ['quests', () => this.questManager.serialize(), (d) => this.questManager.deserialize(d as ReturnType<QuestManager['serialize']>)],\n      ['skills', () => this.skillManager.serialize(), (d) => this.skillManager.deserialize(d as ReturnType<SkillManager['serialize']>)],\n      ['relationships', () => this.relationshipManager.serialize(), (d) => this.relationshipManager.deserialize(d as ReturnType<RelationshipManager['serialize']>)],\n      ['crafting', () => this.craftingManager.serialize(), (d) => this.craftingManager.deserialize(d as ReturnType<CraftingManager['serialize']>)],\n      ['farming', () => this.farmingManager.serialize(), (d) => this.farmingManager.deserialize(d as ReturnType<FarmingManager['serialize']>)],\n      ['fishing', () => this.fishingManager.serialize(), (d) => this.fishingManager.deserialize(d as ReturnType<FishingManager['serialize']>)],\n      ['cooking', () => this.cookingManager.serialize(), (d) => this.cookingManager.deserialize(d as ReturnType<CookingManager['serialize']>)],\n      ['weaponMastery', () => this.weaponMasteryManager.serialize(), (d) => this.weaponMasteryManager.deserialize(d as ReturnType<WeaponMasteryManager['serialize']>)],\n      ['story', () => this.storyManager.serialize(), (d) => this.storyManager.deserialize(d as ReturnType<StoryManager['serialize']>)],\n      ['corruption', () => this.corruptionManager.serialize(), (d) => this.corruptionManager.deserialize(d as ReturnType<CorruptionManager['serialize']>)],\n      ['rift', () => this.riftManager.serialize(), (d) => this.riftManager.deserialize(d as ReturnType<RiftManager['serialize']>)],\n      ['settlements', () => this.settlementManager.serialize(), (d) => this.settlementManager.deserialize(d as ReturnType<SettlementManager['serialize']>)],\n      ['factions', () => this.factionManager.serialize(), (d) => this.factionManager.deserialize(d as ReturnType<FactionManager['serialize']>)],\n      ['titans', () => this.titanManager.serialize(), (d) => this.titanManager.deserialize(d as ReturnType<TitanManager['serialize']>)],\n      ['weather', () => this.weatherManager.serialize(), (d) => this.weatherManager.deserialize(d as ReturnType<WeatherManager['serialize']>)],\n      ['audio', () => this.audioManager.serialize(), (d) => this.audioManager.deserialize(d as ReturnType<AudioManager['serialize']>)],\n      ['festivals', () => this.festivalManager.serialize(), (d) => this.festivalManager.deserialize(d as ReturnType<FestivalManager['serialize']>)],\n      ['romance', () => this.romanceManager.serialize(), (d) => this.romanceManager.deserialize(d as ReturnType<RomanceManager['serialize']>)],\n      ['career', () => this.careerManager.serialize(), (d) => this.careerManager.deserialize(d as ReturnType<CareerManager['serialize']>)],\n      ['achievements', () => this.achievementManager.serialize(), (d) => this.achievementManager.deserialize(d as ReturnType<AchievementManager['serialize']>)],\n      ['mail', () => this.mailManager.serialize(), (d) => this.mailManager.deserialize(d as ReturnType<MailManager['serialize']>)],\n      ['storage', () => this.storageManager.serialize(), (d) => this.storageManager.deserialize(d as ReturnType<StorageManager['serialize']>)],\n      ['temperature', () => this.temperatureManager.serialize(), (d) => this.temperatureManager.deserialize(d as ReturnType<TemperatureManager['serialize']>)],\n      ['shadowWorld', () => this.shadowWorldManager.serialize(), (d) => this.shadowWorldManager.deserialize(d as ReturnType<ShadowWorldManager['serialize']>)],\n      ['cityLevels', () => this.cityLevelManager.serialize(), (d) => this.cityLevelManager.deserialize(d as ReturnType<CityLevelManager['serialize']>)],\n      ['newGamePlus', () => this.newGamePlusManager.serialize(), (d) => this.newGamePlusManager.deserialize(d as ReturnType<NewGamePlusManager['serialize']>)],\n      ['endgame', () => this.endgameManager.serialize(), (d) => this.endgameManager.deserialize(d as ReturnType<EndgameManager['serialize']>)],\n      ['tutorial', () => this.tutorialManager.serialize(), (d) => this.tutorialManager.deserialize(d as ReturnType<TutorialManager['serialize']>)],\n      ['interior', () => this.interiorManager.serialize(), (d) => this.interiorManager.deserialize(d as ReturnType<InteriorManager['serialize']>)],\n      ['legendaryQuests', () => this.legendaryQuestManager.serialize(), (d) => this.legendaryQuestManager.deserialize(d as ReturnType<LegendaryQuestManager['serialize']>)],\n      ['abilities', () => this.abilityManager.serialize(), (d) => this.abilityManager.deserialize(d as ReturnType<AbilityManager['serialize']>)],\n      ['scarReading', () => this.scarReadingManager.serialize(), (d) => this.scarReadingManager.deserialize(d as ReturnType<ScarReadingManager['serialize']>)],\n      ['pact', () => this.pactManager.serialize(), (d) => this.pactManager.deserialize(d as ReturnType<PactManager['serialize']>)],\n      ['resolve', () => this.resolveManager.serialize(), (d) => this.resolveManager.deserialize(d as ReturnType<ResolveManager['serialize']>)],\n      ['bountyContracts', () => this.bountyContractManager.serialize(), (d) => this.bountyContractManager.deserialize(d as ReturnType<BountyContractManager['serialize']>)],\n      ['enemyWeakness', () => this.enemyWeaknessManager.serialize(), (d) => this.enemyWeaknessManager.deserialize(d as ReturnType<EnemyWeaknessManager['serialize']>)],\n      ['omenSlots', () => this.omenSlotManager.serialize(), (d) => this.omenSlotManager.deserialize(d as ReturnType<OmenSlotManager['serialize']>)],\n      ['companion', () => this.companionManager.serialize(), (d) => this.companionManager.deserialize(d as ReturnType<CompanionManager['serialize']>)],\n      ['boons', () => this.boonManager.serialize(), (d) => this.boonManager.deserialize(d as ReturnType<BoonManager['serialize']>)],\n      ['resourceCycles', () => this.resourceCycleManager.serialize(), (d) => this.resourceCycleManager.deserialize(d as ReturnType<ResourceCycleManager['serialize']>)],\n      ['shortcuts', () => this.shortcutManager.serialize(), (d) => this.shortcutManager.deserialize(d as ReturnType<ShortcutManager['serialize']>)],\n      ['imprints', () => this.imprintManager.serialize(), (d) => this.imprintManager.deserialize(d as ReturnType<ImprintManager['serialize']>)],\n      ['quirks', () => this.quirkManager.serialize(), (d) => this.quirkManager.deserialize(d as ReturnType<QuirkManager['serialize']>)],\n      ['weaponEcho', () => this.weaponEchoManager.serialize(), (d) => this.weaponEchoManager.deserialize(d as ReturnType<WeaponEchoManager['serialize']>)],\n    ];\n\n    for (const [key, saver, loader] of pairs) {\n      this.saveManager.register(key, saver, loader);\n    }\n  }\n\n  // =========================================================================\n  // EVENT WIRING\n  // =========================================================================\n\n  private wireEvents(): void {\n    // Day cycle\n    this.timeManager.onDay(() => {\n      this.farmingManager.advanceDay(this.timeManager.getDate().season.toLowerCase());\n      this.relationshipManager.resetDailyGifts();\n      // Settlement daily ticks — advance + collect production\n      for (const s of this.settlementManager.getAllSettlements()) {\n        this.settlementManager.advanceDay(s.id);\n        const production = this.settlementManager.getProductionOutput(s.id);\n        for (const item of production) {\n          this.inventoryManager.addItem(item.itemId, item.quantity);\n        }\n      }\n      // Titan respawn timers\n      this.titanManager.advanceDay();\n      // Resource regrowth cycle\n      this.resourceCycleManager.advanceDay();\n      // Quirk instability decay\n      this.quirkManager.advanceDay();\n      // Faction weekly tick (every 7 days)\n      const dayNum = this.timeManager.getDate().day;\n      if (dayNum % 7 === 0) {\n        this.factionManager.advanceWeek();\n      }\n    });\n\n    // Season change → re-spawn enemies with new seasonal modifiers + notification\n    this.timeManager.onSeason((season) => {\n      resetSpawnedChunks();\n      const msgs: Record<string, string> = {\n        Spring: 'Spring arrives. Creatures stir from dormancy.',\n        Summer: 'Summer heat draws out more enemies. Stay alert.',\n        Autumn: 'Autumn winds blow. The world settles into balance.',\n        Winter: 'Winter descends. Fewer enemies, but those that remain are hardened.',\n      };\n      this.showNotification(msgs[season] ?? `Season changed to ${season}`);\n    });\n\n    // Harvest → quest + skill + visual\n    this.farmingManager.onHarvest((cropId, _quality, x, y) => {\n      this.questManager.updateObjective('farm', cropId, 1);\n      this.skillManager.addXP('farming', 15);\n      // Reset tile to dirt + remove crop object\n      this.chunkManager.setTileAt(x, y, TileType.Dirt);\n      this.chunkManager.setObjectAt(x, y, ObjectType.None);\n      this.chunkManager.rerenderChunkAt(x, y);\n      const screen = IsometricHelper.worldToScreen(x, y);\n      this.particleManager.emit('harvest', screen.x, screen.y);\n      this.inventoryManager.addItem(cropId, 1);\n      this.showNotification(`Harvested ${cropId}`);\n      // Lore fragment chance on harvest\n      const fragId = this.codexManager.rollFragmentDrop(this.lastBiomeId, 'farming');\n      if (fragId) this.codexManager.discover(fragId);\n    });\n\n    // Fish catch → quest + skill\n    this.fishingManager.onCatch((fishId) => {\n      this.inventoryManager.addItem(fishId, 1);\n      this.questManager.updateObjective('fish', fishId, 1);\n      this.skillManager.addXP('fishing', 20);\n      // Lore fragment chance on fish catch\n      const fragId = this.codexManager.rollFragmentDrop(this.lastBiomeId, 'fishing');\n      if (fragId) this.codexManager.discover(fragId);\n    });\n\n    // Craft → quest + skill\n    this.craftingManager.onCraftComplete((recipeId, _outputItemId, _quantity) => {\n      this.questManager.updateObjective('craft', recipeId, 1);\n      this.skillManager.addXP('crafting', 10);\n    });\n\n    // Cook → quest + skill\n    this.cookingManager.onCook((recipeId) => {\n      this.questManager.updateObjective('cook', recipeId, 1);\n      this.skillManager.addXP('cooking', 10);\n    });\n\n    // Story progression\n    this.storyManager.onChapterComplete((chapterId) => {\n      this.questManager.updateObjective('reach', `chapter_${chapterId}`, 1);\n    });\n\n    // Titan defeat → story + quest\n    this.titanManager.onTitanDefeated((titanId, _killCount) => {\n      this.storyManager.updateObjective('kill', titanId, 1);\n      this.questManager.updateObjective('kill', titanId, 1);\n    });\n\n    // Rift floor completion → quest\n    this.riftManager.onFloorComplete((floor, _crystals) => {\n      this.questManager.updateObjective('reach', `rift_floor_${floor}`, 1);\n    });\n\n    // Weather → farming + particles\n    this.weatherManager.onWeatherChange((_oldType, newType) => {\n      if (newType === 'rain' || newType === 'storm') {\n        this.farmingManager.waterAllCrops();\n      }\n      this.particleManager.setWeatherParticles(newType);\n    });\n\n    // Festival check on day advance — start festival if one matches today\n    this.timeManager.onDay(() => {\n      const d = this.timeManager.getDate();\n      const festival = this.festivalManager.checkFestival(d.season, d.day);\n      if (festival) {\n        this.festivalManager.startFestival(festival.id);\n      }\n    });\n\n    // Festival event handlers — each festival applies themed gameplay bonuses\n    const FESTIVAL_BONUSES: Record<string, { xp: number; luck: number; gold: number; stamina: number }> = {\n      egg_festival:       { xp: 1.25, luck: 1.2,  gold: 1.0,  stamina: 0 },    // Spring: discovery bonus\n      flower_dance:       { xp: 1.0,  luck: 1.0,  gold: 1.0,  stamina: 2 },    // Spring: stamina from dancing\n      luau:               { xp: 1.0,  luck: 1.0,  gold: 1.5,  stamina: 1 },    // Summer: prosperity\n      moonlight_jellies:  { xp: 1.5,  luck: 1.5,  gold: 1.0,  stamina: 0 },    // Summer: magical night\n      harvest_fair:       { xp: 1.0,  luck: 1.3,  gold: 1.3,  stamina: 0 },    // Autumn: abundance\n      spirits_eve:        { xp: 1.5,  luck: 2.0,  gold: 1.0,  stamina: 0 },    // Autumn: rare drops\n      ice_festival:       { xp: 1.3,  luck: 1.0,  gold: 1.0,  stamina: 3 },    // Winter: endurance\n      feast_of_winter_star: { xp: 1.0, luck: 1.0, gold: 2.0,  stamina: 1 },   // Winter: generosity\n    };\n\n    this.festivalManager.onFestivalStart((festival) => {\n      this.showNotification(`Festival: ${festival.name} has begun!`);\n      this.showNotification(festival.description);\n      this.audioManager.playSFX(SFX.LEVEL_UP);\n\n      // Apply festival gameplay bonuses\n      const bonuses = FESTIVAL_BONUSES[festival.id];\n      if (bonuses) {\n        this.festivalXpMult = bonuses.xp;\n        this.festivalLuckMult = bonuses.luck;\n        this.festivalGoldMult = bonuses.gold;\n        this.festivalStaminaRegen = bonuses.stamina;\n        if (bonuses.xp > 1) this.showNotification(`+${Math.round((bonuses.xp - 1) * 100)}% XP bonus active!`);\n        if (bonuses.luck > 1) this.showNotification(`+${Math.round((bonuses.luck - 1) * 100)}% loot luck bonus!`);\n        if (bonuses.gold > 1) this.showNotification(`+${Math.round((bonuses.gold - 1) * 100)}% gold bonus!`);\n      }\n\n      // Festival particle burst\n      const pEid = this.playerController.getEid();\n      this.particleManager.emit('levelUp', Position.x[pEid], Position.y[pEid]);\n\n      // Auto-complete after a short delay (no minigame scene yet)\n      this.time.delayedCall(3000, () => {\n        this.festivalManager.completeFestival(festival.id);\n      });\n    });\n    this.festivalManager.onFestivalComplete((festival, rewards) => {\n      this.showNotification(`${festival.name} complete! Rewards received.`);\n      for (const reward of rewards) {\n        if (reward.gold) this.inventoryManager.addGold(reward.gold);\n        if (reward.itemId) this.inventoryManager.addItem(reward.itemId, reward.quantity ?? 1);\n      }\n      this.audioManager.playSFX(SFX.LEVEL_UP);\n\n      // Clear festival bonuses at end of festival day\n      this.festivalXpMult = 1;\n      this.festivalLuckMult = 1;\n      this.festivalGoldMult = 1;\n      this.festivalStaminaRegen = 0;\n    });\n\n    // Achievement unlock notification + mail\n    this.achievementManager.onAchievementUnlock((achievementId, tier) => {\n      this.showNotification(`Achievement Unlocked: ${achievementId} (${tier})`);\n      const pEid = this.playerController.getEid();\n      this.particleManager.emit('levelUp', Position.x[pEid], Position.y[pEid]);\n      this.audioManager.playSFX(SFX.LEVEL_UP);\n      this.mailManager.addMail({\n        senderId: 'system',\n        subject: `Achievement Unlocked: ${achievementId} (${tier})`,\n        body: `Congratulations! You reached ${tier} tier for ${achievementId}.`,\n        attachments: [],\n        sentDay: this.timeManager.getDate().day,\n      });\n    });\n\n    // City level-up notification\n    this.cityLevelManager.onCityLevelUp((cityId, newLevel) => {\n      this.mailManager.addMail({\n        senderId: 'system',\n        subject: `${cityId} reached level ${newLevel}!`,\n        body: `The city of ${cityId} has grown to level ${newLevel}. New shops and services are now available.`,\n        attachments: [],\n        sentDay: this.timeManager.getDate().day,\n      });\n    });\n\n    // Career level-up → achievement tracking\n    this.careerManager.onLevelUp((level) => {\n      this.achievementManager.trackProgress('helpful_hand', 1);\n      if (level >= 10) {\n        this.achievementManager.trackProgress('master_artisan', 1);\n      }\n    });\n\n    // Endgame portal unlock notification\n    this.endgameManager.onPortalUnlock(() => {\n      this.mailManager.addMail({\n        senderId: 'system',\n        subject: 'The EDILAS Portal Has Opened!',\n        body: 'All requirements met. The path to EDILAS awaits in Haven center.',\n        attachments: [],\n        sentDay: this.timeManager.getDate().day,\n      });\n    });\n\n    // Legendary quest completion\n    this.legendaryQuestManager.onQuestComplete((questId) => {\n      this.achievementManager.trackProgress('secret_keeper', 1);\n      this.mailManager.addMail({\n        senderId: 'system',\n        subject: `Legendary Quest Complete: ${questId}`,\n        body: 'You have achieved the impossible. Your legend grows.',\n        attachments: [],\n        sentDay: this.timeManager.getDate().day,\n      });\n    });\n\n    // Tutorial tips on first interactions\n    this.farmingManager.onHarvest(() => {\n      this.tutorialManager.showTip('first_crop');\n    });\n    this.fishingManager.onCatch(() => {\n      this.tutorialManager.showTip('first_fishing');\n    });\n    this.craftingManager.onCraftComplete(() => {\n      this.tutorialManager.showTip('first_crafting');\n    });\n\n    // Display tutorial tips as notifications\n    this.tutorialManager.onTipShow((tip) => {\n      this.showNotification(`Tip: ${tip.title}`);\n      this.showNotification(tip.body);\n    });\n\n    // Skill level-up → stat bonuses + notification\n    this.skillManager.onLevelUp((skillId, level) => {\n      const pEid = this.playerController.getEid();\n      this.showNotification(`${skillId} skill reached level ${level}!`);\n      this.particleManager.emit('levelUp', Position.x[pEid], Position.y[pEid]);\n      // Apply per-skill bonuses\n      switch (skillId) {\n        case 'combat':\n          Combat.damage[pEid] += 1; // +1 base damage per combat level\n          this.cachedDamage += 1;\n          break;\n        case 'mining':\n        case 'foraging':\n          Combat.defense[pEid] += 0.5;\n          this.cachedDefense += 0.5;\n          break;\n      }\n    });\n\n    // Legendary quest progress from gameplay events\n    this.fishingManager.onCatch((fishId) => {\n      this.legendaryQuestManager.advanceStage('king_of_the_sea', `catch_${fishId}`, 1);\n    });\n    this.craftingManager.onCraftComplete((_recipeId, outputItemId) => {\n      if (outputItemId === 'dragonbane') {\n        this.legendaryQuestManager.advanceStage('dragon_slayer', 'forge_dragonbane', 1);\n      }\n      if (outputItemId === 'ancient_wine_gold') {\n        this.legendaryQuestManager.advanceStage('the_ancient_fruit', 'craft_ancient_wine_gold', 1);\n      }\n    });\n    this.legendaryQuestManager.onQuestComplete((_questId, reward) => {\n      for (const itemId of reward.items) {\n        this.inventoryManager.addItem(itemId, 1);\n      }\n      if (reward.title) {\n        this.showNotification(`Title earned: ${reward.title}`);\n      }\n    });\n\n    // Career XP from profession activities\n    this.farmingManager.onHarvest(() => {\n      if (this.careerManager.getCareerId() === 'farmer') {\n        this.careerManager.addCareerXP(15);\n      }\n    });\n    this.fishingManager.onCatch(() => {\n      if (this.careerManager.getCareerId() === 'fisher') {\n        this.careerManager.addCareerXP(20);\n      }\n    });\n    this.cookingManager.onCook(() => {\n      if (this.careerManager.getCareerId() === 'chef') {\n        this.careerManager.addCareerXP(15);\n      }\n    });\n    this.craftingManager.onCraftComplete(() => {\n      // General career XP for adventurer\n      if (this.careerManager.getCareerId() === 'adventurer') {\n        this.careerManager.addCareerXP(10);\n      }\n    });\n\n    // Career specialization notification\n    this.careerManager.onSpecialization((specId) => {\n      this.showNotification(`Specialization: ${specId} selected!`);\n      this.audioManager.playSFX(SFX.LEVEL_UP);\n    });\n\n    // Romance stage change + heart event notifications\n    this.romanceManager.onStageChange((npcId, stage) => {\n      const npcDef = NPC_DB.get(npcId);\n      const name = npcDef?.name ?? npcId;\n      this.showNotification(`${name}: Relationship → ${stage}`);\n      this.audioManager.playSFX(SFX.LEVEL_UP);\n      if (stage === 'Married') {\n        this.achievementManager.trackProgress('secret_keeper', 1);\n      }\n    });\n    this.romanceManager.onHeartEvent((npcId, heartLevel) => {\n      const npcDef = NPC_DB.get(npcId);\n      const name = npcDef?.name ?? npcId;\n      this.showNotification(`Heart Event with ${name} (${heartLevel} hearts)!`);\n      this.audioManager.playSFX(SFX.ITEM_PICKUP);\n    });\n\n    // Temperature damage from extreme conditions\n    this.temperatureManager.onComfortChange((comfort) => {\n      if (comfort.tooCold) {\n        this.showNotification('You are freezing! Find warmth!');\n      } else if (comfort.tooHot) {\n        this.showNotification('Extreme heat! Seek shade!');\n      }\n    });\n\n    // Weapon mastery level-up notification\n    this.weaponMasteryManager.onMasteryUp((weaponType, level) => {\n      const names: Record<number, string> = {\n        1: 'Sword', 2: 'Axe', 3: 'Spear', 4: 'Bow', 5: 'Staff', 6: 'Dagger', 7: 'Hammer',\n      };\n      const wName = names[weaponType] ?? 'Weapon';\n      this.showNotification(`${wName} Mastery → Level ${level}`);\n      this.audioManager.playSFX(SFX.LEVEL_UP);\n      // Milestone ability unlocks at 5/10/15/20\n      const milestones = this.weaponMasteryManager.getMilestoneUnlocks(weaponType);\n      if (milestones.length > 0) {\n        const latest = milestones[milestones.length - 1];\n        this.showNotification(`Milestone: ${latest} unlocked!`);\n      }\n      // Keep sword mastery level synced for parry system\n      if (weaponType === WeaponType.Sword) {\n        setSwordMasteryLevel(level);\n      }\n    });\n\n    // Story → Cutscene triggers\n    this.storyManager.onCutscene((cutsceneId) => {\n      const script = CUTSCENE_SCRIPTS[cutsceneId];\n      if (script) {\n        this.cutsceneManager.playCutscene(script);\n      }\n    });\n\n    // Cutscene visual rendering\n    this.cutsceneManager.onCutsceneStart(() => {\n      this.inputBlocked = true;\n      this.showCutsceneOverlay();\n    });\n    this.cutsceneManager.onStepChange((step) => {\n      this.updateCutsceneOverlay(step);\n    });\n    this.cutsceneManager.onCutsceneEnd(() => {\n      this.inputBlocked = false;\n      this.hideCutsceneOverlay();\n    });\n\n    // Interior enter/exit feedback\n    this.interiorManager.onEnterInterior((interiorId, _def) => {\n      this.tutorialManager.showTip('first_building');\n      this.questManager.updateObjective('explore', interiorId, 1);\n    });\n    this.interiorManager.onExitInterior((interiorId) => {\n      this.showNotification('Returned outside.');\n    });\n\n    // Shadow World enter/exit feedback\n    this.shadowWorldManager.onEnter(() => {\n      this.showNotification('Entered the Shadow World. Enemies are stronger here.');\n      this.audioManager.playSFX(SFX.DOOR_OPEN);\n    });\n    this.shadowWorldManager.onExit(() => {\n      this.showNotification('Returned from the Shadow World.');\n      this.audioManager.playSFX(SFX.DOOR_OPEN);\n    });\n\n    // Endgame portal → spawn NG+ portal at Haven\n    this.endgameManager.onPortalUnlock(() => {\n      this.showNotification('The EDILAS Portal has opened at Haven!');\n      this.ngPlusPortalActive = true;\n    });\n\n    // Fast travel from MapUI — wire after UIScene is available\n    this.time.delayedCall(100, () => {\n      const uiScene = this.scene.get('UIScene') as import('./UIScene').UIScene;\n      if (uiScene) {\n        const mapUI = uiScene.getMapUI();\n        mapUI.onTravel((cityId, worldX, worldY) => {\n          const pEid = this.playerController.getEid();\n          Position.x[pEid] = worldX;\n          Position.y[pEid] = worldY;\n          this.playerController.getSprite().setPosition(worldX, worldY);\n          this.cameras.main.centerOn(worldX, worldY);\n          this.showNotification(`Traveled to ${cityId}`);\n          this.audioManager.playSFX(SFX.DOOR_OPEN);\n        });\n      }\n    });\n  }\n\n  // =========================================================================\n  // CLEANUP\n  // =========================================================================\n\n  private cleanUp(): void {\n    // Destroy enemy sprites and HP bars\n    for (const sprite of this.enemySprites.values()) {\n      sprite.destroy();\n    }\n    this.enemySprites.clear();\n    for (const hpBar of this.enemyHPBars.values()) {\n      hpBar.destroy();\n    }\n    this.enemyHPBars.clear();\n\n    // Destroy loot drops\n    for (const drop of this.lootDrops) {\n      drop.sprite.destroy();\n      drop.label.destroy();\n    }\n    this.lootDrops = [];\n\n    // Destroy notifications\n    for (const notif of this.notifications) {\n      notif.text.destroy();\n    }\n    this.notifications = [];\n\n    // Destroy damage texts\n    for (const entry of this.damageTexts) {\n      entry.text.destroy();\n    }\n    this.damageTexts = [];\n\n    // Destroy entrance markers\n    for (const e of this.dungeonEntrances) {\n      e.marker.destroy();\n      e.label.destroy();\n    }\n    this.dungeonEntrances = [];\n\n    for (const e of this.settlementEntrances) {\n      e.marker.destroy();\n      e.label.destroy();\n    }\n    this.settlementEntrances = [];\n\n    for (const e of this.riftEntrances) {\n      e.marker.destroy();\n      e.label.destroy();\n    }\n    this.riftEntrances = [];\n\n    for (const e of this.buildingEntrances) {\n      e.marker.destroy();\n      e.label.destroy();\n    }\n    this.buildingEntrances = [];\n\n    for (const sc of this.shortcutEntrances) {\n      sc.marker.destroy();\n      sc.label.destroy();\n    }\n    this.shortcutEntrances = [];\n\n    for (const cf of this.campfires) {\n      cf.marker.destroy();\n      cf.label.destroy();\n    }\n    this.campfires = [];\n\n    // Destroy combo text\n    if (this.comboText) {\n      this.comboText.destroy();\n      this.comboText = null;\n    }\n\n    // Destroy cutscene overlay\n    if (this.cutsceneOverlay) {\n      this.cutsceneOverlay.destroy();\n      this.cutsceneOverlay = null;\n    }\n\n    // Destroy visual systems\n    this.lightingManager?.destroy();\n    this.particleManager?.destroy();\n    this.corruptionOverlay?.destroy();\n  }\n\n  // =========================================================================\n  // CUTSCENE OVERLAY\n  // =========================================================================\n\n  private showCutsceneOverlay(): void {\n    if (this.cutsceneOverlay) this.cutsceneOverlay.destroy();\n\n    const w = this.cameras.main.width;\n    const h = this.cameras.main.height;\n\n    this.cutsceneOverlay = this.add.container(0, 0).setScrollFactor(0).setDepth(10000);\n\n    // Dark backdrop\n    const bg = this.add.rectangle(w / 2, h / 2, w, h, 0x000000, 0.7);\n    this.cutsceneOverlay.add(bg);\n\n    // Text box at bottom\n    const boxH = 120;\n    const boxBg = this.add.rectangle(w / 2, h - boxH / 2 - 20, w - 80, boxH, 0x111122, 0.9);\n    boxBg.setStrokeStyle(1, 0x7dd3fc, 0.5);\n    this.cutsceneOverlay.add(boxBg);\n\n    // Speaker name\n    const speakerText = this.add.text(60, h - boxH - 10, '', {\n      fontFamily: 'monospace', fontSize: '13px', color: '#7dd3fc', fontStyle: 'bold',\n    });\n    speakerText.setName('cutscene_speaker');\n    this.cutsceneOverlay.add(speakerText);\n\n    // Body text\n    const bodyText = this.add.text(60, h - boxH + 10, '', {\n      fontFamily: 'monospace', fontSize: '11px', color: '#ffffff',\n      wordWrap: { width: w - 160 },\n      lineSpacing: 4,\n    });\n    bodyText.setName('cutscene_body');\n    this.cutsceneOverlay.add(bodyText);\n\n    // Continue prompt\n    const continueText = this.add.text(w - 80, h - 30, '[SPACE] Continue', {\n      fontFamily: 'monospace', fontSize: '9px', color: '#888888',\n    }).setOrigin(1, 1);\n    this.cutsceneOverlay.add(continueText);\n\n    // Listen for advance input\n    this.input.keyboard!.on('keydown-SPACE', this.advanceCutscene, this);\n    // Also allow clicking to advance\n    this.input.on('pointerdown', this.advanceCutscene, this);\n\n    // Show first step\n    const step = this.cutsceneManager.getCurrentStep();\n    if (step) this.updateCutsceneOverlay(step);\n  }\n\n  private updateCutsceneOverlay(step: CutsceneStep): void {\n    if (!this.cutsceneOverlay) return;\n\n    const speakerText = this.cutsceneOverlay.getByName('cutscene_speaker') as Phaser.GameObjects.Text;\n    const bodyText = this.cutsceneOverlay.getByName('cutscene_body') as Phaser.GameObjects.Text;\n\n    if (step.type === 'narration') {\n      speakerText?.setText('');\n      bodyText?.setText(step.text ?? '');\n    } else if (step.type === 'dialogue') {\n      speakerText?.setText(step.speaker ?? '');\n      bodyText?.setText(step.text ?? '');\n    } else if (step.type === 'wait') {\n      speakerText?.setText('');\n      bodyText?.setText('...');\n      // Auto-advance after duration\n      this.time.delayedCall(step.duration ?? 2000, () => {\n        if (this.cutsceneManager.isPlaying()) {\n          this.cutsceneManager.advance();\n        }\n      });\n    }\n  }\n\n  private advanceCutscene = (): void => {\n    if (this.cutsceneManager.isPlaying()) {\n      const step = this.cutsceneManager.getCurrentStep();\n      // Don't advance during wait steps (they auto-advance)\n      if (step?.type !== 'wait') {\n        this.cutsceneManager.advance();\n      }\n    }\n  };\n\n  private hideCutsceneOverlay(): void {\n    this.input.keyboard!.off('keydown-SPACE', this.advanceCutscene, this);\n    this.input.off('pointerdown', this.advanceCutscene, this);\n\n    if (this.cutsceneOverlay) {\n      this.cutsceneOverlay.destroy();\n      this.cutsceneOverlay = null;\n    }\n  }\n\n  shutdown(): void {\n    this.cleanUp();\n    this.chunkManager.destroy();\n    this.playerController.destroy();\n    this.npcManager.destroy();\n  }\n}\n","/**\n * EDILAS (Phaser) - Dungeon Definitions\n * All 12 dungeons with floor configs, enemy pools, traps, and boss data.\n */\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\nexport type TrapType = 'spike' | 'arrow' | 'poison_gas' | 'pitfall' | 'boulder';\nexport type RoomType = 'monster' | 'treasure' | 'boss' | 'shop' | 'puzzle' | 'trap' | 'seal' | 'entrance' | 'corridor';\n\nexport interface DungeonFloor {\n  level: number;\n  enemyPool: string[];\n  trapTypes: TrapType[];\n  roomCount: { min: number; max: number };\n  hasBoss: boolean;\n  bossId?: string;\n}\n\nexport interface DungeonDef {\n  id: string;\n  name: string;\n  description: string;\n  biome: string;\n  difficulty: number;\n  floors: DungeonFloor[];\n  requiredLevel: number;\n  requiredItems?: string[];\n  rewardPool: { itemId: string; chance: number }[];\n  music: string;\n  ambience: string;\n  tileSet: string;\n}\n\n// ---------------------------------------------------------------------------\n// Helper – build a range of standard floors\n// ---------------------------------------------------------------------------\n\nfunction makeFloors(\n  count: number,\n  enemyPool: string[],\n  trapProgression: TrapType[][],\n  bossMap: Record<number, string>,\n  roomScale: { base: number; perFloor: number; max: number } = { base: 4, perFloor: 0.3, max: 12 },\n): DungeonFloor[] {\n  const floors: DungeonFloor[] = [];\n  for (let i = 1; i <= count; i++) {\n    const tierIndex = Math.min(\n      Math.floor((i - 1) / (count / trapProgression.length)),\n      trapProgression.length - 1,\n    );\n    const roomMin = Math.min(roomScale.base + Math.floor(i * roomScale.perFloor), roomScale.max);\n    const roomMax = roomMin + 2;\n    floors.push({\n      level: i,\n      enemyPool,\n      trapTypes: trapProgression[tierIndex],\n      roomCount: { min: roomMin, max: roomMax },\n      hasBoss: bossMap[i] !== undefined,\n      ...(bossMap[i] ? { bossId: bossMap[i] } : {}),\n    });\n  }\n  return floors;\n}\n\n// ---------------------------------------------------------------------------\n// Dungeon definitions\n// ---------------------------------------------------------------------------\n\nexport const DUNGEONS: DungeonDef[] = [\n\n  // =========================================================================\n  // 1. THE MINES  (ported from original – id: mines)\n  //    Classic starter dungeon. 120 floors, cave theme.\n  // =========================================================================\n  {\n    id: 'mines',\n    name: 'The Mines',\n    description: 'An ancient mine system beneath the mountains, rich with ore and crawling with creatures.',\n    biome: 'cave',\n    difficulty: 1,\n    requiredLevel: 1,\n    music: 'dungeon',\n    ambience: 'cave_drip',\n    tileSet: 'dungeon_stone',\n    floors: makeFloors(\n      120,\n      ['slime', 'bat', 'skeleton'],\n      [\n        ['spike'],\n        ['spike', 'arrow'],\n        ['spike', 'arrow', 'poison_gas'],\n        ['spike', 'arrow', 'poison_gas', 'pitfall'],\n        ['spike', 'arrow', 'poison_gas', 'pitfall', 'boulder'],\n      ],\n      {\n        20: 'slime_king',\n        40: 'shadow_lord',\n        60: 'frost_wyrm',\n        80: 'ancient_golem',\n        100: 'void_empress',\n        120: 'slime_king', // gauntlet repeat\n      },\n    ),\n    rewardPool: [\n      { itemId: 'copper_ore', chance: 0.30 },\n      { itemId: 'iron_ore', chance: 0.25 },\n      { itemId: 'gold_ore', chance: 0.15 },\n      { itemId: 'amethyst', chance: 0.08 },\n      { itemId: 'topaz', chance: 0.07 },\n      { itemId: 'emerald', chance: 0.06 },\n      { itemId: 'ruby', chance: 0.05 },\n      { itemId: 'diamond', chance: 0.04 },\n    ],\n  },\n\n  // =========================================================================\n  // 2. SKULL CAVERN  (ported – id: skull_cavern)\n  //    Infinite desert dungeon. Unlocks after Mines floor 120.\n  // =========================================================================\n  {\n    id: 'skull_cavern',\n    name: 'Skull Cavern',\n    description: 'A bottomless cavern in the desert where the bravest adventurers seek iridium and glory.',\n    biome: 'desert',\n    difficulty: 5,\n    requiredLevel: 15,\n    requiredItems: ['skull_key'],\n    music: 'dungeon',\n    ambience: 'wind_howl',\n    tileSet: 'desert_stone',\n    // 100 defined floors; the system can generate more procedurally.\n    floors: makeFloors(\n      100,\n      ['skeleton', 'goblin', 'mummy', 'serpent'],\n      [\n        ['spike', 'arrow'],\n        ['spike', 'arrow', 'poison_gas'],\n        ['spike', 'arrow', 'poison_gas', 'pitfall'],\n        ['spike', 'arrow', 'poison_gas', 'pitfall', 'boulder'],\n      ],\n      {\n        25: 'shadow_lord',\n        50: 'ancient_golem',\n        75: 'frost_wyrm',\n        100: 'void_empress',\n      },\n    ),\n    rewardPool: [\n      { itemId: 'iridium_ore', chance: 0.25 },\n      { itemId: 'gold_ore', chance: 0.20 },\n      { itemId: 'prismatic_shard', chance: 0.03 },\n      { itemId: 'diamond', chance: 0.08 },\n      { itemId: 'void_essence', chance: 0.15 },\n      { itemId: 'serpent_fang', chance: 0.10 },\n    ],\n  },\n\n  // =========================================================================\n  // 3. CORRUPTED GROVE  (ported – id: corrupted_grove)\n  //    Forest biome dungeon. 30 floors.\n  // =========================================================================\n  {\n    id: 'corrupted_grove',\n    name: 'Corrupted Grove',\n    description: 'A once-beautiful forest twisted by dark magic.',\n    biome: 'forest',\n    difficulty: 2,\n    requiredLevel: 5,\n    music: 'dungeon_forest',\n    ambience: 'forest_ambient',\n    tileSet: 'forest_floor',\n    floors: makeFloors(\n      30,\n      ['treant', 'sprite', 'wolf', 'spider'],\n      [\n        ['spike'],\n        ['spike', 'poison_gas'],\n        ['spike', 'poison_gas', 'pitfall'],\n      ],\n      {\n        10: 'grove_guardian',\n        20: 'forest_spider_queen',\n        30: 'ancient_treant',\n      },\n    ),\n    rewardPool: [\n      { itemId: 'wood', chance: 0.25 },\n      { itemId: 'vine', chance: 0.20 },\n      { itemId: 'mushroom', chance: 0.15 },\n      { itemId: 'ancient_bark', chance: 0.10 },\n      { itemId: 'living_sap', chance: 0.08 },\n      { itemId: 'forest_heart', chance: 0.05 },\n      { itemId: 'treant_heart', chance: 0.03 },\n      { itemId: 'natures_blessing', chance: 0.02 },\n    ],\n  },\n\n  // =========================================================================\n  // 4. BLIGHTED MARSH  (ported – id: blighted_marsh)\n  //    Swamp biome dungeon. 25 floors.\n  // =========================================================================\n  {\n    id: 'blighted_marsh',\n    name: 'Blighted Marsh',\n    description: 'Fetid swamplands filled with toxic creatures.',\n    biome: 'swamp',\n    difficulty: 3,\n    requiredLevel: 8,\n    music: 'dungeon_swamp',\n    ambience: 'swamp_bubbles',\n    tileSet: 'swamp_mud',\n    floors: makeFloors(\n      25,\n      ['frog', 'leech', 'bog_zombie', 'will_o_wisp'],\n      [\n        ['poison_gas'],\n        ['poison_gas', 'pitfall'],\n        ['poison_gas', 'pitfall', 'spike'],\n      ],\n      {\n        12: 'marsh_lurker',\n        25: 'swamp_horror',\n      },\n    ),\n    rewardPool: [\n      { itemId: 'swamp_moss', chance: 0.20 },\n      { itemId: 'toxin_gland', chance: 0.18 },\n      { itemId: 'murky_water', chance: 0.15 },\n      { itemId: 'venom_sac', chance: 0.10 },\n      { itemId: 'bog_essence', chance: 0.08 },\n      { itemId: 'marsh_eye', chance: 0.06 },\n      { itemId: 'horror_tentacle', chance: 0.04 },\n      { itemId: 'blighted_heart', chance: 0.03 },\n    ],\n  },\n\n  // =========================================================================\n  // 5. SCORCHED WASTES  (ported – id: scorched_wastes)\n  //    Volcanic biome dungeon. 35 floors.\n  // =========================================================================\n  {\n    id: 'scorched_wastes',\n    name: 'Scorched Wastes',\n    description: 'Volcanic caverns beneath a scorched wasteland.',\n    biome: 'volcano',\n    difficulty: 4,\n    requiredLevel: 12,\n    music: 'dungeon_volcano',\n    ambience: 'lava_rumble',\n    tileSet: 'volcanic_rock',\n    floors: makeFloors(\n      35,\n      ['fire_imp', 'magma_slime', 'fire_elemental', 'lava_serpent'],\n      [\n        ['spike', 'arrow'],\n        ['spike', 'arrow', 'boulder'],\n        ['spike', 'arrow', 'boulder', 'pitfall'],\n      ],\n      {\n        15: 'fire_imp_king',\n        25: 'lava_golem',\n        35: 'molten_guardian',\n      },\n    ),\n    rewardPool: [\n      { itemId: 'fire_ore', chance: 0.22 },\n      { itemId: 'obsidian', chance: 0.18 },\n      { itemId: 'ash', chance: 0.15 },\n      { itemId: 'magma_core', chance: 0.10 },\n      { itemId: 'fire_crystal', chance: 0.08 },\n      { itemId: 'flame_core', chance: 0.06 },\n      { itemId: 'molten_heart', chance: 0.04 },\n      { itemId: 'infernal_essence', chance: 0.03 },\n    ],\n  },\n\n  // =========================================================================\n  // 6. FROZEN DEPTHS  (ported – id: frozen_depths)\n  //    Ice/snow biome dungeon. 40 floors.\n  // =========================================================================\n  {\n    id: 'frozen_depths',\n    name: 'Frozen Depths',\n    description: 'Ancient ice caverns where the cold never fades.',\n    biome: 'snow',\n    difficulty: 4,\n    requiredLevel: 12,\n    music: 'dungeon_ice',\n    ambience: 'wind_howl',\n    tileSet: 'ice_floor',\n    floors: makeFloors(\n      40,\n      ['ice_elemental', 'frost_sprite', 'yeti', 'ice_wraith'],\n      [\n        ['spike'],\n        ['spike', 'arrow'],\n        ['spike', 'arrow', 'pitfall'],\n        ['spike', 'arrow', 'pitfall', 'boulder'],\n      ],\n      {\n        15: 'frost_guardian',\n        30: 'ice_demon',\n        40: 'frost_wyrm',\n      },\n    ),\n    rewardPool: [\n      { itemId: 'ice_crystal', chance: 0.22 },\n      { itemId: 'frozen_tear', chance: 0.18 },\n      { itemId: 'snow_essence', chance: 0.15 },\n      { itemId: 'permafrost', chance: 0.10 },\n      { itemId: 'glacial_shard', chance: 0.08 },\n      { itemId: 'frost_shard', chance: 0.06 },\n      { itemId: 'wyrm_scale', chance: 0.04 },\n      { itemId: 'heart_of_winter', chance: 0.03 },\n    ],\n  },\n\n  // =========================================================================\n  // 7. HAUNTED RUINS  (ported – id: haunted_ruins)\n  //    Undead/wasteland biome dungeon. 50 floors.\n  // =========================================================================\n  {\n    id: 'haunted_ruins',\n    name: 'Haunted Ruins',\n    description: 'Ancient ruins infested with restless spirits.',\n    biome: 'wasteland',\n    difficulty: 5,\n    requiredLevel: 15,\n    music: 'dungeon_undead',\n    ambience: 'ghost_whisper',\n    tileSet: 'crypt_stone',\n    floors: makeFloors(\n      50,\n      ['skeleton', 'ghost', 'zombie', 'wraith', 'bone_knight'],\n      [\n        ['spike', 'arrow'],\n        ['spike', 'arrow', 'poison_gas'],\n        ['spike', 'arrow', 'poison_gas', 'pitfall'],\n        ['spike', 'arrow', 'poison_gas', 'pitfall', 'boulder'],\n      ],\n      {\n        20: 'bone_lord',\n        35: 'spectral_warden',\n        50: 'lich_king',\n      },\n    ),\n    rewardPool: [\n      { itemId: 'bone', chance: 0.20 },\n      { itemId: 'ectoplasm', chance: 0.18 },\n      { itemId: 'grave_dust', chance: 0.15 },\n      { itemId: 'soul_fragment', chance: 0.10 },\n      { itemId: 'spirit_essence', chance: 0.08 },\n      { itemId: 'cursed_relic', chance: 0.06 },\n      { itemId: 'lich_phylactery', chance: 0.03 },\n      { itemId: 'death_crown', chance: 0.02 },\n    ],\n  },\n\n  // =========================================================================\n  // 8. SUNKEN TEMPLE  (new – id: sunken_temple)\n  //    Coastal / underwater themed dungeon. 30 floors.\n  // =========================================================================\n  {\n    id: 'sunken_temple',\n    name: 'Sunken Temple',\n    description: 'A drowned temple beneath the coastal cliffs, swallowed by the rising tide centuries ago.',\n    biome: 'beach',\n    difficulty: 3,\n    requiredLevel: 10,\n    music: 'dungeon',\n    ambience: 'underwater_current',\n    tileSet: 'coral_stone',\n    floors: makeFloors(\n      30,\n      ['crab_warrior', 'drowned_zombie', 'jellyfish', 'sea_serpent'],\n      [\n        ['spike'],\n        ['spike', 'poison_gas'],\n        ['spike', 'poison_gas', 'pitfall'],\n      ],\n      {\n        10: 'tide_warden',\n        20: 'kraken_spawn',\n        30: 'deep_leviathan',\n      },\n    ),\n    rewardPool: [\n      { itemId: 'coral_shard', chance: 0.22 },\n      { itemId: 'sea_glass', chance: 0.18 },\n      { itemId: 'pearl', chance: 0.12 },\n      { itemId: 'trident_fragment', chance: 0.08 },\n      { itemId: 'ocean_heart', chance: 0.05 },\n      { itemId: 'neptune_scale', chance: 0.04 },\n      { itemId: 'abyssal_pearl', chance: 0.03 },\n      { itemId: 'leviathan_tooth', chance: 0.02 },\n    ],\n  },\n\n  // =========================================================================\n  // 9. CRYSTAL CAVERNS  (new – id: crystal_caverns)\n  //    Gem-rich underground caverns with prismatic hazards. 35 floors.\n  // =========================================================================\n  {\n    id: 'crystal_caverns',\n    name: 'Crystal Caverns',\n    description: 'Shimmering underground grottos where living crystals pulse with arcane energy.',\n    biome: 'cave',\n    difficulty: 3,\n    requiredLevel: 10,\n    music: 'dungeon',\n    ambience: 'crystal_hum',\n    tileSet: 'crystal_floor',\n    floors: makeFloors(\n      35,\n      ['crystal_golem', 'gem_beetle', 'prism_bat', 'shard_elemental'],\n      [\n        ['spike'],\n        ['spike', 'arrow'],\n        ['spike', 'arrow', 'boulder'],\n      ],\n      {\n        12: 'crystal_sentinel',\n        24: 'prism_colossus',\n        35: 'geode_monarch',\n      },\n    ),\n    rewardPool: [\n      { itemId: 'amethyst', chance: 0.18 },\n      { itemId: 'topaz', chance: 0.15 },\n      { itemId: 'emerald', chance: 0.12 },\n      { itemId: 'ruby', chance: 0.10 },\n      { itemId: 'diamond', chance: 0.08 },\n      { itemId: 'prismatic_shard', chance: 0.04 },\n      { itemId: 'crystal_heart', chance: 0.03 },\n      { itemId: 'geode_crown', chance: 0.02 },\n    ],\n  },\n\n  // =========================================================================\n  // 10. SHADOW RIFT  (new – id: shadow_rift)\n  //     Void / shadow dimension dungeon. 45 floors.\n  //     End-game dungeon inspired by the Void Dungeon references in bestiary.\n  // =========================================================================\n  {\n    id: 'shadow_rift',\n    name: 'Shadow Rift',\n    description: 'A tear in reality where the void bleeds into the world. Dark energy warps everything within.',\n    biome: 'void',\n    difficulty: 6,\n    requiredLevel: 20,\n    requiredItems: ['void_talisman'],\n    music: 'dungeon_undead',\n    ambience: 'void_hum',\n    tileSet: 'void_stone',\n    floors: makeFloors(\n      45,\n      ['shadow_brute', 'wraith', 'void_slime', 'phantom', 'dark_mage'],\n      [\n        ['spike', 'arrow'],\n        ['spike', 'arrow', 'poison_gas'],\n        ['spike', 'arrow', 'poison_gas', 'pitfall'],\n        ['spike', 'arrow', 'poison_gas', 'pitfall', 'boulder'],\n      ],\n      {\n        15: 'shadow_lord',\n        30: 'void_warden',\n        45: 'void_empress',\n      },\n    ),\n    rewardPool: [\n      { itemId: 'void_essence', chance: 0.25 },\n      { itemId: 'shadow_orb', chance: 0.18 },\n      { itemId: 'dark_shard', chance: 0.12 },\n      { itemId: 'void_heart', chance: 0.06 },\n      { itemId: 'shadow_blade', chance: 0.04 },\n      { itemId: 'galaxy_soul', chance: 0.03 },\n      { itemId: 'void_crown', chance: 0.02 },\n      { itemId: 'galaxy_sword', chance: 0.01 },\n    ],\n  },\n\n  // =========================================================================\n  // 11. DESERT TOMB  (new – id: desert_tomb)\n  //     Sand-buried pyramid dungeon. 30 floors.\n  //     The mummy habitat referenced in the bestiary.\n  // =========================================================================\n  {\n    id: 'desert_tomb',\n    name: 'Desert Tomb',\n    description: 'A sealed pharaoh\\'s tomb hidden beneath shifting sands, guarded by undying sentinels.',\n    biome: 'desert',\n    difficulty: 4,\n    requiredLevel: 12,\n    music: 'dungeon',\n    ambience: 'sand_wind',\n    tileSet: 'sandstone',\n    floors: makeFloors(\n      30,\n      ['mummy', 'scarab_swarm', 'sand_golem', 'desert_wraith'],\n      [\n        ['spike', 'arrow'],\n        ['spike', 'arrow', 'pitfall'],\n        ['spike', 'arrow', 'pitfall', 'boulder'],\n      ],\n      {\n        10: 'tomb_guardian',\n        20: 'anubis_knight',\n        30: 'pharaoh_lord',\n      },\n    ),\n    rewardPool: [\n      { itemId: 'ancient_relic', chance: 0.20 },\n      { itemId: 'gold_ore', chance: 0.18 },\n      { itemId: 'scarab_gem', chance: 0.12 },\n      { itemId: 'pharaoh_mask', chance: 0.05 },\n      { itemId: 'desert_rose', chance: 0.10 },\n      { itemId: 'sun_stone', chance: 0.06 },\n      { itemId: 'ankh_charm', chance: 0.04 },\n      { itemId: 'sands_of_time', chance: 0.03 },\n    ],\n  },\n\n  // =========================================================================\n  // 12. WINDSWEPT SPIRE  (new – id: windswept_spire)\n  //     Mountain / sky tower dungeon. 40 floors. Ascend upward.\n  // =========================================================================\n  {\n    id: 'windswept_spire',\n    name: 'Windswept Spire',\n    description: 'A crumbling tower that pierces the clouds atop the highest peak, home to aerial predators and ancient magic.',\n    biome: 'mountain',\n    difficulty: 5,\n    requiredLevel: 15,\n    music: 'dungeon',\n    ambience: 'high_wind',\n    tileSet: 'marble_stone',\n    floors: makeFloors(\n      40,\n      ['harpy', 'wind_elemental', 'stone_gargoyle', 'storm_drake'],\n      [\n        ['arrow'],\n        ['arrow', 'pitfall'],\n        ['arrow', 'pitfall', 'boulder'],\n        ['arrow', 'pitfall', 'boulder', 'spike'],\n      ],\n      {\n        10: 'gale_sentinel',\n        20: 'thunder_roc',\n        30: 'storm_titan',\n        40: 'sky_sovereign',\n      },\n    ),\n    rewardPool: [\n      { itemId: 'wind_essence', chance: 0.22 },\n      { itemId: 'feather_steel', chance: 0.15 },\n      { itemId: 'storm_crystal', chance: 0.10 },\n      { itemId: 'cloud_marble', chance: 0.12 },\n      { itemId: 'sky_shard', chance: 0.08 },\n      { itemId: 'roc_talon', chance: 0.05 },\n      { itemId: 'thunder_heart', chance: 0.04 },\n      { itemId: 'sovereign_plume', chance: 0.02 },\n    ],\n  },\n\n];\n\n// ---------------------------------------------------------------------------\n// Lookup map\n// ---------------------------------------------------------------------------\n\nexport const DUNGEON_DB = new Map<string, DungeonDef>(\n  DUNGEONS.map(d => [d.id, d]),\n);\n","/**\n * EDILAS (Phaser) - Dungeon Manager\n * Procedural dungeon floor generator using BSP (Binary Space Partitioning).\n * Handles floor layout, fog of war, room clearing, and A* pathfinding.\n */\n\nimport { SeededRandom } from '../world/SeededRandom';\nimport { DUNGEON_DB, DungeonFloor, RoomType, TrapType } from '../data/dungeons';\n\n// ---------------------------------------------------------------------------\n// Constants\n// ---------------------------------------------------------------------------\n\n/** Default dungeon grid dimensions in tiles */\nconst GRID_WIDTH = 60;\nconst GRID_HEIGHT = 60;\n\n/** BSP split constraints */\nconst MIN_LEAF_SIZE = 8;\nconst MAX_LEAF_SIZE = 15;\n\n/** Room size constraints within a BSP leaf */\nconst MIN_ROOM_SIZE = 5;\nconst MAX_ROOM_SIZE = 10;\n\n/** Tile types in the grid */\nexport const Tile = {\n  Wall: 0,\n  Floor: 1,\n  Corridor: 2,\n} as const;\n\n/** Trap damage values per trap type */\nexport const TRAP_DAMAGE: Record<TrapType, number> = {\n  spike: 15,\n  arrow: 20,\n  poison_gas: 10,\n  pitfall: 30,\n  boulder: 50,\n};\n\n// ---------------------------------------------------------------------------\n// Interfaces\n// ---------------------------------------------------------------------------\n\nexport interface DungeonRoom {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  type: RoomType;\n  connected: number[];    // Indices of connected rooms\n  cleared: boolean;\n  enemies: { typeId: string; x: number; y: number }[];\n  traps: { type: TrapType; x: number; y: number; triggered: boolean }[];\n  loot: { itemId: string; x: number; y: number; collected: boolean }[];\n}\n\nexport interface DungeonFloorState {\n  dungeonId: string;\n  floorLevel: number;\n  rooms: DungeonRoom[];\n  grid: number[][];        // 2D grid: 0=wall, 1=floor, 2=corridor\n  explored: boolean[][];   // Fog of war\n  playerRoom: number;\n  width: number;\n  height: number;\n}\n\n// ---------------------------------------------------------------------------\n// BSP tree node (internal)\n// ---------------------------------------------------------------------------\n\ninterface BSPNode {\n  x: number;\n  y: number;\n  w: number;\n  h: number;\n  left: BSPNode | null;\n  right: BSPNode | null;\n  room: { x: number; y: number; w: number; h: number } | null;\n}\n\n// ---------------------------------------------------------------------------\n// BSP splitting\n// ---------------------------------------------------------------------------\n\nfunction splitBSP(node: BSPNode, rng: SeededRandom, depth: number = 0): void {\n  // Stop if the node is small enough or we've recursed deep enough\n  if (node.w <= MAX_LEAF_SIZE && node.h <= MAX_LEAF_SIZE) return;\n  if (node.w < MIN_LEAF_SIZE * 2 && node.h < MIN_LEAF_SIZE * 2) return;\n\n  // Decide split direction: alternate with random bias\n  let splitH: boolean;\n  if (node.w < MIN_LEAF_SIZE * 2) {\n    splitH = true;\n  } else if (node.h < MIN_LEAF_SIZE * 2) {\n    splitH = false;\n  } else {\n    splitH = depth % 2 === 0 ? rng.next() > 0.4 : rng.next() > 0.6;\n  }\n\n  if (splitH) {\n    // Horizontal split (top/bottom)\n    const maxSplit = node.h - MIN_LEAF_SIZE;\n    if (maxSplit < MIN_LEAF_SIZE) return;\n    const split = rng.nextInt(MIN_LEAF_SIZE, maxSplit);\n\n    node.left = { x: node.x, y: node.y, w: node.w, h: split, left: null, right: null, room: null };\n    node.right = { x: node.x, y: node.y + split, w: node.w, h: node.h - split, left: null, right: null, room: null };\n  } else {\n    // Vertical split (left/right)\n    const maxSplit = node.w - MIN_LEAF_SIZE;\n    if (maxSplit < MIN_LEAF_SIZE) return;\n    const split = rng.nextInt(MIN_LEAF_SIZE, maxSplit);\n\n    node.left = { x: node.x, y: node.y, w: split, h: node.h, left: null, right: null, room: null };\n    node.right = { x: node.x + split, y: node.y, w: node.w - split, h: node.h, left: null, right: null, room: null };\n  }\n\n  splitBSP(node.left, rng, depth + 1);\n  splitBSP(node.right, rng, depth + 1);\n}\n\n// ---------------------------------------------------------------------------\n// Room placement within BSP leaves\n// ---------------------------------------------------------------------------\n\nfunction placeRooms(node: BSPNode, rng: SeededRandom): void {\n  if (node.left !== null && node.right !== null) {\n    placeRooms(node.left, rng);\n    placeRooms(node.right, rng);\n    return;\n  }\n\n  // This is a leaf — place a room\n  const roomW = rng.nextInt(MIN_ROOM_SIZE, Math.min(MAX_ROOM_SIZE, node.w - 2));\n  const roomH = rng.nextInt(MIN_ROOM_SIZE, Math.min(MAX_ROOM_SIZE, node.h - 2));\n  const roomX = rng.nextInt(node.x + 1, node.x + node.w - roomW - 1);\n  const roomY = rng.nextInt(node.y + 1, node.y + node.h - roomH - 1);\n\n  node.room = { x: roomX, y: roomY, w: roomW, h: roomH };\n}\n\n// ---------------------------------------------------------------------------\n// Collect leaf rooms from BSP tree\n// ---------------------------------------------------------------------------\n\nfunction collectLeafRooms(node: BSPNode): { x: number; y: number; w: number; h: number }[] {\n  const result: { x: number; y: number; w: number; h: number }[] = [];\n\n  if (node.room !== null) {\n    result.push(node.room);\n  }\n  if (node.left !== null) {\n    result.push(...collectLeafRooms(node.left));\n  }\n  if (node.right !== null) {\n    result.push(...collectLeafRooms(node.right));\n  }\n\n  return result;\n}\n\n// ---------------------------------------------------------------------------\n// Get a room center from a BSP subtree (for corridor connection)\n// ---------------------------------------------------------------------------\n\nfunction getSubtreeRoomCenter(node: BSPNode): { x: number; y: number } | null {\n  if (node.room !== null) {\n    return {\n      x: Math.floor(node.room.x + node.room.w / 2),\n      y: Math.floor(node.room.y + node.room.h / 2),\n    };\n  }\n  if (node.left !== null) {\n    const c = getSubtreeRoomCenter(node.left);\n    if (c !== null) return c;\n  }\n  if (node.right !== null) {\n    return getSubtreeRoomCenter(node.right);\n  }\n  return null;\n}\n\n// ---------------------------------------------------------------------------\n// Carve L-shaped corridors between sibling BSP nodes\n// ---------------------------------------------------------------------------\n\nfunction carveCorridor(\n  grid: number[][],\n  x1: number, y1: number,\n  x2: number, y2: number,\n): void {\n  // L-shaped: horizontal first, then vertical\n  let cx = x1;\n  let cy = y1;\n\n  // Horizontal segment\n  const dx = x2 > cx ? 1 : -1;\n  while (cx !== x2) {\n    if (cy >= 0 && cy < grid.length && cx >= 0 && cx < grid[0].length) {\n      if (grid[cy][cx] === Tile.Wall) {\n        grid[cy][cx] = Tile.Corridor;\n      }\n    }\n    cx += dx;\n  }\n\n  // Vertical segment\n  const dy = y2 > cy ? 1 : -1;\n  while (cy !== y2) {\n    if (cy >= 0 && cy < grid.length && cx >= 0 && cx < grid[0].length) {\n      if (grid[cy][cx] === Tile.Wall) {\n        grid[cy][cx] = Tile.Corridor;\n      }\n    }\n    cy += dy;\n  }\n\n  // Mark the endpoint\n  if (cy >= 0 && cy < grid.length && cx >= 0 && cx < grid[0].length) {\n    if (grid[cy][cx] === Tile.Wall) {\n      grid[cy][cx] = Tile.Corridor;\n    }\n  }\n}\n\nfunction connectBSP(node: BSPNode, grid: number[][]): void {\n  if (node.left === null || node.right === null) return;\n\n  connectBSP(node.left, grid);\n  connectBSP(node.right, grid);\n\n  const leftCenter = getSubtreeRoomCenter(node.left);\n  const rightCenter = getSubtreeRoomCenter(node.right);\n\n  if (leftCenter !== null && rightCenter !== null) {\n    carveCorridor(grid, leftCenter.x, leftCenter.y, rightCenter.x, rightCenter.y);\n  }\n}\n\n// ---------------------------------------------------------------------------\n// Room type assignment\n// ---------------------------------------------------------------------------\n\nfunction assignRoomTypes(\n  rooms: DungeonRoom[],\n  floor: DungeonFloor,\n  rng: SeededRandom,\n): void {\n  if (rooms.length === 0) return;\n\n  // First room is always entrance\n  rooms[0].type = 'entrance';\n\n  // If boss floor, last room is boss\n  if (floor.hasBoss && rooms.length > 1) {\n    rooms[rooms.length - 1].type = 'boss';\n  }\n\n  // Weighted distribution for remaining rooms\n  const typeWeights: { type: RoomType; weight: number }[] = [\n    { type: 'monster', weight: 50 },\n    { type: 'treasure', weight: 15 },\n    { type: 'trap', weight: 10 },\n    { type: 'puzzle', weight: 10 },\n    { type: 'shop', weight: 5 },\n    { type: 'corridor', weight: 10 },\n  ];\n\n  const types = typeWeights.map(tw => tw.type);\n  const weights = typeWeights.map(tw => tw.weight);\n\n  for (let i = 0; i < rooms.length; i++) {\n    // Skip rooms that already have an assigned type\n    if (rooms[i].type !== 'monster') continue;\n    if (i === 0) continue; // entrance\n    if (floor.hasBoss && i === rooms.length - 1) continue; // boss\n\n    rooms[i].type = rng.weightedPick(types, weights);\n  }\n}\n\n// ---------------------------------------------------------------------------\n// Populate rooms with enemies, traps, and loot\n// ---------------------------------------------------------------------------\n\nfunction populateRoom(\n  room: DungeonRoom,\n  floor: DungeonFloor,\n  rng: SeededRandom,\n  dungeonRewardPool: { itemId: string; chance: number }[],\n): void {\n  const roomArea = room.width * room.height;\n\n  switch (room.type) {\n    case 'monster': {\n      // Enemy count based on room area\n      const enemyCount = Math.max(1, Math.floor(roomArea / 25));\n      for (let i = 0; i < enemyCount; i++) {\n        if (floor.enemyPool.length === 0) break;\n        const typeId = rng.pick(floor.enemyPool);\n        const ex = rng.nextInt(room.x + 1, room.x + room.width - 2);\n        const ey = rng.nextInt(room.y + 1, room.y + room.height - 2);\n        room.enemies.push({ typeId, x: ex, y: ey });\n      }\n      break;\n    }\n\n    case 'trap': {\n      // Place traps from the floor's trap pool\n      const trapCount = Math.max(1, Math.floor(roomArea / 20));\n      for (let i = 0; i < trapCount; i++) {\n        if (floor.trapTypes.length === 0) break;\n        const trapType = rng.pick(floor.trapTypes);\n        const tx = rng.nextInt(room.x + 1, room.x + room.width - 2);\n        const ty = rng.nextInt(room.y + 1, room.y + room.height - 2);\n        room.traps.push({ type: trapType, x: tx, y: ty, triggered: false });\n      }\n      // Trap rooms also have a few enemies for pressure\n      const guardCount = Math.max(1, Math.floor(roomArea / 40));\n      for (let i = 0; i < guardCount; i++) {\n        if (floor.enemyPool.length === 0) break;\n        const typeId = rng.pick(floor.enemyPool);\n        const ex = rng.nextInt(room.x + 1, room.x + room.width - 2);\n        const ey = rng.nextInt(room.y + 1, room.y + room.height - 2);\n        room.enemies.push({ typeId, x: ex, y: ey });\n      }\n      break;\n    }\n\n    case 'treasure': {\n      // Place loot items from the dungeon reward pool\n      const lootCount = rng.nextInt(1, 3);\n      for (let i = 0; i < lootCount; i++) {\n        if (dungeonRewardPool.length === 0) break;\n        // Pick an item from reward pool weighted by chance\n        const items = dungeonRewardPool.map(r => r.itemId);\n        const chances = dungeonRewardPool.map(r => r.chance);\n        const itemId = rng.weightedPick(items, chances);\n        const lx = rng.nextInt(room.x + 1, room.x + room.width - 2);\n        const ly = rng.nextInt(room.y + 1, room.y + room.height - 2);\n        room.loot.push({ itemId, x: lx, y: ly, collected: false });\n      }\n      // Treasure rooms may have a guard\n      if (rng.next() < 0.6 && floor.enemyPool.length > 0) {\n        const typeId = rng.pick(floor.enemyPool);\n        const ex = rng.nextInt(room.x + 1, room.x + room.width - 2);\n        const ey = rng.nextInt(room.y + 1, room.y + room.height - 2);\n        room.enemies.push({ typeId, x: ex, y: ey });\n      }\n      break;\n    }\n\n    case 'boss': {\n      // Boss placement is handled externally by BossController\n      // Just mark the center for spawn location\n      break;\n    }\n\n    case 'puzzle': {\n      // Puzzle rooms have a reward if solved\n      if (dungeonRewardPool.length > 0) {\n        const items = dungeonRewardPool.map(r => r.itemId);\n        const chances = dungeonRewardPool.map(r => r.chance);\n        const itemId = rng.weightedPick(items, chances);\n        const lx = Math.floor(room.x + room.width / 2);\n        const ly = Math.floor(room.y + room.height / 2);\n        room.loot.push({ itemId, x: lx, y: ly, collected: false });\n      }\n      break;\n    }\n\n    case 'shop':\n    case 'entrance':\n    case 'corridor':\n    case 'seal':\n      // No enemies or traps in these rooms\n      break;\n  }\n}\n\n// ---------------------------------------------------------------------------\n// Public API\n// ---------------------------------------------------------------------------\n\n/**\n * Generate a dungeon floor using BSP tree partitioning.\n * Returns a fully populated DungeonFloorState ready for rendering and gameplay.\n */\nexport function generateFloor(\n  dungeonId: string,\n  floorLevel: number,\n  seed: number,\n): DungeonFloorState {\n  const rng = new SeededRandom(seed);\n  const dungeon = DUNGEON_DB.get(dungeonId);\n\n  if (!dungeon) {\n    throw new Error(`Unknown dungeon ID: \"${dungeonId}\"`);\n  }\n\n  // Find the floor definition (clamp to last floor if out of range)\n  const floorDef = dungeon.floors.find(f => f.level === floorLevel)\n    ?? dungeon.floors[dungeon.floors.length - 1];\n\n  // Determine room count from the floor definition\n  const targetRoomCount = rng.nextInt(floorDef.roomCount.min, floorDef.roomCount.max);\n\n  // --- Build BSP tree ---\n  const root: BSPNode = {\n    x: 0, y: 0,\n    w: GRID_WIDTH, h: GRID_HEIGHT,\n    left: null, right: null, room: null,\n  };\n\n  splitBSP(root, rng);\n  placeRooms(root, rng);\n\n  // --- Initialize grid (all walls) ---\n  const grid: number[][] = [];\n  for (let row = 0; row < GRID_HEIGHT; row++) {\n    grid.push(new Array(GRID_WIDTH).fill(Tile.Wall));\n  }\n\n  // --- Carve rooms into the grid ---\n  const leafRooms = collectLeafRooms(root);\n\n  for (const lr of leafRooms) {\n    for (let row = lr.y; row < lr.y + lr.h && row < GRID_HEIGHT; row++) {\n      for (let col = lr.x; col < lr.x + lr.w && col < GRID_WIDTH; col++) {\n        grid[row][col] = Tile.Floor;\n      }\n    }\n  }\n\n  // --- Connect rooms with corridors ---\n  connectBSP(root, grid);\n\n  // --- Trim to target room count ---\n  // If BSP generated more rooms than needed, keep only targetRoomCount\n  const usedLeafRooms = leafRooms.slice(0, Math.min(targetRoomCount, leafRooms.length));\n\n  // --- Build DungeonRoom array ---\n  const rooms: DungeonRoom[] = usedLeafRooms.map(lr => ({\n    x: lr.x,\n    y: lr.y,\n    width: lr.w,\n    height: lr.h,\n    type: 'monster' as RoomType,  // Default; will be overwritten\n    connected: [],\n    cleared: false,\n    enemies: [],\n    traps: [],\n    loot: [],\n  }));\n\n  // --- Build connectivity (rooms sharing a corridor path are connected) ---\n  for (let i = 0; i < rooms.length; i++) {\n    for (let j = i + 1; j < rooms.length; j++) {\n      // Two rooms are connected if a corridor or floor tile path exists\n      // Simplified: connect rooms whose BSP leaves were siblings\n      // For gameplay, connect sequentially and add a few cross-connections\n      if (j === i + 1) {\n        rooms[i].connected.push(j);\n        rooms[j].connected.push(i);\n      }\n    }\n  }\n\n  // Add a few random cross-connections for variety\n  const crossConnectionCount = Math.max(1, Math.floor(rooms.length / 4));\n  for (let c = 0; c < crossConnectionCount; c++) {\n    const a = rng.nextInt(0, rooms.length - 1);\n    const b = rng.nextInt(0, rooms.length - 1);\n    if (a !== b && !rooms[a].connected.includes(b)) {\n      rooms[a].connected.push(b);\n      rooms[b].connected.push(a);\n    }\n  }\n\n  // --- Assign room types ---\n  assignRoomTypes(rooms, floorDef, rng);\n\n  // --- Populate rooms with enemies, traps, and loot ---\n  const rewardPool = dungeon.rewardPool;\n  for (const room of rooms) {\n    populateRoom(room, floorDef, rng, rewardPool);\n  }\n\n  // --- Initialize fog of war (all unexplored) ---\n  const explored: boolean[][] = [];\n  for (let row = 0; row < GRID_HEIGHT; row++) {\n    explored.push(new Array(GRID_WIDTH).fill(false));\n  }\n\n  // Start with the entrance room revealed\n  const entranceIndex = rooms.findIndex(r => r.type === 'entrance');\n  const state: DungeonFloorState = {\n    dungeonId,\n    floorLevel,\n    rooms,\n    grid,\n    explored,\n    playerRoom: entranceIndex >= 0 ? entranceIndex : 0,\n    width: GRID_WIDTH,\n    height: GRID_HEIGHT,\n  };\n\n  // Reveal the entrance room\n  if (entranceIndex >= 0) {\n    revealRoom(state, entranceIndex);\n  }\n\n  return state;\n}\n\n/**\n * Remove fog of war for the given room and its immediate tile boundary.\n */\nexport function revealRoom(state: DungeonFloorState, roomIndex: number): void {\n  if (roomIndex < 0 || roomIndex >= state.rooms.length) return;\n\n  const room = state.rooms[roomIndex];\n  const padding = 1; // Reveal one tile around the room edges\n\n  const startY = Math.max(0, room.y - padding);\n  const endY = Math.min(state.height - 1, room.y + room.height + padding);\n  const startX = Math.max(0, room.x - padding);\n  const endX = Math.min(state.width - 1, room.x + room.width + padding);\n\n  for (let row = startY; row <= endY; row++) {\n    for (let col = startX; col <= endX; col++) {\n      state.explored[row][col] = true;\n    }\n  }\n}\n\n/**\n * Mark a room as cleared (all enemies defeated, traps disarmed).\n */\nexport function clearRoom(state: DungeonFloorState, roomIndex: number): void {\n  if (roomIndex < 0 || roomIndex >= state.rooms.length) return;\n  state.rooms[roomIndex].cleared = true;\n}\n\n/**\n * Get the tile value at a grid position.\n * Returns Tile.Wall (0) for out-of-bounds coordinates.\n */\nexport function getTile(state: DungeonFloorState, x: number, y: number): number {\n  if (x < 0 || x >= state.width || y < 0 || y >= state.height) {\n    return Tile.Wall;\n  }\n  return state.grid[y][x];\n}\n\n/**\n * Check if a tile has been explored (fog of war cleared).\n * Returns false for out-of-bounds coordinates.\n */\nexport function isExplored(state: DungeonFloorState, x: number, y: number): boolean {\n  if (x < 0 || x >= state.width || y < 0 || y >= state.height) {\n    return false;\n  }\n  return state.explored[y][x];\n}\n\n// ---------------------------------------------------------------------------\n// A* pathfinding\n// ---------------------------------------------------------------------------\n\ninterface AStarNode {\n  x: number;\n  y: number;\n  g: number;\n  h: number;\n  f: number;\n  parent: AStarNode | null;\n}\n\nfunction heuristic(ax: number, ay: number, bx: number, by: number): number {\n  // Manhattan distance\n  return Math.abs(ax - bx) + Math.abs(ay - by);\n}\n\n/**\n * A* pathfinding on the dungeon grid.\n * Returns the path as an array of {x, y} positions from start to end (inclusive).\n * Returns an empty array if no path exists.\n * Only traverses floor (1) and corridor (2) tiles.\n */\nexport function findPath(\n  state: DungeonFloorState,\n  fromX: number, fromY: number,\n  toX: number, toY: number,\n): { x: number; y: number }[] {\n  // Clamp to grid bounds\n  fromX = Math.max(0, Math.min(state.width - 1, Math.floor(fromX)));\n  fromY = Math.max(0, Math.min(state.height - 1, Math.floor(fromY)));\n  toX = Math.max(0, Math.min(state.width - 1, Math.floor(toX)));\n  toY = Math.max(0, Math.min(state.height - 1, Math.floor(toY)));\n\n  // Quick check: if start or end is a wall, no path\n  if (state.grid[fromY][fromX] === Tile.Wall || state.grid[toY][toX] === Tile.Wall) {\n    return [];\n  }\n\n  // Already there\n  if (fromX === toX && fromY === toY) {\n    return [{ x: fromX, y: fromY }];\n  }\n\n  const openSet: AStarNode[] = [];\n  const closedSet = new Set<number>();\n\n  const startNode: AStarNode = {\n    x: fromX, y: fromY,\n    g: 0,\n    h: heuristic(fromX, fromY, toX, toY),\n    f: heuristic(fromX, fromY, toX, toY),\n    parent: null,\n  };\n  openSet.push(startNode);\n\n  const key = (x: number, y: number): number => y * state.width + x;\n\n  // Directional offsets (4-way movement)\n  const dirs = [\n    { dx: 0, dy: -1 },\n    { dx: 0, dy: 1 },\n    { dx: -1, dy: 0 },\n    { dx: 1, dy: 0 },\n  ];\n\n  // Limit iterations to prevent lockups on large grids\n  const maxIterations = state.width * state.height;\n  let iterations = 0;\n\n  while (openSet.length > 0 && iterations < maxIterations) {\n    iterations++;\n\n    // Find the node with the lowest f score\n    let lowestIdx = 0;\n    for (let i = 1; i < openSet.length; i++) {\n      if (openSet[i].f < openSet[lowestIdx].f) {\n        lowestIdx = i;\n      }\n    }\n\n    const current = openSet[lowestIdx];\n\n    // Reached the goal\n    if (current.x === toX && current.y === toY) {\n      const path: { x: number; y: number }[] = [];\n      let node: AStarNode | null = current;\n      while (node !== null) {\n        path.push({ x: node.x, y: node.y });\n        node = node.parent;\n      }\n      path.reverse();\n      return path;\n    }\n\n    // Move current from open to closed\n    openSet.splice(lowestIdx, 1);\n    closedSet.add(key(current.x, current.y));\n\n    // Expand neighbors\n    for (const dir of dirs) {\n      const nx = current.x + dir.dx;\n      const ny = current.y + dir.dy;\n\n      // Bounds check\n      if (nx < 0 || nx >= state.width || ny < 0 || ny >= state.height) continue;\n\n      // Wall check\n      if (state.grid[ny][nx] === Tile.Wall) continue;\n\n      // Already visited\n      if (closedSet.has(key(nx, ny))) continue;\n\n      const tentativeG = current.g + 1;\n\n      // Check if this neighbor is already in the open set\n      const existingIdx = openSet.findIndex(n => n.x === nx && n.y === ny);\n      if (existingIdx >= 0) {\n        if (tentativeG < openSet[existingIdx].g) {\n          openSet[existingIdx].g = tentativeG;\n          openSet[existingIdx].f = tentativeG + openSet[existingIdx].h;\n          openSet[existingIdx].parent = current;\n        }\n      } else {\n        const h = heuristic(nx, ny, toX, toY);\n        openSet.push({\n          x: nx, y: ny,\n          g: tentativeG,\n          h,\n          f: tentativeG + h,\n          parent: current,\n        });\n      }\n    }\n  }\n\n  // No path found\n  return [];\n}\n\n// ---------------------------------------------------------------------------\n// Utility helpers\n// ---------------------------------------------------------------------------\n\n/**\n * Get the center tile coordinates of a room.\n */\nexport function getRoomCenter(room: DungeonRoom): { x: number; y: number } {\n  return {\n    x: Math.floor(room.x + room.width / 2),\n    y: Math.floor(room.y + room.height / 2),\n  };\n}\n\n/**\n * Find which room a tile coordinate belongs to, or -1 if none.\n */\nexport function getRoomAtTile(state: DungeonFloorState, tileX: number, tileY: number): number {\n  for (let i = 0; i < state.rooms.length; i++) {\n    const r = state.rooms[i];\n    if (tileX >= r.x && tileX < r.x + r.width && tileY >= r.y && tileY < r.y + r.height) {\n      return i;\n    }\n  }\n  return -1;\n}\n\n/**\n * Trigger a trap at the given position. Returns the damage dealt, or 0 if no untriggered trap.\n */\nexport function triggerTrap(\n  state: DungeonFloorState,\n  roomIndex: number,\n  tileX: number,\n  tileY: number,\n): { damage: number; type: TrapType } | null {\n  if (roomIndex < 0 || roomIndex >= state.rooms.length) return null;\n\n  const room = state.rooms[roomIndex];\n  for (const trap of room.traps) {\n    if (!trap.triggered && trap.x === tileX && trap.y === tileY) {\n      trap.triggered = true;\n      return { damage: TRAP_DAMAGE[trap.type], type: trap.type };\n    }\n  }\n  return null;\n}\n\n/**\n * Collect loot at the given position. Returns the item ID, or null if none.\n */\nexport function collectLoot(\n  state: DungeonFloorState,\n  roomIndex: number,\n  tileX: number,\n  tileY: number,\n): string | null {\n  if (roomIndex < 0 || roomIndex >= state.rooms.length) return null;\n\n  const room = state.rooms[roomIndex];\n  for (const loot of room.loot) {\n    if (!loot.collected && loot.x === tileX && loot.y === tileY) {\n      loot.collected = true;\n      return loot.itemId;\n    }\n  }\n  return null;\n}\n\n/**\n * Check whether all non-boss, non-entrance rooms on this floor have been cleared.\n */\nexport function isFloorCleared(state: DungeonFloorState): boolean {\n  return state.rooms.every(\n    r => r.cleared || r.type === 'entrance' || r.type === 'corridor' || r.type === 'shop',\n  );\n}\n\n/**\n * Get the boss room index, or -1 if this floor has no boss.\n */\nexport function getBossRoomIndex(state: DungeonFloorState): number {\n  return state.rooms.findIndex(r => r.type === 'boss');\n}\n\n// ---------------------------------------------------------------------------\n// Class wrapper (for scenes that prefer an instance-based API)\n// ---------------------------------------------------------------------------\n\n/**\n * Convenience class that wraps the module-level functions.\n * Scenes can instantiate `new DungeonManager()` and call methods on it.\n */\nexport class DungeonManager {\n  generateFloor(dungeonId: string, floorLevel: number, seed: number): DungeonFloorState {\n    return generateFloor(dungeonId, floorLevel, seed);\n  }\n\n  revealRoom(state: DungeonFloorState, roomIndex: number): void {\n    revealRoom(state, roomIndex);\n  }\n\n  clearRoom(state: DungeonFloorState, roomIndex: number): void {\n    clearRoom(state, roomIndex);\n  }\n\n  getTile(state: DungeonFloorState, x: number, y: number): number {\n    return getTile(state, x, y);\n  }\n\n  isExplored(state: DungeonFloorState, x: number, y: number): boolean {\n    return isExplored(state, x, y);\n  }\n\n  findPath(\n    state: DungeonFloorState,\n    fromX: number, fromY: number,\n    toX: number, toY: number,\n  ): { x: number; y: number }[] {\n    return findPath(state, fromX, fromY, toX, toY);\n  }\n}\n","import Phaser from 'phaser';\nimport { DungeonManager, DungeonFloorState, DungeonRoom } from '../systems/DungeonManager';\nimport { RiftManager } from '../systems/RiftManager';\nimport { ecsWorld, createPlayer, createEnemy } from '../ecs/world';\nimport { Position, Velocity, Health, Stamina } from '../ecs/components';\nimport { movementSystem } from '../ecs/systems/MovementSystem';\nimport { combatSystem, flushDamageEvents } from '../ecs/systems/CombatSystem';\nimport { aiSystem } from '../ecs/systems/AISystem';\nimport { lootSystem, flushLootEvents, LootEvent } from '../ecs/systems/LootSystem';\nimport { animationSystem } from '../ecs/systems/AnimationSystem';\nimport { projectileSystem } from '../ecs/systems/ProjectileSystem';\nimport { AudioManager, SFX } from '../systems/AudioManager';\nimport { TILE_SIZE, PLAYER_SPEED } from '../config';\nimport { DUNGEON_DB } from '../data/dungeons';\nimport type { RoomType, TrapType } from '../data/dungeons';\nimport { LightingManager } from '../systems/LightingManager';\nimport { ParticleManager } from '../systems/ParticleManager';\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\ninterface DungeonSceneData {\n  dungeonId: string;\n  floorLevel: number;\n  /** Overworld position to return to on exit */\n  returnX?: number;\n  returnY?: number;\n}\n\n/** A loot drop sprite sitting on the ground waiting to be picked up */\ninterface LootDropSprite {\n  container: Phaser.GameObjects.Container;\n  itemId: string;\n  quantity: number;\n  x: number;\n  y: number;\n}\n\n/** A treasure chest indicator in a treasure room */\ninterface TreasureChest {\n  sprite: Phaser.GameObjects.Image;\n  roomIndex: number;\n  x: number;\n  y: number;\n  opened: boolean;\n  cursed: boolean; // Dead Cells-inspired: guaranteed legendary but applies corruption curse\n}\n\n// Tile type constants returned by DungeonManager.getTile()\nconst TILE_WALL = 0;\nconst TILE_FLOOR = 1;\nconst TILE_CORRIDOR = 2;\n\n// Tile colours (rendered as filled rectangles)\nconst COLOR_WALL = 0x333344;\nconst COLOR_FLOOR = 0x555566;\nconst COLOR_CORRIDOR = 0x444455;\nconst COLOR_FOG = 0x000000;\n\n// Loot pickup distance in pixels\nconst LOOT_PICKUP_DISTANCE = 24;\n\n// Chest interaction distance in pixels\nconst CHEST_INTERACT_DISTANCE = 32;\n\n// ---------------------------------------------------------------------------\n// Scene\n// ---------------------------------------------------------------------------\n\nexport class DungeonScene extends Phaser.Scene {\n  // ---- Dungeon state ----\n  private dungeonManager!: DungeonManager;\n  private floorState!: DungeonFloorState;\n  private dungeonId = '';\n  private floorLevel = 1;\n  private returnX?: number;\n  private returnY?: number;\n  private riftHpMult = 1;\n  private riftDmgMult = 1;\n\n  // ---- Player ----\n  private playerEid = -1;\n  private playerSprite!: Phaser.GameObjects.Image;\n  private currentPlayerRoom = -1;\n\n  // ---- Input ----\n  private wasd!: Record<string, Phaser.Input.Keyboard.Key>;\n  private keyQ!: Phaser.Input.Keyboard.Key;\n  private keyE!: Phaser.Input.Keyboard.Key;\n\n  // ---- Rendering layers ----\n  private tileGraphics!: Phaser.GameObjects.Graphics;\n  private fogRects: Phaser.GameObjects.Rectangle[] = [];\n  private fogMap: (Phaser.GameObjects.Rectangle | null)[][] = [];\n\n  // ---- Enemy tracking ----\n  private spawnedRooms = new Set<number>();\n  private roomEnemyEids = new Map<number, number[]>();\n  /** Map from ECS entity id to its Phaser sprite for efficient sync */\n  private enemySpriteMap = new Map<number, Phaser.GameObjects.Image>();\n\n  // ---- Loot drops on the ground ----\n  private lootDropSprites: LootDropSprite[] = [];\n\n  // ---- Treasure chests ----\n  private treasureChests: TreasureChest[] = [];\n\n  // ---- HUD ----\n  private hudText!: Phaser.GameObjects.Text;\n  private roomTypeText!: Phaser.GameObjects.Text;\n\n  // ---- Minimap ----\n  private minimapCam!: Phaser.Cameras.Scene2D.Camera;\n\n  // ---- Damage floaters ----\n  private damageTexts: Phaser.GameObjects.Text[] = [];\n\n  // ---- Visual systems ----\n  private lightingManager!: LightingManager;\n  private particleManager!: ParticleManager;\n  private audioManager!: AudioManager;\n\n  constructor() {\n    super({ key: 'DungeonScene' });\n  }\n\n  // =======================================================================\n  // INIT\n  // =======================================================================\n\n  init(data: DungeonSceneData): void {\n    this.dungeonId = data.dungeonId ?? 'mines';\n    this.floorLevel = data.floorLevel ?? 1;\n    this.returnX = data.returnX;\n    this.returnY = data.returnY;\n    this.riftHpMult = 1;\n    this.riftDmgMult = 1;\n  }\n\n  // =======================================================================\n  // CREATE\n  // =======================================================================\n\n  create(data: DungeonSceneData): void {\n    // Apply init data again in case Phaser passes it here instead\n    if (data?.dungeonId) this.dungeonId = data.dungeonId;\n    if (data?.floorLevel) this.floorLevel = data.floorLevel;\n\n    this.cameras.main.setBackgroundColor('#111122');\n    this.cameras.main.fadeIn(500, 0, 0, 0);\n\n    // Reset per-scene tracking\n    this.spawnedRooms.clear();\n    this.roomEnemyEids.clear();\n    this.enemySpriteMap.clear();\n    this.lootDropSprites = [];\n    this.treasureChests = [];\n    this.fogRects = [];\n    this.damageTexts = [];\n    this.currentPlayerRoom = -1;\n\n    // --- Generate dungeon floor ---\n    this.dungeonManager = new DungeonManager();\n    const seed = Phaser.Math.Between(1, 999_999);\n    // Rift mode: use 'mines' layout with rift scaling applied\n    const layoutId = this.dungeonId === 'rift' ? 'mines' : this.dungeonId;\n    this.floorState = this.dungeonManager.generateFloor(layoutId, this.floorLevel, seed);\n\n    // Apply rift scaling multipliers\n    if (this.dungeonId === 'rift') {\n      const riftMgr = this.registry.get('riftManager') as RiftManager | undefined;\n      if (riftMgr) {\n        const riftFloor = riftMgr.getCurrentFloor();\n        if (riftFloor) {\n          this.riftHpMult = riftFloor.enemyHpMult;\n          this.riftDmgMult = riftFloor.enemyDmgMult;\n        }\n      }\n    }\n\n    // --- Render tile grid ---\n    this.tileGraphics = this.add.graphics().setDepth(0);\n    this.renderTiles();\n\n    // --- Create fog of war overlay ---\n    this.createFogOfWar();\n\n    // --- Spawn player at entrance room ---\n    const entranceRoom = this.findRoomByType('entrance') ?? this.floorState.rooms[0];\n    const spawnX = (entranceRoom.x + Math.floor(entranceRoom.width / 2)) * TILE_SIZE + TILE_SIZE / 2;\n    const spawnY = (entranceRoom.y + Math.floor(entranceRoom.height / 2)) * TILE_SIZE + TILE_SIZE / 2;\n\n    this.playerEid = createPlayer(spawnX, spawnY);\n    this.playerSprite = this.add.image(spawnX, spawnY, 'player').setDepth(5000);\n\n    // Reveal the entrance room\n    const entranceIndex = this.floorState.rooms.indexOf(entranceRoom);\n    this.revealRoom(entranceIndex);\n    this.currentPlayerRoom = entranceIndex;\n\n    // --- Camera follow ---\n    this.cameras.main.startFollow(this.playerSprite, true, 0.12, 0.12);\n    this.cameras.main.setZoom(1);\n\n    // --- Input ---\n    this.wasd = {\n      W: this.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.W),\n      A: this.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.A),\n      S: this.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.S),\n      D: this.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.D),\n    };\n    this.keyQ = this.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.Q);\n    this.keyE = this.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.E);\n\n    // --- Minimap camera (top-right corner) ---\n    const minimapSize = 160;\n    const mapPixelW = this.floorState.width * TILE_SIZE;\n    const mapPixelH = this.floorState.height * TILE_SIZE;\n    this.minimapCam = this.cameras.add(\n      this.scale.width - minimapSize - 10,\n      10,\n      minimapSize,\n      minimapSize,\n    );\n    this.minimapCam.setBackgroundColor(0x000000);\n    this.minimapCam.setZoom(minimapSize / Math.max(mapPixelW, mapPixelH));\n    this.minimapCam.scrollX = mapPixelW / 2 - minimapSize / (2 * this.minimapCam.zoom);\n    this.minimapCam.scrollY = mapPixelH / 2 - minimapSize / (2 * this.minimapCam.zoom);\n    this.minimapCam.setAlpha(0.75);\n\n    // --- Visual systems ---\n    this.lightingManager = new LightingManager(this);\n    this.lightingManager.init(true); // isDungeon = true → darkness with reveal\n    this.particleManager = new ParticleManager(this);\n    this.audioManager = new AudioManager(this);\n\n    // --- HUD ---\n    const dungeonDef = DUNGEON_DB.get(this.dungeonId);\n    const dungeonName = dungeonDef?.name ?? this.dungeonId;\n\n    const textStyle: Phaser.Types.GameObjects.Text.TextStyle = {\n      fontFamily: 'monospace',\n      fontSize: '14px',\n      color: '#dddddd',\n      backgroundColor: '#000000aa',\n      padding: { x: 6, y: 3 },\n    };\n\n    this.hudText = this.add\n      .text(10, 10, `${dungeonName}  -  Floor ${this.floorLevel}`, textStyle)\n      .setScrollFactor(0)\n      .setDepth(9999);\n\n    this.roomTypeText = this.add\n      .text(10, 32, '', { ...textStyle, color: '#aaddff' })\n      .setScrollFactor(0)\n      .setDepth(9999);\n  }\n\n  // =======================================================================\n  // UPDATE\n  // =======================================================================\n\n  update(_time: number, delta: number): void {\n    const dt = delta / 1000; // seconds\n\n    // ---- Player movement (top-down) ----\n    this.processPlayerInput(dt);\n\n    // ---- ECS systems ----\n    movementSystem(ecsWorld, dt);\n    aiSystem(ecsWorld, dt, 1 / this.lightingManager.getLightTier().revealMult); // Lower light → enemies detect further\n    combatSystem(ecsWorld, dt);\n    projectileSystem(ecsWorld, dt);\n    // Pass light tier loot rarity bonus to loot system (Darkest Dungeon risk-reward)\n    lootSystem(ecsWorld, this.lightingManager.getLightTier().lootRarityBonus);\n    animationSystem(ecsWorld, dt);\n\n    // ---- Sync sprite to ECS position ----\n    this.playerSprite.setPosition(Position.x[this.playerEid], Position.y[this.playerEid]);\n\n    // ---- Sync enemy sprites to ECS positions ----\n    this.syncEnemySprites();\n\n    // ---- Wall collision (clamp player into walkable tiles) ----\n    this.clampToFloor();\n\n    // ---- Room detection ----\n    const roomIndex = this.getRoomAt(Position.x[this.playerEid], Position.y[this.playerEid]);\n    if (roomIndex !== -1 && roomIndex !== this.currentPlayerRoom) {\n      this.onEnterRoom(roomIndex);\n      this.currentPlayerRoom = roomIndex;\n    }\n\n    // ---- Room clear check ----\n    this.checkRoomCleared();\n\n    // ---- Boss room transition ----\n    if (roomIndex !== -1) {\n      const room = this.floorState.rooms[roomIndex];\n      if (room.type === 'boss' && room.cleared) {\n        this.transitionToBoss(roomIndex);\n      }\n    }\n\n    // ---- Loot events from ECS ----\n    this.processLootEvents();\n\n    // ---- Loot pickup proximity check ----\n    this.checkLootPickup();\n\n    // ---- Chest interaction (E key) ----\n    if (Phaser.Input.Keyboard.JustDown(this.keyE)) {\n      this.handleInteraction();\n    }\n\n    // ---- Damage floaters ----\n    this.processDamageEvents();\n    this.updateDamageTexts(dt);\n\n    // ---- Torch fuel tick (Darkest Dungeon-inspired) ----\n    this.lightingManager.updateFuel(dt);\n\n    // ---- Corruption curse tick ----\n    const corruptionMgr = this.registry.get('corruptionManager') as\n      { tickCurse(d: number): void; isCursed(): boolean; getCurseRemaining(): number } | undefined;\n    if (corruptionMgr) {\n      corruptionMgr.tickCurse(dt);\n      this.registry.set('cursed', corruptionMgr.isCursed());\n      this.registry.set('curseRemaining', corruptionMgr.getCurseRemaining());\n      // Cursed: drain stamina and tick damage\n      if (corruptionMgr.isCursed()) {\n        Stamina.current[this.playerEid] = Math.max(0, Stamina.current[this.playerEid] - 3 * dt);\n        Health.current[this.playerEid] -= 2 * dt; // 2 HP/s curse damage\n      }\n    }\n\n    // ---- Lighting (dungeon darkness with reveal around player) ----\n    const px = Position.x[this.playerEid];\n    const py = Position.y[this.playerEid];\n    this.lightingManager.update(0, 'haven', px, py); // hour=0 (always dark in dungeons)\n\n    // Expose light tier to registry for HUD display and damage scaling\n    const lightTier = this.lightingManager.getLightTier();\n    this.registry.set('lightTierName', lightTier.name);\n    this.registry.set('lightFuel', this.lightingManager.getFuel());\n    this.registry.set('dungeonEnemyDmgMult', lightTier.enemyDmgMult);\n\n    // ---- Particles ----\n    const cam = this.cameras.main;\n    this.particleManager.update(dt, cam.scrollX, cam.scrollY, cam.width / cam.zoom, cam.height / cam.zoom);\n\n    // ---- Update fog ----\n    this.updateFog();\n\n    // ---- HUD room type ----\n    if (roomIndex !== -1) {\n      const room = this.floorState.rooms[roomIndex];\n      this.roomTypeText.setText(`Room: ${this.formatRoomType(room.type)}${room.cleared ? '  [Cleared]' : ''}`);\n    } else {\n      this.roomTypeText.setText('Corridor');\n    }\n\n    // ---- Q to exit ----\n    if (Phaser.Input.Keyboard.JustDown(this.keyQ)) {\n      this.exitDungeon();\n    }\n  }\n\n  // =======================================================================\n  // INPUT\n  // =======================================================================\n\n  private processPlayerInput(dt: number): void {\n    let dx = 0;\n    let dy = 0;\n\n    if (this.wasd.A.isDown) dx -= 1;\n    if (this.wasd.D.isDown) dx += 1;\n    if (this.wasd.W.isDown) dy -= 1;\n    if (this.wasd.S.isDown) dy += 1;\n\n    // Normalize diagonal movement\n    if (dx !== 0 && dy !== 0) {\n      const norm = 1 / Math.SQRT2;\n      dx *= norm;\n      dy *= norm;\n    }\n\n    Velocity.vx[this.playerEid] = dx * PLAYER_SPEED;\n    Velocity.vy[this.playerEid] = dy * PLAYER_SPEED;\n\n    // Flip sprite based on movement\n    if (dx < 0) this.playerSprite.setFlipX(true);\n    else if (dx > 0) this.playerSprite.setFlipX(false);\n  }\n\n  // =======================================================================\n  // COLLISION\n  // =======================================================================\n\n  /** Keep the player out of wall tiles */\n  private clampToFloor(): void {\n    const px = Position.x[this.playerEid];\n    const py = Position.y[this.playerEid];\n    const margin = 6; // player half-width approximation\n\n    // Check all 4 corners of the player bounding box against the tile grid\n    const checkPoints = [\n      { x: px - margin, y: py - margin },\n      { x: px + margin, y: py - margin },\n      { x: px - margin, y: py + margin },\n      { x: px + margin, y: py + margin },\n    ];\n\n    for (const pt of checkPoints) {\n      const tileX = Math.floor(pt.x / TILE_SIZE);\n      const tileY = Math.floor(pt.y / TILE_SIZE);\n      const tile = this.dungeonManager.getTile(this.floorState, tileX, tileY);\n\n      if (tile === TILE_WALL) {\n        // Push player back out of the wall\n        const tileCenterX = tileX * TILE_SIZE + TILE_SIZE / 2;\n        const tileCenterY = tileY * TILE_SIZE + TILE_SIZE / 2;\n        const overlapX = (TILE_SIZE / 2 + margin) - Math.abs(px - tileCenterX);\n        const overlapY = (TILE_SIZE / 2 + margin) - Math.abs(py - tileCenterY);\n\n        if (overlapX > 0 && overlapY > 0) {\n          if (overlapX < overlapY) {\n            Position.x[this.playerEid] += px < tileCenterX ? -overlapX : overlapX;\n          } else {\n            Position.y[this.playerEid] += py < tileCenterY ? -overlapY : overlapY;\n          }\n        }\n      }\n    }\n\n    // Update sprite immediately after clamping\n    this.playerSprite.setPosition(Position.x[this.playerEid], Position.y[this.playerEid]);\n  }\n\n  // =======================================================================\n  // TILE RENDERING\n  // =======================================================================\n\n  private renderTiles(): void {\n    const { width, height } = this.floorState;\n\n    for (let ty = 0; ty < height; ty++) {\n      for (let tx = 0; tx < width; tx++) {\n        const tile = this.dungeonManager.getTile(this.floorState, tx, ty);\n        let color: number;\n        switch (tile) {\n          case TILE_FLOOR:    color = COLOR_FLOOR; break;\n          case TILE_CORRIDOR: color = COLOR_CORRIDOR; break;\n          default:            color = COLOR_WALL; break;\n        }\n        this.tileGraphics.fillStyle(color, 1);\n        this.tileGraphics.fillRect(tx * TILE_SIZE, ty * TILE_SIZE, TILE_SIZE, TILE_SIZE);\n      }\n    }\n  }\n\n  // =======================================================================\n  // FOG OF WAR\n  // =======================================================================\n\n  private createFogOfWar(): void {\n    const { width, height } = this.floorState;\n    this.fogMap = [];\n\n    for (let ty = 0; ty < height; ty++) {\n      const row: (Phaser.GameObjects.Rectangle | null)[] = [];\n      for (let tx = 0; tx < width; tx++) {\n        if (!this.dungeonManager.isExplored(this.floorState, tx, ty)) {\n          const rect = this.add.rectangle(\n            tx * TILE_SIZE + TILE_SIZE / 2,\n            ty * TILE_SIZE + TILE_SIZE / 2,\n            TILE_SIZE,\n            TILE_SIZE,\n            COLOR_FOG,\n            1,\n          ).setDepth(8000);\n          row.push(rect);\n          this.fogRects.push(rect);\n        } else {\n          row.push(null);\n        }\n      }\n      this.fogMap.push(row);\n    }\n  }\n\n  /** Remove fog rectangles for tiles that have been revealed */\n  private updateFog(): void {\n    const { width, height } = this.floorState;\n    for (let ty = 0; ty < height; ty++) {\n      for (let tx = 0; tx < width; tx++) {\n        const rect = this.fogMap[ty]?.[tx];\n        if (rect && this.dungeonManager.isExplored(this.floorState, tx, ty)) {\n          rect.destroy();\n          this.fogMap[ty][tx] = null;\n        }\n      }\n    }\n  }\n\n  // =======================================================================\n  // ROOM LOGIC\n  // =======================================================================\n\n  private findRoomByType(type: RoomType): DungeonRoom | undefined {\n    return this.floorState.rooms.find(r => r.type === type);\n  }\n\n  /** Return the room index the world-pixel coordinate is inside, or -1 */\n  private getRoomAt(px: number, py: number): number {\n    const tx = Math.floor(px / TILE_SIZE);\n    const ty = Math.floor(py / TILE_SIZE);\n\n    for (let i = 0; i < this.floorState.rooms.length; i++) {\n      const r = this.floorState.rooms[i];\n      if (tx >= r.x && tx < r.x + r.width && ty >= r.y && ty < r.y + r.height) {\n        return i;\n      }\n    }\n    return -1;\n  }\n\n  private onEnterRoom(roomIndex: number): void {\n    const room = this.floorState.rooms[roomIndex];\n\n    // Reveal tiles in this room\n    this.revealRoom(roomIndex);\n\n    // Update the DungeonManager state\n    this.floorState.playerRoom = roomIndex;\n\n    // Spawn enemies if this is a monster room and we haven't spawned here yet\n    if (!this.spawnedRooms.has(roomIndex) && room.type === 'monster') {\n      this.spawnRoomEnemies(roomIndex);\n    }\n\n    // Boss room: spawn enemies (the boss fight is handled by transitioning once \"cleared\")\n    if (!this.spawnedRooms.has(roomIndex) && room.type === 'boss') {\n      // Mark spawned but do not actually spawn enemies -- the boss fight\n      // happens in BossArenaScene. Mark the room as cleared so the transition\n      // fires on the next frame.\n      this.spawnedRooms.add(roomIndex);\n      this.dungeonManager.clearRoom(this.floorState, roomIndex);\n    }\n\n    // Treasure room: spawn a chest indicator if not already opened\n    if (!this.spawnedRooms.has(roomIndex) && room.type === 'treasure') {\n      this.spawnTreasureChest(roomIndex);\n      this.spawnedRooms.add(roomIndex);\n    }\n  }\n\n  private revealRoom(roomIndex: number): void {\n    this.dungeonManager.revealRoom(this.floorState, roomIndex);\n  }\n\n  private spawnRoomEnemies(roomIndex: number): void {\n    this.spawnedRooms.add(roomIndex);\n    const room = this.floorState.rooms[roomIndex];\n    const eids: number[] = [];\n\n    for (const enemyDef of room.enemies) {\n      const worldX = enemyDef.x * TILE_SIZE + TILE_SIZE / 2;\n      const worldY = enemyDef.y * TILE_SIZE + TILE_SIZE / 2;\n\n      // Use reasonable stats; the DungeonManager defines typeId but we\n      // create a generic enemy with dungeon-floor-scaled stats.\n      const hpScale = 1 + this.floorLevel * 0.1;\n      const dmgScale = 1 + this.floorLevel * 0.08;\n      const hp = Math.round(40 * hpScale * this.riftHpMult);\n      const dmg = Math.round(8 * dmgScale * this.riftDmgMult);\n      const def = Math.round(3 + this.floorLevel * 0.5);\n\n      const eid = createEnemy(worldX, worldY, hp, dmg, def, 120, 'enemy');\n\n      // Create a sprite for this enemy so the player can see it\n      const sprite = this.add.image(worldX, worldY, 'enemy').setDepth(4000);\n\n      // Store in the efficient eid -> sprite map\n      this.enemySpriteMap.set(eid, sprite);\n\n      eids.push(eid);\n    }\n\n    this.roomEnemyEids.set(roomIndex, eids);\n  }\n\n  // =======================================================================\n  // ENEMY SPRITE SYNC\n  // =======================================================================\n\n  /**\n   * Iterates all tracked enemy sprites and syncs their positions from the\n   * ECS Position component. Hides/destroys sprites for dead enemies.\n   */\n  private syncEnemySprites(): void {\n    for (const [eid, sprite] of this.enemySpriteMap) {\n      // Check if the enemy is dead\n      if (Health.current[eid] <= 0) {\n        sprite.destroy();\n        this.enemySpriteMap.delete(eid);\n        continue;\n      }\n\n      // Sync position from ECS\n      sprite.setPosition(Position.x[eid], Position.y[eid]);\n    }\n  }\n\n  // =======================================================================\n  // LOOT SYSTEM\n  // =======================================================================\n\n  /**\n   * Consumes loot events emitted by the ECS lootSystem and creates\n   * visible item drop sprites on the ground.\n   */\n  private processLootEvents(): void {\n    const events = flushLootEvents();\n\n    for (const ev of events) {\n      // Small random offset so drops don't stack perfectly\n      const offsetX = Phaser.Math.Between(-8, 8);\n      const offsetY = Phaser.Math.Between(-8, 8);\n      const dropX = ev.x + offsetX;\n      const dropY = ev.y + offsetY;\n\n      // Create a container with the item sprite and a text label\n      const dropImage = this.add.image(0, 0, 'item_drop').setDepth(3500);\n      const label = this.add.text(0, -12, ev.itemId, {\n        fontFamily: 'monospace',\n        fontSize: '8px',\n        color: '#ffffff',\n        backgroundColor: '#000000aa',\n        padding: { x: 2, y: 1 },\n      }).setOrigin(0.5).setDepth(3501);\n\n      const container = this.add.container(dropX, dropY, [dropImage, label]).setDepth(3500);\n\n      this.lootDropSprites.push({\n        container,\n        itemId: ev.itemId,\n        quantity: ev.quantity,\n        x: dropX,\n        y: dropY,\n      });\n    }\n  }\n\n  /**\n   * Checks proximity between the player and loot drops on the ground.\n   * When within LOOT_PICKUP_DISTANCE, auto-picks up the loot.\n   */\n  private checkLootPickup(): void {\n    const px = Position.x[this.playerEid];\n    const py = Position.y[this.playerEid];\n\n    for (let i = this.lootDropSprites.length - 1; i >= 0; i--) {\n      const drop = this.lootDropSprites[i];\n      const dist = Phaser.Math.Distance.Between(px, py, drop.x, drop.y);\n\n      if (dist < LOOT_PICKUP_DISTANCE) {\n        // Add to inventory via the registry's inventoryManager\n        const inventoryManager = this.registry.get('inventoryManager');\n        if (inventoryManager) {\n          inventoryManager.addItem(drop.itemId, drop.quantity);\n        }\n\n        this.audioManager.playSFX(SFX.ITEM_PICKUP);\n\n        // Show pickup notification floating text\n        const notif = this.add.text(px, py - 20, `+${drop.quantity} ${drop.itemId}`, {\n          fontFamily: 'monospace',\n          fontSize: '11px',\n          color: '#44ff88',\n          fontStyle: 'bold',\n        }).setOrigin(0.5).setDepth(9500);\n\n        this.tweens.add({\n          targets: notif,\n          alpha: 0,\n          y: py - 50,\n          duration: 1200,\n          onComplete: () => notif.destroy(),\n        });\n\n        // Remove drop sprite and entry\n        drop.container.destroy();\n        this.lootDropSprites.splice(i, 1);\n      }\n    }\n  }\n\n  // =======================================================================\n  // TREASURE ROOM\n  // =======================================================================\n\n  /**\n   * Spawns a gold-tinted chest indicator in a treasure room.\n   */\n  private spawnTreasureChest(roomIndex: number): void {\n    const room = this.floorState.rooms[roomIndex];\n    const cx = (room.x + Math.floor(room.width / 2)) * TILE_SIZE + TILE_SIZE / 2;\n    const cy = (room.y + Math.floor(room.height / 2)) * TILE_SIZE + TILE_SIZE / 2;\n\n    // 15% chance to be a cursed chest (Dead Cells-inspired gambit)\n    const isCursed = Math.random() < 0.15;\n\n    // Use item_drop texture tinted gold (or purple for cursed)\n    const chestSprite = this.add.image(cx, cy, 'item_drop')\n      .setTint(isCursed ? 0x9900cc : 0xffcc00)\n      .setScale(isCursed ? 1.8 : 1.5)\n      .setDepth(3800);\n\n    // Add a pulsing glow effect to make the chest noticeable\n    this.tweens.add({\n      targets: chestSprite,\n      scaleX: isCursed ? 2.0 : 1.7,\n      scaleY: isCursed ? 2.0 : 1.7,\n      duration: isCursed ? 600 : 800,\n      yoyo: true,\n      repeat: -1,\n      ease: 'Sine.easeInOut',\n    });\n\n    this.treasureChests.push({\n      sprite: chestSprite,\n      roomIndex,\n      x: cx,\n      y: cy,\n      opened: false,\n      cursed: isCursed,\n    });\n  }\n\n  /**\n   * Handles E key interactions: treasure chests and shop NPCs.\n   */\n  private handleInteraction(): void {\n    const px = Position.x[this.playerEid];\n    const py = Position.y[this.playerEid];\n\n    // Check treasure chests\n    for (const chest of this.treasureChests) {\n      if (chest.opened) continue;\n\n      const dist = Phaser.Math.Distance.Between(px, py, chest.x, chest.y);\n      if (dist < CHEST_INTERACT_DISTANCE) {\n        this.openTreasureChest(chest);\n        return; // Only interact with one thing per press\n      }\n    }\n  }\n\n  /**\n   * Opens a treasure chest: rolls 2-4 items from the dungeon's rewardPool,\n   * adds them to inventory, and marks the room as cleared.\n   */\n  private openTreasureChest(chest: TreasureChest): void {\n    chest.opened = true;\n    this.audioManager.playSFX(SFX.CHEST_OPEN);\n\n    // Visual feedback: stop glow, tint grey\n    this.tweens.killTweensOf(chest.sprite);\n    chest.sprite.setTint(0x666666).setScale(1.5);\n\n    const dungeonDef = DUNGEON_DB.get(this.dungeonId);\n    if (!dungeonDef) return;\n\n    const rewardPool = dungeonDef.rewardPool;\n    if (!rewardPool || rewardPool.length === 0) return;\n\n    const inventoryManager = this.registry.get('inventoryManager');\n\n    // Cursed chests: more items, guaranteed high-tier, but apply corruption curse\n    const numItems = chest.cursed ? Phaser.Math.Between(3, 5) : Phaser.Math.Between(2, 4);\n    const totalChance = rewardPool.reduce((sum, r) => sum + r.chance, 0);\n    const rolledItems: { itemId: string; quantity: number }[] = [];\n\n    for (let i = 0; i < numItems; i++) {\n      let roll = Math.random() * totalChance;\n      for (const reward of rewardPool) {\n        roll -= reward.chance;\n        if (roll <= 0) {\n          const qty = chest.cursed ? Phaser.Math.Between(2, 5) : Phaser.Math.Between(1, 3);\n          rolledItems.push({ itemId: reward.itemId, quantity: qty });\n          if (inventoryManager) {\n            inventoryManager.addItem(reward.itemId, qty);\n          }\n          break;\n        }\n      }\n    }\n\n    // Cursed chest: apply corruption curse (60s of max corruption effects)\n    if (chest.cursed) {\n      const corruptionMgr = this.registry.get('corruptionManager') as\n        { applyCurse(d: number): void } | undefined;\n      if (corruptionMgr) {\n        corruptionMgr.applyCurse(60);\n      }\n\n      // Purple screen flash for cursed chest\n      const flash = this.add.rectangle(\n        this.cameras.main.width / 2, this.cameras.main.height / 2,\n        this.cameras.main.width, this.cameras.main.height,\n        0x9900cc, 0.4,\n      ).setScrollFactor(0).setDepth(9999);\n      this.tweens.add({\n        targets: flash,\n        alpha: 0,\n        duration: 800,\n        onComplete: () => flash.destroy(),\n      });\n      this.cameras.main.shake(300, 0.01);\n    }\n\n    // Show loot notification\n    const lootColor = chest.cursed ? '#cc44ff' : '#ffcc00';\n    const prefix = chest.cursed ? 'CURSED! ' : '';\n    const lootLines = rolledItems.map(r => `+${r.quantity} ${r.itemId}`).join('\\n');\n\n    const lootText = this.add.text(chest.x, chest.y - 20, `${prefix}${lootLines}`, {\n      fontFamily: 'monospace',\n      fontSize: chest.cursed ? '11px' : '10px',\n      color: lootColor,\n      backgroundColor: '#000000cc',\n      padding: { x: 4, y: 3 },\n      align: 'center',\n    }).setOrigin(0.5).setDepth(9500);\n\n    this.tweens.add({\n      targets: lootText,\n      alpha: 0,\n      y: chest.y - 60,\n      duration: chest.cursed ? 3500 : 2500,\n      onComplete: () => lootText.destroy(),\n    });\n\n    // Mark the room as cleared\n    this.dungeonManager.clearRoom(this.floorState, chest.roomIndex);\n  }\n\n  // =======================================================================\n  // ROOM CLEARING\n  // =======================================================================\n\n  private checkRoomCleared(): void {\n    for (const [roomIndex, eids] of this.roomEnemyEids) {\n      const room = this.floorState.rooms[roomIndex];\n      if (room.cleared) continue;\n\n      const allDead = eids.every(eid => Health.current[eid] <= 0);\n      if (allDead) {\n        this.dungeonManager.clearRoom(this.floorState, roomIndex);\n\n        // Show cleared text\n        const cx = (room.x + room.width / 2) * TILE_SIZE;\n        const cy = (room.y + room.height / 2) * TILE_SIZE - 20;\n        const cleared = this.add.text(cx, cy, 'ROOM CLEARED', {\n          fontFamily: 'monospace',\n          fontSize: '16px',\n          color: '#44ff44',\n          backgroundColor: '#000000aa',\n          padding: { x: 6, y: 3 },\n        }).setOrigin(0.5).setDepth(9000);\n\n        this.tweens.add({\n          targets: cleared,\n          alpha: 0,\n          y: cy - 30,\n          duration: 1500,\n          onComplete: () => cleared.destroy(),\n        });\n      }\n    }\n  }\n\n  // =======================================================================\n  // BOSS TRANSITION\n  // =======================================================================\n\n  private transitionToBoss(roomIndex: number): void {\n    // Find the boss ID for this floor from the dungeon definition\n    const dungeonDef = DUNGEON_DB.get(this.dungeonId);\n    if (!dungeonDef) return;\n\n    const floorDef = dungeonDef.floors.find(f => f.level === this.floorLevel);\n    if (!floorDef?.bossId) return;\n\n    // Prevent re-entry\n    if ((this as unknown as Record<string, boolean>).__bossTransitionStarted) return;\n    (this as unknown as Record<string, boolean>).__bossTransitionStarted = true;\n\n    // Brief flash before transition\n    this.cameras.main.flash(400, 255, 255, 255);\n\n    this.time.delayedCall(500, () => {\n      this.cleanUp();\n      this.scene.start('BossArenaScene', {\n        bossId: floorDef.bossId,\n        returnScene: 'DungeonScene',\n        returnData: {\n          dungeonId: this.dungeonId,\n          floorLevel: this.floorLevel + 1,\n          returnX: this.returnX,\n          returnY: this.returnY,\n        },\n      });\n    });\n  }\n\n  // =======================================================================\n  // DAMAGE EVENTS\n  // =======================================================================\n\n  private processDamageEvents(): void {\n    const events = flushDamageEvents();\n    const enemyDmgMult = this.registry.get('dungeonEnemyDmgMult') ?? 1;\n    for (const ev of events) {\n      // Apply light tier damage multiplier to enemy→player hits\n      if (ev.targetEid === this.playerEid && enemyDmgMult > 1) {\n        const extraDmg = Math.round(ev.damage * (enemyDmgMult - 1));\n        Health.current[this.playerEid] -= extraDmg;\n      }\n      const color = ev.isCrit ? '#ffaa00' : '#ff4444';\n      const text = this.add.text(ev.x, ev.y - 12, `${Math.round(ev.damage)}${ev.isCrit ? '!' : ''}`, {\n        fontFamily: 'monospace',\n        fontSize: ev.isCrit ? '14px' : '11px',\n        color,\n        fontStyle: ev.isCrit ? 'bold' : 'normal',\n      }).setOrigin(0.5).setDepth(9500);\n\n      (text as unknown as Record<string, number>).__life = 0;\n      this.damageTexts.push(text);\n\n      // Audio + camera shake\n      const isPlayerHit = ev.targetEid === this.playerEid;\n      if (isPlayerHit) {\n        this.audioManager.playSFX(SFX.PLAYER_HIT);\n        this.cameras.main.shake(120, 0.008);\n      } else {\n        this.audioManager.playSFX(ev.isCrit ? SFX.CRIT_HIT : SFX.ENEMY_HIT);\n        if (ev.isCrit) this.cameras.main.shake(80, 0.005);\n      }\n\n      // Combat particles\n      this.particleManager.emit('blood', ev.x, ev.y);\n      if (ev.isCrit) {\n        this.particleManager.emit('critFlash', ev.x, ev.y);\n      } else {\n        this.particleManager.emit('sparks', ev.x, ev.y);\n      }\n    }\n  }\n\n  private updateDamageTexts(dt: number): void {\n    for (let i = this.damageTexts.length - 1; i >= 0; i--) {\n      const t = this.damageTexts[i];\n      const rec = t as unknown as Record<string, number>;\n      rec.__life += dt;\n      t.y -= 30 * dt;\n      t.setAlpha(Math.max(0, 1 - rec.__life / 0.8));\n\n      if (rec.__life >= 0.8) {\n        t.destroy();\n        this.damageTexts.splice(i, 1);\n      }\n    }\n  }\n\n  // =======================================================================\n  // EXIT\n  // =======================================================================\n\n  private exitDungeon(): void {\n    // Rift mode: advance floor via RiftManager before returning\n    if (this.dungeonId === 'rift') {\n      const riftMgr = this.registry.get('riftManager') as RiftManager | undefined;\n      if (riftMgr) {\n        riftMgr.advanceFloor();\n      }\n    }\n    this.cleanUp();\n    this.scene.start('OverworldScene', { returnX: this.returnX, returnY: this.returnY });\n  }\n\n  private cleanUp(): void {\n    // Destroy the player sprite (ECS entity stays in world for now)\n    this.playerSprite?.destroy();\n    this.tileGraphics?.destroy();\n    for (const r of this.fogRects) r?.destroy();\n    for (const t of this.damageTexts) t?.destroy();\n\n    // Destroy enemy sprites\n    for (const [, sprite] of this.enemySpriteMap) sprite?.destroy();\n    this.enemySpriteMap.clear();\n\n    // Destroy loot drop sprites\n    for (const drop of this.lootDropSprites) drop.container?.destroy();\n    this.lootDropSprites = [];\n\n    // Destroy treasure chests\n    for (const chest of this.treasureChests) chest.sprite?.destroy();\n    this.treasureChests = [];\n\n    this.fogRects = [];\n    this.damageTexts = [];\n    this.spawnedRooms.clear();\n    this.roomEnemyEids.clear();\n    if (this.minimapCam) {\n      this.cameras.remove(this.minimapCam);\n    }\n\n    // Visual systems\n    this.lightingManager?.destroy();\n    this.particleManager?.destroy();\n  }\n\n  // =======================================================================\n  // HELPERS\n  // =======================================================================\n\n  private formatRoomType(type: RoomType): string {\n    switch (type) {\n      case 'monster':   return 'Monster Room';\n      case 'treasure':  return 'Treasure Room';\n      case 'boss':      return 'Boss Room';\n      case 'shop':      return 'Shop';\n      case 'puzzle':    return 'Puzzle Room';\n      case 'trap':      return 'Trap Room';\n      case 'seal':      return 'Sealed Room';\n      case 'entrance':  return 'Entrance';\n      case 'corridor':  return 'Corridor';\n      default:          return String(type);\n    }\n  }\n}\n","import { BossDef } from '../types/combat';\n\nexport const BOSSES: BossDef[] = [\n  // =========================================================================\n  // MINE BOSSES\n  // =========================================================================\n  {\n    id: 'slime_king',\n    name: 'Slime King',\n    title: 'Lord of the Slimes',\n    biome: 'cave',\n    hp: 1500,\n    damage: 35,\n    defense: 12,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['bounce', 'summon_slimes'], speed: 1.5, damageMult: 1.0, defenseMult: 1.0, description: 'Bounces and summons slime minions.' },\n      { hpThreshold: 0.5, abilities: ['bounce', 'summon_slimes', 'ground_pound'], speed: 1.8, damageMult: 1.2, defenseMult: 1.0, description: 'Adds devastating ground pound attacks.' },\n      { hpThreshold: 0.25, abilities: ['bounce', 'summon_slimes', 'ground_pound', 'split'], speed: 2.0, damageMult: 1.5, defenseMult: 0.8, description: 'Splits into smaller copies of itself.' },\n    ],\n    drops: [\n      { itemId: 'slime_crown', chance: 1.0, minQty: 1, maxQty: 1 },\n      { itemId: 'royal_jelly', chance: 0.8, minQty: 1, maxQty: 3 },\n      { itemId: 'prismatic_shard', chance: 0.05, minQty: 1, maxQty: 1 },\n    ],\n    arenaWidth: 800,\n    arenaHeight: 600,\n    music: 'boss_slime',\n    xpReward: 500,\n    isGateBoss: false,\n  },\n  {\n    id: 'shadow_lord',\n    name: 'Shadow Lord',\n    title: 'Master of Darkness',\n    biome: 'cave',\n    hp: 3000,\n    damage: 55,\n    defense: 20,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['shadow_bolt', 'teleport'], speed: 2.5, damageMult: 1.0, defenseMult: 1.0, description: 'Fires shadow bolts and teleports around the arena.' },\n      { hpThreshold: 0.6, abilities: ['shadow_bolt', 'teleport', 'clone'], speed: 2.8, damageMult: 1.3, defenseMult: 1.0, description: 'Creates shadow clones to confuse the player.' },\n      { hpThreshold: 0.3, abilities: ['shadow_bolt', 'teleport', 'clone', 'void_zone'], speed: 3.0, damageMult: 1.5, defenseMult: 0.9, description: 'Summons void zones that damage anything inside.' },\n    ],\n    drops: [\n      { itemId: 'void_heart', chance: 1.0, minQty: 1, maxQty: 1 },\n      { itemId: 'shadow_blade', chance: 0.3, minQty: 1, maxQty: 1 },\n      { itemId: 'galaxy_soul', chance: 0.1, minQty: 1, maxQty: 1 },\n    ],\n    arenaWidth: 1000,\n    arenaHeight: 800,\n    music: 'boss_shadow',\n    xpReward: 1500,\n    isGateBoss: false,\n  },\n  {\n    id: 'frost_wyrm',\n    name: 'Frost Wyrm',\n    title: 'Ancient Ice Dragon',\n    biome: 'snow',\n    hp: 4000,\n    damage: 70,\n    defense: 25,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['ice_breath', 'tail_sweep'], speed: 2.0, damageMult: 1.0, defenseMult: 1.0, description: 'Breathes ice and sweeps with its tail.' },\n      { hpThreshold: 0.5, abilities: ['ice_breath', 'tail_sweep', 'blizzard', 'fly'], speed: 2.5, damageMult: 1.3, defenseMult: 1.0, description: 'Takes flight and unleashes blizzards.' },\n      { hpThreshold: 0.2, abilities: ['ice_breath', 'tail_sweep', 'blizzard', 'fly', 'ice_prison'], speed: 3.0, damageMult: 1.6, defenseMult: 0.8, description: 'Encases the player in ice prisons.' },\n    ],\n    drops: [\n      { itemId: 'frost_scale', chance: 1.0, minQty: 3, maxQty: 5 },\n      { itemId: 'frozen_heart', chance: 0.5, minQty: 1, maxQty: 1 },\n      { itemId: 'wyrm_fang', chance: 0.8, minQty: 1, maxQty: 2 },\n    ],\n    arenaWidth: 1200,\n    arenaHeight: 800,\n    music: 'boss_frost',\n    xpReward: 2000,\n    isGateBoss: false,\n  },\n  {\n    id: 'ancient_golem',\n    name: 'Ancient Golem',\n    title: 'Stone Sentinel',\n    biome: 'cave',\n    hp: 5000,\n    damage: 90,\n    defense: 40,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['smash', 'rock_throw'], speed: 0.8, damageMult: 1.0, defenseMult: 1.0, description: 'Smashes and hurls boulders.' },\n      { hpThreshold: 0.5, abilities: ['smash', 'rock_throw', 'earthquake'], speed: 1.0, damageMult: 1.3, defenseMult: 1.2, description: 'Causes earthquakes that shake the arena.' },\n      { hpThreshold: 0.2, abilities: ['smash', 'rock_throw', 'earthquake', 'laser_beam'], speed: 1.2, damageMult: 1.6, defenseMult: 0.8, description: 'Fires a devastating laser beam from its core.' },\n    ],\n    drops: [\n      { itemId: 'ancient_core', chance: 1.0, minQty: 1, maxQty: 1 },\n      { itemId: 'golem_heart', chance: 0.4, minQty: 1, maxQty: 1 },\n      { itemId: 'prismatic_shard', chance: 0.15, minQty: 1, maxQty: 2 },\n    ],\n    arenaWidth: 1000,\n    arenaHeight: 1000,\n    music: 'boss_golem',\n    xpReward: 2500,\n    isGateBoss: false,\n  },\n  {\n    id: 'void_empress',\n    name: 'Void Empress',\n    title: 'Sovereign of the Abyss',\n    biome: 'void',\n    hp: 8000,\n    damage: 100,\n    defense: 30,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['void_bolt', 'summon_shadows'], speed: 3.0, damageMult: 1.0, defenseMult: 1.0, description: 'Fires void bolts and summons shadow minions.' },\n      { hpThreshold: 0.75, abilities: ['void_bolt', 'summon_shadows', 'dimension_rift'], speed: 3.2, damageMult: 1.2, defenseMult: 1.0, description: 'Opens dimension rifts that distort space.' },\n      { hpThreshold: 0.5, abilities: ['void_bolt', 'summon_shadows', 'dimension_rift', 'time_stop'], speed: 3.5, damageMult: 1.4, defenseMult: 0.9, description: 'Stops time briefly, repositioning for devastating attacks.' },\n      { hpThreshold: 0.25, abilities: ['void_bolt', 'summon_shadows', 'dimension_rift', 'time_stop', 'reality_shatter'], speed: 4.0, damageMult: 1.8, defenseMult: 0.7, description: 'Shatters reality itself, warping the arena.' },\n    ],\n    drops: [\n      { itemId: 'void_crown', chance: 1.0, minQty: 1, maxQty: 1 },\n      { itemId: 'empress_staff', chance: 0.5, minQty: 1, maxQty: 1 },\n      { itemId: 'galaxy_soul', chance: 0.3, minQty: 1, maxQty: 3 },\n      { itemId: 'prismatic_shard', chance: 0.2, minQty: 1, maxQty: 5 },\n    ],\n    arenaWidth: 1400,\n    arenaHeight: 1000,\n    music: 'boss_void',\n    xpReward: 5000,\n    isGateBoss: false,\n  },\n\n  // =========================================================================\n  // SPECIAL BOSSES (new boss sprite packs)\n  // =========================================================================\n  {\n    id: 'ice_demon',\n    name: 'Ice Demon Lord',\n    title: 'Lord of Frozen Torment',\n    biome: 'snow',\n    hp: 6000,\n    damage: 80,\n    defense: 35,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['ice_breath', 'frost_spike'], speed: 1.8, damageMult: 1.0, defenseMult: 1.0, description: 'Breathes frost and launches ice spikes.' },\n      { hpThreshold: 0.6, abilities: ['ice_breath', 'frost_spike', 'blizzard'], speed: 2.0, damageMult: 1.3, defenseMult: 1.0, description: 'Summons devastating blizzards.' },\n      { hpThreshold: 0.3, abilities: ['ice_breath', 'frost_spike', 'blizzard', 'ice_prison', 'absolute_zero'], speed: 2.5, damageMult: 1.6, defenseMult: 0.8, description: 'Unleashes absolute zero, freezing everything.' },\n    ],\n    drops: [\n      { itemId: 'frozen_heart', chance: 1.0, minQty: 1, maxQty: 1 },\n      { itemId: 'ice_crystal', chance: 0.9, minQty: 3, maxQty: 5 },\n      { itemId: 'frost_scale', chance: 0.7, minQty: 1, maxQty: 3 },\n      { itemId: 'prismatic_shard', chance: 0.1, minQty: 1, maxQty: 1 },\n    ],\n    arenaWidth: 1200,\n    arenaHeight: 900,\n    music: 'boss_ice',\n    xpReward: 3000,\n    isGateBoss: false,\n  },\n  {\n    id: 'fire_demon',\n    name: 'Fire Demon Lord',\n    title: 'Lord of Infernal Flame',\n    biome: 'volcano',\n    hp: 6500,\n    damage: 95,\n    defense: 28,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['fire_breath', 'meteor'], speed: 2.2, damageMult: 1.0, defenseMult: 1.0, description: 'Breathes fire and calls down meteors.' },\n      { hpThreshold: 0.6, abilities: ['fire_breath', 'meteor', 'lava_pool'], speed: 2.5, damageMult: 1.3, defenseMult: 1.0, description: 'Creates pools of lava across the arena.' },\n      { hpThreshold: 0.3, abilities: ['fire_breath', 'meteor', 'lava_pool', 'inferno'], speed: 3.0, damageMult: 1.6, defenseMult: 0.8, description: 'Engulfs the entire arena in inferno.' },\n    ],\n    drops: [\n      { itemId: 'fire_crystal', chance: 1.0, minQty: 3, maxQty: 5 },\n      { itemId: 'demon_heart', chance: 0.5, minQty: 1, maxQty: 1 },\n      { itemId: 'magma_core', chance: 0.6, minQty: 1, maxQty: 2 },\n      { itemId: 'prismatic_shard', chance: 0.1, minQty: 1, maxQty: 1 },\n    ],\n    arenaWidth: 1200,\n    arenaHeight: 900,\n    music: 'boss_fire',\n    xpReward: 3200,\n    isGateBoss: false,\n  },\n  {\n    id: 'monster_bird',\n    name: 'Corrupted Phoenix',\n    title: 'Bird of Ruin',\n    biome: 'mountain',\n    hp: 4500,\n    damage: 65,\n    defense: 20,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['dive_bomb', 'feather_storm'], speed: 3.5, damageMult: 1.0, defenseMult: 1.0, description: 'Dive bombs and launches feather storms.' },\n      { hpThreshold: 0.5, abilities: ['dive_bomb', 'feather_storm', 'wind_gust', 'fly'], speed: 4.0, damageMult: 1.3, defenseMult: 1.0, description: 'Takes flight and uses wind gusts.' },\n      { hpThreshold: 0.2, abilities: ['dive_bomb', 'feather_storm', 'wind_gust', 'fly', 'sonic_screech'], speed: 4.5, damageMult: 1.5, defenseMult: 0.7, description: 'Unleashes a devastating sonic screech.' },\n    ],\n    drops: [\n      { itemId: 'phoenix_feather', chance: 1.0, minQty: 1, maxQty: 3 },\n      { itemId: 'wind_essence', chance: 0.8, minQty: 1, maxQty: 2 },\n      { itemId: 'talon', chance: 0.9, minQty: 2, maxQty: 4 },\n    ],\n    arenaWidth: 1400,\n    arenaHeight: 800,\n    music: 'boss_bird',\n    xpReward: 2200,\n    isGateBoss: false,\n  },\n\n  // =========================================================================\n  // FOREST DUNGEON BOSSES\n  // =========================================================================\n  {\n    id: 'grove_guardian',\n    name: 'Grove Guardian',\n    title: 'Protector of the Grove',\n    biome: 'forest',\n    hp: 800,\n    damage: 25,\n    defense: 15,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['vine_whip', 'root_burst'], speed: 1.2, damageMult: 1.0, defenseMult: 1.0, description: 'Whips with vines and bursts roots from the ground.' },\n      { hpThreshold: 0.5, abilities: ['vine_whip', 'root_burst', 'thorn_shield'], speed: 1.5, damageMult: 1.3, defenseMult: 1.5, description: 'Summons a thorn shield for protection.' },\n    ],\n    drops: [\n      { itemId: 'living_sap', chance: 1.0, minQty: 1, maxQty: 2 },\n      { itemId: 'ancient_bark', chance: 0.5, minQty: 1, maxQty: 1 },\n    ],\n    arenaWidth: 800,\n    arenaHeight: 600,\n    music: 'boss_forest',\n    xpReward: 300,\n    isGateBoss: false,\n  },\n  {\n    id: 'forest_spider_queen',\n    name: 'Forest Spider Queen',\n    title: 'Queen of Webs',\n    biome: 'forest',\n    hp: 1200,\n    damage: 35,\n    defense: 10,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['web_shot', 'poison_bite'], speed: 2.5, damageMult: 1.0, defenseMult: 1.0, description: 'Shoots webs and delivers venomous bites.' },\n      { hpThreshold: 0.6, abilities: ['web_shot', 'poison_bite', 'spawn_spiderlings'], speed: 2.8, damageMult: 1.2, defenseMult: 1.0, description: 'Spawns waves of spiderlings.' },\n      { hpThreshold: 0.3, abilities: ['web_shot', 'poison_bite', 'spawn_spiderlings', 'web_cocoon'], speed: 3.0, damageMult: 1.5, defenseMult: 0.8, description: 'Wraps the player in web cocoons.' },\n    ],\n    drops: [\n      { itemId: 'spider_silk', chance: 1.0, minQty: 3, maxQty: 5 },\n      { itemId: 'venom_gland', chance: 0.7, minQty: 1, maxQty: 2 },\n      { itemId: 'queen_fang', chance: 0.3, minQty: 1, maxQty: 1 },\n    ],\n    arenaWidth: 900,\n    arenaHeight: 700,\n    music: 'boss_forest',\n    xpReward: 500,\n    isGateBoss: false,\n  },\n  {\n    id: 'ancient_treant',\n    name: 'Ancient Treant',\n    title: 'Heart of the Forest',\n    biome: 'forest',\n    hp: 3000,\n    damage: 60,\n    defense: 35,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['slam', 'seed_barrage'], speed: 0.6, damageMult: 1.0, defenseMult: 1.0, description: 'Slams and launches seed barrages.' },\n      { hpThreshold: 0.6, abilities: ['slam', 'seed_barrage', 'forest_awakening'], speed: 0.8, damageMult: 1.3, defenseMult: 1.2, description: 'Awakens the forest, spawning hostile plants.' },\n      { hpThreshold: 0.3, abilities: ['slam', 'seed_barrage', 'forest_awakening', 'natures_wrath'], speed: 1.0, damageMult: 1.6, defenseMult: 1.0, description: 'Unleashes nature\\'s wrath — thorns erupt everywhere.' },\n    ],\n    drops: [\n      { itemId: 'treant_heart', chance: 1.0, minQty: 1, maxQty: 1 },\n      { itemId: 'forest_heart', chance: 0.5, minQty: 1, maxQty: 1 },\n      { itemId: 'natures_blessing', chance: 0.25, minQty: 1, maxQty: 1 },\n    ],\n    arenaWidth: 1200,\n    arenaHeight: 900,\n    music: 'boss_forest',\n    xpReward: 1200,\n    isGateBoss: false,\n  },\n\n  // =========================================================================\n  // SWAMP DUNGEON BOSSES\n  // =========================================================================\n  {\n    id: 'marsh_lurker',\n    name: 'Marsh Lurker',\n    title: 'Terror of the Mire',\n    biome: 'swamp',\n    hp: 1000,\n    damage: 40,\n    defense: 20,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['lunge', 'tail_sweep'], speed: 1.8, damageMult: 1.0, defenseMult: 1.0, description: 'Lunges and sweeps with its tail.' },\n      { hpThreshold: 0.5, abilities: ['lunge', 'tail_sweep', 'mud_splash'], speed: 2.0, damageMult: 1.3, defenseMult: 1.2, description: 'Splashes blinding mud across the arena.' },\n    ],\n    drops: [\n      { itemId: 'lurker_scale', chance: 1.0, minQty: 1, maxQty: 3 },\n      { itemId: 'swamp_fang', chance: 0.6, minQty: 1, maxQty: 1 },\n    ],\n    arenaWidth: 900,\n    arenaHeight: 700,\n    music: 'boss_swamp',\n    xpReward: 400,\n    isGateBoss: false,\n  },\n  {\n    id: 'swamp_horror',\n    name: 'Swamp Horror',\n    title: 'Abomination of the Marsh',\n    biome: 'swamp',\n    hp: 2500,\n    damage: 55,\n    defense: 18,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['tentacle_slam', 'toxic_spray'], speed: 1.0, damageMult: 1.0, defenseMult: 1.0, description: 'Slams tentacles and sprays toxic sludge.' },\n      { hpThreshold: 0.6, abilities: ['tentacle_slam', 'toxic_spray', 'dragging_depths'], speed: 1.2, damageMult: 1.3, defenseMult: 1.0, description: 'Drags the player into the swamp depths.' },\n      { hpThreshold: 0.3, abilities: ['tentacle_slam', 'toxic_spray', 'dragging_depths', 'miasma'], speed: 1.5, damageMult: 1.5, defenseMult: 0.8, description: 'Emits a poisonous miasma across the arena.' },\n    ],\n    drops: [\n      { itemId: 'horror_tentacle', chance: 1.0, minQty: 1, maxQty: 2 },\n      { itemId: 'blighted_heart', chance: 0.6, minQty: 1, maxQty: 1 },\n      { itemId: 'marsh_eye', chance: 0.3, minQty: 1, maxQty: 1 },\n    ],\n    arenaWidth: 1100,\n    arenaHeight: 900,\n    music: 'boss_swamp',\n    xpReward: 1000,\n    isGateBoss: false,\n  },\n\n  // =========================================================================\n  // VOLCANO DUNGEON BOSSES\n  // =========================================================================\n  {\n    id: 'fire_imp_king',\n    name: 'Fire Imp King',\n    title: 'Ruler of the Embers',\n    biome: 'volcano',\n    hp: 1100,\n    damage: 45,\n    defense: 12,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['fireball', 'flame_dash'], speed: 2.5, damageMult: 1.0, defenseMult: 1.0, description: 'Throws fireballs and dashes in flame.' },\n      { hpThreshold: 0.5, abilities: ['fireball', 'flame_dash', 'summon_imps'], speed: 3.0, damageMult: 1.3, defenseMult: 1.0, description: 'Summons fire imp reinforcements.' },\n    ],\n    drops: [\n      { itemId: 'imp_crown', chance: 1.0, minQty: 1, maxQty: 1 },\n      { itemId: 'fire_ore', chance: 0.8, minQty: 1, maxQty: 3 },\n    ],\n    arenaWidth: 800,\n    arenaHeight: 600,\n    music: 'boss_fire',\n    xpReward: 450,\n    isGateBoss: false,\n  },\n  {\n    id: 'lava_golem',\n    name: 'Lava Golem',\n    title: 'Molten Monolith',\n    biome: 'volcano',\n    hp: 2000,\n    damage: 70,\n    defense: 45,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['magma_fist', 'lava_spit'], speed: 0.7, damageMult: 1.0, defenseMult: 1.0, description: 'Punches with magma fists and spits lava.' },\n      { hpThreshold: 0.5, abilities: ['magma_fist', 'lava_spit', 'eruption'], speed: 0.9, damageMult: 1.4, defenseMult: 1.2, description: 'Erupts, sending lava everywhere.' },\n    ],\n    drops: [\n      { itemId: 'magma_core', chance: 1.0, minQty: 1, maxQty: 1 },\n      { itemId: 'obsidian', chance: 0.9, minQty: 3, maxQty: 5 },\n      { itemId: 'fire_crystal', chance: 0.5, minQty: 1, maxQty: 2 },\n    ],\n    arenaWidth: 1000,\n    arenaHeight: 800,\n    music: 'boss_fire',\n    xpReward: 800,\n    isGateBoss: false,\n  },\n  {\n    id: 'molten_guardian',\n    name: 'Molten Guardian',\n    title: 'Keeper of the Flame',\n    biome: 'volcano',\n    hp: 4000,\n    damage: 85,\n    defense: 30,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['fire_breath', 'meteor'], speed: 1.5, damageMult: 1.0, defenseMult: 1.0, description: 'Breathes fire and calls meteors.' },\n      { hpThreshold: 0.6, abilities: ['fire_breath', 'meteor', 'lava_pool'], speed: 1.8, damageMult: 1.3, defenseMult: 1.0, description: 'Creates pools of lava on the arena floor.' },\n      { hpThreshold: 0.3, abilities: ['fire_breath', 'meteor', 'lava_pool', 'inferno'], speed: 2.0, damageMult: 1.6, defenseMult: 0.8, description: 'Engulfs the arena in a fiery inferno.' },\n    ],\n    drops: [\n      { itemId: 'molten_heart', chance: 1.0, minQty: 1, maxQty: 1 },\n      { itemId: 'infernal_essence', chance: 0.5, minQty: 1, maxQty: 1 },\n      { itemId: 'flame_core', chance: 0.3, minQty: 1, maxQty: 1 },\n      { itemId: 'prismatic_shard', chance: 0.1, minQty: 1, maxQty: 1 },\n    ],\n    arenaWidth: 1200,\n    arenaHeight: 900,\n    music: 'boss_fire',\n    xpReward: 1800,\n    isGateBoss: false,\n  },\n\n  // =========================================================================\n  // ICE DUNGEON BOSSES\n  // =========================================================================\n  {\n    id: 'frost_guardian',\n    name: 'Frost Guardian',\n    title: 'Warden of Ice',\n    biome: 'snow',\n    hp: 1500,\n    damage: 45,\n    defense: 30,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['ice_spike', 'frost_armor'], speed: 1.0, damageMult: 1.0, defenseMult: 1.0, description: 'Launches ice spikes and reinforces its armor.' },\n      { hpThreshold: 0.5, abilities: ['ice_spike', 'frost_armor', 'frozen_ground'], speed: 1.3, damageMult: 1.3, defenseMult: 1.5, description: 'Freezes the ground, slowing movement.' },\n    ],\n    drops: [\n      { itemId: 'ice_crystal', chance: 1.0, minQty: 3, maxQty: 5 },\n      { itemId: 'frost_shard', chance: 0.6, minQty: 1, maxQty: 2 },\n    ],\n    arenaWidth: 900,\n    arenaHeight: 700,\n    music: 'boss_ice',\n    xpReward: 600,\n    isGateBoss: false,\n  },\n\n  // =========================================================================\n  // UNDEAD/WASTELAND DUNGEON BOSSES\n  // =========================================================================\n  {\n    id: 'bone_lord',\n    name: 'Bone Lord',\n    title: 'Commander of the Dead',\n    biome: 'wasteland',\n    hp: 1800,\n    damage: 50,\n    defense: 25,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['bone_throw', 'summon_skeletons'], speed: 1.5, damageMult: 1.0, defenseMult: 1.0, description: 'Throws bones and summons skeleton warriors.' },\n      { hpThreshold: 0.5, abilities: ['bone_throw', 'summon_skeletons', 'bone_shield'], speed: 1.8, damageMult: 1.3, defenseMult: 1.5, description: 'Encases itself in a bone shield.' },\n    ],\n    drops: [\n      { itemId: 'bone', chance: 1.0, minQty: 5, maxQty: 10 },\n      { itemId: 'cursed_bone', chance: 0.6, minQty: 1, maxQty: 2 },\n      { itemId: 'bone_crown', chance: 0.3, minQty: 1, maxQty: 1 },\n    ],\n    arenaWidth: 900,\n    arenaHeight: 700,\n    music: 'boss_undead',\n    xpReward: 700,\n    isGateBoss: false,\n  },\n  {\n    id: 'spectral_warden',\n    name: 'Spectral Warden',\n    title: 'Keeper of Lost Souls',\n    biome: 'wasteland',\n    hp: 2200,\n    damage: 60,\n    defense: 10,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['soul_bolt', 'phase_through'], speed: 2.8, damageMult: 1.0, defenseMult: 1.0, description: 'Fires soul bolts and phases through walls.' },\n      { hpThreshold: 0.6, abilities: ['soul_bolt', 'phase_through', 'spectral_chains'], speed: 3.0, damageMult: 1.3, defenseMult: 1.0, description: 'Binds the player with spectral chains.' },\n      { hpThreshold: 0.3, abilities: ['soul_bolt', 'phase_through', 'spectral_chains', 'soul_drain'], speed: 3.5, damageMult: 1.5, defenseMult: 0.8, description: 'Drains the player\\'s soul for healing.' },\n    ],\n    drops: [\n      { itemId: 'ectoplasm', chance: 1.0, minQty: 3, maxQty: 5 },\n      { itemId: 'spirit_essence', chance: 0.7, minQty: 1, maxQty: 2 },\n      { itemId: 'spectral_binding', chance: 0.3, minQty: 1, maxQty: 1 },\n    ],\n    arenaWidth: 1000,\n    arenaHeight: 800,\n    music: 'boss_undead',\n    xpReward: 900,\n    isGateBoss: false,\n  },\n  {\n    id: 'lich_king',\n    name: 'The Lich King',\n    title: 'Master of Death',\n    biome: 'wasteland',\n    hp: 5000,\n    damage: 80,\n    defense: 25,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['death_bolt', 'raise_dead'], speed: 1.8, damageMult: 1.0, defenseMult: 1.0, description: 'Fires death bolts and raises undead minions.' },\n      { hpThreshold: 0.7, abilities: ['death_bolt', 'raise_dead', 'death_grip'], speed: 2.0, damageMult: 1.2, defenseMult: 1.0, description: 'Grips the player with necrotic energy.' },\n      { hpThreshold: 0.4, abilities: ['death_bolt', 'raise_dead', 'death_grip', 'frost_nova'], speed: 2.2, damageMult: 1.4, defenseMult: 0.9, description: 'Freezes everything with a frost nova.' },\n      { hpThreshold: 0.2, abilities: ['death_bolt', 'raise_dead', 'death_grip', 'frost_nova', 'army_of_dead'], speed: 2.5, damageMult: 1.8, defenseMult: 0.7, description: 'Raises an army of the dead for a final assault.' },\n    ],\n    drops: [\n      { itemId: 'lich_phylactery', chance: 1.0, minQty: 1, maxQty: 1 },\n      { itemId: 'death_crown', chance: 0.5, minQty: 1, maxQty: 1 },\n      { itemId: 'soul_fragment', chance: 0.8, minQty: 3, maxQty: 5 },\n      { itemId: 'prismatic_shard', chance: 0.15, minQty: 1, maxQty: 1 },\n    ],\n    arenaWidth: 1300,\n    arenaHeight: 1000,\n    music: 'boss_undead',\n    xpReward: 2500,\n    isGateBoss: false,\n  },\n\n  // =========================================================================\n  // LEGENDARY BOSS\n  // =========================================================================\n  {\n    id: 'dragon',\n    name: 'Ancient Dragon',\n    title: 'Scourge of the Mountains',\n    biome: 'volcano',\n    hp: 10000,\n    damage: 80,\n    defense: 35,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['fire_breath', 'tail_sweep', 'fly'], speed: 3.0, damageMult: 1.0, defenseMult: 1.0, description: 'Breathes fire, sweeps tail, takes flight.' },\n      { hpThreshold: 0.6, abilities: ['fire_breath', 'tail_sweep', 'fly', 'summon_drakes'], speed: 3.5, damageMult: 1.3, defenseMult: 1.0, description: 'Summons drake minions to aid in battle.' },\n      { hpThreshold: 0.3, abilities: ['fire_breath', 'tail_sweep', 'fly', 'summon_drakes', 'meteor_rain'], speed: 4.0, damageMult: 1.6, defenseMult: 0.8, description: 'Rains meteors from the sky in a final fury.' },\n    ],\n    drops: [\n      { itemId: 'dragon_scale', chance: 1.0, minQty: 5, maxQty: 10 },\n      { itemId: 'dragon_fang', chance: 0.8, minQty: 1, maxQty: 3 },\n      { itemId: 'fire_crystal', chance: 1.0, minQty: 3, maxQty: 5 },\n      { itemId: 'prismatic_shard', chance: 0.25, minQty: 1, maxQty: 3 },\n    ],\n    arenaWidth: 1600,\n    arenaHeight: 1200,\n    music: 'boss_dragon',\n    xpReward: 10000,\n    isGateBoss: false,\n  },\n\n  // =========================================================================\n  // GATE BOSSES (new for Phaser rebuild — one per biome transition)\n  // =========================================================================\n  {\n    id: 'harvest_horror',\n    name: 'Harvest Horror',\n    title: 'Guardian of Haven\\'s Border',\n    biome: 'haven',\n    hp: 2000,\n    damage: 40,\n    defense: 15,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['vine_whip', 'seed_bomb'], speed: 1.5, damageMult: 1.0, defenseMult: 1.0, description: 'Whips vines and launches exploding seed bombs.' },\n      { hpThreshold: 0.6, abilities: ['vine_whip', 'seed_bomb', 'thorn_wall'], speed: 1.8, damageMult: 1.3, defenseMult: 1.2, description: 'Creates walls of thorns to restrict movement.' },\n      { hpThreshold: 0.3, abilities: ['vine_whip', 'seed_bomb', 'thorn_wall', 'pollen_cloud'], speed: 2.0, damageMult: 1.5, defenseMult: 1.0, description: 'Releases toxic pollen that poisons the arena.' },\n    ],\n    drops: [\n      { itemId: 'forest_heart', chance: 1.0, minQty: 1, maxQty: 1 },\n      { itemId: 'living_sap', chance: 0.8, minQty: 2, maxQty: 4 },\n      { itemId: 'ancient_bark', chance: 0.5, minQty: 1, maxQty: 2 },\n    ],\n    arenaWidth: 1000,\n    arenaHeight: 800,\n    music: 'boss_haven',\n    weakness: 'fire',\n    xpReward: 1000,\n    isGateBoss: true,\n  },\n  {\n    id: 'blight_mother',\n    name: 'Blight Mother',\n    title: 'Matriarch of Decay',\n    biome: 'rotwood',\n    hp: 3500,\n    damage: 55,\n    defense: 20,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['spore_burst', 'fungal_slam'], speed: 1.2, damageMult: 1.0, defenseMult: 1.0, description: 'Releases spore bursts and slams with fungal limbs.' },\n      { hpThreshold: 0.6, abilities: ['spore_burst', 'fungal_slam', 'spawn_minions'], speed: 1.5, damageMult: 1.2, defenseMult: 1.0, description: 'Spawns fungal minions from its body.' },\n      { hpThreshold: 0.3, abilities: ['spore_burst', 'fungal_slam', 'spawn_minions', 'rot_cloud'], speed: 1.8, damageMult: 1.5, defenseMult: 0.8, description: 'Emits a cloud of rot that decays everything.' },\n    ],\n    drops: [\n      { itemId: 'blighted_heart', chance: 1.0, minQty: 1, maxQty: 1 },\n      { itemId: 'spore', chance: 0.9, minQty: 3, maxQty: 6 },\n      { itemId: 'corrupted_heart', chance: 0.3, minQty: 1, maxQty: 1 },\n    ],\n    arenaWidth: 1100,\n    arenaHeight: 800,\n    music: 'boss_rotwood',\n    weakness: 'fire',\n    xpReward: 1500,\n    isGateBoss: true,\n  },\n  {\n    id: 'stone_titan',\n    name: 'Stone Titan',\n    title: 'Sentinel of the Ashlands',\n    biome: 'ashlands',\n    hp: 5000,\n    damage: 75,\n    defense: 45,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['ground_pound', 'rock_throw'], speed: 0.8, damageMult: 1.0, defenseMult: 1.0, description: 'Pounds the ground and hurls boulders.' },\n      { hpThreshold: 0.6, abilities: ['ground_pound', 'rock_throw', 'lava_trail'], speed: 1.0, damageMult: 1.3, defenseMult: 1.2, description: 'Leaves trails of lava as it walks.' },\n      { hpThreshold: 0.3, abilities: ['ground_pound', 'rock_throw', 'lava_trail', 'volcanic_eruption'], speed: 1.2, damageMult: 1.6, defenseMult: 1.0, description: 'Triggers volcanic eruptions across the arena.' },\n    ],\n    drops: [\n      { itemId: 'flame_core', chance: 1.0, minQty: 1, maxQty: 1 },\n      { itemId: 'obsidian', chance: 0.9, minQty: 3, maxQty: 6 },\n      { itemId: 'magma_core', chance: 0.5, minQty: 1, maxQty: 2 },\n    ],\n    arenaWidth: 1200,\n    arenaHeight: 900,\n    music: 'boss_ashlands',\n    weakness: 'ice',\n    xpReward: 2000,\n    isGateBoss: true,\n  },\n  {\n    id: 'kraken',\n    name: 'Kraken',\n    title: 'Terror of the Depths',\n    biome: 'drowned',\n    hp: 6000,\n    damage: 70,\n    defense: 25,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['tentacle_slam', 'ink_spray'], speed: 1.5, damageMult: 1.0, defenseMult: 1.0, description: 'Slams tentacles and sprays blinding ink.' },\n      { hpThreshold: 0.6, abilities: ['tentacle_slam', 'ink_spray', 'water_surge'], speed: 1.8, damageMult: 1.3, defenseMult: 1.0, description: 'Summons water surges that sweep the arena.' },\n      { hpThreshold: 0.3, abilities: ['tentacle_slam', 'ink_spray', 'water_surge', 'whirlpool'], speed: 2.0, damageMult: 1.5, defenseMult: 0.8, description: 'Creates a massive whirlpool in the arena center.' },\n    ],\n    drops: [\n      { itemId: 'ocean_heart', chance: 1.0, minQty: 1, maxQty: 1 },\n      { itemId: 'pearl', chance: 0.7, minQty: 1, maxQty: 3 },\n      { itemId: 'horror_tentacle', chance: 0.9, minQty: 2, maxQty: 4 },\n    ],\n    arenaWidth: 1400,\n    arenaHeight: 1000,\n    music: 'boss_drowned',\n    weakness: 'lightning',\n    xpReward: 2500,\n    isGateBoss: true,\n  },\n  {\n    id: 'sand_wyrm',\n    name: 'Sand Wyrm',\n    title: 'Burrower of the Bone Wastes',\n    biome: 'bone',\n    hp: 7000,\n    damage: 85,\n    defense: 30,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['burrow_strike', 'sand_blast'], speed: 2.0, damageMult: 1.0, defenseMult: 1.0, description: 'Burrows underground and strikes from below.' },\n      { hpThreshold: 0.6, abilities: ['burrow_strike', 'sand_blast', 'tremor_sense'], speed: 2.5, damageMult: 1.3, defenseMult: 1.0, description: 'Uses tremor sense to track and ambush.' },\n      { hpThreshold: 0.3, abilities: ['burrow_strike', 'sand_blast', 'tremor_sense', 'sandstorm'], speed: 3.0, damageMult: 1.6, defenseMult: 0.8, description: 'Summons a blinding sandstorm.' },\n    ],\n    drops: [\n      { itemId: 'wyrm_scale', chance: 1.0, minQty: 3, maxQty: 6 },\n      { itemId: 'wyrm_fang', chance: 0.7, minQty: 1, maxQty: 2 },\n      { itemId: 'soul_fragment', chance: 0.4, minQty: 1, maxQty: 3 },\n    ],\n    arenaWidth: 1400,\n    arenaHeight: 1000,\n    music: 'boss_bone',\n    weakness: 'water',\n    xpReward: 3000,\n    isGateBoss: true,\n  },\n  {\n    id: 'void_weaver',\n    name: 'Void Weaver',\n    title: 'Architect of Nothingness',\n    biome: 'void',\n    hp: 8000,\n    damage: 95,\n    defense: 28,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['reality_tear', 'void_bolt'], speed: 2.5, damageMult: 1.0, defenseMult: 1.0, description: 'Tears reality and fires void bolts.' },\n      { hpThreshold: 0.6, abilities: ['reality_tear', 'void_bolt', 'clone_phase'], speed: 3.0, damageMult: 1.3, defenseMult: 1.0, description: 'Creates clones of itself from the void.' },\n      { hpThreshold: 0.3, abilities: ['reality_tear', 'void_bolt', 'clone_phase', 'dimension_swap'], speed: 3.5, damageMult: 1.6, defenseMult: 0.7, description: 'Swaps dimensions, changing the entire arena.' },\n    ],\n    drops: [\n      { itemId: 'void_essence', chance: 1.0, minQty: 5, maxQty: 10 },\n      { itemId: 'galaxy_soul', chance: 0.4, minQty: 1, maxQty: 2 },\n      { itemId: 'void_crown', chance: 0.15, minQty: 1, maxQty: 1 },\n    ],\n    arenaWidth: 1400,\n    arenaHeight: 1000,\n    music: 'boss_void',\n    weakness: 'light',\n    xpReward: 4000,\n    isGateBoss: true,\n  },\n  {\n    id: 'storm_lord',\n    name: 'Storm Lord',\n    title: 'Tempest Sovereign',\n    biome: 'edilas',\n    hp: 9000,\n    damage: 100,\n    defense: 32,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['lightning_bolt', 'wind_push'], speed: 3.0, damageMult: 1.0, defenseMult: 1.0, description: 'Hurls lightning and pushes with gale-force wind.' },\n      { hpThreshold: 0.6, abilities: ['lightning_bolt', 'wind_push', 'tornado'], speed: 3.5, damageMult: 1.3, defenseMult: 1.0, description: 'Summons tornadoes that sweep the arena.' },\n      { hpThreshold: 0.3, abilities: ['lightning_bolt', 'wind_push', 'tornado', 'supercell'], speed: 4.0, damageMult: 1.6, defenseMult: 0.8, description: 'Creates a supercell storm that reshapes the arena.' },\n    ],\n    drops: [\n      { itemId: 'wind_essence', chance: 1.0, minQty: 5, maxQty: 8 },\n      { itemId: 'storm_crystal', chance: 0.6, minQty: 1, maxQty: 3 },\n      { itemId: 'prismatic_shard', chance: 0.2, minQty: 1, maxQty: 2 },\n    ],\n    arenaWidth: 1400,\n    arenaHeight: 1000,\n    music: 'boss_storm',\n    weakness: 'earth',\n    xpReward: 5000,\n    isGateBoss: true,\n  },\n  {\n    id: 'world_serpent',\n    name: 'World Serpent',\n    title: 'The Corruption Source',\n    biome: 'edilas',\n    hp: 15000,\n    damage: 120,\n    defense: 35,\n    phases: [\n      { hpThreshold: 1.0, abilities: ['constrict', 'corruption_breath'], speed: 2.0, damageMult: 1.0, defenseMult: 1.0, description: 'Constricts and breathes corruption.' },\n      { hpThreshold: 0.8, abilities: ['constrict', 'corruption_breath', 'terrain_devour'], speed: 2.5, damageMult: 1.2, defenseMult: 1.0, description: 'Devours sections of the arena terrain.' },\n      { hpThreshold: 0.6, abilities: ['constrict', 'corruption_breath', 'terrain_devour', 'spawn_corruption'], speed: 3.0, damageMult: 1.4, defenseMult: 0.9, description: 'Spawns corruption nodes that must be destroyed.' },\n      { hpThreshold: 0.4, abilities: ['constrict', 'corruption_breath', 'terrain_devour', 'spawn_corruption', 'void_scream'], speed: 3.5, damageMult: 1.6, defenseMult: 0.8, description: 'Screams into the void, stunning and damaging everything.' },\n      { hpThreshold: 0.2, abilities: ['constrict', 'corruption_breath', 'terrain_devour', 'spawn_corruption', 'void_scream', 'world_end'], speed: 4.0, damageMult: 2.0, defenseMult: 0.6, description: 'Attempts to end the world — devastating ultimate attack.' },\n    ],\n    drops: [\n      { itemId: 'edilas_key', chance: 1.0, minQty: 1, maxQty: 1 },\n      { itemId: 'prismatic_shard', chance: 1.0, minQty: 3, maxQty: 5 },\n      { itemId: 'galaxy_soul', chance: 0.5, minQty: 1, maxQty: 3 },\n      { itemId: 'void_crown', chance: 0.3, minQty: 1, maxQty: 1 },\n    ],\n    arenaWidth: 1600,\n    arenaHeight: 1200,\n    music: 'boss_final',\n    xpReward: 15000,\n    isGateBoss: true,\n  },\n];\n\nexport const BOSS_DB = new Map<string, BossDef>();\nBOSSES.forEach(boss => BOSS_DB.set(boss.id, boss));\n\nexport const GATE_BOSSES = BOSSES.filter(b => b.isGateBoss);\n","/**\n * EDILAS (Phaser) - Boss Entity Controller\n * Multi-phase boss behavior with telegraph system, enrage mechanic,\n * and ECS integration via bitecs.\n */\n\nimport Phaser from 'phaser';\nimport { BossDef, BossPhase } from '../types/combat';\nimport { BOSS_DB } from '../data/bosses';\nimport { Position, Health, Combat, Velocity, BossTag, AI, AIState, Collider, EnemyTag, StatusEffects } from '../ecs/components';\nimport { createEnemy } from '../ecs/world';\nimport { addComponent, addEntity } from 'bitecs';\nimport { ecsWorld } from '../ecs/world';\nimport { BOSS_ENRAGE_TIME_MS, BOSS_ENRAGE_MULT } from '../config';\n\n/** Result of executing a boss ability — consumed by scene for damage/effects */\nexport interface AbilityResult {\n  abilityId: string;\n  targetX: number;\n  targetY: number;\n  damage: number;\n  radius: number;\n  type: 'aoe' | 'charge' | 'projectile' | 'summon';\n}\n\n// ---------------------------------------------------------------------------\n// Constants\n// ---------------------------------------------------------------------------\n\n/** Pause duration when transitioning between phases (ms) */\nconst PHASE_TRANSITION_PAUSE_MS = 300;\n\n/** Base telegraph delay before an attack lands (ms) */\nconst TELEGRAPH_DELAY_MIN_MS = 1000;\nconst TELEGRAPH_DELAY_MAX_MS = 2000;\n\n/** Minimum distance to player before switching to strafe behavior */\nconst ATTACK_RANGE = 80;\n\n/** How fast the boss strafes around the player (pixels/sec) */\nconst STRAFE_SPEED_MULT = 0.6;\n\n/** Cooldown between successive ability uses (ms) */\nconst ABILITY_COOLDOWN_MS = 2500;\n\n/** Speed multiplier applied during enrage */\nconst ENRAGE_SPEED_MULT = 1.3;\n\n/** Tint color for enraged bosses */\nconst ENRAGE_TINT = 0xff3333;\n\n// ---------------------------------------------------------------------------\n// Boss Controller\n// ---------------------------------------------------------------------------\n\nexport class BossController {\n  // --- ECS ---\n  private readonly eid: number;\n  private readonly def: BossDef;\n\n  // --- Phaser visual ---\n  private readonly scene: Phaser.Scene;\n  private sprite: Phaser.GameObjects.Image;\n\n  // --- Phase state ---\n  private phaseIndex: number = 0;\n  private phaseTransitionTimer: number = 0;\n  private inPhaseTransition: boolean = false;\n\n  // --- Enrage ---\n  private elapsedTime: number = 0;\n  private enraged: boolean = false;\n\n  // --- Defeat ---\n  private defeated: boolean = false;\n\n  // --- AI ---\n  private abilityIndex: number = 0;\n  private abilityCooldown: number = 0;\n  private telegraphTimer: number = 0;\n  private pendingAbility: string | null = null;\n  private pendingTargetX: number = 0;\n  private pendingTargetY: number = 0;\n\n  // --- Strafe ---\n  private strafeAngle: number = 0;\n\n  // --- Callbacks ---\n  private phaseChangeCbs: ((phaseIndex: number) => void)[] = [];\n  private defeatCbs: (() => void)[] = [];\n  private telegraphCbs: ((abilityId: string, targetX: number, targetY: number) => void)[] = [];\n  private abilityExecuteCbs: ((result: AbilityResult) => void)[] = [];\n\n  // -------------------------------------------------------------------------\n  // Constructor\n  // -------------------------------------------------------------------------\n\n  constructor(scene: Phaser.Scene, bossId: string, x: number, y: number) {\n    this.scene = scene;\n\n    const def = BOSS_DB.get(bossId);\n    if (!def) {\n      throw new Error(`Unknown boss ID: \"${bossId}\"`);\n    }\n    this.def = def;\n\n    // Create the ECS entity via the shared enemy factory, then augment with BossTag\n    this.eid = createEnemy(\n      x, y,\n      def.hp,\n      def.damage,\n      def.defense,\n      0, // Boss doesn't use standard aggro radius\n      bossId,\n    );\n\n    // Tag as boss in ECS\n    addComponent(ecsWorld, BossTag, this.eid);\n    AI.state[this.eid] = AIState.Special;\n\n    // Apply first phase stats\n    this.applyPhaseStats(0);\n\n    // Create the Phaser sprite for visual representation\n    this.sprite = scene.add.image(x, y, bossId);\n    this.sprite.setOrigin(0.5, 0.5);\n  }\n\n  // -------------------------------------------------------------------------\n  // Public API\n  // -------------------------------------------------------------------------\n\n  /** Main AI loop — call every frame with delta in ms */\n  update(delta: number, playerX: number, playerY: number): void {\n    if (this.defeated) return;\n\n    // --- Sync ECS position to sprite ---\n    const bossX = Position.x[this.eid];\n    const bossY = Position.y[this.eid];\n\n    // --- Phase transition pause ---\n    if (this.inPhaseTransition) {\n      this.phaseTransitionTimer -= delta;\n      if (this.phaseTransitionTimer <= 0) {\n        this.inPhaseTransition = false;\n      }\n      this.syncSprite();\n      return;\n    }\n\n    // --- Check defeat ---\n    if (Health.current[this.eid] <= 0) {\n      this.handleDefeat();\n      return;\n    }\n\n    // --- Check phase transition ---\n    this.checkPhaseTransition();\n\n    // --- Enrage timer ---\n    this.elapsedTime += delta;\n    if (!this.enraged && this.elapsedTime >= BOSS_ENRAGE_TIME_MS) {\n      this.activateEnrage();\n    }\n\n    // --- Telegraph handling ---\n    if (this.pendingAbility !== null) {\n      this.telegraphTimer -= delta;\n      if (this.telegraphTimer <= 0) {\n        // Telegraph done — execute the ability\n        this.executeAbility(this.pendingAbility, this.pendingTargetX, this.pendingTargetY);\n        this.pendingAbility = null;\n      }\n      // While telegraphing, boss doesn't move\n      this.syncSprite();\n      return;\n    }\n\n    // --- Ability cooldown ---\n    this.abilityCooldown -= delta;\n\n    // --- Movement AI ---\n    const dx = playerX - bossX;\n    const dy = playerY - bossY;\n    const distToPlayer = Math.sqrt(dx * dx + dy * dy);\n\n    const phase = this.getCurrentPhase();\n    let moveSpeed = phase.speed * 60; // Convert speed factor to pixels/sec\n    if (this.enraged) {\n      moveSpeed *= ENRAGE_SPEED_MULT;\n    }\n\n    const deltaSeconds = delta / 1000;\n\n    if (distToPlayer > ATTACK_RANGE) {\n      // Move toward the player\n      const nx = dx / distToPlayer;\n      const ny = dy / distToPlayer;\n      Position.x[this.eid] = bossX + nx * moveSpeed * deltaSeconds;\n      Position.y[this.eid] = bossY + ny * moveSpeed * deltaSeconds;\n      Velocity.vx[this.eid] = nx * moveSpeed;\n      Velocity.vy[this.eid] = ny * moveSpeed;\n    } else {\n      // In attack range — strafe around the player\n      this.strafeAngle += deltaSeconds * 1.5;\n      const strafeSpeed = moveSpeed * STRAFE_SPEED_MULT;\n      const sx = Math.cos(this.strafeAngle) * strafeSpeed * deltaSeconds;\n      const sy = Math.sin(this.strafeAngle) * strafeSpeed * deltaSeconds;\n      Position.x[this.eid] = bossX + sx;\n      Position.y[this.eid] = bossY + sy;\n      Velocity.vx[this.eid] = sx / deltaSeconds;\n      Velocity.vy[this.eid] = sy / deltaSeconds;\n\n      // --- Choose and telegraph an ability ---\n      if (this.abilityCooldown <= 0 && phase.abilities.length > 0) {\n        this.startTelegraph(playerX, playerY);\n      }\n    }\n\n    // --- Clamp boss to arena bounds ---\n    const halfW = this.def.arenaWidth / 2;\n    const halfH = this.def.arenaHeight / 2;\n    // Assuming arena is centered at the boss's spawn (home) position\n    const homeX = AI.homeX[this.eid];\n    const homeY = AI.homeY[this.eid];\n    Position.x[this.eid] = Math.max(homeX - halfW, Math.min(homeX + halfW, Position.x[this.eid]));\n    Position.y[this.eid] = Math.max(homeY - halfH, Math.min(homeY + halfH, Position.y[this.eid]));\n\n    this.syncSprite();\n  }\n\n  getEid(): number {\n    return this.eid;\n  }\n\n  getDef(): BossDef {\n    return this.def;\n  }\n\n  getCurrentPhase(): BossPhase {\n    return this.def.phases[this.phaseIndex];\n  }\n\n  getPhaseIndex(): number {\n    return this.phaseIndex;\n  }\n\n  getHealthPercent(): number {\n    const max = Health.max[this.eid];\n    if (max <= 0) return 0;\n    return Health.current[this.eid] / max;\n  }\n\n  isEnraged(): boolean {\n    return this.enraged;\n  }\n\n  isDefeated(): boolean {\n    return this.defeated;\n  }\n\n  getSprite(): Phaser.GameObjects.Image {\n    return this.sprite;\n  }\n\n  // --- Event registration ---\n\n  onPhaseChange(cb: (phaseIndex: number) => void): void {\n    this.phaseChangeCbs.push(cb);\n  }\n\n  onDefeat(cb: () => void): void {\n    this.defeatCbs.push(cb);\n  }\n\n  onTelegraph(cb: (abilityId: string, targetX: number, targetY: number) => void): void {\n    this.telegraphCbs.push(cb);\n  }\n\n  onAbilityExecute(cb: (result: AbilityResult) => void): void {\n    this.abilityExecuteCbs.push(cb);\n  }\n\n  // --- Ability Execution ---\n\n  /**\n   * Execute a boss ability. Called when telegraph timer expires.\n   * Notifies the scene via callbacks so it can apply damage and spawn effects.\n   */\n  executeAbility(abilityName: string, targetX: number, targetY: number): void {\n    const bossX = Position.x[this.eid];\n    const bossY = Position.y[this.eid];\n    const baseDmg = Combat.damage[this.eid];\n\n    const normalized = abilityName.toLowerCase().replace(/[^a-z_]/g, '');\n\n    let result: AbilityResult;\n\n    if (normalized.includes('slam') || normalized.includes('ground')) {\n      // Ground slam — AoE at boss position\n      result = {\n        abilityId: abilityName,\n        targetX: bossX,\n        targetY: bossY,\n        damage: baseDmg * 1.5,\n        radius: 80,\n        type: 'aoe',\n      };\n    } else if (normalized.includes('charge') || normalized.includes('rush') || normalized.includes('dash')) {\n      // Charge — boss dashes toward player\n      const dx = targetX - bossX;\n      const dy = targetY - bossY;\n      const dist = Math.sqrt(dx * dx + dy * dy);\n      if (dist > 0) {\n        const speed = 400;\n        Position.x[this.eid] = bossX + (dx / dist) * Math.min(dist, speed * 0.3);\n        Position.y[this.eid] = bossY + (dy / dist) * Math.min(dist, speed * 0.3);\n      }\n      result = {\n        abilityId: abilityName,\n        targetX: Position.x[this.eid],\n        targetY: Position.y[this.eid],\n        damage: baseDmg * 1.2,\n        radius: 40,\n        type: 'charge',\n      };\n      this.syncSprite();\n    } else if (normalized.includes('projectile') || normalized.includes('fireball') || normalized.includes('bolt') || normalized.includes('spit')) {\n      // Projectile — spawn toward player\n      result = {\n        abilityId: abilityName,\n        targetX,\n        targetY,\n        damage: baseDmg * 0.8,\n        radius: 16,\n        type: 'projectile',\n      };\n    } else if (normalized.includes('summon') || normalized.includes('spawn') || normalized.includes('minion')) {\n      // Summon 2-3 minions\n      const count = 2 + Math.floor(Math.random() * 2);\n      for (let i = 0; i < count; i++) {\n        const offsetX = (Math.random() - 0.5) * 120;\n        const offsetY = (Math.random() - 0.5) * 120;\n        createEnemy(\n          bossX + offsetX, bossY + offsetY,\n          Math.round(Health.max[this.eid] * 0.1),\n          Math.round(baseDmg * 0.4),\n          Math.round(Combat.defense[this.eid] * 0.3),\n          80,\n        );\n      }\n      result = {\n        abilityId: abilityName,\n        targetX: bossX,\n        targetY: bossY,\n        damage: 0,\n        radius: 0,\n        type: 'summon',\n      };\n    } else {\n      // Default: AoE nova from boss center\n      result = {\n        abilityId: abilityName,\n        targetX: bossX,\n        targetY: bossY,\n        damage: baseDmg * 1.3,\n        radius: 100,\n        type: 'aoe',\n      };\n    }\n\n    // Notify scene\n    for (const cb of this.abilityExecuteCbs) {\n      cb(result);\n    }\n  }\n\n  // --- Cleanup ---\n\n  destroy(): void {\n    this.sprite.destroy();\n    this.phaseChangeCbs.length = 0;\n    this.defeatCbs.length = 0;\n    this.telegraphCbs.length = 0;\n    this.abilityExecuteCbs.length = 0;\n  }\n\n  // -------------------------------------------------------------------------\n  // Internal\n  // -------------------------------------------------------------------------\n\n  /** Check if HP has crossed a phase threshold and transition if needed */\n  private checkPhaseTransition(): void {\n    const hpPercent = this.getHealthPercent();\n    const phases = this.def.phases;\n\n    // Find the highest-index phase whose threshold the current HP is at or below\n    for (let i = phases.length - 1; i > this.phaseIndex; i--) {\n      if (hpPercent <= phases[i].hpThreshold) {\n        this.transitionToPhase(i);\n        return;\n      }\n    }\n\n    // Also check the next phase in sequence\n    const nextIndex = this.phaseIndex + 1;\n    if (nextIndex < phases.length && hpPercent <= phases[nextIndex].hpThreshold) {\n      this.transitionToPhase(nextIndex);\n    }\n  }\n\n  /** Transition to a new boss phase */\n  private transitionToPhase(newIndex: number): void {\n    if (newIndex === this.phaseIndex) return;\n\n    this.phaseIndex = newIndex;\n    this.inPhaseTransition = true;\n    this.phaseTransitionTimer = PHASE_TRANSITION_PAUSE_MS;\n    this.abilityIndex = 0;\n    this.abilityCooldown = 0;\n\n    // Apply the new phase multipliers to ECS components\n    this.applyPhaseStats(newIndex);\n\n    // Notify listeners\n    for (const cb of this.phaseChangeCbs) {\n      cb(newIndex);\n    }\n  }\n\n  /** Apply a phase's damage/defense multipliers to the ECS entity */\n  private applyPhaseStats(phaseIdx: number): void {\n    const phase = this.def.phases[phaseIdx];\n    const baseDamage = this.def.damage;\n    const baseDefense = this.def.defense;\n\n    let damageMult = phase.damageMult;\n    let defenseMult = phase.defenseMult;\n\n    // Stack enrage multipliers if already enraged\n    if (this.enraged) {\n      damageMult *= BOSS_ENRAGE_MULT;\n    }\n\n    Combat.damage[this.eid] = baseDamage * damageMult;\n    Combat.defense[this.eid] = baseDefense * defenseMult;\n  }\n\n  /** Activate enrage mode */\n  private activateEnrage(): void {\n    this.enraged = true;\n\n    // Re-apply phase stats with enrage multiplier\n    this.applyPhaseStats(this.phaseIndex);\n\n    // Visual feedback: tint sprite red\n    this.sprite.setTint(ENRAGE_TINT);\n  }\n\n  /** Handle boss defeat */\n  private handleDefeat(): void {\n    this.defeated = true;\n    Health.current[this.eid] = 0;\n    AI.state[this.eid] = AIState.Dead;\n    Velocity.vx[this.eid] = 0;\n    Velocity.vy[this.eid] = 0;\n\n    // Visual: fade out or play death animation\n    this.sprite.setAlpha(0.5);\n\n    // Notify listeners\n    for (const cb of this.defeatCbs) {\n      cb();\n    }\n  }\n\n  /** Begin telegraph for the next ability in the cycle */\n  private startTelegraph(playerX: number, playerY: number): void {\n    const phase = this.getCurrentPhase();\n    if (phase.abilities.length === 0) return;\n\n    // Cycle through abilities\n    const abilityId = phase.abilities[this.abilityIndex % phase.abilities.length];\n    this.abilityIndex++;\n\n    // Determine telegraph delay (1-2 seconds)\n    const delay = TELEGRAPH_DELAY_MIN_MS + Math.random() * (TELEGRAPH_DELAY_MAX_MS - TELEGRAPH_DELAY_MIN_MS);\n\n    this.pendingAbility = abilityId;\n    this.pendingTargetX = playerX;\n    this.pendingTargetY = playerY;\n    this.telegraphTimer = delay;\n    this.abilityCooldown = ABILITY_COOLDOWN_MS;\n\n    // Notify scene to show the visual telegraph indicator (red zone, etc.)\n    for (const cb of this.telegraphCbs) {\n      cb(abilityId, playerX, playerY);\n    }\n  }\n\n  /** Sync the Phaser sprite position to the ECS Position component */\n  private syncSprite(): void {\n    this.sprite.setPosition(Position.x[this.eid], Position.y[this.eid]);\n  }\n}\n","import Phaser from 'phaser';\nimport { BossController, AbilityResult } from '../entities/Boss';\nimport { createProjectile } from '../ecs/world';\nimport { ecsWorld, createPlayer } from '../ecs/world';\nimport { Position, Velocity, Health, Stamina, Combat } from '../ecs/components';\nimport { movementSystem } from '../ecs/systems/MovementSystem';\nimport { combatSystem, flushDamageEvents } from '../ecs/systems/CombatSystem';\nimport { TILE_SIZE, PLAYER_SPEED, PLAYER_MAX_HP, PLAYER_MAX_STAMINA } from '../config';\nimport { BOSS_DB } from '../data/bosses';\nimport type { BossDef, BossPhase } from '../types/combat';\nimport { ParticleManager } from '../systems/ParticleManager';\nimport { AudioManager, SFX } from '../systems/AudioManager';\n\n// ---------------------------------------------------------------------------\n// Types\n// ---------------------------------------------------------------------------\n\ninterface BossArenaData {\n  bossId: string;\n  returnScene: string;\n  returnData?: Record<string, unknown>;\n}\n\n// ---------------------------------------------------------------------------\n// Constants\n// ---------------------------------------------------------------------------\n\nconst GRAVITY = 600;\nconst JUMP_VELOCITY = -400;\nconst GROUND_Y_OFFSET = 80; // distance from bottom of arena to ground surface\nconst PLATFORM_HEIGHT = 16;\nconst TELEGRAPH_DURATION_MS = 1500;\nconst VICTORY_DELAY_MS = 3000;\n\n// ---------------------------------------------------------------------------\n// Scene\n// ---------------------------------------------------------------------------\n\nexport class BossArenaScene extends Phaser.Scene {\n  // ---- Scene data ----\n  private bossId = '';\n  private returnScene = 'OverworldScene';\n  private returnData: Record<string, unknown> = {};\n\n  // ---- Boss ----\n  private bossController!: BossController;\n  private bossDef!: BossDef;\n\n  // ---- Player ----\n  private playerEid = -1;\n  private playerSprite!: Phaser.GameObjects.Image;\n  private isGrounded = false;\n\n  // ---- Arena geometry ----\n  private arenaWidth = 1000;\n  private arenaHeight = 800;\n  private groundY = 0; // Y coordinate of the ground surface (top of platform)\n  private platforms: Phaser.GameObjects.Rectangle[] = [];\n  private platformBounds: { x: number; y: number; w: number; h: number }[] = [];\n\n  // ---- Input ----\n  private wasd!: Record<string, Phaser.Input.Keyboard.Key>;\n  private keySpace!: Phaser.Input.Keyboard.Key;\n\n  // ---- HUD ----\n  private bossHPBar!: Phaser.GameObjects.Graphics;\n  private bossNameText!: Phaser.GameObjects.Text;\n  private bossPhaseText!: Phaser.GameObjects.Text;\n  private playerHPBar!: Phaser.GameObjects.Graphics;\n  private playerHPText!: Phaser.GameObjects.Text;\n  private playerStaminaBar!: Phaser.GameObjects.Graphics;\n\n  // ---- Telegraph ----\n  private telegraphs: { rect: Phaser.GameObjects.Rectangle; timer: number }[] = [];\n\n  // ---- Damage floaters ----\n  private damageTexts: Phaser.GameObjects.Text[] = [];\n\n  // ---- Particles ----\n  private particleManager!: ParticleManager;\n\n  // ---- Audio ----\n  private audioManager!: AudioManager;\n\n  // ---- State flags ----\n  private fightActive = false;\n  private victoryShown = false;\n\n  constructor() {\n    super({ key: 'BossArenaScene' });\n  }\n\n  // =======================================================================\n  // INIT\n  // =======================================================================\n\n  init(data: BossArenaData): void {\n    this.bossId = data.bossId ?? 'slime_king';\n    this.returnScene = data.returnScene ?? 'OverworldScene';\n    this.returnData = data.returnData ?? {};\n  }\n\n  // =======================================================================\n  // CREATE\n  // =======================================================================\n\n  create(data: BossArenaData): void {\n    // Apply init data again (Phaser may pass via create depending on version)\n    if (data?.bossId) this.bossId = data.bossId;\n    if (data?.returnScene) this.returnScene = data.returnScene;\n    if (data?.returnData) this.returnData = data.returnData;\n\n    this.cameras.main.setBackgroundColor('#1a0a0a');\n    this.cameras.main.fadeIn(500, 0, 0, 0);\n\n    // Reset state\n    this.telegraphs = [];\n    this.damageTexts = [];\n    this.platforms = [];\n    this.platformBounds = [];\n    this.fightActive = true;\n    this.victoryShown = false;\n\n    // Resolve boss definition\n    this.bossDef = BOSS_DB.get(this.bossId)!;\n    if (!this.bossDef) {\n      // Fallback: return to overworld if boss data is missing\n      this.scene.start(this.returnScene, this.returnData);\n      return;\n    }\n\n    this.arenaWidth = this.bossDef.arenaWidth;\n    this.arenaHeight = this.bossDef.arenaHeight;\n    this.groundY = this.arenaHeight - GROUND_Y_OFFSET;\n\n    // --- Particle system ---\n    this.particleManager = new ParticleManager(this);\n    this.audioManager = new AudioManager(this);\n    this.audioManager.playSFX(SFX.BOSS_INTRO);\n\n    // --- Build arena ---\n    this.buildArena();\n\n    // --- Spawn player (left side) ---\n    const playerX = 120;\n    const playerY = this.groundY - 20;\n    this.playerEid = createPlayer(playerX, playerY);\n    this.playerSprite = this.add.image(playerX, playerY, 'player').setDepth(5000);\n\n    // --- Spawn boss (right side) ---\n    const bossX = this.arenaWidth - 180;\n    const bossY = this.groundY - 30;\n    this.bossController = new BossController(this, this.bossId, bossX, bossY);\n\n    // --- Boss event hooks ---\n    this.bossController.onPhaseChange((phaseIndex: number) => {\n      this.onBossPhaseChange(phaseIndex);\n    });\n\n    this.bossController.onDefeat(() => {\n      this.onBossDefeated();\n    });\n\n    this.bossController.onTelegraph((abilityId: string, targetX: number, targetY: number) => {\n      this.showTelegraph(targetX, targetY, abilityId);\n    });\n\n    this.bossController.onAbilityExecute((result: AbilityResult) => {\n      this.handleBossAbility(result);\n    });\n\n    // --- Input ---\n    this.wasd = {\n      A: this.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.A),\n      D: this.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.D),\n    };\n    this.keySpace = this.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);\n\n    // Attack on left click\n    this.input.on('pointerdown', (pointer: Phaser.Input.Pointer) => {\n      if (pointer.leftButtonDown() && this.fightActive) {\n        this.performAttack();\n      }\n    });\n\n    // --- Camera ---\n    this.cameras.main.setBounds(0, 0, this.arenaWidth, this.arenaHeight);\n    this.cameras.main.startFollow(this.playerSprite, true, 0.15, 0.15);\n    // Zoom to fit arena width reasonably\n    const fitZoom = this.scale.width / this.arenaWidth;\n    this.cameras.main.setZoom(Math.max(fitZoom, 0.6));\n\n    // --- HUD ---\n    this.createHUD();\n  }\n\n  // =======================================================================\n  // UPDATE\n  // =======================================================================\n\n  update(_time: number, delta: number): void {\n    const dt = delta / 1000; // seconds\n\n    if (!this.fightActive) {\n      this.updateDamageTexts(dt);\n      return;\n    }\n\n    // ---- Player input (side-scroller) ----\n    this.processPlayerInput(dt);\n\n    // ---- Gravity ----\n    this.applyGravity(dt);\n\n    // ---- ECS systems ----\n    movementSystem(ecsWorld, dt);\n    combatSystem(ecsWorld, dt);\n\n    // ---- Boss AI ----\n    this.bossController.update(\n      delta, // BossController expects ms-based delta per its interface\n      Position.x[this.playerEid],\n      Position.y[this.playerEid],\n    );\n\n    // ---- Sync sprites ----\n    this.playerSprite.setPosition(Position.x[this.playerEid], Position.y[this.playerEid]);\n\n    // ---- Arena bounds ----\n    this.clampToArena();\n\n    // ---- Telegraphs ----\n    this.updateTelegraphs(dt);\n\n    // ---- Damage events ----\n    this.processDamageEvents();\n    this.updateDamageTexts(dt);\n\n    // ---- Particles ----\n    const cam = this.cameras.main;\n    this.particleManager.update(dt, cam.scrollX, cam.scrollY, cam.width / cam.zoom, cam.height / cam.zoom);\n\n    // ---- HUD ----\n    this.updateHUD();\n  }\n\n  // =======================================================================\n  // ARENA CONSTRUCTION\n  // =======================================================================\n\n  private buildArena(): void {\n    const g = this.add.graphics().setDepth(0);\n\n    // Arena background gradient (dark to darker at bottom)\n    g.fillStyle(0x1a0a0a, 1);\n    g.fillRect(0, 0, this.arenaWidth, this.arenaHeight);\n\n    // Ground platform (full width)\n    g.fillStyle(0x444444, 1);\n    g.fillRect(0, this.groundY, this.arenaWidth, GROUND_Y_OFFSET);\n    // Ground surface line\n    g.lineStyle(2, 0x666666, 1);\n    g.lineBetween(0, this.groundY, this.arenaWidth, this.groundY);\n\n    // Elevated platforms for dodging\n    const platformConfigs = [\n      { x: this.arenaWidth * 0.2, y: this.groundY - 140, w: 160 },\n      { x: this.arenaWidth * 0.5, y: this.groundY - 200, w: 140 },\n      { x: this.arenaWidth * 0.75, y: this.groundY - 120, w: 150 },\n    ];\n\n    for (const pc of platformConfigs) {\n      g.fillStyle(0x555555, 1);\n      g.fillRect(pc.x - pc.w / 2, pc.y, pc.w, PLATFORM_HEIGHT);\n      g.lineStyle(1, 0x777777, 1);\n      g.lineBetween(pc.x - pc.w / 2, pc.y, pc.x + pc.w / 2, pc.y);\n\n      const rect = this.add.rectangle(pc.x, pc.y + PLATFORM_HEIGHT / 2, pc.w, PLATFORM_HEIGHT)\n        .setVisible(false);\n      this.platforms.push(rect);\n      this.platformBounds.push({\n        x: pc.x - pc.w / 2,\n        y: pc.y,\n        w: pc.w,\n        h: PLATFORM_HEIGHT,\n      });\n    }\n\n    // Arena walls (decorative vertical lines)\n    g.lineStyle(3, 0x333333, 0.5);\n    g.lineBetween(0, 0, 0, this.arenaHeight);\n    g.lineBetween(this.arenaWidth, 0, this.arenaWidth, this.arenaHeight);\n  }\n\n  // =======================================================================\n  // INPUT\n  // =======================================================================\n\n  private processPlayerInput(_dt: number): void {\n    let dx = 0;\n    if (this.wasd.A.isDown) dx -= 1;\n    if (this.wasd.D.isDown) dx += 1;\n\n    Velocity.vx[this.playerEid] = dx * PLAYER_SPEED;\n\n    // Jump\n    if (Phaser.Input.Keyboard.JustDown(this.keySpace) && this.isGrounded) {\n      Velocity.vy[this.playerEid] = JUMP_VELOCITY;\n      this.isGrounded = false;\n    }\n\n    // Flip sprite\n    if (dx < 0) this.playerSprite.setFlipX(true);\n    else if (dx > 0) this.playerSprite.setFlipX(false);\n  }\n\n  // =======================================================================\n  // PHYSICS\n  // =======================================================================\n\n  private applyGravity(dt: number): void {\n    const eid = this.playerEid;\n\n    // Apply gravity to vertical velocity\n    Velocity.vy[eid] += GRAVITY * dt;\n\n    // Ground collision\n    const predictedY = Position.y[eid] + Velocity.vy[eid] * dt;\n\n    // Check ground\n    if (predictedY >= this.groundY && Velocity.vy[eid] > 0) {\n      Position.y[eid] = this.groundY;\n      Velocity.vy[eid] = 0;\n      this.isGrounded = true;\n      return;\n    }\n\n    // Check elevated platforms (only when falling down)\n    if (Velocity.vy[eid] > 0) {\n      const px = Position.x[eid];\n      const prevY = Position.y[eid];\n\n      for (const pb of this.platformBounds) {\n        // Player is above platform and will cross it this frame\n        if (\n          px >= pb.x && px <= pb.x + pb.w &&\n          prevY <= pb.y && predictedY >= pb.y\n        ) {\n          Position.y[eid] = pb.y;\n          Velocity.vy[eid] = 0;\n          this.isGrounded = true;\n          return;\n        }\n      }\n    }\n\n    // Not grounded if still in the air\n    if (Position.y[this.playerEid] < this.groundY) {\n      // Check if standing on a platform\n      let onPlatform = false;\n      const px = Position.x[eid];\n      const py = Position.y[eid];\n      for (const pb of this.platformBounds) {\n        if (px >= pb.x && px <= pb.x + pb.w && Math.abs(py - pb.y) < 2) {\n          onPlatform = true;\n          break;\n        }\n      }\n      if (!onPlatform) {\n        this.isGrounded = false;\n      }\n    }\n  }\n\n  private clampToArena(): void {\n    const eid = this.playerEid;\n    const margin = 8;\n\n    if (Position.x[eid] < margin) {\n      Position.x[eid] = margin;\n      Velocity.vx[eid] = 0;\n    }\n    if (Position.x[eid] > this.arenaWidth - margin) {\n      Position.x[eid] = this.arenaWidth - margin;\n      Velocity.vx[eid] = 0;\n    }\n    if (Position.y[eid] < margin) {\n      Position.y[eid] = margin;\n      Velocity.vy[eid] = 0;\n    }\n    if (Position.y[eid] > this.groundY) {\n      Position.y[eid] = this.groundY;\n      Velocity.vy[eid] = 0;\n      this.isGrounded = true;\n    }\n\n    this.playerSprite.setPosition(Position.x[eid], Position.y[eid]);\n  }\n\n  // =======================================================================\n  // ATTACK\n  // =======================================================================\n\n  private performAttack(): void {\n    const eid = this.playerEid;\n    if (Combat.attackCooldown[eid] > 0) return;\n\n    // Reset cooldown\n    Combat.attackCooldown[eid] = 1.0 / Combat.attackSpeed[eid];\n\n    // Simple melee range check against boss\n    const bossEid = this.bossController.getEid();\n    const dx = Position.x[bossEid] - Position.x[eid];\n    const dy = Position.y[bossEid] - Position.y[eid];\n    const dist = Math.sqrt(dx * dx + dy * dy);\n    const attackRange = 48;\n\n    if (dist <= attackRange) {\n      const isCrit = Math.random() < Combat.critChance[eid];\n      const critMult = isCrit ? Combat.critMult[eid] : 1.0;\n      const rawDmg = Combat.damage[eid] * critMult;\n      const finalDmg = Math.max(1, rawDmg - Combat.defense[bossEid]);\n\n      Health.current[bossEid] -= finalDmg;\n\n      // Damage floater on boss\n      const color = isCrit ? '#ffaa00' : '#ffffff';\n      const text = this.add.text(Position.x[bossEid], Position.y[bossEid] - 20,\n        `${Math.round(finalDmg)}${isCrit ? '!' : ''}`, {\n          fontFamily: 'monospace',\n          fontSize: isCrit ? '16px' : '12px',\n          color,\n          fontStyle: isCrit ? 'bold' : 'normal',\n        }).setOrigin(0.5).setDepth(9500);\n\n      (text as unknown as Record<string, number>).__life = 0;\n      this.damageTexts.push(text);\n    }\n\n    // Visual feedback: brief slash effect\n    const slashX = Position.x[eid] + (this.playerSprite.flipX ? -24 : 24);\n    const slash = this.add.rectangle(slashX, Position.y[eid], 20, 4, 0xffffff, 0.8)\n      .setDepth(5500);\n    this.tweens.add({\n      targets: slash,\n      alpha: 0,\n      scaleX: 2,\n      duration: 150,\n      onComplete: () => slash.destroy(),\n    });\n  }\n\n  // =======================================================================\n  // TELEGRAPH\n  // =======================================================================\n\n  private showTelegraph(targetX: number, targetY: number, _abilityId: string): void {\n    const width = 80;\n    const height = this.arenaHeight; // Full-height warning column\n\n    const rect = this.add.rectangle(targetX, this.arenaHeight / 2, width, height, 0xff0000, 0.15)\n      .setDepth(3000);\n\n    // Pulsing warning\n    this.tweens.add({\n      targets: rect,\n      alpha: { from: 0.1, to: 0.35 },\n      duration: 300,\n      yoyo: true,\n      repeat: Math.floor(TELEGRAPH_DURATION_MS / 600),\n    });\n\n    // Border outline\n    const border = this.add.rectangle(targetX, this.arenaHeight / 2, width, height)\n      .setStrokeStyle(2, 0xff0000, 0.6)\n      .setFillStyle(0, 0) // transparent fill\n      .setDepth(3001);\n\n    this.telegraphs.push({ rect, timer: TELEGRAPH_DURATION_MS / 1000 });\n    this.telegraphs.push({ rect: border, timer: TELEGRAPH_DURATION_MS / 1000 });\n  }\n\n  /** Handle boss ability landing — apply damage to player if in range */\n  private handleBossAbility(result: AbilityResult): void {\n    const px = Position.x[this.playerEid];\n    const py = Position.y[this.playerEid];\n\n    if (result.type === 'projectile') {\n      // Spawn a projectile toward player\n      const bossEid = this.bossController.getEid();\n      const bx = Position.x[bossEid];\n      const by = Position.y[bossEid];\n      const dx = result.targetX - bx;\n      const dy = result.targetY - by;\n      const dist = Math.sqrt(dx * dx + dy * dy) || 1;\n      const speed = 300;\n      createProjectile(bx, by, (dx / dist) * speed, (dy / dist) * speed, result.damage, bossEid);\n      this.audioManager.playSFX(SFX.BOW_SHOOT);\n      return;\n    }\n\n    if (result.type === 'summon') {\n      // Minions were already spawned by Boss.executeAbility\n      this.cameras.main.shake(100, 0.005);\n      this.particleManager.emit('sparks', result.targetX, result.targetY);\n      return;\n    }\n\n    // AoE / charge — check if player is in range\n    const dx = px - result.targetX;\n    const dy = py - result.targetY;\n    const dist = Math.sqrt(dx * dx + dy * dy);\n\n    if (dist <= result.radius) {\n      Health.current[this.playerEid] -= result.damage;\n      this.cameras.main.shake(200, 0.015);\n      this.particleManager.emit('blood', px, py);\n      this.audioManager.playSFX(SFX.PLAYER_HIT);\n    }\n\n    // Visual: impact flash at target\n    const flash = this.add.circle(result.targetX, result.targetY, result.radius, 0xff4400, 0.3)\n      .setDepth(5000);\n    this.tweens.add({\n      targets: flash,\n      alpha: 0,\n      scaleX: 1.5,\n      scaleY: 1.5,\n      duration: 300,\n      onComplete: () => flash.destroy(),\n    });\n\n    // Camera shake for slam/charge\n    if (result.type === 'aoe') {\n      this.cameras.main.shake(250, 0.02);\n    } else if (result.type === 'charge') {\n      this.cameras.main.shake(150, 0.01);\n    }\n  }\n\n  private updateTelegraphs(dt: number): void {\n    for (let i = this.telegraphs.length - 1; i >= 0; i--) {\n      this.telegraphs[i].timer -= dt;\n      if (this.telegraphs[i].timer <= 0) {\n        this.telegraphs[i].rect.destroy();\n        this.telegraphs.splice(i, 1);\n      }\n    }\n  }\n\n  // =======================================================================\n  // BOSS EVENTS\n  // =======================================================================\n\n  private onBossPhaseChange(phaseIndex: number): void {\n    const phase = this.bossDef.phases[phaseIndex];\n    if (!phase) return;\n\n    // Screen flash\n    this.cameras.main.flash(300, 200, 50, 50);\n\n    // Phase transition text\n    const phaseText = this.add.text(\n      this.scale.width / 2,\n      this.scale.height / 2 - 40,\n      `Phase ${phaseIndex + 1}`,\n      {\n        fontFamily: 'monospace',\n        fontSize: '28px',\n        color: '#ff4444',\n        fontStyle: 'bold',\n        backgroundColor: '#000000cc',\n        padding: { x: 12, y: 6 },\n      },\n    ).setOrigin(0.5).setScrollFactor(0).setDepth(9999);\n\n    const descText = this.add.text(\n      this.scale.width / 2,\n      this.scale.height / 2,\n      phase.description,\n      {\n        fontFamily: 'monospace',\n        fontSize: '14px',\n        color: '#ffaaaa',\n        backgroundColor: '#000000cc',\n        padding: { x: 8, y: 4 },\n        wordWrap: { width: 500 },\n        align: 'center',\n      },\n    ).setOrigin(0.5).setScrollFactor(0).setDepth(9999);\n\n    // Fade out after 2 seconds\n    this.tweens.add({\n      targets: [phaseText, descText],\n      alpha: 0,\n      delay: 1500,\n      duration: 500,\n      onComplete: () => {\n        phaseText.destroy();\n        descText.destroy();\n      },\n    });\n  }\n\n  private onBossDefeated(): void {\n    if (this.victoryShown) return;\n    this.victoryShown = true;\n    this.fightActive = false;\n\n    // Freeze player\n    Velocity.vx[this.playerEid] = 0;\n    Velocity.vy[this.playerEid] = 0;\n\n    // Screen flash + victory particles\n    this.cameras.main.flash(500, 255, 255, 200);\n    const px = Position.x[this.playerEid];\n    const py = Position.y[this.playerEid];\n    this.particleManager.emit('levelUp', px, py);\n\n    // Victory text\n    const victoryText = this.add.text(\n      this.scale.width / 2,\n      this.scale.height / 2 - 60,\n      'BOSS DEFEATED',\n      {\n        fontFamily: 'monospace',\n        fontSize: '36px',\n        color: '#ffdd44',\n        fontStyle: 'bold',\n        backgroundColor: '#000000dd',\n        padding: { x: 16, y: 10 },\n      },\n    ).setOrigin(0.5).setScrollFactor(0).setDepth(10000);\n\n    // Boss name\n    this.add.text(\n      this.scale.width / 2,\n      this.scale.height / 2 - 15,\n      `${this.bossDef.name} - ${this.bossDef.title}`,\n      {\n        fontFamily: 'monospace',\n        fontSize: '16px',\n        color: '#ffffff',\n        backgroundColor: '#000000cc',\n        padding: { x: 10, y: 4 },\n      },\n    ).setOrigin(0.5).setScrollFactor(0).setDepth(10000);\n\n    // Loot drops display + add to inventory\n    const inventoryManager = this.registry.get('inventoryManager');\n    const lootLines: string[] = [];\n    for (const drop of this.bossDef.drops) {\n      if (Math.random() <= drop.chance) {\n        const qty = Phaser.Math.Between(drop.minQty, drop.maxQty);\n        lootLines.push(`  ${drop.itemId} x${qty}`);\n        if (inventoryManager) {\n          inventoryManager.addItem(drop.itemId, qty);\n        }\n      }\n    }\n\n    if (lootLines.length > 0) {\n      this.add.text(\n        this.scale.width / 2,\n        this.scale.height / 2 + 20,\n        `Loot:\\n${lootLines.join('\\n')}`,\n        {\n          fontFamily: 'monospace',\n          fontSize: '13px',\n          color: '#aaffaa',\n          backgroundColor: '#000000cc',\n          padding: { x: 10, y: 6 },\n          align: 'center',\n        },\n      ).setOrigin(0.5, 0).setScrollFactor(0).setDepth(10000);\n    }\n\n    // XP reward\n    this.add.text(\n      this.scale.width / 2,\n      this.scale.height / 2 + 20 + lootLines.length * 16 + 20,\n      `+${this.bossDef.xpReward} XP`,\n      {\n        fontFamily: 'monospace',\n        fontSize: '18px',\n        color: '#44ddff',\n        fontStyle: 'bold',\n        backgroundColor: '#000000cc',\n        padding: { x: 8, y: 4 },\n      },\n    ).setOrigin(0.5, 0).setScrollFactor(0).setDepth(10000);\n\n    // ---- Wire rewards to game systems ----\n\n    // XP → combat skill + weapon mastery\n    const skillManager = this.registry.get('skillManager');\n    if (skillManager) {\n      skillManager.addXP('combat', this.bossDef.xpReward);\n    }\n    const weaponMasteryManager = this.registry.get('weaponMasteryManager');\n    if (weaponMasteryManager) {\n      weaponMasteryManager.addXP('sword', Math.floor(this.bossDef.xpReward / 2));\n    }\n\n    // Story progression (chapter gate tracking)\n    const storyManager = this.registry.get('storyManager');\n    if (storyManager) {\n      storyManager.defeatBoss(this.bossId);\n    }\n\n    // Imprint unlock from boss power absorption\n    const imprintManager = this.registry.get('imprintManager') as { unlockFromBoss(bossId: string): boolean } | undefined;\n    if (imprintManager) {\n      imprintManager.unlockFromBoss(this.bossId);\n    }\n\n    // Quest objective tracking\n    const questManager = this.registry.get('questManager');\n    if (questManager) {\n      questManager.updateObjective('kill', this.bossId, 1);\n    }\n\n    // Return to caller scene after delay\n    this.time.delayedCall(VICTORY_DELAY_MS, () => {\n      this.cleanUp();\n      this.scene.start(this.returnScene, this.returnData);\n    });\n  }\n\n  // =======================================================================\n  // HUD\n  // =======================================================================\n\n  private createHUD(): void {\n    const hudDepth = 9800;\n    const barWidth = 400;\n    const barHeight = 16;\n    const barX = (this.scale.width - barWidth) / 2;\n    const barY = 20;\n\n    // Boss name + title\n    this.bossNameText = this.add.text(this.scale.width / 2, 6, `${this.bossDef.name}`, {\n      fontFamily: 'monospace',\n      fontSize: '14px',\n      color: '#ff6666',\n      fontStyle: 'bold',\n    }).setOrigin(0.5, 0).setScrollFactor(0).setDepth(hudDepth);\n\n    // Boss HP bar\n    this.bossHPBar = this.add.graphics().setScrollFactor(0).setDepth(hudDepth);\n\n    // Phase markers text\n    this.bossPhaseText = this.add.text(barX + barWidth + 8, barY, '', {\n      fontFamily: 'monospace',\n      fontSize: '11px',\n      color: '#ffaaaa',\n    }).setScrollFactor(0).setDepth(hudDepth);\n\n    // Player HP bar (bottom-left)\n    this.playerHPBar = this.add.graphics().setScrollFactor(0).setDepth(hudDepth);\n    this.playerHPText = this.add.text(12, this.scale.height - 50, '', {\n      fontFamily: 'monospace',\n      fontSize: '11px',\n      color: '#ff8888',\n    }).setScrollFactor(0).setDepth(hudDepth);\n\n    // Player stamina bar\n    this.playerStaminaBar = this.add.graphics().setScrollFactor(0).setDepth(hudDepth);\n  }\n\n  private updateHUD(): void {\n    const barWidth = 400;\n    const barHeight = 16;\n    const barX = (this.scale.width - barWidth) / 2;\n    const barY = 24;\n\n    // ---- Boss HP ----\n    this.bossHPBar.clear();\n\n    // Background\n    this.bossHPBar.fillStyle(0x330000, 1);\n    this.bossHPBar.fillRect(barX, barY, barWidth, barHeight);\n\n    // Current HP\n    const bossHPPercent = Math.max(0, this.bossController.getHealthPercent());\n    const hpColor = this.bossController.isEnraged() ? 0xff2222 : 0xcc3333;\n    this.bossHPBar.fillStyle(hpColor, 1);\n    this.bossHPBar.fillRect(barX, barY, barWidth * bossHPPercent, barHeight);\n\n    // Phase threshold markers\n    for (const phase of this.bossDef.phases) {\n      if (phase.hpThreshold < 1.0) {\n        const markerX = barX + barWidth * phase.hpThreshold;\n        this.bossHPBar.lineStyle(2, 0xffff00, 0.7);\n        this.bossHPBar.lineBetween(markerX, barY, markerX, barY + barHeight);\n      }\n    }\n\n    // Border\n    this.bossHPBar.lineStyle(1, 0x666666, 1);\n    this.bossHPBar.strokeRect(barX, barY, barWidth, barHeight);\n\n    // Phase text\n    const currentPhase = this.bossController.getPhaseIndex();\n    this.bossPhaseText.setText(`P${currentPhase + 1}`);\n\n    // ---- Player HP ----\n    const playerBarW = 160;\n    const playerBarH = 12;\n    const playerBarX = 12;\n    const playerBarY = this.scale.height - 36;\n\n    this.playerHPBar.clear();\n\n    // Background\n    this.playerHPBar.fillStyle(0x330000, 1);\n    this.playerHPBar.fillRect(playerBarX, playerBarY, playerBarW, playerBarH);\n\n    // Current HP\n    const playerHP = Health.current[this.playerEid];\n    const playerMaxHP = Health.max[this.playerEid];\n    const playerHPPct = Math.max(0, playerHP / playerMaxHP);\n    const playerHPColor = playerHPPct > 0.5 ? 0x44cc44 : playerHPPct > 0.25 ? 0xcccc44 : 0xcc4444;\n    this.playerHPBar.fillStyle(playerHPColor, 1);\n    this.playerHPBar.fillRect(playerBarX, playerBarY, playerBarW * playerHPPct, playerBarH);\n\n    // Border\n    this.playerHPBar.lineStyle(1, 0x666666, 1);\n    this.playerHPBar.strokeRect(playerBarX, playerBarY, playerBarW, playerBarH);\n\n    this.playerHPText.setText(`HP: ${Math.ceil(playerHP)}/${playerMaxHP}`);\n\n    // ---- Player Stamina ----\n    const staminaBarY = playerBarY + playerBarH + 4;\n\n    this.playerStaminaBar.clear();\n\n    this.playerStaminaBar.fillStyle(0x002233, 1);\n    this.playerStaminaBar.fillRect(playerBarX, staminaBarY, playerBarW, playerBarH);\n\n    const stamCur = Stamina.current[this.playerEid];\n    const stamMax = Stamina.max[this.playerEid];\n    const stamPct = Math.max(0, stamCur / stamMax);\n    this.playerStaminaBar.fillStyle(0x3399cc, 1);\n    this.playerStaminaBar.fillRect(playerBarX, staminaBarY, playerBarW * stamPct, playerBarH);\n\n    this.playerStaminaBar.lineStyle(1, 0x666666, 1);\n    this.playerStaminaBar.strokeRect(playerBarX, staminaBarY, playerBarW, playerBarH);\n\n    // ---- Check player death ----\n    if (playerHP <= 0 && this.fightActive) {\n      this.onPlayerDefeated();\n    }\n  }\n\n  // =======================================================================\n  // DAMAGE EVENTS (from CombatSystem)\n  // =======================================================================\n\n  private processDamageEvents(): void {\n    const events = flushDamageEvents();\n    for (const ev of events) {\n      const color = ev.isCrit ? '#ffaa00' : '#ff4444';\n      const text = this.add.text(ev.x, ev.y - 12,\n        `${Math.round(ev.damage)}${ev.isCrit ? '!' : ''}`, {\n          fontFamily: 'monospace',\n          fontSize: ev.isCrit ? '14px' : '11px',\n          color,\n          fontStyle: ev.isCrit ? 'bold' : 'normal',\n        }).setOrigin(0.5).setDepth(9500);\n\n      (text as unknown as Record<string, number>).__life = 0;\n      this.damageTexts.push(text);\n\n      // Audio + camera shake\n      const isPlayerHit = ev.targetEid === this.playerEid;\n      if (isPlayerHit) {\n        this.audioManager.playSFX(SFX.PLAYER_HIT);\n        this.cameras.main.shake(150, 0.01);\n      } else {\n        this.audioManager.playSFX(ev.isCrit ? SFX.CRIT_HIT : SFX.ENEMY_HIT);\n        if (ev.isCrit) this.cameras.main.shake(100, 0.006);\n      }\n\n      // Combat particles\n      this.particleManager.emit('blood', ev.x, ev.y);\n      if (ev.isCrit) {\n        this.particleManager.emit('critFlash', ev.x, ev.y);\n      } else {\n        this.particleManager.emit('sparks', ev.x, ev.y);\n      }\n    }\n  }\n\n  private updateDamageTexts(dt: number): void {\n    for (let i = this.damageTexts.length - 1; i >= 0; i--) {\n      const t = this.damageTexts[i];\n      const rec = t as unknown as Record<string, number>;\n      rec.__life += dt;\n      t.y -= 30 * dt;\n      t.setAlpha(Math.max(0, 1 - rec.__life / 0.8));\n\n      if (rec.__life >= 0.8) {\n        t.destroy();\n        this.damageTexts.splice(i, 1);\n      }\n    }\n  }\n\n  // =======================================================================\n  // PLAYER DEATH\n  // =======================================================================\n\n  private onPlayerDefeated(): void {\n    this.fightActive = false;\n\n    // Freeze movement\n    Velocity.vx[this.playerEid] = 0;\n    Velocity.vy[this.playerEid] = 0;\n\n    this.cameras.main.flash(300, 200, 0, 0);\n\n    this.add.text(this.scale.width / 2, this.scale.height / 2, 'DEFEATED', {\n      fontFamily: 'monospace',\n      fontSize: '32px',\n      color: '#ff4444',\n      fontStyle: 'bold',\n      backgroundColor: '#000000dd',\n      padding: { x: 16, y: 10 },\n    }).setOrigin(0.5).setScrollFactor(0).setDepth(10000);\n\n    // Return to overworld after delay\n    this.time.delayedCall(VICTORY_DELAY_MS, () => {\n      this.cleanUp();\n      this.scene.start('OverworldScene');\n    });\n  }\n\n  // =======================================================================\n  // CLEANUP\n  // =======================================================================\n\n  private cleanUp(): void {\n    this.playerSprite?.destroy();\n    this.bossController?.destroy();\n    for (const t of this.telegraphs) t.rect?.destroy();\n    for (const t of this.damageTexts) t?.destroy();\n    this.telegraphs = [];\n    this.damageTexts = [];\n    this.bossHPBar?.destroy();\n    this.bossNameText?.destroy();\n    this.bossPhaseText?.destroy();\n    this.playerHPBar?.destroy();\n    this.playerHPText?.destroy();\n    this.playerStaminaBar?.destroy();\n    this.particleManager?.destroy();\n  }\n}\n","import Phaser from 'phaser';\nimport { TILE_SIZE, INTERACTION_RADIUS } from '../config';\nimport { SettlementManager, Settlement, BuiltBuilding, BUILDING_TYPES, BUILDING_COSTS } from '../systems/SettlementManager';\nimport { NPCS, NPCDef } from '../data/npcs';\nimport { DialogueScene } from './DialogueScene';\n\ninterface SettlementSceneData {\n  settlementId: string;\n}\n\n/** Color map for building categories */\nconst BUILDING_COLORS: Record<string, number> = {\n  farm: 0x44aa44, mine: 0x888866, lumber_mill: 0x886644,\n  workshop: 0xaaaa44, forge: 0xcc6622, alchemy_lab: 0x8844cc,\n  kitchen: 0xcc8844, fishing_dock: 0x4488cc,\n  wall: 0x666666, guard_tower: 0x888888, ballista: 0xaa4444, barracks: 0x664444,\n  town_hall: 0xccaa44, market: 0xaacc44, inn: 0xcc8866,\n  library: 0x4466cc, temple: 0xcccc88, warehouse: 0x666644,\n};\n\n/** Map building type IDs to building texture keys */\nconst BUILDING_TEXTURES: Record<string, string> = {\n  town_hall: 'building_castle',\n  barracks: 'building_barracks',\n  inn: 'building',\n  market: 'building',\n  library: 'building',\n  temple: 'building',\n  warehouse: 'building',\n  farm: 'building',\n  mine: 'building',\n  lumber_mill: 'building',\n  workshop: 'building',\n  forge: 'building',\n  alchemy_lab: 'building',\n  kitchen: 'building',\n  fishing_dock: 'building',\n  wall: 'building',\n  guard_tower: 'building',\n  ballista: 'building',\n  stable: 'building_stable',\n  archery_range: 'building_archery',\n};\n\n/** NPC sprite placed in the settlement */\ninterface SettlementNPC {\n  def: NPCDef;\n  sprite: Phaser.GameObjects.Image;\n  nameLabel: Phaser.GameObjects.Text;\n  x: number;\n  y: number;\n}\n\n/**\n * Settlement management scene — 5x3 building grid with sprites,\n * NPC placement, E-key dialogue, production dashboard, and build menu.\n */\nexport class SettlementScene extends Phaser.Scene {\n  private settlementId = '';\n  private settlementManager!: SettlementManager;\n  private settlement: Settlement | null = null;\n\n  // Grid rendering\n  private gridGraphics!: Phaser.GameObjects.Graphics;\n  private gridStartX = 0;\n  private gridStartY = 0;\n  private gridCols = 5;\n  private gridRows = 3;\n  private plotW = 96;\n  private plotH = 96;\n\n  // Building sprites\n  private buildingSprites: Phaser.GameObjects.Image[] = [];\n\n  // NPCs\n  private settlementNPCs: SettlementNPC[] = [];\n  private keyE!: Phaser.Input.Keyboard.Key;\n\n  // Camera panning\n  private pannable = false;\n  private worldContainer!: Phaser.GameObjects.Container;\n\n  // UI elements\n  private titleText!: Phaser.GameObjects.Text;\n  private infoText!: Phaser.GameObjects.Text;\n  private moraleText!: Phaser.GameObjects.Text;\n  private tierText!: Phaser.GameObjects.Text;\n  private productionText!: Phaser.GameObjects.Text;\n  private buildMenuTexts: Phaser.GameObjects.Text[] = [];\n  private buildingLabels: Phaser.GameObjects.Text[] = [];\n  private statusText!: Phaser.GameObjects.Text;\n\n  // Build mode\n  private buildMode = false;\n  private buildMenuVisible = false;\n  private selectedBuildType: string | null = null;\n\n  // Building context menu\n  private contextMenuTexts: Phaser.GameObjects.Text[] = [];\n  private contextMenuBg: Phaser.GameObjects.Graphics | null = null;\n\n  constructor() {\n    super({ key: 'SettlementScene' });\n  }\n\n  init(data: SettlementSceneData): void {\n    this.settlementId = data.settlementId ?? '';\n  }\n\n  create(): void {\n    this.cameras.main.setBackgroundColor('#1a1a0a');\n    const { width, height } = this.cameras.main;\n\n    // Reset state\n    this.buildMode = false;\n    this.buildMenuVisible = false;\n    this.selectedBuildType = null;\n    this.buildMenuTexts = [];\n    this.buildingLabels = [];\n    this.buildingSprites = [];\n    this.settlementNPCs = [];\n\n    // Get settlement manager from registry\n    this.settlementManager = this.registry.get('settlementManager') as SettlementManager;\n\n    // World container for scrolling/panning\n    this.worldContainer = this.add.container(0, 0);\n\n    // Title\n    this.titleText = this.add.text(width / 2, 16, 'Settlement', {\n      fontFamily: 'monospace', fontSize: '18px', color: '#ffcc00', fontStyle: 'bold',\n    }).setOrigin(0.5, 0).setScrollFactor(0).setDepth(100);\n\n    // Tier + morale display (top-left)\n    this.tierText = this.add.text(16, 16, '', {\n      fontFamily: 'monospace', fontSize: '11px', color: '#88ccff',\n    }).setScrollFactor(0).setDepth(100);\n\n    this.moraleText = this.add.text(16, 32, '', {\n      fontFamily: 'monospace', fontSize: '11px', color: '#88ff88',\n    }).setScrollFactor(0).setDepth(100);\n\n    // Grid position — centered\n    const totalGridW = this.gridCols * this.plotW;\n    const totalGridH = this.gridRows * this.plotH;\n    this.gridStartX = (width - totalGridW) / 2;\n    this.gridStartY = 70;\n    this.gridGraphics = this.add.graphics();\n    this.worldContainer.add(this.gridGraphics);\n\n    // Production panel (right side)\n    this.productionText = this.add.text(width - 200, 60, '', {\n      fontFamily: 'monospace', fontSize: '10px', color: '#ccccaa',\n      wordWrap: { width: 180 },\n    }).setScrollFactor(0).setDepth(100);\n\n    // Info panel (bottom)\n    this.infoText = this.add.text(20, height - 100, '', {\n      fontFamily: 'monospace', fontSize: '11px', color: '#aaaaaa',\n      wordWrap: { width: width - 40 },\n    }).setScrollFactor(0).setDepth(100);\n\n    // Status text (bottom-center)\n    this.statusText = this.add.text(width / 2, height - 50, '', {\n      fontFamily: 'monospace', fontSize: '10px', color: '#ffcc00',\n    }).setOrigin(0.5).setScrollFactor(0).setDepth(101);\n\n    // Leave button\n    const leaveBtn = this.add.text(width / 2, height - 20, '[ Leave Settlement ]', {\n      fontFamily: 'monospace', fontSize: '14px', color: '#ff8888',\n      backgroundColor: '#221111ee',\n      padding: { x: 16, y: 6 },\n    }).setOrigin(0.5).setScrollFactor(0).setDepth(100)\n      .setInteractive({ useHandCursor: true });\n    leaveBtn.on('pointerover', () => leaveBtn.setColor('#ffffff'));\n    leaveBtn.on('pointerout', () => leaveBtn.setColor('#ff8888'));\n    leaveBtn.on('pointerdown', () => this.leaveSettlement());\n\n    // Controls text\n    this.add.text(width / 2, height - 60, '[E] Talk | [B] Build | [ESC] Leave', {\n      fontFamily: 'monospace', fontSize: '9px', color: '#555555',\n    }).setOrigin(0.5, 1).setScrollFactor(0).setDepth(100);\n\n    // Input\n    this.keyE = this.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.E);\n\n    this.input.keyboard!.on('keydown-ESC', () => {\n      if (this.buildMenuVisible) {\n        this.closeBuildMenu();\n      } else {\n        this.leaveSettlement();\n      }\n    });\n\n    this.input.keyboard!.on('keydown-B', () => {\n      if (this.buildMenuVisible) {\n        this.closeBuildMenu();\n      } else {\n        this.openBuildMenu();\n      }\n    });\n\n    // Grid click handler\n    this.input.on('pointerdown', (pointer: Phaser.Input.Pointer) => {\n      if (this.buildMenuVisible) return;\n      if (this.selectedBuildType && this.settlement) {\n        this.placeBuildingAt(pointer.x, pointer.y);\n      } else if (this.contextMenuTexts.length > 0) {\n        // Close context menu if clicking outside it\n        this.closeBuildingContextMenu();\n      }\n    });\n\n    // Enable camera panning with arrow keys\n    const cursors = this.input.keyboard!.createCursorKeys();\n    this.pannable = true;\n\n    // Launch DialogueScene as overlay\n    if (!this.scene.isActive('DialogueScene')) {\n      this.scene.launch('DialogueScene');\n    }\n\n    // Load and render\n    this.loadSettlement();\n    this.renderSettlement();\n    this.placeNPCs();\n  }\n\n  private leaveSettlement(): void {\n    this.cameras.main.fadeOut(300, 0, 0, 0);\n    this.time.delayedCall(350, () => {\n      this.cleanUp();\n      this.scene.start('OverworldScene');\n    });\n  }\n\n  private loadSettlement(): void {\n    if (!this.settlementManager || !this.settlementId) {\n      this.titleText.setText('No Settlement');\n      this.infoText.setText('Find a settlement site in the overworld to begin.');\n      return;\n    }\n\n    this.settlement = this.settlementManager.getSettlement(this.settlementId);\n\n    if (!this.settlement) {\n      // Auto-found if not yet created\n      this.settlementManager.foundSettlement(this.settlementId, this.settlementId);\n      this.settlement = this.settlementManager.getSettlement(this.settlementId);\n    }\n\n    if (this.settlement) {\n      this.titleText.setText(this.settlement.name);\n    }\n  }\n\n  private renderSettlement(): void {\n    this.drawGrid();\n    this.drawBuildings();\n    this.updateInfoPanel();\n  }\n\n  private drawGrid(): void {\n    this.gridGraphics.clear();\n\n    for (let row = 0; row < this.gridRows; row++) {\n      for (let col = 0; col < this.gridCols; col++) {\n        const x = this.gridStartX + col * this.plotW;\n        const y = this.gridStartY + row * this.plotH;\n\n        this.gridGraphics.fillStyle(0x222211, 0.6);\n        this.gridGraphics.fillRect(x, y, this.plotW - 2, this.plotH - 2);\n        this.gridGraphics.lineStyle(1, 0x444422, 0.4);\n        this.gridGraphics.strokeRect(x, y, this.plotW - 2, this.plotH - 2);\n      }\n    }\n  }\n\n  private drawBuildings(): void {\n    // Clear old labels and sprites\n    for (const label of this.buildingLabels) label.destroy();\n    this.buildingLabels = [];\n    for (const sprite of this.buildingSprites) sprite.destroy();\n    this.buildingSprites = [];\n\n    if (!this.settlement) return;\n\n    for (const building of this.settlement.buildings) {\n      // Clamp position to our 5x3 grid\n      const col = Math.min(building.position.x, this.gridCols - 1);\n      const row = Math.min(building.position.y, this.gridRows - 1);\n      const cx = this.gridStartX + col * this.plotW + this.plotW / 2;\n      const cy = this.gridStartY + row * this.plotH + this.plotH / 2;\n\n      if (building.buildTimeRemaining > 0) {\n        // Under construction\n        this.gridGraphics.fillStyle(0x553300, 0.5);\n        this.gridGraphics.fillRect(\n          this.gridStartX + col * this.plotW + 4,\n          this.gridStartY + row * this.plotH + 4,\n          this.plotW - 10, this.plotH - 10,\n        );\n        const label = this.add.text(cx, cy, 'Building...', {\n          fontFamily: 'monospace', fontSize: '9px', color: '#ffaa44',\n        }).setOrigin(0.5).setDepth(50);\n        this.buildingLabels.push(label);\n        this.worldContainer.add(label);\n        continue;\n      }\n\n      // Building sprite — clickable for context menu\n      const textureKey = BUILDING_TEXTURES[building.typeId] ?? 'building';\n      const bIdx = this.settlement!.buildings.indexOf(building);\n      const sprite = this.add.image(cx, cy - 10, textureKey)\n        .setScale(0.5)\n        .setDepth(40)\n        .setInteractive({ useHandCursor: true });\n      sprite.on('pointerdown', () => this.openBuildingContextMenu(bIdx, cx, cy));\n      this.buildingSprites.push(sprite);\n      this.worldContainer.add(sprite);\n\n      // Building name label\n      const nameLabel = this.add.text(cx, cy + 30,\n        `${building.typeId.replace(/_/g, ' ')} (T${building.tier})  W:${building.workersAssigned}`, {\n        fontFamily: 'monospace', fontSize: '8px', color: '#999999',\n      }).setOrigin(0.5, 0).setDepth(50);\n      this.buildingLabels.push(nameLabel);\n      this.worldContainer.add(nameLabel);\n\n      // Tier indicator\n      if (building.tier > 1) {\n        const tierLabel = this.add.text(cx + 30, cy - 30, `T${building.tier}`, {\n          fontFamily: 'monospace', fontSize: '8px', color: '#ffcc00',\n        }).setDepth(50);\n        this.buildingLabels.push(tierLabel);\n        this.worldContainer.add(tierLabel);\n      }\n\n      // NPC assignment indicator\n      if (building.assignedNpcId) {\n        const npcLabel = this.add.text(cx - 30, cy + 20, 'NPC', {\n          fontFamily: 'monospace', fontSize: '7px', color: '#44ff44',\n        }).setDepth(50);\n        this.buildingLabels.push(npcLabel);\n        this.worldContainer.add(npcLabel);\n      }\n    }\n  }\n\n  private placeNPCs(): void {\n    // Clear old NPC sprites\n    for (const npc of this.settlementNPCs) {\n      npc.sprite.destroy();\n      npc.nameLabel.destroy();\n    }\n    this.settlementNPCs = [];\n\n    // Find city ID from settlement ID\n    const cityId = this.settlementId.replace('_settlement', '');\n\n    // Filter NPCs that belong to this city\n    const npcsHere = NPCS.filter(n => n.homeCity === cityId);\n\n    // Place NPCs along the bottom row, spaced below the grid\n    const startX = this.gridStartX + 48;\n    const npcY = this.gridStartY + this.gridRows * this.plotH + 50;\n\n    for (let i = 0; i < npcsHere.length; i++) {\n      const def = npcsHere[i];\n      const x = startX + i * 80;\n      const y = npcY;\n\n      const sprite = this.add.image(x, y, 'npc')\n        .setScale(1.5)\n        .setDepth(60);\n      this.worldContainer.add(sprite);\n\n      const nameLabel = this.add.text(x, y - 20, def.name, {\n        fontFamily: 'monospace', fontSize: '9px', color: '#7dd3fc',\n        stroke: '#000000', strokeThickness: 2,\n      }).setOrigin(0.5).setDepth(61);\n      this.worldContainer.add(nameLabel);\n\n      this.settlementNPCs.push({ def, sprite, nameLabel, x, y });\n    }\n  }\n\n  private updateInfoPanel(): void {\n    if (!this.settlement) return;\n\n    // Tier\n    const tierName = this.settlementManager.getSettlementTier(this.settlementId);\n    this.tierText.setText(`Tier: ${tierName} (${this.settlement.buildings.length} buildings)`);\n\n    // Morale\n    const morale = this.settlementManager.getMorale(this.settlementId);\n    const moraleColor = morale >= 70 ? '#88ff88' : morale >= 40 ? '#ffcc00' : '#ff4444';\n    this.moraleText.setText(`Morale: ${Math.round(morale)}`);\n    this.moraleText.setColor(moraleColor);\n\n    // Production\n    const production = this.settlementManager.getProduction(this.settlementId);\n    const prodEntries = Object.entries(production);\n    if (prodEntries.length > 0) {\n      const prodLines = ['-- Production/day --', ...prodEntries.map(([res, amt]) => `${res}: ${amt}`)];\n      this.productionText.setText(prodLines.join('\\n'));\n    } else {\n      this.productionText.setText('-- No Production --\\nBuild production\\nbuildings to start.');\n    }\n\n    // Workers\n    this.infoText.setText(\n      `Workers: ${this.settlement.availableWorkers} available | ` +\n      `NPCs: ${this.settlement.recruitedNpcs.length} recruited | ` +\n      `Trade routes: ${this.settlement.tradeRoutes.length}`,\n    );\n  }\n\n  // =========================================================================\n  // NPC INTERACTION\n  // =========================================================================\n\n  private checkNPCInteraction(): void {\n    // Use mouse position as \"player cursor\" in settlement view\n    const pointer = this.input.activePointer;\n    const px = pointer.worldX;\n    const py = pointer.worldY;\n\n    for (const npc of this.settlementNPCs) {\n      const dist = Phaser.Math.Distance.Between(px, py, npc.x, npc.y);\n      if (dist <= INTERACTION_RADIUS * 2) {\n        // Open dialogue with this NPC\n        const dialogueScene = this.scene.get('DialogueScene') as DialogueScene;\n        if (dialogueScene) {\n          this.scene.pause();\n          dialogueScene.openDialogue(npc.def);\n        }\n        return;\n      }\n    }\n  }\n\n  // =========================================================================\n  // BUILD MENU\n  // =========================================================================\n\n  private openBuildMenu(): void {\n    this.buildMenuVisible = true;\n    this.selectedBuildType = null;\n\n    const { height } = this.cameras.main;\n    const allTypes = [\n      ...BUILDING_TYPES.production,\n      ...BUILDING_TYPES.defense,\n      ...BUILDING_TYPES.civic,\n    ];\n\n    let y = 60;\n    const x = 16;\n\n    const header = this.add.text(x, y, '-- BUILD MENU --', {\n      fontFamily: 'monospace', fontSize: '11px', color: '#ffcc00', fontStyle: 'bold',\n    }).setScrollFactor(0).setDepth(200);\n    this.buildMenuTexts.push(header);\n    y += 18;\n\n    for (const typeId of allTypes) {\n      if (y > height - 60) break;\n\n      const costs = BUILDING_COSTS[typeId];\n      const costStr = costs?.[0]\n        ? `${costs[0].gold}g`\n        : '???';\n\n      const color = BUILDING_COLORS[typeId] ?? 0xcccccc;\n      const colorHex = '#' + color.toString(16).padStart(6, '0');\n\n      const text = this.add.text(x, y, `${typeId.replace(/_/g, ' ')}  (${costStr})`, {\n        fontFamily: 'monospace', fontSize: '10px', color: colorHex,\n      }).setScrollFactor(0).setDepth(200);\n\n      text.setInteractive({ useHandCursor: true });\n      text.on('pointerover', () => text.setColor('#ffffff'));\n      text.on('pointerout', () => text.setColor(colorHex));\n      text.on('pointerdown', () => {\n        this.selectedBuildType = typeId;\n        this.closeBuildMenu();\n        this.statusText.setText(`Click grid to place: ${typeId.replace(/_/g, ' ')}`);\n      });\n\n      this.buildMenuTexts.push(text);\n      y += 16;\n    }\n  }\n\n  private closeBuildMenu(): void {\n    this.buildMenuVisible = false;\n    for (const t of this.buildMenuTexts) t.destroy();\n    this.buildMenuTexts = [];\n  }\n\n  private placeBuildingAt(pointerX: number, pointerY: number): void {\n    if (!this.selectedBuildType || !this.settlement) return;\n\n    // Convert screen coords to grid coords\n    const col = Math.floor((pointerX - this.gridStartX) / this.plotW);\n    const row = Math.floor((pointerY - this.gridStartY) / this.plotH);\n\n    if (col < 0 || col >= this.gridCols || row < 0 || row >= this.gridRows) {\n      this.statusText.setText('Click inside the grid!');\n      return;\n    }\n\n    // Check if cell is already occupied\n    const occupied = this.settlement.buildings.some(\n      b => b.position.x === col && b.position.y === row,\n    );\n    if (occupied) {\n      this.statusText.setText('Cell already occupied!');\n      return;\n    }\n\n    // Try to build\n    const success = this.settlementManager.buildBuilding(this.settlementId, this.selectedBuildType);\n\n    if (success) {\n      // Update position of the last placed building to our grid position\n      const lastBuilding = this.settlement.buildings[this.settlement.buildings.length - 1];\n      if (lastBuilding) {\n        lastBuilding.position = { x: col, y: row };\n      }\n\n      this.statusText.setText(`Built ${this.selectedBuildType.replace(/_/g, ' ')}!`);\n      this.selectedBuildType = null;\n      this.renderSettlement();\n    } else {\n      this.statusText.setText('Cannot build! Check resources/space.');\n    }\n  }\n\n  // =========================================================================\n  // BUILDING CONTEXT MENU\n  // =========================================================================\n\n  private openBuildingContextMenu(buildingIndex: number, cx: number, cy: number): void {\n    if (this.buildMenuVisible || this.selectedBuildType) return;\n    this.closeBuildingContextMenu();\n\n    if (!this.settlement) return;\n    const building = this.settlement.buildings[buildingIndex];\n    if (!building || building.buildTimeRemaining > 0) return;\n\n    const menuX = cx + 40;\n    const menuY = cy - 40;\n    const menuW = 160;\n    const options: { label: string; color: string; action: () => void }[] = [];\n\n    // Upgrade option\n    const canUpgrade = building.tier < 3;\n    const tierCosts = BUILDING_COSTS[building.typeId];\n    const nextCost = canUpgrade && tierCosts ? tierCosts[building.tier] : null;\n    const upgradeCostStr = nextCost ? `${nextCost.gold}g` : '';\n\n    if (canUpgrade) {\n      options.push({\n        label: `Upgrade to T${building.tier + 1} (${upgradeCostStr})`,\n        color: '#ffcc00',\n        action: () => {\n          const ok = this.settlementManager.upgradeBuildingExpanded(this.settlementId, buildingIndex);\n          this.statusText.setText(ok\n            ? `Upgraded ${building.typeId.replace(/_/g, ' ')} to T${building.tier}!`\n            : 'Cannot upgrade — check resources.');\n          this.closeBuildingContextMenu();\n          this.renderSettlement();\n        },\n      });\n    }\n\n    // Assign worker\n    const maxWorkers = building.tier;\n    if (building.workersAssigned < maxWorkers && this.settlement.availableWorkers > 0) {\n      options.push({\n        label: `Assign Worker (${building.workersAssigned}/${maxWorkers})`,\n        color: '#88ff88',\n        action: () => {\n          const ok = this.settlementManager.assignWorker(this.settlementId, buildingIndex);\n          this.statusText.setText(ok ? 'Worker assigned!' : 'No workers available.');\n          this.closeBuildingContextMenu();\n          this.renderSettlement();\n          this.updateInfoPanel();\n        },\n      });\n    }\n\n    // Remove worker\n    if (building.workersAssigned > 0) {\n      options.push({\n        label: `Remove Worker (${building.workersAssigned}/${maxWorkers})`,\n        color: '#ff8888',\n        action: () => {\n          const ok = this.settlementManager.removeWorker(this.settlementId, buildingIndex);\n          this.statusText.setText(ok ? 'Worker removed.' : 'No workers to remove.');\n          this.closeBuildingContextMenu();\n          this.renderSettlement();\n          this.updateInfoPanel();\n        },\n      });\n    }\n\n    // Close option\n    options.push({\n      label: 'Close',\n      color: '#888888',\n      action: () => this.closeBuildingContextMenu(),\n    });\n\n    if (options.length === 0) return;\n\n    // Background panel\n    const menuH = 24 + options.length * 20;\n    this.contextMenuBg = this.add.graphics();\n    this.contextMenuBg.fillStyle(0x111111, 0.9);\n    this.contextMenuBg.fillRoundedRect(menuX - 4, menuY - 4, menuW + 8, menuH + 8, 4);\n    this.contextMenuBg.lineStyle(1, 0x7dd3fc, 0.4);\n    this.contextMenuBg.strokeRoundedRect(menuX - 4, menuY - 4, menuW + 8, menuH + 8, 4);\n    this.contextMenuBg.setDepth(150);\n    this.worldContainer.add(this.contextMenuBg);\n\n    // Title\n    const title = this.add.text(menuX, menuY, building.typeId.replace(/_/g, ' ').toUpperCase(), {\n      fontFamily: 'monospace', fontSize: '9px', color: '#7dd3fc', fontStyle: 'bold',\n    }).setDepth(151);\n    this.contextMenuTexts.push(title);\n    this.worldContainer.add(title);\n\n    let oy = menuY + 18;\n    for (const opt of options) {\n      const txt = this.add.text(menuX + 4, oy, opt.label, {\n        fontFamily: 'monospace', fontSize: '10px', color: opt.color,\n      }).setInteractive({ useHandCursor: true }).setDepth(151);\n      txt.on('pointerover', () => txt.setColor('#ffffff'));\n      txt.on('pointerout', () => txt.setColor(opt.color));\n      txt.on('pointerdown', opt.action);\n      this.contextMenuTexts.push(txt);\n      this.worldContainer.add(txt);\n      oy += 20;\n    }\n  }\n\n  private closeBuildingContextMenu(): void {\n    for (const t of this.contextMenuTexts) t.destroy();\n    this.contextMenuTexts = [];\n    if (this.contextMenuBg) {\n      this.contextMenuBg.destroy();\n      this.contextMenuBg = null;\n    }\n  }\n\n  // =========================================================================\n  // CLEANUP\n  // =========================================================================\n\n  private cleanUp(): void {\n    this.closeBuildingContextMenu();\n    for (const npc of this.settlementNPCs) {\n      npc.sprite.destroy();\n      npc.nameLabel.destroy();\n    }\n    this.settlementNPCs = [];\n    for (const s of this.buildingSprites) s.destroy();\n    this.buildingSprites = [];\n    for (const l of this.buildingLabels) l.destroy();\n    this.buildingLabels = [];\n  }\n\n  update(): void {\n    // Settlement scene is mostly event-driven (clicks)\n    // Refresh settlement ref each frame in case it changed\n    if (this.settlementManager && this.settlementId) {\n      this.settlement = this.settlementManager.getSettlement(this.settlementId);\n    }\n\n    // E key → NPC interaction\n    if (Phaser.Input.Keyboard.JustDown(this.keyE)) {\n      this.checkNPCInteraction();\n    }\n\n    // Simple camera panning with arrow keys\n    const speed = 3;\n    if (this.input.keyboard!.addKey('LEFT').isDown) {\n      this.worldContainer.x += speed;\n    }\n    if (this.input.keyboard!.addKey('RIGHT').isDown) {\n      this.worldContainer.x -= speed;\n    }\n    if (this.input.keyboard!.addKey('UP').isDown) {\n      this.worldContainer.y += speed;\n    }\n    if (this.input.keyboard!.addKey('DOWN').isDown) {\n      this.worldContainer.y -= speed;\n    }\n  }\n}\n","import Phaser from 'phaser';\n\n/**\n * Abstract base class for all UI panels in EDILAS.\n *\n * Provides a dark semi-transparent background with a rounded-rect border,\n * a title bar, and a close [X] button. Subclasses implement `buildContent()`\n * and `refresh()` to populate the panel.\n */\nexport abstract class UIPanel {\n  protected scene: Phaser.Scene;\n  protected container: Phaser.GameObjects.Container;\n  protected background: Phaser.GameObjects.Graphics;\n  protected titleText: Phaser.GameObjects.Text;\n  protected closeBtn: Phaser.GameObjects.Text;\n  protected isOpen = false;\n  private contentBuilt = false;\n  protected panelX: number;\n  protected panelY: number;\n  protected panelW: number;\n  protected panelH: number;\n\n  constructor(\n    scene: Phaser.Scene,\n    x: number,\n    y: number,\n    w: number,\n    h: number,\n    title: string,\n  ) {\n    this.scene = scene;\n    this.panelX = x;\n    this.panelY = y;\n    this.panelW = w;\n    this.panelH = h;\n\n    // Container that holds every visual element of this panel\n    this.container = scene.add.container(x, y);\n    this.container.setDepth(8000);\n    this.container.setScrollFactor(0);\n    this.container.setVisible(false);\n\n    // --- Background ---\n    this.background = scene.add.graphics();\n    // Fill\n    this.background.fillStyle(0x111118, 0.92);\n    this.background.fillRoundedRect(0, 0, w, h, 8);\n    // Border\n    this.background.lineStyle(2, 0x7dd3fc, 0.7);\n    this.background.strokeRoundedRect(0, 0, w, h, 8);\n    // Title-bar separator\n    this.background.lineStyle(1, 0x7dd3fc, 0.35);\n    this.background.lineBetween(8, 32, w - 8, 32);\n    this.container.add(this.background);\n\n    // --- Title text ---\n    this.titleText = scene.add.text(12, 6, title, {\n      fontFamily: 'monospace',\n      fontSize: '14px',\n      color: '#7dd3fc',\n      fontStyle: 'bold',\n    });\n    this.container.add(this.titleText);\n\n    // --- Close [X] button ---\n    this.closeBtn = scene.add.text(w - 24, 6, 'X', {\n      fontFamily: 'monospace',\n      fontSize: '14px',\n      color: '#ff6666',\n      fontStyle: 'bold',\n    });\n    this.closeBtn.setInteractive({ useHandCursor: true });\n    this.closeBtn.on('pointerover', () => this.closeBtn.setColor('#ff9999'));\n    this.closeBtn.on('pointerout', () => this.closeBtn.setColor('#ff6666'));\n    this.closeBtn.on('pointerdown', () => this.close());\n    this.container.add(this.closeBtn);\n\n    // NOTE: buildContent() is NOT called here. Child class field initialisers\n    // run AFTER super() returns, so calling an abstract method in the parent\n    // constructor would access uninitialised child fields. Content is built\n    // lazily on the first open() call instead.\n  }\n\n  // ---------------------------------------------------------------------------\n  // Open / Close\n  // ---------------------------------------------------------------------------\n\n  open(): void {\n    if (this.isOpen) return;\n    if (!this.contentBuilt) {\n      this.buildContent();\n      this.contentBuilt = true;\n    }\n    this.isOpen = true;\n    this.refresh();\n    this.container.setVisible(true);\n    this.container.setAlpha(0);\n    this.scene.tweens.add({\n      targets: this.container,\n      alpha: 1,\n      duration: 120,\n      ease: 'Cubic.easeOut',\n    });\n  }\n\n  close(): void {\n    if (!this.isOpen) return;\n    this.isOpen = false;\n    this.scene.tweens.add({\n      targets: this.container,\n      alpha: 0,\n      duration: 80,\n      ease: 'Cubic.easeIn',\n      onComplete: () => this.container.setVisible(false),\n    });\n  }\n\n  toggle(): void {\n    if (this.isOpen) this.close();\n    else this.open();\n  }\n\n  getIsOpen(): boolean {\n    return this.isOpen;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Abstract hooks for subclasses\n  // ---------------------------------------------------------------------------\n\n  /** Called once during construction. Add persistent visuals here. */\n  protected abstract buildContent(): void;\n\n  /** Called every time the panel opens. Update dynamic data here. */\n  abstract refresh(): void;\n\n  // ---------------------------------------------------------------------------\n  // Cleanup\n  // ---------------------------------------------------------------------------\n\n  destroy(): void {\n    this.container.destroy(true);\n  }\n}\n","import Phaser from 'phaser';\nimport { UIPanel } from './UIBase';\nimport { InventoryManager, InventorySlot } from '../systems/InventoryManager';\nimport { EquipmentManager, EquipSlot, EquippedItem } from '../systems/EquipmentManager';\nimport { ITEM_DB } from '../data/items';\nimport { AnyItemDef, WeaponDef, ArmorDef, FoodDef, PotionDef } from '../types/items';\nimport { RARITY_TIERS } from '../config';\n\n// ---------------------------------------------------------------------------\n// Constants\n// ---------------------------------------------------------------------------\n\nconst SLOT_SIZE = 40;\nconst SLOT_GAP = 4;\nconst INV_COLS = 6;\nconst INV_ROWS = 6;\nconst INV_TOTAL = INV_COLS * INV_ROWS; // 36\n\nconst EQUIP_SLOTS: { slot: EquipSlot; label: string }[] = [\n  { slot: 'weapon', label: 'Weapon' },\n  { slot: 'shield', label: 'Shield' },\n  { slot: 'head', label: 'Head' },\n  { slot: 'chest', label: 'Chest' },\n  { slot: 'legs', label: 'Legs' },\n  { slot: 'feet', label: 'Feet' },\n  { slot: 'hands', label: 'Hands' },\n  { slot: 'ring1', label: 'Ring 1' },\n  { slot: 'ring2', label: 'Ring 2' },\n  { slot: 'necklace', label: 'Necklace' },\n];\n\nconst RARITY_NAMES = ['Common', 'Uncommon', 'Rare', 'Epic', 'Legendary', 'Mythic'];\nconst RARITY_COLORS = [0xffffff, 0x00ff00, 0x0088ff, 0xaa00ff, 0xff8800, 0xff0000];\nconst RARITY_HEX = ['#ffffff', '#00ff00', '#0088ff', '#aa00ff', '#ff8800', '#ff0000'];\n\nconst CATEGORY_COLORS: Record<string, number> = {\n  weapon: 0xcc3333,\n  armor: 0x3366cc,\n  tool: 0x999966,\n  seed: 0x33cc33,\n  crop: 0x66cc33,\n  food: 0xcc9933,\n  resource: 0x886633,\n  material: 0x777777,\n  fish: 0x3399cc,\n  potion: 0xcc33cc,\n  quest: 0xffcc00,\n  relic: 0xff6600,\n  bait: 0x66aa66,\n  furniture: 0x996633,\n  misc: 0x888888,\n};\n\n// ---------------------------------------------------------------------------\n// Inventory & Equipment UI Panel\n// ---------------------------------------------------------------------------\n\nexport class InventoryUI extends UIPanel {\n  // Inventory grid\n  private invSlotGraphics: Phaser.GameObjects.Graphics[] = [];\n  private invSlotIcons: Phaser.GameObjects.Graphics[] = [];\n  private invSlotCountTexts: Phaser.GameObjects.Text[] = [];\n  private invSlotHitAreas: Phaser.GameObjects.Rectangle[] = [];\n\n  // Equipment slots\n  private equipSlotGraphics: Phaser.GameObjects.Graphics[] = [];\n  private equipSlotIcons: Phaser.GameObjects.Graphics[] = [];\n  private equipSlotLabels: Phaser.GameObjects.Text[] = [];\n  private equipSlotHitAreas: Phaser.GameObjects.Rectangle[] = [];\n\n  // Tooltip\n  private tooltip: Phaser.GameObjects.Container;\n  private tooltipBg: Phaser.GameObjects.Graphics;\n  private tooltipTexts: Phaser.GameObjects.Text[] = [];\n\n  // Context menu\n  private contextMenu: Phaser.GameObjects.Container;\n  private contextBg: Phaser.GameObjects.Graphics;\n  private contextButtons: Phaser.GameObjects.Text[] = [];\n  private contextTarget: { type: 'inv' | 'equip'; index: number } | null = null;\n\n  // Sort button\n  private sortBtn!: Phaser.GameObjects.Text;\n\n  // Stats display\n  private statsText!: Phaser.GameObjects.Text;\n\n  constructor(scene: Phaser.Scene) {\n    // Center the panel; inventory grid on left, equipment on right\n    const panelW = 580;\n    const panelH = 420;\n    const px = Math.floor((scene.cameras.main.width - panelW) / 2);\n    const py = Math.floor((scene.cameras.main.height - panelH) / 2);\n    super(scene, px, py, panelW, panelH, 'Inventory & Equipment');\n\n    // Tooltip (created above context menu in depth)\n    this.tooltipBg = scene.add.graphics();\n    this.tooltip = scene.add.container(0, 0);\n    this.tooltip.setDepth(8500);\n    this.tooltip.setScrollFactor(0);\n    this.tooltip.setVisible(false);\n    this.tooltip.add(this.tooltipBg);\n\n    // Context menu\n    this.contextBg = scene.add.graphics();\n    this.contextMenu = scene.add.container(0, 0);\n    this.contextMenu.setDepth(8600);\n    this.contextMenu.setScrollFactor(0);\n    this.contextMenu.setVisible(false);\n    this.contextMenu.add(this.contextBg);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Build\n  // ---------------------------------------------------------------------------\n\n  protected buildContent(): void {\n    const ox = 14; // offset x inside panel\n    const oy = 42; // offset y (below title bar)\n\n    // --- Section label: Backpack ---\n    const backpackLabel = this.scene.add.text(ox, oy - 2, 'Backpack', {\n      fontFamily: 'monospace', fontSize: '11px', color: '#aaaaaa',\n    });\n    this.container.add(backpackLabel);\n\n    // --- Inventory grid ---\n    for (let row = 0; row < INV_ROWS; row++) {\n      for (let col = 0; col < INV_COLS; col++) {\n        const idx = row * INV_COLS + col;\n        const sx = ox + col * (SLOT_SIZE + SLOT_GAP);\n        const sy = oy + 16 + row * (SLOT_SIZE + SLOT_GAP);\n\n        // Slot background\n        const gfx = this.scene.add.graphics();\n        gfx.fillStyle(0x1a1a24, 0.9);\n        gfx.fillRoundedRect(sx, sy, SLOT_SIZE, SLOT_SIZE, 4);\n        gfx.lineStyle(1, 0x444466, 0.6);\n        gfx.strokeRoundedRect(sx, sy, SLOT_SIZE, SLOT_SIZE, 4);\n        this.container.add(gfx);\n        this.invSlotGraphics.push(gfx);\n\n        // Item icon placeholder\n        const icon = this.scene.add.graphics();\n        this.container.add(icon);\n        this.invSlotIcons.push(icon);\n\n        // Stack count\n        const countText = this.scene.add.text(sx + SLOT_SIZE - 4, sy + SLOT_SIZE - 4, '', {\n          fontFamily: 'monospace', fontSize: '9px', color: '#ffffff',\n          stroke: '#000000', strokeThickness: 2,\n        }).setOrigin(1, 1);\n        this.container.add(countText);\n        this.invSlotCountTexts.push(countText);\n\n        // Hit area for hover / click\n        const hit = this.scene.add.rectangle(\n          sx + SLOT_SIZE / 2, sy + SLOT_SIZE / 2, SLOT_SIZE, SLOT_SIZE,\n        ).setAlpha(0.001).setInteractive({ useHandCursor: true });\n        this.container.add(hit);\n        this.invSlotHitAreas.push(hit);\n\n        // Hover → tooltip\n        hit.on('pointerover', (_ptr: Phaser.Input.Pointer) => this.showInvTooltip(idx));\n        hit.on('pointermove', (ptr: Phaser.Input.Pointer) => this.moveTooltip(ptr));\n        hit.on('pointerout', () => this.hideTooltip());\n\n        // Right-click → context menu\n        hit.on('pointerdown', (ptr: Phaser.Input.Pointer) => {\n          if (ptr.rightButtonDown()) {\n            this.openContext('inv', idx, ptr);\n          }\n        });\n      }\n    }\n\n    // --- Equipment section (right side) ---\n    const eqOx = ox + INV_COLS * (SLOT_SIZE + SLOT_GAP) + 30;\n    const eqOy = oy;\n\n    const equipLabel = this.scene.add.text(eqOx, eqOy - 2, 'Equipment', {\n      fontFamily: 'monospace', fontSize: '11px', color: '#aaaaaa',\n    });\n    this.container.add(equipLabel);\n\n    for (let i = 0; i < EQUIP_SLOTS.length; i++) {\n      const col = i < 5 ? 0 : 1;\n      const row = i < 5 ? i : i - 5;\n      const sx = eqOx + col * (SLOT_SIZE + SLOT_GAP + 60);\n      const sy = eqOy + 16 + row * (SLOT_SIZE + SLOT_GAP);\n\n      // Label\n      const lbl = this.scene.add.text(sx + SLOT_SIZE + 4, sy + 12, EQUIP_SLOTS[i].label, {\n        fontFamily: 'monospace', fontSize: '9px', color: '#666688',\n      });\n      this.container.add(lbl);\n      this.equipSlotLabels.push(lbl);\n\n      // Slot background\n      const gfx = this.scene.add.graphics();\n      gfx.fillStyle(0x1a1a24, 0.9);\n      gfx.fillRoundedRect(sx, sy, SLOT_SIZE, SLOT_SIZE, 4);\n      gfx.lineStyle(1, 0x555577, 0.6);\n      gfx.strokeRoundedRect(sx, sy, SLOT_SIZE, SLOT_SIZE, 4);\n      this.container.add(gfx);\n      this.equipSlotGraphics.push(gfx);\n\n      // Icon placeholder\n      const icon = this.scene.add.graphics();\n      this.container.add(icon);\n      this.equipSlotIcons.push(icon);\n\n      // Hit area\n      const hit = this.scene.add.rectangle(\n        sx + SLOT_SIZE / 2, sy + SLOT_SIZE / 2, SLOT_SIZE, SLOT_SIZE,\n      ).setAlpha(0.001).setInteractive({ useHandCursor: true });\n      this.container.add(hit);\n      this.equipSlotHitAreas.push(hit);\n\n      hit.on('pointerover', () => this.showEquipTooltip(i));\n      hit.on('pointermove', (ptr: Phaser.Input.Pointer) => this.moveTooltip(ptr));\n      hit.on('pointerout', () => this.hideTooltip());\n      hit.on('pointerdown', (ptr: Phaser.Input.Pointer) => {\n        if (ptr.rightButtonDown()) {\n          this.openContext('equip', i, ptr);\n        }\n      });\n    }\n\n    // --- Sort button ---\n    this.sortBtn = this.scene.add.text(ox, oy + 16 + INV_ROWS * (SLOT_SIZE + SLOT_GAP) + 4, '[ Sort ]', {\n      fontFamily: 'monospace', fontSize: '11px', color: '#7dd3fc',\n    }).setInteractive({ useHandCursor: true });\n    this.sortBtn.on('pointerover', () => this.sortBtn.setColor('#aaddff'));\n    this.sortBtn.on('pointerout', () => this.sortBtn.setColor('#7dd3fc'));\n    this.sortBtn.on('pointerdown', () => {\n      const inv = this.getInventory();\n      if (inv) {\n        inv.autoSort();\n        this.refresh();\n      }\n    });\n    this.container.add(this.sortBtn);\n\n    // --- Stats summary ---\n    this.statsText = this.scene.add.text(\n      eqOx, oy + 16 + 5 * (SLOT_SIZE + SLOT_GAP) + 8,\n      '', {\n        fontFamily: 'monospace', fontSize: '10px', color: '#aaaacc',\n        lineSpacing: 3,\n      },\n    );\n    this.container.add(this.statsText);\n\n    // Disable the default browser context menu over the game canvas\n    this.scene.input.mouse?.disableContextMenu();\n  }\n\n  // ---------------------------------------------------------------------------\n  // Refresh\n  // ---------------------------------------------------------------------------\n\n  refresh(): void {\n    const inv = this.getInventory();\n    const equip = this.getEquipment();\n\n    // Inventory slots\n    for (let i = 0; i < INV_TOTAL; i++) {\n      const slot = inv?.getSlot(i) ?? null;\n      this.refreshInvSlot(i, slot);\n    }\n\n    // Equipment slots\n    for (let i = 0; i < EQUIP_SLOTS.length; i++) {\n      const equipped = equip?.getEquipped(EQUIP_SLOTS[i].slot) ?? null;\n      this.refreshEquipSlot(i, equipped);\n    }\n\n    // Stats summary\n    if (equip) {\n      const s = equip.getTotalStats();\n      this.statsText.setText(\n        `ATK  ${s.damage}\\n` +\n        `DEF  ${s.defense}\\n` +\n        `HP   +${s.hp}\\n` +\n        `STA  +${s.stamina}\\n` +\n        `CRIT ${(s.critChance * 100).toFixed(0)}%\\n` +\n        `ASPD ${s.attackSpeed.toFixed(1)}`,\n      );\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Slot rendering helpers\n  // ---------------------------------------------------------------------------\n\n  private refreshInvSlot(index: number, slot: InventorySlot | null): void {\n    const col = index % INV_COLS;\n    const row = Math.floor(index / INV_COLS);\n    const sx = 14 + col * (SLOT_SIZE + SLOT_GAP);\n    const sy = 42 + 16 + row * (SLOT_SIZE + SLOT_GAP);\n\n    const icon = this.invSlotIcons[index];\n    const countText = this.invSlotCountTexts[index];\n    const slotGfx = this.invSlotGraphics[index];\n\n    icon.clear();\n    slotGfx.clear();\n\n    if (slot && slot.itemId !== '' && slot.quantity > 0) {\n      const def = ITEM_DB.get(slot.itemId);\n      const rarityColor = def ? RARITY_COLORS[def.rarity] ?? 0xffffff : 0xffffff;\n      const catColor = def ? (CATEGORY_COLORS[def.category] ?? 0x888888) : 0x888888;\n\n      // Slot border colored by rarity\n      slotGfx.fillStyle(0x1a1a24, 0.9);\n      slotGfx.fillRoundedRect(sx, sy, SLOT_SIZE, SLOT_SIZE, 4);\n      slotGfx.lineStyle(1.5, rarityColor, 0.7);\n      slotGfx.strokeRoundedRect(sx, sy, SLOT_SIZE, SLOT_SIZE, 4);\n\n      // Colored square icon\n      icon.fillStyle(catColor, 0.85);\n      icon.fillRoundedRect(sx + 6, sy + 6, SLOT_SIZE - 12, SLOT_SIZE - 12, 3);\n\n      // Stack count\n      countText.setText(slot.quantity > 1 ? String(slot.quantity) : '');\n    } else {\n      // Empty slot\n      slotGfx.fillStyle(0x1a1a24, 0.9);\n      slotGfx.fillRoundedRect(sx, sy, SLOT_SIZE, SLOT_SIZE, 4);\n      slotGfx.lineStyle(1, 0x444466, 0.6);\n      slotGfx.strokeRoundedRect(sx, sy, SLOT_SIZE, SLOT_SIZE, 4);\n      countText.setText('');\n    }\n  }\n\n  private refreshEquipSlot(index: number, equipped: EquippedItem | null): void {\n    const col = index < 5 ? 0 : 1;\n    const row = index < 5 ? index : index - 5;\n    const eqOx = 14 + INV_COLS * (SLOT_SIZE + SLOT_GAP) + 30;\n    const sx = eqOx + col * (SLOT_SIZE + SLOT_GAP + 60);\n    const sy = 42 + 16 + row * (SLOT_SIZE + SLOT_GAP);\n\n    const icon = this.equipSlotIcons[index];\n    const slotGfx = this.equipSlotGraphics[index];\n\n    icon.clear();\n    slotGfx.clear();\n\n    if (equipped) {\n      const def = ITEM_DB.get(equipped.itemId);\n      const rarityColor = RARITY_COLORS[equipped.rarity] ?? 0xffffff;\n      const catColor = def ? (CATEGORY_COLORS[def.category] ?? 0x888888) : 0x888888;\n\n      slotGfx.fillStyle(0x1a1a24, 0.9);\n      slotGfx.fillRoundedRect(sx, sy, SLOT_SIZE, SLOT_SIZE, 4);\n      slotGfx.lineStyle(1.5, rarityColor, 0.7);\n      slotGfx.strokeRoundedRect(sx, sy, SLOT_SIZE, SLOT_SIZE, 4);\n\n      icon.fillStyle(catColor, 0.85);\n      icon.fillRoundedRect(sx + 6, sy + 6, SLOT_SIZE - 12, SLOT_SIZE - 12, 3);\n    } else {\n      slotGfx.fillStyle(0x1a1a24, 0.9);\n      slotGfx.fillRoundedRect(sx, sy, SLOT_SIZE, SLOT_SIZE, 4);\n      slotGfx.lineStyle(1, 0x555577, 0.6);\n      slotGfx.strokeRoundedRect(sx, sy, SLOT_SIZE, SLOT_SIZE, 4);\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Tooltip\n  // ---------------------------------------------------------------------------\n\n  private showInvTooltip(index: number): void {\n    const inv = this.getInventory();\n    if (!inv) return;\n    const slot = inv.getSlot(index);\n    if (!slot || slot.itemId === '') return;\n\n    const def = ITEM_DB.get(slot.itemId);\n    if (!def) return;\n\n    this.buildTooltip(def, slot.quantity);\n  }\n\n  private showEquipTooltip(index: number): void {\n    const equip = this.getEquipment();\n    if (!equip) return;\n    const equipped = equip.getEquipped(EQUIP_SLOTS[index].slot);\n    if (!equipped) return;\n\n    const def = ITEM_DB.get(equipped.itemId);\n    if (!def) return;\n\n    this.buildTooltip(def, 1);\n  }\n\n  private buildTooltip(def: AnyItemDef, quantity: number): void {\n    // Clear previous tooltip text objects\n    for (const t of this.tooltipTexts) t.destroy();\n    this.tooltipTexts = [];\n\n    const lines: { text: string; color: string; size?: string }[] = [];\n\n    // Name (colored by rarity)\n    const rarityHex = RARITY_HEX[def.rarity] ?? '#ffffff';\n    lines.push({ text: def.name, color: rarityHex, size: '12px' });\n\n    // Rarity label\n    const rarityName = RARITY_NAMES[def.rarity] ?? 'Common';\n    lines.push({ text: `${rarityName} ${def.category}`, color: '#888888', size: '10px' });\n\n    // Description\n    if (def.description) {\n      lines.push({ text: def.description, color: '#aaaaaa', size: '10px' });\n    }\n\n    // Stats based on type\n    if (def.category === 'weapon') {\n      const w = def as WeaponDef;\n      lines.push({ text: `Damage: ${w.damage}`, color: '#cc4444', size: '10px' });\n      lines.push({ text: `Speed: ${w.attackSpeed.toFixed(1)}`, color: '#cccc44', size: '10px' });\n      lines.push({ text: `Crit: ${(w.critChance * 100).toFixed(0)}% x${w.critMult.toFixed(1)}`, color: '#cccc44', size: '10px' });\n      lines.push({ text: `Type: ${w.weaponType}`, color: '#888888', size: '10px' });\n    } else if (def.category === 'armor') {\n      const a = def as ArmorDef;\n      lines.push({ text: `Defense: ${a.defense}`, color: '#4444cc', size: '10px' });\n      if (a.hp > 0) lines.push({ text: `HP: +${a.hp}`, color: '#44cc44', size: '10px' });\n      if (a.stamina > 0) lines.push({ text: `Stamina: +${a.stamina}`, color: '#44cc44', size: '10px' });\n      lines.push({ text: `Slot: ${a.slot}`, color: '#888888', size: '10px' });\n    } else if (def.category === 'food') {\n      const f = def as FoodDef;\n      if (f.healAmount > 0) lines.push({ text: `Heal: ${f.healAmount}`, color: '#44cc44', size: '10px' });\n      if (f.staminaRestore > 0) lines.push({ text: `Stamina: +${f.staminaRestore}`, color: '#44cccc', size: '10px' });\n      if (f.buffType) lines.push({ text: `Buff: ${f.buffType} (${f.buffDuration}s)`, color: '#cccc44', size: '10px' });\n    } else if (def.category === 'potion') {\n      const p = def as PotionDef;\n      lines.push({ text: `Effect: ${p.effectType} +${p.effectMagnitude}`, color: '#cc44cc', size: '10px' });\n      lines.push({ text: `Duration: ${p.effectDuration}s`, color: '#cccc44', size: '10px' });\n    }\n\n    // Quantity\n    if (quantity > 1) {\n      lines.push({ text: `Qty: ${quantity}`, color: '#cccccc', size: '10px' });\n    }\n\n    // Sell price\n    if (def.sellPrice > 0) {\n      lines.push({ text: `Sell: ${def.sellPrice}g`, color: '#ffcc44', size: '10px' });\n    }\n\n    // Render tooltip text lines\n    let maxW = 0;\n    let cy = 8;\n    for (const line of lines) {\n      const t = this.scene.add.text(8, cy, line.text, {\n        fontFamily: 'monospace',\n        fontSize: line.size ?? '10px',\n        color: line.color,\n        wordWrap: { width: 220 },\n      });\n      this.tooltip.add(t);\n      this.tooltipTexts.push(t);\n      cy += t.height + 2;\n      maxW = Math.max(maxW, t.width);\n    }\n\n    // Background\n    this.tooltipBg.clear();\n    this.tooltipBg.fillStyle(0x0a0a12, 0.95);\n    this.tooltipBg.fillRoundedRect(0, 0, maxW + 16, cy + 8, 6);\n    this.tooltipBg.lineStyle(1, 0x7dd3fc, 0.5);\n    this.tooltipBg.strokeRoundedRect(0, 0, maxW + 16, cy + 8, 6);\n\n    this.tooltip.setVisible(true);\n  }\n\n  private moveTooltip(ptr: Phaser.Input.Pointer): void {\n    if (!this.tooltip.visible) return;\n    this.tooltip.setPosition(ptr.x + 16, ptr.y + 16);\n  }\n\n  private hideTooltip(): void {\n    this.tooltip.setVisible(false);\n    for (const t of this.tooltipTexts) t.destroy();\n    this.tooltipTexts = [];\n    this.tooltipBg.clear();\n  }\n\n  // ---------------------------------------------------------------------------\n  // Context menu\n  // ---------------------------------------------------------------------------\n\n  private openContext(type: 'inv' | 'equip', index: number, ptr: Phaser.Input.Pointer): void {\n    this.closeContext();\n    this.contextTarget = { type, index };\n\n    const options: { label: string; action: () => void }[] = [];\n\n    if (type === 'inv') {\n      const inv = this.getInventory();\n      if (!inv) return;\n      const slot = inv.getSlot(index);\n      if (!slot || slot.itemId === '') return;\n      const def = ITEM_DB.get(slot.itemId);\n\n      // Use (food / potion)\n      if (def && (def.category === 'food' || def.category === 'potion')) {\n        options.push({\n          label: 'Use',\n          action: () => {\n            inv.removeItem(slot.itemId, 1);\n            this.refresh();\n            this.closeContext();\n          },\n        });\n      }\n\n      // Equip (weapon / armor)\n      if (def && (def.category === 'weapon' || def.category === 'armor')) {\n        options.push({\n          label: 'Equip',\n          action: () => {\n            this.equipFromInventory(index);\n            this.closeContext();\n          },\n        });\n      }\n\n      // Drop\n      options.push({\n        label: 'Drop',\n        action: () => {\n          inv.removeItem(slot.itemId, slot.quantity);\n          this.refresh();\n          this.closeContext();\n        },\n      });\n    } else {\n      // Unequip\n      const equip = this.getEquipment();\n      if (!equip) return;\n      const equipped = equip.getEquipped(EQUIP_SLOTS[index].slot);\n      if (!equipped) return;\n\n      options.push({\n        label: 'Unequip',\n        action: () => {\n          this.unequipToInventory(index);\n          this.closeContext();\n        },\n      });\n    }\n\n    if (options.length === 0) return;\n\n    // Build menu\n    const menuW = 80;\n    const menuH = options.length * 22 + 8;\n\n    this.contextBg.clear();\n    this.contextBg.fillStyle(0x111118, 0.95);\n    this.contextBg.fillRoundedRect(0, 0, menuW, menuH, 4);\n    this.contextBg.lineStyle(1, 0x7dd3fc, 0.5);\n    this.contextBg.strokeRoundedRect(0, 0, menuW, menuH, 4);\n\n    // Remove old buttons\n    for (const b of this.contextButtons) b.destroy();\n    this.contextButtons = [];\n\n    for (let i = 0; i < options.length; i++) {\n      const btn = this.scene.add.text(8, 4 + i * 22, options[i].label, {\n        fontFamily: 'monospace', fontSize: '11px', color: '#cccccc',\n      }).setInteractive({ useHandCursor: true });\n\n      btn.on('pointerover', () => btn.setColor('#7dd3fc'));\n      btn.on('pointerout', () => btn.setColor('#cccccc'));\n      btn.on('pointerdown', options[i].action);\n\n      this.contextMenu.add(btn);\n      this.contextButtons.push(btn);\n    }\n\n    this.contextMenu.setPosition(ptr.x, ptr.y);\n    this.contextMenu.setVisible(true);\n\n    // Close context when clicking anywhere else (one-shot listener)\n    this.scene.input.once('pointerdown', () => {\n      // Slight delay so the button clicks still fire\n      this.scene.time.delayedCall(50, () => this.closeContext());\n    });\n  }\n\n  private closeContext(): void {\n    this.contextMenu.setVisible(false);\n    for (const b of this.contextButtons) b.destroy();\n    this.contextButtons = [];\n    this.contextBg.clear();\n    this.contextTarget = null;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Equip / Unequip helpers\n  // ---------------------------------------------------------------------------\n\n  private equipFromInventory(invIndex: number): void {\n    const inv = this.getInventory();\n    const equip = this.getEquipment();\n    if (!inv || !equip) return;\n\n    const slot = inv.getSlot(invIndex);\n    if (!slot || slot.itemId === '') return;\n\n    const def = ITEM_DB.get(slot.itemId);\n    if (!def) return;\n\n    let equipSlot: EquipSlot | null = null;\n\n    if (def.category === 'weapon') {\n      equipSlot = 'weapon';\n    } else if (def.category === 'armor') {\n      const armorDef = def as ArmorDef;\n      // Map armor slot to equip slot\n      if (armorDef.slot === 'ring') {\n        // Use ring1 if empty, else ring2\n        equipSlot = equip.getEquipped('ring1') === null ? 'ring1' : 'ring2';\n      } else if (armorDef.slot === 'shield') {\n        equipSlot = 'shield';\n      } else {\n        equipSlot = armorDef.slot as EquipSlot;\n      }\n    }\n\n    if (!equipSlot) return;\n\n    // Build the EquippedItem\n    const newEquip: EquippedItem = {\n      itemId: slot.itemId,\n      slot: equipSlot,\n      stats: {\n        damage: (def as any).damage ?? 0,\n        defense: (def as any).defense ?? 0,\n        hp: (def as any).hp ?? 0,\n        stamina: (def as any).stamina ?? 0,\n        critChance: (def as any).critChance ?? 0,\n        critMult: (def as any).critMult ?? 0,\n        attackSpeed: (def as any).attackSpeed ?? 0,\n      },\n      rarity: def.rarity,\n      setId: (def as any).setId,\n    };\n\n    // Notch cost and tradeoff for accessories\n    const notchCost = (def as any).notchCost ?? 0;\n    const tradeoff = (def as any).tradeoffStat && (def as any).tradeoffAmount\n      ? { stat: (def as any).tradeoffStat as string, amount: (def as any).tradeoffAmount as number }\n      : undefined;\n\n    // Check notch budget before equipping\n    if (notchCost > 0 && !equip.canEquipAccessory(notchCost, equipSlot)) {\n      // Not enough notches — show tooltip feedback\n      return;\n    }\n\n    // Remove from inventory\n    inv.removeItem(slot.itemId, 1);\n\n    // Equip (returns previously equipped item)\n    const prev = equip.equip(newEquip, notchCost, tradeoff);\n\n    // Put previous item back in inventory\n    if (prev) {\n      const prevDef = ITEM_DB.get(prev.itemId);\n      inv.addItem(prev.itemId, 1, prevDef?.maxStack ?? 1);\n    }\n\n    this.refresh();\n  }\n\n  private unequipToInventory(equipIndex: number): void {\n    const inv = this.getInventory();\n    const equip = this.getEquipment();\n    if (!inv || !equip) return;\n\n    if (inv.isFull()) return; // No room\n\n    const slotName = EQUIP_SLOTS[equipIndex].slot;\n    const removed = equip.unequip(slotName);\n    if (removed) {\n      const def = ITEM_DB.get(removed.itemId);\n      inv.addItem(removed.itemId, 1, def?.maxStack ?? 1);\n    }\n\n    this.refresh();\n  }\n\n  // ---------------------------------------------------------------------------\n  // Manager accessors\n  // ---------------------------------------------------------------------------\n\n  private getInventory(): InventoryManager | null {\n    return this.scene.registry.get('inventoryManager') as InventoryManager ?? null;\n  }\n\n  private getEquipment(): EquipmentManager | null {\n    return this.scene.registry.get('equipmentManager') as EquipmentManager ?? null;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Cleanup\n  // ---------------------------------------------------------------------------\n\n  override close(): void {\n    this.hideTooltip();\n    this.closeContext();\n    super.close();\n  }\n\n  override destroy(): void {\n    this.hideTooltip();\n    this.closeContext();\n    this.tooltip.destroy(true);\n    this.contextMenu.destroy(true);\n    super.destroy();\n  }\n}\n","import Phaser from 'phaser';\nimport { UIPanel } from './UIBase';\nimport { CraftingManager } from '../systems/CraftingManager';\nimport { InventoryManager } from '../systems/InventoryManager';\nimport { RecipeDef } from '../data/recipes';\nimport { ITEM_DB } from '../data/items';\n\n// ---------------------------------------------------------------------------\n// Constants\n// ---------------------------------------------------------------------------\n\nconst CATEGORIES = ['all', 'crafting', 'cooking', 'alchemy', 'smithing', 'sewing'] as const;\ntype CategoryFilter = typeof CATEGORIES[number];\n\n// ---------------------------------------------------------------------------\n// Crafting UI Panel\n// ---------------------------------------------------------------------------\n\nexport class CraftingUI extends UIPanel {\n  // Category tabs\n  private tabTexts: Phaser.GameObjects.Text[] = [];\n  private activeCategory: CategoryFilter = 'all';\n\n  // Recipe list (left side)\n  private recipeContainer!: Phaser.GameObjects.Container;\n  private recipeEntries: {\n    bg: Phaser.GameObjects.Graphics;\n    nameText: Phaser.GameObjects.Text;\n    ingredientText: Phaser.GameObjects.Text;\n    hit: Phaser.GameObjects.Rectangle;\n    recipe: RecipeDef;\n  }[] = [];\n\n  // Detail / craft panel (right side)\n  private detailContainer!: Phaser.GameObjects.Container;\n  private detailName!: Phaser.GameObjects.Text;\n  private detailStation!: Phaser.GameObjects.Text;\n  private detailIngredients!: Phaser.GameObjects.Text;\n  private detailOutput!: Phaser.GameObjects.Text;\n  private craftBtn!: Phaser.GameObjects.Text;\n  private selectedRecipe: RecipeDef | null = null;\n\n  // Scroll\n  private scrollOffset = 0;\n  private maxVisible = 8;\n\n  // Craft progress\n  private progressBar!: Phaser.GameObjects.Graphics;\n  private progressText!: Phaser.GameObjects.Text;\n\n  constructor(scene: Phaser.Scene) {\n    const panelW = 560;\n    const panelH = 400;\n    const px = Math.floor((scene.cameras.main.width - panelW) / 2);\n    const py = Math.floor((scene.cameras.main.height - panelH) / 2);\n    super(scene, px, py, panelW, panelH, 'Crafting');\n  }\n\n  // ---------------------------------------------------------------------------\n  // Build\n  // ---------------------------------------------------------------------------\n\n  protected buildContent(): void {\n    const ox = 12;\n    const oy = 38;\n\n    // --- Category tabs ---\n    let tabX = ox;\n    for (const cat of CATEGORIES) {\n      const label = cat.charAt(0).toUpperCase() + cat.slice(1);\n      const tab = this.scene.add.text(tabX, oy, label, {\n        fontFamily: 'monospace', fontSize: '10px',\n        color: cat === this.activeCategory ? '#7dd3fc' : '#666688',\n        backgroundColor: cat === this.activeCategory ? '#1a2a3a' : undefined,\n        padding: { x: 4, y: 2 },\n      }).setInteractive({ useHandCursor: true });\n\n      tab.on('pointerdown', () => {\n        this.activeCategory = cat;\n        this.scrollOffset = 0;\n        this.refresh();\n      });\n\n      this.container.add(tab);\n      this.tabTexts.push(tab);\n      tabX += tab.width + 6;\n    }\n\n    // --- Recipe list container (left side, scrollable) ---\n    this.recipeContainer = this.scene.add.container(ox, oy + 24);\n    this.container.add(this.recipeContainer);\n\n    // --- Detail panel (right side) ---\n    const detailX = 290;\n    this.detailContainer = this.scene.add.container(detailX, oy + 24);\n    this.container.add(this.detailContainer);\n\n    // Detail elements\n    this.detailName = this.scene.add.text(0, 0, '', {\n      fontFamily: 'monospace', fontSize: '13px', color: '#7dd3fc', fontStyle: 'bold',\n    });\n    this.detailContainer.add(this.detailName);\n\n    this.detailStation = this.scene.add.text(0, 20, '', {\n      fontFamily: 'monospace', fontSize: '10px', color: '#888888',\n    });\n    this.detailContainer.add(this.detailStation);\n\n    this.detailIngredients = this.scene.add.text(0, 42, '', {\n      fontFamily: 'monospace', fontSize: '10px', color: '#cccccc',\n      lineSpacing: 4, wordWrap: { width: 240 },\n    });\n    this.detailContainer.add(this.detailIngredients);\n\n    this.detailOutput = this.scene.add.text(0, 150, '', {\n      fontFamily: 'monospace', fontSize: '11px', color: '#44cc44',\n    });\n    this.detailContainer.add(this.detailOutput);\n\n    // Craft button\n    this.craftBtn = this.scene.add.text(0, 200, '[ CRAFT ]', {\n      fontFamily: 'monospace', fontSize: '13px', color: '#44cc44',\n      backgroundColor: '#1a3a1a', padding: { x: 10, y: 4 },\n    }).setInteractive({ useHandCursor: true });\n\n    this.craftBtn.on('pointerover', () => this.craftBtn.setColor('#66ff66'));\n    this.craftBtn.on('pointerout', () => this.craftBtn.setColor('#44cc44'));\n    this.craftBtn.on('pointerdown', () => this.doCraft());\n    this.detailContainer.add(this.craftBtn);\n\n    // Progress bar\n    this.progressBar = this.scene.add.graphics();\n    this.detailContainer.add(this.progressBar);\n\n    this.progressText = this.scene.add.text(0, 240, '', {\n      fontFamily: 'monospace', fontSize: '10px', color: '#cccc44',\n    });\n    this.detailContainer.add(this.progressText);\n\n    // Scroll with mouse wheel\n    this.scene.input.on('wheel', (_ptr: Phaser.Input.Pointer, _gos: Phaser.GameObjects.GameObject[], _dx: number, dy: number) => {\n      if (!this.isOpen) return;\n      this.scrollOffset = Math.max(0, this.scrollOffset + (dy > 0 ? 1 : -1));\n      this.refreshRecipeList();\n    });\n  }\n\n  // ---------------------------------------------------------------------------\n  // Refresh\n  // ---------------------------------------------------------------------------\n\n  refresh(): void {\n    // Update tab highlight\n    for (let i = 0; i < CATEGORIES.length; i++) {\n      const active = CATEGORIES[i] === this.activeCategory;\n      this.tabTexts[i].setColor(active ? '#7dd3fc' : '#666688');\n      this.tabTexts[i].setBackgroundColor(active ? '#1a2a3a' : '');\n    }\n\n    this.refreshRecipeList();\n    this.refreshDetail();\n    this.refreshProgress();\n  }\n\n  private refreshRecipeList(): void {\n    // Clear old entries\n    for (const entry of this.recipeEntries) {\n      entry.bg.destroy();\n      entry.nameText.destroy();\n      entry.ingredientText.destroy();\n      entry.hit.destroy();\n    }\n    this.recipeEntries = [];\n\n    const crafting = this.getCrafting();\n    const inv = this.getInventory();\n    if (!crafting || !inv) return;\n\n    // Get recipes\n    let recipes = crafting.getDiscoveredRecipes();\n    if (this.activeCategory !== 'all') {\n      recipes = recipes.filter(r => r.category === this.activeCategory);\n    }\n\n    // Sort: craftable first, then alphabetical\n    recipes.sort((a, b) => {\n      const canA = crafting.canCraft(a.id, inv) ? 0 : 1;\n      const canB = crafting.canCraft(b.id, inv) ? 0 : 1;\n      if (canA !== canB) return canA - canB;\n      return a.name.localeCompare(b.name);\n    });\n\n    // Clamp scroll offset\n    const maxScroll = Math.max(0, recipes.length - this.maxVisible);\n    this.scrollOffset = Math.min(this.scrollOffset, maxScroll);\n\n    const visible = recipes.slice(this.scrollOffset, this.scrollOffset + this.maxVisible);\n    const entryH = 38;\n    const entryW = 260;\n\n    for (let i = 0; i < visible.length; i++) {\n      const recipe = visible[i];\n      const canCraft = crafting.canCraft(recipe.id, inv);\n      const y = i * (entryH + 2);\n\n      const bg = this.scene.add.graphics();\n      bg.fillStyle(canCraft ? 0x1a2a1a : 0x1a1a24, 0.85);\n      bg.fillRoundedRect(0, y, entryW, entryH, 4);\n      bg.lineStyle(1, canCraft ? 0x44cc44 : 0x333344, 0.4);\n      bg.strokeRoundedRect(0, y, entryW, entryH, 4);\n      this.recipeContainer.add(bg);\n\n      // Output item name\n      const outputDef = ITEM_DB.get(recipe.output.itemId);\n      const outName = outputDef ? outputDef.name : recipe.name;\n      const nameText = this.scene.add.text(6, y + 4, outName, {\n        fontFamily: 'monospace', fontSize: '11px',\n        color: canCraft ? '#cccccc' : '#666666',\n      });\n      this.recipeContainer.add(nameText);\n\n      // Ingredients summary\n      const ingStr = recipe.ingredients.map(ing => {\n        const ingDef = ITEM_DB.get(ing.itemId);\n        const have = inv.countItem(ing.itemId);\n        const name = ingDef ? ingDef.name : ing.itemId;\n        const color = have >= ing.quantity ? '' : '!';\n        return `${name} ${have}/${ing.quantity}${color}`;\n      }).join(', ');\n\n      const ingredientText = this.scene.add.text(6, y + 20, ingStr, {\n        fontFamily: 'monospace', fontSize: '8px',\n        color: canCraft ? '#888888' : '#554444',\n        wordWrap: { width: entryW - 12 },\n      });\n      this.recipeContainer.add(ingredientText);\n\n      // Hit area\n      const hit = this.scene.add.rectangle(entryW / 2, y + entryH / 2, entryW, entryH)\n        .setAlpha(0.001)\n        .setInteractive({ useHandCursor: true });\n      this.recipeContainer.add(hit);\n\n      hit.on('pointerdown', () => {\n        this.selectedRecipe = recipe;\n        this.refreshDetail();\n      });\n\n      this.recipeEntries.push({ bg, nameText, ingredientText, hit, recipe });\n    }\n  }\n\n  private refreshDetail(): void {\n    if (!this.selectedRecipe) {\n      this.detailName.setText('Select a recipe');\n      this.detailStation.setText('');\n      this.detailIngredients.setText('');\n      this.detailOutput.setText('');\n      this.craftBtn.setVisible(false);\n      return;\n    }\n\n    const recipe = this.selectedRecipe;\n    const inv = this.getInventory();\n    const crafting = this.getCrafting();\n    const canCraft = crafting && inv ? crafting.canCraft(recipe.id, inv) : false;\n\n    const outputDef = ITEM_DB.get(recipe.output.itemId);\n    this.detailName.setText(outputDef ? outputDef.name : recipe.name);\n    this.detailStation.setText(\n      recipe.station === 'none' ? 'No station required' : `Station: ${recipe.station}`,\n    );\n\n    // Ingredients\n    const ingLines = recipe.ingredients.map(ing => {\n      const ingDef = ITEM_DB.get(ing.itemId);\n      const have = inv ? inv.countItem(ing.itemId) : 0;\n      const name = ingDef ? ingDef.name : ing.itemId;\n      const ok = have >= ing.quantity;\n      return `${ok ? '+' : '-'} ${name}: ${have}/${ing.quantity}`;\n    });\n    this.detailIngredients.setText('Ingredients:\\n' + ingLines.join('\\n'));\n\n    // Output\n    const outName = outputDef ? outputDef.name : recipe.output.itemId;\n    this.detailOutput.setText(`Output: ${outName} x${recipe.output.quantity}`);\n\n    // Craft button\n    this.craftBtn.setVisible(true);\n    this.craftBtn.setColor(canCraft ? '#44cc44' : '#664444');\n    this.craftBtn.setBackgroundColor(canCraft ? '#1a3a1a' : '#2a1a1a');\n  }\n\n  private refreshProgress(): void {\n    this.progressBar.clear();\n    const crafting = this.getCrafting();\n    if (!crafting) return;\n\n    const prog = crafting.getCraftProgress();\n    if (prog) {\n      const barW = 200;\n      const barH = 12;\n      const barY = 230;\n\n      this.progressBar.fillStyle(0x222233, 0.8);\n      this.progressBar.fillRoundedRect(0, barY, barW, barH, 3);\n      this.progressBar.fillStyle(0x44cc44, 0.8);\n      this.progressBar.fillRoundedRect(0, barY, barW * prog.progress, barH, 3);\n\n      this.progressText.setText(`Crafting... ${Math.floor(prog.progress * 100)}%  (Queue: ${crafting.getQueueLength()})`);\n    } else {\n      this.progressText.setText('');\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Craft action\n  // ---------------------------------------------------------------------------\n\n  private doCraft(): void {\n    if (!this.selectedRecipe) return;\n    const crafting = this.getCrafting();\n    const inv = this.getInventory();\n    if (!crafting || !inv) return;\n\n    if (crafting.canCraft(this.selectedRecipe.id, inv)) {\n      crafting.craft(this.selectedRecipe.id, inv, 1);\n      this.refresh();\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Manager accessors\n  // ---------------------------------------------------------------------------\n\n  private getCrafting(): CraftingManager | null {\n    return this.scene.registry.get('craftingManager') as CraftingManager ?? null;\n  }\n\n  private getInventory(): InventoryManager | null {\n    return this.scene.registry.get('inventoryManager') as InventoryManager ?? null;\n  }\n}\n","import Phaser from 'phaser';\nimport { UIPanel } from './UIBase';\nimport { QuestManager } from '../systems/QuestManager';\nimport { QuestDef, QuestStatus } from '../types/quest';\nimport { QUESTS } from '../data/quests';\nimport { ITEM_DB } from '../data/items';\n\n// ---------------------------------------------------------------------------\n// Constants\n// ---------------------------------------------------------------------------\n\ntype JournalTab = 'active' | 'completed' | 'failed';\n\nconst QUEST_TYPE_COLORS: Record<string, string> = {\n  main: '#ffcc44',\n  side: '#aaaacc',\n  daily: '#44cccc',\n  weekly: '#4488cc',\n  bounty: '#cc4444',\n  legendary: '#ff8800',\n};\n\n// ---------------------------------------------------------------------------\n// Quest Journal UI\n// ---------------------------------------------------------------------------\n\nexport class QuestJournal extends UIPanel {\n  // Tabs\n  private tabTexts: Phaser.GameObjects.Text[] = [];\n  private activeTab: JournalTab = 'active';\n\n  // Quest list (left side)\n  private listContainer!: Phaser.GameObjects.Container;\n  private listEntries: {\n    bg: Phaser.GameObjects.Graphics;\n    nameText: Phaser.GameObjects.Text;\n    typeText: Phaser.GameObjects.Text;\n    hit: Phaser.GameObjects.Rectangle;\n    questId: string;\n  }[] = [];\n\n  // Detail (right side)\n  private detailContainer!: Phaser.GameObjects.Container;\n  private detailName!: Phaser.GameObjects.Text;\n  private detailType!: Phaser.GameObjects.Text;\n  private detailDesc!: Phaser.GameObjects.Text;\n  private detailObjectives!: Phaser.GameObjects.Text;\n  private detailRewards!: Phaser.GameObjects.Text;\n  private trackBtn!: Phaser.GameObjects.Text;\n\n  private selectedQuestId: string | null = null;\n  private scrollOffset = 0;\n  private maxVisible = 9;\n\n  constructor(scene: Phaser.Scene) {\n    const panelW = 600;\n    const panelH = 420;\n    const px = Math.floor((scene.cameras.main.width - panelW) / 2);\n    const py = Math.floor((scene.cameras.main.height - panelH) / 2);\n    super(scene, px, py, panelW, panelH, 'Quest Journal');\n  }\n\n  // ---------------------------------------------------------------------------\n  // Build\n  // ---------------------------------------------------------------------------\n\n  protected buildContent(): void {\n    const ox = 12;\n    const oy = 38;\n\n    // --- Tabs ---\n    const tabs: { label: string; tab: JournalTab }[] = [\n      { label: 'Active', tab: 'active' },\n      { label: 'Completed', tab: 'completed' },\n      { label: 'Failed', tab: 'failed' },\n    ];\n\n    let tabX = ox;\n    for (const { label, tab } of tabs) {\n      const t = this.scene.add.text(tabX, oy, label, {\n        fontFamily: 'monospace', fontSize: '11px',\n        color: tab === this.activeTab ? '#7dd3fc' : '#666688',\n        backgroundColor: tab === this.activeTab ? '#1a2a3a' : undefined,\n        padding: { x: 6, y: 2 },\n      }).setInteractive({ useHandCursor: true });\n\n      t.on('pointerdown', () => {\n        this.activeTab = tab;\n        this.scrollOffset = 0;\n        this.selectedQuestId = null;\n        this.refresh();\n      });\n\n      this.container.add(t);\n      this.tabTexts.push(t);\n      tabX += t.width + 8;\n    }\n\n    // --- Quest list (left side) ---\n    this.listContainer = this.scene.add.container(ox, oy + 24);\n    this.container.add(this.listContainer);\n\n    // --- Detail panel (right side) ---\n    const detailX = 260;\n    this.detailContainer = this.scene.add.container(detailX, oy + 24);\n    this.container.add(this.detailContainer);\n\n    this.detailName = this.scene.add.text(0, 0, '', {\n      fontFamily: 'monospace', fontSize: '13px', color: '#7dd3fc', fontStyle: 'bold',\n      wordWrap: { width: 310 },\n    });\n    this.detailContainer.add(this.detailName);\n\n    this.detailType = this.scene.add.text(0, 20, '', {\n      fontFamily: 'monospace', fontSize: '10px', color: '#888888',\n    });\n    this.detailContainer.add(this.detailType);\n\n    this.detailDesc = this.scene.add.text(0, 38, '', {\n      fontFamily: 'monospace', fontSize: '10px', color: '#aaaaaa',\n      wordWrap: { width: 310 }, lineSpacing: 3,\n    });\n    this.detailContainer.add(this.detailDesc);\n\n    this.detailObjectives = this.scene.add.text(0, 100, '', {\n      fontFamily: 'monospace', fontSize: '10px', color: '#cccccc',\n      wordWrap: { width: 310 }, lineSpacing: 4,\n    });\n    this.detailContainer.add(this.detailObjectives);\n\n    this.detailRewards = this.scene.add.text(0, 240, '', {\n      fontFamily: 'monospace', fontSize: '10px', color: '#ffcc44',\n      wordWrap: { width: 310 }, lineSpacing: 3,\n    });\n    this.detailContainer.add(this.detailRewards);\n\n    // Track button\n    this.trackBtn = this.scene.add.text(0, 310, '[ TRACK ]', {\n      fontFamily: 'monospace', fontSize: '12px', color: '#44cc44',\n      backgroundColor: '#1a3a1a', padding: { x: 8, y: 3 },\n    }).setInteractive({ useHandCursor: true });\n    this.trackBtn.on('pointerover', () => this.trackBtn.setColor('#66ff66'));\n    this.trackBtn.on('pointerout', () => this.trackBtn.setColor('#44cc44'));\n    this.trackBtn.on('pointerdown', () => this.trackQuest());\n    this.trackBtn.setVisible(false);\n    this.detailContainer.add(this.trackBtn);\n\n    // Scroll\n    this.scene.input.on('wheel', (_ptr: Phaser.Input.Pointer, _gos: Phaser.GameObjects.GameObject[], _dx: number, dy: number) => {\n      if (!this.isOpen) return;\n      this.scrollOffset = Math.max(0, this.scrollOffset + (dy > 0 ? 1 : -1));\n      this.refreshList();\n    });\n  }\n\n  // ---------------------------------------------------------------------------\n  // Refresh\n  // ---------------------------------------------------------------------------\n\n  refresh(): void {\n    // Update tab styling\n    const tabNames: JournalTab[] = ['active', 'completed', 'failed'];\n    for (let i = 0; i < this.tabTexts.length; i++) {\n      const active = tabNames[i] === this.activeTab;\n      this.tabTexts[i].setColor(active ? '#7dd3fc' : '#666688');\n      this.tabTexts[i].setBackgroundColor(active ? '#1a2a3a' : '');\n    }\n\n    this.refreshList();\n    this.refreshDetail();\n  }\n\n  private refreshList(): void {\n    // Clear old\n    for (const entry of this.listEntries) {\n      entry.bg.destroy();\n      entry.nameText.destroy();\n      entry.typeText.destroy();\n      entry.hit.destroy();\n    }\n    this.listEntries = [];\n\n    const qm = this.getQuestManager();\n    if (!qm) return;\n\n    // Gather quests for the active tab\n    const quests: { def: QuestDef; status: QuestStatus; progress: number[] | null }[] = [];\n\n    if (this.activeTab === 'active') {\n      const active = qm.getActiveQuests();\n      for (const { quest, progress } of active) {\n        quests.push({ def: quest, status: 'active', progress });\n      }\n    } else {\n      // Scan all quests for completed or failed\n      for (const def of QUESTS) {\n        const status = qm.getQuestStatus(def.id);\n        if (this.activeTab === 'completed' && (status === 'complete' || status === 'turned_in')) {\n          quests.push({ def, status, progress: null });\n        } else if (this.activeTab === 'failed' && status === 'failed') {\n          quests.push({ def, status, progress: null });\n        }\n      }\n    }\n\n    // Clamp scroll\n    const maxScroll = Math.max(0, quests.length - this.maxVisible);\n    this.scrollOffset = Math.min(this.scrollOffset, maxScroll);\n\n    const visible = quests.slice(this.scrollOffset, this.scrollOffset + this.maxVisible);\n    const entryH = 34;\n    const entryW = 230;\n\n    for (let i = 0; i < visible.length; i++) {\n      const { def } = visible[i];\n      const y = i * (entryH + 2);\n      const selected = this.selectedQuestId === def.id;\n\n      const bg = this.scene.add.graphics();\n      bg.fillStyle(selected ? 0x1a2a3a : 0x1a1a24, 0.85);\n      bg.fillRoundedRect(0, y, entryW, entryH, 4);\n      bg.lineStyle(1, selected ? 0x7dd3fc : 0x333344, 0.5);\n      bg.strokeRoundedRect(0, y, entryW, entryH, 4);\n      this.listContainer.add(bg);\n\n      const typeColor = QUEST_TYPE_COLORS[def.type] ?? '#aaaaaa';\n      const nameText = this.scene.add.text(6, y + 4, def.name, {\n        fontFamily: 'monospace', fontSize: '11px', color: '#cccccc',\n        wordWrap: { width: entryW - 12 },\n      });\n      this.listContainer.add(nameText);\n\n      const typeText = this.scene.add.text(6, y + 20, def.type.toUpperCase(), {\n        fontFamily: 'monospace', fontSize: '8px', color: typeColor,\n      });\n      this.listContainer.add(typeText);\n\n      const hit = this.scene.add.rectangle(entryW / 2, y + entryH / 2, entryW, entryH)\n        .setAlpha(0.001)\n        .setInteractive({ useHandCursor: true });\n      this.listContainer.add(hit);\n\n      hit.on('pointerdown', () => {\n        this.selectedQuestId = def.id;\n        this.refresh();\n      });\n\n      this.listEntries.push({ bg, nameText, typeText, hit, questId: def.id });\n    }\n  }\n\n  private refreshDetail(): void {\n    if (!this.selectedQuestId) {\n      this.detailName.setText('Select a quest');\n      this.detailType.setText('');\n      this.detailDesc.setText('');\n      this.detailObjectives.setText('');\n      this.detailRewards.setText('');\n      this.trackBtn.setVisible(false);\n      return;\n    }\n\n    const qm = this.getQuestManager();\n    if (!qm) return;\n\n    const def = qm.getQuestDef(this.selectedQuestId);\n    if (!def) return;\n\n    const status = qm.getQuestStatus(def.id);\n    const progress = qm.getObjectiveProgress(def.id);\n    const typeColor = QUEST_TYPE_COLORS[def.type] ?? '#aaaaaa';\n\n    this.detailName.setText(def.name);\n    this.detailType.setText(`${def.type.toUpperCase()}  |  Level ${def.level}  |  ${status.toUpperCase()}`);\n    this.detailType.setColor(typeColor);\n    this.detailDesc.setText(def.description);\n\n    // Objectives with checkboxes\n    const objLines = def.objectives.map((obj, i) => {\n      const current = progress ? progress[i] : 0;\n      const done = current >= obj.count;\n      const checkbox = done ? '[x]' : '[ ]';\n      return `${checkbox} ${obj.description} (${current}/${obj.count})`;\n    });\n    this.detailObjectives.setText('Objectives:\\n' + objLines.join('\\n'));\n\n    // Rewards\n    const rewardParts: string[] = [];\n    if (def.rewards.xp > 0) rewardParts.push(`XP: ${def.rewards.xp}`);\n    if (def.rewards.gold > 0) rewardParts.push(`Gold: ${def.rewards.gold}`);\n    for (const item of def.rewards.items) {\n      const itemDef = ITEM_DB.get(item.itemId);\n      const name = itemDef ? itemDef.name : item.itemId;\n      rewardParts.push(`${name} x${item.quantity}`);\n    }\n    this.detailRewards.setText('Rewards:\\n' + rewardParts.join('\\n'));\n\n    // Track button (only for active quests)\n    this.trackBtn.setVisible(status === 'active');\n  }\n\n  // ---------------------------------------------------------------------------\n  // Track\n  // ---------------------------------------------------------------------------\n\n  private trackQuest(): void {\n    if (!this.selectedQuestId) return;\n    // Store tracked quest in registry for the HUD to read\n    this.scene.registry.set('trackedQuestId', this.selectedQuestId);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Manager accessor\n  // ---------------------------------------------------------------------------\n\n  private getQuestManager(): QuestManager | null {\n    return this.scene.registry.get('questManager') as QuestManager ?? null;\n  }\n}\n","import Phaser from 'phaser';\nimport { UIPanel } from './UIBase';\nimport { BIOMES } from '../data/biomes';\nimport { CITIES, CityDef } from '../data/cities';\nimport { PlayerController } from '../entities/Player';\nimport { ChunkManager } from '../world/ChunkManager';\nimport { TileType } from '../world/TileRegistry';\nimport { IsometricHelper } from '../world/IsometricHelper';\nimport { GAME_WIDTH, GAME_HEIGHT, CHUNK_SIZE } from '../config';\n\n// ---------------------------------------------------------------------------\n// Constants\n// ---------------------------------------------------------------------------\n\n// Colors for each biome (by id)\nconst BIOME_COLORS: Record<string, number> = {\n  haven:       0x4a7c3f,\n  rotwood:     0x2d4a2d,\n  ashlands:    0x5a3a2a,\n  drowned:     0x2a4a5a,\n  bone_wastes: 0xdbc07c,\n  the_void:    0x220033,\n  edilas:      0x1a0022,\n};\n\n// Map area dimensions (logical pixels inside the panel)\nconst MAP_OX = 20;\nconst MAP_OY = 44;\n\n// ---------------------------------------------------------------------------\n// Map UI Panel (full screen)\n// ---------------------------------------------------------------------------\n\n/** Tile type to minimap color */\nconst TILE_MINIMAP_COLORS: Record<TileType, number> = {\n  [TileType.Grass]:      0x4a7c3f,\n  [TileType.Dirt]:       0x8b6914,\n  [TileType.Sand]:       0xdbc07c,\n  [TileType.Stone]:      0x888888,\n  [TileType.Water]:      0x2266aa,\n  [TileType.Snow]:       0xddddee,\n  [TileType.Path]:       0xaa8855,\n  [TileType.Tilled]:     0x7a5a10,\n  [TileType.Watered]:    0x5a7a10,\n  [TileType.Lava]:       0xff4400,\n  [TileType.VoidTile]:   0x220033,\n  [TileType.WoodFloor]:  0x996633,\n  [TileType.Ice]:        0xaaddff,\n  [TileType.Mud]:        0x665533,\n  [TileType.Bone]:       0xccbb99,\n  [TileType.Corruption]: 0x440066,\n};\n\nexport class MapUI extends UIPanel {\n  private mapGraphics!: Phaser.GameObjects.Graphics;\n  private playerDot!: Phaser.GameObjects.Graphics;\n  private minimapGfx!: Phaser.GameObjects.Graphics;\n  private cityMarkers: Phaser.GameObjects.Text[] = [];\n  private biomeLabels: Phaser.GameObjects.Text[] = [];\n  private legendTexts: Phaser.GameObjects.Text[] = [];\n  private playerBlinkTimer = 0;\n  private mapW: number;\n  private mapH: number;\n  private travelCallback: ((cityId: string, x: number, y: number) => void) | null = null;\n\n  constructor(scene: Phaser.Scene) {\n    // Full-screen panel (with small margin)\n    const margin = 40;\n    const panelW = GAME_WIDTH - margin * 2;\n    const panelH = GAME_HEIGHT - margin * 2;\n    super(scene, margin, margin, panelW, panelH, 'World Map');\n    this.mapW = panelW - 40;\n    this.mapH = panelH - 80;\n  }\n\n  /** Set callback for fast travel. Called with (cityId, worldX, worldY). */\n  onTravel(cb: (cityId: string, x: number, y: number) => void): void {\n    this.travelCallback = cb;\n  }\n\n  // ---------------------------------------------------------------------------\n  // Build\n  // ---------------------------------------------------------------------------\n\n  protected buildContent(): void {\n    this.mapGraphics = this.scene.add.graphics();\n    this.container.add(this.mapGraphics);\n\n    this.minimapGfx = this.scene.add.graphics();\n    this.container.add(this.minimapGfx);\n\n    this.playerDot = this.scene.add.graphics();\n    this.container.add(this.playerDot);\n\n    // Legend on the right side\n    const legendX = this.mapW - 100;\n    let legendY = MAP_OY;\n\n    const legendTitle = this.scene.add.text(legendX, legendY, 'Legend', {\n      fontFamily: 'monospace', fontSize: '10px', color: '#7dd3fc', fontStyle: 'bold',\n    });\n    this.container.add(legendTitle);\n    this.legendTexts.push(legendTitle);\n    legendY += 16;\n\n    for (const biome of BIOMES) {\n      const color = BIOME_COLORS[biome.id] ?? 0x444444;\n      const hexStr = '#' + color.toString(16).padStart(6, '0');\n      const label = this.scene.add.text(legendX, legendY, `■ ${biome.name}`, {\n        fontFamily: 'monospace', fontSize: '9px', color: hexStr,\n      });\n      this.container.add(label);\n      this.legendTexts.push(label);\n      legendY += 14;\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Refresh\n  // ---------------------------------------------------------------------------\n\n  refresh(): void {\n    this.mapGraphics.clear();\n    this.playerDot.clear();\n\n    // Destroy old markers\n    for (const m of this.cityMarkers) m.destroy();\n    this.cityMarkers = [];\n    for (const l of this.biomeLabels) l.destroy();\n    this.biomeLabels = [];\n\n    // Map center in panel space\n    const cx = MAP_OX + (this.mapW - 120) / 2; // leave room for legend\n    const cy = MAP_OY + this.mapH / 2;\n\n    // We represent biomes as concentric rings, flattened into a top-down view.\n    // The world uses distance-from-origin rings, so we draw concentric rectangles\n    // shrinking scale: outermost biome is the largest ring.\n\n    // Scale: map the max world distance to half the usable map dimension\n    const maxDist = 2000; // rough outer bound\n    const mapScale = Math.min(this.mapW - 140, this.mapH - 20) / 2 / maxDist;\n\n    // Draw biomes from outermost to innermost so inner layers overlap\n    const sortedBiomes = [...BIOMES].reverse();\n\n    for (const biome of sortedBiomes) {\n      const innerDist = biome.distanceRange[0];\n      const outerDist = Math.min(biome.distanceRange[1], maxDist);\n      const color = BIOME_COLORS[biome.id] ?? 0x444444;\n\n      const outerR = outerDist * mapScale;\n      const x = cx - outerR;\n      const y = cy - outerR;\n      const size = outerR * 2;\n\n      this.mapGraphics.fillStyle(color, 0.6);\n      this.mapGraphics.fillRoundedRect(x, y, size, size, 8);\n      this.mapGraphics.lineStyle(1, 0xffffff, 0.15);\n      this.mapGraphics.strokeRoundedRect(x, y, size, size, 8);\n\n      // Biome label at center of its ring\n      const ringMid = ((innerDist + outerDist) / 2) * mapScale;\n      const labelY = cy - ringMid;\n      const label = this.scene.add.text(cx, labelY, biome.name, {\n        fontFamily: 'monospace', fontSize: '9px', color: '#ffffff',\n        stroke: '#000000', strokeThickness: 2,\n      }).setOrigin(0.5, 0.5);\n      this.container.add(label);\n      this.biomeLabels.push(label);\n    }\n\n    // Draw city markers\n    for (const city of CITIES) {\n      const cityX = cx + city.x * mapScale;\n      const cityY = cy + city.y * mapScale;\n\n      // City dot\n      this.mapGraphics.fillStyle(0xffcc44, 0.9);\n      this.mapGraphics.fillCircle(cityX, cityY, 4);\n      this.mapGraphics.lineStyle(1, 0xffffff, 0.5);\n      this.mapGraphics.strokeCircle(cityX, cityY, 4);\n\n      // City name — clickable for fast travel\n      const nameLabel = this.scene.add.text(cityX + 6, cityY - 6, city.name, {\n        fontFamily: 'monospace', fontSize: '8px', color: '#ffcc44',\n        stroke: '#000000', strokeThickness: 2,\n      }).setInteractive({ useHandCursor: true });\n      nameLabel.on('pointerover', () => nameLabel.setColor('#ffffff'));\n      nameLabel.on('pointerout', () => nameLabel.setColor('#ffcc44'));\n      nameLabel.on('pointerdown', () => {\n        if (this.travelCallback) {\n          this.travelCallback(city.id, city.x, city.y);\n          this.close();\n        }\n      });\n      this.container.add(nameLabel);\n      this.cityMarkers.push(nameLabel);\n    }\n\n    // Player position\n    const player = this.scene.registry.get('playerController') as PlayerController | undefined;\n    if (player) {\n      const sprite = player.getSprite();\n      const px = cx + sprite.x * mapScale;\n      const py = cy + sprite.y * mapScale;\n\n      this.playerDot.fillStyle(0x00ff00, 1);\n      this.playerDot.fillCircle(px, py, 5);\n      this.playerDot.lineStyle(2, 0xffffff, 0.8);\n      this.playerDot.strokeCircle(px, py, 5);\n    }\n\n    // === Minimap (200x200 tile-level view) ===\n    this.renderMinimap(player);\n  }\n\n  private renderMinimap(player: PlayerController | undefined): void {\n    this.minimapGfx.clear();\n\n    const mmSize = 200;\n    const mmX = this.mapW - mmSize - 10;\n    const mmY = this.mapH - mmSize + MAP_OY + 10;\n    const pixPerTile = 2;\n    const tilesVisible = mmSize / pixPerTile; // 100 tiles across\n\n    // Background\n    this.minimapGfx.fillStyle(0x111111, 0.8);\n    this.minimapGfx.fillRect(mmX, mmY, mmSize, mmSize);\n    this.minimapGfx.lineStyle(1, 0x7dd3fc, 0.5);\n    this.minimapGfx.strokeRect(mmX, mmY, mmSize, mmSize);\n\n    if (!player) return;\n\n    const pos = player.getPosition();\n    const tilePos = IsometricHelper.pixelToTile(pos.x, pos.y);\n    const centerTX = tilePos.tileX;\n    const centerTY = tilePos.tileY;\n    const halfTiles = Math.floor(tilesVisible / 2);\n\n    // Get the chunk manager from the registry if available\n    const chunkMgr = (this.scene as { chunkManager?: ChunkManager }).chunkManager\n      ?? this.scene.registry.get('chunkManager') as ChunkManager | undefined;\n\n    if (chunkMgr) {\n      for (let dy = -halfTiles; dy < halfTiles; dy++) {\n        for (let dx = -halfTiles; dx < halfTiles; dx++) {\n          const tx = centerTX + dx;\n          const ty = centerTY + dy;\n          const tile = chunkMgr.getTileAt(tx, ty);\n          const color = TILE_MINIMAP_COLORS[tile] ?? 0x333333;\n          const px = mmX + (dx + halfTiles) * pixPerTile;\n          const py = mmY + (dy + halfTiles) * pixPerTile;\n          this.minimapGfx.fillStyle(color, 1);\n          this.minimapGfx.fillRect(px, py, pixPerTile, pixPerTile);\n        }\n      }\n    }\n\n    // Player dot (white blinking center)\n    const blinkAlpha = (Math.sin(Date.now() / 200) + 1) / 2 * 0.5 + 0.5;\n    const dotX = mmX + mmSize / 2;\n    const dotY = mmY + mmSize / 2;\n    this.minimapGfx.fillStyle(0xffffff, blinkAlpha);\n    this.minimapGfx.fillCircle(dotX, dotY, 3);\n\n    // Minimap label\n    // (only add once — we rely on it being in the container from buildContent)\n  }\n\n  // ---------------------------------------------------------------------------\n  // Cleanup\n  // ---------------------------------------------------------------------------\n\n  override destroy(): void {\n    for (const m of this.cityMarkers) m.destroy();\n    for (const l of this.biomeLabels) l.destroy();\n    super.destroy();\n  }\n}\n","import Phaser from 'phaser';\nimport { UIPanel } from './UIBase';\nimport { SkillManager, SkillSnapshot } from '../systems/SkillManager';\n\n// ---------------------------------------------------------------------------\n// Skills UI Panel\n// ---------------------------------------------------------------------------\n\nconst SKILL_COLORS: Record<string, number> = {\n  farming:     0x44cc44,\n  mining:      0x888888,\n  combat:      0xcc4444,\n  foraging:    0x33aa33,\n  fishing:     0x4488cc,\n  cooking:     0xcc9933,\n  crafting:    0x9966cc,\n  social:      0xcc66aa,\n  exploration: 0x66cccc,\n};\n\nexport class SkillsUI extends UIPanel {\n  private skillBars: Phaser.GameObjects.Graphics[] = [];\n  private skillNameTexts: Phaser.GameObjects.Text[] = [];\n  private skillLevelTexts: Phaser.GameObjects.Text[] = [];\n  private skillXPTexts: Phaser.GameObjects.Text[] = [];\n\n  constructor(scene: Phaser.Scene) {\n    const panelW = 380;\n    const panelH = 420;\n    const px = Math.floor((scene.cameras.main.width - panelW) / 2);\n    const py = Math.floor((scene.cameras.main.height - panelH) / 2);\n    super(scene, px, py, panelW, panelH, 'Skills');\n  }\n\n  // ---------------------------------------------------------------------------\n  // Build\n  // ---------------------------------------------------------------------------\n\n  protected buildContent(): void {\n    const ox = 16;\n    const oy = 44;\n    const barW = 200;\n    const barH = 16;\n    const rowH = 38;\n\n    for (let i = 0; i < 9; i++) {\n      const y = oy + i * rowH;\n\n      // Skill name\n      const nameText = this.scene.add.text(ox, y, '', {\n        fontFamily: 'monospace', fontSize: '11px', color: '#cccccc',\n      });\n      this.container.add(nameText);\n      this.skillNameTexts.push(nameText);\n\n      // Level text (right of name)\n      const levelText = this.scene.add.text(ox + 110, y, '', {\n        fontFamily: 'monospace', fontSize: '11px', color: '#7dd3fc',\n      });\n      this.container.add(levelText);\n      this.skillLevelTexts.push(levelText);\n\n      // XP bar\n      const barGfx = this.scene.add.graphics();\n      this.container.add(barGfx);\n      this.skillBars.push(barGfx);\n\n      // XP text (below bar)\n      const xpText = this.scene.add.text(ox, y + 18, '', {\n        fontFamily: 'monospace', fontSize: '8px', color: '#888888',\n      });\n      this.container.add(xpText);\n      this.skillXPTexts.push(xpText);\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Refresh\n  // ---------------------------------------------------------------------------\n\n  refresh(): void {\n    const sm = this.getSkillManager();\n    if (!sm) return;\n\n    const skills = sm.getAllSkills();\n    const ox = 16;\n    const oy = 44;\n    const barW = 200;\n    const barH = 14;\n    const rowH = 38;\n\n    for (let i = 0; i < 9 && i < skills.length; i++) {\n      const skill = skills[i];\n      const y = oy + i * rowH;\n      const xpInfo = sm.getXP(skill.id);\n      const color = SKILL_COLORS[skill.id] ?? 0x7dd3fc;\n\n      this.skillNameTexts[i].setText(skill.name);\n      this.skillLevelTexts[i].setText(`Lv ${skill.level}`);\n\n      // XP bar\n      const barGfx = this.skillBars[i];\n      barGfx.clear();\n      const barX = ox + 160;\n      const barY = y + 2;\n\n      // Background\n      barGfx.fillStyle(0x222233, 0.8);\n      barGfx.fillRoundedRect(barX, barY, barW, barH, 3);\n\n      // Fill\n      const fill = xpInfo.required > 0 ? Math.min(xpInfo.current / xpInfo.required, 1) : 1;\n      barGfx.fillStyle(color, 0.8);\n      barGfx.fillRoundedRect(barX, barY, barW * fill, barH, 3);\n\n      // Border\n      barGfx.lineStyle(1, 0xffffff, 0.15);\n      barGfx.strokeRoundedRect(barX, barY, barW, barH, 3);\n\n      // XP text\n      if (xpInfo.required > 0) {\n        this.skillXPTexts[i].setText(`${xpInfo.current} / ${xpInfo.required} XP`);\n      } else {\n        this.skillXPTexts[i].setText('MAX LEVEL');\n      }\n      this.skillXPTexts[i].setPosition(barX, barY + barH + 2);\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Manager accessor\n  // ---------------------------------------------------------------------------\n\n  private getSkillManager(): SkillManager | null {\n    return this.scene.registry.get('skillManager') as SkillManager ?? null;\n  }\n}\n","import Phaser from 'phaser';\nimport { UIPanel } from './UIBase';\nimport { AudioManager } from '../systems/AudioManager';\n\n// ---------------------------------------------------------------------------\n// Settings UI Panel\n// ---------------------------------------------------------------------------\n\nexport class SettingsUI extends UIPanel {\n  // Slider elements\n  private sliderGraphics: Phaser.GameObjects.Graphics[] = [];\n  private sliderLabels: Phaser.GameObjects.Text[] = [];\n  private sliderValueTexts: Phaser.GameObjects.Text[] = [];\n  private sliderHandles: Phaser.GameObjects.Rectangle[] = [];\n\n  // Slider metadata\n  private sliderDefs: {\n    label: string;\n    getValue: () => number;\n    setValue: (v: number) => void;\n  }[] = [];\n\n  // Display options\n  private fullscreenBtn!: Phaser.GameObjects.Text;\n\n  // Dragging state\n  private draggingSlider: number | null = null;\n\n  constructor(scene: Phaser.Scene) {\n    const panelW = 360;\n    const panelH = 340;\n    const px = Math.floor((scene.cameras.main.width - panelW) / 2);\n    const py = Math.floor((scene.cameras.main.height - panelH) / 2);\n    super(scene, px, py, panelW, panelH, 'Settings');\n  }\n\n  // ---------------------------------------------------------------------------\n  // Build\n  // ---------------------------------------------------------------------------\n\n  protected buildContent(): void {\n    const ox = 20;\n    const oy = 50;\n\n    // Define sliders\n    this.sliderDefs = [\n      {\n        label: 'Master Volume',\n        getValue: () => this.getAudio()?.getMasterVolume() ?? 1,\n        setValue: (v) => this.getAudio()?.setMasterVolume(v),\n      },\n      {\n        label: 'Music Volume',\n        getValue: () => this.getAudio()?.getMusicVolume() ?? 0.5,\n        setValue: (v) => this.getAudio()?.setMusicVolume(v),\n      },\n      {\n        label: 'SFX Volume',\n        getValue: () => this.getAudio()?.getSFXVolume() ?? 0.7,\n        setValue: (v) => this.getAudio()?.setSFXVolume(v),\n      },\n      {\n        label: 'Ambient Volume',\n        getValue: () => this.getAudio()?.getAmbientVolume() ?? 0.3,\n        setValue: (v) => this.getAudio()?.setAmbientVolume(v),\n      },\n    ];\n\n    // Section label\n    const audioLabel = this.scene.add.text(ox, oy - 16, 'Audio', {\n      fontFamily: 'monospace', fontSize: '12px', color: '#7dd3fc', fontStyle: 'bold',\n    });\n    this.container.add(audioLabel);\n\n    const sliderW = 200;\n    const sliderH = 8;\n    const handleSize = 14;\n    const rowH = 48;\n\n    for (let i = 0; i < this.sliderDefs.length; i++) {\n      const def = this.sliderDefs[i];\n      const y = oy + i * rowH;\n\n      // Label\n      const label = this.scene.add.text(ox, y, def.label, {\n        fontFamily: 'monospace', fontSize: '10px', color: '#aaaaaa',\n      });\n      this.container.add(label);\n      this.sliderLabels.push(label);\n\n      // Value text\n      const valueText = this.scene.add.text(ox + sliderW + 40, y + 16, '100%', {\n        fontFamily: 'monospace', fontSize: '10px', color: '#cccccc',\n      });\n      this.container.add(valueText);\n      this.sliderValueTexts.push(valueText);\n\n      // Slider track\n      const gfx = this.scene.add.graphics();\n      this.container.add(gfx);\n      this.sliderGraphics.push(gfx);\n\n      // Handle\n      const handle = this.scene.add.rectangle(\n        ox + sliderW * def.getValue(), y + 16 + sliderH / 2,\n        handleSize, handleSize, 0x7dd3fc, 0.9,\n      ).setInteractive({ useHandCursor: true, draggable: false });\n      handle.setStrokeStyle(1, 0xffffff, 0.5);\n      this.container.add(handle);\n      this.sliderHandles.push(handle);\n\n      // Click on handle starts drag\n      handle.on('pointerdown', () => {\n        this.draggingSlider = i;\n      });\n    }\n\n    // Pointer move for dragging\n    this.scene.input.on('pointermove', (ptr: Phaser.Input.Pointer) => {\n      if (this.draggingSlider === null || !this.isOpen) return;\n      this.handleSliderDrag(this.draggingSlider, ptr);\n    });\n\n    // Pointer up to stop drag\n    this.scene.input.on('pointerup', () => {\n      this.draggingSlider = null;\n    });\n\n    // Click on the slider track area to jump\n    for (let i = 0; i < this.sliderDefs.length; i++) {\n      const gfx = this.sliderGraphics[i];\n      const y = oy + i * rowH + 16;\n      const trackHit = this.scene.add.rectangle(\n        ox + sliderW / 2, y + sliderH / 2,\n        sliderW, sliderH + 10,\n      ).setAlpha(0.001).setInteractive({ useHandCursor: true });\n      this.container.add(trackHit);\n\n      trackHit.on('pointerdown', (ptr: Phaser.Input.Pointer) => {\n        this.draggingSlider = i;\n        this.handleSliderDrag(i, ptr);\n      });\n    }\n\n    // --- Display section ---\n    const displayY = oy + this.sliderDefs.length * rowH + 16;\n    const displayLabel = this.scene.add.text(ox, displayY, 'Display', {\n      fontFamily: 'monospace', fontSize: '12px', color: '#7dd3fc', fontStyle: 'bold',\n    });\n    this.container.add(displayLabel);\n\n    this.fullscreenBtn = this.scene.add.text(ox, displayY + 20, '[ Toggle Fullscreen ]', {\n      fontFamily: 'monospace', fontSize: '11px', color: '#cccccc',\n      backgroundColor: '#1a1a24', padding: { x: 8, y: 3 },\n    }).setInteractive({ useHandCursor: true });\n\n    this.fullscreenBtn.on('pointerover', () => this.fullscreenBtn.setColor('#7dd3fc'));\n    this.fullscreenBtn.on('pointerout', () => this.fullscreenBtn.setColor('#cccccc'));\n    this.fullscreenBtn.on('pointerdown', () => {\n      if (this.scene.scale.isFullscreen) {\n        this.scene.scale.stopFullscreen();\n      } else {\n        this.scene.scale.startFullscreen();\n      }\n    });\n    this.container.add(this.fullscreenBtn);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Refresh\n  // ---------------------------------------------------------------------------\n\n  refresh(): void {\n    const ox = 20;\n    const oy = 50;\n    const sliderW = 200;\n    const sliderH = 8;\n    const rowH = 48;\n\n    for (let i = 0; i < this.sliderDefs.length; i++) {\n      const def = this.sliderDefs[i];\n      const y = oy + i * rowH + 16;\n      const val = def.getValue();\n\n      // Redraw track\n      const gfx = this.sliderGraphics[i];\n      gfx.clear();\n      // Track bg\n      gfx.fillStyle(0x222233, 0.8);\n      gfx.fillRoundedRect(ox, y, sliderW, sliderH, 3);\n      // Track fill\n      gfx.fillStyle(0x7dd3fc, 0.6);\n      gfx.fillRoundedRect(ox, y, sliderW * val, sliderH, 3);\n\n      // Handle position\n      this.sliderHandles[i].setPosition(ox + sliderW * val, y + sliderH / 2);\n\n      // Value text\n      this.sliderValueTexts[i].setText(`${Math.round(val * 100)}%`);\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Slider drag\n  // ---------------------------------------------------------------------------\n\n  private handleSliderDrag(index: number, ptr: Phaser.Input.Pointer): void {\n    const ox = 20;\n    const sliderW = 200;\n\n    // Convert global pointer to local container coords\n    const localX = ptr.x - this.panelX;\n    let t = (localX - ox) / sliderW;\n    t = Math.max(0, Math.min(1, t));\n\n    this.sliderDefs[index].setValue(t);\n    this.refresh();\n  }\n\n  // ---------------------------------------------------------------------------\n  // Override open/close for pause behavior\n  // ---------------------------------------------------------------------------\n\n  override open(): void {\n    super.open();\n    // Pause physics in the overworld scene\n    const overworld = this.scene.scene.get('OverworldScene');\n    if (overworld && overworld.scene.isActive()) {\n      overworld.scene.pause();\n    }\n  }\n\n  override close(): void {\n    super.close();\n    // Resume physics in the overworld scene\n    const overworld = this.scene.scene.get('OverworldScene');\n    if (overworld && overworld.scene.isPaused()) {\n      overworld.scene.resume();\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Manager accessor\n  // ---------------------------------------------------------------------------\n\n  private getAudio(): AudioManager | null {\n    return this.scene.registry.get('audioManager') as AudioManager ?? null;\n  }\n}\n","import Phaser from 'phaser';\nimport { UIPanel } from './UIBase';\nimport { InventoryManager } from '../systems/InventoryManager';\nimport { ITEM_DB } from '../data/items';\n\n/** Shop item entry for display */\ninterface ShopEntry {\n  itemId: string;\n  name: string;\n  price: number;\n  description: string;\n}\n\n/**\n * Shop UI panel — split view with merchant inventory (left) and player\n * inventory (right). Supports buy/sell with gold display.\n */\nexport class ShopUI extends UIPanel {\n  private merchantItems: ShopEntry[] = [];\n  private playerGold = 0;\n  private sellMultiplier = 0.4; // sell items at 40% of buy price\n  private scrollY = 0;\n\n  // Dynamic text elements\n  private goldText!: Phaser.GameObjects.Text;\n  private merchantListTexts: Phaser.GameObjects.Text[] = [];\n  private playerListTexts: Phaser.GameObjects.Text[] = [];\n  private statusText!: Phaser.GameObjects.Text;\n\n  constructor(scene: Phaser.Scene) {\n    super(scene, 40, 40, 720, 480, 'Shop');\n  }\n\n  /** Open the shop with a specific set of items */\n  openWithItems(items: ShopEntry[], sellMult = 0.4): void {\n    this.merchantItems = items;\n    this.sellMultiplier = sellMult;\n    this.scrollY = 0;\n    this.open();\n  }\n\n  protected buildContent(): void {\n    // Gold display\n    this.goldText = this.scene.add.text(12, 38, 'Gold: 0', {\n      fontFamily: 'monospace', fontSize: '12px', color: '#ffcc00',\n    });\n    this.container.add(this.goldText);\n\n    // Column headers\n    const buyHeader = this.scene.add.text(12, 56, 'BUY', {\n      fontFamily: 'monospace', fontSize: '11px', color: '#88ccff', fontStyle: 'bold',\n    });\n    const sellHeader = this.scene.add.text(370, 56, 'SELL', {\n      fontFamily: 'monospace', fontSize: '11px', color: '#88ff88', fontStyle: 'bold',\n    });\n    this.container.add(buyHeader);\n    this.container.add(sellHeader);\n\n    // Divider line\n    const divider = this.scene.add.graphics();\n    divider.lineStyle(1, 0x7dd3fc, 0.3);\n    divider.lineBetween(358, 40, 358, 470);\n    this.container.add(divider);\n\n    // Status text at bottom\n    this.statusText = this.scene.add.text(12, 458, '', {\n      fontFamily: 'monospace', fontSize: '10px', color: '#aaaaaa',\n    });\n    this.container.add(this.statusText);\n  }\n\n  refresh(): void {\n    // Clean old entries\n    for (const t of this.merchantListTexts) t.destroy();\n    for (const t of this.playerListTexts) t.destroy();\n    this.merchantListTexts = [];\n    this.playerListTexts = [];\n\n    const inventoryManager = this.scene.registry.get('inventoryManager') as InventoryManager | undefined;\n    this.playerGold = inventoryManager?.getGold?.() ?? 0;\n    this.goldText.setText(`Gold: ${this.playerGold}`);\n\n    // --- Merchant items (left column) ---\n    let y = 72;\n    for (let i = 0; i < this.merchantItems.length && y < 450; i++) {\n      const item = this.merchantItems[i];\n      const canAfford = this.playerGold >= item.price;\n\n      const text = this.scene.add.text(16, y, `${item.name}  ${item.price}g`, {\n        fontFamily: 'monospace',\n        fontSize: '10px',\n        color: canAfford ? '#cccccc' : '#666666',\n      });\n      text.setInteractive({ useHandCursor: canAfford });\n\n      if (canAfford) {\n        text.on('pointerover', () => {\n          text.setColor('#ffffff');\n          this.statusText.setText(`Buy: ${item.name} — ${item.description}`);\n        });\n        text.on('pointerout', () => text.setColor('#cccccc'));\n        text.on('pointerdown', () => this.buyItem(item));\n      }\n\n      this.container.add(text);\n      this.merchantListTexts.push(text);\n      y += 18;\n    }\n\n    // --- Player inventory (right column, for selling) ---\n    if (inventoryManager) {\n      y = 72;\n      const slots = inventoryManager.getSlots();\n      for (const slot of slots) {\n        if (!slot || y >= 450) continue;\n        const itemDef = ITEM_DB.get(slot.itemId);\n        if (!itemDef) continue;\n\n        const sellPrice = Math.floor((itemDef.sellPrice ?? 10) * this.sellMultiplier);\n        const text = this.scene.add.text(374, y, `${itemDef.name} x${slot.quantity}  ${sellPrice}g`, {\n          fontFamily: 'monospace',\n          fontSize: '10px',\n          color: '#aaccaa',\n        });\n        text.setInteractive({ useHandCursor: true });\n        text.on('pointerover', () => {\n          text.setColor('#88ff88');\n          this.statusText.setText(`Sell: ${itemDef.name} for ${sellPrice}g`);\n        });\n        text.on('pointerout', () => text.setColor('#aaccaa'));\n        text.on('pointerdown', () => this.sellItem(slot.itemId, sellPrice));\n\n        this.container.add(text);\n        this.playerListTexts.push(text);\n        y += 18;\n      }\n    }\n  }\n\n  private buyItem(item: ShopEntry): void {\n    const inventoryManager = this.scene.registry.get('inventoryManager') as InventoryManager | undefined;\n    if (!inventoryManager) return;\n\n    if ((inventoryManager.getGold?.() ?? 0) < item.price) {\n      this.statusText.setText('Not enough gold!');\n      return;\n    }\n\n    inventoryManager.removeGold?.(item.price);\n    inventoryManager.addItem(item.itemId, 1);\n    this.statusText.setText(`Bought ${item.name}`);\n    this.refresh();\n  }\n\n  private sellItem(itemId: string, price: number): void {\n    const inventoryManager = this.scene.registry.get('inventoryManager') as InventoryManager | undefined;\n    if (!inventoryManager) return;\n\n    const removed = inventoryManager.removeItem(itemId, 1);\n    if (removed > 0) {\n      inventoryManager.addGold?.(price);\n      this.statusText.setText(`Sold for ${price}g`);\n      this.refresh();\n    }\n  }\n}\n","import Phaser from 'phaser';\nimport { UIPanel } from './UIBase';\nimport { ENEMY_DB } from '../data/enemies';\nimport { BOSS_DB } from '../data/bosses';\n\n/**\n * Bestiary UI — grid of discovered enemies/bosses.\n * Undiscovered entries shown as silhouettes.\n * Selected entry shows stats, biome, behavior, drops, kill count.\n * Keybind: B\n */\nexport class BestiaryUI extends UIPanel {\n  /** Set of enemy/boss IDs that have been encountered */\n  private discovered: Set<string> = new Set();\n  /** Kill counts by enemy/boss ID */\n  private killCounts: Map<string, number> = new Map();\n\n  // Dynamic elements\n  private entryTexts: Phaser.GameObjects.Text[] = [];\n  private detailTexts: Phaser.GameObjects.Text[] = [];\n  private selectedId: string | null = null;\n  private countText!: Phaser.GameObjects.Text;\n\n  constructor(scene: Phaser.Scene) {\n    super(scene, 60, 30, 680, 500, 'Bestiary');\n  }\n\n  /** Mark an enemy/boss as discovered */\n  discover(id: string): void {\n    this.discovered.add(id);\n  }\n\n  /** Record a kill */\n  recordKill(id: string): void {\n    this.discovered.add(id);\n    this.killCounts.set(id, (this.killCounts.get(id) ?? 0) + 1);\n  }\n\n  getDiscoveredCount(): number { return this.discovered.size; }\n\n  /** Serialize for save */\n  serialize(): { discovered: string[]; kills: Record<string, number> } {\n    return {\n      discovered: Array.from(this.discovered),\n      kills: Object.fromEntries(this.killCounts),\n    };\n  }\n\n  /** Deserialize from save */\n  deserialize(data: { discovered?: string[]; kills?: Record<string, number> }): void {\n    this.discovered = new Set(data.discovered ?? []);\n    this.killCounts = new Map(Object.entries(data.kills ?? {}));\n  }\n\n  protected buildContent(): void {\n    // Column headers\n    const listHeader = this.scene.add.text(12, 38, 'Enemies & Bosses', {\n      fontFamily: 'monospace', fontSize: '11px', color: '#88ccff', fontStyle: 'bold',\n    });\n    this.container.add(listHeader);\n\n    // Discovery count\n    this.countText = this.scene.add.text(12, 478, '', {\n      fontFamily: 'monospace', fontSize: '9px', color: '#666666',\n    });\n    this.container.add(this.countText);\n\n    // Divider\n    const divider = this.scene.add.graphics();\n    divider.lineStyle(1, 0x7dd3fc, 0.3);\n    divider.lineBetween(300, 38, 300, 490);\n    this.container.add(divider);\n\n    // Detail header\n    const detailHeader = this.scene.add.text(310, 38, 'Details', {\n      fontFamily: 'monospace', fontSize: '11px', color: '#88ccff', fontStyle: 'bold',\n    });\n    this.container.add(detailHeader);\n  }\n\n  refresh(): void {\n    // Clean up dynamic elements\n    for (const t of this.entryTexts) t.destroy();\n    for (const t of this.detailTexts) t.destroy();\n    this.entryTexts = [];\n    this.detailTexts = [];\n\n    const totalEntries = ENEMY_DB.size + BOSS_DB.size;\n    this.countText.setText(`Discovered: ${this.discovered.size}/${totalEntries}`);\n\n    // Build entry list\n    let y = 56;\n    const allEntries: { id: string; name: string; isBoss: boolean }[] = [];\n\n    for (const [id, def] of ENEMY_DB) {\n      allEntries.push({ id, name: def.name, isBoss: false });\n    }\n    for (const [id, def] of BOSS_DB) {\n      allEntries.push({ id, name: def.name, isBoss: true });\n    }\n\n    for (const entry of allEntries) {\n      if (y > 470) break;\n\n      const isDiscovered = this.discovered.has(entry.id);\n      const displayName = isDiscovered ? entry.name : '???';\n      const color = entry.isBoss\n        ? (isDiscovered ? '#ffaa44' : '#444444')\n        : (isDiscovered ? '#cccccc' : '#444444');\n\n      const prefix = entry.isBoss ? '[B] ' : '    ';\n      const text = this.scene.add.text(12, y, `${prefix}${displayName}`, {\n        fontFamily: 'monospace', fontSize: '10px', color,\n      });\n\n      if (isDiscovered) {\n        text.setInteractive({ useHandCursor: true });\n        text.on('pointerover', () => text.setColor('#ffffff'));\n        text.on('pointerout', () => text.setColor(color));\n        text.on('pointerdown', () => this.selectEntry(entry.id, entry.isBoss));\n      }\n\n      this.container.add(text);\n      this.entryTexts.push(text);\n      y += 16;\n    }\n\n    // Show selected entry details\n    if (this.selectedId) {\n      this.showDetails(this.selectedId);\n    }\n  }\n\n  private selectEntry(id: string, _isBoss: boolean): void {\n    this.selectedId = id;\n    this.showDetails(id);\n  }\n\n  private showDetails(id: string): void {\n    for (const t of this.detailTexts) t.destroy();\n    this.detailTexts = [];\n\n    const enemyDef = ENEMY_DB.get(id);\n    const bossDef = BOSS_DB.get(id);\n    const def = enemyDef ?? bossDef;\n    if (!def) return;\n\n    let y = 56;\n    const addLine = (text: string, color = '#cccccc') => {\n      const t = this.scene.add.text(310, y, text, {\n        fontFamily: 'monospace', fontSize: '10px', color,\n        wordWrap: { width: 360 },\n      });\n      this.container.add(t);\n      this.detailTexts.push(t);\n      y += t.height + 4;\n    };\n\n    addLine(def.name, '#ffffff');\n    y += 4;\n\n    if (enemyDef) {\n      addLine(`HP: ${enemyDef.hp}  DMG: ${enemyDef.damage}  DEF: ${enemyDef.defense}`);\n      addLine(`Speed: ${enemyDef.speed}  AI: ${enemyDef.aiType}`);\n      addLine(`Biome: ${enemyDef.biome}`);\n      addLine(`XP: ${enemyDef.xpReward}`, '#88ccff');\n    }\n\n    if (bossDef) {\n      addLine(`HP: ${bossDef.hp}  DMG: ${bossDef.damage}  DEF: ${bossDef.defense}`, '#ffaa44');\n      addLine(`Phases: ${bossDef.phases?.length ?? 1}`);\n      addLine(`Biome: ${bossDef.biome}`);\n      addLine(`XP: ${bossDef.xpReward ?? 0}`, '#88ccff');\n      if (bossDef.title) addLine(`\"${bossDef.title}\"`, '#aaaaaa');\n    }\n\n    const kills = this.killCounts.get(id) ?? 0;\n    y += 8;\n    addLine(`Kills: ${kills}`, '#88ff88');\n\n    // Drops\n    const lootList = enemyDef?.lootTable ?? bossDef?.drops ?? [];\n    if (lootList.length > 0) {\n      y += 4;\n      addLine('Drops:', '#ffcc00');\n      for (const drop of lootList.slice(0, 6)) {\n        addLine(`  ${drop.itemId} (${Math.round(drop.chance * 100)}%)`);\n      }\n    }\n  }\n}\n","import Phaser from 'phaser';\nimport { UIPanel } from './UIBase';\nimport { InventoryManager, InventorySlot } from '../systems/InventoryManager';\nimport { ITEM_DB } from '../data/items';\n\n/**\n * Storage/Chest UI — split panel with chest contents (left) and\n * player inventory (right). Click to transfer items between panels.\n */\nexport class StorageUI extends UIPanel {\n  /** Current storage slots being viewed */\n  private storageSlots: InventorySlot[] = [];\n  private storageId: string = '';\n\n  // Dynamic elements\n  private chestTexts: Phaser.GameObjects.Text[] = [];\n  private playerTexts: Phaser.GameObjects.Text[] = [];\n  private statusText!: Phaser.GameObjects.Text;\n\n  /** Callback when storage contents change */\n  private onChangeCallback: ((storageId: string, slots: InventorySlot[]) => void) | null = null;\n\n  constructor(scene: Phaser.Scene) {\n    super(scene, 50, 50, 700, 460, 'Storage');\n  }\n\n  /** Open with specific storage data */\n  openWithStorage(storageId: string, slots: InventorySlot[], onChange?: (id: string, slots: InventorySlot[]) => void): void {\n    this.storageId = storageId;\n    this.storageSlots = slots.map(s => ({ ...s }));\n    this.onChangeCallback = onChange ?? null;\n    this.open();\n  }\n\n  protected buildContent(): void {\n    // Column headers\n    const chestHeader = this.scene.add.text(12, 38, 'CHEST', {\n      fontFamily: 'monospace', fontSize: '11px', color: '#ffcc00', fontStyle: 'bold',\n    });\n    const invHeader = this.scene.add.text(360, 38, 'INVENTORY', {\n      fontFamily: 'monospace', fontSize: '11px', color: '#88ccff', fontStyle: 'bold',\n    });\n    this.container.add(chestHeader);\n    this.container.add(invHeader);\n\n    // Divider\n    const divider = this.scene.add.graphics();\n    divider.lineStyle(1, 0x7dd3fc, 0.3);\n    divider.lineBetween(348, 36, 348, 450);\n    this.container.add(divider);\n\n    // Status text\n    this.statusText = this.scene.add.text(12, 440, '', {\n      fontFamily: 'monospace', fontSize: '10px', color: '#aaaaaa',\n    });\n    this.container.add(this.statusText);\n  }\n\n  refresh(): void {\n    for (const t of this.chestTexts) t.destroy();\n    for (const t of this.playerTexts) t.destroy();\n    this.chestTexts = [];\n    this.playerTexts = [];\n\n    const inventoryManager = this.scene.registry.get('inventoryManager') as InventoryManager | undefined;\n\n    // --- Chest contents (left) ---\n    let y = 56;\n    for (let i = 0; i < this.storageSlots.length && y < 430; i++) {\n      const slot = this.storageSlots[i];\n      if (!slot.itemId) continue;\n\n      const itemDef = ITEM_DB.get(slot.itemId);\n      const name = itemDef?.name ?? slot.itemId;\n\n      const text = this.scene.add.text(16, y, `${name} x${slot.quantity}`, {\n        fontFamily: 'monospace', fontSize: '10px', color: '#ddddaa',\n      });\n      text.setInteractive({ useHandCursor: true });\n      text.on('pointerover', () => text.setColor('#ffffff'));\n      text.on('pointerout', () => text.setColor('#ddddaa'));\n      text.on('pointerdown', () => this.transferToInventory(i));\n\n      this.container.add(text);\n      this.chestTexts.push(text);\n      y += 16;\n    }\n\n    // --- Player inventory (right) ---\n    if (inventoryManager) {\n      y = 56;\n      const slots = inventoryManager.getSlots();\n      for (let i = 0; i < slots.length && y < 430; i++) {\n        const slot = slots[i];\n        if (!slot.itemId) continue;\n\n        const itemDef = ITEM_DB.get(slot.itemId);\n        const name = itemDef?.name ?? slot.itemId;\n\n        const text = this.scene.add.text(360, y, `${name} x${slot.quantity}`, {\n          fontFamily: 'monospace', fontSize: '10px', color: '#aaccff',\n        });\n        text.setInteractive({ useHandCursor: true });\n        text.on('pointerover', () => text.setColor('#ffffff'));\n        text.on('pointerout', () => text.setColor('#aaccff'));\n        text.on('pointerdown', () => this.transferToStorage(slot.itemId));\n\n        this.container.add(text);\n        this.playerTexts.push(text);\n        y += 16;\n      }\n    }\n  }\n\n  /** Move item from chest to player inventory */\n  private transferToInventory(slotIndex: number): void {\n    const slot = this.storageSlots[slotIndex];\n    if (!slot || !slot.itemId) return;\n\n    const inventoryManager = this.scene.registry.get('inventoryManager') as InventoryManager | undefined;\n    if (!inventoryManager) return;\n\n    const leftover = inventoryManager.addItem(slot.itemId, slot.quantity);\n    const moved = slot.quantity - leftover;\n\n    if (moved > 0) {\n      slot.quantity -= moved;\n      if (slot.quantity <= 0) {\n        slot.itemId = '';\n        slot.quantity = 0;\n      }\n      this.statusText.setText(`Took ${moved} items`);\n      this.notifyChange();\n      this.refresh();\n    } else {\n      this.statusText.setText('Inventory full!');\n    }\n  }\n\n  /** Move item from player inventory to chest */\n  private transferToStorage(itemId: string): void {\n    const inventoryManager = this.scene.registry.get('inventoryManager') as InventoryManager | undefined;\n    if (!inventoryManager) return;\n\n    const removed = inventoryManager.removeItem(itemId, 1);\n    if (removed <= 0) return;\n\n    // Find existing stack in chest or empty slot\n    let added = false;\n    for (const slot of this.storageSlots) {\n      if (slot.itemId === itemId && slot.quantity < 99) {\n        slot.quantity += 1;\n        added = true;\n        break;\n      }\n    }\n    if (!added) {\n      for (const slot of this.storageSlots) {\n        if (!slot.itemId) {\n          slot.itemId = itemId;\n          slot.quantity = 1;\n          added = true;\n          break;\n        }\n      }\n    }\n\n    if (!added) {\n      // Chest full, return to inventory\n      inventoryManager.addItem(itemId, 1);\n      this.statusText.setText('Chest full!');\n    } else {\n      this.statusText.setText(`Stored 1 item`);\n      this.notifyChange();\n    }\n\n    this.refresh();\n  }\n\n  private notifyChange(): void {\n    if (this.onChangeCallback) {\n      this.onChangeCallback(this.storageId, this.storageSlots);\n    }\n  }\n}\n","import Phaser from 'phaser';\nimport { UIPanel } from './UIBase';\nimport { MailManager, MailLetter } from '../systems/MailManager';\nimport { InventoryManager } from '../systems/InventoryManager';\n\n/**\n * Mail UI — inbox list with letter reading and attachment claiming.\n */\nexport class MailUI extends UIPanel {\n  private mailTexts: Phaser.GameObjects.Text[] = [];\n  private bodyText!: Phaser.GameObjects.Text;\n  private claimBtn!: Phaser.GameObjects.Text;\n  private selectedMail: MailLetter | null = null;\n\n  constructor(scene: Phaser.Scene) {\n    super(scene, 40, 40, 720, 440, 'Mail');\n  }\n\n  protected buildContent(): void {\n    // Letter body area (right side)\n    this.bodyText = this.scene.add.text(340, 42, 'Select a letter to read.', {\n      fontFamily: 'monospace', fontSize: '10px', color: '#cccccc',\n      wordWrap: { width: 360, useAdvancedWrap: true },\n    });\n    this.container.add(this.bodyText);\n\n    // Claim attachments button\n    this.claimBtn = this.scene.add.text(340, 400, '', {\n      fontFamily: 'monospace', fontSize: '11px', color: '#ffcc00',\n      backgroundColor: '#333333', padding: { x: 8, y: 4 },\n    });\n    this.claimBtn.setInteractive({ useHandCursor: true });\n    this.claimBtn.on('pointerdown', () => this.claimAttachments());\n    this.claimBtn.setVisible(false);\n    this.container.add(this.claimBtn);\n\n    // Divider\n    const divider = this.scene.add.graphics();\n    divider.lineStyle(1, 0x7dd3fc, 0.3);\n    divider.lineBetween(330, 36, 330, 430);\n    this.container.add(divider);\n  }\n\n  refresh(): void {\n    for (const t of this.mailTexts) t.destroy();\n    this.mailTexts = [];\n    this.selectedMail = null;\n    this.bodyText.setText('Select a letter to read.');\n    this.claimBtn.setVisible(false);\n\n    const mailManager = this.scene.registry.get('mailManager') as MailManager | undefined;\n    if (!mailManager) return;\n\n    const allMail = mailManager.getAllMail();\n    let y = 42;\n\n    for (let i = 0; i < allMail.length && y < 420; i++) {\n      const letter = allMail[i];\n      const unread = letter.readAt === null;\n      const prefix = unread ? '* ' : '  ';\n      const color = unread ? '#ffcc00' : '#888888';\n      const hasAttach = !letter.attachmentsClaimed && letter.attachments.length > 0 ? ' [!]' : '';\n\n      const text = this.scene.add.text(12, y, `${prefix}${letter.subject}${hasAttach}`, {\n        fontFamily: 'monospace', fontSize: '10px', color,\n      });\n      text.setInteractive({ useHandCursor: true });\n      text.on('pointerover', () => text.setColor('#ffffff'));\n      text.on('pointerout', () => text.setColor(color));\n      text.on('pointerdown', () => this.selectLetter(letter));\n\n      this.container.add(text);\n      this.mailTexts.push(text);\n      y += 16;\n    }\n\n    if (allMail.length === 0) {\n      const empty = this.scene.add.text(12, 50, 'No mail.', {\n        fontFamily: 'monospace', fontSize: '10px', color: '#666666',\n      });\n      this.container.add(empty);\n      this.mailTexts.push(empty);\n    }\n  }\n\n  private selectLetter(letter: MailLetter): void {\n    this.selectedMail = letter;\n\n    const mailManager = this.scene.registry.get('mailManager') as MailManager | undefined;\n    if (mailManager) {\n      const timeManager = this.scene.registry.get('timeManager') as { getDate: () => { day: number } } | undefined;\n      mailManager.markRead(letter.id, timeManager?.getDate().day ?? 0);\n    }\n\n    this.bodyText.setText(\n      `From: ${letter.senderId}\\n\\n${letter.body}`\n    );\n\n    // Show claim button if attachments unclaimed\n    if (!letter.attachmentsClaimed && letter.attachments.length > 0) {\n      const items = letter.attachments.map(a => a.gold ? `${a.gold}g` : `${a.itemId} x${a.quantity ?? 1}`).join(', ');\n      this.claimBtn.setText(`Claim: ${items}`);\n      this.claimBtn.setVisible(true);\n    } else {\n      this.claimBtn.setVisible(false);\n    }\n  }\n\n  private claimAttachments(): void {\n    if (!this.selectedMail) return;\n\n    const mailManager = this.scene.registry.get('mailManager') as MailManager | undefined;\n    const inventoryManager = this.scene.registry.get('inventoryManager') as InventoryManager | undefined;\n    if (!mailManager || !inventoryManager) return;\n\n    const attachments = mailManager.claimAttachments(this.selectedMail.id);\n    if (attachments) {\n      for (const a of attachments) {\n        if (a.gold) {\n          inventoryManager.addGold(a.gold);\n        }\n        if (a.itemId && a.quantity) {\n          inventoryManager.addItem(a.itemId, a.quantity);\n        }\n      }\n      this.claimBtn.setText('Claimed!');\n      this.claimBtn.setVisible(false);\n      this.refresh();\n    }\n  }\n}\n","import Phaser from 'phaser';\nimport { UIPanel } from './UIBase';\nimport { CareerManager, CAREERS } from '../systems/CareerManager';\n\n/**\n * Career UI — career selection, level/XP display, and specialization choices.\n */\nexport class CareerUI extends UIPanel {\n  private dynamicTexts: Phaser.GameObjects.Text[] = [];\n\n  constructor(scene: Phaser.Scene) {\n    super(scene, 60, 60, 680, 420, 'Career');\n  }\n\n  protected buildContent(): void {\n    // Built dynamically in refresh\n  }\n\n  refresh(): void {\n    for (const t of this.dynamicTexts) t.destroy();\n    this.dynamicTexts = [];\n\n    const careerMgr = this.scene.registry.get('careerManager') as CareerManager | undefined;\n    if (!careerMgr) return;\n\n    const style = { fontFamily: 'monospace', fontSize: '10px', color: '#cccccc' };\n\n    if (!careerMgr.hasCareer()) {\n      // Career selection view\n      const header = this.scene.add.text(12, 42, 'Choose a career (permanent choice):', {\n        fontFamily: 'monospace', fontSize: '12px', color: '#ffcc00',\n      });\n      this.container.add(header);\n      this.dynamicTexts.push(header);\n\n      let y = 68;\n      for (const career of CAREERS) {\n        const btn = this.scene.add.text(16, y, `[${career.name}]`, {\n          fontFamily: 'monospace', fontSize: '11px', color: '#88ccff',\n        }).setInteractive({ useHandCursor: true });\n        btn.on('pointerover', () => btn.setColor('#ffffff'));\n        btn.on('pointerout', () => btn.setColor('#88ccff'));\n        btn.on('pointerdown', () => {\n          careerMgr.selectCareer(career.id);\n          this.refresh();\n        });\n        this.container.add(btn);\n        this.dynamicTexts.push(btn);\n\n        const desc = this.scene.add.text(180, y, career.description, {\n          ...style, wordWrap: { width: 480, useAdvancedWrap: true },\n        });\n        this.container.add(desc);\n        this.dynamicTexts.push(desc);\n\n        y += 40;\n      }\n    } else {\n      // Career progress view\n      const career = careerMgr.getCareer()!;\n      const level = careerMgr.getCareerLevel();\n      const xpInfo = careerMgr.getCareerXP();\n\n      const title = this.scene.add.text(12, 42, `${career.name} — Level ${level}`, {\n        fontFamily: 'monospace', fontSize: '14px', color: '#ffcc00',\n      });\n      this.container.add(title);\n      this.dynamicTexts.push(title);\n\n      const desc = this.scene.add.text(12, 62, career.description, {\n        ...style, color: '#999999', wordWrap: { width: 640, useAdvancedWrap: true },\n      });\n      this.container.add(desc);\n      this.dynamicTexts.push(desc);\n\n      const xpText = this.scene.add.text(12, 90, `XP: ${xpInfo.current}/${xpInfo.required}   |   Income: x${career.bonuses.incomeMultiplier}   |   XP Bonus: x${career.bonuses.xpMultiplier}`, style);\n      this.container.add(xpText);\n      this.dynamicTexts.push(xpText);\n\n      // Specializations\n      const specHeader = this.scene.add.text(12, 120, 'Specializations:', {\n        fontFamily: 'monospace', fontSize: '11px', color: '#88ccff',\n      });\n      this.container.add(specHeader);\n      this.dynamicTexts.push(specHeader);\n\n      let y = 142;\n      for (const spec of career.specializations) {\n        const isSelected = careerMgr.hasSpecialization(spec.id);\n        const available = !isSelected && spec.level <= level;\n        const color = isSelected ? '#88ff88' : available ? '#ffcc00' : '#555555';\n        const prefix = isSelected ? '[x]' : available ? '[ ]' : '---';\n\n        const specText = this.scene.add.text(16, y,\n          `${prefix} Lv${spec.level}: ${spec.name} — ${spec.description}`, {\n            ...style, color,\n          });\n\n        if (available) {\n          specText.setInteractive({ useHandCursor: true });\n          specText.on('pointerover', () => specText.setColor('#ffffff'));\n          specText.on('pointerout', () => specText.setColor(color));\n          specText.on('pointerdown', () => {\n            careerMgr.selectSpecialization(spec.id);\n            this.refresh();\n          });\n        }\n\n        this.container.add(specText);\n        this.dynamicTexts.push(specText);\n        y += 22;\n      }\n    }\n  }\n}\n","import Phaser from 'phaser';\nimport { PlayerController } from '../entities/Player';\nimport { TimeManager } from '../systems/TimeManager';\nimport { InventoryManager } from '../systems/InventoryManager';\nimport { QuestManager } from '../systems/QuestManager';\nimport { SkillManager } from '../systems/SkillManager';\nimport { WeatherManager } from '../systems/WeatherManager';\nimport { MailManager } from '../systems/MailManager';\nimport { AbilityManager } from '../systems/AbilityManager';\nimport { ShadowWorldManager } from '../systems/ShadowWorldManager';\nimport { RiftManager } from '../systems/RiftManager';\nimport { InventoryUI } from '../ui/InventoryUI';\nimport { CraftingUI } from '../ui/CraftingUI';\nimport { QuestJournal } from '../ui/QuestJournal';\nimport { MapUI } from '../ui/MapUI';\nimport { SkillsUI } from '../ui/SkillsUI';\nimport { SettingsUI } from '../ui/SettingsUI';\nimport { ShopUI } from '../ui/ShopUI';\nimport { BestiaryUI } from '../ui/BestiaryUI';\nimport { StorageUI } from '../ui/StorageUI';\nimport { MailUI } from '../ui/MailUI';\nimport { CareerUI } from '../ui/CareerUI';\nimport { UIPanel } from '../ui/UIBase';\nimport { ITEM_DB } from '../data/items';\n\nexport class UIScene extends Phaser.Scene {\n  private healthBar!: Phaser.GameObjects.Graphics;\n  private staminaBar!: Phaser.GameObjects.Graphics;\n  private healthText!: Phaser.GameObjects.Text;\n  private staminaText!: Phaser.GameObjects.Text;\n  private clockText!: Phaser.GameObjects.Text;\n  private goldText!: Phaser.GameObjects.Text;\n  private xpBar!: Phaser.GameObjects.Graphics;\n  private xpText!: Phaser.GameObjects.Text;\n  private questTrackerText!: Phaser.GameObjects.Text;\n  private weatherIcon!: Phaser.GameObjects.Text;\n  private mailIndicator!: Phaser.GameObjects.Text;\n  private hotbarSlots: Phaser.GameObjects.Rectangle[] = [];\n  private hotbarItemTexts: Phaser.GameObjects.Text[] = [];\n  private hotbarQtyTexts: Phaser.GameObjects.Text[] = [];\n  private lastActiveHotbarSlot = -1;\n  private buffText!: Phaser.GameObjects.Text;\n\n  // Ability hotbar (F1-F4)\n  private abilitySlots: Phaser.GameObjects.Rectangle[] = [];\n  private abilityNameTexts: Phaser.GameObjects.Text[] = [];\n  private abilityCooldownBars: Phaser.GameObjects.Graphics[] = [];\n\n  // Shadow world / rift indicators\n  private shadowWorldText!: Phaser.GameObjects.Text;\n  private riftFloorText!: Phaser.GameObjects.Text;\n\n  // UI panels\n  private inventoryUI!: InventoryUI;\n  private craftingUI!: CraftingUI;\n  private questJournal!: QuestJournal;\n  private mapUI!: MapUI;\n  private skillsUI!: SkillsUI;\n  private settingsUI!: SettingsUI;\n  private shopUI!: ShopUI;\n  private bestiaryUI!: BestiaryUI;\n  private storageUI!: StorageUI;\n  private mailUI!: MailUI;\n  private careerUI!: CareerUI;\n  private allPanels: UIPanel[] = [];\n\n  constructor() {\n    super({ key: 'UIScene' });\n  }\n\n  create(): void {\n    // Version label\n    this.add.text(8, 8, 'EDILAS v1.0.0-dev', {\n      fontFamily: 'monospace', fontSize: '12px', color: '#555555',\n    }).setScrollFactor(0).setDepth(1000);\n\n    const textStyle: Phaser.Types.GameObjects.Text.TextStyle = {\n      fontFamily: 'monospace', fontSize: '11px', color: '#ffffff',\n    };\n\n    // Health bar (top-left)\n    this.healthBar = this.add.graphics().setScrollFactor(0).setDepth(1000);\n    this.healthText = this.add.text(18, 30, 'HP', textStyle).setScrollFactor(0).setDepth(1001);\n\n    // Stamina bar (below health)\n    this.staminaBar = this.add.graphics().setScrollFactor(0).setDepth(1000);\n    this.staminaText = this.add.text(18, 50, 'SP', textStyle).setScrollFactor(0).setDepth(1001);\n\n    // Clock (top-right)\n    this.clockText = this.add.text(0, 30, '', {\n      fontFamily: 'monospace', fontSize: '12px', color: '#ffb347',\n      backgroundColor: '#000000aa', padding: { x: 4, y: 2 },\n    }).setScrollFactor(0).setDepth(1001);\n\n    // XP bar (below stamina)\n    this.xpBar = this.add.graphics().setScrollFactor(0).setDepth(1000);\n    this.xpText = this.add.text(18, 70, 'XP', textStyle).setScrollFactor(0).setDepth(1001);\n\n    // Gold counter (below XP)\n    this.goldText = this.add.text(18, 90, 'Gold: 0', {\n      fontFamily: 'monospace', fontSize: '11px', color: '#ffcc00',\n    }).setScrollFactor(0).setDepth(1001);\n\n    // Weather indicator (top-right, below clock)\n    this.weatherIcon = this.add.text(0, 50, '', {\n      fontFamily: 'monospace', fontSize: '10px', color: '#88ccff',\n      backgroundColor: '#000000aa', padding: { x: 4, y: 2 },\n    }).setScrollFactor(0).setDepth(1001);\n\n    // Quest tracker (right side, below weather)\n    this.questTrackerText = this.add.text(0, 74, '', {\n      fontFamily: 'monospace', fontSize: '10px', color: '#aaccff',\n      backgroundColor: '#00000088', padding: { x: 6, y: 4 },\n      wordWrap: { width: 220 },\n    }).setScrollFactor(0).setDepth(1001);\n\n    // Mail indicator (below gold)\n    this.mailIndicator = this.add.text(18, 108, '', {\n      fontFamily: 'monospace', fontSize: '10px', color: '#ffaa44',\n    }).setScrollFactor(0).setDepth(1001);\n\n    // Active buffs display (above hotbar)\n    this.buffText = this.add.text(0, 0, '', {\n      fontFamily: 'monospace', fontSize: '10px', color: '#88ffaa',\n      backgroundColor: '#00000088', padding: { x: 4, y: 2 },\n    }).setScrollFactor(0).setDepth(1001).setVisible(false);\n\n    // Hotbar (bottom-center, 10 slots)\n    this.createHotbar();\n\n    // Ability hotbar (F1-F4, above main hotbar)\n    this.createAbilityHotbar();\n\n    // Shadow world indicator (left side, below mail)\n    this.shadowWorldText = this.add.text(18, 126, '', {\n      fontFamily: 'monospace', fontSize: '10px', color: '#cc88ff',\n      backgroundColor: '#220033aa', padding: { x: 4, y: 2 },\n    }).setScrollFactor(0).setDepth(1001).setVisible(false);\n\n    // Rift floor indicator (left side, below shadow world)\n    this.riftFloorText = this.add.text(18, 146, '', {\n      fontFamily: 'monospace', fontSize: '10px', color: '#ff88cc',\n      backgroundColor: '#330022aa', padding: { x: 4, y: 2 },\n    }).setScrollFactor(0).setDepth(1001).setVisible(false);\n\n    // --- Instantiate all UI panels ---\n    this.inventoryUI = new InventoryUI(this);\n    this.craftingUI = new CraftingUI(this);\n    this.questJournal = new QuestJournal(this);\n    this.mapUI = new MapUI(this);\n    this.skillsUI = new SkillsUI(this);\n    this.settingsUI = new SettingsUI(this);\n    this.shopUI = new ShopUI(this);\n    this.bestiaryUI = new BestiaryUI(this);\n    this.storageUI = new StorageUI(this);\n    this.mailUI = new MailUI(this);\n    this.careerUI = new CareerUI(this);\n\n    this.allPanels = [\n      this.inventoryUI,\n      this.craftingUI,\n      this.questJournal,\n      this.mapUI,\n      this.skillsUI,\n      this.settingsUI,\n      this.shopUI,\n      this.bestiaryUI,\n      this.storageUI,\n      this.mailUI,\n      this.careerUI,\n    ];\n\n    // Expose UI panels to other scenes via registry\n    this.registry.set('bestiaryUI', this.bestiaryUI);\n\n    // --- Register keybinds ---\n    this.registerKeybinds();\n  }\n\n  private createHotbar(): void {\n    const slotSize = 40;\n    const gap = 4;\n    const totalW = 10 * slotSize + 9 * gap;\n    const startX = (this.cameras.main.width - totalW) / 2;\n    const y = this.cameras.main.height - slotSize - 10;\n\n    for (let i = 0; i < 10; i++) {\n      const x = startX + i * (slotSize + gap);\n      const slot = this.add.rectangle(x + slotSize / 2, y + slotSize / 2, slotSize, slotSize, 0x222222, 0.7);\n      slot.setStrokeStyle(1, 0x7dd3fc, 0.5);\n      slot.setScrollFactor(0).setDepth(1000);\n      this.hotbarSlots.push(slot);\n\n      // Key label\n      const label = String(i === 9 ? 0 : i + 1);\n      this.add.text(x + 2, y + 2, label, {\n        fontFamily: 'monospace', fontSize: '9px', color: '#666666',\n      }).setScrollFactor(0).setDepth(1001);\n\n      // Item name text (centered in slot)\n      const itemText = this.add.text(x + slotSize / 2, y + slotSize / 2 - 2, '', {\n        fontFamily: 'monospace', fontSize: '8px', color: '#dddddd',\n        align: 'center',\n      }).setOrigin(0.5).setScrollFactor(0).setDepth(1002);\n      this.hotbarItemTexts.push(itemText);\n\n      // Quantity text (bottom-right of slot)\n      const qtyText = this.add.text(x + slotSize - 3, y + slotSize - 3, '', {\n        fontFamily: 'monospace', fontSize: '8px', color: '#aaffaa',\n      }).setOrigin(1, 1).setScrollFactor(0).setDepth(1002);\n      this.hotbarQtyTexts.push(qtyText);\n    }\n  }\n\n  private createAbilityHotbar(): void {\n    const slotSize = 36;\n    const gap = 4;\n    const totalW = 4 * slotSize + 3 * gap;\n    const mainHotbarY = this.cameras.main.height - 40 - 10;\n    const y = mainHotbarY - slotSize - 8;\n    const startX = (this.cameras.main.width - totalW) / 2;\n\n    for (let i = 0; i < 4; i++) {\n      const x = startX + i * (slotSize + gap);\n      const slot = this.add.rectangle(x + slotSize / 2, y + slotSize / 2, slotSize, slotSize, 0x1a1a2e, 0.7);\n      slot.setStrokeStyle(1, 0x9966cc, 0.5);\n      slot.setScrollFactor(0).setDepth(1000);\n      this.abilitySlots.push(slot);\n\n      // F-key label\n      this.add.text(x + 2, y + 2, `F${i + 1}`, {\n        fontFamily: 'monospace', fontSize: '8px', color: '#666666',\n      }).setScrollFactor(0).setDepth(1001);\n\n      // Ability name\n      const nameText = this.add.text(x + slotSize / 2, y + slotSize / 2 + 2, '', {\n        fontFamily: 'monospace', fontSize: '7px', color: '#cc88ff',\n        align: 'center',\n      }).setOrigin(0.5).setScrollFactor(0).setDepth(1002);\n      this.abilityNameTexts.push(nameText);\n\n      // Cooldown overlay\n      const cdBar = this.add.graphics().setScrollFactor(0).setDepth(1003);\n      this.abilityCooldownBars.push(cdBar);\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Keybinds\n  // ---------------------------------------------------------------------------\n\n  private registerKeybinds(): void {\n    if (!this.input.keyboard) return;\n\n    // I or Tab = Inventory\n    this.input.keyboard.on('keydown-I', () => this.togglePanel(this.inventoryUI));\n    this.input.keyboard.on('keydown-TAB', (e: KeyboardEvent) => {\n      e.preventDefault();\n      this.togglePanel(this.inventoryUI);\n    });\n\n    // C = Crafting\n    this.input.keyboard.on('keydown-C', () => this.togglePanel(this.craftingUI));\n\n    // J = Quest Journal\n    this.input.keyboard.on('keydown-J', () => this.togglePanel(this.questJournal));\n\n    // M = Map\n    this.input.keyboard.on('keydown-M', () => this.togglePanel(this.mapUI));\n\n    // K = Skills\n    this.input.keyboard.on('keydown-K', () => this.togglePanel(this.skillsUI));\n\n    // B = Bestiary\n    this.input.keyboard.on('keydown-B', () => this.togglePanel(this.bestiaryUI));\n\n    // N = Mail\n    this.input.keyboard.on('keydown-N', () => this.togglePanel(this.mailUI));\n\n    // R = Career\n    this.input.keyboard.on('keydown-R', () => this.togglePanel(this.careerUI));\n\n    // ESC = Settings (or close any open panel)\n    this.input.keyboard.on('keydown-ESC', () => {\n      // If any panel other than settings is open, close it\n      const openPanel = this.allPanels.find(p => p.getIsOpen());\n      if (openPanel && openPanel !== this.settingsUI) {\n        openPanel.close();\n        this.updateUIBlockingState();\n      } else {\n        // Toggle settings\n        this.togglePanel(this.settingsUI);\n      }\n    });\n  }\n\n  /**\n   * Toggle a specific panel. Closes all other panels first to ensure\n   * only one panel is open at a time.\n   */\n  private togglePanel(panel: UIPanel): void {\n    if (panel.getIsOpen()) {\n      panel.close();\n    } else {\n      // Close all other panels\n      for (const p of this.allPanels) {\n        if (p !== panel && p.getIsOpen()) {\n          p.close();\n        }\n      }\n      panel.open();\n    }\n\n    this.updateUIBlockingState();\n  }\n\n  /**\n   * Set the `uiPanelOpen` registry flag so OverworldScene can block player\n   * input while a panel is visible.\n   */\n  private updateUIBlockingState(): void {\n    const anyOpen = this.allPanels.some(p => p.getIsOpen());\n    this.registry.set('uiPanelOpen', anyOpen);\n  }\n\n  // ---------------------------------------------------------------------------\n  // Public API for programmatic panel access\n  // ---------------------------------------------------------------------------\n\n  getShopUI(): ShopUI { return this.shopUI; }\n  getBestiaryUI(): BestiaryUI { return this.bestiaryUI; }\n  getStorageUI(): StorageUI { return this.storageUI; }\n  getMapUI(): MapUI { return this.mapUI; }\n\n  openShop(items: { itemId: string; name: string; price: number; description: string }[], sellMult = 0.4): void {\n    for (const p of this.allPanels) { if (p.getIsOpen()) p.close(); }\n    this.shopUI.openWithItems(items, sellMult);\n    this.updateUIBlockingState();\n  }\n\n  openStorage(storageId: string, slots: import('../systems/InventoryManager').InventorySlot[], onChange?: (id: string, slots: import('../systems/InventoryManager').InventorySlot[]) => void): void {\n    for (const p of this.allPanels) { if (p.getIsOpen()) p.close(); }\n    this.storageUI.openWithStorage(storageId, slots, onChange);\n    this.updateUIBlockingState();\n  }\n\n  // ---------------------------------------------------------------------------\n  // Update\n  // ---------------------------------------------------------------------------\n\n  update(): void {\n    const playerController = this.registry.get('playerController') as PlayerController | undefined;\n    const timeManager = this.registry.get('timeManager') as TimeManager | undefined;\n    const inventoryManager = this.registry.get('inventoryManager') as InventoryManager | undefined;\n    const questManager = this.registry.get('questManager') as QuestManager | undefined;\n    const skillManager = this.registry.get('skillManager') as SkillManager | undefined;\n    const weatherManager = this.registry.get('weatherManager') as WeatherManager | undefined;\n    const mailManager = this.registry.get('mailManager') as MailManager | undefined;\n    const w = this.cameras.main.width;\n\n    if (playerController) {\n      const hp = playerController.getHealth();\n      const sp = playerController.getStamina();\n      this.drawBar(this.healthBar, 16, 28, 160, 14, hp.current / hp.max, 0xcc3333, 0x441111);\n      this.drawBar(this.staminaBar, 16, 48, 160, 14, sp.current / sp.max, 0x33cc33, 0x114411);\n      this.healthText.setText(`HP ${Math.ceil(hp.current)}/${hp.max}`);\n      this.staminaText.setText(`SP ${Math.ceil(sp.current)}/${sp.max}`);\n    }\n\n    // XP bar from combat skill\n    if (skillManager) {\n      const xpInfo = skillManager.getXP('combat');\n      const combatLevel = skillManager.getLevel('combat');\n      const xpProgress = xpInfo.required > 0 ? xpInfo.current / xpInfo.required : 0;\n      this.drawBar(this.xpBar, 16, 68, 160, 10, xpProgress, 0x4488ff, 0x112244);\n      this.xpText.setText(`Lv.${combatLevel} XP ${xpInfo.current}/${xpInfo.required}`);\n    }\n\n    // Gold counter\n    if (inventoryManager) {\n      this.goldText.setText(`Gold: ${inventoryManager.getGold()}`);\n    }\n\n    // Clock + season\n    if (timeManager) {\n      const date = timeManager.getDate();\n      this.clockText.setText(`${timeManager.getTimeString()} ${date.season} Day ${date.day}`);\n      this.clockText.setPosition(w - this.clockText.width - 16, 30);\n    }\n\n    // Weather indicator\n    if (weatherManager) {\n      const weatherType = weatherManager.getWeatherType();\n      const WEATHER_ICONS: Record<string, string> = {\n        clear: 'Clear', rain: 'Rain', storm: 'Storm', snow: 'Snow',\n        fog: 'Fog', sandstorm: 'Sand', ember_rain: 'Ember', acid_rain: 'Acid',\n        spore_cloud: 'Spore', void_storm: 'Void',\n      };\n      this.weatherIcon.setText(WEATHER_ICONS[weatherType] ?? weatherType);\n      this.weatherIcon.setPosition(w - this.weatherIcon.width - 16, 50);\n    }\n\n    // Quest tracker — show active tracked quest with objective progress\n    if (questManager) {\n      const active = questManager.getActiveQuests();\n      if (active.length > 0) {\n        const q = active[0];\n        let text = `[Quest] ${q.quest.name}\\n`;\n        for (let i = 0; i < q.quest.objectives.length; i++) {\n          const obj = q.quest.objectives[i];\n          const cur = q.progress[i] ?? 0;\n          const done = cur >= obj.count;\n          text += `${done ? '[x]' : '[ ]'} ${obj.description} (${cur}/${obj.count})\\n`;\n        }\n        this.questTrackerText.setText(text.trimEnd());\n        this.questTrackerText.setPosition(w - 230, 74);\n        this.questTrackerText.setVisible(true);\n      } else {\n        this.questTrackerText.setVisible(false);\n      }\n    }\n\n    // Mail indicator\n    if (mailManager) {\n      const unread = mailManager.getUnreadCount();\n      if (unread > 0) {\n        this.mailIndicator.setText(`Mail (${unread})`);\n        this.mailIndicator.setVisible(true);\n      } else {\n        this.mailIndicator.setVisible(false);\n      }\n    }\n\n    // Active buffs display (above hotbar)\n    const activeBuffs = this.registry.get('activeBuffs') as { type: string; magnitude: number; remaining: number }[] | undefined;\n    if (activeBuffs && activeBuffs.length > 0) {\n      const buffStrs = activeBuffs.map(b => `${b.type} +${b.magnitude} (${Math.ceil(b.remaining)}s)`);\n      this.buffText.setText(buffStrs.join('  |  '));\n      const hotbarY = this.cameras.main.height - 40 - 10;\n      this.buffText.setPosition(this.cameras.main.width / 2, hotbarY - 18).setOrigin(0.5);\n      this.buffText.setVisible(true);\n    } else {\n      this.buffText.setVisible(false);\n    }\n\n    // Hotbar: item display + active slot highlight\n    if (inventoryManager) {\n      const activeSlot = (this.registry.get('hotbarSlot') as number) ?? 0;\n\n      for (let i = 0; i < 10; i++) {\n        const slot = inventoryManager.getSlot(i);\n        const itemText = this.hotbarItemTexts[i];\n        const qtyText = this.hotbarQtyTexts[i];\n        const rect = this.hotbarSlots[i];\n\n        if (slot && slot.itemId) {\n          const def = ITEM_DB.get(slot.itemId);\n          // Show short name (max 5 chars)\n          const name = def?.name ?? slot.itemId;\n          itemText.setText(name.length > 6 ? name.slice(0, 5) + '.' : name);\n          qtyText.setText(slot.quantity > 1 ? `${slot.quantity}` : '');\n\n          // Color by category\n          const cat = def?.category;\n          if (cat === 'food' || cat === 'potion') {\n            itemText.setColor('#88ff88');\n          } else if (cat === 'tool') {\n            itemText.setColor('#ffcc44');\n          } else {\n            itemText.setColor('#dddddd');\n          }\n        } else {\n          itemText.setText('');\n          qtyText.setText('');\n        }\n\n        // Highlight active slot\n        if (i === activeSlot) {\n          rect.setStrokeStyle(2, 0xffcc00, 1);\n        } else {\n          rect.setStrokeStyle(1, 0x7dd3fc, 0.5);\n        }\n      }\n    }\n\n    // Ability hotbar (F1-F4)\n    const abilityManager = this.registry.get('abilityManager') as AbilityManager | undefined;\n    if (abilityManager) {\n      const hotbar = abilityManager.getHotbar();\n      const slotSize = 36;\n      const gap = 4;\n      const totalW = 4 * slotSize + 3 * gap;\n      const mainHotbarY = this.cameras.main.height - 40 - 10;\n      const aby = mainHotbarY - slotSize - 8;\n      const abStartX = (this.cameras.main.width - totalW) / 2;\n\n      for (let i = 0; i < 4; i++) {\n        const abilityId = hotbar[i];\n        const nameText = this.abilityNameTexts[i];\n        const cdBar = this.abilityCooldownBars[i];\n        cdBar.clear();\n\n        if (abilityId) {\n          const ability = abilityManager.getAbility(abilityId);\n          if (ability) {\n            nameText.setText(ability.name.length > 6 ? ability.name.slice(0, 5) + '.' : ability.name);\n            // Draw cooldown overlay\n            const cdFrac = ability.cooldown > 0 ? abilityManager.getCooldown(abilityId) / ability.cooldown : 0;\n            if (cdFrac > 0) {\n              const ax = abStartX + i * (slotSize + gap);\n              const fillH = slotSize * cdFrac;\n              cdBar.fillStyle(0x000000, 0.6);\n              cdBar.fillRect(ax, aby + (slotSize - fillH), slotSize, fillH);\n            }\n          } else {\n            nameText.setText('');\n          }\n        } else {\n          nameText.setText('');\n        }\n      }\n    }\n\n    // Shadow world indicator\n    const shadowWorldManager = this.registry.get('shadowWorldManager') as ShadowWorldManager | undefined;\n    if (shadowWorldManager) {\n      if (shadowWorldManager.isInShadowWorld()) {\n        this.shadowWorldText.setText('SHADOW WORLD');\n        this.shadowWorldText.setVisible(true);\n      } else if (shadowWorldManager.isChanneling()) {\n        this.shadowWorldText.setText('Channeling...');\n        this.shadowWorldText.setVisible(true);\n      } else {\n        const cd = shadowWorldManager.getCooldownRemaining();\n        if (cd > 0) {\n          this.shadowWorldText.setText(`Shadow CD: ${Math.ceil(cd / 1000)}s`);\n          this.shadowWorldText.setVisible(true);\n        } else {\n          this.shadowWorldText.setVisible(false);\n        }\n      }\n    }\n\n    // Rift floor indicator\n    const riftManager = this.registry.get('riftManager') as RiftManager | undefined;\n    if (riftManager) {\n      const floor = riftManager.getCurrentFloor();\n      if (floor) {\n        this.riftFloorText.setText(`Rift Floor ${floor.floor}`);\n        this.riftFloorText.setVisible(true);\n      } else {\n        this.riftFloorText.setVisible(false);\n      }\n    }\n\n    // Keep the blocking state fresh\n    this.updateUIBlockingState();\n  }\n\n  private drawBar(\n    gfx: Phaser.GameObjects.Graphics,\n    x: number, y: number, w: number, h: number,\n    fill: number, color: number, bgColor: number,\n  ): void {\n    gfx.clear();\n    gfx.fillStyle(bgColor, 0.8);\n    gfx.fillRoundedRect(x, y, w, h, 3);\n    gfx.fillStyle(color, 0.9);\n    gfx.fillRoundedRect(x, y, w * Math.max(0, Math.min(1, fill)), h, 3);\n    gfx.lineStyle(1, 0xffffff, 0.2);\n    gfx.strokeRoundedRect(x, y, w, h, 3);\n  }\n}\n","import Phaser from 'phaser';\nimport { NPCDef } from '../data/npcs';\nimport { RelationshipManager } from '../systems/RelationshipManager';\nimport { RomanceManager } from '../systems/RomanceManager';\nimport { QuestManager } from '../systems/QuestManager';\nimport { InventoryManager } from '../systems/InventoryManager';\nimport { QuestDef } from '../types/quest';\nimport { CITIES } from '../data/cities';\nimport { ITEM_DB } from '../data/items';\n\ninterface DialogueState {\n  npcId: string;\n  npcName: string;\n  npcDef: NPCDef;\n  lines: string[];\n  lineIndex: number;\n  choices: DialogueChoice[] | null;\n  mode: 'talk' | 'shop' | 'quest_offer' | 'quest_complete' | 'gift_select';\n  questDef: QuestDef | null;\n  completableQuestIds: string[];\n}\n\ninterface DialogueChoice {\n  text: string;\n  action: () => void;\n}\n\n/**\n * Modal overlay scene for NPC dialogue, quest offers, shop, and gift interactions.\n * Launched on top of OverworldScene when player interacts with an NPC.\n */\nexport class DialogueScene extends Phaser.Scene {\n  private dialogueBox!: Phaser.GameObjects.Graphics;\n  private nameText!: Phaser.GameObjects.Text;\n  private dialogueText!: Phaser.GameObjects.Text;\n  private promptText!: Phaser.GameObjects.Text;\n  private choiceTexts: Phaser.GameObjects.Text[] = [];\n  private state: DialogueState | null = null;\n  private backdrop!: Phaser.GameObjects.Rectangle;\n\n  // Shop overlay elements\n  private shopItems: Phaser.GameObjects.Text[] = [];\n  private shopTitle: Phaser.GameObjects.Text | null = null;\n  private shopGold: Phaser.GameObjects.Text | null = null;\n\n  // Gift overlay elements\n  private giftItems: Phaser.GameObjects.Text[] = [];\n\n  // Typewriter state\n  private typewriterTimer?: Phaser.Time.TimerEvent;\n  private fullText = '';\n  private displayedChars = 0;\n  private typewriterComplete = true;\n\n  constructor() {\n    super({ key: 'DialogueScene' });\n  }\n\n  create(): void {\n    const { width, height } = this.cameras.main;\n\n    // Semi-transparent backdrop\n    this.backdrop = this.add.rectangle(width / 2, height / 2, width, height, 0x000000, 0.3);\n    this.backdrop.setScrollFactor(0).setDepth(9000);\n    this.backdrop.setInteractive(); // Block clicks through\n\n    // Dialogue box at bottom\n    this.dialogueBox = this.add.graphics();\n    this.dialogueBox.setScrollFactor(0).setDepth(9001);\n    this.drawDialogueBox(width, height);\n\n    // Compute box position for text placement\n    const boxW = width * 0.8;\n    const boxH = 150;\n    const boxX = (width - boxW) / 2;\n    const boxY = height - boxH - 20;\n\n    // NPC name (cyan)\n    this.nameText = this.add.text(boxX + 16, boxY + 10, '', {\n      fontFamily: 'monospace', fontSize: '14px', color: '#7dd3fc',\n      fontStyle: 'bold',\n    }).setScrollFactor(0).setDepth(9002);\n\n    // Dialogue text\n    this.dialogueText = this.add.text(boxX + 16, boxY + 32, '', {\n      fontFamily: 'monospace', fontSize: '12px', color: '#ffffff',\n      wordWrap: { width: boxW - 32 },\n      lineSpacing: 4,\n    }).setScrollFactor(0).setDepth(9002);\n\n    // Prompt text\n    this.promptText = this.add.text(boxX + boxW - 12, boxY + boxH - 8, '[Space] Continue', {\n      fontFamily: 'monospace', fontSize: '10px', color: '#888888',\n    }).setOrigin(1, 1).setScrollFactor(0).setDepth(9002);\n\n    // Input\n    this.input.keyboard!.on('keydown-SPACE', () => this.advance());\n    this.input.keyboard!.on('keydown-ENTER', () => this.advance());\n    this.input.keyboard!.on('keydown-ESC', () => this.closeDialogue());\n\n    // Hide everything initially\n    this.setVisible(false);\n  }\n\n  /** Open dialogue with an NPC */\n  openDialogue(npc: NPCDef): void {\n    const relationshipMgr = this.registry.get('relationshipManager') as RelationshipManager | undefined;\n    const questMgr = this.registry.get('questManager') as QuestManager | undefined;\n\n    // Build dialogue lines\n    const lines: string[] = [npc.dialogue.greeting];\n\n    // Add friendship-based dialogue\n    if (relationshipMgr) {\n      const hearts = relationshipMgr.getHearts(npc.id);\n      const unlocked = relationshipMgr.getUnlockedDialogue(npc.id);\n      if (unlocked.length > 0) {\n        lines.push(unlocked[unlocked.length - 1]);\n      }\n      if (hearts >= 3) {\n        lines.push(`We've become good friends, haven't we?`);\n      }\n    }\n\n    // Check for available quests\n    let questDef: QuestDef | null = null;\n    const completableQuestIds: string[] = [];\n    if (questMgr) {\n      for (const qId of npc.questIds) {\n        // Check for turn-in-able quests (status === 'complete')\n        if (questMgr.getQuestStatus(qId) === 'complete') {\n          completableQuestIds.push(qId);\n        }\n        // Check for new quests to accept\n        if (!questDef && questMgr.canAccept(qId)) {\n          const q = questMgr.getQuestDef(qId);\n          if (q) {\n            questDef = q;\n          }\n        }\n      }\n    }\n\n    this.state = {\n      npcId: npc.id,\n      npcName: npc.name,\n      npcDef: npc,\n      lines,\n      lineIndex: 0,\n      choices: null,\n      mode: 'talk',\n      questDef,\n      completableQuestIds,\n    };\n\n    this.showCurrentLine();\n    this.setVisible(true);\n  }\n\n  /** Public API for simple dialogue display (non-NPC) */\n  showDialogue(\n    npcName: string,\n    text: string,\n    choices?: { text: string; next?: string }[],\n  ): void {\n    const lines = [text];\n    const dialogueChoices: DialogueChoice[] | null = choices\n      ? choices.map((c) => ({\n          text: c.text,\n          action: () => {\n            if (c.next) {\n              this.dialogueText.setText(c.next);\n              this.state!.choices = null;\n              this.clearChoices();\n              this.promptText.setText('[Space] Close');\n            } else {\n              this.closeDialogue();\n            }\n          },\n        }))\n      : null;\n\n    this.state = {\n      npcId: '__generic',\n      npcName,\n      npcDef: null as unknown as NPCDef,\n      lines,\n      lineIndex: 0,\n      choices: null,\n      mode: 'talk',\n      questDef: null,\n      completableQuestIds: [],\n    };\n\n    this.showCurrentLine();\n    this.setVisible(true);\n\n    // If choices provided, show them immediately after text\n    if (dialogueChoices && dialogueChoices.length > 0) {\n      // After typewriter finishes, display choices\n      const checkReady = this.time.addEvent({\n        delay: 50,\n        loop: true,\n        callback: () => {\n          if (this.typewriterComplete) {\n            checkReady.destroy();\n            this.state!.choices = dialogueChoices;\n            this.displayChoices(dialogueChoices);\n            this.promptText.setText('');\n          }\n        },\n      });\n    }\n  }\n\n  /** Advance to next line or show choices */\n  private advance(): void {\n    if (!this.state) return;\n\n    // If in shop/gift mode, ESC to exit\n    if (this.state.mode === 'shop' || this.state.mode === 'gift_select') {\n      this.exitShopOrGift();\n      return;\n    }\n\n    // If choices are visible, ignore space (must click a choice)\n    if (this.state.choices) return;\n\n    // If typewriter is still typing, complete it instantly\n    if (!this.typewriterComplete) {\n      this.completeTypewriter();\n      return;\n    }\n\n    this.state.lineIndex++;\n\n    if (this.state.lineIndex >= this.state.lines.length) {\n      // End of dialogue lines — show choices\n      this.showEndChoices();\n    } else {\n      this.showCurrentLine();\n    }\n  }\n\n  private showCurrentLine(): void {\n    if (!this.state) return;\n    this.nameText.setText(this.state.npcName);\n    this.clearChoices();\n    this.startTypewriter(this.state.lines[this.state.lineIndex]);\n    this.promptText.setText('[Space] Continue');\n  }\n\n  private startTypewriter(text: string): void {\n    this.stopTypewriter();\n    this.fullText = text;\n    this.displayedChars = 0;\n    this.typewriterComplete = false;\n    this.dialogueText.setText('');\n    this.typewriterTimer = this.time.addEvent({\n      delay: 30,\n      repeat: text.length - 1,\n      callback: () => {\n        this.displayedChars++;\n        this.dialogueText.setText(this.fullText.substring(0, this.displayedChars));\n        if (this.displayedChars >= this.fullText.length) {\n          this.typewriterComplete = true;\n        }\n      },\n    });\n  }\n\n  private completeTypewriter(): void {\n    this.stopTypewriter();\n    this.dialogueText.setText(this.fullText);\n    this.typewriterComplete = true;\n  }\n\n  private stopTypewriter(): void {\n    if (this.typewriterTimer) {\n      this.typewriterTimer.destroy();\n      this.typewriterTimer = undefined;\n    }\n  }\n\n  private showEndChoices(): void {\n    if (!this.state) return;\n\n    const choices: DialogueChoice[] = [];\n\n    // Quest turn-in (highest priority)\n    for (const qId of this.state.completableQuestIds) {\n      const questMgr = this.registry.get('questManager') as QuestManager | undefined;\n      const qd = questMgr?.getQuestDef(qId);\n      if (qd) {\n        choices.push({\n          text: `Turn in: ${qd.name}`,\n          action: () => this.turnInQuest(qId, qd),\n        });\n      }\n    }\n\n    // Quest offer\n    if (this.state.questDef) {\n      const qd = this.state.questDef;\n      choices.push({\n        text: `Quest: ${qd.name}`,\n        action: () => {\n          const questMgr = this.registry.get('questManager') as QuestManager | undefined;\n          if (questMgr) {\n            questMgr.acceptQuest(qd.id);\n          }\n          this.state!.choices = null;\n          this.clearChoices();\n          this.promptText.setText('[Space] Close');\n          this.state!.lines = [`${qd.dialogue.offer}\\n\\nQuest \"${qd.name}\" accepted!`];\n          this.state!.lineIndex = 0;\n          this.state!.questDef = null;\n          this.showCurrentLine();\n        },\n      });\n    }\n\n    // Shop (only if NPC has a shop)\n    if (this.state.npcDef.shop) {\n      choices.push({\n        text: 'Shop',\n        action: () => this.openShop(),\n      });\n    }\n\n    // Gift\n    choices.push({\n      text: 'Give Gift',\n      action: () => this.openGiftSelection(),\n    });\n\n    // Romance progression (bouquet / pendant)\n    const romanceMgr = this.registry.get('romanceManager') as RomanceManager | undefined;\n    const relationshipMgr = this.registry.get('relationshipManager') as RelationshipManager | undefined;\n    const inventoryMgr = this.registry.get('inventoryManager') as InventoryManager | undefined;\n    if (romanceMgr && relationshipMgr && inventoryMgr) {\n      const fp = relationshipMgr.getFriendshipPoints(this.state.npcId);\n      if (romanceMgr.canDateNPC(this.state.npcId, fp) && inventoryMgr.countItem('bouquet') > 0) {\n        choices.push({\n          text: 'Give Bouquet',\n          action: () => this.useBouquet(),\n        });\n      }\n      if (romanceMgr.canProposeNPC(this.state.npcId, fp) && inventoryMgr.countItem('pendant') > 0) {\n        choices.push({\n          text: 'Give Pendant',\n          action: () => this.usePendant(),\n        });\n      }\n    }\n\n    // Goodbye\n    choices.push({\n      text: 'Goodbye',\n      action: () => this.closeDialogue(),\n    });\n\n    this.state.choices = choices;\n    this.displayChoices(choices);\n    this.promptText.setText('');\n  }\n\n  // =========================================================================\n  // QUEST TURN-IN\n  // =========================================================================\n\n  private turnInQuest(questId: string, questDef: QuestDef): void {\n    const questMgr = this.registry.get('questManager') as QuestManager | undefined;\n    const inventoryMgr = this.registry.get('inventoryManager') as InventoryManager | undefined;\n    const skillMgr = this.registry.get('skillManager');\n\n    if (questMgr) {\n      questMgr.turnInQuest(questId);\n    }\n\n    // Grant rewards\n    const rewards = questDef.rewards;\n    if (rewards.gold > 0 && inventoryMgr) {\n      inventoryMgr.addGold(rewards.gold);\n    }\n    if (rewards.items.length > 0 && inventoryMgr) {\n      for (const reward of rewards.items) {\n        inventoryMgr.addItem(reward.itemId, reward.quantity);\n      }\n    }\n    if (rewards.xp > 0 && skillMgr) {\n      (skillMgr as { addXP: (skill: string, xp: number) => void }).addXP('combat', rewards.xp);\n    }\n\n    // Show completion text\n    const rewardText = questDef.dialogue?.complete ?? `Quest \"${questDef.name}\" complete!`;\n    this.state!.choices = null;\n    this.clearChoices();\n    this.dialogueText.setText(`${rewardText}\\n\\nRewards received!`);\n    this.promptText.setText('[Space] Close');\n\n    // Remove from completable list\n    const idx = this.state!.completableQuestIds.indexOf(questId);\n    if (idx >= 0) this.state!.completableQuestIds.splice(idx, 1);\n  }\n\n  // =========================================================================\n  // SHOP\n  // =========================================================================\n\n  private openShop(): void {\n    if (!this.state?.npcDef.shop) return;\n\n    this.state.mode = 'shop';\n    this.clearChoices();\n\n    const { width, height } = this.cameras.main;\n    const shopData = this.state.npcDef.shop;\n    const inventoryMgr = this.registry.get('inventoryManager') as InventoryManager | undefined;\n\n    // Find city shop items for this NPC\n    const npcCity = this.state.npcDef.homeCity;\n    const cityDef = CITIES.find(c => c.id === npcCity);\n    const cityShop = cityDef?.shops.find(s => s.shopId === this.state?.npcDef.id || s.items.length > 0);\n    const shopItemIds = cityShop?.items ?? shopData.items;\n\n    // Title\n    this.shopTitle = this.add.text(width / 2, 60, `${this.state.npcName}'s Shop`, {\n      fontFamily: 'monospace', fontSize: '16px', color: '#ffcc00', fontStyle: 'bold',\n      backgroundColor: '#111122ee', padding: { x: 12, y: 6 },\n    }).setOrigin(0.5).setScrollFactor(0).setDepth(9100);\n\n    // Gold display\n    const goldCount = inventoryMgr?.getGold() ?? 0;\n    this.shopGold = this.add.text(width - 40, 60, `Gold: ${goldCount}`, {\n      fontFamily: 'monospace', fontSize: '12px', color: '#ffdd44',\n      backgroundColor: '#111122ee', padding: { x: 8, y: 4 },\n    }).setOrigin(1, 0.5).setScrollFactor(0).setDepth(9100);\n\n    // Item list\n    const startY = 100;\n    const priceMultiplier = shopData.priceMultiplier;\n\n    for (let i = 0; i < shopItemIds.length && i < 12; i++) {\n      const itemId = shopItemIds[i];\n      const itemDef = ITEM_DB.get(itemId);\n      const name = itemDef?.name ?? itemId;\n      const basePrice = (itemDef as { buyPrice?: number } | undefined)?.buyPrice ?? 10;\n      const price = Math.ceil(basePrice * priceMultiplier);\n\n      const itemText = this.add.text(60, startY + i * 22, `${i + 1}. ${name}  -  ${price}g`, {\n        fontFamily: 'monospace', fontSize: '11px', color: '#aaffaa',\n      }).setScrollFactor(0).setDepth(9100).setInteractive({ useHandCursor: true });\n\n      itemText.on('pointerover', () => itemText.setColor('#ffffff'));\n      itemText.on('pointerout', () => itemText.setColor('#aaffaa'));\n      itemText.on('pointerdown', () => this.buyItem(itemId, price));\n\n      this.shopItems.push(itemText);\n    }\n\n    this.dialogueText.setText('Click an item to buy. [Space/ESC] to exit shop.');\n    this.promptText.setText('[Space] Exit Shop');\n  }\n\n  private buyItem(itemId: string, price: number): void {\n    const inventoryMgr = this.registry.get('inventoryManager') as InventoryManager | undefined;\n    if (!inventoryMgr) return;\n\n    const goldCount = inventoryMgr.getGold();\n    if (goldCount < price) {\n      this.dialogueText.setText(`Not enough gold! Need ${price}g, have ${goldCount}g.`);\n      return;\n    }\n\n    if (inventoryMgr.isFull()) {\n      this.dialogueText.setText('Inventory is full!');\n      return;\n    }\n\n    inventoryMgr.removeGold(price);\n    inventoryMgr.addItem(itemId, 1);\n    const remaining = inventoryMgr.getGold();\n\n    const itemDef = ITEM_DB.get(itemId);\n    const displayName = itemDef?.name ?? itemId;\n    this.dialogueText.setText(`Bought ${displayName}! Gold remaining: ${remaining}g`);\n    if (this.shopGold) {\n      this.shopGold.setText(`Gold: ${remaining}`);\n    }\n  }\n\n  // =========================================================================\n  // GIFT GIVING\n  // =========================================================================\n\n  private openGiftSelection(): void {\n    if (!this.state) return;\n\n    this.state.mode = 'gift_select';\n    this.clearChoices();\n\n    const inventoryMgr = this.registry.get('inventoryManager') as InventoryManager | undefined;\n    if (!inventoryMgr) {\n      this.dialogueText.setText('No inventory available.');\n      this.promptText.setText('[Space] Back');\n      return;\n    }\n\n    const slots = inventoryMgr.getAllSlots();\n    const giftableItems: { index: number; itemId: string; quantity: number }[] = [];\n\n    for (let i = 0; i < slots.length; i++) {\n      const slot = slots[i];\n      if (slot.itemId && slot.itemId !== 'gold_coin' && slot.quantity > 0) {\n        giftableItems.push({ index: i, itemId: slot.itemId, quantity: slot.quantity });\n      }\n    }\n\n    if (giftableItems.length === 0) {\n      this.dialogueText.setText('You have nothing to give...');\n      this.promptText.setText('[Space] Back');\n      return;\n    }\n\n    this.dialogueText.setText('Select an item to give:');\n    this.promptText.setText('[Space] Cancel');\n\n    const { height } = this.cameras.main;\n    const startY = height - 140;\n    const maxDisplay = Math.min(giftableItems.length, 6);\n\n    for (let i = 0; i < maxDisplay; i++) {\n      const gift = giftableItems[i];\n      const itemText = this.add.text(60, startY + i * 20, `${i + 1}. ${gift.itemId} x${gift.quantity}`, {\n        fontFamily: 'monospace', fontSize: '11px', color: '#ffaaff',\n      }).setScrollFactor(0).setDepth(9002).setInteractive({ useHandCursor: true });\n\n      itemText.on('pointerover', () => itemText.setColor('#ffffff'));\n      itemText.on('pointerout', () => itemText.setColor('#ffaaff'));\n      itemText.on('pointerdown', () => this.giveGift(gift.itemId));\n\n      this.giftItems.push(itemText);\n    }\n  }\n\n  private giveGift(itemId: string): void {\n    if (!this.state) return;\n\n    const inventoryMgr = this.registry.get('inventoryManager') as InventoryManager | undefined;\n    const relationshipMgr = this.registry.get('relationshipManager') as RelationshipManager | undefined;\n\n    if (!inventoryMgr || !relationshipMgr) return;\n\n    // Remove item from inventory\n    inventoryMgr.removeItem(itemId, 1);\n\n    // Give gift to NPC\n    const result = relationshipMgr.giveGift(this.state.npcId, itemId);\n\n    // Clear gift items\n    for (const t of this.giftItems) t.destroy();\n    this.giftItems = [];\n\n    // Show reaction\n    const reaction = result?.reaction ?? 'neutral';\n    let reactionText: string;\n    switch (reaction) {\n      case 'loved':\n        reactionText = `${this.state.npcName}: \"I love this! Thank you so much!\" (+${result?.points ?? 80} hearts)`;\n        break;\n      case 'liked':\n        reactionText = `${this.state.npcName}: \"Oh, how nice! Thank you!\" (+${result?.points ?? 45} hearts)`;\n        break;\n      case 'disliked':\n        reactionText = `${this.state.npcName}: \"Um... thanks, I guess.\" (${result?.points ?? -20} hearts)`;\n        break;\n      case 'hated':\n        reactionText = `${this.state.npcName}: \"Why would you give me this?!\" (${result?.points ?? -40} hearts)`;\n        break;\n      default:\n        reactionText = result === null\n          ? `${this.state.npcName}: \"I've already received a gift today.\"`\n          : `${this.state.npcName}: \"Thank you for the gift.\"`;\n    }\n\n    this.state.mode = 'talk';\n    this.dialogueText.setText(reactionText);\n    this.promptText.setText('[Space] Close');\n  }\n\n  // =========================================================================\n  // ROMANCE PROGRESSION\n  // =========================================================================\n\n  private useBouquet(): void {\n    if (!this.state) return;\n    const romanceMgr = this.registry.get('romanceManager') as RomanceManager | undefined;\n    const relationshipMgr = this.registry.get('relationshipManager') as RelationshipManager | undefined;\n    const inventoryMgr = this.registry.get('inventoryManager') as InventoryManager | undefined;\n    if (!romanceMgr || !relationshipMgr || !inventoryMgr) return;\n\n    const fp = relationshipMgr.getFriendshipPoints(this.state.npcId);\n    if (romanceMgr.useBouquet(this.state.npcId, fp)) {\n      inventoryMgr.removeItem('bouquet', 1);\n      this.state.mode = 'talk';\n      this.state.choices = null;\n      this.clearChoices();\n      this.dialogueText.setText(`${this.state.npcName}: \"A bouquet... for me? I'd love to go out with you!\"`);\n      this.promptText.setText('[Space] Close');\n    }\n  }\n\n  private usePendant(): void {\n    if (!this.state) return;\n    const romanceMgr = this.registry.get('romanceManager') as RomanceManager | undefined;\n    const relationshipMgr = this.registry.get('relationshipManager') as RelationshipManager | undefined;\n    const inventoryMgr = this.registry.get('inventoryManager') as InventoryManager | undefined;\n    if (!romanceMgr || !relationshipMgr || !inventoryMgr) return;\n\n    const fp = relationshipMgr.getFriendshipPoints(this.state.npcId);\n    if (romanceMgr.usePendant(this.state.npcId, fp)) {\n      inventoryMgr.removeItem('pendant', 1);\n      this.state.mode = 'talk';\n      this.state.choices = null;\n      this.clearChoices();\n      this.dialogueText.setText(`${this.state.npcName}: \"Yes! A thousand times yes! I can't wait to spend my life with you!\"`);\n      this.promptText.setText('[Space] Close');\n    }\n  }\n\n  // =========================================================================\n  // SHOP/GIFT EXIT\n  // =========================================================================\n\n  private exitShopOrGift(): void {\n    // Clean up shop elements\n    for (const t of this.shopItems) t.destroy();\n    this.shopItems = [];\n    if (this.shopTitle) { this.shopTitle.destroy(); this.shopTitle = null; }\n    if (this.shopGold) { this.shopGold.destroy(); this.shopGold = null; }\n\n    // Clean up gift elements\n    for (const t of this.giftItems) t.destroy();\n    this.giftItems = [];\n\n    if (this.state) {\n      this.state.mode = 'talk';\n      this.state.choices = null;\n    }\n    this.showEndChoices();\n  }\n\n  // =========================================================================\n  // UI HELPERS\n  // =========================================================================\n\n  private displayChoices(choices: DialogueChoice[]): void {\n    this.clearChoices();\n    const { height } = this.cameras.main;\n    const startY = height - 140;\n\n    this.dialogueText.setText('');\n\n    for (let i = 0; i < choices.length; i++) {\n      const choiceText = this.add.text(60, startY + i * 24, `${i + 1}. ${choices[i].text}`, {\n        fontFamily: 'monospace', fontSize: '12px', color: '#aaffaa',\n      }).setScrollFactor(0).setDepth(9002).setInteractive({ useHandCursor: true });\n\n      choiceText.on('pointerover', () => choiceText.setColor('#ffffff'));\n      choiceText.on('pointerout', () => choiceText.setColor('#aaffaa'));\n      choiceText.on('pointerdown', () => choices[i].action());\n\n      this.choiceTexts.push(choiceText);\n\n      // Number key shortcuts\n      const key = this.input.keyboard!.addKey(Phaser.Input.Keyboard.KeyCodes.ONE + i);\n      key.once('down', () => choices[i].action());\n    }\n  }\n\n  private clearChoices(): void {\n    for (const t of this.choiceTexts) t.destroy();\n    this.choiceTexts = [];\n  }\n\n  closeDialogue(): void {\n    this.stopTypewriter();\n    this.state = null;\n    this.setVisible(false);\n    this.clearChoices();\n\n    // Clean up shop/gift overlays\n    for (const t of this.shopItems) t.destroy();\n    this.shopItems = [];\n    if (this.shopTitle) { this.shopTitle.destroy(); this.shopTitle = null; }\n    if (this.shopGold) { this.shopGold.destroy(); this.shopGold = null; }\n    for (const t of this.giftItems) t.destroy();\n    this.giftItems = [];\n\n    this.scene.resume('OverworldScene');\n  }\n\n  private setVisible(visible: boolean): void {\n    this.backdrop.setVisible(visible);\n    this.dialogueBox.setVisible(visible);\n    this.nameText.setVisible(visible);\n    this.dialogueText.setVisible(visible);\n    this.promptText.setVisible(visible);\n  }\n\n  private drawDialogueBox(width: number, height: number): void {\n    this.dialogueBox.clear();\n    const boxW = width * 0.8;\n    const boxH = 150;\n    const boxX = (width - boxW) / 2;\n    const boxY = height - boxH - 20;\n    this.dialogueBox.fillStyle(0x111122, 0.92);\n    this.dialogueBox.fillRoundedRect(boxX, boxY, boxW, boxH, 8);\n    this.dialogueBox.lineStyle(2, 0x4466aa, 0.8);\n    this.dialogueBox.strokeRoundedRect(boxX, boxY, boxW, boxH, 8);\n  }\n\n  update(): void {\n    // Dialogue is event-driven, no per-frame logic needed\n  }\n}\n","import Phaser from 'phaser';\nimport { GAME_WIDTH, GAME_HEIGHT } from './config';\nimport { MainMenuScene } from './scenes/MainMenuScene';\nimport { BootScene } from './scenes/BootScene';\nimport { OverworldScene } from './scenes/OverworldScene';\nimport { DungeonScene } from './scenes/DungeonScene';\nimport { BossArenaScene } from './scenes/BossArenaScene';\nimport { SettlementScene } from './scenes/SettlementScene';\nimport { UIScene } from './scenes/UIScene';\nimport { DialogueScene } from './scenes/DialogueScene';\n\nconst config: Phaser.Types.Core.GameConfig = {\n  type: Phaser.AUTO,\n  width: GAME_WIDTH,\n  height: GAME_HEIGHT,\n  parent: 'game-container',\n  backgroundColor: '#0c0f1a',\n  pixelArt: true,\n  physics: {\n    default: 'arcade',\n    arcade: {\n      gravity: { x: 0, y: 0 },\n      debug: false,\n    },\n  },\n  scale: {\n    mode: Phaser.Scale.RESIZE,\n    autoCenter: Phaser.Scale.CENTER_BOTH,\n  },\n  scene: [\n    MainMenuScene,\n    BootScene,\n    OverworldScene,\n    DungeonScene,\n    BossArenaScene,\n    SettlementScene,\n    UIScene,\n    DialogueScene,\n  ],\n};\n\nnew Phaser.Game(config);\n"],"names":["GAME_WIDTH","GAME_HEIGHT","TILE_WIDTH","TILE_HEIGHT","TILE_SIZE","CHUNK_SIZE","RENDER_DISTANCE","PLAYER_SPEED","PLAYER_SPRINT_MULT","PLAYER_MAX_HP","PLAYER_MAX_STAMINA","STAMINA_REGEN_RATE","STAMINA_SPRINT_COST","INTERACTION_RADIUS","INVENTORY_SLOTS","INVINCIBILITY_FRAMES_MS","KNOCKBACK_FORCE","CRIT_BASE_CHANCE","CRIT_BASE_MULT","BOSS_ENRAGE_TIME_MS","BOSS_ENRAGE_MULT","HITSTOP_DURATION_MS","CRIT_HITSTOP_DURATION_MS","KILL_HITSTOP_DURATION_MS","DAY_LENGTH_MS","DAYS_PER_SEASON","SEASONS","BIOME_RINGS","NOISE_OCTAVES","NOISE_PERSISTENCE","NOISE_SCALE","RARITY_TIERS","CORRUPTION_SPREAD_RATE","CORRUPTION_SLOW_THRESHOLD","CORRUPTION_DAMAGE_THRESHOLD","CORRUPTION_SPAWN_THRESHOLD","MAX_SETTLEMENTS","SETTLEMENT_TIERS","RIFT_HP_SCALING","RIFT_DMG_SCALING","RIFT_SPEED_SCALING_INTERVAL","RIFT_SPEED_SCALING","RIFT_MINIBOSS_INTERVAL","RIFT_BOSS_INTERVAL","RIFT_CHECKPOINT_INTERVAL","SAVE_SLOTS","AUTOSAVE_INTERVAL_MS","MainMenuScene","Phaser","width","height","buttonY","spacing","latestSlot","latestTime","i","raw","t","btn","label","x","y","onClick","PACK_CORE","PACK_ENEMIES_COMMON","PACK_BOSS_FIRE","PACK_BOSS_ICE","PACK_BOSS_BIRD","PACK_BIOME_HAVEN","PACK_BIOME_ROTWOOD","PACK_BIOME_ASHLANDS","PACK_BIOME_DROWNED","PACK_BIOME_ICE","PACK_DUNGEON","PACK_FOOD","PACK_EFFECTS","ALL_PACKS","AssetManager","packName","scene","packNames","toLoad","name","pack","asset","resolve","BootScene","data","barX","barY","barW","barH","fill","loadingText","value","gfx","tileColors","color","objPlaceholders","key","size","TYPES_ENUM","TYPES_NAMES","TYPES","UNSIGNED_MAX","roundToMultiple","mul","roundToMultiple4","$storeRef","$storeSize","$storeMaps","$storeFlattened","$storeBase","$storeType","$storeArrayElementCounts","$storeSubarrays","$subarrayCursors","$subarray","$parentArray","$tagStore","$indexType","$indexBytes","$isEidType","stores","createShadow","store","shadowStore","_","eid","length","start","end","resetStoreFor","ta","createTypeStore","type","totalBytes","buffer","createArrayStore","metadata","storeSize","cursors","indexType","arrayElementCount","array","start2","end2","isArrayType","createStore","schema","$store","arrayElementCounts","collectArrayElementCounts","s","keys","k","a","recursiveTransform","SparseSet","dense","sparse","comparator","result","has","val","index","swapped","$entityMasks","$entityComponents","$entitySparseSet","$entityArray","defaultSize","globalEntityCursor","globalSize","getGlobalSize","removed","defaultRemovedReuseThreshold","removedReuseThreshold","getEntityCursor","eidToWorld","addEntity","world","$manualEntityRecycling","$size","$notQueries","q","queryCheckEntity","queryAddEntity","removeEntity","$queries","queryRemoveEntity","$localEntities","$localEntityLookup","$modifier","$queryAny","$queryAll","$queryNone","$queryMap","$dirtyQueries","$queryComponents","registerQuery","query","components2","notComponents","changedComponents","c","comp","mod","$componentMap","registerComponent","mapComponents","allComponents","sparseSet","archetypes","changed","toRemove","entered","exited","generations","v","reduceBitflags","masks","notMasks","hasMasks","flatProps","generateShadow","pid","$","prop","diff","clearDiff","shadows","dirty","shadow","i2","defineQuery","args","any","all","none","commitRemovals","generationId","qMask","qNotMask","eMask","queryCommitRemovals","defineComponent","component","incrementBitflag","$bitflag","queries","notQueries","changedQueries","hasComponent","registeredComponent","bitflag","addComponent","reset","match","$archetypes","createWorld","resetWorld","Types","SeededRandom","seed","min","max","j","items","weights","total","b","roll","PerlinNoise","rng","p","hash","h","u","X","Y","xf","yf","aa","ab","ba","bb","octaves","lacunarity","persistence","frequency","amplitude","maxValue","TileType","ObjectType","TILE_PROPERTIES","OBJECT_PROPERTIES","OBJECT_DROPS","BiomeId","BIOME_DEFS","BIOME_OBJECTS","BiomeGenerator","tileX","tileY","dist","noiseVal","effectiveDist","rings","biome","def","n","detail","spawns","cumulative","objType","weight","IsometricHelper","screenX","screenY","halfW","halfH","pixelX","pixelY","variants","layer","chunkSize","chunkKey","cx","cy","ChunkManager","tiles","objects","corruption","centerTileX","centerTileY","ly","lx","worldTileX","worldTileY","container","screen","tileType","tileProps","tile","objProps","obj","cameraWorldX","cameraWorldY","approxTileX","approxTileY","camCX","camCY","desiredChunks","rd","dy","dx","cxStr","cyStr","newContainer","Position","Velocity","Sprite","Health","Stamina","SynergyStatus","Combat","PlayerTag","EnemyTag","NPCTag","ProjectileTag","BossTag","AI","Collider","Equipment","Inventory","Corruption","Animation","WeaponType","StatusEffects","EliteAffix","AIBehavior","AIState","ecsWorld","textureRegistry","textureMap","registerTexture","id","getTextureName","createPlayer","createEnemy","hp","damage","defense","aggroRadius","texture","behavior","affixes","createNPC","createProjectile","vx","vy","ownerEid","movementQuery","movementSystem","delta","entities","animQuery","animationSystem","FRAME_DURATION","aiQuery","playerQuery","enemyQuery","beginTelegraph","duration","tickTelegraph","behaviorStates","getState","aiSystem","aggroMult","enemies","players","playerEid","px","py","ex","ey","distToPlayer","homeX","homeY","patrolRadius","distToHome","speed","updateChase","updateSwoop","updateRanged","updateAmbush","updateSupport","updatePhase","updatePack","updateStationary","updateWander","angle","targetX","targetY","pdx","pdy","pDist","chaseSpeed","bs","circleRadius","tdx","tdy","tDist","diveSpeed","ddx","ddy","dDist","idealMin","idealMax","projSpeed","pvx","pvy","dmg","revealRadius","chargeSpeed","allEnemies","lowestHpEid","lowestHpRatio","ally","adx","ady","hpRatio","healAmount","allyCount","spawnDist","spawnX","spawnY","flankX","flankY","fdx","fdy","fDist","AffixId","AFFIXES","AFFIX_IDS","rollAffixes","eliteChance","first","second","combatantQuery","statusQuery","iFrames","grantIFrames","durationMs","externalDamageMult","setExternalDamageMult","fn","getFacingAngle","lastFacing","isBackstabPosition","attackerEid","targetEid","targetFacing","angleToAttacker","behindAngle","pendingDamage","playerAttackRequested","requestPlayerAttack","flushDamageEvents","events","pendingParries","flushParryEvents","riposteActive","swordMasteryLevel","setSwordMasteryLevel","level","ComboTracker","COMBO_TIMEOUT","tickCombos","state","registerHit","processStatusEffects","other","combatSystem","remaining","newVal","isPlayerA","isEnemyA","isPlayerB","isEnemyB","range","stunDuration","isRiposte","riposteBonusMult","backstab","backstabMult","extMult","isCrit","critMult","rawDmg","syn","finalDmg","a1","a2","b1","b2","comboCount","kbScale","comboKbBonus","totalKb","kbX","kbY","projectileQuery","targetQuery","MAX_LIFETIME","lifetimes","projectileSystem","projectiles","targets","elapsed","pDmg","tid","projIsPlayerOwned","targetIsEnemy","targetIsPlayer","hitRange","BIOME_DENSITY","BIOME_ENEMY_STATS","SEASON_MODS","spawnedChunks","resetSpawnedChunks","spawnSystem","playerX","playerY","getBiome","season","ptx","pty","pcx","pcy","seasonMod","centerTX","centerTY","baseDensity","stats","biomeDef","density","count","tx","ty","mult","hpMult","dmgMult","defMult","spdMult","lootBonus","aid","affix","despawnDist","ENEMIES","ENEMY_DB","e","LEGENDARY_EFFECTS","TIER_ORDER","RarityManager","luck","biomeMultiplier","bossBonus","totalWeight","tier","tierIdx","selectedIndex","tierDef","legendaryEffect","idx","baseStat","rarity","variance","baseMult","currentTier","materialQuality","chance","deadEnemyQuery","pendingLoot","flushLootEvents","DEFAULT_LOOT_TABLE","rarityManager","ENEMY_BY_TEXTURE","lootSystem","luckBonus","maxHP","xpReward","goldReward","eliteLootBonus","enemyType","enemyDef","droppedSpecific","entry","numDrops","sum","PlayerController","dodgeSpeed","norm","isSprinting","pos","dirX","dirY","movX","movY","len","hasMovement","TOOLS","SEEDS","CROPS","RESOURCES","MATERIALS","FOODS","WEAPONS","ARMOR","FISH","POTIONS","QUEST_ITEMS","MISC_ITEMS","ALL_ITEMS","ITEM_DB","item","TimeManager","startDay","deltaMs","date","cb","seasonLength","yearLength","year","dayOfYear","seasonIndex","dayOfSeason","totalMinutes","hour","minute","progress","m","paused","scale","SAVE_KEY_PREFIX","CURRENT_VERSION","SaveManager","saver","loader","slot","playerData","currentScene","sceneData","saveData","json","slots","blob","url","file","text","InventoryManager","amount","itemId","quantity","maxStack","canAdd","removing","candidates","lost","fromIndex","toIndex","from","to","half","merged","last","slotIndex","EMPTY_STATS","ACCESSORY_SLOTS","EquipmentManager","cost","notchCost","targetSlot","currentCost","tradeoff","prev","totals","notchCosts","tradeoffs","equippedData","QUESTS","QUEST_DB","QuestManager","questId","currentStatus","prereq","prereqStatus","target","status","completedIds","available","prereqsMet","externallyComplete","seconds","states","prog","SKILLS","SKILL_DB","SkillManager","skill","skillId","prevLevel","newXP","newLevel","lvl","totalXP","xpSpent","current","required","perkId","perk","nextLevelXp","xp","levels","needed","NPCS","NPC_DB","GIFT_POINTS","BIRTHDAY_MULTIPLIER","POINTS_PER_HEART","MAX_HEARTS","MAX_FRIENDSHIP","RelationshipManager","npc","npcId","reaction","points","pts","prevHearts","clamped","newHearts","hearts","dialogue","thresholds","threshold","lines","active","friendship","birthdayActive","CRAFTING_RECIPES","COOKING_RECIPES","ALL_RECIPES","RECIPE_DB","CraftingManager","recipe","recipeId","inventory","station","ing","FarmingManager","seedId","currentSeason","plot","seedDef","radius","FishingManager","timeOfDay","location","l","fish","seasonMatch","fs","timeMatch","ft","locMatch","fl","baitId","f","picked","direction","fishId","CookingManager","r","foodItemId","food","buff","existing","MILESTONES","MAX_LEVEL","MILESTONE_LEVELS","MASTERY_TYPES","WeaponMasteryManager","wt","weaponType","xpForCurrentLevel","milestones","unlocked","ml","CHAPTERS","StoryManager","chapterId","bossId","unlock","biomeId","nextChapter","cutsceneId","featureId","done","chapterProgress","CorruptionManager","arr","activeChunks","rate","snapshot","anySpread","spread","neighbors","nx","ny","nIdx","durationSec","deltaSec","chunks","hasValue","values","RIFT_MODIFIERS","FLOOR_MODIFIERS_MINOR","FLOOR_MODIFIERS_MAJOR","FLOOR_MODIFIERS_EXTREME","ALL_FLOOR_MODIFIERS","FLOOR_MODIFIER_DB","INSTABILITY_FILL_RATE","INSTABILITY_MAX","RiftManager","floor","pick","severity","pool","minor","majorChance","major","extremeChance","extreme","scaling","modifiers","speedMult","modId","startFloor","prevFloor","crystalReward","nextFloorNum","pseudoRandom","pickFromPool","seedOffset","pickMinorUnique","exclude","modifierId","enemyHp","enemyDmg","enemySpeed","riftId","floorLevel","newValue","riftInstances","instability","riftCheckpoints","SETTLEMENT_SITES","BUILDINGS","SETTLEMENT_SITE_DB","BUILDING_DB","BUILDING_TYPES","BUILDING_COSTS","SETTLEMENT_TIER_THRESHOLDS","SettlementManager","siteId","settlement","settlementId","buildingTypeId","siteDef","buildingDef","tierData","buildingIndex","building","nextTier","buildMinutesPerDay","production","dailyOutput","npcBonus","finalOutput","morale","requiredBuildings","output","raidPower","buildingType","tierCosts","costItems","placed","buildingId","nextTierCost","tierIndex","completedCount","categories","hasFoodProduction","defenseRating","proximity","difficulty","success","damageDealt","buildingsDestroyed","moraleChange","overflow","fromId","toId","fromSettlement","toSettlement","hasMarketFrom","hasMarketTo","fromIdx","toIdx","seen","routes","targetId","costs","goldCost","gold","settlements","FACTIONS","FACTION_DB","FactionManager","faction","chunkX","chunkY","factionId","map","bestId","bestValue","leaderState","expansionTargets","nKey","currentTarget","allChunks","factionValues","strongest","weaker","loss","event","influence","attackType","totalAttacks","ratio","resistanceGain","factionResMap","damageType","faction1","faction2","power1","power2","roll1","roll2","winner","loser","influenceShift","loserMap","winnerMap","contestedChunks","loserVal","winnerVal","newLoserVal","newWinnerVal","power","activeFactions","eventTypes","factions","idx1","idx2","map1","map2","factionDef","leaders","info","resistances","res","playerBehavior","TITANS","TITAN_DB","TRAPS_TO_WEAKEN","WEAKENED_STAT_MULT","STAT_SCALE_PER_KILL","PATROL_SPEED","TitanManager","startPos","moveDistance","titanId","viewRange","rangeSq","scalePerKill","killMult","weakMult","titans","BIOMES","BIOME_DB","MIN_DURATION_S","MAX_DURATION_S","TRANSITION_TIME_S","RAIN_TYPES","VISIBILITY_MAP","TEMPERATURE_MAP","WeatherManager","halfTransition","oldType","nextWeather","types","w","baseVisibility","nextVisibility","baseTemp","weatherMod","BIOME_MUSIC","BIOME_AMBIENT","SFX","AudioManager","loop","newMusic","volume","targetVolume","vol","muted","musicKey","ambientKey","DAY_CYCLE","DUNGEON_REVEAL_RADIUS","DUNGEON_DARKNESS_ALPHA","LIGHT_TIERS","LightingManager","isDungeon","lower","upper","g","alpha","ambient","cam","intensity","flicker","viewDist","light","steps","frac","dimR","dimG","dimB","dimColor","PRESETS","makeWeatherConfig","screenW","screenH","ParticleManager","preset","config","life","weatherType","dt","cameraX","cameraY","cameraW","cameraH","emitter","singleConfig","lifeRatio","margin","TIER_LOW","TIER_MEDIUM","TIER_HIGH","TIER_MAX","COLOR_LOW","COLOR_MEDIUM","COLOR_HIGH","COLOR_MAX","PARTICLE_INTERVAL","CorruptionOverlay","corruptionManager","particleManager","startTX","startTY","endTX","endTY","highCorruptionTiles","worldX","worldY","pulseAlpha","FESTIVALS","FESTIVAL_DB","FestivalManager","festival","day","festivalId","newYear","STAGE_THRESHOLDS","HEART_EVENT_LEVELS","GIFT_TIER_POINTS","RomanceManager","friendshipPoints","stage","minPoints","heartLevel","currentHearts","isBirthday","romanceStates","saved","CAREERS","CAREER_DB","CareerManager","careerId","career","specId","spec","ACHIEVEMENTS","ACHIEVEMENT_DB","AchievementManager","achievement","achievementId","prevValue","prevTier","newTier","tierOrder","prevIdx","newIdx","currentValue","category","totalPoints","earnedPoints","MailManager","letter","fullLetter","npcName","currentDay","subject","body","attachments","festivalName","mailId","senderId","STORAGE_SLOTS","StorageManager","sceneId","storageId","slotA","slotB","temp","containers","savedSlot","BIOME_BASE_TEMPS","SEASON_MODIFIERS","WEATHER_MODIFIERS","TIME_PERIODS","NIGHT_MODIFIER","COMFORT_MIN","COMFORT_MAX","COLD_STAMINA_REGEN_MULT","HEAT_STAMINA_DRAIN_MULT","TemperatureManager","timeMod","deltaSeconds","comfort","period","SHADOW_RESOURCES","CHANNEL_DURATION_MS","COOLDOWN_DURATION_MS","SHADOW_STAT_MULTIPLIER","ShadowWorldManager","currentTimeMs","resourceId","shadowInventory","MAX_CITIES","MAX_CITY_LEVEL","LEVEL_THRESHOLDS","LEVEL_10_PASSIVE_INCOME","LEVEL_UNLOCKS","CityLevelManager","cityId","oldLevel","currentThreshold","nextThreshold","unlocks","cities","MAX_CYCLE","DIFFICULTY_MULTIPLIERS","VALID_CARRYOVER_OPTIONS","EXCLUSIVE_ITEMS","NewGamePlusManager","carryoverOptions","opt","option","REQUIREMENT_DEFS","REQUIREMENT_DEF_MAP","EndgameManager","reqId","requirements","TUTORIAL_TIPS","TIP_MAP","tip","TutorialManager","INTERIOR_DEFS","INTERIOR_DEF_MAP","InteriorManager","interiorId","prevInterior","LEGENDARY_QUESTS","QUEST_DEF_MAP","LegendaryQuestManager","quest","stageId","currentStage","completedStageIndex","completedStageId","completed","AbilityManager","ability","ALL_ABILITIES","abilityId","currentStamina","cd","newCd","CutsceneManager","firstStep","step","LORE_FRAGMENTS","FRAGMENT_DB","CODEX_CATEGORIES","CodexManager","fragmentId","fragment","counts","cat","found","source","RARITY_CHANCES","frag","fragmentIds","SCAR_MEMORIES","MEMORY_DB","getEnemyMemories","enemyId","ScarReadingManager","memories","memory","sourceId","memoryId","biomeMemories","PactCondition","PACT_CONDITIONS","PACT_CONDITION_DB","PACT_REWARD_TIERS","PactManager","condition","stacks","cond","burden","best","highestBurden","AFFLICTIONS","VIRTUES","MAX_RESOLVE","TRAUMA_DURATION","RATES","ResolveManager","inCorruption","inDarkness","inShadowWorld","inCity","atCampfire","selected","pct","CONTRACT_DEFS","CONTRACT_DB","BountyContractManager","shuffled","contractId","onCorruption","playerHpPct","THRESHOLD_WEAKNESS","THRESHOLD_RESISTANCE","THRESHOLD_EXPLOIT","THRESHOLD_MASTERY","WEAKNESS_PROFILES","EnemyWeaknessManager","profile","statusEffect","discoveries","OMEN_DEFS","OMEN_DB","o","OmenSlotManager","omenId","combined","COMPANION_DEFS","COMPANION_DB","MAX_MORALE","MAX_LOYALTY","KNOCKOUT_REVIVE_TIME","MORALE_RATES","CompanionManager","moraleFactor","BOON_DEFS","BOON_DB","RARITY_WEIGHTS","BoonManager","choices","used","fallback","boonId","boon","REGION_SIZE","BASE_MAX_RESOURCES","DEPLETION_THRESHOLD","REGROWTH_DAYS","REGROWTH_PER_DAY","ResourceCycleManager","rx","ry","region","regrowAmount","regions","SHORTCUT_DEFS","SHORTCUT_DB","ShortcutManager","shortcutId","fromX","fromY","distFrom","distTo","IMPRINT_DEFS","IMPRINT_DB","imp","BOSS_TO_IMPRINT","MAX_ACTIVE_SLOTS","ImprintManager","imprintId","d","QUIRK_DEFS","QUIRK_DB","MAX_POSITIVE_QUIRKS","MAX_NEGATIVE_QUIRKS","INSTABILITY_DECAY_PER_DAY","MEMSTONE_ITEM_ID","QuirkManager","tag","polarityCount","quirk","defId","quirkId","polarity","ECHO_PATTERNS","ECHO_PATTERN_DB","MAX_KILL_LOG","MAX_ECHO_CHARGES","ECHO_DECAY_TIME","CHARGE_DECAY_RATE","WeaponEchoManager","killType","pattern","seq","tail","totalDmg","NPCController","startX","startY","interactionRadius","wasInteractable","schedule","NPCManager","controller","CITIES","BIOME_ID_MAP","CUTSCENE_SCRIPTS","BUILDING_INTERIOR_MAP","OverworldScene","pEid","imprintFx","quirkFx","masteryWeaponType","masteryDmgBonus","regionKey","patternId","charges","_patternId","rarityColors","contract","bonusGold","tierLabels","enemyByTexture","texName","ECSSprite","trauma","npcOffset","_pointer","_gos","_dx","abilityKeys","abilityRange","enemy","keyCodes","kc","masterySpdBonus","weapon","weaponDef","SYNERGY_MAP","abilities","textStyle","_time","dietHpBonus","dietStaminaBonus","foodDrainMult","weatherAggro","imprintAggro","echoDmg","tilePos","biomeStr","tempEffects","coldExposure","heatExposure","visibility","corruptionFx","tileCorruption","now","msgs","wobbleIntensity","wobbleX","wobbleY","dmgPenalty","sx","sy","nearCampfire","cf","resolveEffects","pEid2","activeContract","omenEffects","pEid3","gi","wobble","screenPos","traumaDisablesDefiance","entrance","facing","facingTile","rift","bldg","campfire","sc","dead","returnPos","buildingName","entranceX","entranceY","dest","canAfford","costStr","marker","KINDLE_TINTS","storageLabel","storage","uiScene","npcDef","dialogueScene","dungeonId","bases","animDefs","base","anim","textureKey","animKey","frames","activeEids","sprite","hpBar","affixDef","AFFIXES_LOOKUP","idleAnim","baseName","aiState","desiredAnim","telegraphT","flash","hpCurrent","hpMax","bx","by","ev","imprintEffects","quirkEffects","xpMult","currentLevel","xpNeeded","goldMult","finalGold","bestiaryUI","fragId","hpPct","offsetX","offsetY","RARITY_HEX","RARITY_NAMES","rarityColor","rarityPrefix","isHighRarity","RARITY_TINT","displayName","fontSize","pickupRadius","drop","leftover","pickedUp","maxHitstop","enemyDmgMult","isKill","isPlayerHit","baseFontSize","dmgScale","suffix","comboSuffix","parries","bg","glow","memText","combo","city","rMarker","rLabel","sites","site","bIndex","allShortcuts","statusText","labelColor","fromMarker","fromLabel","toMarker","toLabel","showDist","toolDef","drops","qty","slotIdx","potion","effects","omenHp","omenStamina","goldToDrop","deathText","timeStr","backdrop","barBg","catchZone","progressBg","progressFill","instrText","escText","wasdW","wasdS","session","child","go","message","notif","title","btnStyle","resumeBtn","saveBtn","menuBtn","overlay","options","txt","btnY","startBtn","cancelBtn","pairs","cropId","_quality","_outputItemId","_quantity","_killCount","_crystals","_oldType","newType","FESTIVAL_BONUSES","bonuses","rewards","reward","_recipeId","outputItemId","_questId","wName","latest","script","_def","boxH","boxBg","speakerText","bodyText","continueText","makeFloors","enemyPool","trapProgression","bossMap","roomScale","floors","roomMin","roomMax","DUNGEONS","DUNGEON_DB","GRID_WIDTH","GRID_HEIGHT","MIN_LEAF_SIZE","MAX_LEAF_SIZE","MIN_ROOM_SIZE","MAX_ROOM_SIZE","Tile","splitBSP","node","depth","splitH","maxSplit","split","placeRooms","roomW","roomH","roomX","roomY","collectLeafRooms","getSubtreeRoomCenter","carveCorridor","grid","x1","y1","x2","y2","connectBSP","leftCenter","rightCenter","assignRoomTypes","rooms","typeWeights","tw","populateRoom","room","dungeonRewardPool","roomArea","enemyCount","typeId","trapCount","trapType","guardCount","lootCount","chances","generateFloor","dungeon","floorDef","targetRoomCount","root","row","leafRooms","lr","col","crossConnectionCount","rewardPool","explored","entranceIndex","revealRoom","roomIndex","padding","endY","endX","clearRoom","getTile","isExplored","heuristic","ax","ay","findPath","toX","toY","openSet","closedSet","startNode","dirs","maxIterations","iterations","lowestIdx","path","dir","tentativeG","existingIdx","DungeonManager","TILE_WALL","TILE_FLOOR","TILE_CORRIDOR","COLOR_WALL","COLOR_FLOOR","COLOR_CORRIDOR","COLOR_FOG","LOOT_PICKUP_DISTANCE","CHEST_INTERACT_DISTANCE","DungeonScene","layoutId","riftMgr","riftFloor","entranceRoom","minimapSize","mapPixelW","mapPixelH","dungeonName","corruptionMgr","lightTier","checkPoints","pt","tileCenterX","tileCenterY","overlapX","overlapY","rect","eids","hpScale","dropX","dropY","dropImage","inventoryManager","isCursed","chestSprite","chest","dungeonDef","numItems","totalChance","rolledItems","lootColor","prefix","lootLines","lootText","cleared","extraDmg","rec","BOSSES","BOSS_DB","boss","PHASE_TRANSITION_PAUSE_MS","TELEGRAPH_DELAY_MIN_MS","TELEGRAPH_DELAY_MAX_MS","ATTACK_RANGE","STRAFE_SPEED_MULT","ABILITY_COOLDOWN_MS","ENRAGE_SPEED_MULT","ENRAGE_TINT","BossController","bossX","bossY","phase","moveSpeed","strafeSpeed","abilityName","baseDmg","normalized","hpPercent","phases","nextIndex","newIndex","phaseIdx","baseDamage","baseDefense","damageMult","defenseMult","delay","GRAVITY","JUMP_VELOCITY","GROUND_Y_OFFSET","PLATFORM_HEIGHT","TELEGRAPH_DURATION_MS","VICTORY_DELAY_MS","BossArenaScene","phaseIndex","pointer","fitZoom","platformConfigs","pc","_dt","predictedY","prevY","pb","onPlatform","bossEid","slashX","slash","_abilityId","border","phaseText","descText","skillManager","weaponMasteryManager","storyManager","imprintManager","questManager","bossHPPercent","hpColor","markerX","currentPhase","playerBarW","playerBarH","playerBarX","playerBarY","playerHP","playerMaxHP","playerHPPct","playerHPColor","staminaBarY","stamCur","stamMax","stamPct","BUILDING_COLORS","BUILDING_TEXTURES","SettlementScene","totalGridW","leaveBtn","bIdx","nameLabel","tierLabel","npcLabel","npcsHere","npcY","tierName","moraleColor","prodEntries","prodLines","amt","allTypes","header","colorHex","pointerX","pointerY","lastBuilding","menuX","menuY","menuW","canUpgrade","nextCost","upgradeCostStr","ok","maxWorkers","menuH","oy","UIPanel","SLOT_SIZE","SLOT_GAP","INV_COLS","INV_ROWS","INV_TOTAL","EQUIP_SLOTS","RARITY_COLORS","CATEGORY_COLORS","InventoryUI","backpackLabel","icon","countText","hit","_ptr","ptr","eqOx","eqOy","equipLabel","lbl","inv","equip","equipped","slotGfx","catColor","rarityHex","rarityName","maxW","line","invIndex","equipSlot","armorDef","newEquip","prevDef","equipIndex","slotName","CATEGORIES","CraftingUI","tabX","tab","detailX","crafting","recipes","canA","canB","maxScroll","visible","entryH","entryW","canCraft","outputDef","outName","nameText","ingStr","ingDef","have","ingredientText","ingLines","QUEST_TYPE_COLORS","QuestJournal","tabs","tabNames","qm","quests","typeColor","typeText","objLines","rewardParts","itemDef","BIOME_COLORS","MAP_OX","MAP_OY","TILE_MINIMAP_COLORS","MapUI","panelW","panelH","legendX","legendY","legendTitle","hexStr","maxDist","mapScale","sortedBiomes","innerDist","outerDist","outerR","ringMid","labelY","cityX","cityY","player","mmSize","mmX","mmY","pixPerTile","tilesVisible","halfTiles","chunkMgr","blinkAlpha","dotX","dotY","SKILL_COLORS","SkillsUI","levelText","barGfx","xpText","sm","skills","ox","rowH","xpInfo","SettingsUI","audioLabel","sliderW","sliderH","handleSize","valueText","handle","trackHit","displayY","displayLabel","overworld","ShopUI","sellMult","buyHeader","sellHeader","divider","sellPrice","price","BestiaryUI","listHeader","detailHeader","totalEntries","allEntries","isDiscovered","_isBoss","bossDef","addLine","kills","lootList","StorageUI","onChange","chestHeader","invHeader","moved","added","MailUI","mailManager","allMail","unread","hasAttach","empty","timeManager","CareerUI","careerMgr","style","desc","specHeader","isSelected","specText","UIScene","itemText","qtyText","cdBar","openPanel","panel","anyOpen","playerController","weatherManager","sp","combatLevel","xpProgress","WEATHER_ICONS","cur","activeBuffs","buffStrs","hotbarY","activeSlot","abilityManager","hotbar","slotSize","gap","totalW","aby","abStartX","cdFrac","fillH","shadowWorldManager","riftManager","bgColor","DialogueScene","boxW","boxX","boxY","relationshipMgr","questMgr","questDef","completableQuestIds","qId","dialogueChoices","checkReady","qd","romanceMgr","inventoryMgr","fp","skillMgr","rewardText","shopData","npcCity","shopItemIds","goldCount","priceMultiplier","basePrice","giftableItems","maxDisplay","gift","reactionText","choiceText"],"mappings":"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ACA,oBACA,eACA,cACA,aACA,cACA,mBACA,eACA,gBACA,gBACA,eACA,QACA,QACA,cACA,KAAA,CACF,EAEF,CACE,OAAQ,aACR,MAAO,CACL,UACA,MACA,MACA,eACA,QACA,aACA,cACA,aACA,kBACA,gBACA,cACA,YACA,YACA,WAAA,CACF,EAEF,CACE,OAAQ,SACR,MAAO,CACL,QACA,MACA,OACA,OACA,QACA,cACA,gBAAA,CACF,EAEF,CACE,OAAQ,mBACR,MAAO,CACL,QACA,SACA,aACA,cACA,YACA,gBACA,iBACA,OACA,gBACA,aAAA,CACF,EAEF,CACE,OAAQ,WACR,MAAO,CAAC,MAAO,MAAO,SAAU,MAAO,KAAK,CAAA,EAE9C,CACE,OAAQ,QACR,MAAO,CACL,MACA,UACA,OACA,SACA,MACA,OACA,QACA,MACA,OAAA,CACF,CACF,EAEF,KAAM,CACJ,QACA,aACA,aACA,cACA,YACA,SACA,aACA,SACA,YAAA,EAEF,WAAY,GACZ,cAAe,EAAA,EAMjB,CACE,GAAI,WACJ,KAAM,WACN,YAAa,8CACb,MAAO,WACP,WAAY,GACZ,EAAG,KACH,EAAG,KACH,UAAW,CACT,CACE,GAAI,QACJ,KAAM,iBACN,KAAM,aACN,SAAU,CAAC,QAAS,SAAU,SAAS,CAAA,EAEzC,CACE,GAAI,gBACJ,KAAM,gBACN,KAAM,QACN,SAAU,CAAC,SAAU,aAAa,CAAA,EAEpC,CACE,GAAI,YACJ,KAAM,YACN,KAAM,SACN,SAAU,CAAC,UAAW,WAAY,SAAS,CAAA,CAC7C,EAEF,MAAO,CACL,CACE,OAAQ,aACR,MAAO,CACL,UACA,eACA,aACA,WACA,WACA,MAAA,CACF,EAEF,CACE,OAAQ,aACR,MAAO,CACL,aACA,WACA,WACA,cACA,OACA,OAAA,CACF,CACF,EAEF,KAAM,CAAC,uBAAwB,iBAAkB,iBAAiB,EAClE,gBAAiB,wBACjB,WAAY,GACZ,UAAW,iBACX,cAAe,EAAA,EAMjB,CACE,GAAI,eACJ,KAAM,eACN,YAAa,yCACb,MAAO,SACP,WAAY,GACZ,EAAG,MACH,EAAG,MACH,UA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","x_google_ignoreList":[5]}